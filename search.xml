<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>2023å¹´å†™ç»™è‡ªå·±çš„ä¸€å°ä¿¡</title>
    <url>/p/401ea0bb.html</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="å¯†ç é”™è¯¯ ğŸ˜­" data-whm="å½“å‰æ–‡ç« ä¸èƒ½æ ¡éªŒğŸ˜­">
  <script id="hbeData" type="hbeData" data-hmacdigest="1e63cc4866c0fefab8eb660e7f473dcc70541e4c911d792c239659b7ab6050df">601062fcdaf3cca9d544423806934044380848aba583af6c1ea7ebc532dbcc8f340269dd12e0c82ecb6ab6129d2c267fb3d88b6bea6ce2e9d3601e47eb858e579e06985ea76068a7649c05ed11522b16a2e4562d2f57a40644ca0ec6d2e13cc38c117c6b9192e0ccbf22e14549cf2f7c0825ef95d99b3196910ed33ea30bd7f0393e3fc83a795b446b68c1075d815e7ee09968fbbdf3afa0dc2ffd621ba40a8e6e849b19034746563263082f51387b5fd073059a640b43e457160cd678a3a6e1b374fac09e1e01f0044493f99815b555ec30e4f80a646bd28a518bebc946005561affac07d8c7aa9a129bfca88947435642c6bdaaf8fbaad3bc957bb16dd015a40cea6ad4d180b55f0bc71467c20c7bd5f6e321f64051cf26cf0a9e20cf7062c568b629a42fdc4c014b92d21c2f55bca63cc7de700f10ac1aae344cbe4af51ba8b85c729315fab3e523b8f1d65733d263ad199c4bb9da2681dacde843c1c4a3895923890e73f6dfbc6736b5b227ee4b992ce76141543984e0ad732944adc102560827f57b58d9ca7b472024e2543600fe46355db4f506c2fee9dff8627e9ed5f5c8820d9faa7caed1533fb62a7d4d3846d8dcdb9bff255dbfd4801ab11c5b11fb631f13df2653f48fc9754503cc8ea5134f84d7a24309a9f61518660be2e845ea793ade3f7feb75b5bc579dac637ac1b86f3fe0259cc52c5ffcf4a589905f0300c2292f052e144df2d7948af2cc66330c84eeb02935cdd4b00e0d0a7f00a7030568ca8b1664978955bf8c2e045658e1d2c513996b348fc0b9ae0417984f9b6c809eb387d189e21de49a23114b1b77e8663036e51f8862220a841197147915794d9a31b08b65e673d18b95a93b2b2d8a5182608b3159cac71fd7e105b31c13f15d88d82db59f790b221fc2a90449f1836737c091a889606cf46f2099224687fb27739860524295074d830ae3221a722d39cd81c2d23c2c1239015d5966ec8733bba23945b49c21904185a1e5efd5e7b453f38ec285d7164827a64a5abff9698a3fd0047f978cea0d0e48bfcbf4cc51ceee74972ff15a48f42e3acf74238f0e31df07da15f891a1a91ab3d656af1659bf0bb6af9e0fca0fe9ee1cb0e64d7f7aaa23fddbb3cf7fa6b4e36027ad7518941eaa6e2025e8021a6219c608608216547e20f73e50a2f0865184fe409e34b0d94f6264a9bbc899fab131b18ff4ba7756af804c96ffc901a3e4ebd35493c39cf59a26221792b6cd8162d592efb8469553f4ca5f307db756bfe06fd03e34920fe6f485af950b5633be41b2a474c4d02e9cad4d7f07be56e301e884ff0302b6361cd3c7ae8aa0d1acdf640cb384fce0511ed67a9f15f7c3457f12a62327fe41c61da1b0dbd9188c839189f4c877bc951406bc4762f0fa9f9db1f44fef71fc15a397b3945b3ee7422738ce1f09372d97ba67ef972300d7a6757e3af27b7f63e2e7bd3e57f29111b484c19179e336dc76b1d66b64ab6bd8c4fbdf229bb2435eb4c42fd138ba3ce7fb19712562c4b9bc1bf40abdbe6abd1f9476c4896aad4df3a98b58c8cfc460f0327ae5064461fcc44e1238a823e68bebeeb9656eb91b75679d292320ff15cb8c6a35a9e4d409411d5ef441cc6b1d8e5bbcdf898637439aca84c6af50f1b214f6018685bed53176f65410bae877891097e5c818254ef2760fa0f52913b33d0c85f0ddbc76babd1c5f61ba89b44f2d44f1e4a804c4ac3d533df232461e070f17d2185fd2f67bf5e67f5b90dd20569589756f43775d622cc409b580adb578b08600788c348e885fddb0374509aa69e052755402072cbf4b2d3c8c8e8086e5855aa91eb9649e984b86a472e05c25a6b7d35334616acec14ff32191c7c74e9b1c1e3410aa0ce7335d16f5b65673a19e70f2a7fdefcdcd85cdcfa646020ee93874e9347a636a1ef9700caf796b2e2e3e40f0b0154c28826d299a3a7728d90d80f877a300a8173ca4a71489715fe0325521c0afdbac11385059a6c3aae86708387f73ebb497c21706dadbb70bbf473335f19e41a8fa9d1bc6263fec0753df1d9e1b26c0c9384df6f1c3d6a087f88bd1140ae7a799ca6b617f65eea35059ecab6c99063dc5243b82fe5cbeec7f7f3ff2da745a7483f37757d86d7d994f740c7710ef5119ab4e19cc232496b09fd4839a59ece0c11cc4f18a1772f90f8bbf174ebb7e49ce22458485d848a7bb576e28c04b04d6f5d0b3ebe6314ddc18498db9983852e13eb5411dac6e86266dc303a587eca93273412c7055d5cbe132e560753410577aba252ca5c1b9638fc38f1af71ad6eec97eb87d594a1a46a32d62152cba7d515b7738e90ea7b9546967b731f419197d4c0a3ad427b6ee1981435f49c999a5dc2cfded9564e1440bcf0f760473072098abba60ded6e280828037ea1c3eb8e24650571df8c2ac9abfa2045df2301de83b2527abc535786e4226dae801ffe87c23bfc975f2744d2c7b407d81e5a7f532505f9e4767d126a95109e8fcfa0bcab3b83526bbcd5d67d8e4f2c91c3112c583115902ecb15c05b7606327b7b856004d5e9b165c534791daf3dbd16c3f3191893bfd37643940418b69694c433bc2f0f47eb2672792c51b821d013545c4bdac95901afdd97cac02bea92b2730bd5dd12305346074d9f4dd5ad744b3fca54461354d99e721bf72dc31789c3a7f455180cb5f9887917912fb54d5976b717ce5a4e5557afd8c31643c02ded7fe372d933ddf76cce805b35eb2e6fb20a683e409155be5f9e56778b3417cb16b763961793fa18c6a8ab4f1c2ad3dcc5447a98b2a5febc52ec3b093586b37b878d74e41308b65d1776c95bb644e7ab62d4bbcdc7bc9e3b1dd596dd6db7057a4985d05c6b25698d79460df8733fded3a811081361558c2abf8de1ad05926e0bc2c1b2ca1c583d87adf93c5c5082afe5a827100aba7c41a048c3b405fcd293bb838fe5911caef128041705b56c70e219c95793ec626580f2d41b069fe601d438c87fefb29cd4e7614bf2a753d0d1d45fd4f27eeb2ee9ee1e6a4832f24523297a36310021b62da8e531fb238b4ed38fa5e9efb79a39d5a7cf81d98887ee648889dbcb2095ef144b79671472f0ddbf70ba2c5941eecf5d48726d93fef031f2d9addc8f59f15d07f731eb261305bed1480429b0736e8fe2ea95fb3ff6b7e1ec79ce892c50ba3b606ea22ade470ac6e0226a5ddc971389e82df9c4ee99c8a5cba7b9506c9976b5bfa2ecd0283c2ae0c2dab8a20be4157adf4c7001b4d10198f5f45f7211a35ffe85f3b7130f5b7857056be669ce8967d9045f07df644a3f38a468fcec3715e6a2f57e1ddb95873bde83288b1dcb567ebaafc3ac1e142d206ba66467461e3f412ecaec254cd2d37815bcbb9b88c3e98b8e1a397d88930bef8a8fe643d0b48d6f93d8695ea4c5fc66cc0335ddb09dd9b995e05b8ab0d1a777a1bb220fbf853f4b3fc69a91443f50c0f32320d206bfd359c787f72d34270a857eb4fde42a2e38b669f1a0d5cc1661680f5cd3e85401680d8457ba36019e15bafb5a9b453a9befd85337272eb59f8c6a9576193f85da3ede2eae0ee11b75319ca90ddb70b5e2d31a13b12654406f26adbc741eba519f13b5fe9cb084ae321919e09a9def15c3dd588717b7e1b5b68a79aceec33a6c478e39dc4021abb21d53661637dde47fb1f150bd5ca3422fa15675729d975997907d533ce0959bfbf9ef2fd1b41ca89dc286da79746ccd90c8e6b9bd0c105511255667c0271aa95d760f12576aacaa9224a9ec74a4ec4eeeea23f8001b25d8e74f90af8bcb5a24df0cf284410e752b5d34a807ecdee9a8bee5aed07cae3c5651f7d2097247a196ae7e82bebb7a3c282acfab32c2f4fc237f6ad8464b179c6f39a2c9054607f1746b3badb9b8e7b0f33395cad276150da741e7e656725b802a85a10362e2a6cccb3785e34c7b7ea56d38e19fc5ca4646b07ab1649251ad808061b4c023a97b9e6b4b06276319aebc10e3352aad422ad6eb4c481d07838922b264bc41033663843d62589ae7e1188ab31059861bce421cf5b28330b70ae7ee0012983e0620f9582a786feacef464c65fbcbf43de470df342db091326a75e958e6320049d198b293147447ae81aa26a9c16692d2e7a0f71344323f95ac690648b678cb0f328e5760e69f87a5f5da2db1e2edb5f4e3b4361e1fa8fa9442823cb0894b52529b4f40e1fd3baff0d140e695cb5f92b16f967731deb62384ef01b1131e48fe37414292b238d97c63cb014040a24be55f80f7a4062e0e898da4bf2f5570df380f8d9e50586bc2c6bbd9a2106bf9ae79ed87903b2e570e55a1119a500c5f728ea0bd990e2bdca48d64f082d4b449066904e4f6556d107f24c754128c0aa9baf755154667af21aaaff857e33abf8a2272075f6bc338a3912d7cb35fac8fd2f0c874131b1b8f440cd0cc723aba1a8eb4ea8677f64878e91a6dd98968c2153bef75d1e70b813de0d724de1033a908e88c720ac68575c87a167a8e4fc873a8c2ecc3e2850952614a9a712cc72c56cef133ae8b7757eeecd4c5323de21ff06af4dd838676575c157dbe9fe790ec5a6a85249048281f5f10f12ae9f35b4f9d8a133778fb658fae519d58c663552f1ff268afbeb71d636fc79ff72256599b42ba9a1c05c9a65f34bcbf793dc430be58457b9263c12ed3ae31646827f0307c7af5ce844b29b5f1bc88abaa1b487f341f83e5f67a1947169fbd86d83f2b4a5ced6e69fb6607abcbb85c916e44831418eb81b96859ef5000642009a4bba324209597eb5602c4754167efd9bcdb764b44d39a3d8595d779b8fcabec21c3115954fd3b07052c72c9a60c6c7b321c3ff4aa6e4fcffccd962d4b551ee36e18af5c16b2e9ec20fd72a47489d189e43a445ad0e223e026b12d8b15df1dcf261ccfb9d7952db5e21c432d3120795619c56c9d71f8dbb08c136bc54095b30f3804c4336c54a0da0d0343c2444a871f65cc443c893bf1cb2812f14f92e88154135e83c0227fdd95e663830f1e1922b9cb5b429ae420ad4ed7d5a08a56e4e68733eabcc316dfcced14a856a32f73f6342c7d7a6a4e9b72328579123244b04e8a607662f5da54749bd2c4981b0b11321dc37240234c56d6eb6380e975820602dbc3d5c3992f23303c2bf3d9b5c3ed5de1a376bedadd82a863f8dae8b3abe4a2064f294cf815bd41b440d5b684a5880e0386a5dea1fde05d7c08495510b54e2f096a7f7b338bbcc547e370770c479518ce3ec7fa7b291498212b2c286ddfb6d4191b8c25e70c0b485816a36ce6976cba18981dd3d9d9a36eb856669e90fa15f09a97451766da1b6e13477cc796c3852c585a331b4dea7dc9dc582002dcfdcd5eea89c3aed98cbd4d2c7bf88fa82614dfe4eba9a68110ec0916a127e0644f85387f691d7e616bb2d2aa52603b1c7b6692d980bca11a7a667e78d94adba19f84831fbf10cfb8aa07ad07e86e8a16722b4f75335bdb60f2fe39f641eb00c79704cc540afa1801c44a4d09f7fcfec117f11ccc30fc51e5400e17c5398f263e6bfcc66c56cfa7023fb8fbe224ba8f5b0d37091f6e3becefae96603fe07fb72b01de7e552a5e22f3a15097f0fa5b7d980ec83e56b64b4cc52d769d8d543472d233fa4f0f38159bb45a640ed910e1686d175eb735765c8203bf3b9a3a1b647e77537f08a1674f83cba7bff12d25c406f5c849724d7f05a038179dc51fb896c8d7a973141d6c7e7ce6600033eaf63b7981d7c51679012f500c529c6dae4e8bf445049a75b0a6aeb6c886de27d9ec6d699f2861877c6025675d7567f2c417613c1787d40937f6d74d9c0a1c69a39ba880a084cc22210d5cdbf60867a66b1a5726d741e5a1279aa030a9c7c85bff620e739494dd4a32c72840a4c90ab0947a26f7cb24edb33ef1385f7ca7e1f3b572f90a5fd14703205019355f8bbcb374349c60e718f391cee24a12eefa8a8a66f587c19953090a7b330ec00002a86ac2c29714e55829f7c3be161c867052b093f678b57fa60531c7144540894059b4a8ed6de7e4bf3698173d897f0c833a93919517ed68605f826e549784aa50e716c4008c11f590c6b36c1fdf009b19e6ec7720e0980aabe70b2b2b092adc6ed366239c0f991e43017fcdd4813ac3c9b19b4aad13d5f283891fee0f03b41d00fbbbe41728392b554e00d33c404f278af55f930b968e4e8f91d6d6e27a3f0ff55656efffbe5c213c3910028bddd7fbeab58639e3520bf1a961c936cb94fa140819c3f128665551bad58b814bf52e51d3cd838f1634d69287899c2ef95aea7fe49de70d33b338e5ec40f6618466e662a75cd49c5a3c112fc9aadd281f529ae9530bbd8a45c752e1092185805a4063413be8fddfcd4142f8e8984906024bf15ac6501988398f799cc50d1cd11847ec5d719dd85bc030efc0d8be585607cae7b6bf39a6d0ef04c6c7abe994bb23c9930b994c71bde4e25123638e7eda220bd3685611a8101dea1986dd86570d90c44d5c79a3275bd2076e468e045cc1ecb109f31672dcc7de005dd640d3b41d2cde5ac21f0d50a6407877abc7134d491c8e12662ab7edf004a6b972c3b0310bf1c81962f70566773365fa8c52a4c7841fc665fe8219fb901869094f41785c397698786f0054c152500f075aecf85dadd31775aadb7752667800a8d117488db42716fc7b5b3cd9e1ddd364c6d7ef7d405dd41fdad345dbb71eff6b18d65686b1dcb6e9ba266f793cd899d7d5a64874487598f2fb12b886e0d6feed7fccda556bd0d0e194cefbdd08792a793eb9409ad40de45873e07f1345f59848221d67478a7b8cac0733e621cd75794ca4a6a101460e0461fc00655c321945e790cf471011df296fb7cf49df3e3496b6bda487c7c1c3451fd671a771b499bb501020a05dd8ddbcc38f8e50b5982372a8307f86e70f4cf231bb0a99599876309533af7ce9ea9e316cca3697f167e5b3a950c189a4547c02b8e29c9440688c2542213aa3bebefa0c7243dc22fcaff48b474d1f027f3432fe376166ebd2537edc956ef2b87488d11ffe0247bc70c3412f6d3bf2ad1ec6affe55c420f376ad20b7435f76ed04f1f2dd971d219c16189b890ca8857ad0ea70f5f9417465809b9bcf371f5088cb402d656be13e8288ea4c50c4604742325ade33326d938f99ae51bd9eae96ddfd6da6e75b07966033ba4fb068647c5c0a16779e118cd7f373c35b44916c3f33e92b0f350d9a30424b831c8a3d6880c79209b7d9edfff061821989cbe749998a4a3c5a1f7d98512afad703634536a3e6c70ff813f1a344e2cfc52ee49212e11fc6c67275b3c3faa9d7e606be8558e5e345ec21d43f4570865b438014ab95db9b9e7e4c7425d4145aa2f5021be20571b1ad2bc4096e81913097afe71ee7c0f905c3174cee2a0c87e017696a1705e4a9a0139c1bb229d5b0f60c628f12a06edb1734070459007327ad5cc00dc13dd01d1aca80455a3cfe37a75f723c835f735b30363b1effd399e4a24026ff1d4d645a4b0b133468bcee404651e8d1c17e9dc74c9cc34d8827a2c09ecb092c96020637104</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-up">
      <input class="hbe hbe-input-field hbe-input-field-up" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-up" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-up">æ–‡ç« å·²åŠ å¯†ï¼Œè¯·è¾“å…¥å¯†ç  ğŸ˜›ï¼š</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <tags>
        <tag>æ€»ç»“ç¯‡</tag>
      </tags>
  </entry>
  <entry>
    <title>2023å¹´ç»ˆæ€»ç»“</title>
    <url>/p/c262e439.html</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="å¯†ç é”™è¯¯ ğŸ˜­" data-whm="å½“å‰æ–‡ç« ä¸èƒ½æ ¡éªŒğŸ˜­">
  <script id="hbeData" type="hbeData" data-hmacdigest="ea2f9f5ac855cc652abd69038028ad2d1850a2808b37809da7985720438875f5">601062fcdaf3cca9d544423806934044380848aba583af6c1ea7ebc532dbcc8f340269dd12e0c82ecb6ab6129d2c267f6a1655b313d8138a384834ba57a3ee030099cff01e069a2767dc5e3564d4a4f9fb12970328d75e98526c0039bde92416278e5921153eb1700efa4211701105ad2b07eb5cbd08a4b69c1d75d53c76f8435bc949c4b3826f4dd6adaebd5d4ddf2464d5939f95300bcea5eeecd552f57a3c4b13d63d5d198d132202ff4270b41e6df62495fbe25ed52491201ec7d753e5d018c0b5425956b4d9682e69ffc2bbbb086027e0bdefa10b831379bb19264528476e8dbaf45c22a7885dc15c7de17bca240335779082a8e27ca246f2b5381e74b2128bb0ed62de5f7acb0acc01a8365b93a0f873ac675a1d1c10f94592dbd9de72bbb4deacb420e4afdb7e7c7c2426b94e6ba7e00cb60e0fbd3e3a22f7f6ac77914145ff6088baea684f2cf29479d6063c349edccf821c6581a24190d46e809d6f7dce3edc53786bf9ca82e46243505f5c078e9455a8115830532c95ea3bb4c420f8f884b2e9e0685644d207f0a54ffa910cc90b511b1536c8eb3e996801b1f800b652788b286fbce2cf03313b830025ff661452aa81c0bd440d514af04eb19fd6d758565eb3ac238378342285176b5612eaa5f0eb359fe07290cac3e10bdbaa1d3d14ad94ce41bf10ba951578b0b1f6e034161e501d325e9e192efeb74a64b0211dbee1a78d0a8be64534af53c2e47e595ed567f8d35aca9541cce3fa717d9a31552ef5abf4bad13f0b0a4053b7e7aa367e23f44c8e90d4b23159c1c95d76185b2dc5c5fbedec6bb81efeca27f11d916d4bda25d88f83d7f8011a1ffa63a4f25f2dadac28a069ab6160028febc9515ed18171cf1dc67bc5eb2b9b980a0deacd8927143c8a88f23268e2865d1431df7e7d66cf69612e0081e99f43dd0af2aea325c118bbd2ea6dc260bec1378146f9d04e538e7541424304444ed681b7933cebebd630c8b5da8dff894e07881ed4ef4ac78e6da2ff26ff010a9bdd5ec6d73b4a51b008966abfe2bdc1fd1d39664bd2cadeb635decce10f75302d15ac646152c105eafeacf222340acfa39996d32f03737e1eb8a4afac8321b4eafe186c38e351103ac5c631297ad8232971eb7503784bf4f20fb31b7e9af1d5c1f86e2ccaa6d4d7498cccf04d511cfa0d22ebc268a21b900c13412eeb530ac79b7b5aadee4bedbc0c59bb884804de36d83ef5cf15183eb90cd49ed7babb572dae6490ec720025436ad6be266ff42424aac6ce574733ce5da03ed3197e1220fd4f09b109e8c3ef839f183bf39680519b359701b3c7703764f5b4f3a20d0a20dffc0a05e3389f3cdfdb857909110c71774ae7f531ccd52f6b6908db2f33b5f56af39c0bc5d0d3598575b085261829b89a75e5438fa71043737dde091bfb734ddb4879c8f54f7084919d238408a14257510277f4a25568c355a15590029e5c902bc141629ea1d5fb5982bb8f48262be5ac5582987e486647fb0216ea733c581447d682d6729ff0d2fd9dbe028bf85947113b1f30f9b0f3da6ffc8e463fe0abd98052903978ba86b930c325cf5fdd18904614b4670eba5256ac69f78c118c1e7348fa8bfb0e451191fbd8e49d541e0a151058692465cdf2b0323b56f8e1f0ca75f8b59046772588a3f0d7a83d85516207f5ee3b7df8ece42f7e3abfdbece3ccbaeda6a3bc5786f24e69877196ae539b9297b9335f8f7a4d50652a54f5a3e3a2c7dac3fc8a24e4bdb2c56e29b067a72f7b56e3291dfec096674034fb4258d308f259577ec20a0fee486e7bf06fb233528a8216cfdb993a71be23ad117f1156d6ba2579a9227552da977e24d4e992d535a5364d012ffae54461c2c268a7628fa03e1ad33af5895a8df274ff203ac7f203f0a4e33d030c05a11f67fad5b11dcea6e5f6d8ce986962c07e20cf5a39eaef2956f757108aa142d6e604d01b1b0be3851e81a5a3e744492a03147f18fa3aa5fb090d6e0c581d5d66afeb68f3c3730597c647dec50fed4ddbe2b4b460ae377ad642a474c9fb24bfa7915895331c865666f85862721aaf1d591d28be5e7f251d4ff92a95fe58abac7aba870fd66936364d1cd7369cc53a01c7b78887472a6157089ea2c5a7513bfe4046a67eed97a2e6753dca085aa1408aa800379cea83fbc484a62ca3299895bec1172f5a924f53436e347da6b0f3c8de7b4f008dc749fb505affcf780f40f8b59b3aebb8317e0de54b759ab2ed6d96f0e05c7b783e3c665887a2e12220e3d0bb40bf3c4224b33483757f9cc3e7f0d9e796a5ab1049971b8af1dd172214c828caa5b667e17feb50cafbbd30ad822879fc95232ceaca6c8e2e258448332ab0b0bd74243a4fecaf103f5a030d794273e2c78b04cd9256640a388db3fd59ed5059da3b53a4d5e01704f12964ddb83e94e1ea2baa2facb162ca15878de11120f00d38c0c7a267cddf2482cf121bd4644f069db0f860563b6d589cf917e9aad0d45a37b3e7826912fe8783fdf7878a206de1e9544400bd113bfe0f13a03adf54a3d7e94f0432665217c0ce60e7c51ef4e3ef5737f5c3f4c94a22b4350a769e3c80f6fb9927176b59565b1dd7c2a792ffac5f99695d9fb542e832435fc0bf848b789346656497da3eebfcfd44bea9ac01243d7cbd6c38ea41c52a0d478a1c6d6c863da315e535df78072ed4c42040065efbe1f71dbdeb215bca640cbf91b1ccb064da0eb7da9c9618389a692683c45bf69af6ff163b45adee2aceedcab10723718c10838a12c8b4af65867dfd2ee12bb44e16bebcc5196e19c670545bb1f9df372790451df47b40d99defb230399f98975903ffc629bbc5bd939adc8ddbf37d4b93b97e0f0788d48f7c811916f4cf4814487483748eabc68708f55d14a793e95b5d6b0be01cbee74222b4acbf446266497d1c488d0082d3bdcacc3c8fcbb974634de5e3a832fb2e78b7ce118e53c37dde04f8ba28de32a7d2b517ec440635aba5261ff26f62cd94909376d1eeae1105b8226a8366af977e8d18696cc0ecdf56a15755ed2d9ab766fb065cedc98e9b63cb91afab10a5b38f0f02434e404ea9da902fae9cef08efe21da1f20dcbaf54408003bd0838b64067572bf238a6243c092a924130300c019a64d8b6efdeabfc5a29243878740fcbc645dacc076b5de66249e80f7a82f97e4b5b47bf27bafd06c7bb5743c61ead1bf2f319b41099b1a5e6ea610a8ff74e525a511e00352afea8bfcb39ed64b2a2af490bad1bd573239a503ab74db9c3f5d5cb1a465467e0a7bed06473fcdacc2464da097a4cc712da014f7851ac12e59d6e941fd75c79ddfd461c07454643efe34ae394efb44a57b17c8d7f4c265bbc0f30e1cb163e569a3d394b3de0ecf2df6cf2c8252a55d93066a7dd46c084476af255bf8c6c27515f8e67a9947a4929947b1c9182a696d9e6d05e2160f8208ac4a6ff429a92f9e0134c4c1c5ac3bba85715b8</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-up">
      <input class="hbe hbe-input-field hbe-input-field-up" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-up" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-up">æ–‡ç« å·²åŠ å¯†ï¼Œè¯·è¾“å…¥å¯†ç  ğŸ˜›ï¼š</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <tags>
        <tag>æ€»ç»“ç¯‡</tag>
      </tags>
  </entry>
  <entry>
    <title>é˜¿é‡ŒP6ä¸€é¢(ä¸‹)</title>
    <url>/p/e2c8b9c5.html</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="å¯†ç é”™è¯¯ ğŸ˜­" data-whm="å½“å‰æ–‡ç« ä¸èƒ½æ ¡éªŒğŸ˜­">
  <script id="hbeData" type="hbeData" data-hmacdigest="9cfd6289d799d46391bde4e5c9dca83afae5a56922af8f190a43859cec401086">601062fcdaf3cca9d544423806934044380848aba583af6c1ea7ebc532dbcc8f340269dd12e0c82ecb6ab6129d2c267f57eee27a911f1bc8323031208013d64bfb69b3750f65c40154c2dc6d2768b1a2cd0a2d45978cee8bcd4398ca764b90e43c01820ad85304450b8ed6fac6ca8cd95db6d629b45c99fa15631b23c21dd4a96b2f3657a79c53a29732bfe667276471d2a515a78784629694ff07c18bf1b8bfd3c63aacac78ac319aeaa4bc8795d950d5dd7f6c02737782f455970b6342e8987fff34eb0d1b58624f448235e95b135c7b88236b6e7acbc0f6d26771b724d215ddd07e510d4d2613a9b948f6ced80df83a82ba3d9cbb35529458d95277aaca18135aff716a74eb079577c2fbb3c4b4ad6dafacb2c3e335af7c286a7ab28f1bc29bf13b63d085fa11dd655fbee3221f0236d37f3703323552ae5b9bf1ef0d17b77d3c424a3e657e2ac94cfd6e5dd8a8d73151ef263ce11a36ffb4b5823f580de48fc1281fe85d5ad885da87b8464d63702997f30fedf7a40f5a688668cff9158cfb3623bc78479f8ab9c08beb7a03fd3ab78e6565d28c3597d3e4d1bb4b17c8106494c70c689ae1afed9f5e971bc164f819db082f687784ff257215ae281d9368af072550aaad44d61e79738b0066aeaede58b68628fda4b2f73cd89559024abcb97211ffb15a96669218c1079805fb3ae9fc9bcf1cf521c109d27837573f08f04e4721057b7c492910bbba09a4b8712ef1919bee902411f13ea68b75f378b9b8d469b7a073e553d00c485a09b2de3ddae149644ea9236f494950035b6cb3497146406cf01572acdc288d7e63a05e7b9d4b9a6fa3a644d52def3747061fde2e77bf8f42ab1bb29f7bfa8973888e692b6be8841a33878a84509defca224b3f2d298b6e69841c9b6f97025436dfbd1d365882d5af2fc4ad129ce78633be2e4cef46ef7a19f695293bd394ae0481c92b4baca501a3fac2120a8bfbdda5e623ceff4760d7070ec26a7fe702ce2a8c95eae06bcc240a3d5a796c6c19ed04cc15301df8c50ef1af01310da80cabc91a994dbc698fcf98021defe47b2de112277cc1db0db84419cfe74eecc96bfbf3a734844dbae742f726acc1da8ccd2d85de5d45fea9211211bd8e17188804bd17f7f6c0f2a6a84fda20354b91670c6c530b13fc21ed4c97efe1905061d91a83f5a02e5c5debdcd74d4bc5df39b196469828b33a0aeb2ae11b75a87471fdffbfde070ac5d40056699d4b6f27072dcdb85f76caee7210bed99251aafb0832b3d7e89bdbb1731175ddbd4a85456ad939eb4c7385b5181be70cf3862cefdd73a58a1e758cdb61b1bc936f30d04bf7218436dd32a135a7590e6879b9bb9d665756d1ff72a9134df10ace223301b9c60542ca2494e61054afcfeeb7ef22367d83a95a6b6ec9aebaf0ea1b9e1f4456038cee82f71fb9ba643d682edb78798c26e6b4507370b968d8b163b84365c0be6eba9bc79d50091e40d4707d384752a865ef19fb2726cf711105867f73c51b4640992c7fde2cea78a5d109ee8eba53e223da4909cccf0cdb2af85d86935ca83f1caf7431803b8aca0582697fa62e830a0b262dedc30dead726c9d1c6b763b0747a0e5ad8a784ad6d7b61d97ce41fd26641560ae866da2baf5242c98ee4796408fb8528afc210b9a215bbab206c3066a63cd1467cae16c865d076e89d96612025c3d17dc2ea940cb978e8fc03e454e6fc387cfae2cbcd0c5fa3588633ac0bd45552a763492138984dcd1cd5b442d33a960f575f6ed294e715bb0782cbd8f4cddd532db00ca4f5021968a7c192c7732314ad301c6c29b8aea275624e5c66ecde38680e098f2f03cb8ffa4025ab4fe69cae90113ff371956b5231716a87392fc88d8919fa7869c34bd90ed89420d82f5d5e69ba9efac2725dc8635688d4531d9caea8017ba855477816bd58dae7328e1ca7f2916dafe3a02687262fa0b76ee3324eda0c5f2ebbbc56e481bfb0c01e57a27a3ed8f9581caa9d4447f588030862f066f23cb2646a8afec9a5339b9465d807e53522c278bb307b6b223428e018178bf297a18031b72e25496afa08896a85b4300240de8c92dba3c31267800a34959f51e8e8720df8de6673e22e1e78f430134a9ef674cd152cc0381e87b5802f381aabe5ef4bfd628eccbfa24b65dc130c54973f11698ae9f4a883a51fa587d3d66ad21209a9837e80e005649eafee3aae06f703cc7f727c33ea9a5edba10658ffbb2229619a132f70c076bf39422ea17f5339b116304c72334f1468c7f84d1acc5b7cf8cd1ae3b2dbe2e9d15547474e776a9b3d7b306a98780c2a359716b20f02be1ccda889514a9237d0cd3c125a5351e3b486b26f911dfb080030c63731eb955dad628beb8b43ef7a77cfe882bf1bf123bb3fab6324b0c17eb9388161d919e2c6dee82f67dc4748277d9bc3196a08b3ad7bdd1e34e42ae746ec6d32247a40f5b43836724780f4953641eb35704c77c82a70c4f3eef3c2d8cb2ff8cc4ec76a1d1651d90bdf2732ba319f6729de64c4508018c3834ea856497230ac134501c1eb0df2588475e91e26097a7b2e141077d58f489077ec4c2dd8ee7bd24bb16793bb7165990bcca42a7fa8e3d16a001dc5ddd1903cdf568fc927e416f559bc7e06c2dcaf5e12a897404c289fa731adb9444c8767da65245ed2713dee863b11f508f6385b8ba132c2157abb0943bc42506eb3125441da88a5b1956309b85cb4af9e329ca5f36d72f287804bfc8334ad10e9d940a285b665a4a0afdcc0af74c3b9a7c0fbe0da9ecc60b877fe60e9ba97266a2388e3246a8d81b232f52347e135395eeda1e2ee0975d8f53941cbcb4ca8c8ce541ba42243f4e56f6871906640c4c471f78d847477de4262e491be4986c3466a7753a67b89e4cd34b43cdd0a384ee5bbd485416c7ca47b6d5bccb398f5a35b59e6f37c68ac81b36867c988559a7441c4004ae7badd62552c0688ff81bde8cb7ab1f5bff576db2c7aa386ed28c41e053ff9d1a58372cba421b60476a7097e508c90bcae477942b4925853c247dd7cf70c0bbfc0ddb787c8018f0c4e122b998ba9b922290c81c8dd7c2eb0f379b3086faa0bb24b4da1f6bcee3465284951151e9d50ba07e37d1461d3f2f66ea66260801255439aaf894427774dc7ea24733478648ab0078f75f3bdc8a9341af9f886358444a580518d99ce584c005cf1dbc9b8af9e0c488d1e62ba667ebf6f5c8c0b28d01e5064280eacfef9ff8031d8d6c2a228fbc5f8c48d8495a2369db6d440ee2f85f55ea128d69de66016344660a7abdd5dd0df162aef395a5618f551ff0b81c3218c97e280fda6242840579e707e32089214f100026820e04baabcd97bf7f87752c33f9b431590c406dc2d9b903b2bb63b9f625d5376389ad3ff6c34687fd4413c74e760baf641900c68ca1efff7261c92332f853fcf2bf49d0e5d3e602ab0288c27ce6a309aced258f4713571bcafbc79fd978dcb2eee5d665a5e5d80285175a95b26fe210b178caccd167c8d1b13d5c0625ed9bf242e8bf83ce5bd93670cfbcdaccfaf2a0dda0be1e1b1d86304bd203c65a6decf311bd5f0cd016890678961f3e88137b92611487d2ba90ff9c6914ae82b9f3c2e625ded3f0ae0c8b055e2d04d301c323c7de5b454c6bcef1f801030b0a16fc5ad2bd4ee0e5aa3f63211bc1550f55395f92026a3cff033af9531d3b9e9cbff513573e91cd89d5a126fdb7d0df9ebdebbd5d187c3deae6eafa8ffb7f3cd05db0357f81d26ae26a73fe3e3b4f14e217b0c75e4f1f57edf6f9ba90aa6553833a03ad2dd2451bec408118a2e8bf6abd42efdc2b0b2c2db64a12c362f5deed3a3976841fdbc8e08902e0991bb67db751f11b206426a687996ee25768a8650b61eb20fa6fed0bdcdff16208598aa4e0ebdba39423e1d93689410436e50a3338c8d21ca7d7818e18ac3a2f6045de3cb7e826eb3ef4ac2a3e8b5a21ea86b3a2c3cdc16106ab300a912d2229231c4d8bd926beae9328d1863b73ab5107405bfe51f62d7e39844c939bd17a0cd57de2aeecf0f39b103708f67d3c2eb574f82dc9418971a37be5a8b233c8502c73173df49e12f3e5d7fdfeddb17db104b66f0fd12fb5b54846bc6cf37505684797289096f2f151732da7f656c0bd69fd831aab87fbd90995eb87e8ff8fecef3e32ab586f7a5f57cf7fa4b4cc140ecfba9f211ce1b29a7a7659e87af4b55c2dbc98a5ce0042e811cfa82b580a09907f97c881de773902123a377ef83ed3a6ef783650c86668cae1c6852ae84053f5a81454fefc7fb9d7b65b9b48272e077731d6bf357602e0588032513d0a8fa1cbab24422d501a02ddc72159fab456ae1b7e60796dc5fe401a7ce3e22fd2341aaff96b6907593420bac44b37218353d98f788e48f247cef15ccdc06365db888fa466fb978ddce1a8f5a292dd267c86738b0e8bf9b8a887ae9fa3d88dcb611c398897858dbbd5db4b77b472b9e7b7dc81618a7cf2a913f419208e834948400c5b16e038aedb2107fd024e26d6a123665c49409eefe205915847a5846aaa012d87ec662004b32d199e1f78f8e72444dc4ac37a987478fd2152c8991b4cc9eb3e13dcbf3587aa973ace5e4a81bdfcb4fdd0c36b4d7b7c0f41bd8ec951e91bc6f4e94c5793caa9bb4dc39910b17f097054352c45af226d40478d01da8b196c3c2454d0fc25b795dbe4706b03fda265e03988e98c17d89cff3a6c9567d05644f6449220f11587f726e1c45e66926cc2dcbb6f4c566c9af77e409f780762990e2d390bc5f09677d9c27fb12501e4fa412618d33f75dfb1370dd11d52a73b0f598eab5cd5711c213d9782bb85b4845b2a1db2d19314403ae979739474761a168e198b863bdd6cb5ada9db23dcf7f126be601ec66b92df7be81513a1687cd7f0ddf9015cb8cc2d637652c7ebf841414e3cf8a67c2b8244e2e7dff5b4d0289a09b7419b08227f6f9e2ffb196f0047015e1338de5e564f44c52c8138b6a0f061483f337004ada696e7207f2c7b35471459e42fda050c8a895a044c00d36c49aedeb1a87b5e13afaacd4ee735c4034b6a581be3e15df7a46baff267337149afb289203f7486a7b1e36b7fbbfabbd041d4b45137a9ebf42ad1aacf13afa8956703d81140e12cfc6b3de32d3ab76df5e96805f7dde71a4a3fdfc1a49fc12f3a5851cb8e975f5a1631f27b04639ab759bd20d55524cd5151edb61705fb61b4524571b78c64862045daccd918e7d535e647e5b865a4b9f942b49b258866a4e60e179ba4eed9fccfc98d1dace48da13a4802edfa92bd55afa828deeadc31d78f34bceed1ac508ee3fd1b27d59661d2745175c3452e995277974800d413840056adbd87f0c82d2a5a3c135ebd4f959e1faa5265cb375849d499fd25e2035e92abd46450835ffa5d9806d2fb90445e5dcb0c667cdace20cccb29978767e8b001c149cbf99fe332df7daef93a08a4f77370ae2fd24aed1861f57cd5fbd7264494c2ffbfe3627e43e551cf84cbd63163e6332e71954b2fd30277883d40a30e7a558fb946dfc089b6132b6a2ca353927cb04e71d92403570ed771fb0eb6fe70baffcd20817deb5fef8cae98e644005a6a3f92abc8b9e66f21aee64483133611c19326270ae472f222588aee0901063d60ca1756dd26615a72764a5ba5f9b8c12186b1b7ff970a802748f960b54c5963822232b0fb542005f4fa947e98f2212178cce07200bbc2688926ce59fbb44f2fb3d4a415b6a43042d745a034c06e6fb75f21c31137327031d4a8f0749693f684a1db5defd467c1acfdb6eb2576af43e49df3d328391f769e2a642955d5452746231d9d2f286294c62a107c09ffa098628d8381d4993f4c1d905199cb513df4ea95847084465fb51bc8850f4a205b096dc0dc2c0bddbb6b4eaeb9322ea942da78cc95945bcc69f71845e30376a1831658e5d2e84f96c50ed8e47749b4730f7f0572e0fafc67f3fb8cd26209058d0a6588a53230db45f9adb1f3648ce7e0a4b54416262d62fc8c59adc2c4c57b036cca50cecf864afbcc84461533c6da49ed9a2a2e21b88727e97505af7420851373528cb3a9e8447645be1ac93859803709dc42ebad6c45730be3b418262971f2e7b17e174cbcb79da69540fd6da0b0ba69e6e270f779bc31b7435653dd91ab4aea96fab0f50debf84bc809a2c39ad3cd8ea2dc443ab78b402c417ab13b6eda06d9ad02227d88b114a81d57082d027f75f403dafe24bd5ac34767c48841d98742f9b7f9cd275ffa512c8202618c72b08ade1559c1d02ed8fa7919e3d6803c75313a30712b302e305e9a78e788c7ffe0dae438bb3db569a26c88c70a0ff47ccf99faa2afbc25010694d0f373ffa52104664441d4c52b2fccb4a88d007cfb5e4bfaa17af08906d7371e07d86d8d719c913f6b20d126e93e04348a22bec68aec44a3f69ceea0375cbe4666e55d209ccb4e811d9091b51238e36ee31108c50d8761c363c4a575c9738df2ee3b31f859b5e4303a4bd01dc0359e7955d431df0942521f5a8355882b8e07ecc87e88423ffc2318cbfdd152f619748b7cb0c43f427499c12f914619a1eee12e09d79f1d244673dc79f73c11438a36b14b3cf6a0afbf40d2a0184d9933ebfd25792ed3558d83b9dd559e07c9a9c81b64dc94427b058237d15b0c7d9346df62928b6a78dcf0624d4bf3293dcf48b6ff0fc0727fc97c1cdd96a232a2a4cd756848e08ae304b3f796b15250b297bb5fce47c16fd0ffe9f6f68bfd3a7a361c11103cd4f187e5d2cf4770eefdf967e6d1d5459ddaf69a14f8730635c47cbfbfce0c6e04fd9569a40a367ba0e81c4814c69a0be046c67d60e6c4de457a6a6b8d51d03ea5a0905b39058586d62301af3f7082eb8c6ad8e48eadf42ba46a83e98b58f31ea10401802f0e29ef4d463877f9bf5298404e5476a120d40d408db7c07b197cd887e0d15921da147f0273b2165dc0da856ac61f81a5c63836b04af8d9ab53af548551a5317ab39d2174db8395d57a22355e196319b0a8dc0e8ed23de98b4f4c67fe2ae915482a9f2d1cbdf4ca69675a968b18ae4cc256060ab403e410b918d4f81f9588d42b3e19c61ff287fc960847ee4486a1a754ddf942060f65566bb555f191408e094575d9a7d8f7f5dc8e9767a4cb7af4f90a3e53877ad87bffc3bd1c8e600899491e61526f74efa9f5b828c895c6b7651c3f09f08467472a763ba6db36b1cd724b84074d77c9d79aec3fc7e296a7ef0f795ba19fcb8fc34f9ffaaf6be73df31f8bd272277c55ffdfd169dedf2b8d4bf1cecf31f58ac0f151e490a66a736e1d76acfcafc3052541d2e4ed898156e5512c53c72fa707707d104d77e3f3ef3f91fe54bad8f7904d8d469b741d666e6fd4f2a790e86625b0010a2009fea80c42d4b492ec767f819cbddc5ec3e9fc1a4ab275737c22749e0547218ef39febce4eb349ac4cf40c52662d983530f55e9f990540ef08c3a95d7c06a3511bbf8fa66c8239fe975fdfc90f9334784b3f1fa0b1123cf25156cdef770190b1c24032e57b8ff5a0e018778375b31d7ab35fa1f06e0ed1413151dae4bc9c6cb7432a6abe5b349e7e2e2a209fb0f589a2fa60283bcf7a042087cb608e8fb015ca59ebdca0bb4d8723973fd692e7846aeeab19e4a04c99b552defb85a9bf1601964a5e6d761f4d76c5c65144d9175fd7ce511a151a92bcaeff20ec32293c31206ca265a122e9b334a06e126ad3618be822a8a9350e89e550d0a7731ef9ef82dbeeb8bff35be4f9d647dd01212a4d5a90577f84557fc61de98ddc5a2cae4cc2d6f6891c42ae7e2101fbb45fb86f75f03146f72b05d58f22ec2b5c03172e1d0da973cd670b301a9f3367edcd47018beb05724b0c250c3e2bbc98bb2e8bd4d5e6c839d1be774ebddc72ebc295f5124738bf9b51312ff15f7b5b00cb8634bdde64c4f921dd1e5401e8c433dd1f25ca256029ceb95e027196c5c9f6ed04261a0028837506e34516be2ff5e620ce36a55c610eefa26c0825172af611c4d29dde557b1d53dcc847c980592580797e98b8d8d17ac59925e61e452ac6c2473836f59c965840c0f3dca9891531a1e085a3846084805e6e5c9efa01324e5bc03f55507b14b21275db54f8a7730a01e0955c484302c5d9bd150f6d1435f13de80c9b7ce6f596b4721fac5ad2a96947e2a40ef3eb78b5651abcd070742773ec7144c23d477b0d11ac2d42706cd8534a9008be4f556aaa4770cae2cc3eb178bd15b251bd925b2199c2f34b3a2c943b871f2421845d878f3</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-up">
      <input class="hbe hbe-input-field hbe-input-field-up" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-up" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-up">æ–‡ç« å·²åŠ å¯†ï¼Œè¯·è¾“å…¥å¯†ç  ğŸ˜›ï¼š</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>é€‚é…å™¨æ¨¡å¼</title>
    <url>/p/f5c535ea.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="æ¡ˆä¾‹ä¸€"><a href="#æ¡ˆä¾‹ä¸€" class="headerlink" title="æ¡ˆä¾‹ä¸€"></a>æ¡ˆä¾‹ä¸€</h2><p>æ’åº§çš„ç”µå‹æ˜¯ 220Vï¼Œæ‰‹æœºå……ç”µå™¨ä¼šæŠŠ 220V è½¬æ¢æˆ 5Vç”µå‹ç»™æ‰‹æœºå……ç”µï¼Œæ­¤æ—¶è¿™ä¸ªå……ç”µå™¨å°±æ˜¯ä¸€ä¸ªé€‚é…å™¨ã€‚</p>
<p>AC220ï¼šæ’åº§è¾“å‡º 220V ç”µå‹ </p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AC220</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">outputAC220V</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"[æ’åº§ç”µæº] è¾“å‡ºäº¤æµç”µ220V"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">220</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>DC5ï¼ˆæ¥å£ï¼‰ï¼šæ‰‹æœºå……ç”µå™¨è¾“å‡º5Vç”µå‹</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DC5</span> {</span><br><span class="line">    <span class="type">int</span> <span class="title function_">output5V</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>PowerAdapter ç”µæºé€‚é…å™¨</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PowerAdapter</span> <span class="keyword">implements</span> <span class="title class_">DC5</span> {</span><br><span class="line">    <span class="keyword">private</span> AC220 ac220;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PowerAdapter</span><span class="params">(AC220 ac220)</span> {</span><br><span class="line">        <span class="built_in">this</span>.ac220 = ac220;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">output5V</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">int</span> <span class="variable">adapterInput</span> <span class="operator">=</span> ac220.outputAC220V();</span><br><span class="line">        <span class="type">int</span> <span class="variable">adapterOutput</span> <span class="operator">=</span> adapterInput / <span class="number">44</span>;</span><br><span class="line">        System.out.println(<span class="string">"[æ‰‹æœºå……ç”µå™¨]ä½¿ç”¨ç”µæºé€‚é…å™¨è½¬æ¢ä¸º"</span> + adapterOutput + <span class="string">"Vç”µå‹"</span>);</span><br><span class="line">        <span class="keyword">return</span> adapterOutput;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Test æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PowerAdapterTest</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">PowerAdapter</span>(<span class="keyword">new</span> <span class="title class_">AC220</span>()).output5V();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="æ¡ˆä¾‹äºŒ"><a href="#æ¡ˆä¾‹äºŒ" class="headerlink" title="æ¡ˆä¾‹äºŒ"></a>æ¡ˆä¾‹äºŒ</h2><p>å¤–å›½äººå¬ä¸æ‡‚ä¸­æ–‡ï¼Œæˆ‘ä»¬åªä¼šè®²ä¸­æ–‡ï¼Œé‚£ä¹ˆéœ€è¦ä¸€ä¸ªç¿»è¯‘ï¼ŒæŠŠä¸­æ–‡ç¿»è¯‘æˆè‹±æ–‡</p>
<p>Chinese ä¸­å›½äºº</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Chinese</span> {</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">speak</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"[ä¸­å›½äºº]ä½ å¥½"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"ä½ å¥½"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Translatorï¼ˆæ¥å£ï¼‰ï¼šç¿»è¯‘ä¸­æ–‡</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Translator</span> {</span><br><span class="line">    String <span class="title function_">translate</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>TranslateAdapterï¼šç¿»è¯‘é€‚é…</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TranslateAdapter</span> <span class="keyword">implements</span> <span class="title class_">Translator</span> {</span><br><span class="line">    <span class="keyword">private</span> Chinese chinese;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TranslateAdapter</span><span class="params">(Chinese chinese)</span> {</span><br><span class="line">        <span class="built_in">this</span>.chinese = chinese;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">translate</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"[ç¿»è¯‘é€‚é…å™¨]å°†"</span> + chinese.speak() + <span class="string">"ç¿»è¯‘æˆè‹±æ–‡ï¼šHello"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Test æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdapterTest</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">TranslateAdapter</span>(<span class="keyword">new</span> <span class="title class_">Chinese</span>()).translate();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h2><p>ä¼˜ç‚¹</p>
<p>ï¼ˆ1ï¼‰æé«˜ç±»çš„é€æ˜æ€§å’Œå¤ç”¨æ€§ï¼Œç°æœ‰çš„ç±»ä¼šè¢«æœç”¨ä½†ä¸éœ€è¦æ”¹å˜ï¼›</p>
<p>ï¼ˆ2ï¼‰ç›®æ ‡ç±»å’Œé€‚é…å™¨ç±»è§£è€¦ï¼Œå¯ä»¥æé«˜ç¨‹åºçš„æ‰©å±•æ€§ï¼›</p>
<p>ï¼ˆ3ï¼‰å¤§å¤šæ•°åœºæ™¯ç¬¦åˆå¼€é—­åŸåˆ™ï¼›</p>
<p>ç¼ºç‚¹</p>
<p>ï¼ˆ1ï¼‰åœ¨é€‚é…å™¨ä»£ç ç¼–å†™æ—¶ï¼Œéœ€è¦å…¨é¢è€ƒè™‘ï¼Œå¯èƒ½ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚åº¦ï¼›</p>
<p>ï¼ˆ2ï¼‰å¢åŠ äº†ä»£ç çš„é˜…è¯»éš¾åº¦ï¼Œé™ä½äº†ä»£ç çš„å¯è¯»æ€§ï¼Œè¿‡å¤šä½¿ç”¨é€‚é…å™¨ä¼šä½¿ç³»ç»Ÿçš„ä»£ç å‡Œä¹±ï¼›</p>
</body></html>]]></content>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>è£…é¥°è€…æ¨¡å¼</title>
    <url>/p/a708a60d.html</url>
    <content><![CDATA[<html><head></head><body><p>æŒ‡åœ¨ä¸æ”¹å˜åŸæœ‰å¯¹è±¡çš„åŸºç¡€ä¸Šï¼Œå°†åŠŸèƒ½é™„åŠ åˆ°å¯¹è±¡ä¸Šï¼Œæ¯”ç»§æ‰¿æ›´åŠ çµæ´»ã€‚</p>
<p>é€‚ç”¨åœºæ™¯ï¼š</p>
<p>ï¼ˆ1ï¼‰æ‰©å±•ä¸€ä¸ªç±»çš„åŠŸèƒ½æˆ–ç»™ä¸€ä¸ªç±»æ·»åŠ é™„åŠ èŒè´£ï¼›</p>
<p>ï¼ˆ2ï¼‰åŠ¨æ€ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½å¯ä»¥å†åŠ¨æ€çš„æ’¤é”€ï¼›</p>
<p>åœ¨ç”Ÿæ´»ä¸­ï¼Œç»™ç…é¥¼åŠ é¸¡è›‹ã€è›‹ç³•åŠ æ°´æœã€æˆ¿å­è£…ä¿®ç­‰éƒ½æ˜¯åœ¨ä¸ºå¯¹è±¡æ‰©å±•ä¸€äº›é¢å¤–çš„èŒè´£ã€‚</p>
<p>ç…é¥¼åŠ è›‹åŠ è‚ è®¡ç®—æœ€ç»ˆé‡‘é¢çš„æ¡ˆä¾‹åˆ†æï¼š</p>
<p>BatterCakeï¼š æ™®é€šç…é¥¼</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BatterCake</span> {</span><br><span class="line">    <span class="keyword">protected</span> String <span class="title function_">getMsg</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"ç…é¥¼"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPrice</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>BatterCakeWithEggï¼šç…é¥¼åŠ è›‹</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BatterCakeWithEgg</span> <span class="keyword">extends</span> <span class="title class_">BatterCake</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String <span class="title function_">getMsg</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getMsg() + <span class="string">"+1ä¸ªé¸¡è›‹"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPrice</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getPrice() + <span class="number">2</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>BatterCakeWithEggWithSausageï¼šç…é¥¼åŠ è›‹åŠ è‚ </p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BatterCakeWithEggWithSausage</span> <span class="keyword">extends</span> <span class="title class_">BatterCakeWithEgg</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String <span class="title function_">getMsg</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getMsg() + <span class="string">"+1é¦™è‚ "</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPrice</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getPrice() + <span class="number">3</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Test æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BatterCakeTest</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">BatterCake</span> <span class="variable">batterCake</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BatterCake</span>();</span><br><span class="line">        System.out.println(batterCake.getMsg() + <span class="string">" -&gt; ä»·æ ¼ï¼š"</span> + batterCake.getPrice());</span><br><span class="line"></span><br><span class="line">        <span class="type">BatterCakeWithEgg</span> <span class="variable">batterCakeWithEgg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BatterCakeWithEgg</span>();</span><br><span class="line">        System.out.println(batterCakeWithEgg.getMsg() + <span class="string">" -&gt; ä»·æ ¼ï¼š"</span> + batterCakeWithEgg.getPrice());</span><br><span class="line"></span><br><span class="line">        <span class="type">BatterCakeWithEggWithSausage</span> <span class="variable">batterCakeWithEggWithSausage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BatterCakeWithEggWithSausage</span>();</span><br><span class="line">        System.out.println(batterCakeWithEggWithSausage.getMsg() + <span class="string">" -&gt; ä»·æ ¼ï¼š"</span> + batterCakeWithEggWithSausage.getPrice());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">ç…é¥¼ -&gt; ä»·æ ¼ï¼š5</span><br><span class="line">ç…é¥¼+1ä¸ªé¸¡è›‹ -&gt; ä»·æ ¼ï¼š7</span><br><span class="line">ç…é¥¼+1ä¸ªé¸¡è›‹+1é¦™è‚  -&gt; ä»·æ ¼ï¼š10</span><br></pre></td></tr></tbody></table></figure>

<p>â€‹        ç»“æœè™½ç„¶æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœç”¨æˆ·éœ€è¦åŠ ä¸¤ä¸ªè›‹ä¸€æ ¹è‚ çš„ç…é¥¼ï¼Œé‚£ä¹ˆæ˜¯æ— æ³•è®¡ç®—å‡ºä»·æ ¼çš„ï¼Œé™¤éåœ¨é‡æ–°å†™ä¸€ä¸ªç±»ï¼Œå¦‚æœéœ€æ±‚å†å˜é‚£æ˜¯ä¸åˆç†çš„ã€‚ä¸‹é¢ä½¿ç”¨è£…é¥°è€…æ¨¡å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>AbstractBatterCakeï¼šç…é¥¼è¡Œä¸ºæŠ½è±¡ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractBatterCake</span> {</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> String <span class="title function_">getMsg</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="type">int</span> <span class="title function_">getPrice</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>BatterCakeDecoratorï¼šç…é¥¼è£…é¥°è€…ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BatterCakeDecorator</span> <span class="keyword">extends</span> <span class="title class_">AbstractBatterCake</span>{</span><br><span class="line">    <span class="keyword">private</span> AbstractBatterCake batterCake;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BatterCakeDecorator</span><span class="params">(AbstractBatterCake batterCake)</span> {</span><br><span class="line">        <span class="built_in">this</span>.batterCake = batterCake;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String <span class="title function_">getMsg</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.batterCake.getMsg();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">getPrice</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.batterCake.getPrice();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>EggDecoratorï¼šé¸¡è›‹è£…é¥°è€…ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EggDecorator</span> <span class="keyword">extends</span> <span class="title class_">BatterCakeDecorator</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EggDecorator</span><span class="params">(AbstractBatterCake batterCake)</span> {</span><br><span class="line">        <span class="built_in">super</span>(batterCake);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> {}</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String <span class="title function_">getMsg</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getMsg() + <span class="string">"+1ä¸ªé¸¡è›‹"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">getPrice</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getPrice() + <span class="number">2</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>SausageDecoratorï¼šé¦™è‚ è£…é¥°è€…ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SausageDecorator</span> <span class="keyword">extends</span> <span class="title class_">BatterCakeDecorator</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SausageDecorator</span><span class="params">(AbstractBatterCake batterCake)</span> {</span><br><span class="line">        <span class="built_in">super</span>(batterCake);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> {}</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String <span class="title function_">getMsg</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getMsg() + <span class="string">"+1æ ¹è‚ "</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">getPrice</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getPrice() + <span class="number">3</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>BaseBatterCakeï¼šç…é¥¼çš„åŸºç¡€å¥—é¤</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseBatterCake</span> <span class="keyword">extends</span> <span class="title class_">AbstractBatterCake</span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String <span class="title function_">getMsg</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"ç…é¥¼"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">getPrice</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WrapperTest</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        AbstractBatterCake batterCake;</span><br><span class="line">        <span class="comment">// ä¹°ä¸€ä¸ªç´ ç…é¥¼</span></span><br><span class="line">        batterCake = <span class="keyword">new</span> <span class="title class_">BaseBatterCake</span>();</span><br><span class="line">        <span class="comment">// åŠ ä¸ªè›‹</span></span><br><span class="line">        batterCake = <span class="keyword">new</span> <span class="title class_">EggDecorator</span>(batterCake);</span><br><span class="line">        <span class="comment">// åŠ æ ¹è‚ </span></span><br><span class="line">        batterCake = <span class="keyword">new</span> <span class="title class_">SausageDecorator</span>(batterCake);</span><br><span class="line">        <span class="comment">// å†åŠ ä¸€ä¸ªè›‹</span></span><br><span class="line">        batterCake = <span class="keyword">new</span> <span class="title class_">EggDecorator</span>(batterCake);</span><br><span class="line">        System.out.println(batterCake.getMsg() + <span class="string">" -&gt; ä»·æ ¼"</span> + batterCake.getPrice());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>UMLç±»å›¾ï¼š</p>
<p><img src="/p/a708a60d/wrapper_1.png" alt="UMLç»“æ„å›¾"></p>
<p>è¿è¡Œç»“æœ</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">ç…é¥¼+1ä¸ªé¸¡è›‹+1æ ¹è‚ +1ä¸ªé¸¡è›‹ -&gt; ä»·æ ¼12</span><br></pre></td></tr></tbody></table></figure>

<p>æ€»ç»“ä¸€ä¸‹ï¼š</p>
<p>è£…é¥°è€…æ¨¡å¼å°±åƒæ‰“åŒ…ä¸€ä¸ªå¿«é€’ï¼š</p>
<p>ï¼ˆ1ï¼‰ä¸»ä½“ï¼šé™¶ç“·ã€è¡£æœ</p>
<p>ï¼ˆ2ï¼‰åŒ…è£…ï¼šå¡‘æ–™è¢‹ã€æ³¡æ²«ã€çº¸æ¿</p>
<p>é¦–å…ˆåˆ†æä¸»ä½“å’ŒåŒ…è£…çš„å…¬å…±è¡Œä¸ºï¼Œæ¯”å¦‚éƒ½å…·å¤‡åç§°å’Œä»·æ ¼ï¼Œé‚£ä¹ˆä¸€ä¸ªè¡Œä¸ºæŠ½è±¡æ¥å£ç±»ï¼›ä¸»ä½“ç»§æ‰¿è¿™ä¸ªè¡Œä¸ºæŠ½è±¡ç±»ï¼Œåœ¨æŠ½è±¡å‡ºä¸€ä¸ªä¸»ä½“æŠ½è±¡ç±»ï¼›ä¸»ä½“çš„åŸºç±»å’Œæ‰€æœ‰çš„åŒ…è£…å…¨éƒ¨éƒ½å•ç‹¬ç»§æ‰¿è¿™ä¸ªä¸»ä½“æŠ½è±¡ç±»åšè‡ªå·±çš„å®ç°ã€‚åœ¨æ­¤ä¹‹åï¼Œè¿™ä¸ªä¸»ä½“è¦åŒ…æ€ä¹ˆæ ·çš„åŒ…è£…ï¼Œä½¿ç”¨é™„åŠ çš„æ–¹å¼åŠ ä¸Šå»ï¼ˆé€šè¿‡æ„é€ å‡½æ•°ä¼ é€’è¡Œä¸ºæŠ½è±¡ç±»çš„å¯¹è±¡å®ç°é€’å½’ï¼‰ï¼Œè€Œä¸æ˜¯é€šè¿‡ç»§æ‰¿æ¥åŠ ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>é˜¿é‡ŒP6ä¸€é¢(ä¸Š)</title>
    <url>/p/fbd38884.html</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="å¯†ç é”™è¯¯ ğŸ˜­" data-whm="å½“å‰æ–‡ç« ä¸èƒ½æ ¡éªŒğŸ˜­">
  <script id="hbeData" type="hbeData" data-hmacdigest="54fd2b57b17898e20525652ecb232f8b8ee3615831676dcb5ebd3b35640dac13">601062fcdaf3cca9d544423806934044380848aba583af6c1ea7ebc532dbcc8f340269dd12e0c82ecb6ab6129d2c267f19930d1cad310be292dacbf7c3bb10f16951166737e2f339a4d4b2a2a88c7e34572c8268254c43f2523a1507507b1aefe5e70ceded1ab04260c9ae0d4a5b0047837f524e8827e93f66d1dbdf52747ff2e63741a1c6081766a8d29816ef1110eec5ae027dd889d3738cd04c3ca1c2aef5caa086965616d5d69480fa7c34961f8afe854b20c15c3f674a4c64c084bdbd9c9671f7260df7939a4ac68f614c57bf13d78c825874052ae6152058cf0e0d700890ad4bf7ef0c9817797f3a09d209a34083982778623a343d352806cca06eb61ef4748e58295e70a69d56e14313ea2fd55f9a73323be3cb7a991991531eb85bebd19e4857726321f934785d90b39eb698474cb6bd1e0f7adf8700432c4b24c557e1289b2a7458263ddc3b4ba90e27d979e1ed34f98b14ff9349df42aae4034ed2e73b5af45d8d34c5c5462e7eeec599b5d197a5bf20f31bbf2f8b21e422e72b285ca08d71052789796474598652193f8c3f705a2ec1f076d7e014f6aafe72671510dd44b54e4bf992af12b7a32f0eed279aded56d1e516f29a360809773556fbc62724adbfb34d0236d31d9dbf4187bad1515f6e720cc8a14877771739a945c6d9da3a68b0ffd3eec9782e17df91d4bf38f3162981b340fab44b0b789b09278490eb2938b9e4504268b677389856bd3270c2e1f192f908df2374e3b72158e4ec068e89d641ecec0488e2af5776dd853bc50df92529b445a3f40cb164e6475d4654fb8ac36d31d4ebf181798325aee1554fa15beba13cfaea4a63cd4ae2cae3432006ee4ee00288f8f20981ae77fa03bdfbfe1d2849124c4d415d241234e3d180b2e89dd56119f4bdeb3e40d6d6eccff6184b9df610a59071c70aef808018e2cb84b1411a3a885a06fe8d6245b1107b7e419805f9b477740c1b67417f081186cc51ccaa26e57e8c0ae7bcc5dedf83c1a7b386b40bd60ee973d306feb9048f791f731f38e363df0cec2e27ddd84a6bd70ce88a803e410dd3ad126603f25bcaad915df396a7f41325dc5ca4a96d3bd1ebe376f2030133a653089f15e18a3fd545e90727d5af1619762a7c9c096bcd0a72cd94ecde4cae7a6b2597f9232e1dc204607a4cf9895fd2e84d15dae7ef097bedc874b2892a44820933cfe0cb19b0b9ffe547afec9eb8643fdeef89453c97c8651d2a3f94083e8e92090a59908dc44c069075195c21d1ae521ac5127998d67615ece2ef987b67bfffaf1fc50093afea8a8120d1cd5593d543a3d3947e0111373bb5ed9be8f6b4803003d24867e7083667db7c4ee6494929ac391c9f18efbd7340eaa6a7fbac488bee7f5102d488c4d203ed4d8dc42f1a9413a934392cbd8088e4378bfdcd2e54c28ca545b262a887ef72f9eb20a94862d21559ca6eac77dc4e9799ce728bf3088002db7849caaf4100eab22647addbcd0d8c754dde8f19f3596595711b1cc1077edb71c8e6dfe4989ab7c884565c96858d8a94a7f51bce681da3e3b0053f99c05f089155c904757d89742fb754f6a0cabe12e94aa76a21c545c49250edfc74ad17bd2da7ce45c314592c8ed3cbf6d3588c55b63a22df4c123f85e23818b0377d872df7f6d616b93b72b497da7f48d38917b5fef2e242eba3f227ea615e88e9ea5d38f0733d4fde128e4da328b79af0ef8217d56eddfe902fda1d31a29194769d2e70fc6406b8201a20ba70f298731f184ade81f81fa6a5319f74b91dd61f2828cb5058d341d8e5dab50df0050282203088fd0ed12bc106718a1e7e20ec0e50e3f983509012dd52c50967b8341bf02616741c09aa800afc9757217d8e129bd113882341c21632b570627b29f29315cd9131a44c06ae19a1af5f145cccee9db777b3e278cf8f74c66e647059270f3355c0b8cef62d6eaf083bbd9cb6bd050caeefc7b1cd1213eab947719177024b1462fc585973266d762882ad5d83c69d0d5dac10e1a3fc88807bc3298937d0abd402d93596103f2b9befefc99a940379bfc5f8d9acaa314a0a7b893194efa25ed154f663c1f40881269976679fb533a88fe998b74b48759c4e56f2d7273b4f1d1821ab2059e5d30470d803b2f68b3d76c3aca2938d064af47cec354c4ab847f7e17c8eed33884574c3ed190e01377f0795a3a8be92cad66abc965d65d423af946c930774965794480a1caa98f89572cbe0326a7c82266fe8be203b9f90d2f5efe15d9ac1025e36ee39cf51d6438d5b42bd399b64df2d56b486699b7948aab55c7bee51d21669d307de826b0f6e7fd20cb258aefc6f7ae1e36a68fe09c87e4d28f923b0c5d9f2425cef6e1758cb97eb1b0a14e058da1bd01ea79570b881c7967115bea01dc46eb71393c4e3806bb755d96b1bcb4410c58c864600c659049ca52c55eb6fb2b4cf3ec9247f7bb500d22004e0e168c60abb6619b7128b2db96171aa031ab59264389f9ac086fb6683e341762a1ebe2ed6e428c7c8e57dcc084bd2071eef862452ae7abb349aae37cc762b2fbf61c71c06832b331d8b60d912786753854bf1d6ec7b2c67d81719f71b6d8b0c499359ce4429493680816ace8b99adaa9c7d5792811aa48efebb90d63e9ef1732ec686181b154b5f2245f05526f106c7c9eaa2be4cd5432967f6f8d4e42d548620dc1b7ac0a25530a33e5d6cc5ab5858669ff2eecf934e588962c1fb792ce52b46b9655697f2b05482fe09d3ae3da3a88495a22de6252fab22fc68167b9bc22b911d49977a350a00258ceac35ddb684b3dbf3b4f17c1ff1aef2651497da26a53582047c5d707263ab6393cbe58ac1afabc057b6b536da408ed0d1fac53c9c93a54d9ea0aceac4240e3206690fe5b85cf93ac6d7c321c9d25c3cd81983365cca615207140ca2213402bb82bc1bfcce471f97604fab3de40b430d648efa3b60c9a8f6be5cfd7f89d04ce6577008814a89a33a6023491abca07c71e1d21a4370dceafde11dea34abcf71b2c40a7c6add82f60763ec4838b8d33266203d26d8c27532758460139e0274149f85f5353f2f79b074eb72cd89295c36ed350ac999055067a88a086ce9393e4d06066e5fc55b61a88b6cb3f52c7878e44c8176281b54d8b82dfafe67732b685c2e6f470d8ec556c82fcf29f433e9a54125d03ffafe162f4aa83b901bcd286644793f19179f3d549d091467c05cc2fc8155ae3683a7600de0bc4b687e78d5ca6783f5b58cf6ff643bb9e0da0c0bac641e0c8af34c49544392a621245b5f7608878f0f5b14d5c3ea421af6c247e9abea9b95ed27836b28d2855abb43f1b50a624da9d426656f330b0104255c3b79fd6bf868a50b9d8e6f400a9b34684d64c3555788db686b0abaaafe332b581c410e5744fcfa468a3fd6b5afa72fcf76c204b972abf8911010e4b8adca7bc371d09f0da1c63f6d44419d20894e57cb40ffb2e87debe5bad7860815731140e6ba4ae10b8f5e22d6f550a801b02debb05373fd5af8eabeef3e36ab0b6501138b1716d0ea02038393f5d387d01e5f4f866e4727592c1a5d945f347943757e3e6ab10a231d6d29b73085630ba2114acf7ef414eeea1e220520498bb0e951d213aabdab11c5cfd70868e389228342e075600ffd05c11e7b0c144da8cbfddabfaa2ba1194b9641443018695ddfca5fa11ef94962b44a111fef22bf15b2c5e819d17b33ed13135091b7e1cacf9680b3fc9ab1aafdef8a8c314973431fc4eb3e17ba9a1a594b9518c8213099dbac198e2a00aee943cfc0fc4b91072f306fdf50724a44b6a1d7f8c903c299ab907f6ed00047defefe8e3a23018325d878615c6e4117387fe8db47645b91bef582cf92099d6a8dfcdc7c80ef2bb81650c962fe8522099e070882eed4deb3fa0609300ce51dbf5ba7607b68dfbad3f81b95f98c42ba895e10112693f6b4337ca630cb7e6b7e65413f088e7ec9a17e6a03492a41bf0aa4bb1dd824d125a4860c28afa17dfcc00303ea67c54e8024043e9e7b636287c7bef2d14d34859db7b1fbb1fb67dc16629b6c59f2b05d38d5558626c80a7236df8eae88a423459c2c6e2a62a16ff4b1174cf49645bcb50340951b02ee810326b280863080b932e63b6f25968522ee82e47c22703afd6fe4a750b328df43f092faffac8cc0e5b1848cac9285ff7053e4995c1b505195153461217f7ca614dcf035a80577144856feadee335933a9a5fbf97947cf4933af6dc6b4023bb3fadd8ddfb93c8640d1d0e590ccf8d36459d7e98145b8a83aa245a3ff8cbc56276043b55995fd392c65a02f53cec726bbbc4db4b329ae036785a6b8d6ffb183f09bafef83572bb1b03fe3664dfaf64805627c4eeb11c9a86b21299ae576b82b24c063b4d59e0e550ac8cb6df2c72a601536f0947657551b3d4a0a7f1a21cc16e0f802851e66b26a613e6ecc20ee047b28086a198591d11ef5a673c311aef7e8f6b78b1e09b794d4960050e8093c55332187b5816d7875398d1b3195011f5643a8330465d093f656fd796e2f43ab24f74fb6d3ed148be5f44a7aa9d100ce4d41fdd2fd674ad5b71d3c631e1d93d57c78cac3a10072d7fcbeadf21aed317ab47562dd83204cbf5c35fa73c359e634ef81d70efed150ed8512d62f228bce52ce5525038a8fb9a66d8a7db4c3f3b21a94a7b78e887428f5260179e3c35c5c7dfac1e8aea717963847033cfa8150ac6add2493aefdd6786fec48d08fdd0b2b86f5b8f5b25d9752015ebb804339bc0a75aac0496e0f7ba521c08d87c3fc7012501511249238bd967ebc645ab2720b2fae26414600ce83276c21377397589850236bfde3d6ba99704a601e3e381121a9430ab0daf44f684cce0065851076e544cd497aece9ef3dcf4fc29e4b470f3d1a5889e4d44a37660b632df9a876da9c39a4c15947e5153b560d64ce3bccec72d9fee9ea67225812653dfffaccdde696f49fcea0bfcb6b7e98546c50779adac78541c68974b33e354fe028da6f3ade242aac8362da45f83cce07e0da13538abd586521b38dfd950d5cd52f9dc25def3fadc5137acdf0d8eae2ae88c4fbb08478c7082270c74ca65ad287436db22e799becb3066d10b73d2bdab200c2c538cdc4616363a66a9558db30e6c8fce4f1a78c5c04386c0737f1260a3ed2b712b979021da89027a1945f7b38fa198a9631a0c0a275e69350aff58e11246ddbbb67a9aaf8760e8b68541bd415b1172a6c7cf8b96f70fa00bb235181c9de8a2b7e47b9c4f6f57a4a21a67944dd62f70a998d420be13a06f1aa390831a042b5369af5d6877c5f40aa0186f6c3b6b5dcdbe13675ce293371f6ec282a7fe0605071ca813790723031eed180dc132995185711d216bf1586cc7b372d5b8bb11b11dc7b1f33dc945de2317cfd5c47157d4be5ccafbdc127245b4899c60e38c134fc185625f53c90ac016ab01d1958cbdb3cb66e7662ae0103eda0fbba6baaa242898ef8aa5fc53f351a49b458f4dd0dc6e72c276045ab137433cb07c4b7135cc6cbbc0d8ecca5fae9bd0b762862590d1257670e323a8077f3448f4d40c0630abf034d782dfef77008ba85952805a2169790e98f8026c82774c21b1a853437fcef6b3d605eb176d73b13c6405bd3d4d19ea532cefbc0665607872e871100da6f2f1f7146107a4f1ebfd51ed88dff47de321d5889c1d2c846620a8186c68225116f1e3d41d05a745f47bd2c82030bd7ddbfb3434576aa39a0de020c8cb9423b315f65a37d2509aafaffd08c211cefdcd26d01f9633a8ec7f0fdf25ff6800a3c33fc4fc6867e8496f53b99a35268a0b6e73b1055a61a2a090b25ae03e2ad9329d14de5b612c4548dee4aeb851f64c7dba438e37c33d9da6d906f11f6f29dc803a431ca2d8ac3c988d36ad54774c2d2f11172852115f04ec107b09d04515e3d23976bf5f51ba134cd21a8947b5a957eec26239c69409b98eebdddafced57c1f0bcbd7be38f09efc9c5857ce963dd61c7d787e879a9a439d9a0972aa08178bedcc03fb6bcc9366867477c77d481b4e3a5fe8d0c220bb167f50013755d7844caed0d21323aa509984e7a4c04edf61e8a71281cb2081e8bad8df4618c66b8c0ab9bbf29d4a6cad518cd5a052106e44a0085c2c5ea532fa7222eb109abcdbcf91e38bfc40d2d3f677f042602304a50168543a0ca1c1c40212a84173e36deff7feca1fda66432b865c92ad68f9014933c9bb340fabaeddc1e470e4ddecc493a18e9af61fb009f60501bfd132d6ee650ad0bab2352e0697ba4f1061cd838abb7f5d8edaba8fbe3ea2ef0b5af84fec9add6555f3e407380f5ae5809dab28b743b0c5bea6910490b08a3f8bc74b1e0ff413caaa65674ca4cf408a2d6e20c5dc60aaca0bc1e89e6b026b0e16c93d05c3b43b4d2c4aed5d03402108b6cf052fc25bb58aaee971d5315dd90b10debeaf3113ae746bcbf5135afdb6dc07c8da559271cc0079b741054f01e688bf706785bf103354756ea78eed35c68e80cdb6a8db5b6d3b9685ca0a68df0b78bb59d8eb0e4369302a466c3f0f4c9ce2ddeb659f0dc21bf33f4cffe2bdbdf75542cb069ebcb81c7c1dada40a2c31728374b6375efbdf1c48cb94803d242b42ed75de2bdcfdf6c5d3589f8ca7981f06d8ea73c139100acb4f83602355b1c0a5ec09c1a4510e58731b8a23ce207f590e23f77626051c0d0edf47714225da1ec01d78460f952842ad86d537692dc0e4fb82acaf6a171c3f76843acd9cb4a768138f0399798a9a0b56ceee421d1af21455635718e265b371ac1c834dbc74e0ab4b76a21402060a622109994325589f6bcd9eee7d084972ea4c80d57d2cc2602882f7f419c2a01c6921fb173a55a49f7638c2e671a6814e32b0bdce9d6bbb39fd60717d80328e4da21daed62e60a15722ce9a196dbd1ad6e621ba348fbc58730546bf7a021e32be668f8dc811bb5f082773d0408e7e8fb46024b9505af4c1b95439ffcef22453630ce9e811baff25ce9b87c0f0f95f669eeee01b08c1e642d2a9c532eca915fc66642b3a847f34222e71410e9eb05341e8533713c5a407ac309246f6e3fcbe037f3c9860ba8d604f338a4a6ab907e1ac002ac0ff2f024ca603bf97204bf52c06f46a7a807610bd0f733c4ae6144541c164d4ad8b5a6a2a05c0371bbec2888d9eb6ab64703e53bb9209448829c0488a0067773b014ceaffcaa7d549d70d31115fe1965635d2e6c139939d458bc4ae2a28e23f82964aaf884343eb1a89fc423b24456d0f8ce50370040951fcaadc40c17a90860d94420863da9202e2773726905ce535ecfae667927fb18bde87a8669d82f19c34c953b9657448a81a4717d423ecbd512508fa1a09332722ec7c044298989df6701911b03095dc3c67591e771176d9df2570bb2d9d65290f1dacc7cdf9cc2500a0614d9d1a766d6db0899288705d7641ea72630292eb5bbbb3e4cc5f4504c496c554e9d418b63288535780f658205b643b230eb7b1453d516a6439cd931f20a7b944bc8cbfcb96c382f2c26d6206fb3cd5dfdb56e59c05ceed3adddf6e886df0d8d9c6b37a42c9f3cf733d1049a4423c52200e837740f209fc7c1f23572e16c7d5975b27ddd01288f1a4ad1f60fd1a06eec493c90a12a987062867c0de32ee50952d20a533b4c0bbb5d6ab776e882f8cb8265bb3dc90d6fccb46cc47aa628b6d89d3cb7ba1e88eb8b823fe2e7a18343143119989f7ac783bfa0e3c45de5267ccc8ad4023c0e6310bd44c9d1b35d1402b59dcd553f171707b170a23b16d05167b59db416697eb3896c449f5ebf8105d3ccda8afb65e2a36b2f692f2db83e075ba388f4403d5e9162812dceb36b44710253c3b4954fefe89b21a4e4dfee524c73873ffd9dae1632c34b707006fd0d2d9474cf7e36c78ece87ca11b072c31b669f50206901e46f4b8a634ca84aa0d03411fee087533f335614f9edcc8bdc1986b434402500a0ecea35402a7771357b8c6581dc50bbafcefd1f8a8961a9a41bc9045f624f1520562e6276d035001111e079d4b1712ad5aede9839aa8077d1d258fcb751e4e1501a57b6fe8ef7abce960877e792302fc3e22d64b4315ee7f6d1d0690e67342741364e8264034b0f82306a3d1b83da352ada68af0f3550d9a82187503bcced1a83d6f446bfedf2eea680eeaa64065fc092c9c07a51563a27253edcb43e1be464482491aa3d3f41a061ccadd98b2e3cb974e599d7a2d3d9278afe817d12e2b058758acda464c7d09ec5a91d3a7c913857b1c9a2a6f8f27e67cc352c4da80fb548857983a12035dd5522de9aef502235785d1aa202524532da1c16470c4a6319ab2debc5795ee3ae0f72fc44dd360ef90c02662b064b0dc87ab4f82e7c34634c17764ca4f9834b92db9b545b859106859b19b260cc3ef2b51832af6c3f419ae9a9106472aed8d8e7e67c92b54d7d8c376889897b373f6157fad1b0e58cd1faff0df70481efd2d9b4c4f950e55eadd6f59555b53fafad7411b08e7dd93bb0f62b08bad59468936693fee1d4272314d8ec1dfd5289f2cdf1a4b2cc9cc0be61bee15e1fb8d5c903df324d99443ef982323a7f2efffc32de49f3facdf2fd97b2fce68c78dbe5225d52008b9e0231f5b63b58aea415b50736b5b3864e5106c80494000dbef9ea22aeb5bd922f76f64ee59f1984d29187c5167f32ce24fc78af193a5bc6968dc50112b8849d1a7e21a63ce6e8e3443de888d012aa8d16e313f3dd1000f174447f50d0281b89c4b18d1b364f800eab0ce213a6a91639c4662f75e6107ab8ae10b3736d342bbe64ada9e73600b3c1652517dffb7293d563aa5d220bf81402a16380867380ea94303423256359798a37df8c87bd21a12580f3b1bfda9665cff416b42d7b09ad40a92042eff437031b34f32cf64d1c0c7c3d9ee4ce2ddda7d524055d849fe36491be42124968992b91a2c4e78e87fb0ca0e31fc8e23520dd07159658f021a3bbfd3531407eddcb29571bd5b05ec7bd94c37353a0e6ca913bd722f920815c5b7b4f077ec9660de2d8ee4ad5e0495f9389d09e9bf0ad23d5dbcfc2994146ba13457b3a469bb7cd84ce54cb556860a7e55d27de6b81894b6a4e42a0f0cbc54e939720bd72af0d9fd273bdf571bfaabfa59f28a6448ceee3519f8808c52e7cb32ad023ff3b08dd6449e37603521a58aadd25f87f9cf17b5e655aac788744e400645ab5396b12e22dffe4313f3f652f22ae94bdc25d44bda169a4492fe4b2e9fd108e1f098735ee1478b657998756ca060294cd15248078998126d68481d6f3be3a3ff2aea1c4cc03ea79b5ce67eb56bdc8d674622cc33e9889c083ae93a9b12acb0de6be61758f7f57658e7766a25e07e1b3faaa9c2d0241ee2aa3c4b767f36c2fea64135948c292163c421c5c32eea9619e9f655ef7a6eedf33101a885d13a806aabfee52f9674dad7a0068d61ec9e3543fc264b0f5f093e70aa868667853d5753418e69d3349b53e512cce5b25640ca373cc2437d6f11dd707ddc2e1a915ede605e529362c3920374380e136c868829a0b8ba231cb0fa9f2caa208c7466298a4c8a8e5c8554aad47929e509aa93b52517c3cd6548d3f65fcbf2578e01c6c62545a82041e282d5030658715028c4dfc379e14b01d4e1f88765bff137d8fcce6fb014c03397820809f8ea25df238c88e087ed347052add438f62bf887f7b437da55b4991562abedfb9e73e90b112c40cc134b68482aad2ac059c9f3d80752e4d07ec184e3504457c30ea794cc619a0727fcc370b943e318a9fad830071765823c9115189c14a3f06def2e3f1a1831613657dcfc70cfa6513656607265b0cb026bb6e2092c06cc477003f4d8d9b8d14740c3afa21cbf9e3a9415b3f1c265acfd8c92aa5b7a31fc0f8ebf343c573ff8284a16cee2d19ffc9489a430d50aa66df90d6d1af9ed320e1dc38bdb73ffb7097f2e19e9bb28209306d5b1953dedd3ced128ba66396184faaf9188d26aab3812ea08a8fe01cbc9aba804e841d5a7d189ec0234a30fee88e42db17968ffc255d3697fe930cdbd28755949633b4bcf7274a2c986b107bb633728031daf81f5f7f1d8eed6f0a4e2c497d68dff91e456f0ac031d349fe7a2a1fdd5c5cb0c96d59795e525a14ef2a4d4a9b6c36052368397c79ac6b249052795f401c85b7588e98a2d1054928a391035f037e4d323100e19648998934db92f964cd8db967ba44010178dd3394fed410eb645c0923e0156096a1342b376caed08f51779a533e8b9fcaa0924fc61d1ad7b2bef2798f1b43f95e3b3db0aaa014f4d3df440ae36aba7b67298a8e00091e71f64ff2cd7d5fa8fd028f2cd34495ba481e83e02185a1c394baeb2f8bb3f8d4803cf74d3556910faf0fd41a4c92dee475685f446761b3151190c6c05080466a2f03e0d3363280d18c33f6c10a20692b40cbd6bbcf867ab213fdd1b25cbcebf1109cb24ac932aabc7b523738edec4487dd4f9b33e7a2889b1249876fcea19fd6b56768f3cb102fecb0c8daba1d920f101dd44bd19515b4c07c3f62badb9362c4a6fb3295fab789555150ff48dd546a42fa0fa52be73f69ab6efd2a8f97997a6abdd657e50eab364f0b5ad046d3da508f3eb54c075aadcf2605b65bb1a877fdfb7bd38599dc5f3e956016b62f04fb62d43bb547ff712510daf282f7cfe504607b979820f534afd9e9e0ec90e661ef99fa3e87d82b7d9f49ba0f7af288ff173ccf98826bcdb29e65de3e83db56fa82497a649ffee8e8f454f37a46d0d4bd7309ec0739552460ad733e611bda5edc6d12b21a159fbc4c8c5acd35cf110be05e4b673a2452a6f1d87da1f5301b9cab179bfbe92087bb1912d3098e83dd691d6b989fecc2351d1be166d9c5b08309422a91150d730a81db1132db4866c8405a9f1a9463e51bdc6f388836470d73d91d5a386c35bbb68a49605ca0857250480799ef5356038b15f39fe83db0e9f0e1cc5877742bc6643f3b93c9c7c41b00d36c6542e0fe5ee7b38f399c98f075f41d869cf5e40a34afc654e4e90ff7ed3f58afd0fb8025de9fe7c77bcccccd8a222420a89b569ebea7cf9de268243e9d9d78a96b4babf4d724aa0fb2df5e29a9e37fb4f87a49f1e2ab8c2a8f9edb9619914fe6ff179f5ac11e76a26d9d12bd5a0b2947e139b3f59714342f9dcfc63ebe02a1696c6e055bc8d17e8eb43775d90c30144d51a1ac77fb134f21dbb360d9bded99144c36631e2cb64518c2b36fe68058e2c43cfc60ccc924e94d759cd00eb9beae41a5861d55ef0c553ee0df1c9764ea5bbc27b3668c16cf3629344740712dba631af0e145aaed75d80103437bed079c8e54f04028b19070f07f3321825a93ff33614be80078a85f91c8de301a442a03fc98954a96b7d042304612c78af4b6a2dc3c43b7c79a9b5a5a0b53957c67f8da263879244f04ef08aaa4db8c0fee6283caf22293250be60ec012902cafe3c9f5bf879bf342c01577de215167d5878eb97c880604cab4ce53d88fbba3db5241213be0fc65d9514709d669dba285a785bf1edcf469993490b423ddb67362857bb5155bd0b1996e5c781360b89798409d3c8488f0cb489e217fc7a65022b903f83ae034c6763f67ed7b1c89a211a0b6077908cf6113c210bcb439476ce8c67433a3731a3d7fae072d1ad75523a3ac1e6b598bd9f88f86511c361a243289418406c7efb4a7bb85186bcfff57de116fd3bfb9005701978558abba8ab5fe10cf657cf0c29bf72ea299b69e7db21e9cbb6bc1011ca068accc5c54f55bb79ac00383d4fbfd4c54b71df0a3c4561a528b3bf2246fed760a0e2e9f47226ff53cadcb0ca0a2a5818e6888c72806e0d1cc42767c3d589c18684e6664e25c35f40216d0f19add433a727cbd0a19f693ab2237137e3222147a74201053cd5f3b92e69c0ab3b38b0992de9c54977ce6b1818dbc99fe5f6077a8c6ec25e7b4716faffadc5d9a6195e453a900a59582148587ab2bf7c3b6d78d279e267614172bd3af743b024976b07d36f989661389048eb13886781dfea7ec34b99bc9b642f42d96f52728b5756145cdd71b40abe8e70c875c58426f1f60b177d612dc712062c0d367f23710eeadb303a2b9cde7b4e2806bf054f65139d05e62f8e06c2582e7d321f3c8f6d88da1a65441fd51a9692a0293d27a6eee8001ad5ce9cce39374c97aff5f6cb29ad6d34db8166eb7edd21bffebd210f8266c501145990b2e48ef22a2386610bb44d788cfa11e6413be5743a0da8162362a2a16e07ea3584491518115d0e97ed97be66153f588673e4567084e423b9506237569068a78479bbf3ed057e1e0bce26742dcae1362862012c6b0f24f4dc83ad9b6314f88c281294db28fe54a5cc00759edd060f2190848ab9bbd73e7d341f73734fde4720696531c73294a49ca3519768f628e73478aba47269a2f9d09d5559db8792cb387a395b0793836495c71b4c190147fec6a49c4ab5e8852bdfec93e07ff2907725ff9c9f7f1d3bee1b401c72c82cd074862d370085ba2cda810428e5bb9c0e272a9b78620fdfb336fcad912215060b1c6f2bf4a79d711bb550f7f410c7ec94d826a9ae02b55030e7917eceeda27b52272218b57da1bd724c4c51c89e914f12aebbd4a185b9f3473aaef114429f45ed6a9e65d94bee0ffe818c1922b45d6626ef3adc1438afd52ee6d402ad82dc963930b5d1c5c61fa9f161f55af1255c874c5119b0fc8f737eb568d50640c334cbe74917a6de883b86ce756257f9c60c5530959f29c8f20072849d6a6e12f8b2458845f1ce04b0f7b559f69e6b1916159ccf75d3dd15de10da9b5b40641dfe6391b7e276fe8b18a2ddc834191c56df783430209c0cc23e7a0dd73f2854ac9e88e857c5f84c80b64a98073f435122c58b20bd5ee5496982afff4c66542d2942eefba8e7c130c09ecd343fa53096d5a1f14d199ce4da224aed5201985e524d9360425fe8c5ae8508995e7d4232359939f0091595a30c6b02ca0070a5c32650038f88feddbf8c9e9e5b3750f24bf80cf24cc99614b30131eeb9bcca4b63008ea75a4e13b2568045af89740786c50133a9bcf8836d7aa1da30ee8f329c4d6d03e4d08afa5148cd3906d5caf705b56d29ba2153ff446b668c32aa6990fd4f8399bbe3a4b1ddf443bea9350995abe0f3d7c905e3377fa2bf943259f9f45cea8fc5244e62ee9f2625d82091d107e9d44c068860104cd1b46c360f14694b4a12e0ac3dcb16f5b18c447a437de0035a78c510869b5547ddcbcc1ab8098428a7a6f86802ee3a0a9b3da10ae0c6553cf6809a16e0e82a1c2cb9c96492fd85ef41596f7b9d463ad30ba40a71023a8add64a5643fbfcca22bf5a6273fa9f7d9af345c63b9aa5c0dd7611af19948d4222d5c2fe3807aeffe9390c4104838b861e1ff8cbe08866b06c1ea1e6cf83f13574bd55343dbdb2d66c1bd6e816204b2d62d379b4a6cf0772c6b15fad6b2b77349dc29c5b92be4d34704cd4c7e087bb1e6b3bd48335f0f9cc7e7261270a5128b33fce0703c3ace130733db8a38ae3ee20b7a5cd9fced198109f86484cdf4199bc326ad9749d957c4fe6aee21d1d1cfe9b026367044e529bdc2c24845864d307e50728bc6ee6e9f207544b8e3145219ca1a2dde6c40ac0824e1684deb71793021f2fd2337698ae6944161c6dcccf4add576af3ffdc53cffec9c2477b687ce64cb96951e0a167e21f0e11d22ad34ad337d93a00c262c9bfcfbf2e4fa7895229dd0a7339e4f49267fb17b8ca1c9d61d39dd9264eff5bf4c72fbe6c8c63f157c21ce48a1456280cb2e69a209e203f6e107b508792aa2296a2c320ed78264dd5e4d74ea5a8f47d2e523dd36c4ac53727cc8125872201e9e33f06bf3acbe8d5d457ac8a8d94e596ef5745e5675dd19b5ff7bb781d11621fb16e7481fe3c21af2954b10138fa8294a551cb64deeee83416c092c14b5dcbfafbe11483a875883eaffd0e7ff20db6b9da2ccf275a4062f503c909212a26bcfb8d9d00ff5914184149481b27d3173c95a68acb706ea68d8b981e306e10892f62c88c322235c0bc30ed4bdd970fb50e8dce43886b1c978f32efa1d765277e7e132bf055eeec17de06ec893ff862aeac11436d9acba3445ab6e0970a2e0649b21856cfae9be4f4f5014bf7e5bcab66d96938ec303d48086da0230d8e6a4f26c27d52d8853e07def1da006111408f8be0b289b793d792ac7d7323d77355e5f4b9632ef362203f8636e0d01532d4fee9f19c3ca173736c570188c2a2a05f278c4f52212a5d08032258487a4ac5fca05ca0f3b9dfa575be4f7d03867d00b0d397dd86fcc451cd6fb2ecd0e0a495fb7c79fb3448254da235695fd43c629166623bc66cd2a8a297157f0224e5371ef712014c7dbe18d7a95e82e0c2c2383f4abec875519d83abf2a148ec7d4e2d22e49d286c9b2dfb43694541494f45f773dcee17816db9766f3240922a0b7028298cdc810a5c0506f3e29cfaaf6205bc9324b1def675201ec130a738ecb9fc76070ef517648e0425d73b7ffffae32a368d719799cd94ca2ef4a5b1023c2613a3718fdb5818cea41efdf3c3279cc183959f1867d3fb55ff38478618e76f6b97740eb273f29c06dccb6856cfc9899b0bde1223b58cc6a3abea1b3fd7e35c8893a916261ddfb30a24e98497f24ac2c0852cd085efa10a8e840cbd304102b204cc856ad0077759dc0472cd0a07e9adec6105d20733730443bc31a49c0a419e8e7423ef09d8aa05859ac59d2a3dfc864b6b96d1a27230da531e8236a7febde6ada7352b41bd3e45539bc488001297cda696f3731c59b8d4ce6b975f2a16f42d28bc39daac2abb01bda00662f26debd0195c0c065c26beba7d6f727cefe073bc4e585f13aa0c1650eef8b4b5d1b979a4e175846b1e9262120523bb8f258ef97e228037f1275a937ca3e238ccb5e00b0d1099da682b0eda549a4a2a7250b50268900bcb89a061eaec629a8878e4eae55c2fcec24695298d9d22b46a714b33b020447ec59acb38771879a55d0fa3a5908882a57bf5eb774f4a57a188e1a6b22d2cef98256db18b8d6f5d3695fb13794426ead8a226c1c0737e8793c26b8b5d5524f23e8b5bbf6cfd8221c447d0c372fd9898828bc2fccef658aa08d70f94cc2ddddda4d145d3d1d03980e0e9c64adbf217ed37b0748604666447f80625381806ae3f61148bc1a2ae85159dc73c468ac02685eb032f35515a3e9581d8281de009236b5ec896543525331b267922e5d16f9f850df2a36aed3d3bc5de735b94ca12b9449193287b8d7b79e2693c562db501850b5f4f6f14a3e24768a479ba56fa82a19cbf6fa0d694b2ca6f16ea45913626e8ccb8845d9eec899e68e9a9360d01dac411598af1e008dad2c42ac4c2197d380c5fc5877ff5cc8e4de2db3dde541fa5e91cdc60edacb633bbf843a76e742c8fc927a15ed2dd640dcaf270107d4abf47ea24dccf9d471b418a2aa4974982002f9f766fed16af7ef6ea4b85e93ef55f1d9e6425e2dc8e696deeb833919cc6d582978ee38f795da0f03adf8596a6314c2297b8734baed83f5f2064e3139ac0ba5a14cb15ed8f913a49f8c603f46c969b573398260b1ec7633c1cbeae19244df150acace231bed525ae2de2e6be66c31a3366e97b9e8a01750a9fec7cb41404b0fa0d2a6b156cd5d7e93627abe046afa3fead9fd656584c282195b15315f5865afdd2a7b02e6504525239e245360c851aa9e87baf295184e29221c9fec6d6684fcff2c2cbb64e0c969d5c923f5686d5bd754cc5d578caca0717f4e22bff615b37ee5a5650605d5c0bfc809228aabb5162ccfff943ffea44971bcd1b2eabf962bf247620f222255a5147e1e4060bf234ca7cfd17e78f81ab306398ba6790b687b319db013afdcdfbfed1d2b96bfc0e2a1796f47fdfffb65efb8cad1cc3c97c04df5288ab608d3021272255326413657894463e037f1a40688502376432442f4415a9f36d6f399d93f70da55477975be7e39014ee951ba1698808b51a51be2e89eba49780721ed4ca71485e323e8732a3f7fe877a2d69cba04fefe65f8c82b9133009172ae659e0e4ff77632f2728899ad99436c2c0a1b43ae16886ae4212e7e9d47adc2210fc54e1798ecedb6b4da9d599336521921e7a0cfc85aa95edab9eb4df0c26f722c0570927907cc18e6ff6f7e122bf783d7efb6772736a1b990e901528ede6333e50a00af44aa3f4f6ab7c9e2770d092afc1fe512e6b1b370b72c546579835461e195289b178e9ed27c95490d867ab08919eac30bac6ce4a24d7c224c48a98c0600a856702999efbe527f9787eb3ded513c40bccc7d41c645b0dcdd290e09c143584e8f37eb93b5a22106600557813891e3430e4223066b491159547ccd81b8d39c944642167686f529e94e28c27d12986e105943da2b6f3b8f854e0bb62508f93cc34c48ea08ce0b53b23e2d0cfdc59e49b4de5033bcf2734775db02fd91d7376fdba27607369bd38dbcb4e7b1ea31e92a5a5f5b44de2ca757e00bf7f84873420b5dc9e96a89bc233360c0e6396181b1d05c9094520f03629b5456ee5c6fbb0a273b3f90cde8fcbe8ea23580e6e760d509f3526e720ee4bbce7cc8ce0b98d2cd7dc2c051580d166eb7ed56dc6eb796c08a03c60e1fe6a0713a012bb8ef0ba3b4badc94b7a5696f61f335d816ff19da095747170494f7ce0b69fb07dcf58f25d806d1c11e2bccc164fb0087d408a9ae3b719a59cdec184e965c8427367cbf5aaa6f246f299d1021997d42dd1550a607f0a895a43aeaf824b9143cbe2d494e549d2b958d990418f33ea2d30802d94aff6c2727cb97bc93c90ebaa71651499905e08ad5f64f1d4ff47e86f9bb233059b0cdcf8c28fae356efe20850baac042a6d0398a793c947fd2ee6d1f0ea474f1500224e3f2e87fb1e65b8c79972bade8a9956244eee653e4cfd46b73199e8f1f3340716e869fbbccff80777c18c73444a994ee6e8ea30264ef088950a2a122fe3d20ba379fb86cb6fca3b311fd8b202cf1b45d0c287bd4505ce84d16fe10243e0d97c0713f45e6a0661a73c3a9dd78d796fec25ac95223ac8da8c5f53b8b0c840ef638b39ec960d44f9149c30afc495613616a0dc0ce6edffe64b414894a665889028917b8edc22ec6d063235a3be8000eb720a949714add0e20c65dcc225de410df22e559b786d8af4c2b3b1e035110409ae5a5efcd8bf03a865ab9dd8a96011653792794ab80e1bfbf7971e57ab47e122010f415fa362972fe3981c12c6b130b60e13686b79d299401e6f722b9d415fd8b0e6e17c4de2d94e4253af764590c5552cbad9eb5eb5a5d429e8b5b5cae79760481ce17b9a39a3bde9d0ce28cc2f94a74238fcf1787c02c2945b1b74fd3e635ded197375d96a63d035e1e48a4307bfcb85d249aa60c38b70be8482fc5d92416fccb62c757c6c85c3e6ff9782e04a182b8bd4e14a44d12bfe30c8c3a2b312d24c3da1e9f14550a32f27de83e6245754b39dd4c935068a36cfc23269a23825cff9285abea11e3f8f627a928e58db5ba921ee4702639e072eb32f0160047a366a6255c3275f17fd44675f9c07806ec3c5f19e97962f25648dcea047ed1588ffee4772d51da41761113a7acc5ddb90731b78794bb4d7a45e8ae7477a3d380cc88e102ed79d755b1407f28c505425bfdb7835e5f80e3dfeb4e0a9907c0c1da4144c01c60424da00b46d828cc9e986a25c57012a6befb027aa5ada33a6da0ec4d8bc1f0f8f23eb58b9753f653903a69516a510f993c8cf7092ace950c7ad86fae0b5e6d211ee40ba6655f0452dd5e837f292ccd0a8ab97e43d4ae604c18e5b95614c2f28ac156f8ca24d94e7c2b06eb1f4d07ee12015eb01d726d7cf9de0a74188b1c14f4f73f5b00422de72e9b36ae30114d9b9adcc0d3f4839347da19bc995c32db848fa63dcfe157073b35da988e29cd0daf7f9a9466fedd3a9f2bade8238b5fea4c489ee1e20e6d5fb6e1f87f214a3fcbe3cdeed5ac84fcea2aa2e080f011bc193ca4e0d9586c2cbd5cc9092194aed689946061f9fbb17339613ee2c72d5b612e878bb7e3acc6ad1184e0b2cf9d2b9437e36a8531f9686e9ed896c4f3f66a179c5f132d361d21e480fffbf2310481ace6bb6c59d523b84dfd5807033ca82b070db23a77111b99944c4537fdad566cf729d5e6ebe30a4cf217171726f2cf6d8e40cbcfde59c5185e96402b7cd15307d4ef9b49afa5a583584132286fe6bdc3e20136ff934da4e9c6a65eb2f9a36b7bb8cacef778104378ae7a669c91bcac8ef48e67336fa1cbbca4125293d209d6d2357064736a56aa44b073e730fcfa3c22aeb8bd91cb25d28b9744aceb88fb2d0ef048ef6f803a735f7bef503d5e8659bb9b3c570f36604d8c06ecfff52780849b5b24b8f6c420b0a74af61d2971855a291858845fa2bb71ce96e14ecd2da52b19e8446890e4db4833141db4dde3c1a138ef64206f3e7fb5228040236f3c57c01a5e7b45ee8950ec5ba98bfb0d9fed04c6ff58e380d9e2cace38bf4f3ee65e932e420ba5ca5b73fe857416aba182f3d3a6324dfc281d586c63873133bde5a31f6fcfbf178009b4b163d55a26fb1104e97682ca1fef45700b7d2060117fb9d7d340f33c5cc0ef8eb022b0546bee8567a2fcb8b0a8099f606083380a7df7758a2ae8f5d68fcd99b5cac2180f8412eba3726dc5a51dd578e6d3f1199ed922105d37a934a42fce8c31c3dc919fc9f6be4ccf6cdda5afd9dc161efee7ec640dcceec336ec986581c18fc846b4db0a28d26d1552f3cf8f7a9b5eb1a578a5dfe520b9cc7e07dfc8abf218a475ef8fee7dddc03b92a78a60285efad69ce74748c1fe6b268588ba75d1327b93405699c4901ecf1dca3afe77f803ae601b59953</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-up">
      <input class="hbe hbe-input-field hbe-input-field-up" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-up" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-up">æ–‡ç« å·²åŠ å¯†ï¼Œè¯·è¾“å…¥å¯†ç  ğŸ˜›ï¼š</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>å§”æ´¾æ¨¡å¼</title>
    <url>/p/3ffc1ee8.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>æ˜¯ä¸€ç§é¢å‘å¯¹è±¡çš„è®¾è®¡æ¨¡å¼ï¼Œå…è®¸å¯¹è±¡ç»„åˆå®ç°ä¸ç»§æ‰¿ç›¸åŒçš„ä»£ç é‡ç”¨ã€‚å®ƒçš„åŸºæœ¬ä½œç”¨å°±æ˜¯è´Ÿè´£ä»»åŠ¡çš„è°ƒç”¨å’Œåˆ†é…ä»»åŠ¡ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„é™æ€ä»£ç†ï¼Œå¯ä»¥ç†è§£ä¸ºå…¨æƒä»£ç†ï¼Œä½†æ˜¯ä»£ç†æ¨¡å¼æ³¨é‡è¿‡ç¨‹ï¼Œè€Œå§”æ´¾æ¨¡å¼æ³¨é‡ç»“æœã€‚å§”æ´¾æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ï¼Œä¸å±äºGOF23ç§è®¾è®¡æ¨¡å¼ä¸­ã€‚</p>
<h2 id="ç»å…¸æ¡ˆä¾‹"><a href="#ç»å…¸æ¡ˆä¾‹" class="headerlink" title="ç»å…¸æ¡ˆä¾‹"></a>ç»å…¸æ¡ˆä¾‹</h2><p>è€æ¿æƒ³è¦åšä¸€ä¸ªXXé¡¹ç›®ï¼Œå®‰æ’ç»™é¡¹ç›®ç»ç†ï¼Œé¡¹ç›®ç»ç†äº‹å…ˆæ˜¯äº†è§£æ•´ä¸ªé¡¹ç›®ç»„çš„æ¯ä¸ªäººçš„èŒè´£çš„ï¼Œäºæ˜¯é¡¹ç›®ç»ç†æ‹¿åˆ°é¡¹ç›®ä¹‹åï¼Œåˆ†æ¨¡å—åˆ†é…ç»™é¡¹ç›®ç»„çš„æˆå‘˜ã€‚</p>
<p>è€æ¿ Boss</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Boss</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">command</span><span class="params">(String command, Leader leader)</span> {</span><br><span class="line">        System.out.println(<span class="string">"[è€æ¿]è¦å¼€å‘ä¸ª["</span> + command + <span class="string">"]çš„é¡¹ç›®"</span>);</span><br><span class="line">        leader.doing(command);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å…¬å¸å‘˜å·¥å…±åŒè¡Œä¸º æ‰“å·¥ IEmployee</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IEmployee</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doing</span><span class="params">(String command)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>é¡¹ç›®ç»ç† Leader</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Leader</span> <span class="keyword">implements</span> <span class="title class_">IEmployee</span> {</span><br><span class="line">    <span class="comment">// leader éœ€è¦é¢„å…ˆçŸ¥é“æ¯ä¸ªå‘˜å·¥çš„ç‰¹äº§ï¼Œç‰¹å¾ï¼Œåˆ†å‘ä»»åŠ¡</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, IEmployee&gt; target = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Leader</span><span class="params">()</span> {</span><br><span class="line">        target.put(<span class="string">"åŠ å¯†"</span>, <span class="keyword">new</span> <span class="title class_">EmployeeA</span>());</span><br><span class="line">        target.put(<span class="string">"CRUD"</span>, <span class="keyword">new</span> <span class="title class_">EmployeeB</span>());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é¡¹ç›®ç»ç†è‡ªå·±ä¸å¹²æ´»</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doing</span><span class="params">(String command)</span> {</span><br><span class="line">        System.out.println(<span class="string">"[é¡¹ç›®ç»ç†] æ”¶åˆ°["</span> + command + <span class="string">"] åˆ†é…ä»»åŠ¡ç»™å‘˜å·¥"</span>);</span><br><span class="line">        target.get(command).doing(command);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å‘˜å·¥A</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeA</span> <span class="keyword">implements</span> <span class="title class_">IEmployee</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doing</span><span class="params">(String command)</span> {</span><br><span class="line">        System.out.println(<span class="string">"[å‘˜å·¥A] æˆ‘ç°åœ¨å¼€å§‹å¹²["</span> + command + <span class="string">"]å·¥ä½œ"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å‘˜å·¥B</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeB</span> <span class="keyword">implements</span> <span class="title class_">IEmployee</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doing</span><span class="params">(String command)</span> {</span><br><span class="line">        System.out.println(<span class="string">"[å‘˜å·¥B] æˆ‘ç°åœ¨å¼€å§‹å¹²["</span> + command + <span class="string">"]å·¥ä½œ"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è€æ¿å®‰æ’ä»»åŠ¡ æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelegateSimpleTest</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Boss</span> <span class="variable">boss</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Boss</span>();</span><br><span class="line">        boss.command(<span class="string">"åŠ å¯†"</span>, <span class="keyword">new</span> <span class="title class_">Leader</span>());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</body></html>]]></content>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>å·¥å‚æ¨¡å¼</title>
    <url>/p/54788f73.html</url>
    <content><![CDATA[<html><head></head><body><p>å·¥å‚æ¨¡å¼åªå…³å¿ƒç»“æœï¼Œä¸å…³å¿ƒè¿‡ç¨‹ï¼›å®šä¹‰ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å…¶å­ç±»è‡ªå·±å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªå·¥å‚ç±»ï¼Œå·¥å‚æ¨¡å¼ä½¿å…¶åˆ›å»ºè¿‡ç¨‹å»¶è¿Ÿåˆ°å­ç±»è¿›è¡Œï¼›</p>
<p>ä»¥ç”Ÿäº§æ‰‹æœºä¸ºä¾‹ï¼Œåˆ¶é€ æ‰‹æœºæœ‰ä¸€å¥—æ ‡å‡†ï¼Œç°åœ¨å¸‚é¢çš„æ‰‹æœºå“ç‰Œä¼šæ‰¾ä»£å·¥å‚æŒ‰ç…§è¿™ä¸ªæ ‡å‡†ç”Ÿäº§æ‰‹æœºã€‚</p>
<h2 id="ç®€å•å·¥å‚æ¨¡å¼"><a href="#ç®€å•å·¥å‚æ¨¡å¼" class="headerlink" title="ç®€å•å·¥å‚æ¨¡å¼"></a>ç®€å•å·¥å‚æ¨¡å¼</h2><p>å®šä¹‰ä¸€ä¸ªå·¥å‚ç±»ï¼Œæ ¹æ®ä¼ å…¥çš„å‚æ•°å€¼çš„ä¸åŒè¿”å›ä¸åŒçš„å®ä¾‹ã€‚ç‰¹ç‚¹ï¼šè¢«åˆ›å»ºçš„å®ä¾‹å…·æœ‰å…±åŒçš„çˆ¶ç±»æˆ–æ¥å£ã€‚</p>
<p>ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>éœ€è¦åˆ›å»ºçš„å¯¹è±¡æ¯”è¾ƒå°‘</li>
<li>å®¢æˆ·ç«¯ä¸å…³å¿ƒå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹</li>
</ul>
<p>ä¼˜ç¼ºç‚¹ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šå¯ä»¥å¯¹åˆ›å»ºå¯¹è±¡è¿›è¡Œâ€œåŠ å·¥â€ï¼Œå¯¹å®¢æˆ·ç«¯éšè—ç›¸å…³ç»†èŠ‚</li>
<li>ç¼ºç‚¹ï¼šåˆ›å»ºé€»è¾‘å¤æ‚æˆ–åˆ›å»ºçš„å¯¹è±¡è¿‡å¤šé€ æˆä»£ç è‡ƒè‚¿</li>
<li>ç¼ºç‚¹ï¼šæ–°å¢ã€åˆ é™¤å­ç±»éƒ½è¿åå¼€é—­åŸåˆ™ã€‚</li>
</ul>
<p><img src="/p/54788f73/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F-%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E7%BB%93%E6%9E%84.png" alt="img"></p>
<p><strong>Phoneç±»</strong>ï¼šæ‰‹æœºæ ‡å‡†è§„èŒƒç±»(AbstractProduct)</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Phone</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">make</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>MiPhoneç±»</strong>ï¼šåˆ¶é€ å°ç±³æ‰‹æœº</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MiPhone</span> <span class="keyword">implements</span> <span class="title class_">Phone</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MiPhone</span><span class="params">()</span> {</span><br><span class="line">        make();</span><br><span class="line">    }</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">make</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"ç”Ÿäº§å°ç±³æ‰‹æœº"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>HuaweiPhoneç±»</strong>ï¼šåˆ¶é€ åä¸ºæ‰‹æœº</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HuaweiPhone</span> <span class="keyword">implements</span> <span class="title class_">Phone</span> {</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">HuaweiPhone</span><span class="params">()</span>{</span><br><span class="line">		make();</span><br><span class="line">	}</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">make</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"ç”Ÿäº§åä¸ºæ‰‹æœº"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>PhoneFactoryç±»</strong>ï¼šæ‰‹æœºä»£å·¥å‚ï¼ˆFactoryï¼‰</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PhoneFactory</span> {</span><br><span class="line">    <span class="keyword">public</span> Phone <span class="title function_">makePhone</span><span class="params">(String phoneType)</span> {</span><br><span class="line">        <span class="keyword">if</span>(phoneType.equalsIgnoreCase(<span class="string">"XIAOMI"</span>)){</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MiPhone</span>();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(phoneType.equalsIgnoreCase(<span class="string">"HUAWEI"</span>)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HuaweiPhone</span>();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="å·¥å‚æ–¹æ³•æ¨¡å¼"></a>å·¥å‚æ–¹æ³•æ¨¡å¼</h2><p>å®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªç±»ã€‚</p>
<p>ä¼˜ç¼ºç‚¹ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šéµå¾ªå¼€é—­åŸåˆ™</li>
<li>ä¼˜ç‚¹ï¼šå¯¹å®¢æˆ·ç«¯éšè—å¯¹è±¡çš„åˆ›å»ºç»†èŠ‚</li>
<li>ä¼˜ç‚¹ï¼šéµå¾ªå•ä¸€èŒè´£</li>
<li>ç¼ºç‚¹ï¼šå¢åŠ çš„ç±»æ¯”è¾ƒå¤šï¼Œå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚</li>
<li>ç¼ºç‚¹ï¼šåªæ”¯æŒåŒä¸€ç±»äº§å“çš„åˆ›å»ºã€‚</li>
</ul>
<p><img src="/p/54788f73/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F-%E6%96%B9%E6%B3%95%E5%B7%A5%E5%8E%82%E7%BB%93%E6%9E%84.png" alt="img"></p>
<p><strong>AbstractFactoryç±»</strong>ï¼šç”Ÿäº§ä¸åŒäº§å“çš„å·¥å‚çš„æŠ½è±¡ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AbstractFactory</span> {</span><br><span class="line">    Phone <span class="title function_">makePhone</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>XiaoMiFactoryç±»</strong>ï¼šç”Ÿäº§å°ç±³æ‰‹æœºçš„å·¥å‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XiaoMiFactory</span> <span class="keyword">implements</span> <span class="title class_">AbstractFactory</span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Phone <span class="title function_">makePhone</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MiPhone</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>HuaweiFactoryç±»</strong>ï¼šç”Ÿäº§åä¸ºæ‰‹æœºçš„å·¥å‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HuaweiFactory</span> <span class="keyword">implements</span> <span class="title class_">AbstractFactory</span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Phone <span class="title function_">makePhone</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HuaweiPhone</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="æŠ½è±¡å·¥å‚æ¨¡å¼"></a>æŠ½è±¡å·¥å‚æ¨¡å¼</h2><p>è§£å†³äº†æ–¹æ³•å·¥å‚æ¨¡å¼åªç”Ÿäº§ä¸€ç§äº§å“çš„å¼Šç«¯ï¼š</p>
<ul>
<li>æ–°å¢ä¸€ä¸ªäº§å“æ—ï¼Œåªéœ€è¦å¢åŠ ä¸€ä¸ªå…·ä½“å·¥å‚ï¼Œä¸éœ€è¦ä¿®æ”¹ä¹‹å‰çš„ä»£ç </li>
</ul>
<p>æŠ½è±¡å·¥å‚ä¸­æœ‰ä¸¤ä¸ªæ¦‚å¿µï¼š</p>
<p>1ã€äº§å“æ—ï¼šä¸€ä¸ªå“ç‰Œæ——ä¸‹çš„å¤šç§äº§å“</p>
<p>2ã€äº§å“ç­‰çº§ç»“æ„ï¼šä¸åŒå“ç‰Œä¸‹çš„åŒä¸€ç§äº§å“</p>
<p>æ¯ä¸€ä¸ªå“ç‰Œå°±æ˜¯æ¯ä¸€ä¸ªå…·ä½“çš„å·¥å‚ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªå“ç‰Œè¦ç”Ÿäº§ä¸€ä¸ªäº§å“æ—éœ€è¦å¯¹åº”äº§å“ç­‰çº§ç»“æ„çš„å·¥å‚çš„æ¥å®Œæˆã€‚</p>
<p><img src="/p/54788f73/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F-%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E7%BB%93%E6%9E%84.png" alt="img"></p>
<p><strong>ç”µè„‘(PC)ç±»</strong>ï¼šå®šä¹‰PCäº§å“çš„æ¥å£(AbstractPC)</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PC</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">make</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>MiPCç±»</strong>ï¼šå®šä¹‰å°ç±³ç”µè„‘äº§å“(MIPC)</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MiPC</span> <span class="keyword">implements</span> <span class="title class_">PC</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MiPC</span><span class="params">()</span> {</span><br><span class="line">        <span class="built_in">this</span>.make();</span><br><span class="line">    }</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">make</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"ç”Ÿäº§å°ç±³ç”µè„‘"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>HuaweiPCç±»</strong>ï¼šå®šä¹‰åä¸ºç”µè„‘äº§å“(HuaweiPC)</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HuaweiPC</span> <span class="keyword">implements</span> <span class="title class_">PC</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HuaweiPC</span><span class="params">()</span> {</span><br><span class="line">        <span class="built_in">this</span>.make();</span><br><span class="line">    }</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">make</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"ç”Ÿäº§åä¸ºç”µè„‘"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>AbstractFactoryç±»</strong>ï¼šå¢åŠ PCäº§å“åˆ¶é€ æ¥å£</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AbstractFactory</span> {</span><br><span class="line">    Phone <span class="title function_">makePhone</span><span class="params">()</span>;</span><br><span class="line">    PC <span class="title function_">makePC</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>XiaoMiFactoryç±»</strong>ï¼šå¢åŠ å°ç±³PCçš„åˆ¶é€ ï¼ˆConcreteFactory1ï¼‰</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XiaoMiFactory</span> <span class="keyword">implements</span> <span class="title class_">AbstractFactory</span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Phone <span class="title function_">makePhone</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MiPhone</span>();</span><br><span class="line">    }</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PC <span class="title function_">makePC</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MiPC</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>HuaweiFactoryç±»</strong>ï¼šå¢åŠ è‹¹æœPCçš„åˆ¶é€ ï¼ˆConcreteFactory2ï¼‰</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HuaweiFactory</span> <span class="keyword">implements</span> <span class="title class_">AbstractFactory</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Phone <span class="title function_">makePhone</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HuaweiPhone</span>();</span><br><span class="line">    }</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PC <span class="title function_">makePC</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HuaweiPC</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
</body></html>]]></content>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>è§‚å¯Ÿè€…æ¨¡å¼</title>
    <url>/p/9a246216.html</url>
    <content><![CDATA[<html><head></head><body><p>è§‚å¯Ÿè€…æ¨¡å¼(Observer Pattern)ï¼šå®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šä¾èµ–å…³ç³»ï¼Œä½¿å¾—æ¯å½“ä¸€ä¸€ä¸ªå¯¹è±¡çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå…¶ç›¸å…³ä¾èµ–å¯¹è±¡çš†å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚</p>
<p>è§‚å¯Ÿè€…æ˜¯åˆç§°ä¸ºå‘å¸ƒè®¢é˜…æ¨¡å¼ã€‚è§‚å¯Ÿè€…ä¸€èˆ¬æ˜¯æŒ‡ç¬¬ä¸‰æ–¹ï¼Œè´Ÿè´£é€šçŸ¥è®¢é˜…è€…æ¶ˆæ¯ã€‚</p>
<h2 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h2><p>Observer è§‚å¯Ÿè€…ä¸€èˆ¬æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ¯ä¸€ä¸ªå®ç°è¯¥æ¥å£çš„å®ç°ç±»éƒ½æ˜¯å…·ä½“è§‚å¯Ÿè€…</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Observer</span> {</span><br><span class="line">    <span class="comment">// æ¥æ”¶è®¢é˜…å·çš„é€šçŸ¥ï¼Œæ‰€ä»¥æ¯ä¸ªè§‚å¯Ÿè€…éƒ½éœ€è¦å®ç°è¿™ä¸ªæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(String message)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Subject æŠ½è±¡ä¸»é¢˜ï¼ˆæŠ½è±¡è¢«è§‚å¯Ÿè€…ï¼‰ï¼ŒæŠ½è±¡ä¸»é¢˜è§’è‰²æŠŠæ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡ä¿å­˜åœ¨ä¸€ä¸ªé›†åˆé‡Œï¼Œæ¯ä¸ªä¸»é¢˜éƒ½å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„è§‚å¯Ÿè€…ï¼ŒæŠ½è±¡ä¸»é¢˜æä¾›ä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥å¢åŠ å’Œåˆ é™¤è§‚å¯Ÿè€…å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Subject</span> {</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¢åŠ è®¢é˜…è€…</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">attach</span><span class="params">(Observer observer)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤è®¢é˜…è€…</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">detach</span><span class="params">(Observer observer)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šçŸ¥è®¢é˜…è€…æ›´æ–°æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(String message)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ConcreteSubject å…·ä½“ä¸»é¢˜ï¼ˆå…·ä½“è¢«è§‚å¯Ÿè€…ï¼‰ï¼Œè¯¥è§’è‰²å°†æœ‰å…³çŠ¶æ€å­˜å…¥å…·ä½“è§‚å¯Ÿè€…å¯¹è±¡ï¼Œåœ¨å…·ä½“ä¸»é¢˜çš„å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œç»™æ‰€æœ‰æ³¨å†Œè¿‡çš„è§‚å¯Ÿè€…å‘é€é€šçŸ¥ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteSubject</span> <span class="keyword">implements</span> <span class="title class_">Subject</span> {</span><br><span class="line">    <span class="comment">//è§‚å¯Ÿè€…å­˜å‚¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Observer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¢åŠ ä¸€ä¸ªè§‚å¯Ÿè€…</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">attach</span><span class="params">(Observer observer)</span> {</span><br><span class="line">        list.add(observer);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ é™¤ä¸€ä¸ªè§‚å¯Ÿè€…</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">detach</span><span class="params">(Observer observer)</span> {</span><br><span class="line">        list.remove(observer);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(String message)</span> {</span><br><span class="line">        <span class="keyword">for</span> (Observer observer : list) {</span><br><span class="line">            observer.update(message);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>User  è®¢é˜…è€…(è¢«è§‚å¯Ÿè€…)</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Observer</span> {</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name)</span> {</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(String message)</span> {</span><br><span class="line">        System.out.println(name + <span class="string">" æ”¶åˆ°æ¶ˆæ¯:"</span> + message);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Test æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">testObserver</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">ConcreteSubject</span> <span class="variable">concreteSubject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteSubject</span>();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"å¼ ä¸‰"</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"æå››"</span>);</span><br><span class="line">        concreteSubject.attach(user1);</span><br><span class="line">        concreteSubject.attach(user2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line">        concreteSubject.notify(<span class="string">"å¿«æ¥å¸®æˆ‘ç ä¸€åˆ€"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="è§‚å¯Ÿè€…æ¨¡å¼åœ¨JDKä¸­çš„åº”ç”¨"><a href="#è§‚å¯Ÿè€…æ¨¡å¼åœ¨JDKä¸­çš„åº”ç”¨" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼åœ¨JDKä¸­çš„åº”ç”¨"></a>è§‚å¯Ÿè€…æ¨¡å¼åœ¨JDKä¸­çš„åº”ç”¨</h2><p> åœ¨JDKä¸­çš„java.awt.Event å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸€ç§ï¼Œä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼å’Œåå°„å®ç°æ–¹æ³•å›è°ƒã€‚</p>
<p>Eventï¼šäº‹ä»¶å®ä½“ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Event</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object source;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Method callback;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String trigger;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> time;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Event</span><span class="params">(Object target, Method callback)</span> {</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">        <span class="built_in">this</span>.callback = callback;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getSource</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> source;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSource</span><span class="params">(Object source)</span> {</span><br><span class="line">        <span class="built_in">this</span>.source = source;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getTarget</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> target;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTarget</span><span class="params">(Object target)</span> {</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Method <span class="title function_">getCallback</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> callback;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCallback</span><span class="params">(Method callback)</span> {</span><br><span class="line">        <span class="built_in">this</span>.callback = callback;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTrigger</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> trigger;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Event <span class="title function_">setTrigger</span><span class="params">(String trigger)</span> {</span><br><span class="line">        <span class="built_in">this</span>.trigger = trigger;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getTime</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> time;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTime</span><span class="params">(<span class="type">long</span> time)</span> {</span><br><span class="line">        <span class="built_in">this</span>.time = time;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Event{"</span> +</span><br><span class="line">                <span class="string">"source="</span> + source +</span><br><span class="line">                <span class="string">", target="</span> + target +</span><br><span class="line">                <span class="string">", callback="</span> + callback +</span><br><span class="line">                <span class="string">", trigger='"</span> + trigger + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", time="</span> + time +</span><br><span class="line">                <span class="string">'}'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>EventListenerï¼šäº‹ä»¶ç›‘å¬ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventListener</span> {</span><br><span class="line">    <span class="keyword">protected</span> Map&lt;String, Event&gt; events = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">	<span class="comment">// é€šè¿‡äº‹ä»¶åç§°å’Œä¸€ä¸ªç›®æ ‡å¯¹è±¡æ¥è§¦å‘äº‹ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addListener</span><span class="params">(String eventType, Object target)</span> {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            addListener(eventType,</span><br><span class="line">                    target,</span><br><span class="line">                    target.getClass().getMethod(<span class="string">"on"</span> + toUpperFirstCase(eventType), Event.class));</span><br><span class="line">        } <span class="keyword">catch</span> (NoSuchMethodException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">toUpperFirstCase</span><span class="params">(String str)</span> {</span><br><span class="line">        <span class="type">char</span>[] chars = str.toCharArray();</span><br><span class="line">        chars[<span class="number">0</span>] -= <span class="number">32</span>;</span><br><span class="line">        <span class="keyword">return</span> String.valueOf(chars);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addListener</span><span class="params">(String eventType, Object target, Method callback)</span> {</span><br><span class="line">        events.put(eventType, <span class="keyword">new</span> <span class="title class_">Event</span>(target, callback));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">trigger</span><span class="params">(Event event)</span> {</span><br><span class="line">        event.setSource(<span class="built_in">this</span>);</span><br><span class="line">        event.setTime(System.currentTimeMillis());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (event.getCallback() != <span class="literal">null</span>) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                event.getCallback().invoke(event.getTarget(), event);</span><br><span class="line">            } <span class="keyword">catch</span> (IllegalAccessException | InvocationTargetException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">trigger</span><span class="params">(String eventType)</span> {</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.events.containsKey(eventType)) {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        trigger(<span class="built_in">this</span>.events.get(eventType).setTrigger(eventType));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>MouseEventTypeï¼šé¼ æ ‡äº‹ä»¶å¸¸é‡</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MouseEventType</span> {</span><br><span class="line">    <span class="type">String</span> <span class="variable">ON_CLICK</span> <span class="operator">=</span> <span class="string">"click"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">ON_DOUBLE_CLICK</span> <span class="operator">=</span> <span class="string">"doubleClick"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">ON_UP</span> <span class="operator">=</span> <span class="string">"up"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">ON_DOWN</span> <span class="operator">=</span> <span class="string">"down"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Mouseï¼šé¼ æ ‡äº‹ä»¶å®ç°</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Mouse</span> <span class="keyword">extends</span> <span class="title class_">EventListener</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">click</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"è°ƒç”¨å•å‡»æ–¹æ³•"</span>);</span><br><span class="line">        <span class="built_in">this</span>.trigger(MouseEventType.ON_CLICK);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dClick</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"è°ƒç”¨åŒå‡»æ–¹æ³•"</span>);</span><br><span class="line">        <span class="built_in">this</span>.trigger(MouseEventType.ON_DOUBLE_CLICK);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">up</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"è°ƒç”¨å¼¹èµ·æ–¹æ³•"</span>);</span><br><span class="line">        <span class="built_in">this</span>.trigger(MouseEventType.ON_UP);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">down</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"è°ƒç”¨æŒ‰ä¸‹æ–¹æ³•"</span>);</span><br><span class="line">        <span class="built_in">this</span>.trigger(MouseEventType.ON_DOWN);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>MouseEventCallbackï¼šé¼ æ ‡äº‹ä»¶å›è°ƒ</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MouseEventCallback</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(Event e)</span> {</span><br><span class="line">        System.out.println(<span class="string">"============= è§¦å‘å•å‡»äº‹ä»¶ =============\n"</span> + e.toString());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDoubleClick</span><span class="params">(Event e)</span> {</span><br><span class="line">        System.out.println(<span class="string">"============= è§¦å‘åŒå‡»äº‹ä»¶ =============\n"</span> + e.toString());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onUp</span><span class="params">(Event e)</span> {</span><br><span class="line">        System.out.println(<span class="string">"============= è§¦å‘å¼¹èµ·äº‹ä»¶ =============\n"</span> + e.toString());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDown</span><span class="params">(Event e)</span> {</span><br><span class="line">        System.out.println(<span class="string">"============= è§¦å‘æŒ‰ä¸‹äº‹ä»¶ =============\n"</span> + e.toString());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Test æµ‹è¯•ç±»ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ObserverTest</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">MouseEventCallback</span> <span class="variable">callback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MouseEventCallback</span>();</span><br><span class="line">        <span class="type">Mouse</span> <span class="variable">mouse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Mouse</span>();</span><br><span class="line">        mouse.addListener(MouseEventType.ON_CLICK, callback);</span><br><span class="line">        mouse.addListener(MouseEventType.ON_UP, callback);</span><br><span class="line">        mouse.addListener(MouseEventType.ON_DOWN, callback);</span><br><span class="line">        mouse.addListener(MouseEventType.ON_DOUBLE_CLICK, callback);</span><br><span class="line"></span><br><span class="line">        mouse.click();</span><br><span class="line">        mouse.down();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="è§‚å¯Ÿè€…æ¨¡å¼åœ¨Springæºç ä¸­çš„åº”ç”¨"><a href="#è§‚å¯Ÿè€…æ¨¡å¼åœ¨Springæºç ä¸­çš„åº”ç”¨" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼åœ¨Springæºç ä¸­çš„åº”ç”¨"></a>è§‚å¯Ÿè€…æ¨¡å¼åœ¨Springæºç ä¸­çš„åº”ç”¨</h2><p>Spring ä¸­çš„ ContextLoaderListener å®ç°äº† ServletContextListener æ¥å£ï¼ŒServletContextListener æ¥å£åˆç»§æ‰¿äº† EventListenerï¼Œåœ¨ JDK ä¸­ EventListener æœ‰éå¸¸å¹¿æ³›çš„åº”ç”¨ã€‚æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹æºä»£ç ï¼ŒContextLoaderListenerï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContextLoaderListener</span> <span class="keyword">extends</span> <span class="title class_">ContextLoader</span> <span class="keyword">implements</span> <span class="title class_">ServletContextListener</span> {</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">ContextLoaderListener</span><span class="params">()</span> {</span><br><span class="line">   }</span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">ContextLoaderListener</span><span class="params">(WebApplicationContext context)</span> {</span><br><span class="line">      <span class="built_in">super</span>(context);</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextInitialized</span><span class="params">(ServletContextEvent event)</span> {</span><br><span class="line">      initWebApplicationContext(event.getServletContext());</span><br><span class="line">   }</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextDestroyed</span><span class="params">(ServletContextEvent event)</span> {</span><br><span class="line">      closeWebApplicationContext(event.getServletContext());</span><br><span class="line">      ContextCleanupListener.cleanupAttributes(event.getServletContext());</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ServletContextListener</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> javax.servlet;</span><br><span class="line"><span class="keyword">import</span> java.util.EventListener;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ServletContextListener</span> <span class="keyword">extends</span> <span class="title class_">EventListener</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextInitialized</span><span class="params">(ServletContextEvent sce)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>EventListener</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> java.util;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EventListener</span> {}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="åŸºäºGuavaApiè½»æ¾å®ç°è§‚å¯Ÿè€…æ¨¡å¼"><a href="#åŸºäºGuavaApiè½»æ¾å®ç°è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="åŸºäºGuavaApiè½»æ¾å®ç°è§‚å¯Ÿè€…æ¨¡å¼"></a>åŸºäºGuavaApiè½»æ¾å®ç°è§‚å¯Ÿè€…æ¨¡å¼</h2><p>Guava æ˜¯ä¸€ä¸ªå®ç°è§‚å¯Ÿè€…æ¨¡å¼éå¸¸å¥½çš„æ¡†æ¶ã€‚</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.guava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guava<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>20.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>GuavaEvent ï¼šç›‘å¬äº‹ä»¶ï¼ˆè¿™æ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„æ ¸å¿ƒï¼‰</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.common.eventbus.Subscribe;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GuavaEvent</span> {</span><br><span class="line">    <span class="meta">@Subscribe</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">subscribe</span><span class="params">(String str)</span> {</span><br><span class="line">        System.out.println(<span class="string">"æ‰§è¡Œsubscribeæ–¹æ³•ï¼Œä¼ å…¥çš„å‚æ•°æ˜¯ï¼š"</span> + str);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.common.eventbus.EventBus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.ContextLoaderListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GuavaEventTest</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">EventBus</span> <span class="variable">eventBus</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EventBus</span>();</span><br><span class="line">        <span class="type">GuavaEvent</span> <span class="variable">guavaEvent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GuavaEvent</span>();</span><br><span class="line">        eventBus.register(guavaEvent);</span><br><span class="line">        eventBus.post(<span class="string">"Tom"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h2><p>ä¼˜ç‚¹</p>
<p>ï¼ˆ1ï¼‰åœ¨è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…ä¹‹é—´å»ºç«‹äº†ä¸€ä¸ªæŠ½è±¡çš„è€¦åˆã€‚</p>
<p>ï¼ˆ2ï¼‰æ”¯æŒå¹¿æ’­é€šä¿¡ã€‚</p>
<p>ç¼ºç‚¹</p>
<p>ï¼ˆ1ï¼‰è§‚å¯Ÿè€…ä¹‹é—´å­˜åœ¨è¿‡å¤šç»†èŠ‚ä¾èµ–ã€æ—¶é—´æ¶ˆè€—è¿‡å¤šï¼Œè®©ç¨‹åºæ›´å¤æ‚äº†ã€‚</p>
<p>ï¼ˆ2ï¼‰ä½¿ç”¨ä¸å½“ä¼šå‡ºç°å¾ªç¯è°ƒç”¨ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸå‹æ¨¡å¼</title>
    <url>/p/91ad9ce3.html</url>
    <content><![CDATA[<html><head></head><body><p>è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ã€‚</p>
<p>ä¸»è¦é€‚ç”¨äºï¼š</p>
<p>ï¼ˆ1ï¼‰å¤§é‡çš„Getterå’ŒSetter èµ‹å€¼çš„åœºæ™¯</p>
<p>ï¼ˆ2ï¼‰ç±»åˆå§‹åŒ–æ¶ˆè€—èµ„æºè¾ƒå¤šã€‚</p>
<p>ï¼ˆ3ï¼‰ä½¿ç”¨ new ç”Ÿæˆä¸€ä¸ªå¯¹è±¡éœ€è¦éå¸¸ç¹ççš„è¿‡ç¨‹ï¼ˆæ•°æ®å‡†å¤‡ã€è®¿é—®æƒé™ï¼‰ã€‚</p>
<p>ï¼ˆ4ï¼‰æ„é€ å‡½æ•°æ¯”è¾ƒå¤æ‚ã€‚</p>
<p>ï¼ˆ5ï¼‰åœ¨å¾ªç¯ä½“ä¸­äº§ç”Ÿå¤§é‡å¯¹è±¡ã€‚</p>
<p>åœ¨ Spring ä¸­ï¼ŒåŸå‹æ¨¡å¼åº”ç”¨å¾—éå¸¸å¹¿æ³›ï¼Œä¾‹å¦‚ scope=â€prototypeâ€ ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨çš„ JSON.parseObject() ä¹Ÿæ˜¯ä¸€ç§åŸå‹æ¨¡å¼ã€‚åˆ†ä¸ºæµ…å…‹éš†å’Œæ·±å…‹éš†ä¸¤ç§ã€‚</p>
<h2 id="æµ…å…‹éš†"><a href="#æµ…å…‹éš†" class="headerlink" title="æµ…å…‹éš†"></a>æµ…å…‹éš†</h2><p>â€‹    æµ…å…‹éš†ï¼š<strong>å®Œæ•´å¤åˆ¶å€¼ç±»å‹æ•°æ®ï¼Œæ²¡æœ‰å¤åˆ¶å¼•ç”¨å¯¹è±¡</strong>ï¼ˆä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çš„å¼•ç”¨å¯¹è±¡ä»ç„¶<strong>æŒ‡å‘åŸæ¥</strong>å¯¹è±¡çš„<strong>åœ°å€</strong>ï¼‰ã€‚</p>
<p>â€‹    ä¸€ä¸ªæ ‡å‡†çš„åŸå‹æ¨¡å¼ä»£ç åº”è¯¥æ˜¯è¿™æ ·è®¾è®¡çš„ï¼šå…ˆåˆ›å»ºåŸå‹ Prototype æ¥å£ã€åˆ›å»ºéœ€è¦å…‹éš†çš„ç±»ConcretePrototypeAã€åˆ›å»ºå…‹éš†çš„å®¢æˆ·ç«¯ï¼Œé€šè¿‡å®¢æˆ·ç«¯æ¥å®ç°å…‹éš†ã€‚</p>
<p>Prototypeæ¥å£</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Prototype</span> {</span><br><span class="line">    Prototype <span class="title function_">clone</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ConcretePrototypeA éœ€è¦å…‹éš†çš„ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcretePrototypeA</span> <span class="keyword">implements</span> <span class="title class_">Prototype</span> {</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; hobbies;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHobbies</span><span class="params">(List&lt;String&gt; hobbies)</span> {</span><br><span class="line">        <span class="built_in">this</span>.hobbies = hobbies;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Prototype <span class="title function_">clone</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">ConcretePrototypeA</span> <span class="variable">concretePrototype</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcretePrototypeA</span>();</span><br><span class="line">        concretePrototype.setAge(<span class="built_in">this</span>.age);</span><br><span class="line">        concretePrototype.setName(<span class="built_in">this</span>.name);</span><br><span class="line">        concretePrototype.setHobbies(<span class="built_in">this</span>.hobbies);</span><br><span class="line">        <span class="keyword">return</span> concretePrototype;</span><br><span class="line">    }</span><br><span class="line">	<span class="comment">// çœç•¥Getterã€Setteræ–¹æ³•</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Client å®¢æˆ·ç«¯ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> {</span><br><span class="line">    <span class="keyword">private</span> Prototype prototype;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Client</span><span class="params">(Prototype prototype)</span> {</span><br><span class="line">        <span class="built_in">this</span>.prototype = prototype;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Prototype <span class="title function_">startClone</span><span class="params">(Prototype concretePrototype)</span> {</span><br><span class="line">        <span class="keyword">return</span> (Prototype) concretePrototype.clone();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Test æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrototypeTest</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">ConcretePrototypeA</span> <span class="variable">concretePrototype</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcretePrototypeA</span>();</span><br><span class="line">        concretePrototype.setAge(<span class="number">18</span>);</span><br><span class="line">        concretePrototype.setName(<span class="string">"prototype"</span>);</span><br><span class="line">        List&lt;String&gt; hobbies = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        concretePrototype.setHobbies(hobbies);</span><br><span class="line"></span><br><span class="line">        <span class="type">Client</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Client</span>(concretePrototype);</span><br><span class="line">        <span class="type">ConcretePrototypeA</span> <span class="variable">concretePrototypeClone</span> <span class="operator">=</span> (ConcretePrototypeA) client.startClone(concretePrototype);</span><br><span class="line"></span><br><span class="line">        System.out.println(concretePrototypeClone);</span><br><span class="line">        <span class="comment">// ç»“æœä¸º trueï¼Œè¯´æ˜å¼•ç”¨åœ°å€ç›¸åŒ</span></span><br><span class="line">        System.out.println(concretePrototypeClone.getHobbies() == concretePrototype.getHobbies());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="æ·±å…‹éš†"><a href="#æ·±å…‹éš†" class="headerlink" title="æ·±å…‹éš†"></a>æ·±å…‹éš†</h2><p>è¿™é‡Œä¸¾ä¸€ä¸ªæˆ¿å­å’Œæˆ¿å­çš„ä¸»äººçš„æ¡ˆä¾‹ï¼Œæˆ¿å­æœ‰é¢ç§¯å¤§å°ã€æ¥¼å±‚ç­‰å±æ€§ã€æˆ¿ä¸»æœ‰å§“åã€ç”µè¯ç­‰å±æ€§ã€‚</p>
<p>æˆ¿å­ç±»ï¼ˆåŒ…å«è¿™ä¸ªæˆ¿å­çš„ä¸»äººã€é¢ç§¯ã€æ¥¼å±‚å±æ€§ï¼‰</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">House</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> {</span><br><span class="line">    <span class="comment">// æ¥¼å±‚</span></span><br><span class="line">    String floor;</span><br><span class="line">    <span class="comment">// ä½æˆ¿é¢ç§¯</span></span><br><span class="line">    <span class="type">int</span> area;</span><br><span class="line">    <span class="comment">// ç§Ÿé‡‘</span></span><br><span class="line">    <span class="type">double</span> price;</span><br><span class="line">    <span class="comment">// æˆ¿ä¸»</span></span><br><span class="line">    HouseOwner owner;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">House</span><span class="params">()</span> {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">House</span><span class="params">(String roomId, <span class="type">int</span> area, <span class="type">double</span> price, HouseOwner owner)</span> {</span><br><span class="line">        <span class="built_in">this</span>.floor = roomId;</span><br><span class="line">        <span class="built_in">this</span>.area = area;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">        <span class="built_in">this</span>.owner = owner;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ¿ä¸»ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HouseOwner</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> {</span><br><span class="line">    <span class="comment">// ç”µè¯</span></span><br><span class="line">    <span class="type">int</span> phone;</span><br><span class="line">    <span class="comment">// å§“å</span></span><br><span class="line">    String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HouseOwner</span><span class="params">()</span> {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HouseOwner</span><span class="params">(<span class="type">int</span> phone, String name)</span> {</span><br><span class="line">        <span class="built_in">this</span>.phone = phone;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Testæµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HouseCloneTest</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException {</span><br><span class="line">        <span class="type">HouseOwner</span> <span class="variable">MrDJun</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HouseOwner</span>(<span class="number">1</span>, <span class="string">"MrDJun"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">House</span> <span class="variable">h1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">House</span>(<span class="string">"1302"</span>, <span class="number">78</span>, <span class="number">2900</span>, MrDJun);</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">"clone.obj"</span>));</span><br><span class="line">        oos.writeObject(h1);</span><br><span class="line">        oos.close();</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">"clone.obj"</span>));</span><br><span class="line">        <span class="type">House</span> <span class="variable">h2</span> <span class="operator">=</span> (House) ois.readObject();</span><br><span class="line"></span><br><span class="line">        System.out.println(h1);</span><br><span class="line">        System.out.println(h1.owner == h2.owner);</span><br><span class="line">        ois.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="å…‹éš†ç ´åå•ä¾‹æ¨¡å¼"><a href="#å…‹éš†ç ´åå•ä¾‹æ¨¡å¼" class="headerlink" title="å…‹éš†ç ´åå•ä¾‹æ¨¡å¼"></a>å…‹éš†ç ´åå•ä¾‹æ¨¡å¼</h2><p>â€‹        å¦‚æœæˆ‘ä»¬å…‹éš†çš„å¯¹è±¡æ˜¯å•ä¾‹å¯¹è±¡ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€æ·±å…‹éš†ä¼šç ´åå•ä¾‹æ¨¡å¼ã€‚å®é™…ä¸Šé˜²æ­¢å…‹éš†ç ´åå•ä¾‹æ¨¡å¼çš„è§£å†³æ€è·¯å¾ˆç®€å•ï¼šç¦æ­¢å…‹éš†å³å¯ã€‚</p>
<p>ä¸¤ç§æ–¹å¼ï¼š</p>
<p>1ã€ ä¸å®ç° Cloneable æ¥å£ï¼›</p>
<p>2ã€é‡å†™ clone() æ–¹æ³•ï¼Œåœ¨ clone() æ–¹æ³•ä¸­è¿”å›å•ä¾‹å¯¹è±¡ï¼›</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException {</span><br><span class="line">    <span class="keyword">return</span> INSTANCE;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h2><p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€æ€§èƒ½æé«˜ã€‚ 2ã€é€ƒé¿æ„é€ å‡½æ•°çš„çº¦æŸã€‚</p>
<p><strong>ç¼ºç‚¹ï¼š</strong> 1ã€é…å¤‡å…‹éš†æ–¹æ³•éœ€è¦å¯¹ç±»çš„åŠŸèƒ½è¿›è¡Œé€šç›˜è€ƒè™‘ï¼Œè¿™å¯¹äºå…¨æ–°çš„ç±»ä¸æ˜¯å¾ˆéš¾ï¼Œä½†å¯¹äºå·²æœ‰çš„ç±»ä¸ä¸€å®šå¾ˆå®¹æ˜“ï¼Œç‰¹åˆ«å½“ä¸€ä¸ªç±»å¼•ç”¨ä¸æ”¯æŒä¸²è¡ŒåŒ–çš„é—´æ¥å¯¹è±¡ï¼Œæˆ–è€…å¼•ç”¨å«æœ‰å¾ªç¯ç»“æ„çš„æ—¶å€™ã€‚ 2ã€å¿…é¡»å®ç° Cloneable æ¥å£ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»£ç†æ¨¡å¼</title>
    <url>/p/7b510e10.html</url>
    <content><![CDATA[<html><head></head><body><p>ä¸¤ç§æ¨¡å¼ï¼š<strong>é™æ€ä»£ç†</strong>ã€<strong>åŠ¨æ€ä»£ç†</strong>ã€‚</p>
<p>ä¸¤ä¸ªç›®çš„ï¼š<strong>ä¿æŠ¤ç›®æ ‡å¯¹è±¡ã€å¢å¼ºç›®æ ‡å¯¹è±¡</strong>ã€‚</p>
<p>å®šä¹‰ï¼šä»£ç†æ¨¡å¼ï¼ˆProxy Patternï¼‰æ˜¯æŒ‡ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ï¼Œä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ï¼Œå±äºç»“æ„å‹æ¨¡å¼ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå¯¹è±¡ä¸é€‚åˆæˆ–è€…ä¸èƒ½ç›´æ¥å¼•ç”¨å¦ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä»£ç†å¯¹è±¡å¯ä»¥åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´èµ·åˆ°ä¸­ä»‹çš„ä½œç”¨ã€‚</p>
<p>åº”ç”¨åœºæ™¯ï¼šç”Ÿæ´»ä¸­çš„ç§Ÿæˆ¿ä¸­ä»‹ã€å”®ç¥¨é»„ç‰›ã€å©šä»‹ã€ç»çºªäººã€å¿«é€’ã€äº‹åŠ¡ä»£ç†ã€éä¾µå…¥å¼æ—¥å¿—ç›‘å¬ç­‰ï¼Œéƒ½æ˜¯ä»£ç†æ¨¡å¼çš„å®é™…ä½“ç°ã€‚å½“æ— æ³•æˆ–ä¸æƒ³ç›´æ¥å¼•ç”¨æŸä¸ªå¯¹è±¡æˆ–è®¿é—®æŸä¸ªå¯¹è±¡å­˜åœ¨å›°éš¾æ—¶ï¼Œå¯ä»¥é€šè¿‡ä»£ç†å¯¹è±¡æ¥é—´æ¥è®¿é—®ã€‚</p>
<p>ä»£ç†æ¨¡å¼ä¸€èˆ¬ç”±<strong>å…±åŒæ¥å£ç±»</strong>ã€<strong>è¢«ä»£ç†ç±»</strong>ã€<strong>ä»£ç†ç±»</strong>ç»„æˆã€‚</p>
<h2 id="é™æ€ä»£ç†"><a href="#é™æ€ä»£ç†" class="headerlink" title="é™æ€ä»£ç†"></a>é™æ€ä»£ç†</h2><p>è¿™é‡Œä¸¾ä¸€ä¸ªçˆ¶äº²å¸®å„¿å­æ‰¾å¯¹è±¡çš„æ¡ˆä¾‹ã€‚äººæœ‰å¾ˆå¤šè¡Œä¸ºï¼šè¦è°ˆæ‹çˆ±ã€è¦å·¥ä½œã€è¦ä¹°æˆ¿ä¹°è½¦ï¼Œè°ˆæ‹çˆ±åªæ˜¯è¡Œä¸ºä¸­çš„ä¸€é¡¹ã€‚çˆ¶äº²å’Œå„¿å­æœ‰ä¸ªå…±åŒçš„è¡Œä¸ºæ˜¯æ‰¾å¯¹è±¡ï¼Œäºæ˜¯æŠ½å–æˆä¸€ä¸ªå…±åŒæ¥å£ã€‚</p>
<p>å…±åŒæ¥å£ç±» Personï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Person</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">findLove</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¢«ä»£ç†ç±» Sonï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Son</span> <span class="keyword">implements</span> <span class="title class_">Person</span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findLove</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"å„¿å­è¦æ‰¾å¯¹è±¡ï¼Œè¦æ±‚ï¼šå¯Œå©†"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä»£ç†ç±» Father:</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Father</span> <span class="keyword">implements</span> <span class="title class_">Person</span>{</span><br><span class="line">    <span class="keyword">private</span> Son son;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Father</span><span class="params">(Son son)</span> {</span><br><span class="line">        <span class="built_in">this</span>.son = son;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findLove</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"çˆ¶äº²å¸®å„¿å­æ‰¾å¯Œå©†"</span>);</span><br><span class="line">        <span class="built_in">this</span>.son.findLove();</span><br><span class="line">        System.out.println(<span class="string">"å„¿å­å¾ˆå¼ºå£®ï¼Œå¯Œå©†å¾ˆå–œæ¬¢ï¼Œåœ¨ä¸€èµ·äº†"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æµ‹è¯•ç±» Testï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaticMain</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">// çˆ¶äº²åªèƒ½å¸®å„¿å­æ‰¾å¯¹è±¡ï¼Œä¸èƒ½å¸®è¡¨å¦¹ï¼Œå¸®é™Œç”Ÿäºº</span></span><br><span class="line">        <span class="type">Father</span> <span class="variable">father</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Father</span>(<span class="keyword">new</span> <span class="title class_">Son</span>());</span><br><span class="line">        father.findLove();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="åŠ¨æ€ä»£ç†æ¨¡å¼"><a href="#åŠ¨æ€ä»£ç†æ¨¡å¼" class="headerlink" title="åŠ¨æ€ä»£ç†æ¨¡å¼"></a>åŠ¨æ€ä»£ç†æ¨¡å¼</h2><h3 id="åå°„ï¼ˆjava-lang-reflectï¼‰"><a href="#åå°„ï¼ˆjava-lang-reflectï¼‰" class="headerlink" title="åå°„ï¼ˆjava.lang.reflectï¼‰"></a>åå°„ï¼ˆjava.lang.reflectï¼‰</h3><ul>
<li><p>Classç±»ï¼šä»£è¡¨ä¸€ä¸ªç±»ã€‚</p>
<p>Classæ˜¯ä¸€ä¸ªç±»ï¼Œclassæ˜¯å…³é”®å­—ã€‚</p>
<p>Classç±»åªæœ‰ä¸€ä¸ªç§æœ‰çš„æ„é€ å‡½æ•°ï¼Œåªæœ‰JVMèƒ½å¤Ÿåˆ›å»ºClassç±»çš„å®ä¾‹ã€‚</p>
<p>JVMä¸­åªæœ‰å”¯ä¸€ä¸€ä¸ªå’Œç±»ç›¸å¯¹åº”çš„Classå¯¹è±¡æ¥æè¿°å…¶ç±»å‹ä¿¡æ¯ã€‚</p>
</li>
<li><p>Fieldç±»ï¼šä»£è¡¨ç±»çš„æˆå‘˜å˜é‡ï¼ˆæˆå‘˜å˜é‡ä¹Ÿç§°ä¸ºç±»çš„å±æ€§ï¼‰ã€‚</p>
</li>
<li><p>Methodç±»ï¼šä»£è¡¨ç±»çš„æ–¹æ³•ã€‚</p>
</li>
<li><p>Constructorç±»ï¼šä»£è¡¨ç±»çš„æ„é€ æ–¹æ³•ã€‚</p>
</li>
<li><p>Arrayç±»ï¼šæä¾›äº†åŠ¨æ€åˆ›å»ºæ•°ç»„ï¼Œä»¥åŠè®¿é—®æ•°ç»„çš„å…ƒç´ çš„é™æ€æ–¹æ³•ã€‚</p>
</li>
</ul>
<p>è·å–Classå¯¹è±¡çš„ä¸‰ç§æ–¹å¼ï¼š</p>
<p>1ã€é€šè¿‡Object.getClass() è·å–</p>
<p>2ã€ä»»ä½•æ•°æ®ç±»å‹éƒ½æœ‰ä¸€ä¸ªé™æ€çš„classå±æ€§</p>
<p>3ã€é€šè¿‡ Class.forName() çš„é™æ€æ–¹æ³•è·å–ï¼ˆå¸¸ç”¨ï¼‰</p>
<p>è¿™é‡Œè¿˜æ˜¯æ‰¾å¯¹è±¡çš„æ¡ˆä¾‹ï¼Œä½†ç°åœ¨æ˜¯è®©åª’å©†å¸®å¿™ç‰©è‰²å¯¹è±¡äº†ï¼Œâ€œæˆ‘â€å¯¹äºåª’å©†æ¥è¯´æ˜¯é¡¾å®¢ï¼Œé‚£ä¹ˆå…³ç³»å°±æ˜¯åª’å©†å¸®â€œæˆ‘â€æ‰¾å¯¹è±¡ã€‚ä¸‹é¢åŸºäºJDKå®ç°åŠ¨æ€ä»£ç†ï¼š</p>
<p>è¢«ä»£ç†ç±» é¡¾å®¢ Customerï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Customer</span> <span class="keyword">implements</span> <span class="title class_">Person</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findLove</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"[å®¢æˆ·] è¦æ±‚1ï¼šç™½å¯Œç¾"</span>);</span><br><span class="line">        System.out.println(<span class="string">"[å®¢æˆ·] è¦æ±‚2ï¼šæœ‰è½¦æœ‰æˆ¿"</span>);</span><br><span class="line">        System.out.println(<span class="string">"[å®¢æˆ·] è¦æ±‚3ï¼šæœ‰å­˜æ¬¾"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä»£ç†ç±» åª’å©† JDKMeipoï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDKMeipo</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> {</span><br><span class="line">    <span class="comment">// è¢«ä»£ç†çš„å¯¹è±¡ï¼Œå°†å¼•ç”¨ä¿å­˜ä¸‹æ¥</span></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getProxyInstance</span><span class="params">(Object target)</span> {</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">        Class&lt;?&gt; clazz = target.getClass();</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(clazz.getClassLoader(), clazz.getInterfaces(), <span class="built_in">this</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable {</span><br><span class="line">        before();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> method.invoke(target, args);</span><br><span class="line">        after();</span><br><span class="line">        <span class="keyword">return</span> o;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"[åª’å©†] æ­£åœ¨æŸ¥æ‰¾å¯¹è±¡..."</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"[åª’å©†] æŸ¥æ‰¾å®Œæˆ..."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æµ‹è¯•ç±» Testï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">    <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> (Person) <span class="keyword">new</span> <span class="title class_">JDKMeipo</span>().getProxyInstance(<span class="keyword">new</span> <span class="title class_">Customer</span>());</span><br><span class="line">    person.findLove();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å®ç°åŸç†: JDKåŠ¨æ€ä»£ç†é‡‡ç”¨å­—èŠ‚é‡ç»„ï¼Œé‡æ–°ç”Ÿæˆå¯¹è±¡æ¥æ›¿ä»£åŸå§‹å¯¹è±¡ï¼Œä»¥è¾¾åˆ°åŠ¨æ€ä»£ç†çš„ç›®çš„ã€‚</p>
<ul>
<li><strong>JDKåŠ¨æ€ä»£ç†ç”Ÿæˆå¯¹è±¡çš„æ­¥éª¤å¦‚ä¸‹</strong></li>
</ul>
<ol>
<li>è·å–è¢«ä»£ç†å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶ä¸”è·å–å®ƒçš„æ‰€æœ‰æ¥å£ï¼Œåå°„è·å–ã€‚</li>
<li>JDKåŠ¨æ€ä»£ç†ç±»é‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„ç±»ï¼ŒåŒæ—¶æ–°çš„ç±»è¦å®ç°è¢«ä»£ç†ç±»å®ç°çš„æ‰€æœ‰æ¥å£ã€‚</li>
<li>åŠ¨æ€ç”ŸæˆJavaä»£ç ï¼Œæ–°åŠ çš„ä¸šåŠ¡é€»è¾‘æ–¹æ³•ç”±ä¸€å®šçš„é€»è¾‘ä»£ç è°ƒç”¨ã€‚</li>
<li>ç¼–è¯‘æ–°ç”Ÿæˆçš„Javaä»£ç .classæ–‡ä»¶ã€‚</li>
<li>é‡æ–°åŠ è½½åˆ°JVMä¸­è¿è¡Œã€‚</li>
</ol>
<p><strong>ä½¿ç”¨ CGLib åŠ¨æ€ä»£ç†ï¼š</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CGlibProxy</span> <span class="keyword">implements</span> <span class="title class_">MethodInterceptor</span> {</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getInstance</span><span class="params">(Class&lt;?&gt; clazz)</span> <span class="keyword">throws</span> Exception{</span><br><span class="line">        <span class="comment">// ç›¸å½“äºProxyï¼Œä»£ç†çš„å·¥å…·ç±»</span></span><br><span class="line">        <span class="type">Enhancer</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line">        enhancer.setSuperclass(clazz);</span><br><span class="line">        enhancer.setCallback(<span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">return</span> enhancer.create();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable {</span><br><span class="line">        before();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> methodProxy.invokeSuper(o,objects);</span><br><span class="line">        after();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>{</span><br><span class="line">       System.out.println(<span class="string">"called before request()."</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>{</span><br><span class="line">        System.out.println(<span class="string">"called after request()."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>CGLibå’ŒJDKåŠ¨æ€ä»£ç†å¯¹æ¯”</strong><br>1.JDK åŠ¨æ€ä»£ç†å®ç°äº†è¢«ä»£ç†å¯¹è±¡çš„æ¥å£ï¼ŒCGLib ä»£ç†ç»§æ‰¿äº†è¢«ä»£ç†å¯¹è±¡ã€‚<br>2.JDK åŠ¨æ€ä»£ç†å’ŒCGLibä»£ç†éƒ½åœ¨è¿è¡ŒæœŸç”Ÿæˆå­—èŠ‚ç ï¼ŒJDK åŠ¨æ€ä»£ç†ç›´æ¥ç”Ÿæˆ Class å­—èŠ‚ç ï¼ŒCGLib ä»£ç†ä½¿ç”¨ASMæ¡†æ¶ç”ŸæˆClasså­—èŠ‚ç ï¼ŒCGlib ä»£ç†å®ç°æ›´å¤æ‚ï¼Œç”Ÿæˆä»£ç†ç±»æ¯” JDK åŠ¨æ€ä»£ç†æ•ˆç‡ä½ã€‚<br>3.JDKåŠ¨æ€ä»£ç†è°ƒç”¨ä»£ç†æ–¹æ³•æ˜¯é€šè¿‡åå°„æœºåˆ¶è°ƒç”¨çš„ï¼ŒCGLib ä»£ç†æ˜¯é€šè¿‡ FastClass æœºåˆ¶ç›´æ¥è°ƒç”¨æ–¹æ³•çš„ï¼ŒCGLib ä»£ç†çš„æ‰§è¡Œæ•ˆç‡æ›´é«˜ã€‚</li>
</ul>
<h2 id="é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„åŒºåˆ«"><a href="#é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„åŒºåˆ«" class="headerlink" title="é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„åŒºåˆ«"></a>é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„åŒºåˆ«</h2><p>1.é™æ€ä»£ç†åªèƒ½é€šè¿‡æ‰‹åŠ¨å®Œæˆä»£ç†æ“ä½œï¼Œå¦‚æœè¢«ä»£ç†ç±»å¢åŠ äº†æ–°çš„æ–¹æ³•ï¼Œä»£ç†ç±»éœ€è¦åŒæ­¥å¢åŠ ï¼Œè¿èƒŒå¼€é—­åŸåˆ™ã€‚<br>2.åŠ¨æ€ä»£ç†é‡‡ç”¨åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç çš„æ–¹å¼ï¼Œå–æ¶ˆäº†å¯¹è¢«ä»£ç†ç±»çš„æ‰©å±•é™åˆ¶ï¼Œéµå¾ªå¼€é—­åŸåˆ™ã€‚<br>3.è‹¥åŠ¨æ€ä»£ç†è¦å¯¹ç›®æ ‡ç±»çš„å¢å¼ºé€»è¾‘è¿›è¡Œæ‰©å±•ï¼Œç»“åˆç­–ç•¥æ¨¡å¼ï¼Œåªéœ€è¦æ–°å¢ç­–ç•¥ç±»ä¾¿å¯å®Œæˆï¼Œæ— é¡»ä¿®æ”¹ä»£ç†ç±»çš„ä»£ç ã€‚</p>
<h2 id="ä»£ç†æ¨¡å¼åœ¨Springä¸­çš„åº”ç”¨"><a href="#ä»£ç†æ¨¡å¼åœ¨Springä¸­çš„åº”ç”¨" class="headerlink" title="ä»£ç†æ¨¡å¼åœ¨Springä¸­çš„åº”ç”¨"></a>ä»£ç†æ¨¡å¼åœ¨Springä¸­çš„åº”ç”¨</h2><p>Springåˆ©ç”¨åŠ¨æ€ä»£ç†å®ç°AOPæ—¶æœ‰ä¸¤ä¸ªéå¸¸é‡è¦çš„ç±»ï¼šJdkDynamicAopProxyç±»å’ŒCglibAopProxyç±»<br>ä»£ç†é€‰æ‹©åŸåˆ™ï¼š<br>1.å½“Beanæœ‰å®ç°æ¥å£æ—¶ï¼ŒSpringå°±ä¼šç”¨JDKåŠ¨æ€ä»£ç†ã€‚<br>2.å½“Bean æ²¡æœ‰å®ç°æ¥å£æ—¶ï¼ŒSpring ä¼šé€‰æ‹©CGLibä»£ç†ã€‚<br>3.Spring å¯ä»¥é€šè¿‡é…ç½®å¼ºåˆ¶ä½¿ç”¨CGLibä»£ç†ï¼Œåªéœ€åœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">&lt;aop:aspectj-autoproxy proxy-target-class=<span class="string">"true"</span>/&gt;</span><br></pre></td></tr></tbody></table></figure>

<h2 id="ä»£ç†æ¨¡å¼çš„ä¼˜ç¼ºç‚¹"><a href="#ä»£ç†æ¨¡å¼çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="ä»£ç†æ¨¡å¼çš„ä¼˜ç¼ºç‚¹"></a>ä»£ç†æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h2><p><strong>ä¼˜ç‚¹ï¼š</strong><br>    1.ä»£ç†æ¨¡å¼èƒ½å°†ä»£ç†å¯¹è±¡ä¸çœŸå®è¢«è°ƒç”¨ç›®æ ‡å¯¹è±¡åˆ†ç¦»ã€‚<br>    2.åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†ç³»ç»Ÿçš„è€¦åˆæ€§ï¼Œæ‰©å±•æ€§å¥½ã€‚<br>    3.å¯ä»¥èµ·åˆ°ä¿æŠ¤ç›®æ ‡å¯¹è±¡çš„ä½œç”¨ã€‚<br>    4.å¯ä»¥å¢å¼ºç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½ã€‚<br><strong>ç¼ºç‚¹ï¼š</strong><br>    1.ä»£ç†æ¨¡å¼ä¼šé€ æˆç³»ç»Ÿè®¾è®¡ä¸­ç±»çš„æ•°é‡å¢åŠ ã€‚<br>    2.åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¸­å¢åŠ ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œä¼šå¯¼è‡´è¯·æ±‚å¤„ç†é€Ÿåº¦å˜æ…¢ã€‚<br>    3.å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚</p>
<h2 id="é™„ï¼šæ‰‹å†™å®ç°JDKçš„åŠ¨æ€ä»£ç†"><a href="#é™„ï¼šæ‰‹å†™å®ç°JDKçš„åŠ¨æ€ä»£ç†" class="headerlink" title="é™„ï¼šæ‰‹å†™å®ç°JDKçš„åŠ¨æ€ä»£ç†"></a>é™„ï¼šæ‰‹å†™å®ç°JDKçš„åŠ¨æ€ä»£ç†</h2><p>â€‹    åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†çš„åŸºæœ¬æ€è·¯æ˜¯ä¸€è‡´çš„ï¼Œåªä¸è¿‡åŠ¨æ€ä»£ç†çš„åŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼Œéšç€ä¸šåŠ¡çš„æ‰©å±•é€‚åº”æ€§æ›´å¼ºã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨JDKåŠ¨æ€ä»£ç†å®ç°çš„ä¸€ä¸ªç›¸äº²æ‰¾å¯¹è±¡çš„æ¡ˆä¾‹ã€‚</p>
<h3 id="JDKå®ç°æ–¹å¼"><a href="#JDKå®ç°æ–¹å¼" class="headerlink" title="JDKå®ç°æ–¹å¼"></a>JDKå®ç°æ–¹å¼</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JDKå®ç°æ–¹å¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MrDJun 2020/10/27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDKMeipo</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> {</span><br><span class="line">    <span class="comment">// è¢«ä»£ç†çš„å¯¹è±¡ï¼ŒæŠŠå¼•ç”¨ä¿å­˜ä¸‹æ¥</span></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getInstance</span><span class="params">(Object target)</span> {</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">        Class&lt;?&gt; clazz = target.getClass();</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(clazz.getClassLoader(), clazz.getInterfaces(), <span class="built_in">this</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable {</span><br><span class="line">        before();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> method.invoke(<span class="built_in">this</span>.target, args);</span><br><span class="line">        after();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"æˆ‘æ˜¯åª’å©†ï¼Œæ­£åœ¨å¸®ä½ æ‰¾å¯¹è±¡ï¼Œç°åœ¨å·²ç»ç¡®è®¤äº†ä½ å–œæ¬¢å“ªç§å¦¹å­äº†"</span>);</span><br><span class="line">        System.out.println(<span class="string">"å¼€å§‹ç‰©è‰²..."</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"å·²ç»å¸®ä½ æ‰¾åˆ°è¿™æ ·çš„å¦¹å­äº†ï¼Œè§‰å¾—åˆé€‚çš„è¯ï¼Œå°±å‡†å¤‡åŠå–œäº‹å§"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// å•èº«å®¢æˆ·ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Customer</span> <span class="keyword">implements</span> <span class="title class_">Person</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findLove</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"å¯Œå©†"</span>);</span><br><span class="line">        System.out.println(<span class="string">"èº«é«˜166cm"</span>);</span><br><span class="line">        System.out.println(<span class="string">"æ— ä¸è‰¯å—œå¥½"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">findLove</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸»ç±»æµ‹è¯•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestApplication</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Person</span> <span class="variable">obj</span> <span class="operator">=</span> (Person) <span class="keyword">new</span> <span class="title class_">JDKMeipo</span>().getInstance(<span class="keyword">new</span> <span class="title class_">Customer</span>());</span><br><span class="line">        obj.findLove();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>â€‹        è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">æˆ‘æ˜¯åª’å©†ï¼Œæ­£åœ¨å¸®ä½ æ‰¾å¯¹è±¡ï¼Œç°åœ¨å·²ç»ç¡®è®¤äº†ä½ å–œæ¬¢å“ªç§å¦¹å­äº†</span><br><span class="line">å¼€å§‹ç‰©è‰²...</span><br><span class="line">å¯Œå©†</span><br><span class="line">èº«é«˜166cm</span><br><span class="line">æ— ä¸è‰¯å—œå¥½</span><br><span class="line">å·²ç»å¸®ä½ æ‰¾åˆ°è¿™æ ·çš„å¦¹å­äº†ï¼Œè§‰å¾—åˆé€‚çš„è¯ï¼Œå°±å‡†å¤‡åŠå–œäº‹å§</span><br></pre></td></tr></tbody></table></figure>



<h3 id="æ‰‹å†™å®ç°JDKåŠ¨æ€ä»£ç†"><a href="#æ‰‹å†™å®ç°JDKåŠ¨æ€ä»£ç†" class="headerlink" title="æ‰‹å†™å®ç°JDKåŠ¨æ€ä»£ç†"></a>æ‰‹å†™å®ç°JDKåŠ¨æ€ä»£ç†</h3><p>â€‹        JDKçš„åŠ¨æ€ä»£ç†æ˜¯é‡‡ç”¨å­—èŠ‚é‡ç»„çš„æ–¹å¼å®ç°çš„ï¼Œé‡æ–°ç”Ÿæˆå¯¹è±¡æ¥æ›¿ä»£åŸå§‹å¯¹è±¡ï¼Œä»¥è¾¾åˆ°åŠ¨æ€ä»£ç†çš„ç›®çš„ã€‚JDKåŠ¨æ€ä»£ç†ç”Ÿæˆå¯¹è±¡çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p>ï¼ˆ1ï¼‰è·å–è¢«ä»£ç†å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶è·å–å®ƒçš„æ‰€æœ‰æ¥å£ï¼Œåå°„è·å–ï¼›</p>
<p>ï¼ˆ2ï¼‰JDKåŠ¨æ€ä»£ç†ç±»é‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„ç±»ï¼ŒåŒæ—¶ç”Ÿæˆæ–°çš„ç±»è¦å®ç°è¢«ä»£ç†ç±»å®ç°çš„æ‰€æœ‰æ¥å£ï¼›</p>
<p>ï¼ˆ3ï¼‰åŠ¨æ€ç”ŸæˆJavaä»£ç ï¼Œæ–°åŠ çš„ä¸šåŠ¡é€»è¾‘æ–¹æ³•ç”±ä¸€å®šçš„é€»è¾‘ä»£ç è°ƒç”¨ï¼ˆåœ¨ä»£ç ä¸­ä½“ç°ï¼‰ï¼›</p>
<p>ï¼ˆ4ï¼‰ç¼–è¯‘æ–°ç”Ÿæˆçš„Javaä»£ç ä¸º.classæ–‡ä»¶ï¼›</p>
<p>ï¼ˆ5ï¼‰é‡æ–°åŠ è½½åˆ°JVMè¿è¡Œï¼›</p>
<p>â€‹        ä»¥ä¸Šè¿‡ç¨‹ç§°ä¸ºå­—èŠ‚é‡ç»„ã€‚JDKä¸­æœ‰ä¸€ä¸ªè§„èŒƒï¼Œåœ¨ClassPathä¸‹åªè¦æ˜¯$å¼€å¤´çš„.classæ–‡ä»¶ï¼Œä¸€èˆ¬éƒ½æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ã€‚é‚£ä¹ˆæˆ‘ä»¬æœ‰æ²¡æœ‰åŠæ³•çœ‹åˆ°ä»£æ›¿åçš„å¯¹è±¡çš„â€œçœŸå®¹â€å‘¢ï¼Ÿåšä¸€ä¸ªè¿™æ ·çš„æµ‹è¯•ï¼šå°†å†…å­˜ä¸­çš„å¯¹è±¡å­—èŠ‚ç é€šè¿‡æ–‡ä»¶æµè¾“å‡ºåˆ°æ–°çš„.classæ–‡ä»¶ï¼Œç„¶ååˆ©ç”¨åç¼–è¯‘å·¥å…·æŸ¥çœ‹æºä»£ç ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fun.async.test.proxy.Person;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">$proxy0</span> <span class="keyword">extends</span> <span class="title class_">Proxy</span></span><br><span class="line">    <span class="keyword">implements</span> <span class="title class_">Person</span></span><br><span class="line">{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $proxy0(InvocationHandler invocationhandler)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">super</span>(invocationhandler);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> ((Boolean)<span class="built_in">super</span>.h.invoke(<span class="built_in">this</span>, m1, <span class="keyword">new</span> <span class="title class_">Object</span>[] {</span><br><span class="line">                obj</span><br><span class="line">            })).booleanValue();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span>(Error _ex) { }</span><br><span class="line">        <span class="keyword">catch</span>(Throwable throwable)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UndeclaredThrowableException</span>(throwable);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">findLove</span><span class="params">()</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">super</span>.h.invoke(<span class="built_in">this</span>, m3, <span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span>(Error _ex) { }</span><br><span class="line">        <span class="keyword">catch</span>(Throwable throwable)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UndeclaredThrowableException</span>(throwable);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String <span class="title function_">toString</span><span class="params">()</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> (String)<span class="built_in">super</span>.h.invoke(<span class="built_in">this</span>, m2, <span class="literal">null</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span>(Error _ex) { }</span><br><span class="line">        <span class="keyword">catch</span>(Throwable throwable)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UndeclaredThrowableException</span>(throwable);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> ((Integer)<span class="built_in">super</span>.h.invoke(<span class="built_in">this</span>, m0, <span class="literal">null</span>)).intValue();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span>(Error _ex) { }</span><br><span class="line">        <span class="keyword">catch</span>(Throwable throwable)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UndeclaredThrowableException</span>(throwable);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m1;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m3;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m2;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m0;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> </span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        {</span><br><span class="line">            m1 = Class.forName(<span class="string">"java.lang.Object"</span>).getMethod(<span class="string">"equals"</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[] {</span><br><span class="line">                Class.forName(<span class="string">"java.lang.Object"</span>)</span><br><span class="line">            });</span><br><span class="line">            m3 = Class.forName(<span class="string">"com.fun.async.test.proxy.Person"</span>).getMethod(<span class="string">"findLove"</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>]);</span><br><span class="line">            m2 = Class.forName(<span class="string">"java.lang.Object"</span>).getMethod(<span class="string">"toString"</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>]);</span><br><span class="line">            m0 = Class.forName(<span class="string">"java.lang.Object"</span>).getMethod(<span class="string">"hashCode"</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>]);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span>(NoSuchMethodException nosuchmethodexception)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchMethodError</span>(nosuchmethodexception.getMessage());</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span>(ClassNotFoundException classnotfoundexception)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoClassDefFoundError</span>(classnotfoundexception.getMessage());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>â€‹        ä»åç¼–è¯‘çš„ç»“æœæ¥çœ‹ï¼Œ$Proxy0 ç»§æ‰¿äº†Proxyç±»ï¼ŒåŒæ—¶è¿˜å®ç°äº†Personæ¥å£ï¼Œå¹¶ä¸”è¿˜é‡å†™äº†findLove()æ–¹æ³•ã€‚åœ¨é™æ€å—ä¸­ç”¨åå°„æŸ¥æ‰¾åˆ°äº†ç›®æ ‡çš„æ‰€æœ‰æ–¹æ³•ï¼Œè€Œä¸”ä¿å­˜äº†æ‰€æœ‰æ–¹æ³•å¼•ç”¨ï¼Œé‡å†™çš„æ–¹æ³•ç”¨åå°„è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ã€‚ä¸Šé¢è¿™äº›ä»£ç æ˜¯å“ªæ¥çš„ï¼Ÿè¿™æ˜¯JDKè‡ªåŠ¨ç”Ÿæˆçš„ã€‚ç°åœ¨ä¸ä¾èµ–JDKï¼Œè‡ªå·±å®ç°åŠ¨æ€ç”Ÿæˆæºä»£ç ã€åŠ¨æ€å®Œæˆç¼–è¯‘ï¼Œç„¶åæ›¿ä»£å¯¹è±¡å¹¶æ‰§è¡Œã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>å•ä¾‹æ¨¡å¼</title>
    <url>/p/f1601c3e.html</url>
    <content><![CDATA[<html><head></head><body><p>ç¡®ä¿ä¸€ä¸ªç±»åœ¨ä»»ä½•æ—¶å€™éƒ½ç»å¯¹åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚åˆ†ä¸ºé¥¿æ±‰æ¨¡å¼å’Œæ‡’æ±‰æ¨¡å¼ã€‚</p>
<h2 id="é¥¿æ±‰å•ä¾‹æ¨¡å¼"><a href="#é¥¿æ±‰å•ä¾‹æ¨¡å¼" class="headerlink" title="é¥¿æ±‰å•ä¾‹æ¨¡å¼"></a>é¥¿æ±‰å•ä¾‹æ¨¡å¼</h2><p>é¥¿æ±‰æ¨¡å¼é€‚ç”¨äºå•ä¾‹å¯¹è±¡è¾ƒå°‘çš„æƒ…å†µã€‚</p>
<p>å†™æ³•ä¸€ï¼šç›´æ¥åœ¨ä½¿ç”¨ static å…³é”®å­—åˆ›å»ºå¯¹è±¡</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HungrySingleton</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">HungrySingleton</span> <span class="variable">hungrySingleton</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HungrySingleton</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">HungrySingleton</span><span class="params">()</span> {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HungrySingleton <span class="title function_">getInstance</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> hungrySingleton;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å†™æ³•äºŒï¼šä½¿ç”¨ static{} çš„æ–¹å¼åˆ›å»ºå¯¹è±¡</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HungryStaticSingleton</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> HungryStaticSingleton hungrySingleton;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        hungrySingleton = <span class="keyword">new</span> <span class="title class_">HungryStaticSingleton</span>();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HungryStaticSingleton <span class="title function_">getInstance</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> hungrySingleton;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="æ‡’æ±‰å•ä¾‹æ¨¡å¼"><a href="#æ‡’æ±‰å•ä¾‹æ¨¡å¼" class="headerlink" title="æ‡’æ±‰å•ä¾‹æ¨¡å¼"></a>æ‡’æ±‰å•ä¾‹æ¨¡å¼</h2><p>é¡¾åæ€ä¹‰ï¼Œè¢«å¤–éƒ¨è°ƒç”¨çš„æ—¶å€™å†…éƒ¨ç±»æ‰ä¼šåŠ è½½ã€‚</p>
<p>ç®€å•å®ç°ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LazySimpleSingleton</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LazySimpleSingleton</span><span class="params">()</span> {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazySimpleSingleton singleton;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LazySimpleSingleton <span class="title function_">getInstance</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">if</span> (singleton == <span class="literal">null</span>) {</span><br><span class="line">            singleton = <span class="keyword">new</span> <span class="title class_">LazySimpleSingleton</span>();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> singleton;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸Šé¢è¿™ç§æ–¹å¼å­˜åœ¨å®‰å…¨éšæ‚£ï¼Œä¸‹é¢çœ‹ä¸€ä¸ªæ¡ˆä¾‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExecutorThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> {</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">LazySimpleSingleton</span> <span class="variable">singleton</span> <span class="operator">=</span> LazySimpleSingleton.getInstance();</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">" -&gt; "</span> + singleton);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">     	<span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">ExecutorThread</span>()).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">ExecutorThread</span>()).start();</span><br><span class="line">        System.out.println(<span class="string">"=============END=============="</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">=============END==============</span><br><span class="line">Thread-0 -&gt; com.fun.DesignPatterns.singleton.LazySimpleSingleton@2ca9c4e8</span><br><span class="line">Thread-1 -&gt; com.fun.DesignPatterns.singleton.LazySimpleSingleton@4e3058f8</span><br></pre></td></tr></tbody></table></figure>

<p>ç»“æœæœ‰çš„æ—¶å€™ä¸€è‡´æœ‰çš„æ—¶å€™ä¸ä¸€è‡´ï¼Œå‘ç°åœ¨çº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œè¿™ä¸ªå¯¹è±¡è¢«å®ä¾‹åŒ–äº†ä¸¤æ¬¡ã€‚ç»™SimpleSigleton åˆ›å»ºå¯¹è±¡çš„æ–¹æ³•åŠ ä¸Š synchronized ä¿®é¥°ç¬¦ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LazySimpleSingleton</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LazySimpleSingleton</span><span class="params">()</span> {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazySimpleSingleton singleton;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> LazySimpleSingleton <span class="title function_">getInstance</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">if</span> (singleton == <span class="literal">null</span>) {</span><br><span class="line">            singleton = <span class="keyword">new</span> <span class="title class_">LazySimpleSingleton</span>();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> singleton;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç°åœ¨çº¿ç¨‹çš„å®‰å…¨é—®é¢˜è§£å†³äº†ï¼Œä½†æ˜¯å¦‚æœåœ¨çº¿ç¨‹æ•°é‡æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹åŠ é”ï¼Œä¼šè®©CPUåˆ†é…å‹åŠ›å¢å¤§ï¼Œå¯¼è‡´å¤§é‡çº¿ç¨‹é˜»å¡ï¼Œä»è€Œé™ä½ç¨‹åºæ€§èƒ½ï¼Œç»§ç»­æ”¹è¿›ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LazyDoubleCheckSingleton</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> <span class="type">LazyDoubleCheckSingleton</span> <span class="variable">singleton</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LazyDoubleCheckSingleton</span><span class="params">()</span> {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LazyDoubleCheckSingleton <span class="title function_">getInstance</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">if</span> (singleton == <span class="literal">null</span>) {</span><br><span class="line">            <span class="keyword">synchronized</span> (LazyDoubleCheckSingleton.class) {</span><br><span class="line">                <span class="keyword">if</span> (singleton == <span class="literal">null</span>) {</span><br><span class="line">                    singleton = <span class="keyword">new</span> <span class="title class_">LazyDoubleCheckSingleton</span>();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> singleton;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸Šé¢ä½¿ç”¨åŒé‡æ£€æŸ¥é”ï¼ˆDCL-Double Check Lockï¼‰çš„å•ä¾‹æ¨¡å¼æ—¢èƒ½å…¼é¡¾çº¿ç¨‹åˆèƒ½æå‡ç¨‹åºæ€§èƒ½ã€‚ä½†ç»ˆå½’æ˜¯éœ€è¦ä¸Šé”ï¼Œå¯¹æ€§èƒ½è¿˜æ˜¯æœ‰ä¸€å®šçš„å½±å“ï¼Œè¿˜æœ‰ä¸‹é¢è¿™ç§æ›´å¥½çš„çš„æ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LazyInnerClassSingleton</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LazyInnerClassSingleton</span><span class="params">()</span> {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™ç§å½¢å¼å¦‚æœå½“å‰ç±»æ²¡æœ‰è¢«ä½¿ç”¨å†…éƒ¨ç±»é»˜è®¤æ˜¯ä¸è¢«åŠ è½½çš„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">LazyHolder</span> {</span><br><span class="line">        <span class="comment">// åœ¨è¿”å›ç»“æœä»¥å‰ï¼Œä¸€å®šä¼šå…ˆåŠ è½½å†…éƒ¨ç±»</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">LazyInnerClassSingleton</span> <span class="variable">LAZY</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LazyInnerClassSingleton</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¯ä¸€ä¸ªå…³é”®å­—éƒ½ä¸å¤šä½™ï¼šstaticè®©å•ä¾‹ç©ºé—´å…±äº«ã€ä¸è¢«é‡å†™ã€é‡è½½</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> LazyInnerClassSingleton <span class="title function_">getInstance</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> LazyHolder.LAZY;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹å°±å¾ˆæ˜æ˜¾äº†ï¼šä¸ä¸Šé”ã€æå‡æ€§èƒ½ã€çº¿ç¨‹å®‰å…¨ã€æ‡’åŠ è½½ã€‚æ­¤å¤–ï¼Œé¢è¯•ç»å¸¸è¢«é—®çš„é—®é¢˜è¿˜æœ‰ä»¥ä¸‹å‡ ç‚¹ã€‚</p>
<p>å•ä¾‹æ¨¡å¼è¢«ç ´åçš„é—®é¢˜ï¼šåå°„ç ´åã€åºåˆ—åŒ–ç ´åã€å…‹éš†ç ´åï¼ˆä¸‹ä¸€èŠ‚ï¼Œè¯·è§åŸå‹æ¨¡å¼ï¼‰ã€‚è§£å†³æ–¹æ³•ä¸‹é¢ç¬¬ä¸‰ç‚¹ï¼š</p>
<h2 id="æ³¨å†Œå¼å•ä¾‹æ¨¡å¼"><a href="#æ³¨å†Œå¼å•ä¾‹æ¨¡å¼" class="headerlink" title="æ³¨å†Œå¼å•ä¾‹æ¨¡å¼"></a>æ³¨å†Œå¼å•ä¾‹æ¨¡å¼</h2><p>æ³¨å†Œå¼å•ä¾‹åˆç§°ä¸ºç™»è®°å¼å•ä¾‹ï¼Œå°±æ˜¯å°†æ¯ä¸€ä¸ªå®ä¾‹éƒ½ç™»è®°åˆ°æŸä¸€ä¸ªåœ°æ–¹ï¼Œä½¿ç”¨å”¯ä¸€çš„æ ‡è¯†è·å–å®ä¾‹ã€‚</p>
<h3 id="æšä¸¾å¼å•ä¾‹æ¨¡å¼"><a href="#æšä¸¾å¼å•ä¾‹æ¨¡å¼" class="headerlink" title="æšä¸¾å¼å•ä¾‹æ¨¡å¼"></a>æšä¸¾å¼å•ä¾‹æ¨¡å¼</h3><p>æšä¸¾å¼å•ä¾‹å¯é¿å…åºåˆ—åŒ–ç ´åå’Œåå°„ç ´åã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">EnumSingleton</span> {</span><br><span class="line">    INSTANCE;</span><br><span class="line">    <span class="keyword">private</span> Object data;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getData</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setData</span><span class="params">(Object data)</span> {</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> EnumSingleton <span class="title function_">getInstance</span><span class="params">()</span>{</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="å®¹å™¨ç¼“å­˜å•ä¾‹æ¨¡å¼"><a href="#å®¹å™¨ç¼“å­˜å•ä¾‹æ¨¡å¼" class="headerlink" title="å®¹å™¨ç¼“å­˜å•ä¾‹æ¨¡å¼"></a>å®¹å™¨ç¼“å­˜å•ä¾‹æ¨¡å¼</h3><p>å®¹å™¨å¼å•ä¾‹é€‚ç”¨äºåˆ›å»ºå®ä¾‹éå¸¸å¤šçš„æƒ…å†µï¼Œä¾¿äºç®¡ç†ã€‚ä½†æ˜¯ï¼Œæ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContainerSingleton</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">ContainerSingleton</span><span class="params">()</span>{}</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String,Object&gt; ioc=<span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String,Object&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getBean</span><span class="params">(String className)</span>{</span><br><span class="line">        <span class="keyword">synchronized</span> (ioc){</span><br><span class="line">            <span class="keyword">if</span>(!ioc.containsKey(className)){</span><br><span class="line">                Object obj=<span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    obj=Class.forName(className);</span><br><span class="line">                    ioc.put(className,obj);</span><br><span class="line">                } <span class="keyword">catch</span> (ClassNotFoundException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">return</span> obj;</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                <span class="keyword">return</span> ioc.get(className);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åˆ°æ­¤æ³¨å†Œå¼å•ä¾‹æ¨¡å¼å°±å®Œäº†ï¼Œä¸‹é¢åœ¨è¡¥å……ä¸€ç§ThreadLocalå®ç°å•ä¾‹æ¨¡å¼çš„æ¡ˆä¾‹ï¼š</p>
<h3 id="ThreadLocal-å•ä¾‹æ¨¡å¼"><a href="#ThreadLocal-å•ä¾‹æ¨¡å¼" class="headerlink" title="ThreadLocal å•ä¾‹æ¨¡å¼"></a>ThreadLocal å•ä¾‹æ¨¡å¼</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalSingleton</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ThreadLocalSingleton</span><span class="params">()</span> {}</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;ThreadLocalSingleton&gt; singleton = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;ThreadLocalSingleton&gt;() {</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> ThreadLocalSingleton <span class="title function_">initialValue</span><span class="params">()</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadLocalSingleton</span>();</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ThreadLocalSingleton <span class="title function_">getInstance</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> singleton.get();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</body></html>]]></content>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>ç­–ç•¥æ¨¡å¼</title>
    <url>/p/72e3b671.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h2><ol>
<li>é’ˆå¯¹åŒä¸€ç±»å‹çš„é—®é¢˜æœ‰å¤šç§å¤„ç†æ–¹å¼ï¼Œä»…ä»…æ˜¯å…·ä½“çš„è¡Œä¸ºæœ‰å·®åˆ«æ—¶ã€‚</li>
<li>éœ€è¦å®‰å…¨çš„å°è£…å¤šç§åŒä¸€ç±»å‹çš„æ“ä½œæ—¶ã€‚</li>
<li>å‡ºç°åŒä¸€æŠ½è±¡ç±»çš„å¤šä¸ªå­ç±»ï¼Œè€Œåˆéœ€è¦ä½¿ç”¨if-elseæ¥é€‰æ‹©å­ç±»æ—¶ã€‚</li>
</ol>
<h2 id="ç”¨ç­–ç•¥æ¨¡å¼å®ç°é€‰æ‹©æ”¯ä»˜æ–¹å¼çš„ä¸šåŠ¡åœºæ™¯"><a href="#ç”¨ç­–ç•¥æ¨¡å¼å®ç°é€‰æ‹©æ”¯ä»˜æ–¹å¼çš„ä¸šåŠ¡åœºæ™¯" class="headerlink" title="ç”¨ç­–ç•¥æ¨¡å¼å®ç°é€‰æ‹©æ”¯ä»˜æ–¹å¼çš„ä¸šåŠ¡åœºæ™¯"></a>ç”¨ç­–ç•¥æ¨¡å¼å®ç°é€‰æ‹©æ”¯ä»˜æ–¹å¼çš„ä¸šåŠ¡åœºæ™¯</h2><p>åœ¨å•†åŸç³»ç»Ÿä¸­ï¼Œå¸¸å¸¸å­˜åœ¨å¤šç§ç­–ç•¥çš„ä¼˜æƒ æ´»åŠ¨ï¼Œæ¯”å¦‚æ‹¼å›¢ã€è¿”ç°ä¿ƒé”€ã€ä¼˜æƒ åˆ¸æŠµæ‰£ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿè¿™ä¸ªåœºæ™¯çš„demoï¼š</p>
<p>ä¿ƒé”€ç­–ç•¥çš„æ¥å£ PromotionStrategyï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PromotionStrategy</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doPromotion</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¼˜æƒ åˆ¸æŠµæ‰£ç­–ç•¥ CouponStrategyï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CouponStrategy</span> <span class="keyword">implements</span> <span class="title class_">PromotionStrategy</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doPromotion</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"é¢†å–ä¼˜æƒ åˆ¸ï¼Œè¯¾ç¨‹ä»·æ ¼ç›´æ¥æŠµæ‰£ä¼˜æƒ åˆ¸é¢å€¼"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿”ç°ä¿ƒé”€ç­–ç•¥ CashbackStrategyï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CashbackStrategy</span> <span class="keyword">implements</span> <span class="title class_">PromotionStrategy</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doPromotion</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"è¿”ç°ä¿ƒé”€ï¼Œè¿”å›ç°é‡‘åˆ°æ”¯ä»˜å®è´¦æˆ·"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ‹¼å›¢ç­–ç•¥ GroupBuyStrategyï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GroupBuyStrategy</span> <span class="keyword">implements</span> <span class="title class_">PromotionStrategy</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doPromotion</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"æ‹¼å›¢ï¼Œæ»¡20äººï¼Œå…¨å›¢äº«å—å›¢ä»·"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å½“ç„¶è¿˜æœ‰ä¸€ä¸ªæ— ä¼˜æƒ æ´»åŠ¨ç­–ç•¥ EmptyStrategyï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmptyStrategy</span> <span class="keyword">implements</span> <span class="title class_">PromotionStrategy</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doPromotion</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"æ— ä¿ƒé”€æ´»åŠ¨"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¿ƒé”€æ´»åŠ¨æ–¹æ¡ˆç±» PromotionActivityï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PromotionActivity</span> {</span><br><span class="line">    <span class="keyword">private</span> PromotionStrategy promotionStrategy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PromotionActivity</span><span class="params">(PromotionStrategy promotionStrategy)</span> {</span><br><span class="line">        <span class="built_in">this</span>.promotionStrategy = promotionStrategy;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> {</span><br><span class="line">        promotionStrategy.doPromotion();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æµ‹è¯•ç±»ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PromotionTest</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">PromotionActivity</span> <span class="variable">activity618</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PromotionActivity</span>(<span class="keyword">new</span> <span class="title class_">CashbackStrategy</span>());</span><br><span class="line">        <span class="type">PromotionActivity</span> <span class="variable">activity1111</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PromotionActivity</span>(<span class="keyword">new</span> <span class="title class_">CouponStrategy</span>());</span><br><span class="line">        activity618.execute();</span><br><span class="line">        activity1111.execute();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç±»ç»“æ„</p>
<p><img src="/p/72e3b671/image-20220413232601362.png" alt="image-20220413232601362"></p>
<p>ä»æµ‹è¯•ç±»æ¥çœ‹ï¼Œä¸€æ¬¡å¼€å¯äº†å¤šé¡¹ä¼˜æƒ æ´»åŠ¨ï¼Œä½†æˆ‘ä»¬é€šå¸¸å¹¶ä¸ä¼šä¸€æ¬¡æ€§æ‰§è¡Œå¤šç§ä¼˜æƒ ï¼Œæ‰€ä»¥è¿›è¡Œæ”¹é€ ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PromotionTest</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">PromotionActivity</span> <span class="variable">activity</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">promotionKey</span> <span class="operator">=</span> <span class="string">"COUPON"</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"COUPON"</span>.equals(promotionKey)) {</span><br><span class="line">            activity = <span class="keyword">new</span> <span class="title class_">PromotionActivity</span>(<span class="keyword">new</span> <span class="title class_">CouponStrategy</span>());</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"CASHBACK"</span>.equals(promotionKey)) {</span><br><span class="line">            activity = <span class="keyword">new</span> <span class="title class_">PromotionActivity</span>(<span class="keyword">new</span> <span class="title class_">CashbackStrategy</span>());</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            activity = <span class="keyword">new</span> <span class="title class_">PromotionActivity</span>(<span class="keyword">new</span> <span class="title class_">EmptyStrategy</span>());</span><br><span class="line">        }</span><br><span class="line">        activity.execute();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™æ ·å°±æ»¡è¶³äº†ä¸šåŠ¡éœ€æ±‚ï¼Œä½†æ˜¯éšç€ä¼˜æƒ æ´»åŠ¨çš„å¢å¤šï¼Œåˆ¤æ–­é€»è¾‘è¶Šæ¥è¶Šå¤æ‚ï¼Œç¼–å†™å¥½æ´»åŠ¨ä»£ç åéœ€è¦é‡å¤æµ‹è¯•ï¼Œä¼šå¤§å¤§å¢åŠ å·¥ä½œé‡ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç»“åˆå·¥å‚æ¨¡å¼å’Œå•ä¾‹æ¨¡å¼æ¥å¯¹æ­¤è¿›è¡Œä¼˜åŒ–ï¼š</p>
<p>æ–°å¢æ´»åŠ¨ç­–ç•¥å·¥å‚ç±» PromotionStrategyFactory ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PromotionStrategyFactory</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, PromotionStrategy&gt; PROMOTION_STRATEGY_MAP = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">PromotionStrategy</span> <span class="variable">NON_PROMOTION</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmptyStrategy</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        PROMOTION_STRATEGY_MAP.put(PromotionKey.COUPON, <span class="keyword">new</span> <span class="title class_">CouponStrategy</span>());</span><br><span class="line">        PROMOTION_STRATEGY_MAP.put(PromotionKey.CASHBACK, <span class="keyword">new</span> <span class="title class_">CashbackStrategy</span>());</span><br><span class="line">        PROMOTION_STRATEGY_MAP.put(PromotionKey.GROUPBUY, <span class="keyword">new</span> <span class="title class_">GroupBuyStrategy</span>());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">interface</span> <span class="title class_">PromotionKey</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">COUPON</span> <span class="operator">=</span> <span class="string">"COUPON"</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">CASHBACK</span> <span class="operator">=</span> <span class="string">"CASHBACK"</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">GROUPBUY</span> <span class="operator">=</span> <span class="string">"GROUPBUY"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PromotionStrategyFactory</span><span class="params">()</span> {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PromotionStrategy <span class="title function_">getPromotionStrategy</span><span class="params">(String promotionKey)</span> {</span><br><span class="line">        <span class="type">PromotionStrategy</span> <span class="variable">promotionStrategy</span> <span class="operator">=</span> PROMOTION_STRATEGY_MAP.get(promotionKey);</span><br><span class="line">        <span class="type">return</span> <span class="variable">promotionStrategy</span> <span class="operator">=</span>= <span class="literal">null</span> ? NON_PROMOTION : promotionStrategy;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PromotionTest</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">promotionKey</span> <span class="operator">=</span> <span class="string">"COUPON"</span>;</span><br><span class="line">        <span class="type">PromotionStrategy</span> <span class="variable">strategy</span> <span class="operator">=</span> PromotionStrategyFactory.getPromotionStrategy(promotionKey);</span><br><span class="line">        <span class="type">PromotionActivity</span> <span class="variable">activity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PromotionActivity</span>(strategy);</span><br><span class="line">        activity.execute();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å¦‚æ­¤ä¸€ä¼˜åŒ–ï¼Œç›´æ¥åˆ é™¤äº†é€»è¾‘åˆ¤æ–­ï¼Œæ¯æ¬¡æ–°å¢æ´»åŠ¨æ—¶éƒ½ä¼šè½»æ¾å¾ˆå¤šã€‚å†ä¸¾ä¸€ä¸ªæ”¯ä»˜çš„æ¡ˆä¾‹ï¼Œå¦‚æœå¯¹æ¥è¿‡é“¶è”ã€ç™¾åº¦æ”¶é“¶å°ã€äº¬ä¸œã€QQã€æ”¯ä»˜å®ã€å¾®ä¿¡ç­‰æ”¯ä»˜çš„æœ‹å‹çœ‹äº†ä¸‹é¢è¿™ä¸ªæ¡ˆä¾‹ï¼Œç»å¯¹æ·±æœ‰ä½“ä¼šã€‚</p>
<h2 id="æ”¯ä»˜æ¡ˆä¾‹"><a href="#æ”¯ä»˜æ¡ˆä¾‹" class="headerlink" title="æ”¯ä»˜æ¡ˆä¾‹"></a>æ”¯ä»˜æ¡ˆä¾‹</h2><p>æ‰€æœ‰çš„æ”¯ä»˜æ–¹å¼éƒ½æœ‰ åç§°ã€æ”¯ä»˜ã€æŸ¥è¯¢ä½™é¢ç­‰è¡Œä¸ºï¼ŒæŠ½å–æˆä¸€ä¸ªæ”¯ä»˜æ–¹å¼çš„æŠ½è±¡ç±» Paymentï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Payment</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title function_">getName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€šç”¨é€»è¾‘æ”¾åˆ°æŠ½è±¡ç±»é‡Œé¢å®ç°</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">pay</span><span class="params">(String uid, <span class="type">double</span> amount)</span> {</span><br><span class="line">        <span class="comment">//ä½™é¢æ˜¯å¦è¶³å¤Ÿ</span></span><br><span class="line">        <span class="keyword">if</span> (queryBalance(uid) &lt; amount) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R</span>(<span class="number">500</span>, <span class="string">"æ”¯ä»˜å¤±è´¥"</span>, <span class="string">"ä½™é¢ä¸è¶³"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R</span>(<span class="number">200</span>, <span class="string">"æ”¯ä»˜æˆåŠŸ"</span>, <span class="string">"æ”¯ä»˜é‡‘é¢"</span> + amount);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="type">double</span> <span class="title function_">queryBalance</span><span class="params">(String uid)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>R æ˜¯ä¸€ä¸ªç»Ÿä¸€è¿”å›ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">R</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> Object data;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">R</span><span class="params">(<span class="type">int</span> code, String msg, Object data)</span> {</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"{"</span> +</span><br><span class="line">                <span class="string">"code="</span> + code +</span><br><span class="line">                <span class="string">", data="</span> + data +</span><br><span class="line">                <span class="string">", msg='"</span> + msg + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'}'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>AliPay</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliPay</span> <span class="keyword">extends</span> <span class="title class_">Payment</span> {</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"æ”¯ä»˜å®"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">double</span> <span class="title function_">queryBalance</span><span class="params">(String uid)</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">900</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>JDPay</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDPay</span> <span class="keyword">extends</span> <span class="title class_">Payment</span> {</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"äº¬ä¸œç™½æ¡"</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">double</span> <span class="title function_">queryBalance</span><span class="params">(String uid)</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">500</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>UnionPay</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnionPay</span> <span class="keyword">extends</span> <span class="title class_">Payment</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"é“¶è”æ”¯ä»˜"</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">double</span> <span class="title function_">queryBalance</span><span class="params">(String uid)</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">120</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>WeChatPay</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeChatPay</span> <span class="keyword">extends</span> <span class="title class_">Payment</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"å¾®ä¿¡æ”¯ä»˜"</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">double</span> <span class="title function_">queryBalance</span><span class="params">(String uid)</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">263</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>è®¢å•ç±» Order</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> {</span><br><span class="line">    <span class="keyword">private</span> String uid;</span><br><span class="line">    <span class="keyword">private</span> String orderId;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> amount;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Order</span><span class="params">(String uid, String orderId, <span class="type">double</span> amount)</span> {</span><br><span class="line">        <span class="built_in">this</span>.uid = uid;</span><br><span class="line">        <span class="built_in">this</span>.orderId = orderId;</span><br><span class="line">        <span class="built_in">this</span>.amount = amount;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">pay</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> pay(PayStrategy.DEFAULT_PAY);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®Œç¾è§£å†³ if...else æˆ–è€… switch</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">pay</span><span class="params">(String payKey)</span> {</span><br><span class="line">        <span class="type">Payment</span> <span class="variable">payment</span> <span class="operator">=</span> PayStrategy.get(payKey);</span><br><span class="line">        System.out.println(<span class="string">"æ¬¢è¿ä½¿ç”¨"</span> + payment.getName());</span><br><span class="line">        System.out.println(<span class="string">"æœ¬æ¬¡äº¤æ˜“é‡‘é¢ä¸º"</span> + amount + <span class="string">"ï¼Œå¼€å§‹æ‰£æ¬¾"</span>);</span><br><span class="line">        <span class="keyword">return</span> payment.pay(uid, amount);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>PayStrategy</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayStrategy</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ALI_PAY</span> <span class="operator">=</span> <span class="string">"AliPay"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JD_PAY</span> <span class="operator">=</span> <span class="string">"JdPay"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">WECHAT_PAY</span> <span class="operator">=</span> <span class="string">"WeChatPay"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">UNION_PAY</span> <span class="operator">=</span> <span class="string">"UnionPay"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_PAY</span> <span class="operator">=</span> ALI_PAY;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Payment&gt; strategy = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Payment&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        strategy.put(ALI_PAY, <span class="keyword">new</span> <span class="title class_">AliPay</span>());</span><br><span class="line">        strategy.put(JD_PAY, <span class="keyword">new</span> <span class="title class_">JDPay</span>());</span><br><span class="line">        strategy.put(WECHAT_PAY, <span class="keyword">new</span> <span class="title class_">WeChatPay</span>());</span><br><span class="line">        strategy.put(UNION_PAY, <span class="keyword">new</span> <span class="title class_">UnionPay</span>());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Payment <span class="title function_">get</span><span class="params">(String payKey)</span> {</span><br><span class="line">        <span class="keyword">if</span> (!strategy.containsKey(payKey)) {</span><br><span class="line">            <span class="keyword">return</span> strategy.get(DEFAULT_PAY);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> strategy.get(payKey);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æµ‹è¯•ç±» Test</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayTest</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>(<span class="string">"1"</span>, <span class="string">"123456789123"</span>, <span class="number">325</span>);</span><br><span class="line">        <span class="type">R</span> <span class="variable">result</span> <span class="operator">=</span> order.pay(PayStrategy.ALI_PAY);</span><br><span class="line"></span><br><span class="line">        System.out.println(result);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h2><p>ä¼˜ç‚¹ï¼š</p>
<p>1ã€ç­–ç•¥æ¨¡å¼ç¬¦åˆå¼€é—­åŸåˆ™ã€‚</p>
<p>2ã€é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶è½¬ç§»è¯­å¥ï¼Œå¦‚ifâ€¦elseâ€¦è¯­å¥ã€switch è¯­å¥</p>
<p>3ã€ä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥æé«˜ç®—æ³•çš„ä¿å¯†æ€§å’Œå®‰å…¨æ€§ã€‚</p>
<p>ç¼ºç‚¹ï¼š</p>
<p>1ã€å®¢æˆ·ç«¯å¿…é¡»çŸ¥é“æ‰€æœ‰çš„ç­–ç•¥ï¼Œå¹¶ä¸”è‡ªè¡Œå†³å®šä½¿ç”¨å“ªä¸€ä¸ªç­–ç•¥ç±»ã€‚</p>
<p>2ã€ä»£ç ä¸­ä¼šäº§ç”Ÿéå¸¸å¤šç­–ç•¥ç±»ï¼Œå¢åŠ ç»´æŠ¤éš¾åº¦ã€‚</p>
<h2 id="ç®€å•å®ç°Springä¸­çš„-DispatcherServlet"><a href="#ç®€å•å®ç°Springä¸­çš„-DispatcherServlet" class="headerlink" title="ç®€å•å®ç°Springä¸­çš„ DispatcherServlet"></a>ç®€å•å®ç°Springä¸­çš„ DispatcherServlet</h2><p>æˆ‘ä»¬å¸¸ç”¨çš„ä¸¤ç§ä¸¤ç§æ¶æ„é£æ ¼ï¼šRESTå’ŒRPCï¼ŒREST API çš„æ¯ä¸ªURIå¯¹åº”çš„éƒ½æ˜¯æŸä¸€ä»½èµ„æºï¼Œåœ¨æˆ‘ä»¬é€šè¿‡Springçš„Controllerçš„URIè¿›è¡Œè®¿é—®èµ„æºæ—¶ï¼Œä¼šç»è¿‡DispatchServletåˆ†å‘ç»™å¯¹åº”çš„Servletã€‚åœ¨J2EEçš„æ ‡å‡†ä¸­ï¼Œæ¯ä¸€ä¸ªURLå¯¹åº”ä¸€ä¸ªServletã€‚</p>
<p><strong>ä¼šå‘˜æ§åˆ¶å™¨</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberController</span> {</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getMemberById</span><span class="params">(<span class="type">int</span> id)</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p><strong>è®¢å•æ§åˆ¶å™¨ï¼š</strong></p>
<pre><code>public class OrderController {
    public Object getOrderById(int id) {
        return null;
    }
}
</code></pre>
<p><strong>DispatcherServlet</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * SpringMVCçš„å§”æ´¾æ¨¡å¼å°±æ˜¯é€šè¿‡DispatcherServletå°†è¯·æ±‚çš„URIè½¬ä¸ºä¸åŒçš„javaä»£ç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DispatcherServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Handler&gt; handlerMapping = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            handlerMapping.add(<span class="keyword">new</span> <span class="title class_">Handler</span>().setUri(<span class="string">"/web/getMemberById"</span>).setController(MemberController.class.newInstance()).setMethod(MemberController.class.getMethod(<span class="string">"getMemberById"</span>, <span class="type">int</span>.class)));</span><br><span class="line">            handlerMapping.add(<span class="keyword">new</span> <span class="title class_">Handler</span>().setUri(<span class="string">"/web/getOrderById"</span>).setController(OrderController.class.newInstance()).setMethod(OrderController.class.getMethod(<span class="string">"getOrderById"</span>, <span class="type">int</span>.class)));</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException {</span><br><span class="line">        doDispatcher(req, resp);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨ç­–ç•¥æ¨¡å¼å»æ‰å¤šä¸ªif-elseåˆ¤æ–­</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doDispatcher</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">requestURI</span> <span class="operator">=</span> req.getRequestURI();</span><br><span class="line">        <span class="type">Handler</span> <span class="variable">h</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (Handler handler : handlerMapping) {</span><br><span class="line">            <span class="keyword">if</span> (Objects.equals(handler.getUri(), requestURI)) {</span><br><span class="line">                h = handler;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            h.getMethod().invoke(h.getController(), Integer.parseInt(req.getParameter(<span class="string">"mid"</span>)));</span><br><span class="line">        } <span class="keyword">catch</span> (IllegalAccessException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">catch</span> (InvocationTargetException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Handler</span> {</span><br><span class="line">        String uri;</span><br><span class="line">        Object controller;</span><br><span class="line">        Method method;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getUri</span><span class="params">()</span> {</span><br><span class="line">            <span class="keyword">return</span> uri;</span><br><span class="line">        }</span><br><span class="line">		</span><br><span class="line">        <span class="comment">// è¿”å›thisæ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„é“¾å¼</span></span><br><span class="line">        <span class="keyword">public</span> Handler <span class="title function_">setUri</span><span class="params">(String uri)</span> {</span><br><span class="line">            <span class="built_in">this</span>.uri = uri;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Object <span class="title function_">getController</span><span class="params">()</span> {</span><br><span class="line">            <span class="keyword">return</span> controller;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Handler <span class="title function_">setController</span><span class="params">(Object controller)</span> {</span><br><span class="line">            <span class="built_in">this</span>.controller = controller;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Method <span class="title function_">getMethod</span><span class="params">()</span> {</span><br><span class="line">            <span class="keyword">return</span> method;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Handler <span class="title function_">setMethod</span><span class="params">(Method method)</span> {</span><br><span class="line">            <span class="built_in">this</span>.method = method;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
</body></html>]]></content>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¨¡æ¿æ¨¡å¼</title>
    <url>/p/150e036b.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><ul>
<li><p>å®šä¹‰äº†ä¸€ä¸ªç®—æ³•çš„éª¨æ¶ï¼Œå¹¶å…è®¸å­ç±»ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤æä¾›å®ç°ã€‚</p>
</li>
<li><p>å‡†å¤‡ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå°†éƒ¨åˆ†é€»è¾‘ä»¥å…·ä½“æ–¹æ³•ä»¥åŠå…·ä½“æ„é€ å‡½æ•°çš„å½¢å¼å®ç°ï¼Œç„¶åå£°æ˜ä¸€äº›æŠ½è±¡æ–¹æ³•æ¥è¿«ä½¿å­ç±»å®ç°å‰©ä½™çš„é€»è¾‘ã€‚</p>
</li>
<li><p>ä¸åŒçš„å­ç±»å¯ä»¥ä»¥ä¸åŒçš„æ–¹å¼å®ç°è¿™äº›æŠ½è±¡æ–¹æ³•ï¼Œä»è€Œå¯¹å‰©ä½™çš„é€»è¾‘æœ‰ä¸åŒçš„å®ç°ã€‚è¿™å°±æ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„ç”¨æ„ã€‚</p>
</li>
</ul>
<h2 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h2><ul>
<li>ä¸€æ¬¡æ€§å®ç°ä¸€ä¸ªç®—æ³•ä¸å˜çš„éƒ¨åˆ†ï¼Œå¹¶å°†å¯å˜çš„è¡Œä¸ºç•™ç»™å­ç±»æ¥å®ç°ã€‚</li>
<li>æå–å­ç±»é‡å¤å®ç°çš„æ–¹æ³•ï¼Œæ”¾åœ¨è¶…ç±»ä¸­ã€‚</li>
<li>æ§åˆ¶å­ç±»çš„æ‰©å±•ï¼Œå¿…é¡»éµå¾ªè¿™ä¸€å¥—æµç¨‹è§„åˆ™ã€‚</li>
</ul>
<h2 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h2><p>è¿™æ˜¯ä¸€ä¸ªç‚’èœçš„æ¡ˆä¾‹ï¼Œè´´è¿‘ç”Ÿæ´»ï¼Œç®€å•æ˜“æ‡‚ã€‚</p>
<p>CookTemplateï¼šç‚’èœçš„ä¸€å¥—æ¨¡æ¿</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">CookTemplate</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœä¸å¸Œæœ›å­ç±»è¦†ç›–æ­¤æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨final å…³é”®å­—ä¿®é¥°</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">create</span><span class="params">()</span> {</span><br><span class="line">        <span class="comment">//ç¬¬ä¸€æ­¥ï¼šå€’æ²¹</span></span><br><span class="line">        <span class="built_in">this</span>.pourOil();</span><br><span class="line">        <span class="comment">//ç¬¬äºŒæ­¥ï¼šçƒ­æ²¹</span></span><br><span class="line">        <span class="built_in">this</span>.HeatOil();</span><br><span class="line">        <span class="comment">//ç¬¬ä¸‰æ­¥ï¼šå€’è”¬èœ</span></span><br><span class="line">        <span class="built_in">this</span>.pourVegetable();</span><br><span class="line">        <span class="comment">//ç¬¬å››æ­¥ï¼šå€’è°ƒå‘³æ–™</span></span><br><span class="line">        <span class="built_in">this</span>.pourSauce();</span><br><span class="line">        <span class="comment">//ç¬¬äº”æ­¥ï¼šç¿»ç‚’</span></span><br><span class="line">        <span class="built_in">this</span>.fry();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç¬¬ä¸€æ­¥ï¼šå€’æ²¹æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ç›´æ¥å®ç°</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pourOil</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"å€’æ²¹"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç¬¬äºŒæ­¥ï¼šçƒ­æ²¹æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ç›´æ¥å®ç°</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">HeatOil</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"çƒ­æ²¹"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç¬¬ä¸‰æ­¥ï¼šç‚’ä»€ä¹ˆèœè®©å­ç±»å†³å®š</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">pourVegetable</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç¬¬å››æ­¥ï¼šè¿™ä¸ªèœéœ€è¦åŠ ä»€ä¹ˆè°ƒæ–™ç”±å­ç±»å†³å®š</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">pourSauce</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç¬¬äº”æ­¥ï¼šç¿»ç‚’æ˜¯ä¸€æ ·çš„</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fry</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"ç¿»ç‚’ç›´åˆ°ç‚’ç†Ÿ"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>CookBaoCaiï¼šç‚’åŒ…èœ</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CookBaoCai</span> <span class="keyword">extends</span> <span class="title class_">CookTemplate</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pourVegetable</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"å€’å…¥åŒ…èœ"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pourSauce</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"åŠ å…¥åŒ…èœçš„è°ƒå‘³æ–™"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>CookHuaCaiï¼šç‚’èŠ±èœ</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CookHuaCai</span> <span class="keyword">extends</span> <span class="title class_">CookTemplate</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pourVegetable</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"å€’å…¥èŠ±èœ"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pourSauce</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"åŠ å…¥èŠ±èœçš„è°ƒå‘³æ–™"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Testï¼šæµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TemplateTest</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">CookBaoCai</span> <span class="variable">cookBaoCai</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CookBaoCai</span>();</span><br><span class="line">        cookBaoCai.create();</span><br><span class="line">        System.out.println(<span class="string">"====================="</span>);</span><br><span class="line">        <span class="type">CookHuaCai</span> <span class="variable">cookHuaCai</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CookHuaCai</span>();</span><br><span class="line">        cookHuaCai.create();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h2><p>ä¼˜ç‚¹</p>
<p>ï¼ˆ1ï¼‰æé«˜ä»£ç å¤ç”¨æ€§ã€‚å°†ç›¸åŒéƒ¨åˆ†çš„ä»£ç æ”¾åœ¨æŠ½è±¡çš„è¶…ç±»ä¸­ã€‚</p>
<p>ï¼ˆ2ï¼‰æé«˜äº†æ‹“å±•æ€§ã€‚å°†ä¸åŒçš„ä»£ç æ”¾å…¥ä¸åŒçš„å­ç±»ä¸­ï¼Œé€šè¿‡å¯¹å­ç±»çš„æ‰©å±•å¢åŠ æ–°çš„è¡Œä¸ºã€‚</p>
<p>ï¼ˆ3ï¼‰å®ç°äº†åå‘æ§åˆ¶ã€‚é€šè¿‡ä¸€ä¸ªçˆ¶ç±»è°ƒç”¨å…¶å­ç±»çš„æ“ä½œï¼Œé€šè¿‡å¯¹å­ç±»çš„æ‰©å±•å¢åŠ æ–°çš„è¡Œä¸ºï¼Œå®ç°äº†åå‘æ§åˆ¶ &amp; ç¬¦åˆâ€œå¼€é—­åŸåˆ™â€ã€‚</p>
<p>ç¼ºç‚¹</p>
<p>â€‹    å¼•å…¥äº†æŠ½è±¡ç±»ï¼Œæ¯ä¸€ä¸ªä¸åŒçš„å®ç°éƒ½éœ€è¦ä¸€ä¸ªå­ç±»æ¥å®ç°ï¼Œå¯¼è‡´ç±»çš„ä¸ªæ•°å¢åŠ ï¼Œä»è€Œå¢åŠ äº†ç³»ç»Ÿå®ç°çš„å¤æ‚åº¦ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>Elasticsearch å¸¸ç”¨Api</title>
    <url>/p/642dba5b.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="mappingæ˜ å°„å±æ€§"><a href="#mappingæ˜ å°„å±æ€§" class="headerlink" title="mappingæ˜ å°„å±æ€§"></a>mappingæ˜ å°„å±æ€§</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html">å®˜æ–¹æ–‡æ¡£é“¾æ¥</a></p>
<p><code>mapping</code>ç”¨äºçº¦æŸesä¸­ç´¢å¼•åº“ä¸­çš„æ–‡æ¡£ï¼Œå®šä¹‰æ–‡æ¡£ä¸­çš„å­—æ®µå¦‚ä½•å­˜å‚¨å’Œç´¢å¼•çš„è¿‡ç¨‹ã€‚</p>
<h3 id="å­—æ®µæ•°æ®ç±»å‹"><a href="#å­—æ®µæ•°æ®ç±»å‹" class="headerlink" title="å­—æ®µæ•°æ®ç±»å‹"></a>å­—æ®µæ•°æ®ç±»å‹</h3><p>typeï¼šå­—æ®µæ•°æ®ç±»å‹ã€‚æ¯ä¸€ä¸ªç±»å‹éƒ½å¯ä»¥ä½œä¸ºæ•°ç»„ä½¿ç”¨ã€‚</p>
<h4 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h4><table>
<thead>
<tr>
<th>type</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>text</td>
<td>å¯åˆ†è¯çš„æ–‡æœ¬</td>
</tr>
<tr>
<td>keyword</td>
<td>ç²¾ç¡®å€¼ï¼Œä¸å¯åˆ†è¯ï¼Œä¾‹å¦‚ï¼šå“ç‰Œã€é“¾æ¥ã€å›½å®¶ã€ipåœ°å€ç­‰ï¼Œå­˜å‚¨å’ŒæŸ¥è¯¢æ—¶æ•ˆç‡è¾ƒé«˜</td>
</tr>
</tbody></table>
<h4 id="æ•°å€¼"><a href="#æ•°å€¼" class="headerlink" title="æ•°å€¼"></a>æ•°å€¼</h4><table>
<thead>
<tr>
<th>type</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>long</td>
<td>å¸¦ç¬¦å·çš„ 64 ä½æ•´æ•°ï¼Œæœ€å°å€¼ä¸º <code>-2â¶Â³</code>ï¼Œæœ€å¤§å€¼ä¸º <code>2â¶Â³-1</code>ã€‚</td>
</tr>
<tr>
<td>integer</td>
<td>å¸¦ç¬¦å·çš„ 32 ä½æ•´æ•°ï¼Œæœ€å°å€¼ä¸º <code>-2Â³Â¹</code>ï¼Œæœ€å¤§å€¼ä¸º <code>2Â³Â¹-1</code>ã€‚</td>
</tr>
<tr>
<td>short</td>
<td>å¸¦ç¬¦å·çš„ 16 ä½æ•´æ•°ï¼Œæœ€å°å€¼ä¸º <code>-32,768</code>ï¼Œæœ€å¤§å€¼ä¸º <code>32,767</code>ã€‚</td>
</tr>
<tr>
<td>byte</td>
<td>å¸¦ç¬¦å·çš„ 8 ä½æ•´æ•°ï¼Œæœ€å°å€¼ä¸º <code>-128</code>ï¼Œæœ€å¤§å€¼ä¸º <code>127</code>ã€‚</td>
</tr>
<tr>
<td>double</td>
<td>åŒç²¾åº¦ 64 ä½ IEEE 754 æµ®ç‚¹æ•°ï¼Œé™åˆ¶ä¸ºæœ‰é™å€¼ã€‚</td>
</tr>
<tr>
<td>float</td>
<td>å•ç²¾åº¦ 32 ä½ IEEE 754 æµ®ç‚¹æ•°ï¼Œé™åˆ¶ä¸ºæœ‰é™å€¼ã€‚</td>
</tr>
<tr>
<td>half_float</td>
<td>åŠç²¾åº¦ 16 ä½ IEEE 754 æµ®ç‚¹æ•°ï¼Œé™åˆ¶ä¸ºæœ‰é™å€¼ã€‚</td>
</tr>
<tr>
<td>scaled_float</td>
<td>ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œç”±ä¸€ä¸ªå›ºå®šçš„ <code>double</code> æ¯”ä¾‹å› å­ç¼©æ”¾çš„ <code>long</code> æ”¯æŒã€‚é€šè¿‡æ¯”ä¾‹å› å­å°†æµ®ç‚¹æ•°è½¬æ¢ä¸ºæ•´æ•°å­˜å‚¨ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´ï¼Œé€‚åˆç²¾åº¦è¦æ±‚ä¸é«˜çš„åœºæ™¯ã€‚</td>
</tr>
<tr>
<td>unsigned_long</td>
<td>æ— ç¬¦å· 64 ä½æ•´æ•°ï¼Œæœ€å°å€¼ä¸º 0ï¼Œæœ€å¤§å€¼ä¸º 2â¶â´-1ã€‚</td>
</tr>
</tbody></table>
<h4 id="å¸ƒå°”"><a href="#å¸ƒå°”" class="headerlink" title="å¸ƒå°”"></a>å¸ƒå°”</h4><p>booleanï¼štrue / false</p>
<h4 id="æ—¥æœŸ"><a href="#æ—¥æœŸ" class="headerlink" title="æ—¥æœŸ"></a>æ—¥æœŸ</h4><p>ä¸æ”¯æŒ <code>yyyy-MM-dd HH:mm:ss</code> ç­‰æ—¥æœŸæ ¼å¼ã€‚</p>
<table>
<thead>
<tr>
<th>type</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>date</td>
<td>yyyy-MM-dd æˆ– yyyyMMdd</td>
</tr>
<tr>
<td>date_time</td>
<td>yyyyMMddHHmmss æˆ– yyyy-MM-ddTHH:mm:ss æˆ– yyyy-MM-ddTHH:mm:ss.SSS æˆ– yyyy-MM-ddTHH:mm:ss.SSSZ</td>
</tr>
</tbody></table>
<h4 id="å¯¹è±¡"><a href="#å¯¹è±¡" class="headerlink" title="å¯¹è±¡"></a>å¯¹è±¡</h4><p>Object æ˜¯typeçš„é»˜è®¤å€¼ã€‚å‡è®¾å®šä¹‰nameå­—æ®µä¸ºå¯¹è±¡ç±»å‹ï¼Œä¸éœ€è¦æ˜¾å¼å®šä¹‰typeçš„å±æ€§å€¼ã€‚</p>
<h3 id="æ˜¯å¦åˆ›å»ºç´¢å¼•"><a href="#æ˜¯å¦åˆ›å»ºç´¢å¼•" class="headerlink" title="æ˜¯å¦åˆ›å»ºç´¢å¼•"></a>æ˜¯å¦åˆ›å»ºç´¢å¼•</h3><p>è¡¨ç¤ºå­—æ®µæ˜¯å¦éœ€è¦ç”¨äºæœç´¢ã€‚indexï¼šæ˜¯å¦åˆ›å»ºç´¢å¼•ï¼Œé»˜è®¤ä¸ºtrueã€‚</p>
<h3 id="åˆ†è¯å™¨"><a href="#åˆ†è¯å™¨" class="headerlink" title="åˆ†è¯å™¨"></a>åˆ†è¯å™¨</h3><p>analyzerï¼šä½¿ç”¨å“ªä¸ªåˆ†è¯å™¨ã€‚</p>
<h3 id="properties"><a href="#properties" class="headerlink" title="properties"></a>properties</h3><p>å­å­—æ®µçš„å®šä¹‰ã€‚</p>
<h2 id="ç´¢å¼•åº“æ“ä½œ"><a href="#ç´¢å¼•åº“æ“ä½œ" class="headerlink" title="ç´¢å¼•åº“æ“ä½œ"></a>ç´¢å¼•åº“æ“ä½œ</h2><p>ESä¸­é€šè¿‡restfulè¯·æ±‚æ“ä½œç´¢å¼•åº“ã€æ–‡æ¡£ã€‚è¯·æ±‚å†…å®¹ç”¨DSLï¼ˆDomain Specific Languageï¼‰è¯­å¥æ¥è¡¨ç¤ºã€‚</p>
<ul>
<li>åˆ›å»ºç´¢å¼•åº“</li>
</ul>
<figure class="highlight http"><table><tbody><tr><td class="code"><pre><span class="line">PUT  /&lt;index&gt;</span><br><span class="line">{</span><br><span class="line">    "mappings": {</span><br><span class="line">        "properties":{</span><br><span class="line">            "å­—æ®µå1": {</span><br><span class="line">                "type": "text",       // å¯åˆ†è¯çš„</span><br><span class="line">                "analyzer":"ik_smart" // æŒ‡å®šik_smartåˆ†è¯å™¨</span><br><span class="line">            },</span><br><span class="line">            "å­—æ®µå2": {</span><br><span class="line">                "type": "keyword",    // ç²¾ç¡®å€¼ï¼Œä¸å¯åˆ†è¯çš„</span><br><span class="line">                "index": "false"</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>æŸ¥è¯¢ç´¢å¼•åº“</li>
</ul>
<figure class="highlight http"><table><tbody><tr><td class="code"><pre><span class="line">GET /&lt;index&gt;</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>åˆ é™¤ç´¢å¼•åº“</li>
</ul>
<figure class="highlight http"><table><tbody><tr><td class="code"><pre><span class="line">DELETE /&lt;index&gt;</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>ä¿®æ”¹ç´¢å¼•åº“</li>
</ul>
<p>ç´¢å¼•åº“å’Œmappingä¸€ä½†åˆ›å»ºæ— æ³•ä¿®æ”¹ï¼Œæ”¯æŒæ·»åŠ æ–°çš„å­—æ®µï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight http"><table><tbody><tr><td class="code"><pre><span class="line">PUT /&lt;index&gt;/_mapping</span><br><span class="line">{</span><br><span class="line"> "properties": {</span><br><span class="line"> 	"æ–°å­—æ®µå": { ... }</span><br><span class="line"> }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="æ–‡æ¡£æ“ä½œ"><a href="#æ–‡æ¡£æ“ä½œ" class="headerlink" title="æ–‡æ¡£æ“ä½œ"></a>æ–‡æ¡£æ“ä½œ</h2><h3 id="æ–°å¢"><a href="#æ–°å¢" class="headerlink" title="æ–°å¢"></a>æ–°å¢</h3><p>å¦‚æœä¸æŒ‡å®šæ–‡æ¡£IDï¼ŒESä¼šéšæœºç”Ÿæˆä¸€ä¸ªã€‚</p>
<figure class="highlight http"><table><tbody><tr><td class="code"><pre><span class="line">POST /&lt;index&gt;/_doc/æ–‡æ¡£ID</span><br><span class="line">{</span><br><span class="line">	"å­—æ®µ1": "å€¼",</span><br><span class="line">	"å­—æ®µ2": {</span><br><span class="line">		"å­å­—æ®µ1":"å€¼",</span><br><span class="line">		"å­å­—æ®µ2": 0</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h3><figure class="highlight http"><table><tbody><tr><td class="code"><pre><span class="line">GET /&lt;index&gt;/_doc/æ–‡æ¡£ID</span><br></pre></td></tr></tbody></table></figure>

<h3 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h3><figure class="highlight http"><table><tbody><tr><td class="code"><pre><span class="line">DELETE /&lt;index&gt;/_doc/æ–‡æ¡£ID</span><br></pre></td></tr></tbody></table></figure>

<h3 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a>ä¿®æ”¹</h3><p>å…¨é‡ä¿®æ”¹ï¼Œå…ˆåˆ é™¤æ—§æ–‡æ¡£ï¼Œå†æ·»åŠ æ–°æ–‡æ¡£ã€‚</p>
<figure class="highlight http"><table><tbody><tr><td class="code"><pre><span class="line">PUT /&lt;index&gt;/_doc/æ–‡æ¡£ID</span><br><span class="line">{</span><br><span class="line">   "å­—æ®µ1": "v1",</span><br><span class="line">   "å­—æ®µ2": "v2",</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å±€éƒ¨ä¿®æ”¹ï¼Œä¿®æ”¹æŒ‡å®šå­—æ®µã€‚</p>
<figure class="highlight http"><table><tbody><tr><td class="code"><pre><span class="line">PUT /&lt;index&gt;/_doc/æ–‡æ¡£ID</span><br><span class="line">{</span><br><span class="line">  "doc": {</span><br><span class="line">   "å­—æ®µ1": "v2"</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="DSLæŸ¥è¯¢æ–‡æ¡£"><a href="#DSLæŸ¥è¯¢æ–‡æ¡£" class="headerlink" title="DSLæŸ¥è¯¢æ–‡æ¡£"></a>DSLæŸ¥è¯¢æ–‡æ¡£</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html">å®˜æ–¹æ–‡æ¡£é“¾æ¥</a>ã€‚ESåŸºäºJSONçš„DSLï¼ˆDomain Specific Languageï¼‰æ¥å®šä¹‰æŸ¥è¯¢è¯­æ³•ã€‚</p>
<p>è¯·æ±‚è·¯å¾„ï¼š<strong>GET /&lt;index&gt;/_search</strong></p>
<figure class="highlight http"><table><tbody><tr><td class="code"><pre><span class="line">GET /&lt;index&gt;/_search</span><br><span class="line">{</span><br><span class="line">  "query": {</span><br><span class="line">     "æŸ¥è¯¢ç±»å‹": {</span><br><span class="line">        "æŸ¥è¯¢æ¡ä»¶": "æ¡ä»¶å€¼"</span><br><span class="line">     }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="æŸ¥è¯¢å…¨éƒ¨"><a href="#æŸ¥è¯¢å…¨éƒ¨" class="headerlink" title="æŸ¥è¯¢å…¨éƒ¨"></a>æŸ¥è¯¢å…¨éƒ¨</h3><h4 id="match-all"><a href="#match-all" class="headerlink" title="match_all"></a>match_all</h4><p>match_allæ²¡æœ‰ä»»ä½•æ¡ä»¶ï¼Œæ£€ç´¢å…¨éƒ¨æ•°æ®ã€‚</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"query"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"match_all"</span><span class="punctuation">:</span> <span class="punctuation">{</span><span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="match-none"><a href="#match-none" class="headerlink" title="match_none"></a>match_none</h4><p>match_noneæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æŸ¥è¯¢ç±»å‹ï¼Œç¡®ä¿æŸ¥è¯¢ä¸ä¼šåŒ¹é…ä»»ä½•æ–‡æ¡£ï¼Œä¸€èˆ¬ç”¨äºç»„åˆæŸ¥è¯¢ä¸­æ˜ç¡®æ’é™¤æŸäº›æ¡ä»¶ã€‚</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"query"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"match_none"</span><span class="punctuation">:</span> <span class="punctuation">{</span><span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<p>è¯¥æŸ¥è¯¢ä¸ä¼šè¿”å›ä»»ä½•æ–‡æ¡£ï¼Œ<code>hits</code> æ•°é‡ä¸º 0ã€‚</p>
<h3 id="ç²¾ç¡®åŒ¹é…"><a href="#ç²¾ç¡®åŒ¹é…" class="headerlink" title="ç²¾ç¡®åŒ¹é…"></a>ç²¾ç¡®åŒ¹é…</h3><h4 id="termæŸ¥è¯¢"><a href="#termæŸ¥è¯¢" class="headerlink" title="termæŸ¥è¯¢"></a>termæŸ¥è¯¢</h4><p>ç”¨äºç²¾ç¡®åŒ¹é…å­—æ®µçš„å•ä¸ªå€¼ï¼Œä¸ä¼šå¯¹è¾“å…¥å†…å®¹è¿›è¡Œåˆ†è¯ã€‚</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"term"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"&lt;field&gt;"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"value"</span><span class="punctuation">:</span> <span class="string">"&lt;value&gt;"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"boost"</span><span class="punctuation">:</span> &lt;boost_value&gt;<span class="punctuation">,</span>  <span class="comment">// å¯é€‰ï¼Œç”¨äºè°ƒæ•´åŒ¹é…æ–‡æ¡£çš„è¯„åˆ†</span></span><br><span class="line">      <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<p>boostå‚æ•°ï¼šç”¨äºè°ƒæ•´åŒ¹é…æ–‡æ¡£çš„ç›¸å…³æ€§è¯„åˆ†ï¼Œé»˜è®¤å€¼ä¸º1ï¼Œå€¼è¶Šé«˜è¡¨ç¤ºåŒ¹é…çš„æ–‡æ¡£ç›¸å…³æ€§è¶Šé«˜ã€‚</p>
<p>å¦‚æœæƒ³ä¸ºåŒ¹é…çš„æ–‡æ¡£èµ‹äºˆæ›´é«˜çš„æƒé‡ï¼Œå¯ä»¥ä½¿ç”¨ <code>boost</code> å‚æ•°ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¸Œæœ›åŒ¹é… <code>status</code> ä¸º <code>active</code> çš„æ–‡æ¡£æœ‰æ›´é«˜çš„è¯„åˆ†ï¼š</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"term"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"status"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"value"</span><span class="punctuation">:</span> <span class="string">"active"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"boost"</span><span class="punctuation">:</span> <span class="number">2.0</span></span><br><span class="line">      <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<p>ç¤ºä¾‹åŒ¹é…age=22çš„æ•°æ®ï¼š</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"term"</span><span class="punctuation">:</span> <span class="punctuation">{</span> <span class="attr">"age"</span><span class="punctuation">:</span>  <span class="punctuation">{</span><span class="attr">"value"</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">}</span> <span class="punctuation">}</span> <span class="comment">// æ— å…¶å®ƒé…ç½®ä¹Ÿå¯ç®€å†™ä¸ºï¼š{"age":22} </span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="termsæŸ¥è¯¢"><a href="#termsæŸ¥è¯¢" class="headerlink" title="termsæŸ¥è¯¢"></a>termsæŸ¥è¯¢</h4><p>ç”¨äºç²¾ç¡®åŒ¹é…å¤šä¸ªå€¼ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªå­—æ®µéœ€è¦åŒ¹é…çš„å¤šä¸ªå€¼ã€‚</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"terms"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"&lt;field&gt;"</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">"&lt;value1&gt;"</span><span class="punctuation">,</span> <span class="string">"&lt;value2&gt;"</span><span class="punctuation">,</span> ... <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"boost"</span><span class="punctuation">:</span> &lt;boost_value&gt;<span class="punctuation">,</span>  <span class="comment">// å¯é€‰ï¼Œç”¨äºè°ƒæ•´åŒ¹é…æ–‡æ¡£çš„è¯„åˆ†</span></span><br><span class="line">      <span class="attr">"minimum_should_match"</span><span class="punctuation">:</span> <span class="string">"&lt;number_or_percentage&gt;"</span>  <span class="comment">// å¯é€‰ï¼Œç”¨äºæŒ‡å®šæœ€å°‘åŒ¹é…çš„é¡¹æ•°</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<p>ç¤ºä¾‹ï¼šåŒ¹é…age in (18,22,25)çš„æ•°æ®ï¼Œè‡³å°‘åŒ¹é…å…¶ä¸€ã€‚</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"terms"</span><span class="punctuation">:</span> <span class="punctuation">{</span> <span class="attr">"age"</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">18</span><span class="punctuation">,</span> <span class="number">22</span><span class="punctuation">,</span> <span class="number">25</span><span class="punctuation">]</span> <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<p>ç¤ºä¾‹ï¼šè‡³å°‘åŒ¹é…å…¶äºŒï¼Œå¯ä»¥è®¾ç½®<code>minimum_should_match=2</code></p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"terms"</span><span class="punctuation">:</span> <span class="punctuation">{</span> </span><br><span class="line">        <span class="attr">"age"</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">18</span><span class="punctuation">,</span> <span class="number">22</span><span class="punctuation">,</span> <span class="number">25</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"minimum_should_match"</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<p>æœªå®Œå¾…ç»­â€¦</p>
</body></html>]]></content>
      <tags>
        <tag>Elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰è£…Elasticsearch Kibana Head</title>
    <url>/p/cda7441.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="å®‰è£…ES-Kibana-Head"><a href="#å®‰è£…ES-Kibana-Head" class="headerlink" title="å®‰è£…ES+Kibana+Head"></a>å®‰è£…ES+Kibana+Head</h2><p>ä½¿ç”¨dockerå®‰è£…ï¼ŒæŒ‚è½½é…ç½®æ–‡ä»¶åˆ°æœ¬æœºã€‚<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html">å®‰è£…ESå®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<h3 id="å®‰è£…ES"><a href="#å®‰è£…ES" class="headerlink" title="å®‰è£…ES"></a>å®‰è£…ES</h3><p>åˆ›å»ºelasticç½‘ç»œ</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">docker network create elastic</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨å®¹å™¨ï¼Œä»‹äºä¸ªäººåŸå› ï¼Œè¿™é‡Œä½¿ç”¨çš„è€ç‰ˆæœ¬esï¼Œæœ€å¥½ä½¿ç”¨æœ€æ–°ç‰ˆã€‚æˆ‘æœºå™¨ä¸Šdockerå®¹å™¨çš„çš„æ˜ å°„æ–‡ä»¶éƒ½æ˜¯æ”¾åœ¨<code>/mydata</code>é‡Œé¢çš„ï¼ŒæŒ‰éœ€ä¿®æ”¹ã€‚</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">docker run -p 9200:9200 -p 9300:9300 \</span><br><span class="line">--name es \</span><br><span class="line">--restart=always --net elastic \</span><br><span class="line">-v /mydata/elasticsearch/data:/usr/share/elasticsearch/data \</span><br><span class="line">-v /mydata/elasticsearch/config:/usr/share/elasticsearch/config \</span><br><span class="line">-v /mydata/elasticsearch/plugins:/usr/share/elasticsearch/plugins \</span><br><span class="line">-v /mydata/elasticsearch/logs:/usr/share/elasticsearch/logs \</span><br><span class="line">-it -m 1GB -e <span class="string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span> \</span><br><span class="line">-e <span class="string">"discovery.type=single-node"</span> \</span><br><span class="line">--privileged \</span><br><span class="line">-d elasticsearch:7.4.2 </span><br></pre></td></tr></tbody></table></figure>

<h3 id="ESè·¨åŸŸé…ç½®"><a href="#ESè·¨åŸŸé…ç½®" class="headerlink" title="ESè·¨åŸŸé…ç½®"></a>ESè·¨åŸŸé…ç½®</h3><p>æŒ‰éœ€é…ç½®ï¼Œä¸€èˆ¬æ˜¯ä¸éœ€è¦è·¨åŸŸçš„ï¼Œæˆ‘è¿™é‡Œæ˜¯æµ‹è¯•ç¯å¢ƒï¼Œå€’å›¾ä¸ªæ–¹ä¾¿ã€‚æ²¡æœ‰<code>elasticsearch.yml</code>æ–‡ä»¶çš„ï¼Œå»ºè®®å¯åŠ¨ä¸€ä¸‹eså®¹å™¨ï¼Œå…ˆæ‹·è´å‡ºæ¥ã€‚ä¸‹é¢æ˜¯esä¸­çš„å‡ ä¸ªæ–‡ä»¶ï¼ŒæŒ‰éœ€æ‰€å–ã€‚</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">docker <span class="built_in">cp</span> elasticsearch:/usr/share/elasticsearch/config /mydata/elasticsearch</span><br><span class="line">docker <span class="built_in">cp</span> elasticsearch:/usr/share/elasticsearch/logs /mydata/elasticsearch</span><br><span class="line">docker <span class="built_in">cp</span> elasticsearch:/usr/share/elasticsearch/data /mydata/elasticsearch</span><br><span class="line">docker <span class="built_in">cp</span> elasticsearch:/usr/share/elasticsearch/plugins /mydata/elasticsearch</span><br></pre></td></tr></tbody></table></figure>

<p>ä¿®æ”¹é…ç½®</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">vi /mydata/elasticsearch/config/elasticsearch.yml</span><br></pre></td></tr></tbody></table></figure>

<p>å¢åŠ ä»¥ä¸‹å†…å®¹åï¼Œé‡å¯å®¹å™¨</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">"*"</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="å®‰è£…Kibana"><a href="#å®‰è£…Kibana" class="headerlink" title="å®‰è£…Kibana"></a>å®‰è£…Kibana</h3><p>ç‰ˆæœ¬éœ€è¦å’Œesç‰ˆæœ¬å¯¹åº”ã€‚</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">docker run -p 5601:5601 --name kibana --restart=always \</span><br><span class="line">--privileged=<span class="literal">true</span> -v /mydata/kibana:/usr/share/kibana \</span><br><span class="line">-d kibana:7.4.2</span><br></pre></td></tr></tbody></table></figure>

<p>ä¿®æ”¹ä¸€ä¸‹è¿æ¥esçš„åœ°å€</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">vi /mydata/kibana/kibana.yml</span><br></pre></td></tr></tbody></table></figure>

<p>hostsä¸­å¡«å†™elasticsearchèŠ‚ç‚¹åœ°å€</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">server.name:</span> <span class="string">kibana</span></span><br><span class="line"><span class="attr">server.host:</span> <span class="string">"0.0.0.0"</span></span><br><span class="line"><span class="attr">elasticsearch.hosts:</span> [ <span class="string">"http://192.168.248.88:9200"</span> ]</span><br><span class="line"><span class="attr">xpack.monitoring.ui.container.elasticsearch.enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="å®‰è£…elasticsearch-head"><a href="#å®‰è£…elasticsearch-head" class="headerlink" title="å®‰è£…elasticsearch-head"></a>å®‰è£…elasticsearch-head</h3><p>æˆ‘é€‰ç”¨æºç çš„æ–¹å¼å®‰è£…ï¼Œ<a href="https://github.com/mobz/elasticsearch-head">é¡¹ç›®åœ°å€</a>ã€‚</p>
<p>å…ˆå®‰è£…ç¼–è¯‘ç¯å¢ƒnodejsï¼Œnpmæºæœ€å¥½é…ç½®ä¸ªå›½å†…çš„ï¼Œä¾‹å¦‚æ·˜å®æºï¼Œè¿˜å¯ä»¥å®‰è£…ä¸ªcnpmã€‚<code>npm install -g cnpm --registry=https://registry.npm.taobao.org</code></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">yum install -y gcc gcc-c++</span><br><span class="line">yum install -y nodejs</span><br><span class="line">node -v  </span><br><span class="line">npm -v</span><br></pre></td></tr></tbody></table></figure>

<p>è·Ÿç€<code>README</code>æ“ä½œï¼š</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/mobz/elasticsearch-head.git</span><br><span class="line"><span class="built_in">cd</span> elasticsearch-head</span><br><span class="line">npm install</span><br><span class="line">npm run start</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰“å¼€é“¾æ¥ï¼š<a href="http://localhost:9100/">http://localhost:9100/</a>  å³å®‰è£…å®Œæˆã€‚</p>
<p>å¦‚æœéœ€è¦è·¨åŸŸè¿æ¥ESï¼Œä¸‹é¢å°†ä¿®æ”¹é»˜è®¤è¿æ¥esçš„åœ°å€ã€‚</p>
<p>ä¿®æ”¹esèŠ‚ç‚¹åœ°å€ï¼š</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">vi /mydata/elasticsearch-head/Gruntfile.js</span><br></pre></td></tr></tbody></table></figure>

<p>å¢åŠ <code>hostname:'*'</code>é…ç½®ï¼š</p>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">connect</span>: {</span><br><span class="line">    <span class="attr">server</span>: {</span><br><span class="line">        <span class="attr">options</span>: {</span><br><span class="line">            <span class="attr">port</span>: <span class="number">9100</span>,</span><br><span class="line">            <span class="attr">base</span>: <span class="string">'.'</span>,</span><br><span class="line">            <span class="comment">// å¢åŠ ä¸ªHostName</span></span><br><span class="line">            <span class="attr">hostname</span>: <span class="string">'*'</span>,</span><br><span class="line">            <span class="attr">keepalive</span>: <span class="literal">true</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¿®æ”¹é»˜è®¤è¿æ¥åœ°å€ï¼š</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">vi vi /mydata/elasticsearch-head/_site/app.js</span><br></pre></td></tr></tbody></table></figure>

<p>æœç´¢ä¸€ä¸‹å…³é”®å­—:<code>localhost</code>ï¼Œå°†åŸæ¥çš„ ï¼š<code>this.base_uri = this.config.base_uri || this.prefs.get("app-base_uri") || "http://localhost:9200";</code>ä¿®æ”¹ä¸ºESçš„èŠ‚ç‚¹åœ°å€ã€‚</p>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">base_uri</span> = <span class="variable language_">this</span>.<span class="property">config</span>.<span class="property">base_uri</span> || <span class="variable language_">this</span>.<span class="property">prefs</span>.<span class="title function_">get</span>(<span class="string">"app-base_uri"</span>) || <span class="string">"http://192.168.248.88:9200"</span>;</span><br></pre></td></tr></tbody></table></figure>

<h2 id="å®‰è£…Ikåˆ†è¯å™¨"><a href="#å®‰è£…Ikåˆ†è¯å™¨" class="headerlink" title="å®‰è£…Ikåˆ†è¯å™¨"></a>å®‰è£…Ikåˆ†è¯å™¨</h2><p>ä½¿ç”¨Githubå¼€æºçš„ä¸­æ–‡åˆ†è¯å™¨ï¼Œ<a href="https://github.com/infinilabs/analysis-ik">é“¾æ¥åœ¨æ­¤</a>ã€‚ä¸‹è½½åˆ°æœ¬æœºä¸Šä¼ è‡³æœåŠ¡å™¨çš„ <code>/mydata/elasticsearch/plugins</code>ä¸­è§£å‹å‡ºæ¥ã€‚</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">ls</span> /mydata/elasticsearch/plugins</span><br><span class="line"></span><br><span class="line">&gt; ik-7.4.2 </span><br></pre></td></tr></tbody></table></figure>

<p>é‡å¯eså®¹å™¨åï¼Œé€šè¿‡å‘½ä»¤æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ã€‚</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">docker logs es | grep alysis-ik</span><br><span class="line"></span><br><span class="line">&gt; {<span class="string">"type"</span>: <span class="string">"server"</span>, <span class="string">"timestamp"</span>: <span class="string">"2025-03-12T08:55:16,790Z"</span>, <span class="string">"level"</span>: <span class="string">"INFO"</span>, <span class="string">"component"</span>: <span class="string">"o.e.p.PluginsService"</span>, <span class="string">"cluster.name"</span>: <span class="string">"docker-cluster"</span>, <span class="string">"node.name"</span>: <span class="string">"071151ebe748"</span>, <span class="string">"message"</span>: <span class="string">"loaded plugin [analysis-ik]"</span> }</span><br></pre></td></tr></tbody></table></figure>

<p>æµ‹è¯•IKåˆ†è¯å™¨ï¼Œæ‰“å¼€Kibanaçš„devtoolsé¡µé¢ï¼š<code>http://192.168.248.88:5601/app/kibana#/dev_tools/console</code></p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line">POST /_analyze</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"text"</span><span class="punctuation">:</span><span class="string">"ä¸­åäººæ°‘å…±å’Œå›½"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"analyzer"</span><span class="punctuation">:</span> <span class="string">"ik_smart"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"tokens"</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"token"</span> <span class="punctuation">:</span> <span class="string">"ä¸­åäººæ°‘å…±å’Œå›½"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"start_offset"</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"end_offset"</span> <span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"type"</span> <span class="punctuation">:</span> <span class="string">"CN_WORD"</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"position"</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

</body></html>]]></content>
      <tags>
        <tag>Elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>ElasticsearchåŸºç¡€ç¯‡</title>
    <url>/p/d32d37e5.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="ElasticSearchç®€ä»‹"><a href="#ElasticSearchç®€ä»‹" class="headerlink" title="ElasticSearchç®€ä»‹"></a>ElasticSearchç®€ä»‹</h2><ul>
<li>å¼€æºçš„æœç´¢å¼•æ“</li>
<li>ä»‹äºåº”ç”¨å’Œæ•°æ®ä¹‹é—´ï¼šåº”ç”¨ &lt;-&gt; ES &lt;-&gt; æ•°æ®ï¼Œåªè¦å°†æ•°æ®å†™å…¥ESï¼Œåº”ç”¨å°±å¯ä»¥é€šè¿‡ä¸€äº›å…³é”®å­—æœç´¢åˆ°æ•°æ®</li>
</ul>
<h2 id="ä»æµ…å…¥æ·±"><a href="#ä»æµ…å…¥æ·±" class="headerlink" title="ä»æµ…å…¥æ·±"></a>ä»æµ…å…¥æ·±</h2><p>ç°åœ¨æœ‰ä¸‰æ®µæ–‡æœ¬ï¼Œid åˆ†åˆ«æ˜¯ 0ã€1ã€2ï¼Œä½ éœ€è¦å¿«é€Ÿæ‰¾åˆ°å“ªæ®µæ–‡æœ¬é‡Œå«æœ‰å…³é”®è¯â€xiaobaiâ€.</p>
 <figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">I like xiaobai  </span><br><span class="line">I follow xiaobai  </span><br><span class="line">I forward the video</span><br></pre></td></tr></tbody></table></figure>

<p>å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œå¯ä»¥ä¾æ¬¡éå†è¿™ä¸‰æ®µæ–‡æœ¬ï¼ŒåŒ¹é…æ–‡æœ¬å†…æ˜¯å¦å«æœ‰â€<strong>xiaobai</strong>â€œï¼Œæœ€ç»ˆå°†ç¬¦åˆæ¡ä»¶çš„æ–‡æœ¬ ID è¾“å‡ºã€‚</p>
<p>åœ¨<strong>æ•°æ®é‡å°</strong>çš„æ—¶å€™ï¼Œé—®é¢˜ä¸å¤§ï¼Œä½†å¦‚æœæˆ‘æœ‰ä¸Šç™¾äº¿æ¡è¿™æ ·çš„æ•°æ®å‘¢ï¼Ÿå¦‚æœä¾æ¬¡éå†ï¼Œè¿™ä¸€æŠŠæ‰§è¡Œä¸‹å»ï¼Œæ¯”ä½ å–œæ¬¢çš„å¥³ç”Ÿå›ä½ æ¶ˆæ¯çš„é€Ÿåº¦ï¼Œè¿˜è¦<strong>æ…¢</strong>ã€‚</p>
<p>åƒè¿™ç§åœ¨æµ·é‡æ•°æ®ä¸­ï¼Œé€šè¿‡å…³é”®è¯æ£€ç´¢å‡ºæœ‰æ•ˆä¿¡æ¯çš„åœºæ™¯éå¸¸å¸¸è§ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½†å•ä¸ª Index Name å†…æ•°æ®ä¾ç„¶å¯èƒ½è¿‡å¤šï¼Œäºæ˜¯å¯ä»¥å°†å•ä¸ª Index Name çš„åŒç±»æ•°æ®ï¼Œæ‹†æˆå¥½å‡ ä»½ï¼Œæ¯ä»½æ˜¯ä¸€ä¸ª <strong>shard åˆ†ç‰‡</strong>ï¼Œ<strong>æ¯ä¸ª shard åˆ†ç‰‡æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ lucene åº“</strong>ã€‚<br>è¿™æ ·å°±å¯ä»¥å°†è¯»å†™æ“ä½œåˆ†æ‘Šåˆ°å¤šä¸ª åˆ†ç‰‡ ä¸­å»ï¼Œå¤§å¤§é™ä½äº†äº‰æŠ¢ï¼Œæå‡äº†ç³»ç»Ÿæ€§èƒ½ã€‚ç½‘è´­ç”¨çš„æ·˜å®å’Œè¿›äº¬ä¸œçš„ç«™å†…å•†å“æœç´¢ã€‚é‚£ä¹ˆé—®é¢˜å°±æ¥äº†ï¼Œæ€ä¹ˆå¤„ç†ç±»ä¼¼çš„æœç´¢åœºæ™¯å‘¢ï¼Ÿ</p>
<p>å¥½åŠï¼Œ<strong>æ²¡æœ‰ä»€ä¹ˆæ˜¯åŠ ä¸€å±‚ä¸­é—´å±‚ä¸èƒ½è§£å†³çš„ï¼Œå¦‚æœæœ‰ï¼Œé‚£å°±å†åŠ ä¸€å±‚</strong>ã€‚å°±æŠŠESåŠ åœ¨åº”ç”¨å’Œæ•°æ®ä¹‹é—´ã€‚</p>
<p><img src="/p/d32d37e5/image-20250309221212876.png" alt="ESä»‹äºåº”ç”¨å’Œæ•°æ®ä¹‹é—´"></p>
<h2 id="å€’æ’ç´¢å¼•"><a href="#å€’æ’ç´¢å¼•" class="headerlink" title="å€’æ’ç´¢å¼•"></a>å€’æ’ç´¢å¼•</h2><p>ä¸Šæ–‡ä¾æ¬¡éå†æ–‡æœ¬åŒ¹é…æ˜¯å¦å«æœ‰â€xiaobaiâ€ï¼Œç¡®å®ä½æ•ˆã€‚é‚£æœ‰æ›´é«˜æ•ˆçš„è§£æ³•å—ï¼Ÿ</p>
<p>å¯¹æ–‡æœ¬â€I like xiaobaiâ€åˆ‡åˆ†ä¸ºâ€Iâ€ã€â€likeâ€ã€â€xiaobaiâ€ä¸‰éƒ¨åˆ†ï¼Œè¿™ä¸ªæ“ä½œå«<strong>åˆ†è¯</strong>ã€‚åˆ†è¯åçš„æ¯éƒ¨åˆ†ï¼Œæˆ‘ä»¬ç§°ä¸ºä¸€ä¸ª<strong>è¯é¡¹ï¼ˆTermï¼‰</strong>ã€‚è®°å½•è¯é¡¹å’Œæ–‡æœ¬ id çš„å…³ç³»ï¼Œäºæ˜¯ä¸Šé¢çš„ä¸‰æ®µæ–‡æœ¬å°±å˜æˆäº†ä¸‹é¢è¿™æ ·ã€‚</p>
<p><img src="/p/d32d37e5/image-20250309221737328.png" alt="è¯é¡¹æ˜¯ä»€ä¹ˆ"></p>
<p>é€šè¿‡åˆ†è¯ï¼Œæ–‡æœ¬å°±å˜æˆä¸‹æ–¹è¡¨æ ¼çš„termï¼š</p>
<table>
<thead>
<tr>
<th>term</th>
<th>æ–‡æœ¬ id</th>
</tr>
</thead>
<tbody><tr>
<td>I</td>
<td>0, 1, 2</td>
</tr>
<tr>
<td>like</td>
<td>0</td>
</tr>
<tr>
<td>xiaobai</td>
<td>0, 1</td>
</tr>
<tr>
<td>follow</td>
<td>1</td>
</tr>
<tr>
<td>forward</td>
<td>2</td>
</tr>
<tr>
<td>the</td>
<td>2</td>
</tr>
<tr>
<td>video</td>
<td>2</td>
</tr>
</tbody></table>
<p>å½“æƒ³è¦æœç´¢ <code>xiaobai</code> çš„æ—¶å€™ï¼Œåªéœ€è¦åŒ¹é…åˆ° <code>xiaobai</code> è¯é¡¹ï¼Œå°±å¯ä»¥ç«‹é©¬å¾—åˆ°å®ƒæ‰€åœ¨çš„æ–‡æ¡£ id æ˜¯ 0 å’Œ 1ã€‚</p>
<p>ä½†è¿™æœ‰ä¸ªé—®é¢˜ï¼ŒçŸ­çŸ­ä¸‰å¥è¯ï¼Œå°±å·²ç»æœ‰è¿™ä¹ˆå¤šè¯é¡¹äº†ï¼Œè¦æ˜¯æ¢æˆä¸‰ç¯‡æ–‡æ¡£ï¼Œé‚£è¯é¡¹å°±ä¼šå¤šå¾—ç¦»è°±ï¼Œæ€ä¹ˆåœ¨è¿™ä¹ˆå¤šçš„è¯é¡¹é‡ŒåŒ¹é…å‡º xiaobai å‘¢ï¼ŸæŒ¨ä¸ªéå†çš„è¯ï¼Œæ—¶é—´å¤æ‚åº¦å°±æ˜¯ <code>O(N)</code>, å¤ªä½æ•ˆäº†ã€‚</p>
<p>å¯ä»¥å°†è¯é¡¹<strong>æŒ‰å­—å…¸åº</strong>ä»å°åˆ°å¤§æ’åºï¼Œé€šè¿‡äºŒåˆ†æŸ¥æ‰¾çš„æ–¹æ³•ï¼Œç›´æ¥å°†æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–ä¸º <code>O(lgN)</code>ã€‚å°±åƒä¸‹é¢è¿™æ ·ï¼š</p>
<table>
<thead>
<tr>
<th>term</th>
<th>æ–‡æ¡£ id</th>
</tr>
</thead>
<tbody><tr>
<td>follow</td>
<td>1</td>
</tr>
<tr>
<td>forward</td>
<td>2</td>
</tr>
<tr>
<td>I</td>
<td>0, 1, 2</td>
</tr>
<tr>
<td>like</td>
<td>0</td>
</tr>
<tr>
<td>the</td>
<td>2</td>
</tr>
<tr>
<td>video</td>
<td>2</td>
</tr>
<tr>
<td>xiaobai</td>
<td>0, 1</td>
</tr>
</tbody></table>
<p>å°†è¿™å †æ’å¥½åºçš„è¯é¡¹ï¼Œç§°ä¸º<strong>Term Dictionary</strong>ï¼Œè€Œè¯é¡¹å¯¹åº”çš„æ–‡æ¡£ id ç­‰ä¿¡æ¯çš„é›†åˆï¼Œå°±å« <strong>Posting List</strong>ã€‚å®ƒä»¬å…±åŒæ„æˆäº†ä¸€ä¸ªç”¨äºæœç´¢çš„æ•°æ®ç»“æ„ï¼Œå®ƒå°±æ˜¯ <strong>å€’æ’ç´¢å¼•(Inverted Index)</strong> ã€‚</p>
<p><img src="/p/d32d37e5/image-20250309222549081.png" alt="å€’æ’ç´¢å¼•"></p>
<blockquote>
<p>æ³¨æ„ï¼ŒPosting List å…¶å®è¿˜åŒ…å«<strong>è¯é¢‘</strong>å’Œ<strong>è¯é¡¹åœ¨æ–‡æœ¬é‡Œçš„åç§»é‡</strong>ç­‰ä¿¡æ¯ï¼Œä½†ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘åœ¨ä¸Šå›¾ä¸­å»æ‰äº†è¿™éƒ¨åˆ†å†…å®¹ã€‚</p>
</blockquote>
<p>ä½†å€’æ’ç´¢å¼•è¿˜æœ‰ä¸ªé—®é¢˜ï¼ŒTerm Dictionary æ•°æ®é‡å¾ˆå¤§ï¼Œæ”¾ <strong>å†…å­˜</strong> å¹¶ä¸ç°å®ï¼Œå› æ­¤å¿…é¡»æ”¾åœ¨<strong>ç£ç›˜</strong>ä¸­ã€‚ä½†æŸ¥è¯¢ç£ç›˜æ˜¯ä¸ªè¾ƒæ…¢çš„è¿‡ç¨‹ã€‚<br>æœ‰ä¼˜åŒ–æ‰‹æ®µå—ï¼Ÿæœ‰ï¼Œæˆ‘ä»¬èŠä¸‹ <strong>Term Index</strong>ã€‚</p>
<h2 id="Term-Index"><a href="#Term-Index" class="headerlink" title="Term Index"></a>Term Index</h2><p>å¯ä»¥å‘ç°ï¼Œè¯é¡¹ï¼ˆTermï¼‰å’Œè¯é¡¹ä¹‹é—´ï¼Œæœ‰äº›<strong>å‰ç¼€</strong>æ˜¯ä¸€è‡´çš„ï¼Œæ¯”å¦‚ <code>follow</code> å’Œ <code>forward</code> å‰é¢çš„ <code>fo</code> æ˜¯ä¸€è‡´çš„ï¼Œå¦‚æœå°†éƒ¨åˆ† term å‰ç¼€æå–å‡ºæ¥ï¼Œåƒä¸‹å›¾ä¸€æ ·ï¼Œå°±å¯ä»¥ç”¨æ›´å°‘çš„ç©ºé—´è¡¨è¾¾æ›´å¤šçš„ <strong>term</strong>ã€‚<br>åŸºäºè¿™ä¸ªåŸç†ï¼Œå¯ä»¥å°† Term Dictionary çš„<strong>éƒ¨åˆ†</strong>è¯é¡¹æå–å‡ºæ¥ï¼Œç”¨è¿™äº› è¯é¡¹ï¼ˆTermï¼‰ çš„å‰ç¼€ä¿¡æ¯ï¼Œæ„å»ºå‡ºä¸€ä¸ª<strong>ç²¾ç®€çš„ç›®å½•æ ‘</strong>ã€‚ç›®å½•æ ‘çš„èŠ‚ç‚¹ä¸­å­˜æ”¾è¿™äº›è¯é¡¹åœ¨ç£ç›˜ä¸­çš„åç§»é‡ï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘ç£ç›˜ä¸­çš„ä½ç½®ã€‚è¿™ä¸ªç›®å½•æ ‘ç»“æ„ï¼Œä½“ç§¯å°ï¼Œé€‚åˆæ”¾å†…å­˜ä¸­ï¼Œå®ƒå°±æ˜¯æ‰€è°“çš„ <strong>Term Index</strong>ã€‚å¯ä»¥ç”¨å®ƒæ¥åŠ é€Ÿæœç´¢ã€‚</p>
<p><img src="/p/d32d37e5/image-20250309223054264.png" alt="Term Indexæ˜¯ä»€ä¹ˆ"></p>
<p>å½“éœ€è¦æŸ¥æ‰¾æŸä¸ªè¯é¡¹çš„æ—¶å€™ï¼Œåªéœ€è¦æœç´¢ Term Indexï¼Œå°±èƒ½å¿«é€Ÿè·å¾—è¯é¡¹åœ¨ Term Dictionary ä¸­çš„å¤§æ¦‚ä½ç½®ã€‚å†è·³è½¬åˆ° Term Dictionaryï¼Œé€šè¿‡å°‘é‡çš„æ£€ç´¢ï¼Œå®šä½åˆ°è¯é¡¹å†…å®¹ã€‚</p>
<h2 id="Stored-Fields"><a href="#Stored-Fields" class="headerlink" title="Stored Fields"></a>Stored Fields</h2><p>åˆ°è¿™é‡Œï¼Œæœç´¢åŠŸèƒ½å°±æœ‰äº†ã€‚ä½†æœ‰ä¸ªé—®é¢˜ï¼Œå‰é¢æåˆ°çš„å€’æ’ç´¢å¼•ï¼Œæœç´¢åˆ°çš„æ˜¯<strong>æ–‡æ¡£ id</strong>ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ‹¿ç€è¿™ä¸ª id æ‰¾åˆ°<strong>æ–‡æ¡£å†…å®¹æœ¬èº«</strong>ï¼Œæ‰èƒ½è¿”å›ç»™ç”¨æˆ·ã€‚</p>
<p>å› æ­¤è¿˜éœ€è¦æœ‰ä¸ªåœ°æ–¹ï¼Œå­˜æ”¾å®Œæ•´çš„æ–‡æ¡£å†…å®¹ï¼Œå®ƒå°±æ˜¯ <strong>Stored Fields</strong>ï¼ˆè¡Œå¼å­˜å‚¨ï¼‰ã€‚</p>
<p><img src="/p/d32d37e5/image-20250309223621192.png" alt="Stored Fields"></p>
<h2 id="doc-values"><a href="#doc-values" class="headerlink" title="doc-values"></a>doc-values</h2><p>æœ‰äº† idï¼Œæˆ‘ä»¬å°±èƒ½ä» Stored Fields ä¸­å–å‡ºæ–‡æ¡£å†…å®¹ã€‚</p>
<p><img src="/p/d32d37e5/image-20250309223733164.png" alt="doc-values"></p>
<p>ä½†ç”¨æˆ·ç»å¸¸éœ€è¦æ ¹æ®æŸä¸ªå­—æ®µæ’åºæ–‡æ¡£ï¼Œæ¯”å¦‚æŒ‰æ—¶é—´æ’åºæˆ–å•†å“ä»·æ ¼æ’åºã€‚ä½†é—®é¢˜å°±æ¥äº†ï¼Œè¿™äº›å­—æ®µæ•£è½åœ¨æ–‡æ¡£é‡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œéœ€è¦å…ˆè·å– Stored Fields é‡Œçš„æ–‡æ¡£ï¼Œå†æå–å‡ºå†…éƒ¨å­—æ®µè¿›è¡Œæ’åºã€‚ä¹Ÿä¸æ˜¯è¯´ä¸è¡Œã€‚ä½†å…¶å®æœ‰æ›´é«˜æ•ˆçš„åšæ³•ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç”¨<strong>ç©ºé—´æ¢æ—¶é—´</strong>çš„æ€è·¯ï¼Œå†æ„é€ ä¸€ä¸ª<strong>åˆ—å¼å­˜å‚¨</strong>ç»“æ„ï¼Œå°†æ•£è½åœ¨å„ä¸ªæ–‡æ¡£çš„æŸä¸ªå­—æ®µï¼Œ<strong>é›†ä¸­</strong>å­˜æ”¾ï¼Œå½“æˆ‘ä»¬æƒ³å¯¹æŸä¸ªå­—æ®µæ’åºçš„æ—¶å€™ï¼Œå°±åªéœ€è¦å°†è¿™äº›é›†ä¸­å­˜æ”¾çš„å­—æ®µä¸€æ¬¡æ€§è¯»å–å‡ºæ¥ï¼Œå°±èƒ½åšåˆ°é’ˆå¯¹æ€§åœ°è¿›è¡Œæ’åºã€‚è¿™ä¸ªåˆ—å¼å­˜å‚¨ç»“æ„ï¼Œå°±æ˜¯æ‰€è°“çš„ <strong>Doc Values</strong>ã€‚</p>
<p><img src="/p/d32d37e5/image-20250309223943891.png" alt="Doc Valuesæ˜¯ä»€ä¹ˆ"></p>
<h2 id="segment"><a href="#segment" class="headerlink" title="segment"></a>segment</h2><p>åœ¨ä¸Šæ–‡ä¸­ï¼Œä»‹ç»äº†å››ç§å…³é”®çš„ç»“æ„ï¼š<strong>å€’æ’ç´¢å¼•</strong>ç”¨äºæœç´¢ï¼Œ<strong>Term Index</strong> ç”¨äºåŠ é€Ÿæœç´¢ï¼Œ<strong>Stored Fields</strong> ç”¨äºå­˜æ”¾æ–‡æ¡£çš„åŸå§‹ä¿¡æ¯ï¼Œä»¥åŠ <strong>Doc Values</strong> ç”¨äºæ’åºå’Œèšåˆã€‚è¿™äº›ç»“æ„å…±åŒç»„æˆäº†ä¸€ä¸ª<strong>å¤åˆ</strong>æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„â€<strong>segment</strong>â€œ, å®ƒæ˜¯ä¸€ä¸ªå…·å¤‡<strong>å®Œæ•´æœç´¢åŠŸèƒ½çš„æœ€å°å•å…ƒ</strong>ã€‚</p>
<p><img src="/p/d32d37e5/image-20250309224205272.png" alt="segment"></p>
<h2 id="lucene"><a href="#lucene" class="headerlink" title="lucene"></a>lucene</h2><p>å¯ä»¥ç”¨å¤šä¸ªæ–‡æ¡£ç”Ÿæˆä¸€ä»½ segmentï¼Œ<strong>å¦‚æœ</strong>æ–°å¢æ–‡æ¡£æ—¶ï¼Œè¿˜æ˜¯å†™å…¥åˆ°è¿™ä»½ segmentï¼Œé‚£å°±å¾—åŒæ—¶æ›´æ–° segment å†…éƒ¨çš„å¤šä¸ªæ•°æ®ç»“æ„ï¼Œè¿™æ ·å¹¶å‘è¯»å†™æ—¶æ€§èƒ½è‚¯å®šä¼šå—å½±å“ã€‚<br>é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿ<br>å®šä¸ªè§„çŸ©ã€‚<strong>segment ä¸€æ—¦ç”Ÿæˆï¼Œåˆ™ä¸èƒ½å†è¢«ä¿®æ”¹</strong>ã€‚å¦‚æœè¿˜æœ‰æ–°çš„æ–‡æ¡£è¦å†™å…¥ï¼Œé‚£å°±ç”Ÿæˆæ–°çš„ segmentã€‚<br>è¿™æ ·<strong>è€çš„ segment åªéœ€è¦è´Ÿè´£è¯»ï¼Œå†™åˆ™ç”Ÿæˆæ–°çš„ segment</strong>ã€‚åŒæ—¶ä¿è¯äº†è¯»å’Œå†™çš„æ€§èƒ½ã€‚</p>
<p>ä½† segment å˜å¤šäº†ï¼Œæ€ä¹ˆçŸ¥é“è¦æœç´¢çš„æ•°æ®åœ¨å“ªä¸ª segment é‡Œå‘¢ï¼Ÿ<br>é—®é¢˜ä¸å¤§ï¼Œ<strong>å¹¶å‘åŒæ—¶è¯»</strong>å¤šä¸ª segment å°±å¥½äº†ã€‚</p>
<p><img src="/p/d32d37e5/image-20250309224451263.png" alt="å¹¶å‘åŒæ—¶è¯»segment"></p>
<p>ä½†è¿™ä¹Ÿå¼•å…¥äº†æ–°é—®é¢˜ï¼Œéšç€æ•°æ®é‡å¢å¤§ï¼Œsegment æ–‡ä»¶è¶Šå†™è¶Šå¤šï¼Œæ–‡ä»¶å¥æŸ„è¢«è€—å°½é‚£æ˜¯æŒ‡æ—¥å¯å¾…å•Šã€‚<br>æ˜¯çš„ï¼Œä½†è¿™ä¸ªä¹Ÿå¥½è§£å†³ï¼Œæˆ‘ä»¬å¯ä»¥ä¸å®šæœŸåˆå¹¶å¤šä¸ªå° segmentï¼Œå˜æˆä¸€ä¸ªå¤§ segmentï¼Œä¹Ÿå°±æ˜¯<strong>æ®µåˆå¹¶</strong>(segment merging)ã€‚è¿™æ ·æ–‡ä»¶æ•°é‡å°±å¯æ§äº†ã€‚</p>
<p><img src="/p/d32d37e5/image-20250309224546328.png" alt="åˆå¹¶å¤šä¸ªå°segment"></p>
<p>åˆ°è¿™é‡Œï¼Œä¸Šé¢æåˆ°çš„å¤šä¸ª segmentï¼Œå°±å…±åŒæ„æˆäº†ä¸€ä¸ª<strong>å•æœºæ–‡æœ¬æ£€ç´¢åº“</strong>ï¼Œå®ƒå…¶å®å°±æ˜¯éå¸¸æœ‰åçš„å¼€æºåŸºç¡€æœç´¢åº“ <strong>lucene</strong>ã€‚</p>
<p><img src="/p/d32d37e5/d0fc8e42-387f-41c8-8288-c7d135b864e8.png" alt="Luceneç»“æ„"></p>
<p>ä¸å°‘çŸ¥åæœç´¢å¼•æ“éƒ½æ˜¯åŸºäºå®ƒæ„å»ºçš„ï¼Œæ¯”å¦‚æˆ‘ä»¬ä»Šå¤©ä»‹ç»çš„ ESã€‚<br>ä½†è¿™ä¸ª lucene å±å®è¿‡äºç®€é™‹ï¼Œåƒä»€ä¹ˆé«˜æ€§èƒ½ï¼Œé«˜æ‰©å±•æ€§ï¼Œé«˜å¯ç”¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªéƒ½ä¸æ²¾ã€‚<br>æ¥ä¸‹æ¥çœ‹ä¸‹æ€ä¹ˆä¼˜åŒ–å®ƒã€‚</p>
<h2 id="é«˜æ€§èƒ½"><a href="#é«˜æ€§èƒ½" class="headerlink" title="é«˜æ€§èƒ½"></a>é«˜æ€§èƒ½</h2><h3 id="Index-Name"><a href="#Index-Name" class="headerlink" title="Index Name"></a>Index Name</h3><p>lucene ä½œä¸ºä¸€ä¸ªæœç´¢åº“ï¼Œå¯ä»¥å†™å…¥å¤§é‡æ•°æ®ï¼Œå¹¶å¯¹å¤–æä¾›æœç´¢èƒ½åŠ›ã€‚<br>å¤šä¸ªè°ƒç”¨æ–¹<strong>åŒæ—¶è¯»å†™</strong>åŒä¸€ä¸ª lucene å¿…ç„¶å¯¼è‡´äº‰æŠ¢è®¡ç®—èµ„æºã€‚æŠ¢ä¸åˆ°èµ„æºçš„ä¸€æ–¹å°±å¾—ç­‰å¾…ï¼Œè¿™ä¸çº¯çº¯æµªè´¹æ—¶é—´å—ï¼<br>æœ‰è§£å†³æ–¹æ¡ˆå—ï¼Ÿæœ‰ï¼<br>é¦–å…ˆæ˜¯å¯¹å†™å…¥ lucene çš„æ•°æ®è¿›è¡Œåˆ†ç±»ï¼Œæ¯”å¦‚ä½“è‚²æ–°é—»å’Œå…«å¦æ–°é—»æ•°æ®ç®—ä¸¤ç±»ï¼Œæ¯ä¸€ç±»æ˜¯ä¸€ä¸ª <strong>Index Name</strong>ï¼Œç„¶åæ ¹æ® Index Name æ–°å¢ lucene çš„æ•°é‡ï¼Œå°†ä¸åŒç±»æ•°æ®å†™å…¥åˆ°ä¸åŒçš„ lucene ä¸­ï¼Œè¯»å–æ•°æ®æ—¶ï¼Œæ ¹æ®éœ€è¦æœç´¢ä¸åŒçš„ Index Name ã€‚è¿™å°±å¤§å¤§é™ä½äº†å•ä¸ª lucene çš„å‹åŠ›ã€‚</p>
<p><img src="/p/d32d37e5/image-20250309225008058.png" alt="Index-Nameæ˜¯ä»€ä¹ˆ"></p>
<h3 id="shard"><a href="#shard" class="headerlink" title="shard"></a>shard</h3><p>ä½†å•ä¸ª Index Name å†…æ•°æ®ä¾ç„¶å¯èƒ½è¿‡å¤šï¼Œäºæ˜¯å¯ä»¥å°†å•ä¸ª Index Name çš„åŒç±»æ•°æ®ï¼Œæ‹†æˆå¥½å‡ ä»½ï¼Œæ¯ä»½æ˜¯ä¸€ä¸ª <strong>shard åˆ†ç‰‡</strong>ï¼Œ<strong>æ¯ä¸ª shard åˆ†ç‰‡æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ lucene åº“</strong>ã€‚<br>è¿™æ ·å°±å¯ä»¥å°†è¯»å†™æ“ä½œåˆ†æ‘Šåˆ°å¤šä¸ª åˆ†ç‰‡ ä¸­å»ï¼Œå¤§å¤§é™ä½äº†äº‰æŠ¢ï¼Œæå‡äº†ç³»ç»Ÿæ€§èƒ½ã€‚</p>
<p><img src="/p/d32d37e5/image-20250309225201104.png" alt="image-20250309225201104"></p>
<h2 id="é«˜æ‰©å±•æ€§"><a href="#é«˜æ‰©å±•æ€§" class="headerlink" title="é«˜æ‰©å±•æ€§"></a>é«˜æ‰©å±•æ€§</h2><p>éšç€ åˆ†ç‰‡ å˜å¤šï¼Œå¦‚æœ åˆ†ç‰‡ éƒ½åœ¨åŒä¸€å°æœºå™¨ä¸Šçš„è¯ï¼Œå°±ä¼šå¯¼è‡´å•æœº cpu å’Œå†…å­˜è¿‡é«˜ï¼Œå½±å“æ•´ä½“ç³»ç»Ÿæ€§èƒ½ã€‚</p>
<p>äºæ˜¯æˆ‘ä»¬å¯ä»¥ç”³è¯·æ›´å¤šçš„æœºå™¨ï¼Œå°† åˆ†ç‰‡ <strong>åˆ†æ•£</strong>éƒ¨ç½²åœ¨å¤šå°æœºå™¨ä¸Šï¼Œè¿™æ¯ä¸€å°æœºå™¨ï¼Œå°±æ˜¯ä¸€ä¸ª <strong>Node</strong>ã€‚å¯ä»¥é€šè¿‡å¢åŠ  Node ç¼“è§£æœºå™¨ cpu è¿‡é«˜å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ã€‚</p>
<p><img src="/p/d32d37e5/image-20250309225648685.png" alt="Nodeæ˜¯ä»€ä¹ˆ"></p>
<h2 id="é«˜å¯ç”¨"><a href="#é«˜å¯ç”¨" class="headerlink" title="é«˜å¯ç”¨"></a>é«˜å¯ç”¨</h2><p>åˆ°è¿™é‡Œï¼Œé—®é¢˜åˆåˆæ¥äº†ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ª Node æŒ‚äº†ï¼Œé‚£ Node é‡Œæ‰€æœ‰åˆ†ç‰‡ éƒ½æ— æ³•å¯¹å¤–æä¾›æœåŠ¡äº†ã€‚æˆ‘ä»¬éœ€è¦ä¿è¯æœåŠ¡çš„é«˜å¯ç”¨ã€‚æœ‰è§£å†³æ–¹æ¡ˆå—ï¼Ÿ<br>æœ‰ï¼Œå¯ä»¥ç»™ åˆ†ç‰‡ <strong>å¤šåŠ å‡ ä¸ªå‰¯æœ¬</strong>ã€‚å°† åˆ†ç‰‡ åˆ†ä¸º <strong>Primary shard</strong> å’Œ <strong>Replica shard</strong>ï¼Œä¹Ÿå°±æ˜¯ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡ ã€‚ä¸»åˆ†ç‰‡ä¼šå°†æ•°æ®åŒæ­¥ç»™å‰¯æœ¬åˆ†ç‰‡ï¼Œå‰¯æœ¬åˆ†ç‰‡<strong>æ—¢å¯ä»¥</strong>åŒæ—¶æä¾›è¯»æ“ä½œï¼Œ<strong>è¿˜èƒ½</strong>åœ¨ä¸»åˆ†ç‰‡æŒ‚äº†çš„æ—¶å€™ï¼Œå‡çº§æˆæ–°çš„ä¸»åˆ†ç‰‡è®©ç³»ç»Ÿä¿æŒæ­£å¸¸è¿è¡Œï¼Œ<strong>æé«˜æ€§èƒ½</strong>çš„åŒæ—¶ï¼Œè¿˜ä¿è¯äº†ç³»ç»Ÿçš„<strong>é«˜å¯ç”¨</strong>ã€‚</p>
<p><img src="/p/d32d37e5/image-20250309225929286.png" alt="ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡"></p>
<h2 id="Nodeè§’è‰²åˆ†åŒ–"><a href="#Nodeè§’è‰²åˆ†åŒ–" class="headerlink" title="Nodeè§’è‰²åˆ†åŒ–"></a>Nodeè§’è‰²åˆ†åŒ–</h2><p>æœç´¢æ¶æ„éœ€è¦æ”¯æŒçš„åŠŸèƒ½å¾ˆå¤šï¼Œæ—¢è¦è´Ÿè´£<strong>ç®¡ç†é›†ç¾¤</strong>ï¼Œåˆè¦<strong>å­˜å‚¨ç®¡ç†æ•°æ®</strong>ï¼Œè¿˜è¦<strong>å¤„ç†å®¢æˆ·ç«¯çš„æœç´¢è¯·æ±‚</strong>ã€‚å¦‚æœæ¯ä¸ª Node <strong>éƒ½</strong>æ”¯æŒè¿™å‡ ç±»åŠŸèƒ½ï¼Œé‚£å½“é›†ç¾¤æœ‰æ•°æ®å‹åŠ›ï¼Œéœ€è¦æ‰©å®¹ Node æ—¶ï¼Œå°±ä¼š<strong>é¡ºå¸¦</strong>æŠŠå…¶ä»–èƒ½åŠ›ä¹Ÿä¸€èµ·æ‰©å®¹ï¼Œä½†å…¶å®å…¶ä»–èƒ½åŠ›å®Œå…¨å¤Ÿç”¨ï¼Œä¸éœ€è¦è·Ÿç€æ‰©å®¹ï¼Œè¿™å°±æœ‰äº›<strong>æµªè´¹</strong>äº†ã€‚<br>å› æ­¤å¯ä»¥å°†è¿™å‡ ç±»åŠŸèƒ½æ‹†å¼€ï¼Œç»™é›†ç¾¤é‡Œçš„ Node èµ‹äºˆ<strong>è§’è‰²èº«ä»½</strong>ï¼Œä¸åŒçš„è§’è‰²è´Ÿè´£ä¸åŒçš„åŠŸèƒ½ã€‚<br>æ¯”å¦‚è´Ÿè´£ç®¡ç†é›†ç¾¤çš„ï¼Œå«<strong>ä¸»èŠ‚ç‚¹(Master Node)<strong>ï¼Œ è´Ÿè´£å­˜å‚¨ç®¡ç†æ•°æ®çš„ï¼Œå«</strong>æ•°æ®èŠ‚ç‚¹(Data Node)<strong>ï¼Œ è´Ÿè´£æ¥å—å®¢æˆ·ç«¯æœç´¢æŸ¥è¯¢è¯·æ±‚çš„å«</strong>åè°ƒèŠ‚ç‚¹(Coordinate Node)<strong>ã€‚<br>é›†ç¾¤è§„æ¨¡å°çš„æ—¶å€™ï¼Œä¸€ä¸ª Node å¯ä»¥</strong>åŒæ—¶</strong>å……å½“å¤šä¸ªè§’è‰²ï¼Œéšç€é›†ç¾¤è§„æ¨¡å˜å¤§ï¼Œå¯ä»¥è®©ä¸€ä¸ª Node ä¸€ä¸ªè§’è‰²ã€‚</p>
<p><img src="/p/d32d37e5/image-20250309230159637.png" alt="è§’è‰²åˆ†åŒ–"></p>
<h2 id="å»ä¸­å¿ƒåŒ–"><a href="#å»ä¸­å¿ƒåŒ–" class="headerlink" title="å»ä¸­å¿ƒåŒ–"></a>å»ä¸­å¿ƒåŒ–</h2><p>ä¸Šé¢æåˆ°äº†ä¸»èŠ‚ç‚¹ï¼Œé‚£å°±æ„å‘³ç€è¿˜æœ‰ä¸ª<strong>é€‰ä¸»</strong>çš„è¿‡ç¨‹ï¼Œä½†ç°åœ¨æ¯ä¸ª Node éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œéœ€è¦æœ‰ä¸ªæœºåˆ¶åè°ƒ Node é—´çš„æ•°æ®ã€‚<br>æˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œå¯ä»¥åƒ <code>kafka</code> é‚£æ ·å¼•å…¥ä¸€ä¸ªä¸­å¿ƒèŠ‚ç‚¹ <code>Zookeeper</code>ï¼Œä½†å¦‚æœä¸æƒ³å¼•å…¥æ–°èŠ‚ç‚¹ï¼Œè¿˜æœ‰å…¶ä»–æ›´è½»é‡çš„æ–¹æ¡ˆå—ï¼Ÿ<br>æœ‰ï¼Œ<strong>å»ä¸­å¿ƒåŒ–</strong>ã€‚<br>å¯ä»¥åœ¨ Node é—´å¼•å…¥åè°ƒæ¨¡å—ï¼Œç”¨<strong>ç±»ä¼¼ä¸€è‡´æ€§ç®—æ³• Raft</strong> çš„æ–¹å¼ï¼Œåœ¨èŠ‚ç‚¹é—´äº’ç›¸åŒæ­¥æ•°æ®ï¼Œè®©æ‰€æœ‰ Node çœ‹åˆ°çš„é›†ç¾¤æ•°æ®çŠ¶æ€éƒ½æ˜¯ä¸€è‡´çš„ã€‚è¿™æ ·ï¼Œé›†ç¾¤å†…çš„ Node å°±èƒ½å‚ä¸é€‰ä¸»è¿‡ç¨‹ï¼Œè¿˜èƒ½äº†è§£åˆ°é›†ç¾¤å†…æŸä¸ª Node æ˜¯ä¸æ˜¯æŒ‚äº†ç­‰ä¿¡æ¯ã€‚</p>
<p><img src="/p/d32d37e5/image-20250309230334537.png" alt="å»ä¸­å¿ƒåŒ–"></p>
<h2 id="ESæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ESæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ESæ˜¯ä»€ä¹ˆï¼Ÿ"></a>ESæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>å¥½äº†ï¼Œåˆ°è¿™é‡Œï¼Œå½“åˆé‚£ä¸ªç®€é™‹çš„ luceneï¼Œå°±æˆäº†ä¸€ä¸ªé«˜æ€§èƒ½ï¼Œé«˜æ‰©å±•æ€§ï¼Œé«˜å¯ç”¨ï¼Œæ”¯æŒæŒä¹…åŒ–çš„åˆ†å¸ƒå¼æœç´¢å¼•æ“ï¼Œå®ƒå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ <strong>elastic search</strong>ï¼Œç®€ç§° <strong>ES</strong>ã€‚å®ƒå¯¹å¤–æä¾› <code>http</code> æ¥å£ï¼Œä»»ä½•è¯­è¨€çš„å®¢æˆ·ç«¯éƒ½å¯ä»¥é€šè¿‡ HTTP æ¥å£æ¥å…¥ esï¼Œå®ç°å¯¹æ•°æ®çš„å¢åˆ æ”¹æŸ¥ã€‚<br>ä»æ¶æ„è§’åº¦æ¥çœ‹ï¼Œes ç»™äº†ä¸€å¥—æ–¹æ¡ˆï¼Œå‘Šè¯‰æˆ‘ä»¬å¦‚ä½•è®©ä¸€ä¸ª<strong>å•æœºç³»ç»Ÿ lucene</strong> å˜æˆä¸€ä¸ª<strong>åˆ†å¸ƒå¼ç³»ç»Ÿ</strong>ã€‚</p>
<p><img src="/p/d32d37e5/image-20250309230520337.png" alt="ESç»“æ„"></p>
<p>æŒ‰è¿™ä¸ªæ€è·¯ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥å°† lucene æ”¹æˆå…¶ä»–å•æœºç³»ç»Ÿï¼Œæ¯”å¦‚ <code>mysql</code> æ•°æ®åº“ï¼Œæˆ–è€…ä¸“é—¨åšå‘é‡æ£€ç´¢çš„å•æœºå¼•æ“ <code>faiss</code>ï¼Ÿ<br>é‚£ä»¥åå†æ¥ä¸ª <code>elastic mysql</code> æˆ–è€… <code>elastic faiss</code> æ˜¯ä¸æ˜¯å°±ä¸é‚£ä¹ˆæ„å¤–äº†ï¼Œå¤§å‚å†…å·æ™‹å‡æˆ–è€…ä¸‹ä¸€ä¸ªæ˜æ˜Ÿå¼€æºå¤§é¡¹ç›®çš„å°æç¤ºå°±ç»™åˆ°è¿™é‡Œäº†ã€‚</p>
<p>çœ‹å®Œ es çš„æ¶æ„ï¼Œæ˜¯ä¸æ˜¯è§‰å¾—æœ‰äº›<strong>ä¼¼æ›¾ç›¸è¯†</strong>ï¼Ÿ <code>kafka</code>ã€‚</p>
<h2 id="ES-å’Œ-Kafka-çš„æ¶æ„å·®å¼‚"><a href="#ES-å’Œ-Kafka-çš„æ¶æ„å·®å¼‚" class="headerlink" title="ES å’Œ Kafka çš„æ¶æ„å·®å¼‚"></a>ES å’Œ Kafka çš„æ¶æ„å·®å¼‚</h2><p>å¯¹æ¯” kafka ï¼Œç„¶åä½ å°±ä¼šå‘ç°ï¼š</p>
<ul>
<li>es ä¸­ç”¨äºåˆ†ç±»æ¶ˆæ¯çš„ <code>Index Name</code>ï¼Œå…¶å®å°±æ˜¯ kafka çš„ <code>topic</code>ã€‚</li>
<li>es ä¸­ç”¨äºå¯¹ Index Name æ•°æ®åˆ†ç‰‡çš„ <code>Shard</code>ï¼Œå…¶å®å°±æ˜¯ kafka ä¸­æ‹†åˆ† topic æ•°æ®çš„ <code>Partition</code>ã€‚</li>
<li>es ä¸­ç”¨äºåˆ†æ•£éƒ¨ç½²å¤šä¸ª shard çš„ <code>Node</code>, å…¶å®å°±ç›¸å½“äº kafka ä¸­çš„ <code>broker</code>ã€‚</li>
</ul>
<p>es çš„æ¶æ„è·Ÿ kafka ä»¥åŠ rocketMQ éƒ½éå¸¸ç›¸ä¼¼ï¼Œ<strong>æœç„¶ä¼˜ç§€çš„æ¶æ„éƒ½æ˜¯ç›¸ä¼¼çš„ï¼Œä¸‘é™‹çš„æ¶æ„å„æœ‰å„çš„ä¸‘é™‹</strong>ã€‚å­¦ä¸€å¥—ä¼˜ç§€æ¶æ„ï¼Œå°±ç­‰äºå¼„é€šäº†å¥½å‡ ä¸ªä¸­é—´ä»¶åŸç†ï¼Œç®€ç›´è¡€èµšï¼</p>
<p>ç°åœ¨æˆ‘ä»¬äº†è§£å®Œ es çš„æ¶æ„ï¼Œå†æ¥ç”¨ä¸¤ä¸ªå®é™…ä¾‹å­å°†è¿™äº›æ¦‚å¿µä¸²èµ·æ¥ï¼Œæµ…çœ‹ä¸‹å®ƒçš„å·¥ä½œåŸç†ã€‚</p>
<h2 id="ES-çš„å†™å…¥æµç¨‹"><a href="#ES-çš„å†™å…¥æµç¨‹" class="headerlink" title="ES çš„å†™å…¥æµç¨‹"></a>ES çš„å†™å…¥æµç¨‹</h2><ul>
<li>å½“<strong>å®¢æˆ·ç«¯åº”ç”¨</strong>å‘èµ·æ•°æ®<strong>å†™å…¥</strong>è¯·æ±‚ï¼Œè¯·æ±‚ä¼šå…ˆå‘åˆ°é›†ç¾¤ä¸­<strong>åè°ƒèŠ‚ç‚¹</strong>ã€‚</li>
<li>åè°ƒèŠ‚ç‚¹æ ¹æ® hash è·¯ç”±ï¼Œåˆ¤æ–­æ•°æ®è¯¥å†™å…¥åˆ°å“ªä¸ª<strong>æ•°æ®èŠ‚ç‚¹</strong>é‡Œçš„å“ªä¸ª<strong>åˆ†ç‰‡</strong>(Shard)ï¼Œæ‰¾åˆ°<strong>ä¸»åˆ†ç‰‡</strong>å¹¶å†™å…¥ã€‚åˆ†ç‰‡åº•å±‚æ˜¯ <strong>lucene</strong>ï¼Œæ‰€ä»¥æœ€ç»ˆæ˜¯å°†æ•°æ®å†™å…¥åˆ° lucene åº“é‡Œçš„ <strong>segment</strong> å†…ï¼Œå°†æ•°æ®å›ºåŒ–ä¸º<strong>å€’æ’ç´¢å¼•</strong>å’Œ <strong>Stored Fields</strong> ä»¥åŠ <strong>Doc Values</strong> ç­‰å¤šç§ç»“æ„ã€‚</li>
<li>ä¸»åˆ†ç‰‡ å†™å…¥æˆåŠŸåä¼šå°†æ•°æ®åŒæ­¥ç»™ <strong>å‰¯æœ¬åˆ†ç‰‡</strong>ã€‚</li>
<li>å‰¯æœ¬åˆ†ç‰‡ å†™å…¥å®Œæˆåï¼Œ<strong>ä¸»åˆ†ç‰‡</strong>ä¼šå“åº”åè°ƒèŠ‚ç‚¹ä¸€ä¸ª ACKï¼Œæ„æ€æ˜¯å†™å…¥å®Œæˆã€‚</li>
<li>æœ€åï¼Œ<strong>åè°ƒèŠ‚ç‚¹</strong>å“åº”<strong>å®¢æˆ·ç«¯åº”ç”¨</strong>å†™å…¥å®Œæˆã€‚</li>
</ul>
<p><img src="/p/d32d37e5/image-20250309231308553.png" alt="ES çš„å†™å…¥æµç¨‹"></p>
<h2 id="ES-çš„æœç´¢æµç¨‹"><a href="#ES-çš„æœç´¢æµç¨‹" class="headerlink" title="ES çš„æœç´¢æµç¨‹"></a>ES çš„æœç´¢æµç¨‹</h2><p>ES çš„æœç´¢æµç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šåˆ†åˆ«æ˜¯ <strong>æŸ¥è¯¢é˜¶æ®µï¼ˆQuery Phaseï¼‰</strong> å’Œ <strong>è·å–é˜¶æ®µï¼ˆFetch Phaseï¼‰</strong></p>
<h2 id="æŸ¥è¯¢é˜¶æ®µ"><a href="#æŸ¥è¯¢é˜¶æ®µ" class="headerlink" title="æŸ¥è¯¢é˜¶æ®µ"></a>æŸ¥è¯¢é˜¶æ®µ</h2><ul>
<li>å½“<strong>å®¢æˆ·ç«¯åº”ç”¨</strong>å‘èµ·<strong>æœç´¢</strong>è¯·æ±‚ï¼Œè¯·æ±‚ä¼šå…ˆå‘åˆ°é›†ç¾¤ä¸­çš„<strong>åè°ƒèŠ‚ç‚¹</strong>ã€‚</li>
<li>åè°ƒèŠ‚ç‚¹æ ¹æ® <strong>index name</strong> çš„ä¿¡æ¯ï¼Œå¯ä»¥äº†è§£åˆ° index name è¢«åˆ†ä¸ºäº†å‡ ä¸ª <strong>åˆ†ç‰‡</strong>ï¼Œä»¥åŠè¿™äº›åˆ†ç‰‡ åˆ†æ•£å“ªä¸ª<strong>æ•°æ®èŠ‚ç‚¹</strong>ä¸Šï¼Œå°†è¯·æ±‚è½¬å‘åˆ°è¿™äº›æ•°æ®èŠ‚ç‚¹çš„ åˆ†ç‰‡ ä¸Šé¢ã€‚</li>
<li>æœç´¢è¯·æ±‚åˆ°è¾¾åˆ†ç‰‡åï¼Œåˆ†ç‰‡ åº•å±‚çš„ lucene åº“ä¼š<strong>å¹¶å‘</strong>æœç´¢å¤šä¸ª <strong>segment</strong>ï¼Œåˆ©ç”¨æ¯ä¸ª segment å†…éƒ¨çš„<strong>å€’æ’ç´¢å¼•</strong>è·å–åˆ°å¯¹åº”<strong>æ–‡æ¡£ id</strong>ï¼Œå¹¶ç»“åˆ <strong>doc values</strong> è·å¾—<strong>æ’åºä¿¡æ¯</strong>ã€‚åˆ†ç‰‡å°†ç»“æœèšåˆè¿”å›ç»™<strong>åè°ƒèŠ‚ç‚¹</strong>ã€‚</li>
<li><strong>åè°ƒèŠ‚ç‚¹</strong>å¯¹å¤šä¸ªåˆ†ç‰‡ä¸­æ‹¿åˆ°çš„æ•°æ®è¿›è¡Œ<strong>ä¸€æ¬¡æ’åºèšåˆ</strong>ï¼Œ<strong>èˆå¼ƒ</strong>å¤§éƒ¨åˆ†ä¸éœ€è¦çš„æ•°æ®ã€‚</li>
</ul>
<p><img src="/p/d32d37e5/image-20250309231840287.png" alt="æŸ¥è¯¢é˜¶æ®µ"></p>
<h2 id="è·å–é˜¶æ®µ"><a href="#è·å–é˜¶æ®µ" class="headerlink" title="è·å–é˜¶æ®µ"></a>è·å–é˜¶æ®µ</h2><ul>
<li><strong>åè°ƒèŠ‚ç‚¹</strong>å†æ¬¡æ‹¿ç€<strong>æ–‡æ¡£ id</strong> è¯·æ±‚<strong>æ•°æ®èŠ‚ç‚¹</strong>é‡Œçš„ <strong>åˆ†ç‰‡</strong>ï¼Œåˆ†ç‰‡ åº•å±‚çš„ lucene åº“ä¼šä» segment å†…çš„ <strong>Stored Fields</strong> ä¸­å–å‡º<strong>å®Œæ•´æ–‡æ¡£å†…å®¹</strong>ï¼Œå¹¶è¿”å›ç»™åè°ƒèŠ‚ç‚¹ã€‚</li>
<li><strong>åè°ƒèŠ‚ç‚¹</strong>æœ€ç»ˆå°†æ•°æ®ç»“æœè¿”å›ç»™<strong>å®¢æˆ·ç«¯</strong>ã€‚å®Œæˆæ•´ä¸ªæœç´¢è¿‡ç¨‹ã€‚</li>
</ul>
<p><img src="/p/d32d37e5/image-20250309232103467.png" alt="è·å–é˜¶æ®µ"></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li>lucene æ˜¯ es åº•å±‚çš„å•æœºæ–‡æœ¬æ£€ç´¢åº“ï¼Œå®ƒç”±å¤šä¸ª segment ç»„æˆï¼Œæ¯ä¸ª segment å…¶å®æ˜¯ç”±å€’æ’ç´¢å¼•ã€Term Indexã€Stored Fields å’Œ Doc Values ç»„æˆçš„å…·å¤‡å®Œæ•´æœç´¢åŠŸèƒ½çš„æœ€å°å•å…ƒã€‚</li>
<li>å°†æ•°æ®åˆ†ç±»ï¼Œå­˜å‚¨åœ¨ es å†…ä¸åŒçš„ Index Name ä¸­ã€‚</li>
<li>ä¸ºäº†é˜²æ­¢ Index Name å†…æ•°æ®è¿‡å¤šï¼Œå¼•å…¥äº† Shard çš„æ¦‚å¿µå¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡ã€‚æå‡äº†æ€§èƒ½ã€‚</li>
<li>å°†å¤šä¸ª shard åˆ†å¸ƒåœ¨å¤šä¸ª Node ä¸Šï¼Œæ ¹æ®éœ€è¦å¯¹ Node è¿›è¡Œæ‰©å®¹ï¼Œæå‡æ‰©å±•æ€§ã€‚</li>
<li>å°† shard åˆ†ä¸ºä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡ï¼Œä¸»åˆ†ç‰‡æŒ‚äº†ä¹‹åç”±å‰¯æœ¬åˆ†ç‰‡é¡¶ä¸Šï¼Œæå‡ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</li>
<li>å¯¹ Node è¿›è¡Œè§’è‰²åˆ†åŒ–ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œèµ„æºåˆ©ç”¨ç‡ï¼ŒåŒæ—¶ç®€åŒ–æ‰©å±•å’Œç»´æŠ¤ã€‚</li>
<li>es å’Œ kafka çš„æ¶æ„éå¸¸åƒï¼Œå¯ä»¥ç±»æ¯”å­¦ä¹ ã€‚</li>
</ul>
</body></html>]]></content>
      <tags>
        <tag>Elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVAæ³¨è§£</title>
    <url>/p/6ba397bc.html</url>
    <content><![CDATA[<html><head></head><body><p>æ³¨è§£æ˜¯JDK5.0 å¼•å…¥çš„ä¸€ç§æ³¨é‡Šæœºåˆ¶ï¼Œæ ¸å¿ƒåŒ…æ˜¯ java.lang.annotation ï¼Œä¸‹é¢æœ‰ä¸€ä¸ª Annotationæ¥å£ï¼Œæ˜¯æ‰€æœ‰æ³¨è§£éƒ½é»˜è®¤ç»§æ‰¿çš„ï¼ˆJavap .classå¯ä»¥çœ‹åˆ°ç»§æ‰¿å…³ç³»ï¼‰ã€‚</p>
<p>æä¾›ä¸€ç§ä¸ºç¨‹åºå…ƒç´ è®¾ç½®å…ƒæ•°æ®çš„æ–¹æ³•ï¼š</p>
<ul>
<li>å…ƒæ•°æ®æ˜¯æ·»åŠ åˆ°ç¨‹åºå…ƒç´ å¦‚æ–¹æ³•ã€å­—æ®µã€ç±»å’ŒåŒ….ä¸Šçš„é¢å¤–ä¿¡æ¯</li>
<li>æ³¨è§£æ˜¯ä¸€ç§åˆ†æ•£å¼çš„å…ƒæ•°æ®è®¾ç½®æ–¹å¼, XMLæ˜¯é›†ä¸­å¼çš„è®¾ç½®æ–¹å¼</li>
<li>æ³¨è§£ä¸èƒ½ç›´æ¥å¹²æ‰°ç¨‹åºä»£ç çš„è¿è¡Œ</li>
</ul>
<h2 id="æ³¨è§£çš„åŠŸèƒ½"><a href="#æ³¨è§£çš„åŠŸèƒ½" class="headerlink" title="æ³¨è§£çš„åŠŸèƒ½"></a>æ³¨è§£çš„åŠŸèƒ½</h2><ul>
<li>ä½œä¸ºç‰¹å®šçš„æ ‡è®°,ç”¨äºå‘Šè¯‰ç¼–è¯‘å™¨ä¸€äº›ä¿¡æ¯</li>
<li>ç¼–è¯‘æ—¶åŠ¨æ€å¤„ç†,å¦‚åŠ¨æ€ç”Ÿæˆä»£ç </li>
<li>è¿è¡Œæ—¶åŠ¨æ€å¤„ç†,ä½œä¸ºé¢å¤–ä¿¡æ¯çš„è½½ä½“,å¦‚è·å–æ³¨è§£ä¿¡æ¯</li>
</ul>
<h2 id="æ³¨è§£çš„åˆ†ç±»"><a href="#æ³¨è§£çš„åˆ†ç±»" class="headerlink" title="æ³¨è§£çš„åˆ†ç±»"></a>æ³¨è§£çš„åˆ†ç±»</h2><ul>
<li>æ ‡å‡†æ³¨è§£: Overrideã€Deprecatedã€ SuppressWarnings</li>
<li>å…ƒæ³¨è§£: @Retentionã€@ Targetã€@Inheritedã€ @Documented</li>
<li>è‡ªå®šä¹‰æ³¨è§£</li>
</ul>
<h2 id="å…ƒæ³¨è§£"><a href="#å…ƒæ³¨è§£" class="headerlink" title="å…ƒæ³¨è§£"></a>å…ƒæ³¨è§£</h2><p>ç”¨äºä¿®é¥°æ³¨è§£çš„æ³¨è§£,é€šå¸¸ç”¨åœ¨æ³¨è§£çš„å®šä¹‰ä¸Š</p>
<p>@Target :æ³¨è§£çš„ä½œç”¨ç›®æ ‡</p>
<p>@Retention :æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸ</p>
<p>@Documented :æ³¨è§£æ˜¯å¦åº”å½“è¢«åŒ…å«åœ¨JavaDocæ–‡æ¡£ä¸­</p>
<p>@Inherited: æ˜¯å¦å…è®¸å­ç±»ç»§æ‰¿è¯¥æ³¨è§£</p>
<h3 id="å…ƒæ³¨è§£-Target"><a href="#å…ƒæ³¨è§£-Target" class="headerlink" title="å…ƒæ³¨è§£@Target"></a>å…ƒæ³¨è§£@Target</h3><p>æè¿°æ‰€ä¿®é¥°çš„æ³¨è§£çš„ä½¿ç”¨èŒƒå›´</p>
<ul>
<li>packagesã€types( ç±»ã€æ¥å£ã€æšä¸¾ã€Annotationç±»å‹ )</li>
<li>ç±»å‹æˆå‘˜(æ–¹æ³•ã€æ„é€ æ–¹æ³•ã€æˆå‘˜å˜é‡ã€æšä¸¾å€¼)</li>
<li>æ–¹æ³•å‚æ•°å’Œæœ¬åœ°å˜é‡(å¦‚å¾ªç¯å˜é‡ã€catchå‚æ•° )</li>
</ul>
<h3 id="ElementType"><a href="#ElementType" class="headerlink" title="ElementType"></a>ElementType</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ElementType</span> {</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">/** å¯ä½œç”¨äºæœ¬åœ°å±€éƒ¨å˜é‡ä¸Š */</span></span><br><span class="line">    LOCAL_VARIABLE,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** å¯ä½œç”¨äºæ³¨è§£ä¸Šï¼ˆå…ƒæ³¨è§£ï¼‰ */</span></span><br><span class="line">    ANNOTATION_TYPE,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Type parameter declaration</span></span><br><span class="line"><span class="comment">     * å¯ä½œç”¨äºæ³›å‹ç±»çš„å®å‚ä¸Š</span></span><br><span class="line"><span class="comment">     * ä¾‹å¦‚ï¼špublic class Demo &lt;<span class="doctag">@TypeParamterAnnotation</span> T&gt;{}</span></span><br><span class="line"><span class="comment">     * åœ¨ Springä¸­çš„ <span class="doctag">@RequestParam</span> å°±æ˜¯ä½¿ç”¨çš„è¯¥ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    TYPE_PARAMETER,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Use of a type</span></span><br><span class="line"><span class="comment">     * èƒ½ä½œç”¨åœ¨ä»»ä½•ç±»å‹ä¹‹ä¸Š</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    TYPE_USE</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="å…ƒæ³¨è§£-Retention"><a href="#å…ƒæ³¨è§£-Retention" class="headerlink" title="å…ƒæ³¨è§£@Retention"></a>å…ƒæ³¨è§£@Retention</h3><ul>
<li>æ ‡æ³¨æ³¨è§£è¢«ä¿ç•™æ—¶é—´çš„é•¿çŸ­</li>
<li>ç”¨äºå®šä¹‰æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸ</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.ANNOTATION_TYPE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Retention {</span><br><span class="line">    RetentionPolicy <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">RetentionPolicy</span> {</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿ç•™åœ¨æºä»£ç ï¼Œä¸ä¿ç•™åœ¨ç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="comment">     * Annotations are to be discarded by the compiler.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SOURCE,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å­—èŠ‚ç æ–‡ä»¶ä¸­ä¹Ÿä¿ç•™æ³¨è§£</span></span><br><span class="line"><span class="comment">     * Annotations are to be recorded in the class file by the compiler</span></span><br><span class="line"><span class="comment">     * but need not be retained by the VM at run time.  This is the default</span></span><br><span class="line"><span class="comment">     * behavior.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    CLASS,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åœ¨è¿è¡Œæ—¶ä¿ç•™æ³¨è§£ï¼Œå¦‚Springä¸­çš„<span class="doctag">@Autowired</span>ï¼Œå¯ä»¥é€šè¿‡åå°„æ¥è·å–</span></span><br><span class="line"><span class="comment">     * Annotations are to be recorded in the class file by the compiler and</span></span><br><span class="line"><span class="comment">     * retained by the VM at run time, so they may be read reflectively.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> java.lang.reflect.AnnotatedElement</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    RUNTIME</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="è‡ªå®šä¹‰æ³¨è§£"><a href="#è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£"></a>è‡ªå®šä¹‰æ³¨è§£</h2><p>è‡ªå®šä¹‰æ³¨è§£ä¸å…è®¸ä»¥ç±»çš„å½¢å¼å®ç°æˆ–ç»§æ‰¿æ¥å£ï¼Œå±æ€§çš„è®¿é—®ä¿®é¥°ç¬¦åªèƒ½å®šä¹‰æˆpublicç±»å‹ã€‚</p>
<p><img src="/p/6ba397bc/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3.png" alt="image-20210416093546063"></p>
<p>åˆ›å»ºä¸€ä¸ªæ³¨è§£ï¼Œå®šä¹‰å¯ä½œç”¨äºç±»ã€æ–¹æ³•ã€å­—æ®µä¸Šã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Target({ElementType.TYPE, ElementType.FIELD, ElementType.METHOD})</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> TestAnnotation {</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">name</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">desc</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">age</span><span class="params">()</span> <span class="keyword">default</span> <span class="number">18</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String[] language();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä½¿ç”¨è¯¥æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TestAnnotation(name = "ç”¨æˆ·bo", desc = "ç”¨æˆ·çš„å®ä½“ç±»æè¿°ä¿¡æ¯", language = {"Java", "C++", "Go"})</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TestAnnotation(name = "ç”¨æˆ·å", desc = "ç”¨æˆ·å¯ç”¨äºç™»å½•è®¤è¯çš„è´¦å·", language = "Java")</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä½¿ç”¨åå°„å®Œæˆè¿›è¡Œè¿è¡Œæ—¶åŠ¨æ€å¤„ç†ï¼š</p>
<ul>
<li>åœ¨Classç±»ä¸­ï¼ŒClassç±»å®ç°äº†AnnotatedElement æ¥å£ï¼Œæä¾›äº†è·å–æ³¨è§£çš„ä¸€ç³»åˆ—ä¿¡æ¯</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">parseTypeAnnotation</span><span class="params">()</span> <span class="keyword">throws</span> ClassNotFoundException {</span><br><span class="line">    <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">"com.demo.hello.entity.bo.User"</span>);</span><br><span class="line">    <span class="comment">// è·å–ç±»ä¸Šçš„TestAnnotationæ³¨è§£</span></span><br><span class="line">    Annotation[] annotations = clazz.getAnnotations();</span><br><span class="line">    <span class="keyword">for</span> (Annotation annotation : annotations) {</span><br><span class="line">        <span class="type">TestAnnotation</span> <span class="variable">testAnnotation</span> <span class="operator">=</span> (TestAnnotation) annotation;</span><br><span class="line">        System.out.println(testAnnotation);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// è·å–å­—æ®µä¸Šçš„TestAnnotationæ³¨è§£</span></span><br><span class="line">    Field[] fields = clazz.getDeclaredFields();</span><br><span class="line">    <span class="keyword">for</span> (Field field : fields) {</span><br><span class="line">        <span class="comment">// è·å–å­—æ®µä¸Šæ˜¯å¦æœ‰TestAnnotationæ³¨è§£</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">present</span> <span class="operator">=</span> field.isAnnotationPresent(TestAnnotation.class);</span><br><span class="line">        <span class="keyword">if</span> (present){</span><br><span class="line">            <span class="type">TestAnnotation</span> <span class="variable">testAnnotation</span> <span class="operator">=</span> field.getAnnotation(TestAnnotation.class);</span><br><span class="line">            System.out.println(testAnnotation);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç¼–è¯‘æ—¶ï¼Œæ·»åŠ å‚æ•° -Djdk.proxy.proxyGenerator.saveGeneratedFiles=true ç”¨äºæŸ¥çœ‹åŠ¨æ€ä»£ç†çš„ä¸­é—´ä»£ç†çš„å¯¹è±¡ã€‚</p>
<p>åœ¨è¿½åŠ  -XX:+traceClassLoading è·Ÿè¸ªç±»åŠ è½½ã€‚</p>
<h2 id="æ³¨è§£çš„å·¥ä½œåŸç†"><a href="#æ³¨è§£çš„å·¥ä½œåŸç†" class="headerlink" title="æ³¨è§£çš„å·¥ä½œåŸç†"></a>æ³¨è§£çš„å·¥ä½œåŸç†</h2><p>1ã€é€šè¿‡é”®å€¼å¯¹çš„å½¢å¼ä¸ºæ³¨è§£å±æ€§èµ‹å€¼ã€‚</p>
<p>2ã€ç¼–è¯‘å™¨æ£€æŸ¥æ³¨è§£çš„ä½¿ç”¨èŒƒå›´,å°†æ³¨è§£ä¿¡æ¯å†™å…¥å…ƒç´ å±æ€§è¡¨ã€‚</p>
<p>3ã€è¿è¡Œæ—¶JVMå°†ï¼ˆå•ä¸ªç±»ä¸­çš„ï¼‰RUNTIMEçš„æ‰€æœ‰æ³¨è§£å±æ€§å–å‡ºå¹¶æœ€ç»ˆå­˜å…¥mapé‡Œã€‚</p>
<p>4ã€åˆ›å»ºAnnotationInvocationHandlerå®ä¾‹å¹¶ä¼ å…¥å‰é¢çš„mapã€‚</p>
<p>5ã€JVMä½¿ç”¨JDKåŠ¨æ€ä»£ç†ä¸ºæ³¨è§£ç”Ÿæˆä»£ç†ç±»,å¹¶åˆå§‹åŒ–å¤„ç†å™¨ã€‚</p>
<p>6ã€è°ƒç”¨invokeæ–¹æ³•,é€šè¿‡ä¼ å…¥æ–¹æ³•åè¿”å›æ³¨è§£å¯¹åº”çš„å±æ€§å€¼ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>ArrayList &amp; LinkedList</title>
    <url>/p/f284337e.html</url>
    <content><![CDATA[<html><head></head><body><p>æœ¬æ–‡è®°å½•ArrayList &amp; LinkedListæºç è§£æï¼ŒåŸºäºJDK1.8ã€‚</p>
<h2 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h2><p>ArrayListå®ç°äº†Listæ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼Œå¯ä»¥çœ‹æˆæ˜¯â€œé•¿åº¦å¯è°ƒèŠ‚çš„æ•°ç»„â€ï¼Œå¯ä»¥åŒ…å«ä»»ä½•ç±»å‹æ•°æ®ï¼ˆåŒ…æ‹¬nullï¼Œå¯é‡å¤ï¼‰ã€‚ArrayListå¤§ä½“å’ŒVectorä¸€è‡´ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯ArrayListéçº¿ç¨‹å®‰å…¨ï¼ŒVectorçº¿ç¨‹å®‰å…¨ï¼Œä½†Vectorçº¿ç¨‹å®‰å…¨çš„ä»£ä»·è¾ƒå¤§ï¼Œæ¨èä½¿ç”¨CopyOnWriteArrayListï¼Œåé¢æ–‡ç« å†åšè®°å½•ã€‚</p>
<h3 id="ç±»ç»“æ„"><a href="#ç±»ç»“æ„" class="headerlink" title="ç±»ç»“æ„"></a>ç±»ç»“æ„</h3><p>ArrayListç±»å±‚çº§å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/p/f284337e/QQ20210219-143407@2x.png" alt="QQ20210219-143407@2x"></p>
<p>ArrayListé¢å¤–å®ç°äº†RandomAccessæ¥å£ï¼Œå…³äºRandomAccessæ¥å£çš„ä½œç”¨ä¸‹é¢å†åšè®¨è®ºã€‚</p>
<p>ArrayListç±»ä¸»è¦åŒ…å«å¦‚ä¸‹ä¸¤ä¸ªæˆå‘˜å˜é‡ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayList</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">AbstractList</span>&lt;E&gt;</span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">List</span>&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable</span><br><span class="line">{</span><br><span class="line">    <span class="keyword">transient</span> Object[] elementData;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line">    ......</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>elementDataä¸ºObjectç±»å‹æ•°ç»„ï¼Œç”¨äºå­˜æ”¾ArrayListæ•°æ®ï¼›sizeè¡¨ç¤ºæ•°ç»„å…ƒç´ ä¸ªæ•°ï¼ˆå¹¶éæ•°ç»„å®¹é‡ï¼‰ã€‚</p>
<p>ArrayListç±»è¿˜åŒ…å«äº†ä¸€äº›å¸¸é‡ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayList</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">AbstractList</span>&lt;E&gt;</span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">List</span>&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable</span><br><span class="line">{</span><br><span class="line">    <span class="comment">// æ•°ç»„é»˜è®¤åˆå§‹åŒ–å®¹é‡ä¸º10</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_CAPACITY</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="comment">// è¡¨ç¤ºç©ºæ•°ç»„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] EMPTY_ELEMENTDATA = {};</span><br><span class="line">    <span class="comment">// ä¹Ÿæ˜¯ç©ºæ•°ç»„ï¼Œå’ŒEMPTY_ELEMENTDATAåŒºåˆ†å¼€</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="æ–¹æ³•è§£æ"><a href="#æ–¹æ³•è§£æ" class="headerlink" title="æ–¹æ³•è§£æ"></a>æ–¹æ³•è§£æ</h3><h4 id="çŸ¥è¯†å‚¨å¤‡"><a href="#çŸ¥è¯†å‚¨å¤‡" class="headerlink" title="çŸ¥è¯†å‚¨å¤‡"></a>çŸ¥è¯†å‚¨å¤‡</h4><p>Arraysç±»çš„<code>copyOf(U[] original, int newLength, Class&lt;? extends T[]&gt; newType)</code>æ–¹æ³•ç”¨äºå¤åˆ¶æŒ‡å®šæ•°ç»„originalåˆ°æ–°æ•°ç»„ï¼Œæ–°æ•°ç»„çš„é•¿åº¦ä¸ºnewLengthï¼Œæ–°æ•°ç»„å…ƒç´ ç±»å‹ä¸ºnewTypeã€‚</p>
<ol>
<li>å¦‚æœæ–°æ•°ç»„çš„é•¿åº¦å¤§äºæ—§æ•°ç»„ï¼Œé‚£ä¹ˆå¤šå‡ºçš„é‚£éƒ¨åˆ†ç”¨nullå¡«å……ï¼›</li>
<li>å¦‚æœæ–°æ•°ç»„çš„é•¿åº¦å°äºæ—§æ•°ç»„ï¼Œé‚£ä¹ˆå°‘çš„é‚£éƒ¨åˆ†ç›´æ¥æˆªå–æ‰ã€‚</li>
</ol>
<p>ä¸¾ä¸¤ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Long[] array1 = <span class="keyword">new</span> <span class="title class_">Long</span>[]{<span class="number">1L</span>, <span class="number">2L</span>, <span class="number">3L</span>};</span><br><span class="line">Object[] array2 = Arrays.copyOf(array1, <span class="number">5</span>, Object[].class);</span><br><span class="line">System.out.println(Arrays.toString(array2)); <span class="comment">// [1, 2, 3, null, null]</span></span><br><span class="line"></span><br><span class="line">Object[] array3 = Arrays.copyOf(array1, <span class="number">1</span>, Object[].class);</span><br><span class="line">System.out.println(Arrays.toString(array3)); <span class="comment">// [1]</span></span><br></pre></td></tr></tbody></table></figure>



<p>é‡è½½æ–¹æ³•<code>copyOf(T[] original, int newLength)</code>ç”¨äºå¤åˆ¶æŒ‡å®šæ•°ç»„originalåˆ°æ–°æ•°ç»„ï¼Œæ–°æ•°ç»„çš„é•¿åº¦ä¸ºnewLengthï¼Œæ–°æ•°ç»„å…ƒç´ ç±»å‹å’Œæ—§æ•°ç»„ä¸€è‡´ã€‚</p>
<p><code>copyOf</code>æ–¹æ³•å†…éƒ¨è°ƒç”¨Systemç±»çš„nativeæ–¹æ³•<code>arraycopy(Object src, int srcPos,Object dest, int destPos, int length)</code>ï¼š</p>
<ol>
<li><code>src</code>ï¼šéœ€è¦è¢«æ‹·è´çš„æ—§æ•°ç»„ï¼›</li>
<li><code>srcPos</code>ï¼šæ—§æ•°ç»„å¼€å§‹æ‹·è´çš„èµ·å§‹ä½ç½®ï¼›</li>
<li><code>dest</code>ï¼šæ‹·è´ç›®æ ‡æ•°ç»„ï¼›</li>
<li><code>destPos</code>ï¼šç›®æ ‡æ•°ç»„çš„èµ·å§‹æ‹·è´ä½ç½®ï¼›</li>
<li><code>length</code>ï¼šæ‹·è´çš„é•¿åº¦ã€‚</li>
</ol>
<p>ä¸¾ä¾‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Long[] array1 = <span class="keyword">new</span> <span class="title class_">Long</span>[]{<span class="number">1L</span>, <span class="number">2L</span>, <span class="number">3L</span>};</span><br><span class="line">Object[] array2 = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">5</span>];</span><br><span class="line">System.arraycopy(array1, <span class="number">0</span>, array2, <span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">System.out.println(Arrays.toString(array2)); <span class="comment">// [1, 2, 3, null, null]</span></span><br></pre></td></tr></tbody></table></figure>

<p>æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Long[] array1 = <span class="keyword">new</span> <span class="title class_">Long</span>[]{<span class="number">1L</span>, <span class="number">2L</span>, <span class="number">3L</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>};</span><br><span class="line"><span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">System.arraycopy(array1, index, array1, index + <span class="number">1</span>, <span class="number">3</span> - index);</span><br><span class="line">array1[index] = <span class="number">0L</span>;</span><br><span class="line">System.out.println(Arrays.toString(array1)); <span class="comment">// [1, 0, 2, 3, null, null]</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">(<span class="type">int</span> initialCapacity)</span> {</span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &gt; <span class="number">0</span>) {</span><br><span class="line">        <span class="built_in">this</span>.elementData = <span class="keyword">new</span> <span class="title class_">Object</span>[initialCapacity];</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (initialCapacity == <span class="number">0</span>) {</span><br><span class="line">        <span class="built_in">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">"Illegal Capacity: "</span>+</span><br><span class="line">                                           initialCapacity);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åˆ›å»ºå®¹é‡å¤§å°ä¸ºinitialCapacityçš„ArrayListï¼Œå¦‚æœinitialCapacityå°äº0ï¼Œåˆ™æŠ›å‡ºIllegalArgumentExceptionå¼‚å¸¸ï¼›å¦‚æœinitialCapacityä¸º0ï¼Œåˆ™elementDataä¸ºEMPTY_ELEMENTDATAã€‚</p>
<p><code>public ArrayList()</code>ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">()</span> {</span><br><span class="line">    <span class="built_in">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç©ºå‚æ„é€ å‡½æ•°ï¼ŒelementDataä¸ºDEFAULTCAPACITY_EMPTY_ELEMENTDATAã€‚</p>
<p><code>public ArrayList(Collection&lt;? extends E&gt; c)</code>ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">(Collection&lt;? extends E&gt; c)</span> {</span><br><span class="line">    elementData = c.toArray();</span><br><span class="line">    <span class="keyword">if</span> ((size = elementData.length) != <span class="number">0</span>) {</span><br><span class="line">        <span class="comment">// c.toArray might (incorrectly) not return Object[] (see 6260652)</span></span><br><span class="line">        <span class="keyword">if</span> (elementData.getClass() != Object[].class)</span><br><span class="line">            elementData = Arrays.copyOf(elementData, size, Object[].class);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">// replace with empty array.</span></span><br><span class="line">        <span class="built_in">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åˆ›å»ºä¸€ä¸ªåŒ…å«æŒ‡å®šé›†åˆcæ•°æ®çš„ArrayListã€‚ä¸Šé¢ä¸ºä»€ä¹ˆè¦å¤šæ­¤ä¸€ä¸¾ä½¿ç”¨<code>Arrays.copyOf(elementData, size, Object[].class)</code>å¤åˆ¶ä¸€éæ•°ç»„å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨æŸäº›æƒ…å†µä¸‹è°ƒç”¨é›†åˆçš„toArray()æ–¹æ³•è¿”å›çš„ç±»å‹å¹¶ä¸æ˜¯Object[].classï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Long[] array1 = {<span class="number">1L</span>, <span class="number">2L</span>};</span><br><span class="line">List&lt;Long&gt; list1 = Arrays.asList(array1);</span><br><span class="line">Object[] array2 = list1.toArray();</span><br><span class="line">System.out.println(array2.getClass() == Object[].class); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">List&lt;Long&gt; list2 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">System.out.println(list2.toArray().getClass() == Object[].class); <span class="comment">// true</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h4 id="add-E-e"><a href="#add-E-e" class="headerlink" title="add(E e)"></a>add(E e)</h4><p><code>add(E e)</code>ç”¨äºå°¾éƒ¨æ·»åŠ å…ƒç´ ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> {</span><br><span class="line">    <span class="comment">// ç”¨äºç¡®å®šæ•°ç»„å®¹é‡</span></span><br><span class="line">    ensureCapacityInternal(size + <span class="number">1</span>);</span><br><span class="line">    elementData[size++] = e;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å‡å¦‚ç°åœ¨æˆ‘ä»¬é€šè¿‡å¦‚ä¸‹ä»£ç åˆ›å»ºäº†ä¸€ä¸ªArrayListå®ä¾‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">list.add(<span class="string">"hello"</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>å†…éƒ¨è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> {</span><br><span class="line">    <span class="comment">// ç”¨äºç¡®å®šæ•°ç»„å®¹é‡ï¼Œe=helloï¼Œsize=0</span></span><br><span class="line">    ensureCapacityInternal(size + <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// æœ«å°¾æ·»åŠ å…ƒç´ ï¼Œç„¶åsizeé€’å¢1</span></span><br><span class="line">    elementData[size++] = e;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ensureCapacityInternal</span><span class="params">(<span class="type">int</span> minCapacity)</span> { <span class="comment">// minCapacity=1,elementData={}</span></span><br><span class="line">    ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">calculateCapacity</span><span class="params">(Object[] elementData, <span class="type">int</span> minCapacity)</span> {</span><br><span class="line">    <span class="keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {</span><br><span class="line">        <span class="comment">// DEFAULT_CAPACITY=10ï¼ŒminCapacity=1ï¼Œæ•…è¿”å›10</span></span><br><span class="line">        <span class="keyword">return</span> Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> minCapacity;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ensureExplicitCapacity</span><span class="params">(<span class="type">int</span> minCapacity)</span> { <span class="comment">// minCapacity=10</span></span><br><span class="line">    modCount++;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// minCapacity=10ï¼ŒelementData.length=0ï¼Œæ‰€ä»¥è°ƒç”¨growæ–¹æ³•æ‰©å®¹</span></span><br><span class="line">    <span class="keyword">if</span> (minCapacity - elementData.length &gt; <span class="number">0</span>)</span><br><span class="line">        grow(minCapacity);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">grow</span><span class="params">(<span class="type">int</span> minCapacity)</span> { <span class="comment">//minCapacity=10</span></span><br><span class="line">    <span class="comment">// oldCapacity=0</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">oldCapacity</span> <span class="operator">=</span> elementData.length;</span><br><span class="line">    <span class="comment">// newCapacityä¸ºoldCapacityçš„1.5å€ï¼Œè¿™é‡Œä¸º0</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// newCapacity=0ï¼ŒminCapacity=10ï¼Œæ‰€ä»¥è¯¥æ¡ä»¶æˆç«‹</span></span><br><span class="line">    <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// newCapacity=10</span></span><br><span class="line">        newCapacity = minCapacity;</span><br><span class="line">    <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">    <span class="comment">// å¤åˆ¶åˆ°æ–°æ•°ç»„ï¼Œæ•°ç»„å®¹é‡ä¸º10</span></span><br><span class="line">    elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">hugeCapacity</span><span class="params">(<span class="type">int</span> minCapacity)</span> {</span><br><span class="line">    <span class="keyword">if</span> (minCapacity &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OutOfMemoryError</span>();</span><br><span class="line">    <span class="comment">// MAX_ARRAY_SIZEå¸¸é‡å€¼ä¸ºInteger.MAX_VALUE - 8ï¼Œé€šè¿‡</span></span><br><span class="line">    <span class="comment">// è¿™æ®µé€»è¾‘æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒArrayListæœ€å¤§å®¹é‡ä¸ºInteger.MAX_VALUE</span></span><br><span class="line">    <span class="keyword">return</span> (minCapacity &gt; MAX_ARRAY_SIZE) ?</span><br><span class="line">        Integer.MAX_VALUE :</span><br><span class="line">        MAX_ARRAY_SIZE;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>é€šè¿‡ä¸Šé¢æºç åˆ†ææˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š</p>
<ol>
<li>ä»»ä½•ä¸€ä¸ªç©ºçš„ArrayListåœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå†…éƒ¨æ•°ç»„å®¹é‡å°†è¢«æ‰©å®¹ä¸º10ï¼›</li>
<li>æ‰©å®¹æ—¶ï¼ŒnewCapacityä¸ºoldCapacityçš„1.5å€ï¼›</li>
<li>æ•°ç»„å®¹é‡æœ€å¤§ä¸ºInteger.MAX_VALUEï¼›</li>
<li>å°¾éƒ¨æ·»åŠ å…ƒç´ ä¸ç”¨ç§»åŠ¨ä»»ä½•å…ƒç´ ï¼Œæ‰€ä»¥é€Ÿåº¦å¿«ã€‚</li>
</ol>
<h4 id="add-int-index-E-element"><a href="#add-int-index-E-element" class="headerlink" title="add(int index, E element)"></a>add(int index, E element)</h4><p><code>add(int index, E element)</code>ç”¨äºåœ¨æŒ‡å®šä½ç½®æ·»åŠ å…ƒç´ ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index, E element)</span> {</span><br><span class="line">    <span class="comment">// ä¸‹æ ‡æ£€æŸ¥</span></span><br><span class="line">    rangeCheckForAdd(index);</span><br><span class="line">    <span class="comment">// ç¡®å®šæ•°ç»„å®¹é‡ï¼Œå’Œä¸Šé¢add(E e)æ–¹æ³•ä»‹ç»çš„ä¸€è‡´</span></span><br><span class="line">    ensureCapacityInternal(size + <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// å°†åŸæ¥indexåé¢çš„æ‰€æœ‰å…ƒç´ å¾€åé¢ç§»åŠ¨ä¸€ä¸ªä½ç½®</span></span><br><span class="line">    System.arraycopy(elementData, index, elementData, index + <span class="number">1</span>,</span><br><span class="line">                     size - index);</span><br><span class="line">    <span class="comment">// indexå¤„æ”¾å…¥æ–°å…ƒç´ </span></span><br><span class="line">    elementData[index] = element;</span><br><span class="line">    <span class="comment">// sizeé€’å¢</span></span><br><span class="line">    size++;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">rangeCheckForAdd</span><span class="params">(<span class="type">int</span> index)</span> {</span><br><span class="line">    <span class="comment">// ä¸‹æ ‡æ¯”sizeå¤§æˆ–è€…ä¸‹æ ‡å°äº0ï¼Œéƒ½ä¼šæŠ›å‡ºä¸‹æ ‡è¶Šç•Œå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (index &gt; size || index &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(outOfBoundsMsg(index));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™é‡Œæ¶‰åŠåˆ°å…ƒç´ ç§»åŠ¨ï¼Œæ‰€ä»¥é€Ÿåº¦è¾ƒæ…¢ã€‚</p>
<h4 id="get-int-index"><a href="#get-int-index" class="headerlink" title="get(int index)"></a>get(int index)</h4><p><code>get(int index)</code>è·å–æŒ‡å®šä½ç½®å…ƒç´ ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> {</span><br><span class="line">    <span class="comment">// ä¸‹æ ‡åˆæ³•æ€§æ£€æŸ¥</span></span><br><span class="line">    rangeCheck(index);</span><br><span class="line">    <span class="comment">// ç›´æ¥è¿”å›æ•°ç»„æŒ‡å®šä½ç½®å…ƒç´ </span></span><br><span class="line">    <span class="keyword">return</span> elementData(index);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">E <span class="title function_">elementData</span><span class="params">(<span class="type">int</span> index)</span> {</span><br><span class="line">    <span class="keyword">return</span> (E) elementData[index];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>get</code>æ–¹æ³•ç›´æ¥è¿”å›æ•°ç»„æŒ‡å®šä¸‹æ ‡å…ƒç´ ï¼Œé€Ÿåº¦éå¸¸å¿«ã€‚</p>
<h4 id="set-int-index-E-element"><a href="#set-int-index-E-element" class="headerlink" title="set(int index, E element)"></a>set(int index, E element)</h4><p><code>set(int index, E element)</code>è®¾ç½®æŒ‡å®šä½ç½®å…ƒç´ ä¸ºæŒ‡å®šå€¼ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">set</span><span class="params">(<span class="type">int</span> index, E element)</span> {</span><br><span class="line">    <span class="comment">// ä¸‹æ ‡åˆæ³•æ€§æ£€æŸ¥</span></span><br><span class="line">    rangeCheck(index);</span><br><span class="line">    <span class="comment">// æ ¹æ®ä¸‹æ ‡è·å–æ—§å€¼</span></span><br><span class="line">    <span class="type">E</span> <span class="variable">oldValue</span> <span class="operator">=</span> elementData(index);</span><br><span class="line">    <span class="comment">// è®¾ç½®æ–°å€¼</span></span><br><span class="line">    elementData[index] = element;</span><br><span class="line">    <span class="comment">// è¿”å›æ—§å€¼</span></span><br><span class="line">    <span class="keyword">return</span> oldValue;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>set</code>æ–¹æ³•ä¸æ¶‰åŠå…ƒç´ ç§»åŠ¨å’Œéå†ï¼Œæ‰€ä»¥é€Ÿåº¦å¿«ã€‚</p>
<h4 id="remove-int-index"><a href="#remove-int-index" class="headerlink" title="remove(int index)"></a>remove(int index)</h4><p><code>remove(int index)</code>åˆ é™¤æŒ‡å®šä½ç½®å…ƒç´ ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> {</span><br><span class="line">    rangeCheck(index);</span><br><span class="line"></span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="comment">// è·å–æŒ‡å®šä½ç½®å…ƒç´ ï¼ˆéœ€è¦è¢«åˆ é™¤çš„å…ƒç´ ï¼‰</span></span><br><span class="line">    <span class="type">E</span> <span class="variable">oldValue</span> <span class="operator">=</span> elementData(index);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">numMoved</span> <span class="operator">=</span> size - index - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// ç›´æ¥å°†indexåé¢çš„å…ƒç´ å¾€å‰ç§»åŠ¨ä¸€ä½ï¼Œè¦†ç›–indexå¤„çš„å…ƒç´ </span></span><br><span class="line">        System.arraycopy(elementData, index+<span class="number">1</span>, elementData, index,</span><br><span class="line">                         numMoved);</span><br><span class="line">    elementData[--size] = <span class="literal">null</span>; <span class="comment">// clear to let GC do its work</span></span><br><span class="line">    <span class="comment">// è¿”å›è¢«åˆ é™¤çš„å…ƒ</span></span><br><span class="line">    <span class="keyword">return</span> oldValue;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸Šè¿°æ–¹æ³•æ¶‰åŠåˆ°å…ƒç´ ç§»åŠ¨ï¼Œæ‰€ä»¥æ•ˆç‡ä¹Ÿä¸é«˜ã€‚</p>
<h4 id="remove-Object-o"><a href="#remove-Object-o" class="headerlink" title="remove(Object o)"></a>remove(Object o)</h4><p><code>remove(Object o)</code>åˆ é™¤æŒ‡å®šå…ƒç´ ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// éå†æ•°ç»„ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªç›®æ ‡å…ƒç´ ï¼Œç„¶ååˆ é™¤</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(Object o)</span> {</span><br><span class="line">    <span class="keyword">if</span> (o == <span class="literal">null</span>) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>; index &lt; size; index++)</span><br><span class="line">            <span class="keyword">if</span> (elementData[index] == <span class="literal">null</span>) {</span><br><span class="line">                fastRemove(index);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            }</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>; index &lt; size; index++)</span><br><span class="line">            <span class="keyword">if</span> (o.equals(elementData[index])) {</span><br><span class="line">                fastRemove(index);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">// é€»è¾‘å’Œremoveä¸€è‡´ï¼Œéƒ½æ˜¯å°†indexåé¢çš„å…ƒç´ å¾€å‰ç§»åŠ¨ä¸€ä½ï¼Œè¦†ç›–indexå¤„çš„å…ƒç´ </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">fastRemove</span><span class="params">(<span class="type">int</span> index)</span> {</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="type">int</span> <span class="variable">numMoved</span> <span class="operator">=</span> size - index - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>)</span><br><span class="line">        System.arraycopy(elementData, index+<span class="number">1</span>, elementData, index,</span><br><span class="line">                         numMoved);</span><br><span class="line">    elementData[--size] = <span class="literal">null</span>; <span class="comment">// clear to let GC do its work</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ–¹æ³•æ¶‰åŠåˆ°æ•°ç»„éå†å’Œå…ƒç´ ç§»åŠ¨ï¼Œæ•ˆç‡ä¹Ÿä¸é«˜ã€‚</p>
<h4 id="trimToSize"><a href="#trimToSize" class="headerlink" title="trimToSize()"></a>trimToSize()</h4><p><code>trimToSize()</code>æºç ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">public void trimToSize() {</span><br><span class="line">    modCount++;</span><br><span class="line">    if (size &lt; elementData.length) {</span><br><span class="line">        elementData = (size == 0)</span><br><span class="line">          ? EMPTY_ELEMENTDATA</span><br><span class="line">          : Arrays.copyOf(elementData, size);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¯¥æ–¹æ³•ç”¨äºå°†æ•°ç»„å®¹é‡è°ƒæ•´ä¸ºå®é™…å…ƒç´ ä¸ªæ•°å¤§å°ï¼Œå½“ä¸€ä¸ªArrayListå…ƒç´ ä¸ªæ•°ä¸ä¼šå‘ç”Ÿæ”¹å˜æ—¶ï¼Œå¯ä»¥è°ƒç”¨è¯¥æ–¹æ³•å‡å°‘å†…å­˜å ç”¨ã€‚</p>
<blockquote>
<p>å…¶ä»–æ–¹æ³•å¯ä»¥è‡ªå·±é˜…è¯»ArrayListæºç ï¼Œæ­¤å¤–åœ¨æ¶‰åŠå¢åˆ æ”¹çš„æ–¹æ³•é‡Œï¼Œæˆ‘ä»¬éƒ½çœ‹åˆ°äº†modCount++æ“ä½œï¼Œå’Œä¹‹å‰ä»‹ç»HashMapæºç æ—¶ä¸€è‡´ï¼Œç”¨äºå¿«é€Ÿå¤±è´¥ã€‚</p>
</blockquote>
<h2 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h2><h3 id="ç±»ç»“æ„-1"><a href="#ç±»ç»“æ„-1" class="headerlink" title="ç±»ç»“æ„"></a>ç±»ç»“æ„</h3><p>LinkedListåº•å±‚é‡‡ç”¨åŒå‘é“¾è¡¨ç»“æ„å­˜å‚¨æ•°æ®ï¼Œå…è®¸é‡å¤æ•°æ®å’Œnullå€¼ï¼Œé•¿åº¦æ²¡æœ‰é™åˆ¶ï¼š</p>
<p><img src="/p/f284337e/QQ20210220-112151@2x.png" alt="QQ20210220-112151@2x"></p>
<p>æ¯ä¸ªèŠ‚ç‚¹ç”¨å†…éƒ¨ç±»Nodeè¡¨ç¤ºï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;E&gt; {</span><br><span class="line">    E item;</span><br><span class="line">    Node&lt;E&gt; next;</span><br><span class="line">    Node&lt;E&gt; prev;</span><br><span class="line"></span><br><span class="line">    Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) {</span><br><span class="line">        <span class="built_in">this</span>.item = element;</span><br><span class="line">        <span class="built_in">this</span>.next = next;</span><br><span class="line">        <span class="built_in">this</span>.prev = prev;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>NodeèŠ‚ç‚¹åŒ…å«itemï¼ˆå­˜å‚¨æ•°æ®ï¼‰ï¼Œnextï¼ˆåç»§èŠ‚ç‚¹ï¼‰å’Œprevï¼ˆå‰ç»§èŠ‚ç‚¹ï¼‰ã€‚æ•°ç»„å†…å­˜åœ°å€å¿…é¡»è¿ç»­ï¼Œè€Œé“¾è¡¨å°±æ²¡æœ‰è¿™ä¸ªé™åˆ¶äº†ï¼ŒNodeå¯ä»¥åˆ†å¸ƒäºå„ä¸ªå†…å­˜åœ°å€ï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»é€šè¿‡prevå’Œnextç»´æŠ¤ã€‚</p>
<p>LinkedListç±»å…³ç³»å›¾ï¼š</p>
<p><img src="/p/f284337e/QQ20210220-112546@2x.png" alt="QQ20210220-112546@2x"></p>
<p>å¯ä»¥çœ‹åˆ°LinkedListç±»å¹¶æ²¡æœ‰å®ç°RandomAccessæ¥å£ï¼Œé¢å¤–å®ç°äº†Dequeæ¥å£ï¼Œæ‰€ä»¥åŒ…å«ä¸€äº›é˜Ÿåˆ—æ–¹æ³•ã€‚</p>
<p>LinkedListåŒ…å«å¦‚ä¸‹æˆå‘˜å˜é‡ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// å…ƒç´ ä¸ªæ•°ï¼Œé»˜è®¤ä¸º0</span></span><br><span class="line"><span class="keyword">transient</span> <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¡¨ç¤ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹å¿…é¡»æ»¡è¶³(first == null &amp;&amp; last == null) || (first.prev == null &amp;&amp; first.item != null)</span></span><br><span class="line"><span class="keyword">transient</span> Node&lt;E&gt; first;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¡¨ç¤ºæœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œæœ€åä¸€ä¸ªèŠ‚ç‚¹å¿…é¡»æ»¡è¶³(first == null &amp;&amp; last == null) || (last.next == null &amp;&amp; last.item != null)</span></span><br><span class="line"><span class="keyword">transient</span> Node&lt;E&gt; last;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="æ–¹æ³•è§£æ-1"><a href="#æ–¹æ³•è§£æ-1" class="headerlink" title="æ–¹æ³•è§£æ"></a>æ–¹æ³•è§£æ</h3><h4 id="æ„é€ å‡½æ•°-1"><a href="#æ„é€ å‡½æ•°-1" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h4><p><code>LinkedList()</code>ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">LinkedList</span><span class="params">()</span> {</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç©ºå‚æ„é€ å‡½æ•°ï¼Œé»˜è®¤sizeä¸º0ï¼Œæ¯æ¬¡æ·»åŠ æ–°å…ƒç´ éƒ½è¦åˆ›å»ºNodeèŠ‚ç‚¹ã€‚</p>
<p><code>LinkedList(Collection&lt;? extends E&gt; c)</code>ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">LinkedList</span><span class="params">(Collection&lt;? extends E&gt; c)</span> {</span><br><span class="line">    <span class="built_in">this</span>();</span><br><span class="line">    addAll(c);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">addAll</span><span class="params">(Collection&lt;? extends E&gt; c)</span> {</span><br><span class="line">    <span class="keyword">return</span> addAll(size, c);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">addAll</span><span class="params">(<span class="type">int</span> index, Collection&lt;? extends E&gt; c)</span> {</span><br><span class="line">    checkPositionIndex(index);</span><br><span class="line"></span><br><span class="line">    Object[] a = c.toArray();</span><br><span class="line">    <span class="type">int</span> <span class="variable">numNew</span> <span class="operator">=</span> a.length;</span><br><span class="line">    <span class="keyword">if</span> (numNew == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    Node&lt;E&gt; pred, succ;</span><br><span class="line">    <span class="keyword">if</span> (index == size) {</span><br><span class="line">        succ = <span class="literal">null</span>;</span><br><span class="line">        pred = last;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        succ = node(index);</span><br><span class="line">        pred = succ.prev;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// å¾ªç¯åˆ›å»ºèŠ‚ç‚¹ï¼Œè®¾ç½®prevï¼ŒnextæŒ‡å‘</span></span><br><span class="line">    <span class="keyword">for</span> (Object o : a) {</span><br><span class="line">        <span class="meta">@SuppressWarnings("unchecked")</span> <span class="type">E</span> <span class="variable">e</span> <span class="operator">=</span> (E) o;</span><br><span class="line">        Node&lt;E&gt; newNode = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(pred, e, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (pred == <span class="literal">null</span>)</span><br><span class="line">            first = newNode;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            pred.next = newNode;</span><br><span class="line">        pred = newNode;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (succ == <span class="literal">null</span>) {</span><br><span class="line">        last = pred;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        pred.next = succ;</span><br><span class="line">        succ.prev = pred;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    size += numNew;</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¯¥æ„é€ å‡½æ•°ç”¨äºåˆ›å»ºLinkedListï¼Œå¹¶å¾€é‡Œæ·»åŠ æŒ‡å®šé›†åˆå…ƒç´ ã€‚</p>
<h4 id="add-int-index-E-element-1"><a href="#add-int-index-E-element-1" class="headerlink" title="add(int index, E element)"></a>add(int index, E element)</h4><p><code>add(int index, E element)</code>æŒ‡å®šä¸‹æ ‡æ’å…¥å…ƒç´ ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index, E element)</span> {</span><br><span class="line">    <span class="comment">// ä¸‹æ ‡åˆæ³•æ€§æ£€æŸ¥</span></span><br><span class="line">    checkPositionIndex(index);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index == size)</span><br><span class="line">        <span class="comment">// å¦‚æœæ’å…¥ä¸‹æ ‡ç­‰äºsizeï¼Œè¯´æ˜æ˜¯åœ¨å°¾éƒ¨æ’å…¥ï¼Œæ‰§è¡Œå°¾éƒ¨æ’å…¥æ“ä½œ</span></span><br><span class="line">        linkLast(element);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment">// å¦‚æœä¸æ˜¯å°¾æ’å…¥ï¼Œåˆ™åœ¨æŒ‡å®šä¸‹æ ‡èŠ‚ç‚¹å‰æ’å…¥</span></span><br><span class="line">        linkBefore(element, node(index));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkPositionIndex</span><span class="params">(<span class="type">int</span> index)</span> {</span><br><span class="line">    <span class="keyword">if</span> (!isPositionIndex(index))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(outOfBoundsMsg(index));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isPositionIndex</span><span class="params">(<span class="type">int</span> index)</span> {</span><br><span class="line">    <span class="keyword">return</span> index &gt;= <span class="number">0</span> &amp;&amp; index &lt;= size;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">linkLast</span><span class="params">(E e)</span> {</span><br><span class="line">    <span class="comment">// è·å–æœ€åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; l = last;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œprevä¸ºåŸé“¾è¡¨æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œnextä¸ºnull</span></span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; newNode = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(l, e, <span class="literal">null</span>);</span><br><span class="line">    <span class="comment">// æ›´æ–°lastä¸ºæ–°èŠ‚ç‚¹</span></span><br><span class="line">    last = newNode;</span><br><span class="line">    <span class="keyword">if</span> (l == <span class="literal">null</span>)</span><br><span class="line">        <span class="comment">// å¦‚æœåŸé“¾è¡¨æœ€åä¸€ä¸ªèŠ‚ç‚¹ä¸ºnullï¼Œè¯´æ˜åŸé“¾è¡¨æ²¡æœ‰èŠ‚ç‚¹ï¼Œå°†æ–°èŠ‚ç‚¹èµ‹ç»™first</span></span><br><span class="line">        first = newNode;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment">// å¦åˆ™æ›´æ–°åŸé“¾è¡¨æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„nextä¸ºæ–°èŠ‚ç‚¹</span></span><br><span class="line">        l.next = newNode;</span><br><span class="line">    <span class="comment">// sizeé€’å¢</span></span><br><span class="line">    size++;</span><br><span class="line">    <span class="comment">// æ¨¡æ•°é€’å¢ï¼Œç”¨äºå¿«é€Ÿå¤±è´¥</span></span><br><span class="line">    modCount++;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">linkBefore</span><span class="params">(E e, Node&lt;E&gt; succ)</span> {</span><br><span class="line">    <span class="comment">// succä¸ºåŸé“¾è¡¨æŒ‡å®šindexä½ç½®çš„èŠ‚ç‚¹ï¼Œè·å–å…¶prevèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; pred = succ.prev;</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ–°èŠ‚ç‚¹ï¼Œprevä¸ºåŸé“¾è¡¨æŒ‡å®šindexä½ç½®çš„èŠ‚ç‚¹çš„prevèŠ‚ç‚¹ï¼Œnextä¸ºåŸé“¾è¡¨æŒ‡å®šindexä½ç½®çš„èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; newNode = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(pred, e, succ);</span><br><span class="line">    <span class="comment">// å°†åŸé“¾è¡¨æŒ‡å®šindexä½ç½®çš„èŠ‚ç‚¹çš„prevæ›´æ–°ä¸ºæ–°èŠ‚ç‚¹</span></span><br><span class="line">    succ.prev = newNode;</span><br><span class="line">    <span class="keyword">if</span> (pred == <span class="literal">null</span>)</span><br><span class="line">        <span class="comment">// å¦‚æœé“¾è¡¨æŒ‡å®šindexä½ç½®çš„èŠ‚ç‚¹çš„prevä¸ºnullï¼Œè¯´æ˜åŸé“¾è¡¨æ²¡æœ‰èŠ‚ç‚¹ï¼Œå°†æ–°èŠ‚ç‚¹èµ‹ç»™first</span></span><br><span class="line">        first = newNode;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment">// å¦åˆ™æ›´æ–°åŸé“¾è¡¨æŒ‡å®šindexä½ç½®çš„èŠ‚ç‚¹çš„prevçš„nextèŠ‚ç‚¹ä¸ºæ–°èŠ‚ç‚¹</span></span><br><span class="line">        pred.next = newNode;</span><br><span class="line">    <span class="comment">// sizeé€’å¢</span></span><br><span class="line">    size++;</span><br><span class="line">    <span class="comment">// æ¨¡æ•°é€’å¢ï¼Œç”¨äºå¿«é€Ÿå¤±è´¥</span></span><br><span class="line">    modCount++;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡‡ç”¨äºŒåˆ†æ³•éå†æ¯ä¸ªNodeèŠ‚ç‚¹ï¼Œç›´åˆ°æ‰¾åˆ°indexä½ç½®çš„èŠ‚ç‚¹</span></span><br><span class="line">Node&lt;E&gt; <span class="title function_">node</span><span class="params">(<span class="type">int</span> index)</span> {</span><br><span class="line">    <span class="comment">// assert isElementIndex(index);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index &lt; (size &gt;&gt; <span class="number">1</span>)) {</span><br><span class="line">        Node&lt;E&gt; x = first;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; index; i++)</span><br><span class="line">            x = x.next;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        Node&lt;E&gt; x = last;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> size - <span class="number">1</span>; i &gt; index; i--)</span><br><span class="line">            x = x.prev;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä»£ç è¾ƒä¸ºç®€å•ï¼Œæ— éå°±æ˜¯è®¾ç½®èŠ‚ç‚¹çš„prevå’Œnextå…³ç³»ã€‚å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†å¤´æ’å’Œå°¾æ’å¤–ï¼Œåœ¨é“¾è¡¨åˆ«çš„ä½ç½®æ’å…¥æ–°èŠ‚ç‚¹ï¼Œæ¶‰åŠåˆ°èŠ‚ç‚¹éå†æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬å¸¸è¯´çš„é“¾è¡¨æ’å…¥é€Ÿåº¦å¿«ï¼ŒæŒ‡çš„æ˜¯æ’å…¥èŠ‚ç‚¹æ”¹å˜å‰åèŠ‚ç‚¹çš„å¼•ç”¨è¿‡ç¨‹å¾ˆå¿«ã€‚</p>
<h4 id="get-int-index-1"><a href="#get-int-index-1" class="headerlink" title="get(int index)"></a>get(int index)</h4><p><code>get(int index)</code>è·å–æŒ‡å®šä¸‹æ ‡å…ƒç´ ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> {</span><br><span class="line">    checkElementIndex(index);</span><br><span class="line">    <span class="keyword">return</span> node(index).item;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡‡ç”¨äºŒåˆ†æ³•éå†æ¯ä¸ªNodeèŠ‚ç‚¹ï¼Œç›´åˆ°æ‰¾åˆ°indexä½ç½®çš„èŠ‚ç‚¹</span></span><br><span class="line">Node&lt;E&gt; <span class="title function_">node</span><span class="params">(<span class="type">int</span> index)</span> {</span><br><span class="line">    <span class="comment">// assert isElementIndex(index);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index &lt; (size &gt;&gt; <span class="number">1</span>)) {</span><br><span class="line">        Node&lt;E&gt; x = first;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; index; i++)</span><br><span class="line">            x = x.next;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        Node&lt;E&gt; x = last;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> size - <span class="number">1</span>; i &gt; index; i--)</span><br><span class="line">            x = x.prev;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä»£ç è¾ƒä¸ºç®€å•ï¼Œå°±æ˜¯é€šè¿‡nodeå‡½æ•°æŸ¥æ‰¾æŒ‡å®šindexä¸‹æ ‡Nodeï¼Œç„¶åè·å–å…¶itemå±æ€§å€¼ï¼ŒèŠ‚ç‚¹æŸ¥æ‰¾éœ€è¦éå†ã€‚</p>
<h4 id="set-int-index-E-element-1"><a href="#set-int-index-E-element-1" class="headerlink" title="set(int index, E element)"></a>set(int index, E element)</h4><p><code>set(int index, E element)</code>è®¾ç½®æŒ‡å®šä¸‹æ ‡èŠ‚ç‚¹çš„itemä¸ºæŒ‡å®šå€¼ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">set</span><span class="params">(<span class="type">int</span> index, E element)</span> {</span><br><span class="line">    <span class="comment">// ä¸‹æ ‡åˆæ³•æ€§æ£€æŸ¥</span></span><br><span class="line">    checkElementIndex(index);</span><br><span class="line">    <span class="comment">// è·å–indexä¸‹æ ‡èŠ‚ç‚¹</span></span><br><span class="line">    Node&lt;E&gt; x = node(index);</span><br><span class="line">    <span class="comment">// è·å–æ—§å€¼</span></span><br><span class="line">    <span class="type">E</span> <span class="variable">oldVal</span> <span class="operator">=</span> x.item;</span><br><span class="line">    <span class="comment">// è®¾ç½®æ–°å€¼</span></span><br><span class="line">    x.item = element;</span><br><span class="line">    <span class="comment">// è¿”å›æ—§å€¼</span></span><br><span class="line">    <span class="keyword">return</span> oldVal;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡‡ç”¨äºŒåˆ†æ³•éå†æ¯ä¸ªNodeèŠ‚ç‚¹ï¼Œç›´åˆ°æ‰¾åˆ°indexä½ç½®çš„èŠ‚ç‚¹</span></span><br><span class="line">Node&lt;E&gt; <span class="title function_">node</span><span class="params">(<span class="type">int</span> index)</span> {</span><br><span class="line">    <span class="comment">// assert isElementIndex(index);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index &lt; (size &gt;&gt; <span class="number">1</span>)) {</span><br><span class="line">        Node&lt;E&gt; x = first;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; index; i++)</span><br><span class="line">            x = x.next;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        Node&lt;E&gt; x = last;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> size - <span class="number">1</span>; i &gt; index; i--)</span><br><span class="line">            x = x.prev;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œsetæ–¹æ³•ä¹Ÿéœ€è¦é€šè¿‡éå†æŸ¥æ‰¾ç›®æ ‡èŠ‚ç‚¹ã€‚</p>
<h4 id="remove-int-index-1"><a href="#remove-int-index-1" class="headerlink" title="remove(int index)"></a>remove(int index)</h4><p><code>remove(int index)</code>åˆ é™¤æŒ‡å®šä¸‹æ ‡èŠ‚ç‚¹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> {</span><br><span class="line">    checkElementIndex(index);</span><br><span class="line">    <span class="keyword">return</span> unlink(node(index));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">E <span class="title function_">unlink</span><span class="params">(Node&lt;E&gt; x)</span> {</span><br><span class="line">    <span class="comment">// assert x != null;</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">E</span> <span class="variable">element</span> <span class="operator">=</span> x.item;</span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; next = x.next;</span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; prev = x.prev;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (prev == <span class="literal">null</span>) {</span><br><span class="line">        first = next;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        prev.next = next;</span><br><span class="line">        x.prev = <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (next == <span class="literal">null</span>) {</span><br><span class="line">        last = prev;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        next.prev = prev;</span><br><span class="line">        x.next = <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    x.item = <span class="literal">null</span>;</span><br><span class="line">    size--;</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">return</span> element;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>remove(int index)</code>é€šè¿‡nodeæ–¹æ³•æ‰¾åˆ°éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œç„¶åè°ƒç”¨unlinkæ–¹æ³•æ”¹å˜åˆ é™¤èŠ‚ç‚¹çš„prevå’ŒnextèŠ‚ç‚¹çš„å‰ç»§å’Œåç»§èŠ‚ç‚¹ã€‚</p>
<blockquote>
<p>å‰©ä¸‹çš„æ–¹æ³•å¯ä»¥è‡ªå·±é˜…è¯»æºç ã€‚</p>
</blockquote>
<h2 id="RandomAccessæ¥å£"><a href="#RandomAccessæ¥å£" class="headerlink" title="RandomAccessæ¥å£"></a>RandomAccessæ¥å£</h2><p>RandomAccessæ¥å£æ˜¯ä¸€ä¸ªç©ºæ¥å£ï¼Œä¸åŒ…å«ä»»ä½•æ–¹æ³•ï¼Œåªæ˜¯ä½œä¸ºä¸€ä¸ªæ ‡è¯†ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> java.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RandomAccess</span> {</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å®ç°è¯¥æ¥å£çš„ç±»è¯´æ˜å…¶æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼Œæ¯”å¦‚ArrayListå®ç°äº†è¯¥æ¥å£ï¼Œè¯´æ˜ArrayListæ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ã€‚æ‰€è°“å¿«é€Ÿéšæœºè®¿é—®æŒ‡çš„æ˜¯é€šè¿‡å…ƒç´ çš„ä¸‹æ ‡å³å¯å¿«é€Ÿè·å–å…ƒç´ å¯¹è±¡ï¼Œæ— éœ€éå†ï¼Œè€ŒLinkedListåˆ™æ²¡æœ‰è¿™ä¸ªç‰¹æ€§ï¼Œå…ƒç´ è·å–å¿…é¡»éå†é“¾è¡¨ã€‚</p>
<p>åœ¨Collectionsç±»çš„<code>binarySearch(List&lt;? extends Comparable&lt;? super T&gt;&gt; list, T key)</code>æ–¹æ³•ä¸­ï¼Œå¯ä»¥çœ‹åˆ°RandomAccessçš„åº”ç”¨ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt;</span><br><span class="line"><span class="type">int</span> <span class="title function_">binarySearch</span><span class="params">(List&lt;? extends Comparable&lt;? <span class="built_in">super</span> T&gt;&gt; list, T key)</span> {</span><br><span class="line">    <span class="keyword">if</span> (list <span class="keyword">instanceof</span> RandomAccess || list.size()&lt;BINARYSEARCH_THRESHOLD)</span><br><span class="line">        <span class="keyword">return</span> Collections.indexedBinarySearch(list, key);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> Collections.iteratorBinarySearch(list, key);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å½“listå®ç°äº†RandomAccessæ¥å£æ—¶ï¼Œè°ƒç”¨indexedBinarySearchæ–¹æ³•ï¼Œå¦åˆ™è°ƒç”¨iteratorBinarySearchã€‚æ‰€ä»¥å½“æˆ‘ä»¬éå†é›†åˆæ—¶ï¼Œå¦‚æœé›†åˆå®ç°äº†RandomAccessæ¥å£ï¼Œä¼˜å…ˆé€‰æ‹©æ™®é€šforå¾ªç¯ï¼Œå…¶æ¬¡foreachï¼›éå†æœªå®ç°RandomAccessçš„æ¥å£ï¼Œä¼˜å…ˆé€‰æ‹©iteratoréå†ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaåŸºç¡€(ä¸€)</title>
    <url>/p/15328330.html</url>
    <content><![CDATA[<html><head></head><body><h3 id="ä¸ºä»€ä¹ˆJavaä»£ç å¯ä»¥å®ç°ä¸€æ¬¡ç¼–å†™ã€åˆ°å¤„è¿è¡Œï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆJavaä»£ç å¯ä»¥å®ç°ä¸€æ¬¡ç¼–å†™ã€åˆ°å¤„è¿è¡Œï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆJavaä»£ç å¯ä»¥å®ç°ä¸€æ¬¡ç¼–å†™ã€åˆ°å¤„è¿è¡Œï¼Ÿ"></a>ä¸ºä»€ä¹ˆJavaä»£ç å¯ä»¥å®ç°ä¸€æ¬¡ç¼–å†™ã€åˆ°å¤„è¿è¡Œï¼Ÿ</h3><p>JVMï¼ˆJavaè™šæ‹Ÿæœºï¼‰æ˜¯Javaè·¨å¹³å°çš„å…³é”®ã€‚</p>
<p>åœ¨ç¨‹åºè¿è¡Œå‰ï¼ŒJavaæºä»£ç ï¼ˆ.javaï¼‰éœ€è¦ç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘æˆå­—èŠ‚ç ï¼ˆ.classï¼‰ã€‚åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼ŒJVMè´Ÿè´£å°†å­—èŠ‚ç ç¿»è¯‘æˆç‰¹å®šå¹³å°ä¸‹çš„æœºå™¨ç å¹¶è¿è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦åœ¨ä¸åŒçš„å¹³å°ä¸Šå®‰è£…å¯¹åº”çš„JVMï¼Œå°±å¯ä»¥è¿è¡Œå­—èŠ‚ç æ–‡ä»¶ã€‚</p>
<p>åŒä¸€ä»½Javaæºä»£ç åœ¨ä¸åŒçš„å¹³å°ä¸Šè¿è¡Œï¼Œå®ƒä¸éœ€è¦åšä»»ä½•çš„æ”¹å˜ï¼Œå¹¶ä¸”åªéœ€è¦ç¼–è¯‘ä¸€æ¬¡ã€‚è€Œç¼–è¯‘å¥½çš„å­—èŠ‚ç ï¼Œæ˜¯é€šè¿‡JVMè¿™ä¸ªä¸­é—´çš„â€œæ¡¥æ¢â€å®ç°è·¨å¹³å°çš„ï¼ŒJVMæ˜¯ä¸å¹³å°ç›¸å…³çš„è½¯ä»¶ï¼Œå®ƒèƒ½å°†ç»Ÿä¸€çš„å­—èŠ‚ç ç¿»è¯‘æˆè¯¥å¹³å°çš„æœºå™¨ç ã€‚</p>
<p><strong>æ³¨æ„äº‹é¡¹</strong></p>
<ol>
<li>ç¼–è¯‘çš„ç»“æœæ˜¯ç”Ÿæˆå­—èŠ‚ç ã€ä¸æ˜¯æœºå™¨ç ï¼Œå­—èŠ‚ç ä¸èƒ½ç›´æ¥è¿è¡Œï¼Œå¿…é¡»é€šè¿‡JVMç¿»è¯‘æˆæœºå™¨ç æ‰èƒ½è¿è¡Œï¼›</li>
<li>è·¨å¹³å°çš„æ˜¯Javaç¨‹åºã€è€Œä¸æ˜¯JVMï¼ŒJVMæ˜¯ç”¨C/C++å¼€å‘çš„è½¯ä»¶ï¼Œä¸åŒå¹³å°ä¸‹éœ€è¦å®‰è£…ä¸åŒç‰ˆæœ¬çš„JVMã€‚</li>
</ol>
<h3 id="ä¸€ä¸ªJavaæ–‡ä»¶é‡Œå¯ä»¥æœ‰å¤šä¸ªç±»å—ï¼ˆä¸å«å†…éƒ¨ç±»ï¼‰ï¼Ÿ"><a href="#ä¸€ä¸ªJavaæ–‡ä»¶é‡Œå¯ä»¥æœ‰å¤šä¸ªç±»å—ï¼ˆä¸å«å†…éƒ¨ç±»ï¼‰ï¼Ÿ" class="headerlink" title="ä¸€ä¸ªJavaæ–‡ä»¶é‡Œå¯ä»¥æœ‰å¤šä¸ªç±»å—ï¼ˆä¸å«å†…éƒ¨ç±»ï¼‰ï¼Ÿ"></a>ä¸€ä¸ªJavaæ–‡ä»¶é‡Œå¯ä»¥æœ‰å¤šä¸ªç±»å—ï¼ˆä¸å«å†…éƒ¨ç±»ï¼‰ï¼Ÿ</h3><ol>
<li>ä¸€ä¸ªjavaæ–‡ä»¶é‡Œå¯ä»¥æœ‰å¤šä¸ªç±»ï¼Œä½†æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªè¢«publicä¿®é¥°çš„ç±»ï¼›</li>
<li>å¦‚æœè¿™ä¸ªjavaæ–‡ä»¶ä¸­åŒ…å«publicä¿®é¥°çš„ç±»ï¼Œåˆ™è¿™ä¸ªç±»çš„åç§°å¿…é¡»å’Œjavaæ–‡ä»¶åä¸€è‡´ã€‚</li>
</ol>
<h3 id="è¯´ä¸€è¯´ä½ å¯¹Javaè®¿é—®æƒé™çš„äº†è§£"><a href="#è¯´ä¸€è¯´ä½ å¯¹Javaè®¿é—®æƒé™çš„äº†è§£" class="headerlink" title="è¯´ä¸€è¯´ä½ å¯¹Javaè®¿é—®æƒé™çš„äº†è§£"></a>è¯´ä¸€è¯´ä½ å¯¹Javaè®¿é—®æƒé™çš„äº†è§£</h3><p>Javaè¯­è¨€ä¸ºæˆ‘ä»¬æä¾›äº†ä¸‰ç§è®¿é—®ä¿®é¥°ç¬¦ï¼Œå³privateã€protectedã€publicï¼Œåœ¨ä½¿ç”¨è¿™äº›ä¿®é¥°ç¬¦ä¿®é¥°ç›®æ ‡æ—¶ï¼Œä¸€å…±å¯ä»¥å½¢æˆå››ç§è®¿é—®æƒé™ï¼Œå³privateã€defaultã€protectedã€publicï¼Œæ³¨æ„åœ¨ä¸åŠ ä»»ä½•ä¿®é¥°ç¬¦æ—¶ä¸ºdefaultè®¿é—®æƒé™ã€‚</p>
<p>åœ¨ä¿®é¥°æˆå‘˜å˜é‡/æˆå‘˜æ–¹æ³•æ—¶ï¼Œè¯¥æˆå‘˜çš„å››ç§è®¿é—®æƒé™çš„å«ä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>privateï¼šè¯¥æˆå‘˜å¯ä»¥è¢«è¯¥ç±»å†…éƒ¨æˆå‘˜è®¿é—®ï¼›</li>
<li>defaultï¼šè¯¥æˆå‘˜å¯ä»¥è¢«è¯¥ç±»å†…éƒ¨æˆå‘˜è®¿é—®ï¼Œä¹Ÿå¯ä»¥è¢«åŒä¸€åŒ…ä¸‹å…¶ä»–çš„ç±»è®¿é—®ï¼›</li>
<li>protectedï¼šè¯¥æˆå‘˜å¯ä»¥è¢«è¯¥ç±»å†…éƒ¨æˆå‘˜è®¿é—®ï¼Œä¹Ÿå¯ä»¥è¢«åŒä¸€åŒ…ä¸‹å…¶ä»–çš„ç±»è®¿é—®ï¼Œè¿˜å¯ä»¥è¢«å®ƒçš„å­ç±»è®¿é—®ï¼›</li>
<li>publicï¼šè¯¥æˆå‘˜å¯ä»¥è¢«ä»»æ„åŒ…ä¸‹ï¼Œä»»æ„ç±»çš„æˆå‘˜è¿›è¡Œè®¿é—®ã€‚</li>
</ul>
<p>åœ¨ä¿®é¥°ç±»æ—¶ï¼Œè¯¥ç±»åªæœ‰ä¸¤ç§è®¿é—®æƒé™ï¼Œå¯¹åº”çš„è®¿é—®æƒé™çš„å«ä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>defaultï¼šè¯¥ç±»å¯ä»¥è¢«åŒä¸€åŒ…ä¸‹å…¶ä»–çš„ç±»è®¿é—®ï¼›</li>
<li>publicï¼šè¯¥ç±»å¯ä»¥è¢«ä»»æ„åŒ…ä¸‹ï¼Œä»»æ„çš„ç±»æ‰€è®¿é—®ã€‚</li>
</ul>
<h3 id="ä»‹ç»ä¸€ä¸‹Javaçš„æ•°æ®ç±»å‹"><a href="#ä»‹ç»ä¸€ä¸‹Javaçš„æ•°æ®ç±»å‹" class="headerlink" title="ä»‹ç»ä¸€ä¸‹Javaçš„æ•°æ®ç±»å‹"></a>ä»‹ç»ä¸€ä¸‹Javaçš„æ•°æ®ç±»å‹</h3><p>Javaæ•°æ®ç±»å‹åŒ…æ‹¬<strong>åŸºæœ¬æ•°æ®ç±»å‹</strong>å’Œ<strong>å¼•ç”¨æ•°æ®ç±»å‹</strong>ä¸¤å¤§ç±»ã€‚</p>
<table>
<thead>
<tr>
<th align="center">8ä¸ªåŸºæœ¬ç±»å‹</th>
</tr>
</thead>
</table>
<table>
<thead>
<tr>
<th align="center">ç±»å‹</th>
<th align="center">åŸºæœ¬ç±»å‹</th>
<th align="center">æ‰€å å­—èŠ‚(byte)</th>
<th align="center">æ‰€å ä½æ•°(bit)</th>
</tr>
</thead>
<tbody><tr>
<td align="center">æ•°å€¼ç±»å‹</td>
<td align="center">byte</td>
<td align="center">1</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">short</td>
<td align="center">2</td>
<td align="center">2*8</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">long</td>
<td align="center">8</td>
<td align="center">8*8</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">int</td>
<td align="center">4</td>
<td align="center">4*8</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">float</td>
<td align="center">4</td>
<td align="center">4*8</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">double</td>
<td align="center">16</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center">char</td>
<td align="center">2</td>
<td align="center">2*8</td>
</tr>
<tr>
<td align="center">å¸ƒå°”ç±»å‹</td>
<td align="center">boolean</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
</tbody></table>
<p>å¼•ç”¨ç±»å‹å°±æ˜¯å¯¹ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œæ ¹æ®å¼•ç”¨å¯¹è±¡ç±»å‹çš„ä¸åŒï¼Œå¯ä»¥å°†å¼•ç”¨ç±»å‹åˆ†ä¸º3ç±»ï¼Œå³æ•°ç»„ã€ç±»ã€æ¥å£ç±»å‹ã€‚å¼•ç”¨ç±»å‹æœ¬è´¨ä¸Šå°±æ˜¯é€šè¿‡æŒ‡é’ˆï¼ŒæŒ‡å‘å †ä¸­å¯¹è±¡æ‰€æŒæœ‰çš„å†…å­˜ç©ºé—´ï¼Œåªæ˜¯Javaè¯­è¨€ä¸å†æ²¿ç”¨æŒ‡é’ˆè¿™ä¸ªè¯´æ³•è€Œå·²ã€‚</p>
<h3 id="intç±»å‹çš„æ•°æ®èŒƒå›´æ˜¯å¤šå°‘ï¼Ÿ"><a href="#intç±»å‹çš„æ•°æ®èŒƒå›´æ˜¯å¤šå°‘ï¼Ÿ" class="headerlink" title="intç±»å‹çš„æ•°æ®èŒƒå›´æ˜¯å¤šå°‘ï¼Ÿ"></a>intç±»å‹çš„æ•°æ®èŒƒå›´æ˜¯å¤šå°‘ï¼Ÿ</h3><p>intç±»å‹å 4å­—èŠ‚ï¼ˆ32ä½ï¼‰ï¼Œæ•°æ®èŒƒå›´æ˜¯ -2^31 ~ 2^31-1ã€‚</p>
<h3 id="è¯·ä»‹ç»å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡çš„åŒºåˆ«"><a href="#è¯·ä»‹ç»å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡çš„åŒºåˆ«" class="headerlink" title="è¯·ä»‹ç»å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡çš„åŒºåˆ«"></a>è¯·ä»‹ç»å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡çš„åŒºåˆ«</h3><p>Javaä¸­çš„å˜é‡åˆ†ä¸ºæˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡ï¼Œå®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<p>æˆå‘˜å˜é‡ï¼š</p>
<ol>
<li>æˆå‘˜å˜é‡æ˜¯åœ¨ç±»çš„èŒƒå›´é‡Œå®šä¹‰çš„å˜é‡ï¼›</li>
<li>æˆå‘˜å˜é‡æœ‰é»˜è®¤åˆå§‹å€¼ï¼›</li>
<li>æœªè¢«staticä¿®é¥°çš„æˆå‘˜å˜é‡ä¹Ÿå«å®ä¾‹å˜é‡ï¼Œå®ƒå­˜å‚¨äºå¯¹è±¡æ‰€åœ¨çš„å †å†…å­˜ä¸­ï¼Œç”Ÿå‘½å‘¨æœŸä¸å¯¹è±¡ç›¸åŒï¼›</li>
<li>è¢«staticä¿®é¥°çš„æˆå‘˜å˜é‡ä¹Ÿå«ç±»å˜é‡ï¼Œå®ƒå­˜å‚¨äºæ–¹æ³•åŒºä¸­ï¼Œç”Ÿå‘½å‘¨æœŸä¸å½“å‰ç±»ç›¸åŒã€‚</li>
</ol>
<p>å±€éƒ¨å˜é‡ï¼š</p>
<ol>
<li>å±€éƒ¨å˜é‡æ˜¯åœ¨æ–¹æ³•é‡Œå®šä¹‰çš„å˜é‡ï¼›</li>
<li>å±€éƒ¨å˜é‡æ²¡æœ‰é»˜è®¤åˆå§‹å€¼ï¼›</li>
<li>å±€éƒ¨å˜é‡å­˜å‚¨äºæ ˆå†…å­˜ä¸­ï¼Œä½œç”¨çš„èŒƒå›´ç»“æŸï¼Œå˜é‡ç©ºé—´ä¼šè‡ªåŠ¨çš„é‡Šæ”¾ã€‚</li>
</ol>
<p><strong>æ³¨æ„äº‹é¡¹</strong></p>
<p>Javaä¸­æ²¡æœ‰çœŸæ­£çš„å…¨å±€å˜é‡ï¼Œé¢è¯•å®˜åº”è¯¥æ˜¯å‡ºäºå…¶ä»–è¯­è¨€çš„ä¹ æƒ¯è¯´å…¨å±€å˜é‡çš„ï¼Œä»–çš„æœ¬æ„åº”è¯¥æ˜¯æŒ‡æˆå‘˜å˜é‡ã€‚</p>
<h3 id="è¯·ä»‹ç»ä¸€ä¸‹å®ä¾‹å˜é‡çš„é»˜è®¤å€¼"><a href="#è¯·ä»‹ç»ä¸€ä¸‹å®ä¾‹å˜é‡çš„é»˜è®¤å€¼" class="headerlink" title="è¯·ä»‹ç»ä¸€ä¸‹å®ä¾‹å˜é‡çš„é»˜è®¤å€¼"></a>è¯·ä»‹ç»ä¸€ä¸‹å®ä¾‹å˜é‡çš„é»˜è®¤å€¼</h3><p>å®ä¾‹å˜é‡è‹¥ä¸ºå¼•ç”¨æ•°æ®ç±»å‹ï¼Œå…¶é»˜è®¤å€¼ä¸€å¾‹ä¸ºnullã€‚è‹¥ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ï¼Œå…¶é»˜è®¤å€¼å¦‚ä¸‹ï¼š</p>
<ul>
<li>byteï¼š0</li>
<li>shortï¼š0</li>
<li>intï¼š0</li>
<li>longï¼š0L</li>
<li>floatï¼š0.0F</li>
<li>doubleï¼š0.0</li>
<li>charï¼šâ€™\u0000â€™</li>
<li>booleanï¼šfalse</li>
</ul>
<p><strong>æ³¨æ„äº‹é¡¹</strong></p>
<p>ä¸Šè¿°é»˜è®¤å€¼è§„åˆ™é€‚ç”¨äºæ‰€æœ‰çš„æˆå‘˜å˜é‡ï¼Œæ‰€ä»¥å¯¹äºç±»å˜é‡ä¹Ÿæ˜¯é€‚ç”¨çš„ã€‚</p>
<h3 id="ä¸ºå•¥è¦æœ‰åŒ…è£…ç±»ï¼Ÿ"><a href="#ä¸ºå•¥è¦æœ‰åŒ…è£…ç±»ï¼Ÿ" class="headerlink" title="ä¸ºå•¥è¦æœ‰åŒ…è£…ç±»ï¼Ÿ"></a>ä¸ºå•¥è¦æœ‰åŒ…è£…ç±»ï¼Ÿ</h3><p>Javaè¯­è¨€æ˜¯é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œå…¶è®¾è®¡ç†å¿µæ˜¯â€œä¸€åˆ‡çš†å¯¹è±¡â€ã€‚ä½†8ç§åŸºæœ¬æ•°æ®ç±»å‹å´å‡ºç°äº†ä¾‹å¤–ï¼Œå®ƒä»¬ä¸å…·å¤‡å¯¹è±¡çš„ç‰¹æ€§ã€‚æ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJavaä¸ºæ¯ä¸ªåŸºæœ¬æ•°æ®ç±»å‹éƒ½å®šä¹‰äº†ä¸€ä¸ªå¯¹åº”çš„å¼•ç”¨ç±»å‹ï¼Œè¿™å°±æ˜¯åŒ…è£…ç±»ã€‚</p>
<p><strong>æ‰©å±•é˜…è¯»</strong></p>
<p>Javaä¹‹æ‰€ä»¥æä¾›8ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä¸»è¦æ˜¯ä¸ºäº†ç…§é¡¾ç¨‹åºå‘˜çš„ä¼ ç»Ÿä¹ æƒ¯ã€‚è¿™8ç§åŸºæœ¬æ•°æ®ç±»å‹çš„ç¡®å¸¦æ¥äº†ä¸€å®šçš„æ–¹ä¾¿æ€§ï¼Œä½†åœ¨æŸäº›æ—¶å€™ä¹Ÿä¼šå—åˆ°ä¸€äº›åˆ¶çº¦ã€‚æ¯”å¦‚ï¼Œæ‰€æœ‰çš„å¼•ç”¨ç±»å‹çš„å˜é‡éƒ½ç»§æ‰¿äºObjectç±»ï¼Œéƒ½å¯ä»¥å½“åšObjectç±»å‹çš„å˜é‡ä½¿ç”¨ï¼Œä½†åŸºæœ¬æ•°æ®ç±»å‹å´ä¸å¯ä»¥ã€‚å¦‚æœæŸä¸ªæ–¹æ³•éœ€è¦Objectç±»å‹çš„å‚æ•°ï¼Œä½†å®é™…ä¼ å…¥çš„å€¼å´æ˜¯æ•°å­—çš„è¯ï¼Œå°±éœ€è¦åšç‰¹æ®Šçš„å¤„ç†äº†ã€‚æœ‰äº†åŒ…è£…ç±»ï¼Œè¿™ç§é—®é¢˜å°±å¯ä»¥å¾—ä»¥ç®€åŒ–ã€‚</p>
<h3 id="è¯´ä¸€è¯´è‡ªåŠ¨è£…ç®±ã€è‡ªåŠ¨æ‹†ç®±çš„åº”ç”¨åœºæ™¯"><a href="#è¯´ä¸€è¯´è‡ªåŠ¨è£…ç®±ã€è‡ªåŠ¨æ‹†ç®±çš„åº”ç”¨åœºæ™¯" class="headerlink" title="è¯´ä¸€è¯´è‡ªåŠ¨è£…ç®±ã€è‡ªåŠ¨æ‹†ç®±çš„åº”ç”¨åœºæ™¯"></a>è¯´ä¸€è¯´è‡ªåŠ¨è£…ç®±ã€è‡ªåŠ¨æ‹†ç®±çš„åº”ç”¨åœºæ™¯</h3><p>è‡ªåŠ¨è£…ç®±ã€è‡ªåŠ¨æ‹†ç®±æ˜¯JDK1.5æä¾›çš„åŠŸèƒ½ã€‚</p>
<p>è‡ªåŠ¨è£…ç®±ï¼šå¯ä»¥æŠŠä¸€ä¸ªåŸºæœ¬ç±»å‹çš„æ•°æ®ç›´æ¥èµ‹å€¼ç»™å¯¹åº”çš„åŒ…è£…ç±»å‹ï¼›</p>
<p>è‡ªåŠ¨æ‹†ç®±ï¼šå¯ä»¥æŠŠä¸€ä¸ªåŒ…è£…ç±»å‹çš„å¯¹è±¡ç›´æ¥èµ‹å€¼ç»™å¯¹åº”çš„åŸºæœ¬ç±»å‹ï¼›</p>
<p>é€šè¿‡è‡ªåŠ¨è£…ç®±ã€è‡ªåŠ¨æ‹†ç®±åŠŸèƒ½ï¼Œå¯ä»¥å¤§å¤§ç®€åŒ–åŸºæœ¬ç±»å‹å˜é‡å’ŒåŒ…è£…ç±»å¯¹è±¡ä¹‹é—´çš„è½¬æ¢è¿‡ç¨‹ã€‚æ¯”å¦‚ï¼ŒæŸä¸ªæ–¹æ³•çš„å‚æ•°ç±»å‹ä¸ºåŒ…è£…ç±»å‹ï¼Œè°ƒç”¨æ—¶æˆ‘ä»¬æ‰€æŒæœ‰çš„æ•°æ®å´æ˜¯åŸºæœ¬ç±»å‹çš„å€¼ï¼Œåˆ™å¯ä»¥ä¸åšä»»ä½•ç‰¹æ®Šçš„å¤„ç†ï¼Œç›´æ¥å°†è¿™ä¸ªåŸºæœ¬ç±»å‹çš„å€¼ä¼ å…¥ç»™æ–¹æ³•å³å¯ã€‚</p>
<h3 id="å¦‚ä½•å¯¹Integerå’ŒDoubleç±»å‹åˆ¤æ–­ç›¸ç­‰ï¼Ÿ"><a href="#å¦‚ä½•å¯¹Integerå’ŒDoubleç±»å‹åˆ¤æ–­ç›¸ç­‰ï¼Ÿ" class="headerlink" title="å¦‚ä½•å¯¹Integerå’ŒDoubleç±»å‹åˆ¤æ–­ç›¸ç­‰ï¼Ÿ"></a>å¦‚ä½•å¯¹Integerå’ŒDoubleç±»å‹åˆ¤æ–­ç›¸ç­‰ï¼Ÿ</h3><p>Integerã€Doubleä¸èƒ½ç›´æ¥è¿›è¡Œæ¯”è¾ƒï¼Œè¿™åŒ…æ‹¬ï¼š</p>
<ul>
<li>ä¸èƒ½ç”¨==è¿›è¡Œç›´æ¥æ¯”è¾ƒï¼Œå› ä¸ºå®ƒä»¬æ˜¯ä¸åŒçš„æ•°æ®ç±»å‹ï¼›</li>
<li>ä¸èƒ½è½¬ä¸ºå­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒï¼Œå› ä¸ºè½¬ä¸ºå­—ç¬¦ä¸²åï¼Œæµ®ç‚¹å€¼å¸¦å°æ•°ç‚¹ï¼Œæ•´æ•°å€¼ä¸å¸¦ï¼Œè¿™æ ·å®ƒä»¬æ°¸è¿œéƒ½ä¸ç›¸ç­‰ï¼›</li>
<li>ä¸èƒ½ä½¿ç”¨compareToæ–¹æ³•è¿›è¡Œæ¯”è¾ƒï¼Œè™½ç„¶å®ƒä»¬éƒ½æœ‰compareToæ–¹æ³•ï¼Œä½†è¯¥æ–¹æ³•åªèƒ½å¯¹ç›¸åŒç±»å‹è¿›è¡Œæ¯”è¾ƒã€‚</li>
</ul>
<p>æ•´æ•°ã€æµ®ç‚¹ç±»å‹çš„åŒ…è£…ç±»ï¼Œéƒ½ç»§æ‰¿äºNumberç±»å‹ï¼Œè€ŒNumberç±»å‹åˆ†åˆ«å®šä¹‰äº†å°†æ•°å­—è½¬æ¢ä¸ºbyteã€shortã€intã€longã€floatã€doubleçš„æ–¹æ³•ã€‚æ‰€ä»¥ï¼Œå¯ä»¥å°†Integerã€Doubleå…ˆè½¬ä¸ºè½¬æ¢ä¸ºç›¸åŒçš„åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå¦‚doubleï¼‰ï¼Œç„¶åä½¿ç”¨==è¿›è¡Œæ¯”è¾ƒã€‚</p>
<p><strong>ç¤ºä¾‹ä»£ç </strong></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"><span class="type">Double</span> <span class="variable">d</span> <span class="operator">=</span> <span class="number">100.00</span>;</span><br><span class="line">System.out.println(i.doubleValue() == d.doubleValue());</span><br></pre></td></tr></tbody></table></figure>

</body></html>]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaåŸºç¡€(äºŒ)</title>
    <url>/p/ba031852.html</url>
    <content><![CDATA[<html><head></head><body><h3 id="intå’ŒIntegeræœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŒäºŒè€…åœ¨åš-è¿ç®—æ—¶ä¼šå¾—åˆ°ä»€ä¹ˆç»“æœï¼Ÿ"><a href="#intå’ŒIntegeræœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŒäºŒè€…åœ¨åš-è¿ç®—æ—¶ä¼šå¾—åˆ°ä»€ä¹ˆç»“æœï¼Ÿ" class="headerlink" title="intå’ŒIntegeræœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŒäºŒè€…åœ¨åš==è¿ç®—æ—¶ä¼šå¾—åˆ°ä»€ä¹ˆç»“æœï¼Ÿ"></a>intå’ŒIntegeræœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŒäºŒè€…åœ¨åš==è¿ç®—æ—¶ä¼šå¾—åˆ°ä»€ä¹ˆç»“æœï¼Ÿ</h3><p>intæ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼ŒIntegeræ˜¯intçš„åŒ…è£…ç±»ã€‚äºŒè€…åœ¨åš==è¿ç®—æ—¶ï¼ŒIntegerä¼šè‡ªåŠ¨æ‹†ç®±ä¸ºintç±»å‹ï¼Œç„¶åå†è¿›è¡Œæ¯”è¾ƒã€‚å±Šæ—¶ï¼Œå¦‚æœä¸¤ä¸ªintå€¼ç›¸ç­‰åˆ™è¿”å›trueï¼Œå¦åˆ™å°±è¿”å›falseã€‚</p>
<h3 id="è¯´ä¸€è¯´ä½ å¯¹é¢å‘å¯¹è±¡çš„ç†è§£"><a href="#è¯´ä¸€è¯´ä½ å¯¹é¢å‘å¯¹è±¡çš„ç†è§£" class="headerlink" title="è¯´ä¸€è¯´ä½ å¯¹é¢å‘å¯¹è±¡çš„ç†è§£"></a>è¯´ä¸€è¯´ä½ å¯¹é¢å‘å¯¹è±¡çš„ç†è§£</h3><p>é¢å‘å¯¹è±¡æ˜¯ä¸€ç§æ›´ä¼˜ç§€çš„ç¨‹åºè®¾è®¡æ–¹æ³•ï¼Œå®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯ä½¿ç”¨ç±»ã€å¯¹è±¡ã€ç»§æ‰¿ã€å°è£…ã€æ¶ˆæ¯ç­‰åŸºæœ¬æ¦‚å¿µè¿›è¡Œç¨‹åºè®¾è®¡ã€‚å®ƒä»ç°å®ä¸–ç•Œä¸­å®¢è§‚å­˜åœ¨çš„äº‹ç‰©å‡ºå‘æ¥æ„é€ è½¯ä»¶ç³»ç»Ÿï¼Œå¹¶åœ¨ç³»ç»Ÿæ„é€ ä¸­å°½å¯èƒ½è¿ç”¨äººç±»çš„è‡ªç„¶æ€ç»´æ–¹å¼ï¼Œå¼ºè°ƒç›´æ¥ä»¥ç°å®ä¸–ç•Œä¸­çš„äº‹ç‰©ä¸ºä¸­å¿ƒæ¥æ€è€ƒï¼Œè®¤è¯†é—®é¢˜ï¼Œå¹¶æ ¹æ®è¿™äº›äº‹ç‰©çš„æœ¬è´¨ç‰¹ç‚¹ï¼ŒæŠŠå®ƒä»¬æŠ½è±¡åœ°è¡¨ç¤ºä¸ºç³»ç»Ÿä¸­çš„ç±»ï¼Œä½œä¸ºç³»ç»Ÿçš„åŸºæœ¬æ„æˆå•å…ƒï¼Œè¿™ä½¿å¾—è½¯ä»¶ç³»ç»Ÿçš„ç»„ä»¶å¯ä»¥ç›´æ¥æ˜ åƒåˆ°å®¢è§‚ä¸–ç•Œï¼Œå¹¶ä¿æŒå®¢è§‚ä¸–ç•Œä¸­äº‹ç‰©åŠå…¶ç›¸äº’å…³ç³»çš„æœ¬æ¥é¢è²Œã€‚</p>
<p><strong>æ‰©å±•é˜…è¯»</strong></p>
<p>ç»“æ„åŒ–ç¨‹åºè®¾è®¡æ–¹æ³•ä¸»å¼ æŒ‰åŠŸèƒ½æ¥åˆ†æç³»ç»Ÿéœ€æ±‚ï¼Œå…¶ä¸»è¦åŸåˆ™å¯æ¦‚æ‹¬ä¸ºè‡ªé¡¶å‘ä¸‹ã€é€æ­¥æ±‚ç²¾ã€æ¨¡å—åŒ–ç­‰ã€‚ç»“æ„åŒ–ç¨‹åºè®¾è®¡é¦–å…ˆé‡‡ç”¨ç»“æ„åŒ–åˆ†ææ–¹æ³•å¯¹ç³»ç»Ÿè¿›è¡Œéœ€æ±‚åˆ†æï¼Œç„¶åä½¿ç”¨ç»“æ„åŒ–è®¾è®¡æ–¹æ³•å¯¹ç³»ç»Ÿè¿›è¡Œæ¦‚è¦è®¾è®¡ã€è¯¦ç»†è®¾è®¡ï¼Œæœ€åé‡‡ç”¨ç»“æ„åŒ–ç¼–ç¨‹æ–¹æ³•æ¥å®ç°ç³»ç»Ÿã€‚</p>
<p>å› ä¸ºç»“æ„åŒ–ç¨‹åºè®¾è®¡æ–¹æ³•ä¸»å¼ æŒ‰åŠŸèƒ½æŠŠè½¯ä»¶ç³»ç»Ÿé€æ­¥ç»†åˆ†ï¼Œå› æ­¤è¿™ç§æ–¹æ³•ä¹Ÿè¢«ç§°ä¸ºé¢å‘åŠŸèƒ½çš„ç¨‹åºè®¾è®¡æ–¹æ³•ï¼›ç»“æ„åŒ–ç¨‹åºè®¾è®¡çš„æ¯ä¸ªåŠŸèƒ½éƒ½è´Ÿè´£å¯¹æ•°æ®è¿›è¡Œä¸€æ¬¡å¤„ç†ï¼Œæ¯ä¸ªåŠŸèƒ½éƒ½æ¥å—ä¸€äº›æ•°æ®ï¼Œå¤„ç†å®Œåè¾“å‡ºä¸€äº›æ•°æ®ï¼Œè¿™ç§å¤„ç†æ–¹å¼ä¹Ÿè¢«ç§°ä¸ºé¢å‘æ•°æ®æµçš„å¤„ç†æ–¹å¼ã€‚</p>
<p>ç»“æ„åŒ–ç¨‹åºè®¾è®¡é‡Œæœ€å°çš„ç¨‹åºå•å…ƒæ˜¯å‡½æ•°ï¼Œæ¯ä¸ªå‡½æ•°éƒ½è´Ÿè´£å®Œæˆä¸€ä¸ªåŠŸèƒ½ï¼Œç”¨ä»¥æ¥æ”¶ä¸€äº›è¾“å…¥æ•°æ®ï¼Œå‡½æ•°å¯¹è¿™äº›è¾“å…¥æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå¤„ç†ç»“æŸåè¾“å‡ºä¸€äº›æ•°æ®ã€‚æ•´ä¸ªè½¯ä»¶ç³»ç»Ÿç”±ä¸€ä¸ªä¸ªå‡½æ•°ç»„æˆï¼Œå…¶ä¸­ä½œä¸ºç¨‹åºå…¥å£çš„å‡½æ•°è¢«ç§°ä¸ºä¸»å‡½æ•°ï¼Œä¸»å‡½æ•°ä¾æ¬¡è°ƒç”¨å…¶ä»–æ™®é€šå‡½æ•°ï¼Œæ™®é€šå‡½æ•°ä¹‹é—´ä¾æ¬¡è°ƒç”¨ï¼Œä»è€Œå®Œæˆæ•´ä¸ªè½¯ä»¶ç³»ç»Ÿçš„åŠŸèƒ½ã€‚</p>
<p>æ¯ä¸ªå‡½æ•°éƒ½æ˜¯å…·æœ‰è¾“å…¥ã€è¾“å‡ºçš„å­ç³»ç»Ÿï¼Œå‡½æ•°çš„è¾“å…¥æ•°æ®åŒ…æ‹¬å‡½æ•°å½¢å‚ã€å…¨å±€å˜é‡å’Œå¸¸é‡ç­‰ï¼Œå‡½æ•°çš„è¾“å‡ºæ•°æ®åŒ…æ‹¬å‡½æ•°è¿”å›å€¼ä»¥åŠä¼ å‡ºå‚æ•°ç­‰ã€‚ç»“æ„åŒ–ç¨‹åºè®¾è®¡æ–¹å¼æœ‰å¦‚ä¸‹ä¸¤ä¸ªå±€é™æ€§ï¼š</p>
<ul>
<li>è®¾è®¡ä¸å¤Ÿç›´è§‚ï¼Œä¸äººç±»ä¹ æƒ¯æ€ç»´ä¸ä¸€è‡´ã€‚é‡‡ç”¨ç»“æ„åŒ–ç¨‹åºåˆ†æã€è®¾è®¡æ—¶ï¼Œå¼€å‘è€…éœ€è¦å°†å®¢è§‚ä¸–ç•Œæ¨¡å‹åˆ†è§£æˆä¸€ä¸ªä¸ªåŠŸèƒ½ï¼Œæ¯ä¸ªåŠŸèƒ½ç”¨ä»¥å®Œæˆä¸€å®šçš„æ•°æ®å¤„ç†ã€‚</li>
<li>é€‚åº”æ€§å·®ï¼Œå¯æ‰©å±•æ€§ä¸å¼ºã€‚ç”±äºç»“æ„åŒ–è®¾è®¡é‡‡ç”¨è‡ªé¡¶å‘ä¸‹çš„è®¾è®¡æ–¹å¼ï¼Œæ‰€ä»¥å½“ç”¨æˆ·çš„éœ€æ±‚å‘ç”Ÿæ”¹å˜ï¼Œæˆ–éœ€è¦ä¿®æ”¹ç°æœ‰çš„å®ç°æ–¹å¼æ—¶ï¼Œéƒ½éœ€è¦è‡ªé¡¶å‘ä¸‹åœ°ä¿®æ”¹æ¨¡å—ç»“æ„ï¼Œè¿™ç§æ–¹å¼çš„ç»´æŠ¤æˆæœ¬ç›¸å½“é«˜ã€‚</li>
</ul>
<h3 id="é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾æ˜¯ä»€ä¹ˆï¼Ÿ"></a>é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>é¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡æ–¹æ³•å…·æœ‰ä¸‰ä¸ªåŸºæœ¬ç‰¹å¾ï¼šå°è£…ã€ç»§æ‰¿ã€å¤šæ€ã€‚å…¶ä¸­ï¼Œå°è£…æŒ‡çš„æ˜¯å°†å¯¹è±¡çš„å®ç°ç»†èŠ‚éšè—èµ·æ¥ï¼Œç„¶åé€šè¿‡ä¸€äº›å…¬ç”¨æ–¹æ³•æ¥æš´éœ²è¯¥å¯¹è±¡çš„åŠŸèƒ½ï¼›ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡å®ç°è½¯ä»¶å¤ç”¨çš„é‡è¦æ‰‹æ®µï¼Œå½“å­ç±»ç»§æ‰¿çˆ¶ç±»åï¼Œå­ç±»ä½œä¸ºä¸€ç§ç‰¹æ®Šçš„çˆ¶ç±»ï¼Œå°†ç›´æ¥è·å¾—çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼›å¤šæ€æŒ‡çš„æ˜¯å­ç±»å¯¹è±¡å¯ä»¥ç›´æ¥èµ‹ç»™çˆ¶ç±»å˜é‡ï¼Œä½†è¿è¡Œæ—¶ä¾ç„¶è¡¨ç°å‡ºå­ç±»çš„è¡Œä¸ºç‰¹å¾ï¼Œè¿™æ„å‘³ç€åŒä¸€ä¸ªç±»å‹çš„å¯¹è±¡åœ¨æ‰§è¡ŒåŒä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå¯èƒ½è¡¨ç°å‡ºå¤šç§è¡Œä¸ºç‰¹å¾ã€‚</p>
<p><strong>æ‰©å±•é˜…è¯»</strong></p>
<p>æŠ½è±¡ä¹Ÿæ˜¯é¢å‘å¯¹è±¡çš„é‡è¦éƒ¨åˆ†ï¼ŒæŠ½è±¡å°±æ˜¯å¿½ç•¥ä¸€ä¸ªä¸»é¢˜ä¸­ä¸å½“å‰ç›®æ ‡æ— å…³çš„é‚£äº›æ–¹é¢ï¼Œä»¥ä¾¿æ›´å……åˆ†åœ°æ³¨æ„ä¸å½“å‰ç›®æ ‡æœ‰å…³çš„æ–¹é¢ã€‚æŠ½è±¡å¹¶ä¸æ‰“ç®—äº†è§£å…¨éƒ¨é—®é¢˜ï¼Œè€Œåªæ˜¯è€ƒè™‘éƒ¨åˆ†é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œéœ€è¦è€ƒå¯ŸPersonå¯¹è±¡æ—¶ï¼Œä¸å¯èƒ½åœ¨ç¨‹åºä¸­æŠŠPersonçš„æ‰€æœ‰ç»†èŠ‚éƒ½å®šä¹‰å‡ºæ¥ï¼Œé€šå¸¸åªèƒ½å®šä¹‰Personçš„éƒ¨åˆ†æ•°æ®ã€éƒ¨åˆ†è¡Œä¸ºç‰¹å¾ï¼Œè€Œè¿™äº›æ•°æ®ã€è¡Œä¸ºç‰¹å¾æ˜¯è½¯ä»¶ç³»ç»Ÿæ‰€å…³å¿ƒçš„éƒ¨åˆ†ã€‚</p>
<h3 id="å°è£…çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦æœ‰å°è£…ï¼Ÿ"><a href="#å°è£…çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦æœ‰å°è£…ï¼Ÿ" class="headerlink" title="å°è£…çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦æœ‰å°è£…ï¼Ÿ"></a>å°è£…çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦æœ‰å°è£…ï¼Ÿ</h3><p>å°è£…æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€å¯¹å®¢è§‚ä¸–ç•Œçš„æ¨¡æ‹Ÿï¼Œåœ¨å®¢è§‚ä¸–ç•Œé‡Œï¼Œå¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯éƒ½è¢«éšè—åœ¨å¯¹è±¡å†…éƒ¨ï¼Œå¤–ç•Œæ— æ³•ç›´æ¥æ“ä½œå’Œä¿®æ”¹ã€‚å¯¹ä¸€ä¸ªç±»æˆ–å¯¹è±¡å®ç°è‰¯å¥½çš„å°è£…ï¼Œå¯ä»¥å®ç°ä»¥ä¸‹ç›®çš„ï¼š</p>
<ul>
<li>éšè—ç±»çš„å®ç°ç»†èŠ‚ï¼›</li>
<li>è®©ä½¿ç”¨è€…åªèƒ½é€šè¿‡äº‹å…ˆé¢„å®šçš„æ–¹æ³•æ¥è®¿é—®æ•°æ®ï¼Œä»è€Œå¯ä»¥åœ¨è¯¥æ–¹æ³•é‡ŒåŠ å…¥æ§åˆ¶é€»è¾‘ï¼Œé™åˆ¶å¯¹æˆå‘˜å˜é‡çš„ä¸åˆç†è®¿é—®ï¼›</li>
<li>å¯è¿›è¡Œæ•°æ®æ£€æŸ¥ï¼Œä»è€Œæœ‰åˆ©äºä¿è¯å¯¹è±¡ä¿¡æ¯çš„å®Œæ•´æ€§ï¼›</li>
<li>ä¾¿äºä¿®æ”¹ï¼Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚</li>
</ul>
<p><strong>æ‰©å±•é˜…è¯»</strong></p>
<p>ä¸ºäº†å®ç°è‰¯å¥½çš„å°è£…ï¼Œéœ€è¦ä»ä¸¤ä¸ªæ–¹é¢è€ƒè™‘ï¼š</p>
<ul>
<li>å°†å¯¹è±¡çš„æˆå‘˜å˜é‡å’Œå®ç°ç»†èŠ‚éšè—èµ·æ¥ï¼Œä¸å…è®¸å¤–éƒ¨ç›´æ¥è®¿é—®ï¼›</li>
<li>æŠŠæ–¹æ³•æš´éœ²å‡ºæ¥ï¼Œè®©æ–¹æ³•æ¥æ§åˆ¶å¯¹è¿™äº›æˆå‘˜å˜é‡è¿›è¡Œå®‰å…¨çš„è®¿é—®å’Œæ“ä½œã€‚</li>
</ul>
<p>å°è£…å®é™…ä¸Šæœ‰ä¸¤ä¸ªæ–¹é¢çš„å«ä¹‰ï¼šæŠŠè¯¥éšè—çš„éšè—èµ·æ¥ï¼ŒæŠŠè¯¥æš´éœ²çš„æš´éœ²å‡ºæ¥ã€‚è¿™ä¸¤ä¸ªæ–¹é¢éƒ½éœ€è¦é€šè¿‡ä½¿ç”¨Javaæä¾›çš„è®¿é—®æ§åˆ¶ç¬¦æ¥å®ç°ã€‚</p>
<h3 id="è¯´ä¸€è¯´ä½ å¯¹å¤šæ€çš„ç†è§£"><a href="#è¯´ä¸€è¯´ä½ å¯¹å¤šæ€çš„ç†è§£" class="headerlink" title="è¯´ä¸€è¯´ä½ å¯¹å¤šæ€çš„ç†è§£"></a>è¯´ä¸€è¯´ä½ å¯¹å¤šæ€çš„ç†è§£</h3><p>å› ä¸ºå­ç±»å…¶å®æ˜¯ä¸€ç§ç‰¹æ®Šçš„çˆ¶ç±»ï¼Œå› æ­¤Javaå…è®¸æŠŠä¸€ä¸ªå­ç±»å¯¹è±¡ç›´æ¥èµ‹ç»™ä¸€ä¸ªçˆ¶ç±»å¼•ç”¨å˜é‡ï¼Œæ— é¡»ä»»ä½•ç±»å‹è½¬æ¢ï¼Œæˆ–è€…è¢«ç§°ä¸ºå‘ä¸Šè½¬å‹ï¼Œå‘ä¸Šè½¬å‹ç”±ç³»ç»Ÿè‡ªåŠ¨å®Œæˆã€‚</p>
<p>å½“æŠŠä¸€ä¸ªå­ç±»å¯¹è±¡ç›´æ¥èµ‹ç»™çˆ¶ç±»å¼•ç”¨å˜é‡æ—¶ï¼Œä¾‹å¦‚ BaseClass obj = new SubClass();ï¼Œè¿™ä¸ªobjå¼•ç”¨å˜é‡çš„ç¼–è¯‘æ—¶ç±»å‹æ˜¯BaseClassï¼Œè€Œè¿è¡Œæ—¶ç±»å‹æ˜¯SubClassï¼Œå½“è¿è¡Œæ—¶è°ƒç”¨è¯¥å¼•ç”¨å˜é‡çš„æ–¹æ³•æ—¶ï¼Œå…¶æ–¹æ³•è¡Œä¸ºæ€»æ˜¯è¡¨ç°å‡ºå­ç±»æ–¹æ³•çš„è¡Œä¸ºç‰¹å¾ï¼Œè€Œä¸æ˜¯çˆ¶ç±»æ–¹æ³•çš„è¡Œä¸ºç‰¹å¾ï¼Œè¿™å°±å¯èƒ½å‡ºç°ï¼šç›¸åŒç±»å‹çš„å˜é‡ã€è°ƒç”¨åŒä¸€ä¸ªæ–¹æ³•æ—¶å‘ˆç°å‡ºå¤šç§ä¸åŒçš„è¡Œä¸ºç‰¹å¾ï¼Œè¿™å°±æ˜¯å¤šæ€ã€‚</p>
<p><strong>æ‰©å±•é˜…è¯»</strong></p>
<p>å¤šæ€å¯ä»¥æé«˜ç¨‹åºçš„å¯æ‰©å±•æ€§ï¼Œåœ¨è®¾è®¡ç¨‹åºæ—¶è®©ä»£ç æ›´åŠ ç®€æ´è€Œä¼˜é›…ã€‚</p>
<p>ä¾‹å¦‚æˆ‘è¦è®¾è®¡ä¸€ä¸ªå¸æœºç±»ï¼Œä»–å¯ä»¥å¼€è½¿è½¦ã€å·´å£«ã€å¡è½¦ç­‰ç­‰ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Driver</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">drive</span><span class="params">(Car car)</span> { ... }</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">drive</span><span class="params">(Bus bus)</span> { ... }</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">drive</span><span class="params">(Truck truck)</span> { ... }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨è®¾è®¡ä¸Šè¿°ä»£ç æ—¶ï¼Œæˆ‘å·²é‡‡ç”¨äº†é‡è½½æœºåˆ¶ï¼Œå°†æ–¹æ³•åè¿›è¡Œäº†ç»Ÿä¸€ã€‚è¿™æ ·åœ¨è¿›è¡Œè°ƒç”¨æ—¶ï¼Œæ— è®ºè¦å¼€ä»€ä¹ˆäº¤é€šå·¥å…·ï¼Œéƒ½æ˜¯é€šè¿‡driver.drive(obj)è¿™æ ·çš„æ–¹å¼æ¥è°ƒç”¨ï¼Œå¯¹è°ƒç”¨è€…è¶³å¤Ÿçš„å‹å¥½ã€‚</p>
<p>ä½†å¯¹äºç¨‹åºçš„å¼€å‘è€…æ¥è¯´ï¼Œè¿™æ˜¾å¾—ç¹çï¼Œå› ä¸ºå®é™…ä¸Šè¿™ä¸ªå¸æœºå¯ä»¥é©¾é©¶æ›´å¤šçš„äº¤é€šå·¥å…·ã€‚å½“ç³»ç»Ÿéœ€è¦ä¸ºè¿™ä¸ªå¸æœºå¢åŠ è½¦å‹æ—¶ï¼Œå¼€å‘è€…å°±éœ€è¦ç›¸åº”çš„å¢åŠ driveræ–¹æ³•ï¼Œç±»ä¼¼çš„ä»£ç ä¼šå †ç§¯çš„è¶Šæ¥è¶Šå¤šï¼Œæ˜¾å¾—è‡ƒè‚¿ã€‚</p>
<p>é‡‡ç”¨å¤šæ€çš„æ–¹å¼æ¥è®¾è®¡ä¸Šè¿°ç¨‹åºï¼Œå°±ä¼šå˜å¾—ç®€æ´å¾ˆå¤šã€‚æˆ‘ä»¬å¯ä»¥ä¸ºæ‰€æœ‰çš„äº¤é€šå·¥å…·å®šä¹‰ä¸€ä¸ªçˆ¶ç±»Vehicleï¼Œç„¶åæŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼è®¾è®¡driveæ–¹æ³•ã€‚è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥Vehicleç±»å‹çš„å®ä¾‹ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥ä»»æ„çš„Vehicleå­ç±»å‹çš„å®ä¾‹ï¼Œå¯¹äºè°ƒç”¨è€…æ¥è¯´ä¸€æ ·çš„æ–¹ä¾¿ï¼Œä½†å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œä»£ç å´å˜å¾—ååˆ†çš„ç®€æ´äº†ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Driver</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">drive</span><span class="params">(Vehicle vehicle)</span> { ... }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Javaä¸­çš„å¤šæ€æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#Javaä¸­çš„å¤šæ€æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="Javaä¸­çš„å¤šæ€æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"></a>Javaä¸­çš„å¤šæ€æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</h3><p>å¤šæ€çš„å®ç°ç¦»ä¸å¼€ç»§æ‰¿ï¼Œåœ¨è®¾è®¡ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å‚æ•°çš„ç±»å‹å®šä¹‰ä¸ºçˆ¶ç±»å‹ã€‚åœ¨è°ƒç”¨ç¨‹åºæ—¶ï¼Œåˆ™å¯ä»¥æ ¹æ®å®é™…æƒ…å†µï¼Œä¼ å…¥è¯¥çˆ¶ç±»å‹çš„æŸä¸ªå­ç±»å‹çš„å®ä¾‹ï¼Œè¿™æ ·å°±å®ç°äº†å¤šæ€ã€‚å¯¹äºçˆ¶ç±»å‹ï¼Œå¯ä»¥æœ‰ä¸‰ç§å½¢å¼ï¼Œå³æ™®é€šçš„ç±»ã€æŠ½è±¡ç±»ã€æ¥å£ã€‚å¯¹äºå­ç±»å‹ï¼Œåˆ™è¦æ ¹æ®å®ƒè‡ªèº«çš„ç‰¹å¾ï¼Œé‡å†™çˆ¶ç±»çš„æŸäº›æ–¹æ³•ï¼Œæˆ–å®ç°æŠ½è±¡ç±»/æ¥å£çš„æŸäº›æŠ½è±¡æ–¹æ³•ã€‚</p>
<h3 id="Javaä¸ºä»€ä¹ˆæ˜¯å•ç»§æ‰¿ï¼Œä¸ºä»€ä¹ˆä¸èƒ½å¤šç»§æ‰¿ï¼Ÿ"><a href="#Javaä¸ºä»€ä¹ˆæ˜¯å•ç»§æ‰¿ï¼Œä¸ºä»€ä¹ˆä¸èƒ½å¤šç»§æ‰¿ï¼Ÿ" class="headerlink" title="Javaä¸ºä»€ä¹ˆæ˜¯å•ç»§æ‰¿ï¼Œä¸ºä»€ä¹ˆä¸èƒ½å¤šç»§æ‰¿ï¼Ÿ"></a>Javaä¸ºä»€ä¹ˆæ˜¯å•ç»§æ‰¿ï¼Œä¸ºä»€ä¹ˆä¸èƒ½å¤šç»§æ‰¿ï¼Ÿ</h3><p>é¦–å…ˆï¼ŒJavaæ˜¯å•ç»§æ‰¿çš„ï¼ŒæŒ‡çš„æ˜¯Javaä¸­ä¸€ä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªç›´æ¥çš„çˆ¶ç±»ã€‚Javaä¸èƒ½å¤šç»§æ‰¿ï¼Œåˆ™æ˜¯è¯´Javaä¸­ä¸€ä¸ªç±»ä¸èƒ½ç›´æ¥ç»§æ‰¿å¤šä¸ªçˆ¶ç±»ã€‚</p>
<p>å…¶æ¬¡ï¼ŒJavaåœ¨è®¾è®¡æ—¶å€Ÿé‰´äº†C++çš„è¯­æ³•ï¼Œè€ŒC++æ˜¯æ”¯æŒå¤šç»§æ‰¿çš„ã€‚Javaè¯­è¨€ä¹‹æ‰€ä»¥æ‘’å¼ƒäº†å¤šç»§æ‰¿çš„è¿™é¡¹ç‰¹å¾ï¼Œæ˜¯å› ä¸ºå¤šç»§æ‰¿å®¹æ˜“äº§ç”Ÿæ··æ·†ã€‚æ¯”å¦‚ï¼Œä¸¤ä¸ªçˆ¶ç±»ä¸­åŒ…å«ç›¸åŒçš„æ–¹æ³•æ—¶ï¼Œå­ç±»åœ¨è°ƒç”¨è¯¥æ–¹æ³•æˆ–é‡å†™è¯¥æ–¹æ³•æ—¶å°±ä¼šè¿·æƒ‘ã€‚</p>
<p>å‡†ç¡®æ¥è¯´ï¼ŒJavaæ˜¯å¯ä»¥å®ç°â€å¤šç»§æ‰¿â€çš„ã€‚å› ä¸ºå°½ç®¡ä¸€ä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªç›´æ¥çˆ¶ç±»ï¼Œä½†æ˜¯å´å¯ä»¥æœ‰ä»»æ„å¤šä¸ªé—´æ¥çš„çˆ¶ç±»ã€‚è¿™æ ·çš„è®¾è®¡æ–¹å¼ï¼Œé¿å…äº†å¤šç»§æ‰¿æ—¶æ‰€äº§ç”Ÿçš„æ··æ·†ã€‚</p>
<h3 id="è¯´ä¸€è¯´é‡å†™ä¸é‡è½½çš„åŒºåˆ«"><a href="#è¯´ä¸€è¯´é‡å†™ä¸é‡è½½çš„åŒºåˆ«" class="headerlink" title="è¯´ä¸€è¯´é‡å†™ä¸é‡è½½çš„åŒºåˆ«"></a>è¯´ä¸€è¯´é‡å†™ä¸é‡è½½çš„åŒºåˆ«</h3><p>é‡è½½å‘ç”Ÿåœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œè‹¥å¤šä¸ªæ–¹æ³•ä¹‹é—´æ–¹æ³•åç›¸åŒã€å‚æ•°åˆ—è¡¨ä¸åŒï¼Œåˆ™å®ƒä»¬æ„æˆé‡è½½çš„å…³ç³»ã€‚é‡è½½ä¸æ–¹æ³•çš„è¿”å›å€¼ä»¥åŠè®¿é—®ä¿®é¥°ç¬¦æ— å…³ï¼Œå³é‡è½½çš„æ–¹æ³•ä¸èƒ½æ ¹æ®è¿”å›ç±»å‹è¿›è¡ŒåŒºåˆ†ã€‚</p>
<p>é‡å†™</p>
<p>å‘ç”Ÿåœ¨çˆ¶ç±»å­ç±»ä¸­ï¼Œè‹¥å­ç±»æ–¹æ³•æƒ³è¦å’Œçˆ¶ç±»æ–¹æ³•æ„æˆé‡å†™å…³ç³»ï¼Œåˆ™å®ƒçš„æ–¹æ³•åã€å‚æ•°åˆ—è¡¨å¿…é¡»ä¸çˆ¶ç±»æ–¹æ³•ç›¸åŒã€‚å¦å¤–ï¼Œè¿”å›å€¼è¦å°äºç­‰äºçˆ¶ç±»æ–¹æ³•ï¼ŒæŠ›å‡ºçš„å¼‚å¸¸è¦å°äºç­‰äºçˆ¶ç±»æ–¹æ³•ï¼Œè®¿é—®ä¿®é¥°ç¬¦åˆ™è¦å¤§äºç­‰äºçˆ¶ç±»æ–¹æ³•ã€‚è¿˜æœ‰ï¼Œè‹¥çˆ¶ç±»æ–¹æ³•çš„è®¿é—®ä¿®é¥°ç¬¦ä¸ºprivateï¼Œåˆ™å­ç±»ä¸èƒ½å¯¹å…¶é‡å†™ã€‚</p>
<h3 id="æ„é€ æ–¹æ³•èƒ½ä¸èƒ½é‡å†™ï¼Ÿ"><a href="#æ„é€ æ–¹æ³•èƒ½ä¸èƒ½é‡å†™ï¼Ÿ" class="headerlink" title="æ„é€ æ–¹æ³•èƒ½ä¸èƒ½é‡å†™ï¼Ÿ"></a>æ„é€ æ–¹æ³•èƒ½ä¸èƒ½é‡å†™ï¼Ÿ</h3><p>æ„é€ æ–¹æ³•ä¸èƒ½é‡å†™ã€‚å› ä¸ºæ„é€ æ–¹æ³•éœ€è¦å’Œç±»ä¿æŒåŒåï¼Œè€Œé‡å†™çš„è¦æ±‚æ˜¯å­ç±»æ–¹æ³•è¦å’Œçˆ¶ç±»æ–¹æ³•ä¿æŒåŒåã€‚å¦‚æœå…è®¸é‡å†™æ„é€ æ–¹æ³•çš„è¯ï¼Œé‚£ä¹ˆå­ç±»ä¸­å°†ä¼šå­˜åœ¨ä¸ç±»åä¸åŒçš„æ„é€ æ–¹æ³•ï¼Œè¿™ä¸æ„é€ æ–¹æ³•çš„è¦æ±‚æ˜¯çŸ›ç›¾çš„ã€‚</p>
<h3 id="ä»‹ç»ä¸€ä¸‹Objectç±»ä¸­çš„æ–¹æ³•"><a href="#ä»‹ç»ä¸€ä¸‹Objectç±»ä¸­çš„æ–¹æ³•" class="headerlink" title="ä»‹ç»ä¸€ä¸‹Objectç±»ä¸­çš„æ–¹æ³•"></a>ä»‹ç»ä¸€ä¸‹Objectç±»ä¸­çš„æ–¹æ³•</h3><p>Objectç±»æä¾›äº†å¦‚ä¸‹å‡ ä¸ªå¸¸ç”¨æ–¹æ³•ï¼š</p>
<ul>
<li>Class&lt;?&gt; getClass()ï¼šè¿”å›è¯¥å¯¹è±¡çš„è¿è¡Œæ—¶ç±»ã€‚</li>
<li>boolean equals(Object obj)ï¼šåˆ¤æ–­æŒ‡å®šå¯¹è±¡ä¸è¯¥å¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚</li>
<li>int hashCode()ï¼šè¿”å›è¯¥å¯¹è±¡çš„hashCodeå€¼ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒObjectç±»çš„hashCode()æ–¹æ³•æ ¹æ®è¯¥å¯¹è±¡çš„åœ°å€æ¥è®¡ç®—ã€‚ä½†å¾ˆå¤šç±»éƒ½é‡å†™äº†Objectç±»çš„hashCode()æ–¹æ³•ï¼Œä¸å†æ ¹æ®åœ°å€æ¥è®¡ç®—å…¶hashCode()æ–¹æ³•å€¼ã€‚</li>
<li>String toString()ï¼šè¿”å›è¯¥å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå½“ç¨‹åºä½¿ç”¨System.out.println()æ–¹æ³•è¾“å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œæˆ–è€…æŠŠæŸä¸ªå¯¹è±¡å’Œå­—ç¬¦ä¸²è¿›è¡Œè¿æ¥è¿ç®—æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨è¯¥å¯¹è±¡çš„toString()æ–¹æ³•è¿”å›è¯¥å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚Objectç±»çš„toString()æ–¹æ³•è¿”å› è¿è¡Œæ—¶ç±»å@åå…­è¿›åˆ¶hashCodeå€¼ æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä½†å¾ˆå¤šç±»éƒ½é‡å†™äº†Objectç±»çš„toString()æ–¹æ³•ï¼Œç”¨äºè¿”å›å¯ä»¥è¡¨è¿°è¯¥å¯¹è±¡ä¿¡æ¯çš„å­—ç¬¦ä¸²ã€‚</li>
</ul>
<p>å¦å¤–ï¼ŒObjectç±»è¿˜æä¾›äº†wait()ã€notify()ã€notifyAll()è¿™å‡ ä¸ªæ–¹æ³•ï¼Œé€šè¿‡è¿™å‡ ä¸ªæ–¹æ³•å¯ä»¥æ§åˆ¶çº¿ç¨‹çš„æš‚åœå’Œè¿è¡Œã€‚Objectç±»è¿˜æä¾›äº†ä¸€ä¸ªclone()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºå¸®åŠ©å…¶ä»–å¯¹è±¡æ¥å®ç°â€œè‡ªæˆ‘å…‹éš†â€ï¼Œæ‰€è°“â€œè‡ªæˆ‘å…‹éš†â€å°±æ˜¯å¾—åˆ°ä¸€ä¸ªå½“å‰å¯¹è±¡çš„å‰¯æœ¬ï¼Œè€Œä¸”äºŒè€…ä¹‹é—´å®Œå…¨éš”ç¦»ã€‚ç”±äºè¯¥æ–¹æ³•ä½¿ç”¨äº†protectedä¿®é¥°ï¼Œå› æ­¤å®ƒåªèƒ½è¢«å­ç±»é‡å†™æˆ–è°ƒç”¨ã€‚</p>
<p><strong>æ‰©å±•é˜…è¯»</strong></p>
<p>Objectç±»è¿˜æä¾›äº†ä¸€ä¸ªfinalize()æ–¹æ³•ï¼Œå½“ç³»ç»Ÿä¸­æ²¡æœ‰å¼•ç”¨å˜é‡å¼•ç”¨åˆ°è¯¥å¯¹è±¡æ—¶ï¼Œåƒåœ¾å›æ”¶å™¨è°ƒç”¨æ­¤æ–¹æ³•æ¥æ¸…ç†è¯¥å¯¹è±¡çš„èµ„æºã€‚å¹¶ä¸”ï¼Œé’ˆå¯¹æŸä¸€ä¸ªå¯¹è±¡ï¼Œåƒåœ¾å›æ”¶å™¨æœ€å¤šåªä¼šè°ƒç”¨å®ƒçš„finalize()æ–¹æ³•ä¸€æ¬¡ã€‚</p>
<p>æ³¨æ„ï¼Œfinalize()æ–¹æ³•ä½•æ—¶è°ƒç”¨ã€æ˜¯å¦è°ƒç”¨éƒ½æ˜¯ä¸ç¡®å®šçš„ï¼Œæˆ‘ä»¬ä¹Ÿä¸è¦ä¸»åŠ¨è°ƒç”¨finalize()æ–¹æ³•ã€‚ä»JDK9å¼€å§‹ï¼Œè¿™ä¸ªæ–¹æ³•è¢«æ ‡è®°ä¸ºä¸æ¨èä½¿ç”¨çš„æ–¹æ³•ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaåŸºç¡€(ä¸‰)</title>
    <url>/p/c4f03879.html</url>
    <content><![CDATA[<html><head></head><body><h3 id="è¯´ä¸€è¯´hashCode-å’Œequals-çš„å…³ç³»"><a href="#è¯´ä¸€è¯´hashCode-å’Œequals-çš„å…³ç³»" class="headerlink" title="è¯´ä¸€è¯´hashCode()å’Œequals()çš„å…³ç³»"></a>è¯´ä¸€è¯´hashCode()å’Œequals()çš„å…³ç³»</h3><p>hashCode()ç”¨äºè·å–å“ˆå¸Œç ï¼ˆæ•£åˆ—ç ï¼‰ï¼Œeauqls()ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œå®ƒä»¬åº”éµå®ˆå¦‚ä¸‹è§„å®šï¼š</p>
<ul>
<li>å¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œåˆ™å®ƒä»¬å¿…é¡»æœ‰ç›¸åŒçš„å“ˆå¸Œç ã€‚</li>
<li>å¦‚æœä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„å“ˆå¸Œç ï¼Œåˆ™å®ƒä»¬æœªå¿…ç›¸ç­‰ã€‚</li>
</ul>
<p><strong>æ‰©å±•é˜…è¯»</strong></p>
<p>åœ¨Javaä¸­ï¼ŒSetæ¥å£ä»£è¡¨æ— åºçš„ã€å…ƒç´ ä¸å¯é‡å¤çš„é›†åˆï¼ŒHashSetåˆ™æ˜¯Setæ¥å£çš„å…¸å‹å®ç°ã€‚</p>
<p>å½“å‘HashSetä¸­åŠ å…¥ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå®ƒéœ€è¦åˆ¤æ–­é›†åˆä¸­æ˜¯å¦å·²ç»åŒ…å«äº†è¿™ä¸ªå…ƒç´ ï¼Œä»è€Œé¿å…é‡å¤å­˜å‚¨ã€‚ç”±äºè¿™ä¸ªåˆ¤æ–­ååˆ†çš„é¢‘ç¹ï¼Œæ‰€ä»¥è¦è®²æ±‚æ•ˆç‡ï¼Œç»ä¸èƒ½é‡‡ç”¨éå†é›†åˆé€ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒçš„æ–¹å¼ã€‚å®é™…ä¸Šï¼ŒHashSetæ˜¯é€šè¿‡è·å–å¯¹è±¡çš„å“ˆå¸Œç ï¼Œä»¥åŠè°ƒç”¨å¯¹è±¡çš„equals()æ–¹æ³•æ¥è§£å†³è¿™ä¸ªåˆ¤æ–­é—®é¢˜çš„ã€‚</p>
<p>HashSeté¦–å…ˆä¼šè°ƒç”¨å¯¹è±¡çš„hashCode()æ–¹æ³•è·å–å…¶å“ˆå¸Œç ï¼Œå¹¶é€šè¿‡å“ˆå¸Œç ç¡®å®šè¯¥å¯¹è±¡åœ¨é›†åˆä¸­å­˜æ”¾çš„ä½ç½®ã€‚å‡è®¾è¿™ä¸ªä½ç½®ä¹‹å‰å·²ç»å­˜äº†ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™HashSetä¼šè°ƒç”¨equals()å¯¹ä¸¤ä¸ªå¯¹è±¡è¿›è¡Œæ¯”è¾ƒã€‚è‹¥ç›¸ç­‰åˆ™è¯´æ˜å¯¹è±¡é‡å¤ï¼Œæ­¤æ—¶ä¸ä¼šä¿å­˜æ–°åŠ çš„å¯¹è±¡ã€‚è‹¥ä¸ç­‰è¯´æ˜å¯¹è±¡ä¸é‡å¤ï¼Œä½†æ˜¯å®ƒä»¬å­˜å‚¨çš„ä½ç½®å‘ç”Ÿäº†ç¢°æ’ï¼Œæ­¤æ—¶HashSetä¼šé‡‡ç”¨é“¾å¼ç»“æ„åœ¨åŒä¸€ä½ç½®ä¿å­˜å¤šä¸ªå¯¹è±¡ï¼Œå³å°†æ–°åŠ å¯¹è±¡é“¾æ¥åˆ°åŸæ¥å¯¹è±¡çš„ä¹‹åã€‚ä¹‹åï¼Œå†æœ‰æ–°æ·»åŠ å¯¹è±¡ä¹Ÿæ˜ å°„åˆ°è¿™ä¸ªä½ç½®æ—¶ï¼Œå°±éœ€è¦ä¸è¿™ä¸ªä½ç½®ä¸­æ‰€æœ‰çš„å¯¹è±¡è¿›è¡Œequals()æ¯”è¾ƒï¼Œè‹¥å‡ä¸ç›¸ç­‰åˆ™å°†å…¶é“¾åˆ°æœ€åä¸€ä¸ªå¯¹è±¡ä¹‹åã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆè¦é‡å†™hashCode-å’Œequals-ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦é‡å†™hashCode-å’Œequals-ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦é‡å†™hashCode()å’Œequals()ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦é‡å†™hashCode()å’Œequals()ï¼Ÿ</h3><p>Objectç±»æä¾›çš„equals()æ–¹æ³•é»˜è®¤æ˜¯ç”¨==æ¥è¿›è¡Œæ¯”è¾ƒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰ä¸¤ä¸ªå¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œæ‰èƒ½è¿”å›ç›¸ç­‰çš„ç»“æœã€‚è€Œå®é™…çš„ä¸šåŠ¡ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸çš„éœ€æ±‚æ˜¯ï¼Œè‹¥ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡å®ƒä»¬çš„å†…å®¹æ˜¯ç›¸åŒçš„ï¼Œå°±è®¤ä¸ºå®ƒä»¬ç›¸ç­‰ã€‚é‰´äºè¿™ç§æƒ…å†µï¼ŒObjectç±»ä¸­equals()æ–¹æ³•çš„é»˜è®¤å®ç°æ˜¯æ²¡æœ‰å®ç”¨ä»·å€¼çš„ï¼Œæ‰€ä»¥é€šå¸¸éƒ½è¦é‡å†™ã€‚</p>
<p>ç”±äºhashCode()ä¸equals()å…·æœ‰è”åŠ¨å…³ç³»ï¼ˆå‚è€ƒâ€œè¯´ä¸€è¯´hashCode()å’Œequals()çš„å…³ç³»â€ä¸€é¢˜ï¼‰ï¼Œæ‰€ä»¥equals()æ–¹æ³•é‡å†™æ—¶ï¼Œé€šå¸¸ä¹Ÿè¦å°†hashCode()è¿›è¡Œé‡å†™ï¼Œä½¿å¾—è¿™ä¸¤ä¸ªæ–¹æ³•å§‹ç»ˆæ»¡è¶³ç›¸å…³çš„çº¦å®šã€‚</p>
<h3 id="å’Œequals-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#å’Œequals-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="==å’Œequals()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>==å’Œequals()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>==è¿ç®—ç¬¦ï¼š</p>
<ul>
<li>ä½œç”¨äºåŸºæœ¬æ•°æ®ç±»å‹æ—¶ï¼Œæ˜¯æ¯”è¾ƒä¸¤ä¸ªæ•°å€¼æ˜¯å¦ç›¸ç­‰ï¼›</li>
<li>ä½œç”¨äºå¼•ç”¨æ•°æ®ç±»å‹æ—¶ï¼Œæ˜¯æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€æ˜¯å¦ç›¸åŒï¼Œå³åˆ¤æ–­å®ƒä»¬æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡ï¼›</li>
</ul>
<p>equals()æ–¹æ³•ï¼š</p>
<ul>
<li>æ²¡æœ‰é‡å†™æ—¶ï¼ŒObjecté»˜è®¤ä»¥ == æ¥å®ç°ï¼Œå³æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€æ˜¯å¦ç›¸åŒï¼›</li>
<li>è¿›è¡Œé‡å†™åï¼Œä¸€èˆ¬ä¼šæŒ‰ç…§å¯¹è±¡çš„å†…å®¹æ¥è¿›è¡Œæ¯”è¾ƒï¼Œè‹¥ä¸¤ä¸ªå¯¹è±¡å†…å®¹ç›¸åŒåˆ™è®¤ä¸ºå¯¹è±¡ç›¸ç­‰ï¼Œå¦åˆ™è®¤ä¸ºå¯¹è±¡ä¸ç­‰ã€‚</li>
</ul>
<h3 id="Stringç±»æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ"><a href="#Stringç±»æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ" class="headerlink" title="Stringç±»æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ"></a>Stringç±»æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ</h3><p>Stringç±»æ˜¯Javaæœ€å¸¸ç”¨çš„APIï¼Œå®ƒåŒ…å«äº†å¤§é‡å¤„ç†å­—ç¬¦ä¸²çš„æ–¹æ³•ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æœ‰ï¼š</p>
<ul>
<li>char charAt(int index)ï¼šè¿”å›æŒ‡å®šç´¢å¼•å¤„çš„å­—ç¬¦ï¼›</li>
<li>String substring(int beginIndex, int endIndex)ï¼šä»æ­¤å­—ç¬¦ä¸²ä¸­æˆªå–å‡ºä¸€éƒ¨åˆ†å­å­—ç¬¦ä¸²ï¼›</li>
<li>String[] split(String regex)ï¼šä»¥æŒ‡å®šçš„è§„åˆ™å°†æ­¤å­—ç¬¦ä¸²åˆ†å‰²æˆæ•°ç»„ï¼›</li>
<li>String trim()ï¼šåˆ é™¤å­—ç¬¦ä¸²å‰å¯¼å’Œåç½®çš„ç©ºæ ¼ï¼›</li>
<li>int indexOf(String str)ï¼šè¿”å›å­ä¸²åœ¨æ­¤å­—ç¬¦ä¸²é¦–æ¬¡å‡ºç°çš„ç´¢å¼•ï¼›</li>
<li>int lastIndexOf(String str)ï¼šè¿”å›å­ä¸²åœ¨æ­¤å­—ç¬¦ä¸²æœ€åå‡ºç°çš„ç´¢å¼•ï¼›</li>
<li>boolean startsWith(String prefix)ï¼šåˆ¤æ–­æ­¤å­—ç¬¦ä¸²æ˜¯å¦ä»¥æŒ‡å®šçš„å‰ç¼€å¼€å¤´ï¼›</li>
<li>boolean endsWith(String suffix)ï¼šåˆ¤æ–­æ­¤å­—ç¬¦ä¸²æ˜¯å¦ä»¥æŒ‡å®šçš„åç¼€ç»“å°¾ï¼›</li>
<li>String toUpperCase()ï¼šå°†æ­¤å­—ç¬¦ä¸²ä¸­æ‰€æœ‰çš„å­—ç¬¦å¤§å†™ï¼›</li>
<li>String toLowerCase()ï¼šå°†æ­¤å­—ç¬¦ä¸²ä¸­æ‰€æœ‰çš„å­—ç¬¦å°å†™ï¼›</li>
<li>String replaceFirst(String regex, String replacement)ï¼šç”¨æŒ‡å®šå­—ç¬¦ä¸²æ›¿æ¢ç¬¬ä¸€ä¸ªåŒ¹é…çš„å­ä¸²ï¼›</li>
<li>String replaceAll(String regex, String replacement)ï¼šç”¨æŒ‡å®šå­—ç¬¦ä¸²æ›¿æ¢æ‰€æœ‰çš„åŒ¹é…çš„å­ä¸²ã€‚</li>
</ul>
<p><strong>æ³¨æ„äº‹é¡¹</strong></p>
<p>Stringç±»çš„æ–¹æ³•å¤ªå¤šäº†ï¼Œä½ æ²¡å¿…è¦éƒ½è®°ä¸‹æ¥ï¼Œæ›´ä¸éœ€è¦ä¸€ä¸€åˆ—ä¸¾ã€‚é¢è¯•æ—¶èƒ½è¯´å‡ºä¸€äº›å¸¸ç”¨çš„æ–¹æ³•ï¼Œè¡¨ç°å‡ºå¯¹è¿™ä¸ªç±»è¶³å¤Ÿçš„ç†Ÿæ‚‰å°±å¯ä»¥äº†ã€‚å¦å¤–ï¼Œå»ºè®®ä½ æŒ‘å‡ ä¸ªæ–¹æ³•ä»”ç»†çœ‹çœ‹æºç å®ç°ï¼Œé¢è¯•æ—¶å¯ä»¥é‡ç‚¹è¯´è¿™å‡ ä¸ªæ–¹æ³•ã€‚</p>
<h3 id="Stringå¯ä»¥è¢«ç»§æ‰¿å—ï¼Ÿ"><a href="#Stringå¯ä»¥è¢«ç»§æ‰¿å—ï¼Ÿ" class="headerlink" title="Stringå¯ä»¥è¢«ç»§æ‰¿å—ï¼Ÿ"></a>Stringå¯ä»¥è¢«ç»§æ‰¿å—ï¼Ÿ</h3><p>Stringç±»ç”±finalä¿®é¥°ï¼Œæ‰€ä»¥ä¸èƒ½è¢«ç»§æ‰¿ã€‚</p>
<p><strong>æ‰©å±•é˜…è¯»</strong></p>
<p>åœ¨Javaä¸­ï¼ŒStringç±»è¢«è®¾è®¡ä¸ºä¸å¯å˜ç±»ï¼Œä¸»è¦è¡¨ç°åœ¨å®ƒä¿å­˜å­—ç¬¦ä¸²çš„æˆå‘˜å˜é‡æ˜¯finalçš„ã€‚</p>
<ul>
<li>Java 9ä¹‹å‰å­—ç¬¦ä¸²é‡‡ç”¨char[]æ•°ç»„æ¥ä¿å­˜å­—ç¬¦ï¼Œå³ private final char[] valueï¼›</li>
<li>Java 9åšäº†æ”¹è¿›ï¼Œé‡‡ç”¨byte[]æ•°ç»„æ¥ä¿å­˜å­—ç¬¦ï¼Œå³ private final byte[] valueï¼›</li>
</ul>
<p>ä¹‹æ‰€ä»¥è¦æŠŠStringç±»è®¾è®¡ä¸ºä¸å¯å˜ç±»ï¼Œä¸»è¦æ˜¯å‡ºäºå®‰å…¨å’Œæ€§èƒ½çš„è€ƒè™‘ï¼Œå¯å½’çº³ä¸ºå¦‚ä¸‹4ç‚¹ã€‚</p>
<ul>
<li>ç”±äºå­—ç¬¦ä¸²æ— è®ºåœ¨ä»»ä½• Java ç³»ç»Ÿä¸­éƒ½å¹¿æ³›ä½¿ç”¨ï¼Œä¼šç”¨æ¥å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚è´¦å·ï¼Œå¯†ç ï¼Œç½‘ç»œè·¯å¾„ï¼Œæ–‡ä»¶å¤„ç†ç­‰åœºæ™¯é‡Œï¼Œä¿è¯å­—ç¬¦ä¸² String ç±»çš„å®‰å…¨æ€§å°±å°¤ä¸ºé‡è¦äº†ï¼Œå¦‚æœå­—ç¬¦ä¸²æ˜¯å¯å˜çš„ï¼Œå®¹æ˜“è¢«ç¯¡æ”¹ï¼Œé‚£æˆ‘ä»¬å°±æ— æ³•ä¿è¯ä½¿ç”¨å­—ç¬¦ä¸²è¿›è¡Œæ“ä½œæ—¶ï¼Œå®ƒæ˜¯å®‰å…¨çš„ï¼Œå¾ˆæœ‰å¯èƒ½å‡ºç° SQL æ³¨å…¥ï¼Œè®¿é—®å±é™©æ–‡ä»¶ç­‰æ“ä½œã€‚</li>
<li>åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œåªæœ‰ä¸å˜çš„å¯¹è±¡å’Œå€¼æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å…±äº«æ•°æ®ã€‚ç”±äº String å¤©ç„¶çš„ä¸å¯å˜ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹â€ä¿®æ”¹â€œäº†å­—ç¬¦ä¸²çš„å€¼ï¼Œåªä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œä¸ä¼šå¯¹å…¶ä»–çº¿ç¨‹çš„è®¿é—®äº§ç”Ÿå‰¯ä½œç”¨ï¼Œè®¿é—®çš„éƒ½æ˜¯åŒæ ·çš„å­—ç¬¦ä¸²æ•°æ®ï¼Œä¸éœ€è¦ä»»ä½•åŒæ­¥æ“ä½œã€‚</li>
<li>å­—ç¬¦ä¸²ä½œä¸ºåŸºç¡€çš„æ•°æ®ç»“æ„ï¼Œå¤§é‡åœ°åº”ç”¨åœ¨ä¸€äº›é›†åˆå®¹å™¨ä¹‹ä¸­ï¼Œå°¤å…¶æ˜¯ä¸€äº›æ•£åˆ—é›†åˆï¼Œåœ¨æ•£åˆ—é›†åˆä¸­ï¼Œå­˜æ”¾å…ƒç´ éƒ½è¦æ ¹æ®å¯¹è±¡çš„ hashCode() æ–¹æ³•æ¥ç¡®å®šå…ƒç´ çš„ä½ç½®ã€‚ç”±äºå­—ç¬¦ä¸² hashcode å±æ€§ä¸ä¼šå˜æ›´ï¼Œä¿è¯äº†å”¯ä¸€æ€§ï¼Œä½¿å¾—ç±»ä¼¼ HashMapï¼ŒHashSet ç­‰å®¹å™¨æ‰èƒ½å®ç°ç›¸åº”çš„ç¼“å­˜åŠŸèƒ½ã€‚ç”±äº String çš„ä¸å¯å˜ï¼Œé¿å…é‡å¤è®¡ç®— hashcodeï¼Œåªè¦ä½¿ç”¨ç¼“å­˜çš„ hashcode å³å¯ï¼Œè¿™æ ·ä¸€æ¥å¤§å¤§æé«˜äº†åœ¨æ•£åˆ—é›†åˆä¸­ä½¿ç”¨ String å¯¹è±¡çš„æ€§èƒ½ã€‚</li>
<li>å½“å­—ç¬¦ä¸²ä¸å¯å˜æ—¶ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± æ‰æœ‰æ„ä¹‰ã€‚å­—ç¬¦ä¸²å¸¸é‡æ± çš„å‡ºç°ï¼Œå¯ä»¥å‡å°‘åˆ›å»ºç›¸åŒå­—é¢é‡çš„å­—ç¬¦ä¸²ï¼Œè®©ä¸åŒçš„å¼•ç”¨æŒ‡å‘æ± ä¸­åŒä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸ºè¿è¡Œæ—¶èŠ‚çº¦å¾ˆå¤šçš„å †å†…å­˜ã€‚è‹¥å­—ç¬¦ä¸²å¯å˜ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å¤±å»æ„ä¹‰ï¼ŒåŸºäºå¸¸é‡æ± çš„ String.intern() æ–¹æ³•ä¹Ÿå¤±æ•ˆï¼Œæ¯æ¬¡åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²å°†åœ¨å †å†…å¼€è¾Ÿå‡ºæ–°çš„ç©ºé—´ï¼Œå æ®æ›´å¤šçš„å†…å­˜ã€‚</li>
</ul>
<p>å› ä¸ºè¦ä¿è¯Stringç±»çš„ä¸å¯å˜ï¼Œé‚£ä¹ˆå°†è¿™ä¸ªç±»å®šä¹‰ä¸ºfinalçš„å°±å¾ˆå®¹æ˜“ç†è§£äº†ã€‚å¦‚æœæ²¡æœ‰finalä¿®é¥°ï¼Œé‚£ä¹ˆå°±ä¼šå­˜åœ¨Stringçš„å­ç±»ï¼Œè¿™äº›å­ç±»å¯ä»¥é‡å†™Stringç±»çš„æ–¹æ³•ï¼Œå¼ºè¡Œæ”¹å˜å­—ç¬¦ä¸²çš„å€¼ï¼Œè¿™ä¾¿è¿èƒŒäº†Stringç±»è®¾è®¡çš„åˆè¡·ã€‚</p>
<h3 id="è¯´ä¸€è¯´Stringå’ŒStringBufferæœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#è¯´ä¸€è¯´Stringå’ŒStringBufferæœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="è¯´ä¸€è¯´Stringå’ŒStringBufferæœ‰ä»€ä¹ˆåŒºåˆ«"></a>è¯´ä¸€è¯´Stringå’ŒStringBufferæœ‰ä»€ä¹ˆåŒºåˆ«</h3><p>Stringç±»æ˜¯ä¸å¯å˜ç±»ï¼Œå³ä¸€æ—¦ä¸€ä¸ªStringå¯¹è±¡è¢«åˆ›å»ºä»¥åï¼ŒåŒ…å«åœ¨è¿™ä¸ªå¯¹è±¡ä¸­çš„å­—ç¬¦åºåˆ—æ˜¯ä¸å¯æ”¹å˜çš„ï¼Œç›´è‡³è¿™ä¸ªå¯¹è±¡è¢«é”€æ¯ã€‚</p>
<p>StringBufferå¯¹è±¡åˆ™ä»£è¡¨ä¸€ä¸ªå­—ç¬¦åºåˆ—å¯å˜çš„å­—ç¬¦ä¸²ï¼Œå½“ä¸€ä¸ªStringBufferè¢«åˆ›å»ºä»¥åï¼Œé€šè¿‡StringBufferæä¾›çš„append()ã€insert()ã€reverse()ã€setCharAt()ã€setLength()ç­‰æ–¹æ³•å¯ä»¥æ”¹å˜è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„å­—ç¬¦åºåˆ—ã€‚ä¸€æ—¦é€šè¿‡StringBufferç”Ÿæˆäº†æœ€ç»ˆæƒ³è¦çš„å­—ç¬¦ä¸²ï¼Œå°±å¯ä»¥è°ƒç”¨å®ƒçš„toString()æ–¹æ³•å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªStringå¯¹è±¡ã€‚</p>
<h3 id="è¯´ä¸€è¯´StringBufferå’ŒStringBuilderæœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#è¯´ä¸€è¯´StringBufferå’ŒStringBuilderæœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="è¯´ä¸€è¯´StringBufferå’ŒStringBuilderæœ‰ä»€ä¹ˆåŒºåˆ«"></a>è¯´ä¸€è¯´StringBufferå’ŒStringBuilderæœ‰ä»€ä¹ˆåŒºåˆ«</h3><p>StringBufferã€StringBuilderéƒ½ä»£è¡¨å¯å˜çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå®ƒä»¬æœ‰å…±åŒçš„çˆ¶ç±» AbstractStringBuilderï¼Œå¹¶ä¸”ä¸¤ä¸ªç±»çš„æ„é€ æ–¹æ³•å’Œæˆå‘˜æ–¹æ³•ä¹ŸåŸºæœ¬ç›¸åŒã€‚ä¸åŒçš„æ˜¯ï¼ŒStringBufferæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€ŒStringBuilderæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥StringBuilderæ€§èƒ½ç•¥é«˜ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¦åˆ›å»ºä¸€ä¸ªå†…å®¹å¯å˜çš„å­—ç¬¦ä¸²ï¼Œå»ºè®®ä¼˜å…ˆè€ƒè™‘StringBuilderç±»ã€‚</p>
<h3 id="ä½¿ç”¨å­—ç¬¦ä¸²æ—¶ï¼Œnewå’Œâ€â€æ¨èä½¿ç”¨å“ªç§æ–¹å¼ï¼Ÿ"><a href="#ä½¿ç”¨å­—ç¬¦ä¸²æ—¶ï¼Œnewå’Œâ€â€æ¨èä½¿ç”¨å“ªç§æ–¹å¼ï¼Ÿ" class="headerlink" title="ä½¿ç”¨å­—ç¬¦ä¸²æ—¶ï¼Œnewå’Œâ€â€æ¨èä½¿ç”¨å“ªç§æ–¹å¼ï¼Ÿ"></a>ä½¿ç”¨å­—ç¬¦ä¸²æ—¶ï¼Œnewå’Œâ€â€æ¨èä½¿ç”¨å“ªç§æ–¹å¼ï¼Ÿ</h3><p>å…ˆçœ‹çœ‹ â€œhelloâ€ å’Œ new String(â€œhelloâ€) çš„åŒºåˆ«ï¼š</p>
<ul>
<li>å½“Javaç¨‹åºç›´æ¥ä½¿ç”¨ â€œhelloâ€ çš„å­—ç¬¦ä¸²ç›´æ¥é‡æ—¶ï¼ŒJVMå°†ä¼šä½¿ç”¨å¸¸é‡æ± æ¥ç®¡ç†è¿™ä¸ªå­—ç¬¦ä¸²ï¼›</li>
<li>å½“ä½¿ç”¨ new String(â€œhelloâ€) æ—¶ï¼ŒJVMä¼šå…ˆä½¿ç”¨å¸¸é‡æ± æ¥ç®¡ç† â€œhelloâ€ ç›´æ¥é‡ï¼Œå†è°ƒç”¨Stringç±»çš„æ„é€ å™¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ï¼Œæ–°åˆ›å»ºçš„Stringå¯¹è±¡è¢«ä¿å­˜åœ¨å †å†…å­˜ä¸­ã€‚</li>
</ul>
<p>æ˜¾ç„¶ï¼Œé‡‡ç”¨newçš„æ–¹å¼ä¼šå¤šåˆ›å»ºä¸€ä¸ªå¯¹è±¡å‡ºæ¥ï¼Œä¼šå ç”¨æ›´å¤šçš„å†…å­˜ï¼Œæ‰€ä»¥ä¸€èˆ¬å»ºè®®ä½¿ç”¨ç›´æ¥é‡çš„æ–¹å¼åˆ›å»ºå­—ç¬¦ä¸²ã€‚</p>
<h3 id="è¯´ä¸€è¯´ä½ å¯¹å­—ç¬¦ä¸²æ‹¼æ¥çš„ç†è§£"><a href="#è¯´ä¸€è¯´ä½ å¯¹å­—ç¬¦ä¸²æ‹¼æ¥çš„ç†è§£" class="headerlink" title="è¯´ä¸€è¯´ä½ å¯¹å­—ç¬¦ä¸²æ‹¼æ¥çš„ç†è§£"></a>è¯´ä¸€è¯´ä½ å¯¹å­—ç¬¦ä¸²æ‹¼æ¥çš„ç†è§£</h3><p>æ‹¼æ¥å­—ç¬¦ä¸²æœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„æœ‰4ç§ï¼Œä¸‹é¢åˆ—ä¸¾äº†è¿™4ç§æ–¹å¼å„è‡ªé€‚åˆçš„åœºæ™¯ã€‚</p>
<ol>
<li>+ è¿ç®—ç¬¦ï¼šå¦‚æœæ‹¼æ¥çš„éƒ½æ˜¯å­—ç¬¦ä¸²ç›´æ¥é‡ï¼Œåˆ™é€‚åˆä½¿ç”¨ + è¿ç®—ç¬¦å®ç°æ‹¼æ¥ï¼›</li>
<li>StringBuilderï¼šå¦‚æœæ‹¼æ¥çš„å­—ç¬¦ä¸²ä¸­åŒ…å«å˜é‡ï¼Œå¹¶ä¸è¦æ±‚çº¿ç¨‹å®‰å…¨ï¼Œåˆ™é€‚åˆä½¿ç”¨StringBuilderï¼›</li>
<li>StringBufferï¼šå¦‚æœæ‹¼æ¥çš„å­—ç¬¦ä¸²ä¸­åŒ…å«å˜é‡ï¼Œå¹¶ä¸”è¦æ±‚çº¿ç¨‹å®‰å…¨ï¼Œåˆ™é€‚åˆä½¿ç”¨StringBufferï¼›</li>
<li>Stringç±»çš„concatæ–¹æ³•ï¼šå¦‚æœåªæ˜¯å¯¹ä¸¤ä¸ªå­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥ï¼Œå¹¶ä¸”åŒ…å«å˜é‡ï¼Œåˆ™é€‚åˆä½¿ç”¨concatæ–¹æ³•ï¼›</li>
</ol>
<p><strong>æ‰©å±•é˜…è¯»</strong></p>
<p>é‡‡ç”¨ + è¿ç®—ç¬¦æ‹¼æ¥å­—ç¬¦ä¸²æ—¶ï¼š</p>
<ul>
<li>å¦‚æœæ‹¼æ¥çš„éƒ½æ˜¯å­—ç¬¦ä¸²ç›´æ¥é‡ï¼Œåˆ™åœ¨ç¼–è¯‘æ—¶ç¼–è¯‘å™¨ä¼šå°†å…¶ç›´æ¥ä¼˜åŒ–ä¸ºä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ä¸²ï¼Œå’Œä½ ç›´æ¥å†™ä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ä¸²æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æ•ˆç‡éå¸¸çš„é«˜ã€‚</li>
<li>å¦‚æœæ‹¼æ¥çš„å­—ç¬¦ä¸²ä¸­åŒ…å«å˜é‡ï¼Œåˆ™åœ¨ç¼–è¯‘æ—¶ç¼–è¯‘å™¨é‡‡ç”¨StringBuilderå¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼Œå³è‡ªåŠ¨åˆ›å»ºStringBuilderå®ä¾‹å¹¶è°ƒç”¨å…¶append()æ–¹æ³•ï¼Œå°†è¿™äº›å­—ç¬¦ä¸²æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œæ•ˆç‡ä¹Ÿå¾ˆé«˜ã€‚ä½†å¦‚æœè¿™ä¸ªæ‹¼æ¥æ“ä½œæ˜¯åœ¨å¾ªç¯ä¸­è¿›è¡Œçš„ï¼Œé‚£ä¹ˆæ¯æ¬¡å¾ªç¯ç¼–è¯‘å™¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªStringBuilderå®ä¾‹ï¼Œå†å»æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œç›¸å½“äºæ‰§è¡Œäº† new StringBuilder().append(str)ï¼Œæ‰€ä»¥æ­¤æ—¶æ•ˆç‡å¾ˆä½ã€‚</li>
</ul>
<p>é‡‡ç”¨StringBuilder/StringBufferæ‹¼æ¥å­—ç¬¦ä¸²æ—¶ï¼š</p>
<ul>
<li>StringBuilder/StringBufferéƒ½æœ‰å­—ç¬¦ä¸²ç¼“å†²åŒºï¼Œç¼“å†²åŒºçš„å®¹é‡åœ¨åˆ›å»ºå¯¹è±¡æ—¶ç¡®å®šï¼Œå¹¶ä¸”é»˜è®¤ä¸º16ã€‚å½“æ‹¼æ¥çš„å­—ç¬¦ä¸²è¶…è¿‡ç¼“å†²åŒºçš„å®¹é‡æ—¶ï¼Œä¼šè§¦å‘ç¼“å†²åŒºçš„æ‰©å®¹æœºåˆ¶ï¼Œå³ç¼“å†²åŒºåŠ å€ã€‚</li>
<li>ç¼“å†²åŒºé¢‘ç¹çš„æ‰©å®¹ä¼šé™ä½æ‹¼æ¥çš„æ€§èƒ½ï¼Œæ‰€ä»¥å¦‚æœèƒ½æå‰é¢„ä¼°æœ€ç»ˆå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œåˆ™å»ºè®®åœ¨åˆ›å»ºå¯å˜å­—ç¬¦ä¸²å¯¹è±¡æ—¶ï¼Œæ”¾å¼ƒä½¿ç”¨é»˜è®¤çš„å®¹é‡ï¼Œå¯ä»¥æŒ‡å®šç¼“å†²åŒºçš„å®¹é‡ä¸ºé¢„ä¼°çš„å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚</li>
</ul>
<p>é‡‡ç”¨Stringç±»çš„concatæ–¹æ³•æ‹¼æ¥å­—ç¬¦ä¸²æ—¶ï¼š</p>
<ul>
<li>concatæ–¹æ³•çš„æ‹¼æ¥é€»è¾‘æ˜¯ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªè¶³ä»¥å®¹çº³å¾…æ‹¼æ¥çš„ä¸¤ä¸ªå­—ç¬¦ä¸²çš„å­—èŠ‚æ•°ç»„ï¼Œç„¶åå…ˆåå°†ä¸¤ä¸ªå­—ç¬¦ä¸²æ‹¼åˆ°è¿™ä¸ªæ•°ç»„é‡Œï¼Œæœ€åå°†æ­¤æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚</li>
<li>åœ¨æ‹¼æ¥å¤§é‡å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œconcatæ–¹æ³•çš„æ•ˆç‡ä½äºStringBuilderã€‚ä½†æ˜¯åªæ‹¼æ¥2ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œconcatæ–¹æ³•çš„æ•ˆç‡è¦ä¼˜äºStringBuilderã€‚å¹¶ä¸”è¿™ç§æ‹¼æ¥æ–¹å¼ä»£ç ç®€æ´ï¼Œæ‰€ä»¥åªæ‹¼2ä¸ªå­—ç¬¦ä¸²æ—¶å»ºè®®ä¼˜å…ˆé€‰æ‹©concatæ–¹æ³•ã€‚</li>
</ul>
<h3 id="ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸åŠ çš„åº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"><a href="#ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸åŠ çš„åº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ" class="headerlink" title="ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸åŠ çš„åº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"></a>ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸åŠ çš„åº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</h3><p>å¦‚æœæ‹¼æ¥çš„éƒ½æ˜¯å­—ç¬¦ä¸²ç›´æ¥é‡ï¼Œåˆ™åœ¨ç¼–è¯‘æ—¶ç¼–è¯‘å™¨ä¼šå°†å…¶ç›´æ¥ä¼˜åŒ–ä¸ºä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ä¸²ï¼Œå’Œä½ ç›´æ¥å†™ä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ä¸²æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>å¦‚æœæ‹¼æ¥çš„å­—ç¬¦ä¸²ä¸­åŒ…å«å˜é‡ï¼Œåˆ™åœ¨ç¼–è¯‘æ—¶ç¼–è¯‘å™¨é‡‡ç”¨StringBuilderå¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼Œå³è‡ªåŠ¨åˆ›å»ºStringBuilderå®ä¾‹å¹¶è°ƒç”¨å…¶append()æ–¹æ³•ï¼Œå°†è¿™äº›å­—ç¬¦ä¸²æ‹¼æ¥åœ¨ä¸€èµ·ã€‚</p>
<h3 id="String-a-â€œabcâ€-ï¼Œè¯´ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ä¼šåˆ›å»ºä»€ä¹ˆï¼Œæ”¾åœ¨å“ªé‡Œï¼Ÿ"><a href="#String-a-â€œabcâ€-ï¼Œè¯´ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ä¼šåˆ›å»ºä»€ä¹ˆï¼Œæ”¾åœ¨å“ªé‡Œï¼Ÿ" class="headerlink" title="String a = â€œabcâ€; ï¼Œè¯´ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ä¼šåˆ›å»ºä»€ä¹ˆï¼Œæ”¾åœ¨å“ªé‡Œï¼Ÿ"></a>String a = â€œabcâ€; ï¼Œè¯´ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ä¼šåˆ›å»ºä»€ä¹ˆï¼Œæ”¾åœ¨å“ªé‡Œï¼Ÿ</h3><p>JVMä¼šä½¿ç”¨å¸¸é‡æ± æ¥ç®¡ç†å­—ç¬¦ä¸²ç›´æ¥é‡ã€‚åœ¨æ‰§è¡Œè¿™å¥è¯æ—¶ï¼ŒJVMä¼šå…ˆæ£€æŸ¥å¸¸é‡æ± ä¸­æ˜¯å¦å·²ç»å­˜æœ‰â€abcâ€ï¼Œè‹¥æ²¡æœ‰åˆ™å°†â€abcâ€å­˜å…¥å¸¸é‡æ± ï¼Œå¦åˆ™å°±å¤ç”¨å¸¸é‡æ± ä¸­å·²æœ‰çš„â€abcâ€ï¼Œå°†å…¶å¼•ç”¨èµ‹å€¼ç»™å˜é‡aã€‚</p>
<h3 id="new-String-â€œabcâ€-æ˜¯å»äº†å“ªé‡Œï¼Œä»…ä»…æ˜¯åœ¨å †é‡Œé¢å—ï¼Ÿ"><a href="#new-String-â€œabcâ€-æ˜¯å»äº†å“ªé‡Œï¼Œä»…ä»…æ˜¯åœ¨å †é‡Œé¢å—ï¼Ÿ" class="headerlink" title="new String(â€œabcâ€) æ˜¯å»äº†å“ªé‡Œï¼Œä»…ä»…æ˜¯åœ¨å †é‡Œé¢å—ï¼Ÿ"></a>new String(â€œabcâ€) æ˜¯å»äº†å“ªé‡Œï¼Œä»…ä»…æ˜¯åœ¨å †é‡Œé¢å—ï¼Ÿ</h3><p>åœ¨æ‰§è¡Œè¿™å¥è¯æ—¶ï¼ŒJVMä¼šå…ˆä½¿ç”¨å¸¸é‡æ± æ¥ç®¡ç†å­—ç¬¦ä¸²ç›´æ¥é‡ï¼Œå³å°†â€abcâ€å­˜å…¥å¸¸é‡æ± ã€‚ç„¶åå†åˆ›å»ºä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šè¢«ä¿å­˜åœ¨å †å†…å­˜ä¸­ã€‚å¹¶ä¸”ï¼Œå †ä¸­å¯¹è±¡çš„æ•°æ®ä¼šæŒ‡å‘å¸¸é‡æ± ä¸­çš„ç›´æ¥é‡ã€‚</p>
<h3 id="æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>ä»è®¾è®¡ç›®çš„ä¸Šæ¥è¯´ï¼ŒäºŒè€…æœ‰å¦‚ä¸‹çš„åŒºåˆ«ï¼š</p>
<p>æ¥å£ä½“ç°çš„æ˜¯ä¸€ç§è§„èŒƒã€‚å¯¹äºæ¥å£çš„å®ç°è€…è€Œè¨€ï¼Œæ¥å£è§„å®šäº†å®ç°è€…å¿…é¡»å‘å¤–æä¾›å“ªäº›æœåŠ¡ï¼›å¯¹äºæ¥å£çš„è°ƒç”¨è€…è€Œè¨€ï¼Œæ¥å£è§„å®šäº†è°ƒç”¨è€…å¯ä»¥è°ƒç”¨å“ªäº›æœåŠ¡ï¼Œä»¥åŠå¦‚ä½•è°ƒç”¨è¿™äº›æœåŠ¡ã€‚å½“åœ¨ä¸€ä¸ªç¨‹åºä¸­ä½¿ç”¨æ¥å£æ—¶ï¼Œæ¥å£æ˜¯å¤šä¸ªæ¨¡å—é—´çš„è€¦åˆæ ‡å‡†ï¼›å½“åœ¨å¤šä¸ªåº”ç”¨ç¨‹åºä¹‹é—´ä½¿ç”¨æ¥å£æ—¶ï¼Œæ¥å£æ˜¯å¤šä¸ªç¨‹åºä¹‹é—´çš„é€šä¿¡æ ‡å‡†ã€‚</p>
<p>æŠ½è±¡ç±»ä½“ç°çš„æ˜¯ä¸€ç§æ¨¡æ¿å¼è®¾è®¡ã€‚æŠ½è±¡ç±»ä½œä¸ºå¤šä¸ªå­ç±»çš„æŠ½è±¡çˆ¶ç±»ï¼Œå¯ä»¥è¢«å½“æˆç³»ç»Ÿå®ç°è¿‡ç¨‹ä¸­çš„ä¸­é—´äº§å“ï¼Œè¿™ä¸ªä¸­é—´äº§å“å·²ç»å®ç°äº†ç³»ç»Ÿçš„éƒ¨åˆ†åŠŸèƒ½ï¼Œä½†è¿™ä¸ªäº§å“ä¾ç„¶ä¸èƒ½å½“æˆæœ€ç»ˆäº§å“ï¼Œå¿…é¡»æœ‰æ›´è¿›ä¸€æ­¥çš„å®Œå–„ï¼Œè¿™ç§å®Œå–„å¯èƒ½æœ‰å‡ ç§ä¸åŒæ–¹å¼ã€‚</p>
<p>ä»ä½¿ç”¨æ–¹å¼ä¸Šæ¥è¯´ï¼ŒäºŒè€…æœ‰å¦‚ä¸‹çš„åŒºåˆ«ï¼š</p>
<ul>
<li>æ¥å£é‡Œåªèƒ½åŒ…å«æŠ½è±¡æ–¹æ³•ã€é™æ€æ–¹æ³•ã€é»˜è®¤æ–¹æ³•å’Œç§æœ‰æ–¹æ³•ï¼Œä¸èƒ½ä¸ºæ™®é€šæ–¹æ³•æä¾›æ–¹æ³•å®ç°ï¼›æŠ½è±¡ç±»åˆ™å®Œå…¨å¯ä»¥åŒ…å«æ™®é€šæ–¹æ³•ã€‚</li>
<li>æ¥å£é‡Œåªèƒ½å®šä¹‰é™æ€å¸¸é‡ï¼Œä¸èƒ½å®šä¹‰æ™®é€šæˆå‘˜å˜é‡ï¼›æŠ½è±¡ç±»é‡Œåˆ™æ—¢å¯ä»¥å®šä¹‰æ™®é€šæˆå‘˜å˜é‡ï¼Œä¹Ÿå¯ä»¥å®šä¹‰é™æ€å¸¸é‡ã€‚</li>
<li>æ¥å£é‡Œä¸åŒ…å«æ„é€ å™¨ï¼›æŠ½è±¡ç±»é‡Œå¯ä»¥åŒ…å«æ„é€ å™¨ï¼ŒæŠ½è±¡ç±»é‡Œçš„æ„é€ å™¨å¹¶ä¸æ˜¯ç”¨äºåˆ›å»ºå¯¹è±¡ï¼Œè€Œæ˜¯è®©å…¶å­ç±»è°ƒç”¨è¿™äº›æ„é€ å™¨æ¥å®Œæˆå±äºæŠ½è±¡ç±»çš„åˆå§‹åŒ–æ“ä½œã€‚</li>
<li>æ¥å£é‡Œä¸èƒ½åŒ…å«åˆå§‹åŒ–å—ï¼›ä½†æŠ½è±¡ç±»åˆ™å®Œå…¨å¯ä»¥åŒ…å«åˆå§‹åŒ–å—ã€‚</li>
<li>ä¸€ä¸ªç±»æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªç›´æ¥çˆ¶ç±»ï¼ŒåŒ…æ‹¬æŠ½è±¡ç±»ï¼›ä½†ä¸€ä¸ªç±»å¯ä»¥ç›´æ¥å®ç°å¤šä¸ªæ¥å£ï¼Œé€šè¿‡å®ç°å¤šä¸ªæ¥å£å¯ä»¥å¼¥è¡¥Javaå•ç»§æ‰¿çš„ä¸è¶³ã€‚</li>
</ul>
<p><strong>æ‰©å±•é˜…è¯»</strong></p>
<p>æ¥å£å’ŒæŠ½è±¡ç±»å¾ˆåƒï¼Œå®ƒä»¬éƒ½å…·æœ‰å¦‚ä¸‹å…±åŒçš„ç‰¹å¾ï¼š</p>
<ul>
<li>æ¥å£å’ŒæŠ½è±¡ç±»éƒ½ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œå®ƒä»¬éƒ½ä½äºç»§æ‰¿æ ‘çš„é¡¶ç«¯ï¼Œç”¨äºè¢«å…¶ä»–ç±»å®ç°å’Œç»§æ‰¿ã€‚</li>
<li>æ¥å£å’ŒæŠ½è±¡ç±»éƒ½å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•ï¼Œå®ç°æ¥å£æˆ–ç»§æ‰¿æŠ½è±¡ç±»çš„æ™®é€šå­ç±»éƒ½å¿…é¡»å®ç°è¿™äº›æŠ½è±¡æ–¹æ³•ã€‚</li>
</ul>
<h3 id="æ¥å£ä¸­å¯ä»¥æœ‰æ„é€ å‡½æ•°å—ï¼Ÿ"><a href="#æ¥å£ä¸­å¯ä»¥æœ‰æ„é€ å‡½æ•°å—ï¼Ÿ" class="headerlink" title="æ¥å£ä¸­å¯ä»¥æœ‰æ„é€ å‡½æ•°å—ï¼Ÿ"></a>æ¥å£ä¸­å¯ä»¥æœ‰æ„é€ å‡½æ•°å—ï¼Ÿ</h3><p>ç”±äºæ¥å£å®šä¹‰çš„æ˜¯ä¸€ç§è§„èŒƒï¼Œå› æ­¤æ¥å£é‡Œä¸èƒ½åŒ…å«æ„é€ å™¨å’Œåˆå§‹åŒ–å—å®šä¹‰ã€‚æ¥å£é‡Œå¯ä»¥åŒ…å«æˆå‘˜å˜é‡ï¼ˆåªèƒ½æ˜¯é™æ€å¸¸é‡ï¼‰ã€æ–¹æ³•ï¼ˆåªèƒ½æ˜¯æŠ½è±¡å®ä¾‹æ–¹æ³•ã€ç±»æ–¹æ³•ã€é»˜è®¤æ–¹æ³•æˆ–ç§æœ‰æ–¹æ³•ï¼‰ã€å†…éƒ¨ç±»ï¼ˆåŒ…æ‹¬å†…éƒ¨æ¥å£ã€æšä¸¾ï¼‰å®šä¹‰ã€‚</p>
<h3 id="è°ˆè°ˆä½ å¯¹é¢å‘æ¥å£ç¼–ç¨‹çš„ç†è§£"><a href="#è°ˆè°ˆä½ å¯¹é¢å‘æ¥å£ç¼–ç¨‹çš„ç†è§£" class="headerlink" title="è°ˆè°ˆä½ å¯¹é¢å‘æ¥å£ç¼–ç¨‹çš„ç†è§£"></a>è°ˆè°ˆä½ å¯¹é¢å‘æ¥å£ç¼–ç¨‹çš„ç†è§£</h3><p>æ¥å£ä½“ç°çš„æ˜¯ä¸€ç§è§„èŒƒå’Œå®ç°åˆ†ç¦»çš„è®¾è®¡å“²å­¦ï¼Œå……åˆ†åˆ©ç”¨æ¥å£å¯ä»¥æå¥½åœ°é™ä½ç¨‹åºå„æ¨¡å—ä¹‹é—´çš„è€¦åˆï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚åŸºäºè¿™ç§åŸåˆ™ï¼Œå¾ˆå¤šè½¯ä»¶æ¶æ„è®¾è®¡ç†è®ºéƒ½å€¡å¯¼â€œé¢å‘æ¥å£â€ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é¢å‘å®ç°ç±»ç¼–ç¨‹ï¼Œå¸Œæœ›é€šè¿‡é¢å‘æ¥å£ç¼–ç¨‹æ¥é™ä½ç¨‹åºçš„è€¦åˆã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaåŸºç¡€(å››)</title>
    <url>/p/3eb3d776.html</url>
    <content><![CDATA[<html><head></head><body><h3 id="Javaä¸­æœ‰å“ªäº›å®¹å™¨ï¼ˆé›†åˆç±»ï¼‰ï¼Ÿ"><a href="#Javaä¸­æœ‰å“ªäº›å®¹å™¨ï¼ˆé›†åˆç±»ï¼‰ï¼Ÿ" class="headerlink" title="Javaä¸­æœ‰å“ªäº›å®¹å™¨ï¼ˆé›†åˆç±»ï¼‰ï¼Ÿ"></a>Javaä¸­æœ‰å“ªäº›å®¹å™¨ï¼ˆé›†åˆç±»ï¼‰ï¼Ÿ</h3><p>Javaä¸­çš„é›†åˆç±»ä¸»è¦ç”±Collectionå’ŒMapè¿™ä¸¤ä¸ªæ¥å£æ´¾ç”Ÿè€Œå‡ºï¼Œå…¶ä¸­Collectionæ¥å£åˆæ´¾ç”Ÿå‡ºä¸‰ä¸ªå­æ¥å£ï¼Œåˆ†åˆ«æ˜¯Setã€Listã€Queueã€‚æ‰€æœ‰çš„Javaé›†åˆç±»ï¼Œéƒ½æ˜¯Setã€Listã€Queueã€Mapè¿™å››ä¸ªæ¥å£çš„å®ç°ç±»ï¼Œè¿™å››ä¸ªæ¥å£å°†é›†åˆåˆ†æˆäº†å››å¤§ç±»ï¼Œå…¶ä¸­</p>
<ul>
<li>Setä»£è¡¨æ— åºçš„ï¼Œå…ƒç´ ä¸å¯é‡å¤çš„é›†åˆï¼›</li>
<li>Listä»£è¡¨æœ‰åºçš„ï¼Œå…ƒç´ å¯ä»¥é‡å¤çš„é›†åˆï¼›</li>
<li>Queueä»£è¡¨å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„é˜Ÿåˆ—ï¼›</li>
<li>Mapä»£è¡¨å…·æœ‰æ˜ å°„å…³ç³»ï¼ˆkey-valueï¼‰çš„é›†åˆã€‚</li>
</ul>
<p>è¿™äº›æ¥å£æ‹¥æœ‰ä¼—å¤šçš„å®ç°ç±»ï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„å®ç°ç±»æœ‰HashSetã€TreeSetã€ArrayListã€LinkedListã€ArrayDequeã€HashMapã€TreeMapç­‰ã€‚</p>
<p><strong>æ‰©å±•é˜…è¯»</strong></p>
<p>Collectionä½“ç³»çš„ç»§æ‰¿æ ‘ï¼š</p>
<p><img src="/p/3eb3d776/74C2C3389688C6364FF2DE8AA768A039.jpeg" alt="img"></p>
<p>Mapä½“ç³»çš„ç»§æ‰¿æ ‘ï¼š</p>
<p><img src="/p/3eb3d776/E26BABF74692B006DA33C112A6FD5EEC.jpeg" alt="img"></p>
<p><em>æ³¨ï¼šç´«è‰²æ¡†ä½“ä»£è¡¨æ¥å£ï¼Œå…¶ä¸­åŠ ç²—çš„æ˜¯ä»£è¡¨å››ç±»é›†åˆçš„æ¥å£ã€‚è“è‰²æ¡†ä½“ä»£è¡¨å®ç°ç±»ï¼Œå…¶ä¸­æœ‰é˜´å½±çš„æ˜¯å¸¸ç”¨å®ç°ç±»ã€‚</em></p>
<h3 id="Javaä¸­çš„å®¹å™¨ï¼Œçº¿ç¨‹å®‰å…¨å’Œçº¿ç¨‹ä¸å®‰å…¨çš„åˆ†åˆ«æœ‰å“ªäº›ï¼Ÿ"><a href="#Javaä¸­çš„å®¹å™¨ï¼Œçº¿ç¨‹å®‰å…¨å’Œçº¿ç¨‹ä¸å®‰å…¨çš„åˆ†åˆ«æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="Javaä¸­çš„å®¹å™¨ï¼Œçº¿ç¨‹å®‰å…¨å’Œçº¿ç¨‹ä¸å®‰å…¨çš„åˆ†åˆ«æœ‰å“ªäº›ï¼Ÿ"></a>Javaä¸­çš„å®¹å™¨ï¼Œçº¿ç¨‹å®‰å…¨å’Œçº¿ç¨‹ä¸å®‰å…¨çš„åˆ†åˆ«æœ‰å“ªäº›ï¼Ÿ</h3><p>java.utilåŒ…ä¸‹çš„é›†åˆç±»å¤§éƒ¨åˆ†éƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œä¾‹å¦‚æˆ‘ä»¬å¸¸ç”¨çš„HashSetã€TreeSetã€ArrayListã€LinkedListã€ArrayDequeã€HashMapã€TreeMapï¼Œè¿™äº›éƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„é›†åˆç±»ï¼Œä½†æ˜¯å®ƒä»¬çš„ä¼˜ç‚¹æ˜¯æ€§èƒ½å¥½ã€‚å¦‚æœéœ€è¦ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»ï¼Œåˆ™å¯ä»¥ä½¿ç”¨Collectionså·¥å…·ç±»æä¾›çš„synchronizedXxx()æ–¹æ³•ï¼Œå°†è¿™äº›é›†åˆç±»åŒ…è£…æˆçº¿ç¨‹å®‰å…¨çš„é›†åˆç±»ã€‚</p>
<p>java.utilåŒ…ä¸‹ä¹Ÿæœ‰çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»ï¼Œä¾‹å¦‚Vectorã€Hashtableã€‚è¿™äº›é›†åˆç±»éƒ½æ˜¯æ¯”è¾ƒå¤è€çš„APIï¼Œè™½ç„¶å®ç°äº†çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯æ€§èƒ½å¾ˆå·®ã€‚æ‰€ä»¥å³ä¾¿æ˜¯éœ€è¦ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»ï¼Œä¹Ÿå»ºè®®å°†çº¿ç¨‹ä¸å®‰å…¨çš„é›†åˆç±»åŒ…è£…æˆçº¿ç¨‹å®‰å…¨é›†åˆç±»çš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨è¿™äº›å¤è€çš„APIã€‚</p>
<p>ä»Java5å¼€å§‹ï¼ŒJavaåœ¨java.util.concurrentåŒ…ä¸‹æä¾›äº†å¤§é‡æ”¯æŒé«˜æ•ˆå¹¶å‘è®¿é—®çš„é›†åˆç±»ï¼Œå®ƒä»¬æ—¢èƒ½åŒ…è£…è‰¯å¥½çš„è®¿é—®æ€§èƒ½ï¼Œæœ‰èƒ½åŒ…è£…çº¿ç¨‹å®‰å…¨ã€‚è¿™äº›é›†åˆç±»å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå®ƒä»¬çš„ç‰¹å¾å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>ä»¥Concurrentå¼€å¤´çš„é›†åˆç±»ï¼š</p>
<p>ä»¥Concurrentå¼€å¤´çš„é›†åˆç±»ä»£è¡¨äº†æ”¯æŒå¹¶å‘è®¿é—®çš„é›†åˆï¼Œå®ƒä»¬å¯ä»¥æ”¯æŒå¤šä¸ªçº¿ç¨‹å¹¶å‘å†™å…¥è®¿é—®ï¼Œè¿™äº›å†™å…¥çº¿ç¨‹çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†è¯»å–æ“ä½œä¸å¿…é”å®šã€‚ä»¥Concurrentå¼€å¤´çš„é›†åˆç±»é‡‡ç”¨äº†æ›´å¤æ‚çš„ç®—æ³•æ¥ä¿è¯æ°¸è¿œä¸ä¼šé”ä½æ•´ä¸ªé›†åˆï¼Œå› æ­¤åœ¨å¹¶å‘å†™å…¥æ—¶æœ‰è¾ƒå¥½çš„æ€§èƒ½ã€‚</p>
</li>
<li><p>ä»¥CopyOnWriteå¼€å¤´çš„é›†åˆç±»ï¼š</p>
<p>ä»¥CopyOnWriteå¼€å¤´çš„é›†åˆç±»é‡‡ç”¨å¤åˆ¶åº•å±‚æ•°ç»„çš„æ–¹å¼æ¥å®ç°å†™æ“ä½œã€‚å½“çº¿ç¨‹å¯¹æ­¤ç±»é›†åˆæ‰§è¡Œè¯»å–æ“ä½œæ—¶ï¼Œçº¿ç¨‹å°†ä¼šç›´æ¥è¯»å–é›†åˆæœ¬èº«ï¼Œæ— é¡»åŠ é”ä¸é˜»å¡ã€‚å½“çº¿ç¨‹å¯¹æ­¤ç±»é›†åˆæ‰§è¡Œå†™å…¥æ“ä½œæ—¶ï¼Œé›†åˆä¼šåœ¨åº•å±‚å¤åˆ¶ä¸€ä»½æ–°çš„æ•°ç»„ï¼Œæ¥ä¸‹æ¥å¯¹æ–°çš„æ•°ç»„æ‰§è¡Œå†™å…¥æ“ä½œã€‚ç”±äºå¯¹é›†åˆçš„å†™å…¥æ“ä½œéƒ½æ˜¯å¯¹æ•°ç»„çš„å‰¯æœ¬æ‰§è¡Œæ“ä½œï¼Œå› æ­¤å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
</li>
</ul>
<p><strong>æ‰©å±•é˜…è¯»</strong></p>
<p>java.util.concurrentåŒ…ä¸‹çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»çš„ä½“ç³»ç»“æ„ï¼š</p>
<p><img src="/p/3eb3d776/53AA859E1B3A9CD7709DF9366999B88D.jpeg" alt="img"></p>
<h3 id="Mapæ¥å£æœ‰å“ªäº›å®ç°ç±»ï¼Ÿ"><a href="#Mapæ¥å£æœ‰å“ªäº›å®ç°ç±»ï¼Ÿ" class="headerlink" title="Mapæ¥å£æœ‰å“ªäº›å®ç°ç±»ï¼Ÿ"></a>Mapæ¥å£æœ‰å“ªäº›å®ç°ç±»ï¼Ÿ</h3><p>Mapæ¥å£æœ‰å¾ˆå¤šå®ç°ç±»ï¼Œå…¶ä¸­æ¯”è¾ƒå¸¸ç”¨çš„æœ‰HashMapã€LinkedHashMapã€TreeMapã€ConcurrentHashMapã€‚</p>
<p>å¯¹äºä¸éœ€è¦æ’åºçš„åœºæ™¯ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨HashMapï¼Œå› ä¸ºå®ƒæ˜¯æ€§èƒ½æœ€å¥½çš„Mapå®ç°ã€‚å¦‚æœéœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ConcurrentHashMapã€‚å®ƒçš„æ€§èƒ½å¥½äºHashtableï¼Œå› ä¸ºå®ƒåœ¨putæ—¶é‡‡ç”¨åˆ†æ®µé”/CASçš„åŠ é”æœºåˆ¶ï¼Œè€Œä¸æ˜¯åƒHashtableé‚£æ ·ï¼Œæ— è®ºæ˜¯putè¿˜æ˜¯getéƒ½åšåŒæ­¥å¤„ç†ã€‚</p>
<p>å¯¹äºéœ€è¦æ’åºçš„åœºæ™¯ï¼Œå¦‚æœéœ€è¦æŒ‰æ’å…¥é¡ºåºæ’åºåˆ™å¯ä»¥ä½¿ç”¨LinkedHashMapï¼Œå¦‚æœéœ€è¦å°†keyæŒ‰è‡ªç„¶é¡ºåºæ’åˆ—ç”šè‡³æ˜¯è‡ªå®šä¹‰é¡ºåºæ’åˆ—ï¼Œåˆ™å¯ä»¥é€‰æ‹©TreeMapã€‚å¦‚æœéœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨Collectionså·¥å…·ç±»å°†ä¸Šè¿°å®ç°ç±»åŒ…è£…æˆçº¿ç¨‹å®‰å…¨çš„Mapã€‚</p>
<h3 id="æè¿°ä¸€ä¸‹Map-putçš„è¿‡ç¨‹"><a href="#æè¿°ä¸€ä¸‹Map-putçš„è¿‡ç¨‹" class="headerlink" title="æè¿°ä¸€ä¸‹Map putçš„è¿‡ç¨‹"></a>æè¿°ä¸€ä¸‹Map putçš„è¿‡ç¨‹</h3><p>HashMapæ˜¯æœ€ç»å…¸çš„Mapå®ç°ï¼Œä¸‹é¢ä»¥å®ƒçš„è§†è§’ä»‹ç»putçš„è¿‡ç¨‹ï¼š</p>
<ol>
<li><p>é¦–æ¬¡æ‰©å®¹ï¼š</p>
<p>å…ˆåˆ¤æ–­æ•°ç»„æ˜¯å¦ä¸ºç©ºï¼Œè‹¥æ•°ç»„ä¸ºç©ºåˆ™è¿›è¡Œç¬¬ä¸€æ¬¡æ‰©å®¹ï¼ˆresizeï¼‰ï¼›</p>
</li>
<li><p>è®¡ç®—ç´¢å¼•ï¼š</p>
<p>é€šè¿‡hashç®—æ³•ï¼Œè®¡ç®—é”®å€¼å¯¹åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ï¼›</p>
</li>
<li><p>æ’å…¥æ•°æ®ï¼š</p>
<ul>
<li>å¦‚æœå½“å‰ä½ç½®å…ƒç´ ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ’å…¥æ•°æ®ï¼›</li>
<li>å¦‚æœå½“å‰ä½ç½®å…ƒç´ éç©ºï¼Œä¸”keyå·²å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¦†ç›–å…¶valueï¼›</li>
<li>å¦‚æœå½“å‰ä½ç½®å…ƒç´ éç©ºï¼Œä¸”keyä¸å­˜åœ¨ï¼Œåˆ™å°†æ•°æ®é“¾åˆ°é“¾è¡¨æœ«ç«¯ï¼›</li>
<li>è‹¥é“¾è¡¨é•¿åº¦è¾¾åˆ°8ï¼Œåˆ™å°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘ï¼Œå¹¶å°†æ•°æ®æ’å…¥æ ‘ä¸­ï¼›</li>
</ul>
</li>
<li><p>å†æ¬¡æ‰©å®¹</p>
<p>å¦‚æœæ•°ç»„ä¸­å…ƒç´ ä¸ªæ•°ï¼ˆsizeï¼‰è¶…è¿‡thresholdï¼Œåˆ™å†æ¬¡è¿›è¡Œæ‰©å®¹æ“ä½œã€‚</p>
</li>
</ol>
<p><strong>æ‰©å±•é˜…è¯»</strong></p>
<p>HashMapæ·»åŠ æ•°æ®çš„è¯¦ç»†è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/p/3eb3d776/18330EB2310CB83A25FA317E65ED60EB.png" alt="img"></p>
<h3 id="å¦‚ä½•å¾—åˆ°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„Mapï¼Ÿ"><a href="#å¦‚ä½•å¾—åˆ°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„Mapï¼Ÿ" class="headerlink" title="å¦‚ä½•å¾—åˆ°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„Mapï¼Ÿ"></a>å¦‚ä½•å¾—åˆ°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„Mapï¼Ÿ</h3><ol>
<li>ä½¿ç”¨Collectionså·¥å…·ç±»ï¼Œå°†çº¿ç¨‹ä¸å®‰å…¨çš„MapåŒ…è£…æˆçº¿ç¨‹å®‰å…¨çš„Mapï¼›</li>
<li>ä½¿ç”¨java.util.concurrentåŒ…ä¸‹çš„Mapï¼Œå¦‚ConcurrentHashMapï¼›</li>
<li>ä¸å»ºè®®ä½¿ç”¨Hashtableï¼Œè™½ç„¶Hashtableæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯æ€§èƒ½è¾ƒå·®ã€‚</li>
</ol>
<h3 id="HashMapæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ"><a href="#HashMapæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ" class="headerlink" title="HashMapæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ"></a>HashMapæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</h3><ol>
<li>HashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„å®ç°ï¼›</li>
<li>HashMapå¯ä»¥ä½¿ç”¨nullä½œä¸ºkeyæˆ–valueã€‚</li>
</ol>
<h3 id="JDK7å’ŒJDK8ä¸­çš„HashMapæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#JDK7å’ŒJDK8ä¸­çš„HashMapæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="JDK7å’ŒJDK8ä¸­çš„HashMapæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>JDK7å’ŒJDK8ä¸­çš„HashMapæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>JDK7ä¸­çš„HashMapï¼Œæ˜¯åŸºäºæ•°ç»„+é“¾è¡¨æ¥å®ç°çš„ï¼Œå®ƒçš„åº•å±‚ç»´æŠ¤ä¸€ä¸ªEntryæ•°ç»„ã€‚å®ƒä¼šæ ¹æ®è®¡ç®—çš„hashCodeå°†å¯¹åº”çš„KVé”®å€¼å¯¹å­˜å‚¨åˆ°è¯¥æ•°ç»„ä¸­ï¼Œä¸€æ—¦å‘ç”ŸhashCodeå†²çªï¼Œé‚£ä¹ˆå°±ä¼šå°†è¯¥KVé”®å€¼å¯¹æ”¾åˆ°å¯¹åº”çš„å·²æœ‰å…ƒç´ çš„åé¢ï¼Œ æ­¤æ—¶ä¾¿å½¢æˆäº†ä¸€ä¸ªé“¾è¡¨å¼çš„å­˜å‚¨ç»“æ„ã€‚</p>
<p>JDK7ä¸­HashMapçš„å®ç°æ–¹æ¡ˆæœ‰ä¸€ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ï¼Œå³å½“Hashå†²çªä¸¥é‡æ—¶ï¼Œåœ¨æ¡¶ä¸Šå½¢æˆçš„é“¾è¡¨ä¼šå˜å¾—è¶Šæ¥è¶Šé•¿ï¼Œè¿™æ ·åœ¨æŸ¥è¯¢æ—¶çš„æ•ˆç‡å°±ä¼šè¶Šæ¥è¶Šä½ï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¸ºO(N)ã€‚</p>
<p>JDK8ä¸­çš„HashMapï¼Œæ˜¯åŸºäºæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘æ¥å®ç°çš„ï¼Œå®ƒçš„åº•å±‚ç»´æŠ¤ä¸€ä¸ªNodeæ•°ç»„ã€‚å½“é“¾è¡¨çš„å­˜å‚¨çš„æ•°æ®ä¸ªæ•°å¤§äºç­‰äº8çš„æ—¶å€™ï¼Œä¸å†é‡‡ç”¨é“¾è¡¨å­˜å‚¨ï¼Œè€Œé‡‡ç”¨äº†çº¢é»‘æ ‘å­˜å‚¨ç»“æ„ã€‚è¿™ä¹ˆåšä¸»è¦æ˜¯åœ¨æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦ä¸Šè¿›è¡Œä¼˜åŒ–ï¼Œé“¾è¡¨ä¸ºO(N)ï¼Œè€Œçº¢é»‘æ ‘ä¸€ç›´æ˜¯O(logN)ï¼Œå¯ä»¥å¤§å¤§çš„æé«˜æŸ¥æ‰¾æ€§èƒ½ã€‚</p>
<h3 id="ä»‹ç»ä¸€ä¸‹HashMapåº•å±‚çš„å®ç°åŸç†"><a href="#ä»‹ç»ä¸€ä¸‹HashMapåº•å±‚çš„å®ç°åŸç†" class="headerlink" title="ä»‹ç»ä¸€ä¸‹HashMapåº•å±‚çš„å®ç°åŸç†"></a>ä»‹ç»ä¸€ä¸‹HashMapåº•å±‚çš„å®ç°åŸç†</h3><p>å®ƒåŸºäºhashç®—æ³•ï¼Œé€šè¿‡putæ–¹æ³•å’Œgetæ–¹æ³•å­˜å‚¨å’Œè·å–å¯¹è±¡ã€‚</p>
<p>å­˜å‚¨å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å°†K/Vä¼ ç»™putæ–¹æ³•æ—¶ï¼Œå®ƒè°ƒç”¨Kçš„hashCodeè®¡ç®—hashä»è€Œå¾—åˆ°bucketä½ç½®ï¼Œè¿›ä¸€æ­¥å­˜å‚¨ï¼ŒHashMapä¼šæ ¹æ®å½“å‰bucketçš„å ç”¨æƒ…å†µè‡ªåŠ¨è°ƒæ•´å®¹é‡(è¶…è¿‡Load Facotråˆ™resizeä¸ºåŸæ¥çš„2å€)ã€‚è·å–å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å°†Kä¼ ç»™getï¼Œå®ƒè°ƒç”¨hashCodeè®¡ç®—hashä»è€Œå¾—åˆ°bucketä½ç½®ï¼Œå¹¶è¿›ä¸€æ­¥è°ƒç”¨equals()æ–¹æ³•ç¡®å®šé”®å€¼å¯¹ã€‚</p>
<p>å¦‚æœå‘ç”Ÿç¢°æ’çš„æ—¶å€™ï¼ŒHashMapé€šè¿‡é“¾è¡¨å°†äº§ç”Ÿç¢°æ’å†²çªçš„å…ƒç´ ç»„ç»‡èµ·æ¥ã€‚åœ¨Java 8ä¸­ï¼Œå¦‚æœä¸€ä¸ªbucketä¸­ç¢°æ’å†²çªçš„å…ƒç´ è¶…è¿‡æŸä¸ªé™åˆ¶(é»˜è®¤æ˜¯8)ï¼Œåˆ™ä½¿ç”¨çº¢é»‘æ ‘æ¥æ›¿æ¢é“¾è¡¨ï¼Œä»è€Œæé«˜é€Ÿåº¦ã€‚</p>
<h3 id="ä»‹ç»ä¸€ä¸‹HashMapçš„æ‰©å®¹æœºåˆ¶"><a href="#ä»‹ç»ä¸€ä¸‹HashMapçš„æ‰©å®¹æœºåˆ¶" class="headerlink" title="ä»‹ç»ä¸€ä¸‹HashMapçš„æ‰©å®¹æœºåˆ¶"></a>ä»‹ç»ä¸€ä¸‹HashMapçš„æ‰©å®¹æœºåˆ¶</h3><ol>
<li>æ•°ç»„çš„åˆå§‹å®¹é‡ä¸º16ï¼Œè€Œå®¹é‡æ˜¯ä»¥2çš„æ¬¡æ–¹æ‰©å……çš„ï¼Œä¸€æ˜¯ä¸ºäº†æé«˜æ€§èƒ½ä½¿ç”¨è¶³å¤Ÿå¤§çš„æ•°ç»„ï¼ŒäºŒæ˜¯ä¸ºäº†èƒ½ä½¿ç”¨ä½è¿ç®—ä»£æ›¿å–æ¨¡é¢„ç®—(æ®è¯´æå‡äº†5~8å€)ã€‚</li>
<li>æ•°ç»„æ˜¯å¦éœ€è¦æ‰©å……æ˜¯é€šè¿‡è´Ÿè½½å› å­åˆ¤æ–­çš„ï¼Œå¦‚æœå½“å‰å…ƒç´ ä¸ªæ•°ä¸ºæ•°ç»„å®¹é‡çš„0.75æ—¶ï¼Œå°±ä¼šæ‰©å……æ•°ç»„ã€‚è¿™ä¸ª0.75å°±æ˜¯é»˜è®¤çš„è´Ÿè½½å› å­ï¼Œå¯ç”±æ„é€ å™¨ä¼ å…¥ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾ç½®å¤§äº1çš„è´Ÿè½½å› å­ï¼Œè¿™æ ·æ•°ç»„å°±ä¸ä¼šæ‰©å……ï¼Œç‰ºç‰²æ€§èƒ½ï¼ŒèŠ‚çœå†…å­˜ã€‚</li>
<li>ä¸ºäº†è§£å†³ç¢°æ’ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ æ˜¯å•å‘é“¾è¡¨ç±»å‹ã€‚å½“é“¾è¡¨é•¿åº¦åˆ°è¾¾ä¸€ä¸ªé˜ˆå€¼æ—¶ï¼ˆ7æˆ–8ï¼‰ï¼Œä¼šå°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘æé«˜æ€§èƒ½ã€‚è€Œå½“é“¾è¡¨é•¿åº¦ç¼©å°åˆ°å¦ä¸€ä¸ªé˜ˆå€¼æ—¶ï¼ˆ6ï¼‰ï¼Œåˆä¼šå°†çº¢é»‘æ ‘è½¬æ¢å›å•å‘é“¾è¡¨æé«˜æ€§èƒ½ã€‚</li>
<li>å¯¹äºç¬¬ä¸‰ç‚¹è¡¥å……è¯´æ˜ï¼Œæ£€æŸ¥é“¾è¡¨é•¿åº¦è½¬æ¢æˆçº¢é»‘æ ‘ä¹‹å‰ï¼Œè¿˜ä¼šå…ˆæ£€æµ‹å½“å‰æ•°ç»„æ•°ç»„æ˜¯å¦åˆ°è¾¾ä¸€ä¸ªé˜ˆå€¼ï¼ˆ64ï¼‰ï¼Œå¦‚æœæ²¡æœ‰åˆ°è¾¾è¿™ä¸ªå®¹é‡ï¼Œä¼šæ”¾å¼ƒè½¬æ¢ï¼Œå…ˆå»æ‰©å……æ•°ç»„ã€‚æ‰€ä»¥ä¸Šé¢ä¹Ÿè¯´äº†é“¾è¡¨é•¿åº¦çš„é˜ˆå€¼æ˜¯7æˆ–8ï¼Œå› ä¸ºä¼šæœ‰ä¸€æ¬¡æ”¾å¼ƒè½¬æ¢çš„æ“ä½œã€‚</li>
</ol>
<p><strong>æ‰©å±•é˜…è¯»</strong></p>
<p>ä¾‹å¦‚æˆ‘ä»¬ä»16æ‰©å±•ä¸º32æ—¶ï¼Œå…·ä½“çš„å˜åŒ–å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="/p/3eb3d776/B7A9F3ADBA028FE6FDE22C94D566B4F1.png" alt="img"></p>
<p>å› æ­¤å…ƒç´ åœ¨é‡æ–°è®¡ç®—hashä¹‹åï¼Œå› ä¸ºnå˜ä¸º2å€ï¼Œé‚£ä¹ˆn-1çš„maskèŒƒå›´åœ¨é«˜ä½å¤š1bit(çº¢è‰²)ï¼Œå› æ­¤æ–°çš„indexå°±ä¼šå‘ç”Ÿè¿™æ ·çš„å˜åŒ–ï¼š</p>
<p><img src="/p/3eb3d776/FB03BC4205AD26DC0210B12412AAC145.png" alt="img"></p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æ‰©å……HashMapçš„æ—¶å€™ï¼Œä¸éœ€è¦é‡æ–°è®¡ç®—hashï¼Œåªéœ€è¦çœ‹çœ‹åŸæ¥çš„hashå€¼æ–°å¢çš„é‚£ä¸ªbitæ˜¯1è¿˜æ˜¯0å°±å¥½äº†ï¼Œæ˜¯0çš„è¯ç´¢å¼•æ²¡å˜ï¼Œæ˜¯1çš„è¯ç´¢å¼•å˜æˆâ€œåŸç´¢å¼•+oldCapâ€ã€‚å¯ä»¥çœ‹çœ‹ä¸‹å›¾ä¸º16æ‰©å……ä¸º32çš„resizeç¤ºæ„å›¾ï¼š</p>
<p><img src="/p/3eb3d776/C2928A93915A4AEF2709862EBAC8515C.png" alt="img"></p>
<p>è¿™ä¸ªè®¾è®¡ç¡®å®éå¸¸çš„å·§å¦™ï¼Œæ—¢çœå»äº†é‡æ–°è®¡ç®—hashå€¼çš„æ—¶é—´ï¼Œè€Œä¸”åŒæ—¶ï¼Œç”±äºæ–°å¢çš„1bitæ˜¯0è¿˜æ˜¯1å¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„ï¼Œå› æ­¤resizeçš„è¿‡ç¨‹ï¼Œå‡åŒ€çš„æŠŠä¹‹å‰çš„å†²çªçš„èŠ‚ç‚¹åˆ†æ•£åˆ°æ–°çš„bucketäº†ã€‚</p>
<h3 id="HashMapä¸­çš„å¾ªç¯é“¾è¡¨æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Ÿ"><a href="#HashMapä¸­çš„å¾ªç¯é“¾è¡¨æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Ÿ" class="headerlink" title="HashMapä¸­çš„å¾ªç¯é“¾è¡¨æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Ÿ"></a>HashMapä¸­çš„å¾ªç¯é“¾è¡¨æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Ÿ</h3><p>åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œå½“é‡æ–°è°ƒæ•´HashMapå¤§å°çš„æ—¶å€™ï¼Œå°±ä¼šå­˜åœ¨æ¡ä»¶ç«äº‰ï¼Œå› ä¸ºå¦‚æœä¸¤ä¸ªçº¿ç¨‹éƒ½å‘ç°HashMapéœ€è¦é‡æ–°è°ƒæ•´å¤§å°äº†ï¼Œå®ƒä»¬ä¼šåŒæ—¶è¯•ç€è°ƒæ•´å¤§å°ã€‚åœ¨è°ƒæ•´å¤§å°çš„è¿‡ç¨‹ä¸­ï¼Œå­˜å‚¨åœ¨é“¾è¡¨ä¸­çš„å…ƒç´ çš„æ¬¡åºä¼šåè¿‡æ¥ï¼Œå› ä¸ºç§»åŠ¨åˆ°æ–°çš„bucketä½ç½®çš„æ—¶å€™ï¼ŒHashMapå¹¶ä¸ä¼šå°†å…ƒç´ æ”¾åœ¨é“¾è¡¨çš„å°¾éƒ¨ï¼Œè€Œæ˜¯æ”¾åœ¨å¤´éƒ¨ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…å°¾éƒ¨éå†ã€‚å¦‚æœæ¡ä»¶ç«äº‰å‘ç”Ÿäº†ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿæ­»å¾ªç¯äº†ã€‚</p>
<h3 id="HashMapä¸ºä»€ä¹ˆç”¨çº¢é»‘æ ‘è€Œä¸ç”¨Bæ ‘ï¼Ÿ"><a href="#HashMapä¸ºä»€ä¹ˆç”¨çº¢é»‘æ ‘è€Œä¸ç”¨Bæ ‘ï¼Ÿ" class="headerlink" title="HashMapä¸ºä»€ä¹ˆç”¨çº¢é»‘æ ‘è€Œä¸ç”¨Bæ ‘ï¼Ÿ"></a>HashMapä¸ºä»€ä¹ˆç”¨çº¢é»‘æ ‘è€Œä¸ç”¨Bæ ‘ï¼Ÿ</h3><p>B/B+æ ‘å¤šç”¨äºå¤–å­˜ä¸Šæ—¶ï¼ŒB/B+ä¹Ÿè¢«æˆä¸ºä¸€ä¸ªç£ç›˜å‹å¥½çš„æ•°æ®ç»“æ„ã€‚</p>
<p>HashMapæœ¬æ¥æ˜¯æ•°ç»„+é“¾è¡¨çš„å½¢å¼ï¼Œé“¾è¡¨ç”±äºå…¶æŸ¥æ‰¾æ…¢çš„ç‰¹ç‚¹ï¼Œæ‰€ä»¥éœ€è¦è¢«æŸ¥æ‰¾æ•ˆç‡æ›´é«˜çš„æ ‘ç»“æ„æ¥æ›¿æ¢ã€‚å¦‚æœç”¨B/B+æ ‘çš„è¯ï¼Œåœ¨æ•°æ®é‡ä¸æ˜¯å¾ˆå¤šçš„æƒ…å†µä¸‹ï¼Œæ•°æ®éƒ½ä¼šâ€œæŒ¤åœ¨â€ä¸€ä¸ªç»“ç‚¹é‡Œé¢ï¼Œè¿™ä¸ªæ—¶å€™éå†æ•ˆç‡å°±é€€åŒ–æˆäº†é“¾è¡¨ã€‚</p>
<h3 id="HashMapä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ"><a href="#HashMapä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ" class="headerlink" title="HashMapä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ"></a>HashMapä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨ï¼Ÿ</h3><p>HashMapåœ¨å¹¶å‘æ‰§è¡Œputæ“ä½œæ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´å½¢æˆå¾ªç¯é“¾è¡¨ï¼Œä»è€Œå¼•èµ·æ­»å¾ªç¯ã€‚</p>
<h3 id="HashMapå¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨ï¼Ÿ"><a href="#HashMapå¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨ï¼Ÿ" class="headerlink" title="HashMapå¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨ï¼Ÿ"></a>HashMapå¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨ï¼Ÿ</h3><ol>
<li>ç›´æ¥ä½¿ç”¨Hashtableç±»ï¼›</li>
<li>ç›´æ¥ä½¿ç”¨ConcurrentHashMapï¼›</li>
<li>ä½¿ç”¨Collectionså°†HashMapåŒ…è£…æˆçº¿ç¨‹å®‰å…¨çš„Mapã€‚</li>
</ol>
<h3 id="HashMapæ˜¯å¦‚ä½•è§£å†³å“ˆå¸Œå†²çªçš„ï¼Ÿ"><a href="#HashMapæ˜¯å¦‚ä½•è§£å†³å“ˆå¸Œå†²çªçš„ï¼Ÿ" class="headerlink" title="HashMapæ˜¯å¦‚ä½•è§£å†³å“ˆå¸Œå†²çªçš„ï¼Ÿ"></a>HashMapæ˜¯å¦‚ä½•è§£å†³å“ˆå¸Œå†²çªçš„ï¼Ÿ</h3><p>ä¸ºäº†è§£å†³ç¢°æ’ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ æ˜¯å•å‘é“¾è¡¨ç±»å‹ã€‚å½“é“¾è¡¨é•¿åº¦åˆ°è¾¾ä¸€ä¸ªé˜ˆå€¼æ—¶ï¼Œä¼šå°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘æé«˜æ€§èƒ½ã€‚è€Œå½“é“¾è¡¨é•¿åº¦ç¼©å°åˆ°å¦ä¸€ä¸ªé˜ˆå€¼æ—¶ï¼Œåˆä¼šå°†çº¢é»‘æ ‘è½¬æ¢å›å•å‘é“¾è¡¨æé«˜æ€§èƒ½ã€‚</p>
<h3 id="è¯´ä¸€è¯´HashMapå’ŒHashTableçš„åŒºåˆ«"><a href="#è¯´ä¸€è¯´HashMapå’ŒHashTableçš„åŒºåˆ«" class="headerlink" title="è¯´ä¸€è¯´HashMapå’ŒHashTableçš„åŒºåˆ«"></a>è¯´ä¸€è¯´HashMapå’ŒHashTableçš„åŒºåˆ«</h3><ol>
<li>Hashtableæ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„Mapå®ç°ï¼Œä½†HashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„å®ç°ï¼Œæ‰€ä»¥HashMapæ¯”Hashtableçš„æ€§èƒ½é«˜ä¸€ç‚¹ã€‚</li>
<li>Hashtableä¸å…è®¸ä½¿ç”¨nullä½œä¸ºkeyå’Œvalueï¼Œå¦‚æœè¯•å›¾æŠŠnullå€¼æ”¾è¿›Hashtableä¸­ï¼Œå°†ä¼šå¼•å‘ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œä½†HashMapå¯ä»¥ä½¿ç”¨nullä½œä¸ºkeyæˆ–valueã€‚</li>
</ol>
<p><strong>æ‰©å±•é˜…è¯»</strong></p>
<p>ä»Hashtableçš„ç±»åä¸Šå°±å¯ä»¥çœ‹å‡ºå®ƒæ˜¯ä¸€ä¸ªå¤è€çš„ç±»ï¼Œå®ƒçš„å‘½åç”šè‡³æ²¡æœ‰éµå®ˆJavaçš„å‘½åè§„èŒƒï¼šæ¯ä¸ªå•è¯çš„é¦–å­—æ¯éƒ½åº”è¯¥å¤§å†™ã€‚ä¹Ÿè®¸å½“åˆå¼€å‘Hashtableçš„å·¥ç¨‹å¸ˆä¹Ÿæ²¡æœ‰æ³¨æ„åˆ°è¿™ä¸€ç‚¹ï¼Œåæ¥å¤§é‡Javaç¨‹åºä¸­ä½¿ç”¨äº†Hashtableç±»ï¼Œæ‰€ä»¥è¿™ä¸ªç±»åä¹Ÿå°±ä¸èƒ½æ”¹ä¸ºHashTableäº†ï¼Œå¦åˆ™å°†å¯¼è‡´å¤§é‡ç¨‹åºéœ€è¦æ”¹å†™ã€‚</p>
<p>ä¸Vectorç±»ä¼¼çš„æ˜¯ï¼Œå°½é‡å°‘ç”¨Hashtableå®ç°ç±»ï¼Œå³ä½¿éœ€è¦åˆ›å»ºçº¿ç¨‹å®‰å…¨çš„Mapå®ç°ç±»ï¼Œä¹Ÿæ— é¡»ä½¿ç”¨Hashtableå®ç°ç±»ï¼Œå¯ä»¥é€šè¿‡Collectionså·¥å…·ç±»æŠŠHashMapå˜æˆçº¿ç¨‹å®‰å…¨çš„Mapã€‚</p>
<h3 id="HashMapä¸ConcurrentHashMapæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#HashMapä¸ConcurrentHashMapæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="HashMapä¸ConcurrentHashMapæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>HashMapä¸ConcurrentHashMapæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>HashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œè¿™æ„å‘³ç€ä¸åº”è¯¥åœ¨å¤šçº¿ç¨‹ä¸­å¯¹è¿™äº›Mapè¿›è¡Œä¿®æ”¹æ“ä½œï¼Œå¦åˆ™ä¼šäº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œç”šè‡³è¿˜ä¼šå› ä¸ºå¹¶å‘æ’å…¥å…ƒç´ è€Œå¯¼è‡´é“¾è¡¨æˆç¯ï¼Œè¿™æ ·åœ¨æŸ¥æ‰¾æ—¶å°±ä¼šå‘ç”Ÿæ­»å¾ªç¯ï¼Œå½±å“åˆ°æ•´ä¸ªåº”ç”¨ç¨‹åºã€‚</p>
<p>Collectionså·¥å…·ç±»å¯ä»¥å°†ä¸€ä¸ªMapè½¬æ¢æˆçº¿ç¨‹å®‰å…¨çš„å®ç°ï¼Œå…¶å®ä¹Ÿå°±æ˜¯é€šè¿‡ä¸€ä¸ªåŒ…è£…ç±»ï¼Œç„¶åæŠŠæ‰€æœ‰åŠŸèƒ½éƒ½å§”æ‰˜ç»™ä¼ å…¥çš„Mapï¼Œè€ŒåŒ…è£…ç±»æ˜¯åŸºäºsynchronizedå…³é”®å­—æ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼ˆHashtableä¹Ÿæ˜¯åŸºäºsynchronizedå…³é”®å­—ï¼‰ï¼Œåº•å±‚ä½¿ç”¨çš„æ˜¯äº’æ–¥é”ï¼Œæ€§èƒ½ä¸ååé‡æ¯”è¾ƒä½ã€‚</p>
<p>ConcurrentHashMapçš„å®ç°ç»†èŠ‚è¿œæ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œå› æ­¤æ€§èƒ½ä¹Ÿè¦é«˜ä¸Šè®¸å¤šã€‚å®ƒæ²¡æœ‰ä½¿ç”¨ä¸€ä¸ªå…¨å±€é”æ¥é”ä½è‡ªå·±ï¼Œè€Œæ˜¯é‡‡ç”¨äº†å‡å°‘é”ç²’åº¦çš„æ–¹æ³•ï¼Œå°½é‡å‡å°‘å› ä¸ºç«äº‰é”è€Œå¯¼è‡´çš„é˜»å¡ä¸å†²çªï¼Œè€Œä¸”ConcurrentHashMapçš„æ£€ç´¢æ“ä½œæ˜¯ä¸éœ€è¦é”çš„ã€‚</p>
<h3 id="ä»‹ç»ä¸€ä¸‹ConcurrentHashMapæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#ä»‹ç»ä¸€ä¸‹ConcurrentHashMapæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="ä»‹ç»ä¸€ä¸‹ConcurrentHashMapæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"></a>ä»‹ç»ä¸€ä¸‹ConcurrentHashMapæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</h3><p>JDK 1.7ä¸­çš„å®ç°ï¼š</p>
<p>åœ¨ jdk 1.7 ä¸­ï¼ŒConcurrentHashMap æ˜¯ç”± Segment æ•°æ®ç»“æ„å’Œ HashEntry æ•°ç»„ç»“æ„æ„æˆï¼Œé‡‡å–åˆ†æ®µé”æ¥ä¿è¯å®‰å…¨æ€§ã€‚Segment æ˜¯ ReentrantLock é‡å…¥é”ï¼Œåœ¨ ConcurrentHashMap ä¸­æ‰®æ¼”é”çš„è§’è‰²ï¼ŒHashEntry åˆ™ç”¨äºå­˜å‚¨é”®å€¼å¯¹æ•°æ®ã€‚ä¸€ä¸ª ConcurrentHashMap é‡ŒåŒ…å«ä¸€ä¸ª Segment æ•°ç»„ï¼Œä¸€ä¸ª Segment é‡ŒåŒ…å«ä¸€ä¸ª HashEntry æ•°ç»„ï¼ŒSegment çš„ç»“æ„å’Œ HashMap ç±»ä¼¼ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„å’Œé“¾è¡¨ç»“æ„ã€‚</p>
<p><img src="/p/3eb3d776/A064CF0DD49D1B3694548913C28728DB.png" alt="img"></p>
<p>JDK 1.8ä¸­çš„å®ç°ï¼š</p>
<p>JDK1.8 çš„å®ç°å·²ç»æ‘’å¼ƒäº† Segment çš„æ¦‚å¿µï¼Œè€Œæ˜¯ç›´æ¥ç”¨ Node æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„æ¥å®ç°ï¼Œå¹¶å‘æ§åˆ¶ä½¿ç”¨ Synchronized å’Œ CAS æ¥æ“ä½œï¼Œæ•´ä¸ªçœ‹èµ·æ¥å°±åƒæ˜¯ä¼˜åŒ–è¿‡ä¸”çº¿ç¨‹å®‰å…¨çš„ HashMapï¼Œè™½ç„¶åœ¨ JDK1.8 ä¸­è¿˜èƒ½çœ‹åˆ° Segment çš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯å·²ç»ç®€åŒ–äº†å±æ€§ï¼Œåªæ˜¯ä¸ºäº†å…¼å®¹æ—§ç‰ˆæœ¬ã€‚</p>
<p><img src="/p/3eb3d776/9C8ABF1CD3475339A49DE3B9E1696FE7.png" alt="img"></p>
<h3 id="ConcurrentHashMapæ˜¯æ€ä¹ˆåˆ†æ®µåˆ†ç»„çš„ï¼Ÿ"><a href="#ConcurrentHashMapæ˜¯æ€ä¹ˆåˆ†æ®µåˆ†ç»„çš„ï¼Ÿ" class="headerlink" title="ConcurrentHashMapæ˜¯æ€ä¹ˆåˆ†æ®µåˆ†ç»„çš„ï¼Ÿ"></a>ConcurrentHashMapæ˜¯æ€ä¹ˆåˆ†æ®µåˆ†ç»„çš„ï¼Ÿ</h3><p>getæ“ä½œï¼š</p>
<p>Segmentçš„getæ“ä½œå®ç°éå¸¸ç®€å•å’Œé«˜æ•ˆï¼Œå…ˆç»è¿‡ä¸€æ¬¡å†æ•£åˆ—ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªæ•£åˆ—å€¼é€šè¿‡æ•£åˆ—è¿ç®—å®šä½åˆ° Segmentï¼Œå†é€šè¿‡æ•£åˆ—ç®—æ³•å®šä½åˆ°å…ƒç´ ã€‚getæ“ä½œçš„é«˜æ•ˆä¹‹å¤„åœ¨äºæ•´ä¸ªgetè¿‡ç¨‹éƒ½ä¸éœ€è¦åŠ é”ï¼Œé™¤éè¯»åˆ°ç©ºçš„å€¼æ‰ä¼šåŠ é”é‡è¯»ã€‚åŸå› å°±æ˜¯å°†ä½¿ç”¨çš„å…±äº«å˜é‡å®šä¹‰æˆ volatile ç±»å‹ã€‚</p>
<p>putæ“ä½œï¼š</p>
<p>å½“æ‰§è¡Œputæ“ä½œæ—¶ï¼Œä¼šç»å†ä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼›</li>
<li>å®šä½åˆ°æ·»åŠ å…ƒç´ çš„ä½ç½®ï¼Œå°†å…¶æ”¾å…¥ HashEntry æ•°ç»„ä¸­ã€‚</li>
</ol>
<p>æ’å…¥è¿‡ç¨‹ä¼šè¿›è¡Œç¬¬ä¸€æ¬¡ key çš„ hash æ¥å®šä½ Segment çš„ä½ç½®ï¼Œå¦‚æœè¯¥ Segment è¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼Œå³é€šè¿‡ CAS æ“ä½œè¿›è¡Œèµ‹å€¼ï¼Œç„¶åè¿›è¡Œç¬¬äºŒæ¬¡ hash æ“ä½œï¼Œæ‰¾åˆ°ç›¸åº”çš„ HashEntry çš„ä½ç½®ï¼Œè¿™é‡Œä¼šåˆ©ç”¨ç»§æ‰¿è¿‡æ¥çš„é”çš„ç‰¹æ€§ï¼Œåœ¨å°†æ•°æ®æ’å…¥æŒ‡å®šçš„ HashEntry ä½ç½®æ—¶ï¼ˆå°¾æ’æ³•ï¼‰ï¼Œä¼šé€šè¿‡ç»§æ‰¿ ReentrantLock çš„ tryLock() æ–¹æ³•å°è¯•å»è·å–é”ï¼Œå¦‚æœè·å–æˆåŠŸå°±ç›´æ¥æ’å…¥ç›¸åº”çš„ä½ç½®ï¼Œå¦‚æœå·²ç»æœ‰çº¿ç¨‹è·å–è¯¥Segmentçš„é”ï¼Œé‚£å½“å‰çº¿ç¨‹ä¼šä»¥è‡ªæ—‹çš„æ–¹å¼å»ç»§ç»­çš„è°ƒç”¨ tryLock() æ–¹æ³•å»è·å–é”ï¼Œè¶…è¿‡æŒ‡å®šæ¬¡æ•°å°±æŒ‚èµ·ï¼Œç­‰å¾…å”¤é†’ã€‚</p>
<h3 id="è¯´ä¸€è¯´ä½ å¯¹LinkedHashMapçš„ç†è§£"><a href="#è¯´ä¸€è¯´ä½ å¯¹LinkedHashMapçš„ç†è§£" class="headerlink" title="è¯´ä¸€è¯´ä½ å¯¹LinkedHashMapçš„ç†è§£"></a>è¯´ä¸€è¯´ä½ å¯¹LinkedHashMapçš„ç†è§£</h3><p>LinkedHashMapä½¿ç”¨åŒå‘é“¾è¡¨æ¥ç»´æŠ¤key-valueå¯¹çš„é¡ºåºï¼ˆå…¶å®åªéœ€è¦è€ƒè™‘keyçš„é¡ºåºï¼‰ï¼Œè¯¥é“¾è¡¨è´Ÿè´£ç»´æŠ¤Mapçš„è¿­ä»£é¡ºåºï¼Œè¿­ä»£é¡ºåºä¸key-valueå¯¹çš„æ’å…¥é¡ºåºä¿æŒä¸€è‡´ã€‚</p>
<p>LinkedHashMapå¯ä»¥é¿å…å¯¹HashMapã€Hashtableé‡Œçš„key-valueå¯¹è¿›è¡Œæ’åºï¼ˆåªè¦æ’å…¥key-valueå¯¹æ—¶ä¿æŒé¡ºåºå³å¯ï¼‰ï¼ŒåŒæ—¶åˆå¯é¿å…ä½¿ç”¨TreeMapæ‰€å¢åŠ çš„æˆæœ¬ã€‚</p>
<p>LinkedHashMapéœ€è¦ç»´æŠ¤å…ƒç´ çš„æ’å…¥é¡ºåºï¼Œå› æ­¤æ€§èƒ½ç•¥ä½äºHashMapçš„æ€§èƒ½ã€‚ä½†å› ä¸ºå®ƒä»¥é“¾è¡¨æ¥ç»´æŠ¤å†…éƒ¨é¡ºåºï¼Œæ‰€ä»¥åœ¨è¿­ä»£è®¿é—®Mapé‡Œçš„å…¨éƒ¨å…ƒç´ æ—¶å°†æœ‰è¾ƒå¥½çš„æ€§èƒ½ã€‚</p>
<h3 id="è¯·ä»‹ç»LinkedHashMapçš„åº•å±‚åŸç†"><a href="#è¯·ä»‹ç»LinkedHashMapçš„åº•å±‚åŸç†" class="headerlink" title="è¯·ä»‹ç»LinkedHashMapçš„åº•å±‚åŸç†"></a>è¯·ä»‹ç»LinkedHashMapçš„åº•å±‚åŸç†</h3><p>**LinkedHashMapç»§æ‰¿äºHashMapï¼Œå®ƒåœ¨HashMapçš„åŸºç¡€ä¸Šï¼Œé€šè¿‡ç»´æŠ¤ä¸€æ¡åŒå‘é“¾è¡¨ï¼Œè§£å†³äº†HashMapä¸èƒ½éšæ—¶ä¿æŒéå†é¡ºåºå’Œæ’å…¥é¡ºåºä¸€è‡´çš„é—®é¢˜ã€‚åœ¨å®ç°ä¸Šï¼ŒLinkedHashMapå¾ˆå¤šæ–¹æ³•ç›´æ¥ç»§æ‰¿è‡ªHashMapï¼Œä»…ä¸ºç»´æŠ¤åŒå‘é“¾è¡¨é‡å†™äº†éƒ¨åˆ†æ–¹æ³•ã€‚</p>
<p>å¦‚ä¸‹å›¾ï¼Œæ·¡è“è‰²çš„ç®­å¤´è¡¨ç¤ºå‰é©±å¼•ç”¨ï¼Œçº¢è‰²ç®­å¤´è¡¨ç¤ºåç»§å¼•ç”¨ã€‚æ¯å½“æœ‰æ–°çš„é”®å€¼å¯¹èŠ‚ç‚¹æ’å…¥æ—¶ï¼Œæ–°èŠ‚ç‚¹æœ€ç»ˆä¼šæ¥åœ¨tailå¼•ç”¨æŒ‡å‘çš„èŠ‚ç‚¹åé¢ã€‚è€Œtailå¼•ç”¨åˆ™ä¼šç§»åŠ¨åˆ°æ–°çš„èŠ‚ç‚¹ä¸Šï¼Œè¿™æ ·ä¸€ä¸ªåŒå‘é“¾è¡¨å°±å»ºç«‹èµ·æ¥äº†ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaåŸºç¡€(äº”)</title>
    <url>/p/3818800b.html</url>
    <content><![CDATA[<html><head></head><body><h3 id="è¯·ä»‹ç»TreeMapçš„åº•å±‚åŸç†"><a href="#è¯·ä»‹ç»TreeMapçš„åº•å±‚åŸç†" class="headerlink" title="è¯·ä»‹ç»TreeMapçš„åº•å±‚åŸç†"></a>è¯·ä»‹ç»TreeMapçš„åº•å±‚åŸç†</h3><p>TreeMapåŸºäºçº¢é»‘æ ‘ï¼ˆRed-Black treeï¼‰å®ç°ã€‚æ˜ å°„æ ¹æ®å…¶é”®çš„è‡ªç„¶é¡ºåºè¿›è¡Œæ’åºï¼Œæˆ–è€…æ ¹æ®åˆ›å»ºæ˜ å°„æ—¶æä¾›çš„ Comparator è¿›è¡Œæ’åºï¼Œå…·ä½“å–å†³äºä½¿ç”¨çš„æ„é€ æ–¹æ³•ã€‚TreeMapçš„åŸºæœ¬æ“ä½œcontainsKeyã€getã€putã€removeæ–¹æ³•ï¼Œå®ƒçš„æ—¶é—´å¤æ‚åº¦æ˜¯log(N)ã€‚</p>
<p>TreeMapåŒ…å«å‡ ä¸ªé‡è¦çš„æˆå‘˜å˜é‡ï¼šrootã€sizeã€comparatorã€‚å…¶ä¸­rootæ˜¯çº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚å®ƒæ˜¯Entryç±»å‹ï¼ŒEntryæ˜¯çº¢é»‘æ ‘çš„èŠ‚ç‚¹ï¼Œå®ƒåŒ…å«äº†çº¢é»‘æ ‘çš„6ä¸ªåŸºæœ¬ç»„æˆï¼škeyã€valueã€leftã€rightã€parentå’Œcolorã€‚EntryèŠ‚ç‚¹æ ¹æ®æ ¹æ®Keyæ’åºï¼ŒåŒ…å«çš„å†…å®¹æ˜¯valueã€‚Entryä¸­keyæ¯”è¾ƒå¤§å°æ˜¯æ ¹æ®æ¯”è¾ƒå™¨comparatoræ¥è¿›è¡Œåˆ¤æ–­çš„ã€‚sizeæ˜¯çº¢é»‘æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°ã€‚</p>
<h3 id="Mapå’ŒSetæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#Mapå’ŒSetæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="Mapå’ŒSetæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>Mapå’ŒSetæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>Setä»£è¡¨æ— åºçš„ï¼Œå…ƒç´ ä¸å¯é‡å¤çš„é›†åˆï¼›</p>
<p>Mapä»£è¡¨å…·æœ‰æ˜ å°„å…³ç³»ï¼ˆkey-valueï¼‰çš„é›†åˆï¼Œå…¶æ‰€æœ‰çš„keyæ˜¯ä¸€ä¸ªSeté›†åˆï¼Œå³keyæ— åºä¸”ä¸èƒ½é‡å¤ã€‚</p>
<h3 id="Listå’ŒSetæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#Listå’ŒSetæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="Listå’ŒSetæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>Listå’ŒSetæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>Setä»£è¡¨æ— åºçš„ï¼Œå…ƒç´ ä¸å¯é‡å¤çš„é›†åˆï¼›</p>
<p>Listä»£è¡¨æœ‰åºçš„ï¼Œå…ƒç´ å¯ä»¥é‡å¤çš„é›†åˆã€‚</p>
<h3 id="ArrayListå’ŒLinkedListæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#ArrayListå’ŒLinkedListæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="ArrayListå’ŒLinkedListæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>ArrayListå’ŒLinkedListæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><ol>
<li>ArrayListçš„å®ç°æ˜¯åŸºäºæ•°ç»„ï¼ŒLinkedListçš„å®ç°æ˜¯åŸºäºåŒå‘é“¾è¡¨ï¼›</li>
<li>å¯¹äºéšæœºè®¿é—®ArrayListè¦ä¼˜äºLinkedListï¼ŒArrayListå¯ä»¥æ ¹æ®ä¸‹æ ‡ä»¥O(1)æ—¶é—´å¤æ‚åº¦å¯¹å…ƒç´ è¿›è¡Œéšæœºè®¿é—®ï¼Œè€ŒLinkedListçš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä¾é åœ°å€æŒ‡é’ˆå’Œå®ƒåä¸€ä¸ªå…ƒç´ è¿æ¥åœ¨ä¸€èµ·ï¼ŒæŸ¥æ‰¾æŸä¸ªå…ƒç´ çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(N)ï¼›</li>
<li>å¯¹äºæ’å…¥å’Œåˆ é™¤æ“ä½œï¼ŒLinkedListè¦ä¼˜äºArrayListï¼Œå› ä¸ºå½“å…ƒç´ è¢«æ·»åŠ åˆ°LinkedListä»»æ„ä½ç½®çš„æ—¶å€™ï¼Œä¸éœ€è¦åƒArrayListé‚£æ ·é‡æ–°è®¡ç®—å¤§å°æˆ–è€…æ˜¯æ›´æ–°ç´¢å¼•ï¼›</li>
<li>LinkedListæ¯”ArrayListæ›´å å†…å­˜ï¼Œå› ä¸ºLinkedListçš„èŠ‚ç‚¹é™¤äº†å­˜å‚¨æ•°æ®ï¼Œè¿˜å­˜å‚¨äº†ä¸¤ä¸ªå¼•ç”¨ï¼Œä¸€ä¸ªæŒ‡å‘å‰ä¸€ä¸ªå…ƒç´ ï¼Œä¸€ä¸ªæŒ‡å‘åä¸€ä¸ªå…ƒç´ ã€‚</li>
</ol>
<h3 id="æœ‰å“ªäº›çº¿ç¨‹å®‰å…¨çš„Listï¼Ÿ"><a href="#æœ‰å“ªäº›çº¿ç¨‹å®‰å…¨çš„Listï¼Ÿ" class="headerlink" title="æœ‰å“ªäº›çº¿ç¨‹å®‰å…¨çš„Listï¼Ÿ"></a>æœ‰å“ªäº›çº¿ç¨‹å®‰å…¨çš„Listï¼Ÿ</h3><ol>
<li><p>Vector</p>
<p>Vectoræ˜¯æ¯”è¾ƒå¤è€çš„APIï¼Œè™½ç„¶ä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯ç”±äºæ•ˆç‡ä½ä¸€èˆ¬ä¸å»ºè®®ä½¿ç”¨ã€‚</p>
</li>
<li><p>Collections.SynchronizedList</p>
<p>SynchronizedListæ˜¯Collectionsçš„å†…éƒ¨ç±»ï¼ŒCollectionsæä¾›äº†synchronizedListæ–¹æ³•ï¼Œå¯ä»¥å°†ä¸€ä¸ªçº¿ç¨‹ä¸å®‰å…¨çš„ListåŒ…è£…æˆçº¿ç¨‹å®‰å…¨çš„Listï¼Œå³SynchronizedListã€‚å®ƒæ¯”Vectoræœ‰æ›´å¥½çš„æ‰©å±•æ€§å’Œå…¼å®¹æ€§ï¼Œä½†æ˜¯å®ƒæ‰€æœ‰çš„æ–¹æ³•éƒ½å¸¦æœ‰åŒæ­¥é”ï¼Œä¹Ÿä¸æ˜¯æ€§èƒ½æœ€ä¼˜çš„Listã€‚</p>
</li>
<li><p>CopyOnWriteArrayList</p>
<p>CopyOnWriteArrayListæ˜¯Java 1.5åœ¨java.util.concurrentåŒ…ä¸‹å¢åŠ çš„ç±»ï¼Œå®ƒé‡‡ç”¨å¤åˆ¶åº•å±‚æ•°ç»„çš„æ–¹å¼æ¥å®ç°å†™æ“ä½œã€‚å½“çº¿ç¨‹å¯¹æ­¤ç±»é›†åˆæ‰§è¡Œè¯»å–æ“ä½œæ—¶ï¼Œçº¿ç¨‹å°†ä¼šç›´æ¥è¯»å–é›†åˆæœ¬èº«ï¼Œæ— é¡»åŠ é”ä¸é˜»å¡ã€‚å½“çº¿ç¨‹å¯¹æ­¤ç±»é›†åˆæ‰§è¡Œå†™å…¥æ“ä½œæ—¶ï¼Œé›†åˆä¼šåœ¨åº•å±‚å¤åˆ¶ä¸€ä»½æ–°çš„æ•°ç»„ï¼Œæ¥ä¸‹æ¥å¯¹æ–°çš„æ•°ç»„æ‰§è¡Œå†™å…¥æ“ä½œã€‚ç”±äºå¯¹é›†åˆçš„å†™å…¥æ“ä½œéƒ½æ˜¯å¯¹æ•°ç»„çš„å‰¯æœ¬æ‰§è¡Œæ“ä½œï¼Œå› æ­¤å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åœ¨æ‰€æœ‰çº¿ç¨‹å®‰å…¨çš„Listä¸­ï¼Œå®ƒæ˜¯æ€§èƒ½æœ€ä¼˜çš„æ–¹æ¡ˆã€‚</p>
</li>
</ol>
<h3 id="ä»‹ç»ä¸€ä¸‹ArrayListçš„æ•°æ®ç»“æ„ï¼Ÿ"><a href="#ä»‹ç»ä¸€ä¸‹ArrayListçš„æ•°æ®ç»“æ„ï¼Ÿ" class="headerlink" title="ä»‹ç»ä¸€ä¸‹ArrayListçš„æ•°æ®ç»“æ„ï¼Ÿ"></a>ä»‹ç»ä¸€ä¸‹ArrayListçš„æ•°æ®ç»“æ„ï¼Ÿ</h3><p>ArrayListçš„åº•å±‚æ˜¯ç”¨æ•°ç»„æ¥å®ç°çš„ï¼Œé»˜è®¤ç¬¬ä¸€æ¬¡æ’å…¥å…ƒç´ æ—¶åˆ›å»ºå¤§å°ä¸º10çš„æ•°ç»„ï¼Œè¶…å‡ºé™åˆ¶æ—¶ä¼šå¢åŠ 50%çš„å®¹é‡ï¼Œå¹¶ä¸”æ•°æ®ä»¥ System.arraycopy() å¤åˆ¶åˆ°æ–°çš„æ•°ç»„ï¼Œå› æ­¤æœ€å¥½èƒ½ç»™å‡ºæ•°ç»„å¤§å°çš„é¢„ä¼°å€¼ã€‚</p>
<p>æŒ‰æ•°ç»„ä¸‹æ ‡è®¿é—®å…ƒç´ çš„æ€§èƒ½å¾ˆé«˜ï¼Œè¿™æ˜¯æ•°ç»„çš„åŸºæœ¬ä¼˜åŠ¿ã€‚ç›´æ¥åœ¨æ•°ç»„æœ«å°¾åŠ å…¥å…ƒç´ çš„æ€§èƒ½ä¹Ÿé«˜ï¼Œä½†å¦‚æœæŒ‰ä¸‹æ ‡æ’å…¥ã€åˆ é™¤å…ƒç´ ï¼Œåˆ™è¦ç”¨ System.arraycopy() æ¥ç§»åŠ¨éƒ¨åˆ†å—å½±å“çš„å…ƒç´ ï¼Œæ€§èƒ½å°±å˜å·®äº†ï¼Œè¿™æ˜¯åŸºæœ¬åŠ£åŠ¿ã€‚</p>
<h3 id="è°ˆè°ˆCopyOnWriteArrayListçš„åŸç†"><a href="#è°ˆè°ˆCopyOnWriteArrayListçš„åŸç†" class="headerlink" title="è°ˆè°ˆCopyOnWriteArrayListçš„åŸç†"></a>è°ˆè°ˆCopyOnWriteArrayListçš„åŸç†</h3><p>CopyOnWriteArrayListæ˜¯Javaå¹¶å‘åŒ…é‡Œæä¾›çš„å¹¶å‘ç±»ï¼Œç®€å•æ¥è¯´å®ƒå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨ä¸”è¯»æ“ä½œæ— é”çš„ArrayListã€‚æ­£å¦‚å…¶åå­—ä¸€æ ·ï¼Œåœ¨å†™æ“ä½œæ—¶ä¼šå¤åˆ¶ä¸€ä»½æ–°çš„Listï¼Œåœ¨æ–°çš„Listä¸Šå®Œæˆå†™æ“ä½œï¼Œç„¶åå†å°†åŸå¼•ç”¨æŒ‡å‘æ–°çš„Listã€‚è¿™æ ·å°±ä¿è¯äº†å†™æ“ä½œçš„çº¿ç¨‹å®‰å…¨ã€‚</p>
<p>CopyOnWriteArrayListå…è®¸çº¿ç¨‹å¹¶å‘è®¿é—®è¯»æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™æ˜¯æ²¡æœ‰åŠ é”é™åˆ¶çš„ï¼Œæ€§èƒ½è¾ƒé«˜ã€‚è€Œå†™æ“ä½œçš„æ—¶å€™ï¼Œåˆ™é¦–å…ˆå°†å®¹å™¨å¤åˆ¶ä¸€ä»½ï¼Œç„¶ååœ¨æ–°çš„å‰¯æœ¬ä¸Šæ‰§è¡Œå†™æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™å†™æ“ä½œæ˜¯ä¸Šé”çš„ã€‚ç»“æŸä¹‹åå†å°†åŸå®¹å™¨çš„å¼•ç”¨æŒ‡å‘æ–°å®¹å™¨ã€‚æ³¨æ„ï¼Œåœ¨ä¸Šé”æ‰§è¡Œå†™æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰éœ€è¦è¯»æ“ä½œï¼Œä¼šä½œç”¨åœ¨åŸå®¹å™¨ä¸Šã€‚å› æ­¤ä¸Šé”çš„å†™æ“ä½œä¸ä¼šå½±å“åˆ°å¹¶å‘è®¿é—®çš„è¯»æ“ä½œã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼šè¯»æ“ä½œæ€§èƒ½å¾ˆé«˜ï¼Œå› ä¸ºæ— éœ€ä»»ä½•åŒæ­¥æªæ–½ï¼Œæ¯”è¾ƒé€‚ç”¨äºè¯»å¤šå†™å°‘çš„å¹¶å‘åœºæ™¯ã€‚åœ¨éå†ä¼ ç»Ÿçš„Listæ—¶ï¼Œè‹¥ä¸­é€”æœ‰åˆ«çš„çº¿ç¨‹å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œåˆ™ä¼šæŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ã€‚è€ŒCopyOnWriteArrayListç”±äºå…¶â€è¯»å†™åˆ†ç¦»â€çš„æ€æƒ³ï¼Œéå†å’Œä¿®æ”¹æ“ä½œåˆ†åˆ«ä½œç”¨åœ¨ä¸åŒçš„Listå®¹å™¨ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨è¿­ä»£å™¨è¿›è¡Œéå†æ—¶å€™ï¼Œä¹Ÿå°±ä¸ä¼šæŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸äº†ã€‚</li>
<li>ç¼ºç‚¹ï¼šä¸€æ˜¯å†…å­˜å ç”¨é—®é¢˜ï¼Œæ¯•ç«Ÿæ¯æ¬¡æ‰§è¡Œå†™æ“ä½œéƒ½è¦å°†åŸå®¹å™¨æ‹·è´ä¸€ä»½ï¼Œæ•°æ®é‡å¤§æ—¶ï¼Œå¯¹å†…å­˜å‹åŠ›è¾ƒå¤§ï¼Œå¯èƒ½ä¼šå¼•èµ·é¢‘ç¹GCã€‚äºŒæ˜¯æ— æ³•ä¿è¯å®æ—¶æ€§ï¼ŒVectorå¯¹äºè¯»å†™æ“ä½œå‡åŠ é”åŒæ­¥ï¼Œå¯ä»¥ä¿è¯è¯»å’Œå†™çš„å¼ºä¸€è‡´æ€§ã€‚è€ŒCopyOnWriteArrayListç”±äºå…¶å®ç°ç­–ç•¥çš„åŸå› ï¼Œå†™å’Œè¯»åˆ†åˆ«ä½œç”¨åœ¨æ–°è€ä¸åŒå®¹å™¨ä¸Šï¼Œåœ¨å†™æ“ä½œæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¯»ä¸ä¼šé˜»å¡ä½†è¯»å–åˆ°çš„å´æ˜¯è€å®¹å™¨çš„æ•°æ®ã€‚</li>
</ul>
<h3 id="è¯´ä¸€è¯´TreeSetå’ŒHashSetçš„åŒºåˆ«"><a href="#è¯´ä¸€è¯´TreeSetå’ŒHashSetçš„åŒºåˆ«" class="headerlink" title="è¯´ä¸€è¯´TreeSetå’ŒHashSetçš„åŒºåˆ«"></a>è¯´ä¸€è¯´TreeSetå’ŒHashSetçš„åŒºåˆ«</h3><p>HashSetã€TreeSetä¸­çš„å…ƒç´ éƒ½æ˜¯ä¸èƒ½é‡å¤çš„ï¼Œå¹¶ä¸”å®ƒä»¬éƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼ŒäºŒè€…çš„åŒºåˆ«æ˜¯ï¼š</p>
<ol>
<li>HashSetä¸­çš„å…ƒç´ å¯ä»¥æ˜¯nullï¼Œä½†TreeSetä¸­çš„å…ƒç´ ä¸èƒ½æ˜¯nullï¼›</li>
<li>HashSetä¸èƒ½ä¿è¯å…ƒç´ çš„æ’åˆ—é¡ºåºï¼Œè€ŒTreeSetæ”¯æŒè‡ªç„¶æ’åºã€å®šåˆ¶æ’åºä¸¤ç§æ’åºçš„æ–¹å¼ï¼›</li>
<li>HashSetåº•å±‚æ˜¯é‡‡ç”¨å“ˆå¸Œè¡¨å®ç°çš„ï¼Œè€ŒTreeSetåº•å±‚æ˜¯é‡‡ç”¨çº¢é»‘æ ‘å®ç°çš„ã€‚</li>
</ol>
<h3 id="è¯´ä¸€è¯´HashSetçš„åº•å±‚ç»“æ„"><a href="#è¯´ä¸€è¯´HashSetçš„åº•å±‚ç»“æ„" class="headerlink" title="è¯´ä¸€è¯´HashSetçš„åº•å±‚ç»“æ„"></a>è¯´ä¸€è¯´HashSetçš„åº•å±‚ç»“æ„</h3><p>HashSetæ˜¯åŸºäºHashMapå®ç°çš„ï¼Œé»˜è®¤æ„é€ å‡½æ•°æ˜¯æ„å»ºä¸€ä¸ªåˆå§‹å®¹é‡ä¸º16ï¼Œè´Ÿè½½å› å­ä¸º0.75 çš„HashMapã€‚å®ƒå°è£…äº†ä¸€ä¸ª HashMap å¯¹è±¡æ¥å­˜å‚¨æ‰€æœ‰çš„é›†åˆå…ƒç´ ï¼Œæ‰€æœ‰æ”¾å…¥ HashSet ä¸­çš„é›†åˆå…ƒç´ å®é™…ä¸Šç”± HashMap çš„ key æ¥ä¿å­˜ï¼Œè€Œ HashMap çš„ value åˆ™å­˜å‚¨äº†ä¸€ä¸ª PRESENTï¼Œå®ƒæ˜¯ä¸€ä¸ªé™æ€çš„ Object å¯¹è±¡ã€‚</p>
<h3 id="BlockingQueueä¸­æœ‰å“ªäº›æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ"><a href="#BlockingQueueä¸­æœ‰å“ªäº›æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ" class="headerlink" title="BlockingQueueä¸­æœ‰å“ªäº›æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ"></a>BlockingQueueä¸­æœ‰å“ªäº›æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ</h3><p>ä¸ºäº†åº”å¯¹ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼ŒBlockingQueue æä¾›äº†4 ç»„ä¸åŒçš„æ–¹æ³•ç”¨äºæ’å…¥ã€ç§»é™¤ä»¥åŠå¯¹é˜Ÿåˆ—ä¸­çš„å…ƒç´ è¿›è¡Œæ£€æŸ¥ã€‚å¦‚æœè¯·æ±‚çš„æ“ä½œä¸èƒ½å¾—åˆ°ç«‹å³æ‰§è¡Œçš„è¯ï¼Œæ¯ç»„æ–¹æ³•çš„è¡¨ç°æ˜¯ä¸åŒçš„ã€‚è¿™äº›æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">æŠ›å¼‚å¸¸</th>
<th align="left">ç‰¹å®šå€¼</th>
<th align="left">é˜»å¡</th>
<th align="left">è¶…æ—¶</th>
</tr>
</thead>
<tbody><tr>
<td align="left">æ’å…¥</td>
<td align="left">add(e)</td>
<td align="left">offer(e)</td>
<td align="left">put(e)</td>
<td align="left">offer(e, time, unit)</td>
</tr>
<tr>
<td align="left">ç§»é™¤</td>
<td align="left">remove()</td>
<td align="left">poll()</td>
<td align="left">take()</td>
<td align="left">poll(time, unit)</td>
</tr>
<tr>
<td align="left">æ£€æŸ¥</td>
<td align="left">element()</td>
<td align="left">peek()</td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<p>å››ç»„ä¸åŒçš„è¡Œä¸ºæ–¹å¼å«ä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>æŠ›å¼‚å¸¸ï¼šå¦‚æœæ“ä½œæ— æ³•ç«‹å³æ‰§è¡Œï¼Œåˆ™æŠ›ä¸€ä¸ªå¼‚å¸¸ï¼›</li>
<li>ç‰¹å®šå€¼ï¼šå¦‚æœæ“ä½œæ— æ³•ç«‹å³æ‰§è¡Œï¼Œåˆ™è¿”å›ä¸€ä¸ªç‰¹å®šçš„å€¼(ä¸€èˆ¬æ˜¯ true / false)ã€‚</li>
<li>é˜»å¡ï¼šå¦‚æœæ“ä½œæ— æ³•ç«‹å³æ‰§è¡Œï¼Œåˆ™è¯¥æ–¹æ³•è°ƒç”¨å°†ä¼šå‘ç”Ÿé˜»å¡ï¼Œç›´åˆ°èƒ½å¤Ÿæ‰§è¡Œï¼›</li>
<li>è¶…æ—¶ï¼šå¦‚æœæ“ä½œæ— æ³•ç«‹å³æ‰§è¡Œï¼Œåˆ™è¯¥æ–¹æ³•è°ƒç”¨å°†ä¼šå‘ç”Ÿé˜»å¡ï¼Œç›´åˆ°èƒ½å¤Ÿæ‰§è¡Œã€‚ä½†ç­‰å¾…æ—¶é—´ä¸ä¼šè¶…è¿‡ç»™å®šå€¼ï¼Œå¹¶è¿”å›ä¸€ä¸ªç‰¹å®šå€¼ä»¥å‘ŠçŸ¥è¯¥æ“ä½œæ˜¯å¦æˆåŠŸ(å…¸å‹çš„æ˜¯true / false)ã€‚</li>
</ul>
<h3 id="BlockingQueueæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#BlockingQueueæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="BlockingQueueæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"></a>BlockingQueueæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</h3><p>BlockingQueueæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒçš„å®ç°ç±»æœ‰ArrayBlockingQueueã€DelayQueueã€ LinkedBlockingQueueã€PriorityBlockingQueueã€SynchronousQueueç­‰ã€‚å®ƒä»¬çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨å­˜å‚¨ç»“æ„ä¸Šæˆ–å¯¹å…ƒç´ æ“ä½œä¸Šçš„ä¸åŒï¼Œä½†æ˜¯å¯¹äºputä¸takeæ“ä½œçš„åŸç†æ˜¯ç±»ä¼¼çš„ã€‚ä¸‹é¢ä»¥ArrayBlockingQueueä¸ºä¾‹ï¼Œæ¥è¯´æ˜BlockingQueueçš„å®ç°åŸç†ã€‚</p>
<p>é¦–å…ˆçœ‹ä¸€ä¸‹ArrayBlockingQueueçš„æ„é€ å‡½æ•°ï¼Œå®ƒåˆå§‹åŒ–äº†putå’Œtakeå‡½æ•°ä¸­ç”¨åˆ°çš„å…³é”®æˆå‘˜å˜é‡ï¼Œè¿™ä¸¤ä¸ªå˜é‡çš„ç±»å‹åˆ†åˆ«æ˜¯ReentrantLockå’ŒConditionã€‚ReentrantLockæ˜¯AbstractQueuedSynchronizerï¼ˆAQSï¼‰çš„å­ç±»ï¼Œå®ƒçš„newConditionå‡½æ•°è¿”å›çš„Conditionå®ä¾‹ï¼Œæ˜¯å®šä¹‰åœ¨AQSç±»å†…éƒ¨çš„ConditionObjectç±»ï¼Œè¯¥ç±»å¯ä»¥ç›´æ¥è°ƒç”¨AQSç›¸å…³çš„å‡½æ•°ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayBlockingQueue</span><span class="params">(<span class="type">int</span> capacity, <span class="type">boolean</span> fair)</span> {     </span><br><span class="line">    <span class="keyword">if</span> (capacity &lt;= <span class="number">0</span>)       </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();   </span><br><span class="line">    <span class="built_in">this</span>.items = <span class="keyword">new</span> <span class="title class_">Object</span>[capacity]; </span><br><span class="line">    lock = <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>(fair); </span><br><span class="line">    notEmpty = lock.newCondition();  </span><br><span class="line">    notFull = lock.newCondition();  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>putå‡½æ•°ä¼šåœ¨é˜Ÿåˆ—æœ«å°¾æ·»åŠ å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—å·²ç»æ»¡äº†ï¼Œæ— æ³•æ·»åŠ å…ƒç´ çš„è¯ï¼Œå°±ä¸€ç›´é˜»å¡ç­‰å¾…åˆ°å¯ä»¥åŠ å…¥ä¸ºæ­¢ã€‚å‡½æ•°çš„æºç å¦‚ä¸‹æ‰€ç¤ºã€‚æˆ‘ä»¬ä¼šå‘ç°putå‡½æ•°ä½¿ç”¨äº†wait/notifyçš„æœºåˆ¶ã€‚ä¸ä¸€èˆ¬ç”Ÿäº§è€…-æ¶ˆè´¹è€…çš„å®ç°æ–¹å¼ä¸åŒï¼ŒåŒæ­¥é˜Ÿåˆ—ä½¿ç”¨ReentrantLockå’ŒConditionç›¸ç»“åˆçš„æœºåˆ¶ï¼Œå³å…ˆè·å¾—é”ï¼Œå†ç­‰å¾…ï¼Œè€Œä¸æ˜¯synchronizedå’Œwaitçš„æœºåˆ¶ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(E e)</span> <span class="keyword">throws</span> InterruptedException {  </span><br><span class="line">    checkNotNull(e);     </span><br><span class="line">    <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="built_in">this</span>.lock;  </span><br><span class="line">    lock.lockInterruptibly();    </span><br><span class="line">    <span class="keyword">try</span> {        </span><br><span class="line">        <span class="keyword">while</span> (count == items.length)     </span><br><span class="line">            notFull.await();   </span><br><span class="line">        enqueue(e);    </span><br><span class="line">    } <span class="keyword">finally</span> {  </span><br><span class="line">        lock.unlock(); </span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å†æ¥çœ‹ä¸€ä¸‹æ¶ˆè´¹è€…è°ƒç”¨çš„takeå‡½æ•°ï¼Œtakeå‡½æ•°åœ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶ä¼šè¢«é˜»å¡ï¼Œä¸€ç›´åˆ°é˜»å¡é˜Ÿåˆ—åŠ å…¥äº†æ–°çš„å…ƒç´ ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">take</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException {  </span><br><span class="line">    <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="built_in">this</span>.lock;      </span><br><span class="line">    lock.lockInterruptibly();   </span><br><span class="line">    <span class="keyword">try</span> {       </span><br><span class="line">        <span class="keyword">while</span> (count == <span class="number">0</span>)      </span><br><span class="line">            notEmpty.await(); </span><br><span class="line">        <span class="keyword">return</span> dequeue();  </span><br><span class="line">    } <span class="keyword">finally</span> {    </span><br><span class="line">        lock.unlock();  </span><br><span class="line">    } </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>æ‰©å±•é˜…è¯»</strong></p>
<p>awaitæ“ä½œï¼š</p>
<p>æˆ‘ä»¬å‘ç°ArrayBlockingQueueå¹¶æ²¡æœ‰ä½¿ç”¨Object.waitï¼Œè€Œæ˜¯ä½¿ç”¨çš„Condition.awaitï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼ŸConditionå¯¹è±¡å¯ä»¥æä¾›å’ŒObjectçš„waitå’Œnotifyä¸€æ ·çš„è¡Œä¸ºï¼Œä½†æ˜¯åè€…å¿…é¡»å…ˆè·å–synchronizedè¿™ä¸ªå†…ç½®çš„monitoré”æ‰èƒ½è°ƒç”¨ï¼Œè€ŒConditionåˆ™å¿…é¡»å…ˆè·å–ReentrantLockã€‚è¿™ä¸¤ç§æ–¹å¼åœ¨é˜»å¡ç­‰å¾…æ—¶éƒ½ä¼šå°†ç›¸åº”çš„é”é‡Šæ”¾æ‰ï¼Œä½†æ˜¯Conditionçš„ç­‰å¾…å¯ä»¥ä¸­æ–­ï¼Œè¿™æ˜¯äºŒè€…å”¯ä¸€çš„åŒºåˆ«ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹Conditionçš„awaitå‡½æ•°ï¼Œawaitå‡½æ•°çš„æµç¨‹å¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚awaitå‡½æ•°ä¸»è¦æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼Œä¸€æ˜¯è°ƒç”¨addConditionWaiterå‡½æ•°ï¼Œåœ¨condition wait queueé˜Ÿåˆ—ä¸­æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»£è¡¨å½“å‰çº¿ç¨‹åœ¨ç­‰å¾…ä¸€ä¸ªæ¶ˆæ¯ã€‚ç„¶åè°ƒç”¨fullyReleaseå‡½æ•°ï¼Œå°†æŒæœ‰çš„é”é‡Šæ”¾æ‰ï¼Œè°ƒç”¨çš„æ˜¯AQSçš„å‡½æ•°ã€‚æœ€åä¸€ç›´è°ƒç”¨isOnSyncQueueå‡½æ•°åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦è¢«è½¬ç§»åˆ°sync queueé˜Ÿåˆ—ä¸Šï¼Œä¹Ÿå°±æ˜¯AQSä¸­ç­‰å¾…è·å–é”çš„é˜Ÿåˆ—ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå¦‚æœå·²ç»åœ¨é˜Ÿåˆ—ä¸Šï¼Œåˆ™è°ƒç”¨acquireQueuedå‡½æ•°é‡æ–°è·å–é”ã€‚</p>
<p><img src="/p/3818800b/37DE256DECC211F4D5230BF7A654E128.png" alt="img"></p>
<p>signalæ“ä½œï¼š</p>
<p>signalå‡½æ•°å°†condition wait queueé˜Ÿåˆ—ä¸­é˜Ÿé¦–çš„çº¿ç¨‹èŠ‚ç‚¹è½¬ç§»ç­‰å¾…è·å–é”çš„sync queueé˜Ÿåˆ—ä¸­ã€‚è¿™æ ·çš„è¯ï¼Œawaitå‡½æ•°ä¸­è°ƒç”¨isOnSyncQueueå‡½æ•°å°±ä¼šè¿”å›trueï¼Œå¯¼è‡´awaitå‡½æ•°è¿›å…¥æœ€åä¸€æ­¥é‡æ–°è·å–é”çš„çŠ¶æ€ã€‚</p>
<p>æˆ‘ä»¬è¿™é‡Œæ¥è¯¦ç»†è§£æä¸€ä¸‹condition wait queueå’Œsync queueä¸¤ä¸ªé˜Ÿåˆ—çš„è®¾è®¡åŸç†ã€‚condition wait queueæ˜¯ç­‰å¾…æ¶ˆæ¯çš„é˜Ÿåˆ—ï¼Œå› ä¸ºé˜»å¡é˜Ÿåˆ—ä¸ºç©ºè€Œè¿›å…¥é˜»å¡çŠ¶æ€çš„takeå‡½æ•°æ“ä½œå°±æ˜¯åœ¨ç­‰å¾…é˜»å¡é˜Ÿåˆ—ä¸ä¸ºç©ºçš„æ¶ˆæ¯ã€‚è€Œsync queueé˜Ÿåˆ—åˆ™æ˜¯ç­‰å¾…è·å–é”çš„é˜Ÿåˆ—ï¼Œtakeå‡½æ•°è·å¾—äº†æ¶ˆæ¯ï¼Œå°±å¯ä»¥è¿è¡Œäº†ï¼Œä½†æ˜¯å®ƒè¿˜å¿…é¡»ç­‰å¾…è·å–é”ä¹‹åæ‰èƒ½çœŸæ­£è¿›è¡Œè¿è¡ŒçŠ¶æ€ã€‚</p>
<p>signalå‡½æ•°å…¶å®å°±åšäº†ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯ä¸æ–­å°è¯•è°ƒç”¨transferForSignalå‡½æ•°ï¼Œå°†condition wait queueé˜Ÿé¦–çš„ä¸€ä¸ªèŠ‚ç‚¹è½¬ç§»åˆ°sync queueé˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°è½¬ç§»æˆåŠŸã€‚å› ä¸ºä¸€æ¬¡è½¬ç§»æˆåŠŸï¼Œå°±ä»£è¡¨è¿™ä¸ªæ¶ˆæ¯è¢«æˆåŠŸé€šçŸ¥åˆ°äº†ç­‰å¾…æ¶ˆæ¯çš„èŠ‚ç‚¹ã€‚</p>
<p>signalå‡½æ•°çš„ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><img src="/p/3818800b/61A52D5795794D763D6F8D37D13AFE07.png" alt="img"></p>
<h3 id="Streamï¼ˆä¸æ˜¯IOStreamï¼‰æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ"><a href="#Streamï¼ˆä¸æ˜¯IOStreamï¼‰æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ" class="headerlink" title="Streamï¼ˆä¸æ˜¯IOStreamï¼‰æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ"></a>Streamï¼ˆä¸æ˜¯IOStreamï¼‰æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ</h3><p>Streamæä¾›äº†å¤§é‡çš„æ–¹æ³•è¿›è¡Œèšé›†æ“ä½œï¼Œè¿™äº›æ–¹æ³•æ—¢å¯ä»¥æ˜¯â€œä¸­é—´çš„â€ï¼Œä¹Ÿå¯ä»¥æ˜¯â€œæœ«ç«¯çš„â€ã€‚</p>
<ul>
<li>ä¸­é—´æ–¹æ³•ï¼šä¸­é—´æ“ä½œå…è®¸æµä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œå¹¶å…è®¸ç›´æ¥è°ƒç”¨åç»­æ–¹æ³•ã€‚ä¸Šé¢ç¨‹åºä¸­çš„map()æ–¹æ³•å°±æ˜¯ä¸­é—´æ–¹æ³•ã€‚ä¸­é—´æ–¹æ³•çš„è¿”å›å€¼æ˜¯å¦å¤–ä¸€ä¸ªæµã€‚</li>
<li>æœ«ç«¯æ–¹æ³•ï¼šæœ«ç«¯æ–¹æ³•æ˜¯å¯¹æµçš„æœ€ç»ˆæ“ä½œã€‚å½“å¯¹æŸä¸ªStreamæ‰§è¡Œæœ«ç«¯æ–¹æ³•åï¼Œè¯¥æµå°†ä¼šè¢«â€œæ¶ˆè€—â€ä¸”ä¸å†å¯ç”¨ã€‚ä¸Šé¢ç¨‹åºä¸­çš„sum()ã€count()ã€average()ç­‰æ–¹æ³•éƒ½æ˜¯æœ«ç«¯æ–¹æ³•ã€‚</li>
</ul>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œå…³äºæµçš„æ–¹æ³•è¿˜æœ‰å¦‚ä¸‹ä¸¤ä¸ªç‰¹å¾ï¼š</p>
<ul>
<li>æœ‰çŠ¶æ€çš„æ–¹æ³•ï¼šè¿™ç§æ–¹æ³•ä¼šç»™æµå¢åŠ ä¸€äº›æ–°çš„å±æ€§ï¼Œæ¯”å¦‚å…ƒç´ çš„å”¯ä¸€æ€§ã€å…ƒç´ çš„æœ€å¤§æ•°é‡ã€ä¿è¯å…ƒç´ ä»¥æ’åºçš„æ–¹å¼è¢«å¤„ç†ç­‰ã€‚æœ‰çŠ¶æ€çš„æ–¹æ³•å¾€å¾€éœ€è¦æ›´å¤§çš„æ€§èƒ½å¼€é”€ã€‚</li>
<li>çŸ­è·¯æ–¹æ³•ï¼šçŸ­è·¯æ–¹æ³•å¯ä»¥å°½æ—©ç»“æŸå¯¹æµçš„æ“ä½œï¼Œä¸å¿…æ£€æŸ¥æ‰€æœ‰çš„å…ƒç´ ã€‚</li>
</ul>
<p>ä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹Streamå¸¸ç”¨çš„ä¸­é—´æ–¹æ³•ï¼š</p>
<ul>
<li>filter(Predicate predicate)ï¼šè¿‡æ»¤Streamä¸­æ‰€æœ‰ä¸ç¬¦åˆpredicateçš„å…ƒç´ ã€‚</li>
<li>mapToXxx(ToXxxFunction mapper)ï¼šä½¿ç”¨ToXxxFunctionå¯¹æµä¸­çš„å…ƒç´ æ‰§è¡Œä¸€å¯¹ä¸€çš„è½¬æ¢ï¼Œè¯¥æ–¹æ³•è¿”å›çš„æ–°æµä¸­åŒ…å«äº†ToXxxFunctionè½¬æ¢ç”Ÿæˆçš„æ‰€æœ‰å…ƒç´ ã€‚</li>
<li>peek(Consumer action)ï¼šä¾æ¬¡å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œä¸€äº›æ“ä½œï¼Œè¯¥æ–¹æ³•è¿”å›çš„æµä¸åŸæœ‰æµåŒ…å«ç›¸åŒçš„å…ƒç´ ã€‚è¯¥æ–¹æ³•ä¸»è¦ç”¨äºè°ƒè¯•ã€‚</li>
<li>distinct()ï¼šè¯¥æ–¹æ³•ç”¨äºæ’åºæµä¸­æ‰€æœ‰é‡å¤çš„å…ƒç´ ï¼ˆåˆ¤æ–­å…ƒç´ é‡å¤çš„æ ‡å‡†æ˜¯ä½¿ç”¨equals()æ¯”è¾ƒè¿”å›trueï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„æ–¹æ³•ã€‚</li>
<li>sorted()ï¼šè¯¥æ–¹æ³•ç”¨äºä¿è¯æµä¸­çš„å…ƒç´ åœ¨åç»­çš„è®¿é—®ä¸­å¤„äºæœ‰åºçŠ¶æ€ã€‚è¿™æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„æ–¹æ³•ã€‚</li>
<li>limit(long maxSize)ï¼šè¯¥æ–¹æ³•ç”¨äºä¿è¯å¯¹è¯¥æµçš„åç»­è®¿é—®ä¸­æœ€å¤§å…è®¸è®¿é—®çš„å…ƒç´ ä¸ªæ•°ã€‚è¿™æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„ã€çŸ­è·¯æ–¹æ³•ã€‚</li>
</ul>
<p>ä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹Streamå¸¸ç”¨çš„æœ«ç«¯æ–¹æ³•ï¼š</p>
<ul>
<li>forEach(Consumer action)ï¼šéå†æµä¸­æ‰€æœ‰å…ƒç´ ï¼Œå¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œactionã€‚</li>
<li>toArray()ï¼šå°†æµä¸­æ‰€æœ‰å…ƒç´ è½¬æ¢ä¸ºä¸€ä¸ªæ•°ç»„ã€‚</li>
<li>reduce()ï¼šè¯¥æ–¹æ³•æœ‰ä¸‰ä¸ªé‡è½½çš„ç‰ˆæœ¬ï¼Œéƒ½ç”¨äºé€šè¿‡æŸç§æ“ä½œæ¥åˆå¹¶æµä¸­çš„å…ƒç´ ã€‚</li>
<li>min()ï¼šè¿”å›æµä¸­æ‰€æœ‰å…ƒç´ çš„æœ€å°å€¼ã€‚</li>
<li>max()ï¼šè¿”å›æµä¸­æ‰€æœ‰å…ƒç´ çš„æœ€å¤§å€¼ã€‚</li>
<li>count()ï¼šè¿”å›æµä¸­æ‰€æœ‰å…ƒç´ çš„æ•°é‡ã€‚</li>
<li>anyMatch(Predicate predicate)ï¼šåˆ¤æ–­æµä¸­æ˜¯å¦è‡³å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ç¬¦åˆPredicateæ¡ä»¶ã€‚</li>
<li>noneMatch(Predicate predicate)ï¼šåˆ¤æ–­æµä¸­æ˜¯å¦æ‰€æœ‰å…ƒç´ éƒ½ä¸ç¬¦åˆPredicateæ¡ä»¶ã€‚</li>
<li>findFirst()ï¼šè¿”å›æµä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</li>
<li>findAny()ï¼šè¿”å›æµä¸­çš„ä»»æ„ä¸€ä¸ªå…ƒç´ ã€‚</li>
</ul>
<p>é™¤æ­¤ä¹‹å¤–ï¼ŒJava 8å…è®¸ä½¿ç”¨æµå¼APIæ¥æ“ä½œé›†åˆï¼ŒCollectionæ¥å£æä¾›äº†ä¸€ä¸ªstream()é»˜è®¤æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯è¿”å›è¯¥é›†åˆå¯¹åº”çš„æµï¼Œæ¥ä¸‹æ¥å³å¯é€šè¿‡æµå¼APIæ¥æ“ä½œé›†åˆå…ƒç´ ã€‚ç”±äºStreamå¯ä»¥å¯¹é›†åˆå…ƒç´ è¿›è¡Œæ•´ä½“çš„èšé›†æ“ä½œï¼Œå› æ­¤Streamæå¤§åœ°ä¸°å¯Œäº†é›†åˆçš„åŠŸèƒ½ã€‚</p>
<p><strong>æ‰©å±•é˜…è¯»</strong></p>
<p>Java 8æ–°å¢äº†Streamã€IntStreamã€LongStreamã€DoubleStreamç­‰æµå¼APIï¼Œè¿™äº›APIä»£è¡¨å¤šä¸ªæ”¯æŒä¸²è¡Œå’Œå¹¶è¡Œèšé›†æ“ä½œçš„å…ƒç´ ã€‚ä¸Šé¢4ä¸ªæ¥å£ä¸­ï¼ŒStreamæ˜¯ä¸€ä¸ªé€šç”¨çš„æµæ¥å£ï¼Œè€ŒIntStreamã€LongStreamã€DoubleStreamåˆ™ä»£è¡¨å…ƒç´ ç±»å‹ä¸ºintã€longã€doubleçš„æµã€‚</p>
<p>Java 8è¿˜ä¸ºä¸Šé¢æ¯ä¸ªæµå¼APIæä¾›äº†å¯¹åº”çš„Builderï¼Œä¾‹å¦‚Stream.Builderã€IntStream.Builderã€LongStream.Builderã€DoubleStream.Builderï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡è¿™äº›Builderæ¥åˆ›å»ºå¯¹åº”çš„æµã€‚</p>
<p>ç‹¬ç«‹ä½¿ç”¨Streamçš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä½¿ç”¨Streamæˆ–XxxStreamçš„builder()ç±»æ–¹æ³•åˆ›å»ºè¯¥Streamå¯¹åº”çš„Builderã€‚</li>
<li>é‡å¤è°ƒç”¨Builderçš„add()æ–¹æ³•å‘è¯¥æµä¸­æ·»åŠ å¤šä¸ªå…ƒç´ ã€‚</li>
<li>è°ƒç”¨Builderçš„build()æ–¹æ³•è·å–å¯¹åº”çš„Streamã€‚</li>
<li>è°ƒç”¨Streamçš„èšé›†æ–¹æ³•ã€‚</li>
</ol>
<p>åœ¨ä¸Šé¢4ä¸ªæ­¥éª¤ä¸­ï¼Œç¬¬4æ­¥å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚æ¥è°ƒç”¨ä¸åŒçš„æ–¹æ³•ï¼ŒStreamæä¾›äº†å¤§é‡çš„èšé›†æ–¹æ³•ä¾›ç”¨æˆ·è°ƒç”¨ï¼Œå…·ä½“å¯å‚è€ƒStreamæˆ–XxxStreamçš„APIæ–‡æ¡£ã€‚å¯¹äºå¤§éƒ¨åˆ†èšé›†æ–¹æ³•è€Œè¨€ï¼Œæ¯ä¸ªStreamåªèƒ½æ‰§è¡Œä¸€æ¬¡ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>HashMap</title>
    <url>/p/9da5e46.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="å¤ä¹ é¢„çƒ­"><a href="#å¤ä¹ é¢„çƒ­" class="headerlink" title="å¤ä¹ é¢„çƒ­"></a>å¤ä¹ é¢„çƒ­</h2><h3 id="åè¿›åˆ¶è½¬äºŒè¿›åˆ¶çš„å¿«é€Ÿè®¡ç®—æ–¹å¼"><a href="#åè¿›åˆ¶è½¬äºŒè¿›åˆ¶çš„å¿«é€Ÿè®¡ç®—æ–¹å¼" class="headerlink" title="åè¿›åˆ¶è½¬äºŒè¿›åˆ¶çš„å¿«é€Ÿè®¡ç®—æ–¹å¼"></a>åè¿›åˆ¶è½¬äºŒè¿›åˆ¶çš„å¿«é€Ÿè®¡ç®—æ–¹å¼</h3><p>17 çš„äºŒè¿›åˆ¶ï¼š17=16+1 æ‰€ä»¥åœ¨ä¸‹é¢ 16å’Œ1 çš„ä½ç½®ä¸º1ï¼Œå…¶å®ƒéƒ½ä¸º0ï¼Œå€¼ä¸º 0001 0001ã€‚</p>
<p>37 çš„äºŒè¿›åˆ¶ï¼š37=32+4+1 æ‰€ä»¥ä¸‹é¢32å’Œ4å’Œ1çš„ä½ä¸Šéƒ½ä¸º1ï¼Œå…¶å®ƒéƒ½ä¸º0ï¼Œå€¼ä¸º 0010 0101ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">    0      0      0      0        0    0    0      0</span><br><span class="line">    128   64     32     16        8    4    2      1</span><br><span class="line">è®¡ç®—ç¤ºä¾‹ï¼š    </span><br><span class="line">17ï¼š 0     0      0      1        0    0    0      1</span><br><span class="line">37ï¼š 0     0      1      0        0    1    0      1 </span><br></pre></td></tr></tbody></table></figure>

<h3 id="ä¸ã€æˆ–ã€å¼‚æˆ–è¿ç®—"><a href="#ä¸ã€æˆ–ã€å¼‚æˆ–è¿ç®—" class="headerlink" title="ä¸ã€æˆ–ã€å¼‚æˆ–è¿ç®—"></a>ä¸ã€æˆ–ã€å¼‚æˆ–è¿ç®—</h3><p>&amp; åˆå«åšandï¼ˆä¸è¿ç®—ï¼‰ï¼Œä¾‹ï¼š3 &amp; 5 = 1 (000011 &amp; 000101 = 000001)ã€‚3çš„äºŒè¿›åˆ¶å’Œ5çš„äºŒè¿›åˆ¶ä½ç›¸å¯¹åº”ï¼Œä¸€ä¸€æ¯”è¾ƒï¼Œéƒ½ä¸º1çš„ä½ä¸Šæ‰ä¸º1ã€‚</p>
<p>| ä¹Ÿå«åšorï¼Œä¾‹ï¼š3 | 5 = 7 (0000011 | 00000101 = 0000111)ã€‚</p>
<p>^ ä¹Ÿå«xor (ä»¥ååšé¢˜ä¼šé‡åˆ°xor,å°±æ˜¯å¼‚æˆ–)ï¼Œä¸¤ä¸ªæ¯”è¾ƒçš„äºŒè¿›åˆ¶çš„ä½ä¸Šç›¸åŒä¸º0ï¼Œä¸åŒä¸º1ã€‚ä¾‹ï¼š3^5 = 6(0000 0011 ^ 0000 0101=0000 0110)ã€‚ç‰¹åˆ«çš„ä»»æ„æ•° ^ 0 = ä»»æ„æ•°ã€‚</p>
<p>å–åè¿ç®—ç¬¦(~)ï¼ŒäºŒè¿›åˆ¶ä½0å˜ä¸º1,1å˜ä¸º0<br><img src="/p/9da5e46/HashMap-And-Xor.png" alt="ä¸æˆ–éè¡¨æ ¼"></p>
<h3 id="â€œ-lt-lt-â€-å’Œ-â€œ-gt-gt-â€-è¿ç®—ç¬¦"><a href="#â€œ-lt-lt-â€-å’Œ-â€œ-gt-gt-â€-è¿ç®—ç¬¦" class="headerlink" title="â€œ<<â€ å’Œ â€œ>>â€ è¿ç®—ç¬¦"></a>â€œ&lt;&lt;â€ å’Œ â€œ&gt;&gt;â€ è¿ç®—ç¬¦</h3><p>ç®­å¤´å‘å·¦å«å·¦ç§»ï¼Œå‘å³å«å³ç§»ã€‚</p>
<p>ä¸¤ä¸ªç®­å¤´çš„ä»£è¡¨å¸¦ç¬¦å·ç§»ä½ï¼Œä¸‰ä¸ªç®­å¤´ï¼ˆâ€œ&lt;&lt;&lt;â€å’Œâ€œ&gt;&gt;&gt;â€ï¼‰ä¸å¸¦ç¬¦å·ç§»ä½ã€‚</p>
<p>ä¾‹å¦‚ï¼Œ17çš„äºŒè¿›åˆ¶ä¸ºï¼š0001 0001ï¼Œè¿ç®— 17 &lt;&lt; 1ï¼Œè¡¨ç¤ºä¸º17çš„äºŒè¿›åˆ¶å‘å·¦ç§»1ä½ï¼Œ0010 0010 è½¬æˆ10è¿›åˆ¶çš„å€¼ä¸º34ã€‚</p>
<h3 id="JDK1-7-æœ€é«˜ä½è®¡ç®—"><a href="#JDK1-7-æœ€é«˜ä½è®¡ç®—" class="headerlink" title="JDK1.7 æœ€é«˜ä½è®¡ç®—"></a>JDK1.7 æœ€é«˜ä½è®¡ç®—</h3><p>å…¶ä¸­æœ‰ä¸€ä¸ªç”¨äºå¯»æ‰¾2çš„næ¬¡æ–¹å°äºi çš„è¿™ä¸ªæ•°çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">highestOneBit</span><span class="params">(<span class="type">int</span> i)</span> {</span><br><span class="line">    <span class="comment">// ç¤ºä¾‹ i=17 æ—¶, è®¡ç®— i|= i |= (i &gt;&gt; 1) çš„ç»“æœ </span></span><br><span class="line">    <span class="comment">// 0 0 0 1   0 0 0 1      17çš„äºŒè¿›åˆ¶</span></span><br><span class="line">    <span class="comment">// 0 0 0 0   1 0 0 0      17å‘å³ç§»ä¸€ä½</span></span><br><span class="line">    <span class="comment">// 0 0 0 1   1 0 0 1      å³ç§»ä¸€ä½ä¹‹åå’Œ17æˆ–è¿ç®—</span></span><br><span class="line">    <span class="comment">//       16  8     1      ç»“æœä¸ºï¼š16+8+1=25</span></span><br><span class="line">    i |= (i &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    i |= (i &gt;&gt; <span class="number">2</span>);</span><br><span class="line">    i |= (i &gt;&gt; <span class="number">4</span>);  <span class="comment">// å½“i=17æ—¶ï¼Œå‡å¦‚æ­¤å¤„è¿ç®—çš„ç»“æœä¸ºnum</span></span><br><span class="line">    i |= (i &gt;&gt; <span class="number">8</span>);  <span class="comment">// å®é™…ä¸Šåˆ°8è¿™é‡Œè¿ç®—ç»“æœ 0000 0000åœ¨ä¸ num æˆ–è¿ç®—ï¼Œnumçš„å€¼å°±ä¸ä¼šåœ¨å‘ç”Ÿæ”¹å˜äº†</span></span><br><span class="line">    i |= (i &gt;&gt; <span class="number">16</span>); </span><br><span class="line">    <span class="keyword">return</span> i - (i &gt;&gt;&gt; <span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>è®¡ç®—å¤šæ¬¡æ˜¯ä¸ºäº†æŠŠ i çš„æœ€é«˜ä½å˜æˆ 0ã€‚</p>
<p>JDK 1.8ä¹‹å‰çš„HashMapç”± <strong>æ•°ç»„+é“¾è¡¨</strong> ç»„æˆçš„ï¼ŒJDK1.8ä¸­HashMapç”±<strong>é“¾è¡¨+æ•°ç»„+çº¢é»‘æ ‘</strong>ç»„æˆï¼ˆå½“é“¾è¡¨èŠ‚ç‚¹å³é˜ˆå€¼å¤§äº8ï¼Œæ•°ç»„é•¿åº¦å¤§äº64åè½¬åŒ–ä¸ºçº¢é»‘æ•°ï¼Œé«˜æ•ˆçš„æŸ¥è¯¢ï¼›å½“é˜ˆå€¼å¤§äº8ï¼Œæ•°ç»„é•¿åº¦å°äº64çš„æ—¶å€™ï¼Œä¼šæ‰©å®¹ï¼‰ã€‚</p>
<p>HashMap åŸºäºå“ˆå¸Œè¡¨çš„ Map æ¥å£çš„å®ç°ï¼Œkeyå’Œvalueéƒ½å…è®¸ä¸ºnullï¼Œæ— åºçš„ã€‚</p>
<p>é“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªï¼ˆä¸¤ä¸ªå¯¹è±¡ä¾‹å¦‚Aaå’ŒBBè°ƒç”¨çš„ hashCodeæ–¹æ³•è®¡ç®—çš„å“ˆå¸Œç å€¼ä¸€è‡´å¯¼è‡´è®¡ç®—çš„æ•°ç»„ç´¢å¼•å€¼ç›¸åŒï¼‰ã€‚</p>
<h2 id="HashMapå­˜å‚¨æ•°æ®çš„è¿‡ç¨‹"><a href="#HashMapå­˜å‚¨æ•°æ®çš„è¿‡ç¨‹" class="headerlink" title="HashMapå­˜å‚¨æ•°æ®çš„è¿‡ç¨‹"></a>HashMapå­˜å‚¨æ•°æ®çš„è¿‡ç¨‹</h2><p>â€‹        åœ¨JDK8ä»¥å‰ï¼Œå½“åˆ›å»ºHashMapé›†åˆå¯¹è±¡çš„æ—¶å€™ï¼Œæ„é€ æ–¹æ³•ä¸­åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º16çš„Entry[ ] table å­˜å‚¨é”®å€¼å¯¹æ•°æ®ï¼›</p>
<p>â€‹        åœ¨JDK8ä¹‹åï¼Œä¸åœ¨æ„é€ æ–¹æ³•ä¸­åˆ›å»ºæ•°ç»„äº†ï¼Œè€Œæ˜¯åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ put æ–¹æ³•æ—¶åˆ›å»º Node[ ] tableï¼ˆå®é™…ä¸Šåªæ˜¯Entryæ¢äº†ä¸ªåå­—ï¼Œåº•å±‚è¿˜æ˜¯Map.Entryï¼‰ã€‚</p>
<blockquote>
<h4 id="å“ˆå¸Œè¡¨çš„åº•å±‚æ˜¯å¦‚ä½•è®¡ç®—å“ˆå¸Œå€¼çš„ï¼Ÿè¿˜æœ‰å“ªäº›ç®—æ³•å¯ä»¥è®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Ÿ"><a href="#å“ˆå¸Œè¡¨çš„åº•å±‚æ˜¯å¦‚ä½•è®¡ç®—å“ˆå¸Œå€¼çš„ï¼Ÿè¿˜æœ‰å“ªäº›ç®—æ³•å¯ä»¥è®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Ÿ" class="headerlink" title="å“ˆå¸Œè¡¨çš„åº•å±‚æ˜¯å¦‚ä½•è®¡ç®—å“ˆå¸Œå€¼çš„ï¼Ÿè¿˜æœ‰å“ªäº›ç®—æ³•å¯ä»¥è®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Ÿ"></a>å“ˆå¸Œè¡¨çš„åº•å±‚æ˜¯å¦‚ä½•è®¡ç®—å“ˆå¸Œå€¼çš„ï¼Ÿè¿˜æœ‰å“ªäº›ç®—æ³•å¯ä»¥è®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Ÿ</h4></blockquote>
<p>â€‹        åº•å±‚é‡‡ç”¨ keyçš„å“ˆå¸Œå€¼ï¼ˆhashCodeæ–¹æ³•çš„è®¡ç®—å€¼ï¼‰ï¼Œç»“åˆæ•°ç»„é•¿åº¦è¿›è¡Œæ— ç¬¦å·å³ç§»(&gt;&gt;&gt;)ã€å¼‚æˆ–ï¼ˆ^ï¼‰è¿ç®—ã€ä¸è¿ç®—ï¼ˆ^ï¼‰è®¡ç®—å‡ºæ•°ç»„çš„ç´¢å¼•ä¸‹æ ‡ã€‚</p>
<p>é™¤äº†å“ˆå¸Œç®—æ³•å¤–ï¼Œè¿˜å¯ä»¥é‡‡ç”¨å¹³æ–¹å–ä¸­æ³•ã€å–ä½™æ•°ã€ä¼ªéšæœºæ•°æ³•ï¼Œä½†ä¸ºä»€ä¹ˆé‡‡ç”¨å“ˆå¸Œç®—æ³•ï¼Ÿ</p>
<p>â€‹        å‘å“ˆå¸Œè¡¨ä¸­å­˜å‚¨ä¸€ä¸ª key - value æ•°æ®ï¼Œå‡è®¾ key è®¡ç®—å‡ºçš„å“ˆå¸Œå€¼ç»“åˆæ•°ç»„é•¿åº¦è®¡ç®—å‡ºçš„ç´¢å¼•å€¼ä¸º3ï¼Œå½“æ•°ç»„ç©ºé—´ä¸ä¸ºnullæ—¶ï¼Œä¼šä¸ç´¢å¼•ä¸º3çš„æ¡¶ï¼ˆæ•°ç»„ä¸­ä¸º3çš„å…ƒç´ ï¼‰æ¯”è¾ƒï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ç›¸åŒå“ˆå¸Œå€¼çš„keyï¼Œé‚£ä¹ˆä»è¿™ä¸ªæ¡¶å†…åˆ’å‡ºä¸€ä¸ªèŠ‚ç‚¹æ¥å­˜å‚¨å½“å‰çš„key-valueï¼Œè¿™ç§æ–¹æ³•ç§°ä¸º<strong>æ‹‰é“¾æ³•</strong>ã€‚å¦‚æœåŒ¹é…åˆ°äº†ä¸€ä¸ªå“ˆå¸Œå€¼ç›¸ç­‰çš„keyï¼Œæ­¤æ—¶å‘ç”Ÿ<strong>å“ˆå¸Œç¢°æ’</strong>ï¼Œé‚£ä¹ˆä¼šè°ƒç”¨String.equals()æ–¹æ³•æ¯”è¾ƒä¸¤ä¸ªå€¼çš„å¼•ç”¨åœ°å€æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰åˆ™è¿”å›å¹¶è¦†ç›–ä¹‹å‰çš„valueï¼Œåä¹‹åˆ’å‡ºä¸€ä¸ªèŠ‚ç‚¹å­˜å‚¨key-valueã€‚ å¦‚æœé“¾è¡¨èŠ‚ç‚¹æ•°å¤§äºé˜ˆå€¼8ï¼Œå¹¶ä¸”æ•°ç»„é•¿åº¦å¤§äº64ï¼Œåˆ™å°†é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘ã€‚</p>
<blockquote>
<h4 id="ä»€ä¹ˆæ˜¯å“ˆå¸Œç¢°æ’ï¼Ÿä½•æ—¶å‘ç”Ÿï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å“ˆå¸Œç¢°æ’ï¼Ÿä½•æ—¶å‘ç”Ÿï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å“ˆå¸Œç¢°æ’ï¼Ÿä½•æ—¶å‘ç”Ÿï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å“ˆå¸Œç¢°æ’ï¼Ÿä½•æ—¶å‘ç”Ÿï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</h4></blockquote>
<p>åªè¦ä¸¤ä¸ªkeyé€šè¿‡hashCodeæ–¹æ³•è®¡ç®—å‡ºçš„å“ˆå¸Œå€¼ç›¸ç­‰å°±æ˜¯å“ˆå¸Œç¢°æ’ï¼ŒJDK8ä½¿ç”¨é“¾è¡¨è§£å†³å“ˆå¸Œç¢°æ’ï¼ŒJDK8ä¹‹åä½¿ç”¨é“¾è¡¨+çº¢é»‘æ ‘è§£å†³å“ˆå¸Œç¢°æ’ã€‚</p>
<blockquote>
<h4 id="å¦‚æœä¸¤ä¸ªkeyçš„å“ˆå¸Œå€¼ç›¸åŒï¼Œå¦‚ä½•å­˜å‚¨é”®å€¼å¯¹ï¼Ÿ"><a href="#å¦‚æœä¸¤ä¸ªkeyçš„å“ˆå¸Œå€¼ç›¸åŒï¼Œå¦‚ä½•å­˜å‚¨é”®å€¼å¯¹ï¼Ÿ" class="headerlink" title="å¦‚æœä¸¤ä¸ªkeyçš„å“ˆå¸Œå€¼ç›¸åŒï¼Œå¦‚ä½•å­˜å‚¨é”®å€¼å¯¹ï¼Ÿ"></a>å¦‚æœä¸¤ä¸ªkeyçš„å“ˆå¸Œå€¼ç›¸åŒï¼Œå¦‚ä½•å­˜å‚¨é”®å€¼å¯¹ï¼Ÿ</h4></blockquote>
<p>å“ˆå¸Œå€¼ç›¸åŒçš„ä¸¤ä¸ª key ï¼Œé€šè¿‡ equals æ¯”è¾ƒå†…å®¹æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒåˆ™æ–°çš„valueè¦†ç›–æ—§valueå¹¶è¿”å›æ—§valueã€‚</p>
<blockquote>
<h4 id="ä¸ºä»€ä¹ˆ-JDK1-8-è¦ä½¿ç”¨çº¢é»‘æ ‘ï¼Ÿä¸ºä»€ä¹ˆé˜ˆå€¼å¤§äº8æ‰æ¢æˆçº¢é»‘æ ‘ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-JDK1-8-è¦ä½¿ç”¨çº¢é»‘æ ‘ï¼Ÿä¸ºä»€ä¹ˆé˜ˆå€¼å¤§äº8æ‰æ¢æˆçº¢é»‘æ ‘ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ JDK1.8 è¦ä½¿ç”¨çº¢é»‘æ ‘ï¼Ÿä¸ºä»€ä¹ˆé˜ˆå€¼å¤§äº8æ‰æ¢æˆçº¢é»‘æ ‘ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ JDK1.8 è¦ä½¿ç”¨çº¢é»‘æ ‘ï¼Ÿä¸ºä»€ä¹ˆé˜ˆå€¼å¤§äº8æ‰æ¢æˆçº¢é»‘æ ‘ï¼Ÿ</h4></blockquote>
<p>åœ¨JDK1.8ä¹‹å‰çš„HashMapä¸­ï¼Œæ•°æ®ç»“æ„æ˜¯æ•°ç»„+é“¾è¡¨ï¼Œå³ä½¿å“ˆå¸Œå‡½æ•°å–å¾—å†å¥½ï¼Œä¹Ÿå¾ˆéš¾è¾¾åˆ°å…ƒç´ ç™¾åˆ†ç™¾å‡åŒ€åˆ†å¸ƒã€‚å½“HashMapä¸­ä»¥åå¤§é‡çš„å…ƒç´ éƒ½å­˜æ”¾åœ¨åŒä¸€ä¸ªæ¡¶ä¸­æ—¶ï¼Œè¿™ä¸ªæ¡¶æœ‰ä¸€æ¡å¾ˆå¤šèŠ‚ç‚¹çš„é“¾è¡¨ï¼Œæ­¤æ—¶çš„HashMapå°±ç›¸å½“äºä¸€ä¸ªå•é“¾è¡¨ï¼ŒåŠ å…¥é“¾è¡¨æœ‰nä¸ªèŠ‚ç‚¹ï¼Œåˆ™æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚é’ˆå¯¹è¿™ä¸€æƒ…å†µï¼ŒJDK1.8å¼•å…¥äº†çº¢é»‘æ ‘ï¼ˆæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(lognï¼‰ï¼‰ã€‚</p>
<p>å½“é“¾è¡¨å¾ˆå°æ—¶ï¼Œéå†é€Ÿåº¦ä¹Ÿä¼šéå¸¸å¿«ï¼Œä½†æ˜¯å½“é“¾è¡¨èŠ‚ç‚¹å¤šäº†ä»¥åï¼ŒæŸ¥è¯¢æ€§èƒ½å—å½±å“ï¼Œæ‰€ä»¥æ¢æˆæ ‘çš„ç»“æ„æ¥å¢åŠ æŸ¥è¯¢æ€§èƒ½ã€‚<br><img src="/p/9da5e46/HashMap%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="HashMapæµç¨‹å›¾"><br>1ã€è®¡ç®—å‡ºå½“å‰æ’å…¥Entryï¼ˆé”®å€¼å¯¹)keyçš„ hashCodeï¼Œå†é€šè¿‡<strong>æŸç§ç®—æ³•</strong>è®¡ç®—å‡ºæ’å…¥çš„ä¸‹æ ‡ iã€‚</p>
<p>2ã€å¦‚æœ table[ i ] == nullï¼Œåˆ™ç›´æ¥æ’å…¥ï¼›å¦‚æœä¸ç­‰äºnullï¼Œåˆ™é€šè¿‡equals æ¯”è¾ƒ key å’Œ table[i] ä¸­çš„keyæ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™æ–°valueç›´æ¥è¦†ç›–å¹¶è¿”å›æ—§valueï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™åˆ¤æ–­å½“å‰ table[i] æ˜¯å¦ä¸ºçº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œåˆ™ç›´æ¥æ’å…¥Entry åˆ°å¶å­èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯é“¾è¡¨åˆ™å…ˆåˆ¤æ–­é“¾è¡¨çš„èŠ‚ç‚¹é•¿åº¦æ˜¯å¦å°äº8ä¸”æ•°ç»„é•¿åº¦æ˜¯å¦å°äº64ï¼Œæ»¡è¶³æ¡ä»¶åˆ™éå†keyæ¯”å¯¹ååˆ’å‡ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹è¿æ¥ä¸Šé“¾è¡¨ã€‚</p>
<p>3ã€size è¡¨ç¤ºHashMapä¸­K-Vçš„å®æ—¶æ•°é‡ï¼Œä¸ç­‰äºæ•°ç»„çš„é•¿åº¦ã€‚</p>
<p>4ã€thresholdï¼ˆä¸´ç•Œå€¼ï¼‰= capacityï¼ˆæ•°ç»„å®¹é‡ï¼‰ * loadFactorï¼ˆè´Ÿè½½å› å­ï¼‰ã€‚è¿™ä¸ªå€¼æ˜¯å½“å‰å·²å ç”¨æ•°ç»„é•¿åº¦çš„æœ€å¤§å€¼ã€‚size è¶…è¿‡è¿™ä¸ªä¸´ç•Œå€¼å°±é‡æ–° resizeï¼Œæ‰©å®¹å å®¹é‡æ˜¯ä¹‹å‰å®¹é‡çš„ä¸¤å€ã€‚ï¼ˆHashMapæ•°ç»„çš„ç©ºé—´æ˜¯å¾ˆéš¾æ¯ä¸ªç©ºé—´éƒ½å­˜æ»¡æ•°æ®çš„ï¼Œæ‰€ä»¥ä¹˜ä»¥ä¸€ä¸ªè´Ÿè½½å› å­ï¼‰</p>
<h2 id="HashMapçš„ç»§æ‰¿å…³ç³»"><a href="#HashMapçš„ç»§æ‰¿å…³ç³»" class="headerlink" title="HashMapçš„ç»§æ‰¿å…³ç³»"></a>HashMapçš„ç»§æ‰¿å…³ç³»</h2><p><img src="/p/9da5e46/image-20250221142202514.png" alt="HashMapçš„ç»§æ‰¿å…³ç³»"></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HashMap</span>&lt;K,V&gt; <span class="keyword">extends</span> <span class="title class_">AbstractMap</span>&lt;K,V&gt;</span><br><span class="line">    <span class="keyword">implements</span> <span class="title class_">Map</span>&lt;K,V&gt;, Cloneable, Serializable {...}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractMap</span>&lt;K,V&gt; <span class="keyword">implements</span> <span class="title class_">Map</span>&lt;K,V&gt; {...}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>Cloneableï¼š</strong> å®ç°è¯¥æ¥å£è¡¨ç¤ºå¯ä»¥å…‹éš†ã€‚</p>
<p><strong>Serializable</strong>ï¼šè¡¨ç¤ºHashMapå¯¹è±¡å¯ä»¥è¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p>
<h2 id="æˆå‘˜å˜é‡"><a href="#æˆå‘˜å˜é‡" class="headerlink" title="æˆå‘˜å˜é‡"></a>æˆå‘˜å˜é‡</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The default initial capacity - MUST be a power of two.</span></span><br><span class="line"><span class="comment"> * é»˜è®¤çš„åˆå§‹åŒ–å®¹é‡å¿…é¡»æ˜¯2çš„næ¬¡å¹‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_INITIAL_CAPACITY</span> <span class="operator">=</span> <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">// aka 16  = 1*2^4</span></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<h4 id="ä¸ºä»€ä¹ˆåˆå§‹å€¼å¿…é¡»æ˜¯2çš„næ¬¡å¹‚ï¼Ÿä¸æ˜¯2çš„næ¬¡å¹‚ä¼šæ€æ ·ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆåˆå§‹å€¼å¿…é¡»æ˜¯2çš„næ¬¡å¹‚ï¼Ÿä¸æ˜¯2çš„næ¬¡å¹‚ä¼šæ€æ ·ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆåˆå§‹å€¼å¿…é¡»æ˜¯2çš„næ¬¡å¹‚ï¼Ÿä¸æ˜¯2çš„næ¬¡å¹‚ä¼šæ€æ ·ï¼Ÿ"></a>ä¸ºä»€ä¹ˆåˆå§‹å€¼å¿…é¡»æ˜¯2çš„næ¬¡å¹‚ï¼Ÿä¸æ˜¯2çš„næ¬¡å¹‚ä¼šæ€æ ·ï¼Ÿ</h4></blockquote>
<p>HashMap åœ¨ put è¿›ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡ key çš„å“ˆå¸Œå€¼æ¥è®¡ç®—å‡ºå­˜å‚¨åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ä¸‹æ ‡ï¼ŒHashMap ä¸ºäº†å­˜å–é«˜æ•ˆã€å°½é‡å‡å°‘ç¢°æ’ï¼Œå°±éœ€è¦å°½é‡æŠŠæ•°æ®åˆ†é…å‡åŒ€ï¼Œæ¯ä¸ªé“¾è¡¨çš„é•¿åº¦å¤§è‡´ç›¸åŒï¼Œè¿™ä¸ªå®ç°å°±åœ¨æŠŠæ•°æ®å­˜åˆ°å“ªä¸ªé“¾è¡¨ä¸­çš„ç®—æ³•ã€‚è¿™ä¸ªç®—æ³•å®é™…ä¸Šå°±æ˜¯<strong>å–æ¨¡è¿ç®—</strong>ï¼ˆhash%lengthï¼‰ï¼Œè®¡ç®—æœºä¸­ç›´æ¥æ±‚ä½™æ•ˆç‡ä¸å¦‚ä½ç§»è¿ç®—ï¼Œæ‰€ä»¥HashMapå¯¹æ­¤åšäº†ä¼˜åŒ–ä½¿ç”¨ <strong>hash&amp;length-1</strong>ï¼Œè€Œå®é™… hash%length ç­‰äº hash&amp;(length-1) çš„<strong>å‰ææ˜¯lengthæ˜¯2çš„næ¬¡å¹‚</strong>ã€‚</p>
<blockquote>
<h4 id="ä¸ºä»€ä¹ˆé€šè¿‡å–æ¨¡è¿ç®—ï¼ˆhash-amp-length-1ï¼‰èƒ½å¤Ÿå‡åŒ€åˆ†å¸ƒå‡å°‘ç¢°æ’å‘¢ï¼Ÿä¸ºä»€ä¹ˆæ˜¯2çš„næ¬¡å¹‚ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆé€šè¿‡å–æ¨¡è¿ç®—ï¼ˆhash-amp-length-1ï¼‰èƒ½å¤Ÿå‡åŒ€åˆ†å¸ƒå‡å°‘ç¢°æ’å‘¢ï¼Ÿä¸ºä»€ä¹ˆæ˜¯2çš„næ¬¡å¹‚ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆé€šè¿‡å–æ¨¡è¿ç®—ï¼ˆhash&amp;length-1ï¼‰èƒ½å¤Ÿå‡åŒ€åˆ†å¸ƒå‡å°‘ç¢°æ’å‘¢ï¼Ÿä¸ºä»€ä¹ˆæ˜¯2çš„næ¬¡å¹‚ï¼Ÿ"></a>ä¸ºä»€ä¹ˆé€šè¿‡å–æ¨¡è¿ç®—ï¼ˆhash&amp;length-1ï¼‰èƒ½å¤Ÿå‡åŒ€åˆ†å¸ƒå‡å°‘ç¢°æ’å‘¢ï¼Ÿä¸ºä»€ä¹ˆæ˜¯2çš„næ¬¡å¹‚ï¼Ÿ</h4></blockquote>
<p>2^n çš„äºŒè¿›åˆ¶å®é™…ä¸Šå°±æ˜¯100â€¦00ï¼Œ2^n - 1 çš„äºŒè¿›åˆ¶å®é™…ä¸Šå°±æ˜¯ 111â€¦11ã€‚æ‰€ä»¥length-1å®é™…ä¸Šå°±æ˜¯ 2^n-1ï¼Œå› ä¸ºhashå€¼å¤ªå¤§äº†ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡å–æ¨¡æ¥è®©è®¡ç®—ç»“æœç¼©å°åœ¨lengthå¤§å°çš„èŒƒå›´å†…ã€‚</p>
<p>å¦‚æœæ•°ç»„é•¿åº¦ä¸æ˜¯2çš„næ¬¡å¹‚ï¼Œé€šè¿‡ hash&amp;length-1 çš„ä¸‹æ ‡å¾ˆå®¹æ˜“ç›¸åŒï¼Œ<strong>æ˜“äº§ç”Ÿå“ˆå¸Œç¢°æ’</strong>ï¼Œå¯¼è‡´æ•°ç»„çš„ç©ºé—´å¾ˆå¤§ç¨‹åº¦ä¸Šå¹¶æ²¡æœ‰å­˜å‚¨æ•°æ®ï¼Œ<strong>æµªè´¹æ•°ç»„ç©ºé—´</strong>ï¼Œå¯¼è‡´å•ä¸ªæ¡¶çš„<strong>é“¾è¡¨æˆ–çº¢é»‘æ ‘è¿‡é•¿</strong>ï¼Œæ•ˆç‡é™ä½ã€‚</p>
<p><strong>å¦‚æœæ•°ç»„çš„é•¿åº¦æ˜¯2çš„næ¬¡å¹‚</strong></p>
 <figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">ä¾‹å¦‚å½“å‰hashå€¼ä¸º3ï¼Œæ•°ç»„é•¿åº¦ä¸º8ï¼ˆåˆ™ length-1=7ï¼‰</span><br><span class="line">3çš„äºŒè¿›åˆ¶ï¼š0 0 0 0 0 0 1 1</span><br><span class="line">7çš„äºŒè¿›åˆ¶ï¼š0 0 0 0 0 1 1 1</span><br><span class="line">ä¸è¿ç®—ç»“æœï¼š0 0 0 0 0 0 1 1 åè¿›åˆ¶ä¸ºï¼š3 ï¼ˆä¸‹æ ‡ï¼‰</span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚å½“å‰hashå€¼ä¸º2ï¼Œæ•°ç»„é•¿åº¦ä¸º8ï¼ˆåˆ™ length-1=7ï¼‰</span><br><span class="line">2çš„äºŒè¿›åˆ¶ï¼š0 0 0 0 0 0 1 0</span><br><span class="line">7çš„äºŒè¿›åˆ¶ï¼š0 0 0 0 0 1 1 1</span><br><span class="line">&amp;è¿ç®—ç»“æœï¼š0 0 0 0 0 0 1 0 åè¿›åˆ¶ä¸ºï¼š2 ï¼ˆä¸‹æ ‡ï¼‰</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å¦‚æœæ•°ç»„çš„é•¿åº¦ä¸æ˜¯2çš„næ¬¡å¹‚</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">ä¾‹å¦‚å½“å‰hashå€¼ä¸º3ï¼Œæ•°ç»„é•¿åº¦ä¸º9ï¼ˆåˆ™ length-1=8ï¼‰</span><br><span class="line">3çš„äºŒè¿›åˆ¶ï¼š0 0 0 0 0 0 1 1</span><br><span class="line">8çš„äºŒè¿›åˆ¶ï¼š0 0 0 0 1 0 0 0</span><br><span class="line">ä¸è¿ç®—ç»“æœï¼š0 0 0 0 0 0 0 0 åè¿›åˆ¶ä¸ºï¼š0 ï¼ˆä¸‹æ ‡ï¼‰</span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚å½“å‰hashå€¼ä¸º2ï¼Œæ•°ç»„é•¿åº¦ä¸º9ï¼ˆåˆ™ length-1=8ï¼‰</span><br><span class="line">2çš„äºŒè¿›åˆ¶ï¼š0 0 0 0 0 0 1 0</span><br><span class="line">7çš„äºŒè¿›åˆ¶ï¼š0 0 0 0 0 1 1 1</span><br><span class="line">&amp;è¿ç®—ç»“æœï¼š0 0 0 0 0 0 1 0 åè¿›åˆ¶ä¸ºï¼š0 ï¼ˆä¸‹æ ‡ï¼‰</span><br></pre></td></tr></tbody></table></figure>

<p>å‘ç°ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœä¸æ˜¯2çš„næ¬¡å¹‚å¾ˆå®¹æ˜“å¯¼è‡´å­˜å‚¨åˆ°æ•°ç»„çš„ä¸‹æ ‡ä¸º0ã€‚</p>
<blockquote>
<h4 id="å¦‚æœåœ¨åˆå§‹-HashMap-æ—¶ï¼Œä¼ å…¥ä¸€ä¸ªåˆå§‹å®¹é‡ä¸ä¸º-2-çš„-n-æ¬¡å¹‚ä¼šæ€ä¹ˆæ ·ï¼Ÿ"><a href="#å¦‚æœåœ¨åˆå§‹-HashMap-æ—¶ï¼Œä¼ å…¥ä¸€ä¸ªåˆå§‹å®¹é‡ä¸ä¸º-2-çš„-n-æ¬¡å¹‚ä¼šæ€ä¹ˆæ ·ï¼Ÿ" class="headerlink" title="å¦‚æœåœ¨åˆå§‹ HashMap æ—¶ï¼Œä¼ å…¥ä¸€ä¸ªåˆå§‹å®¹é‡ä¸ä¸º 2 çš„ n æ¬¡å¹‚ä¼šæ€ä¹ˆæ ·ï¼Ÿ"></a>å¦‚æœåœ¨åˆå§‹ HashMap æ—¶ï¼Œä¼ å…¥ä¸€ä¸ªåˆå§‹å®¹é‡ä¸ä¸º 2 çš„ n æ¬¡å¹‚ä¼šæ€ä¹ˆæ ·ï¼Ÿ</h4></blockquote>
<p>ä¼šæ‰¾ä¸€ä¸ªæ¯”ä½ ä¼ å…¥è¿™ä¸ªå€¼å¤§çš„ä¸€ä¸ª2çš„næ¬¡å¹‚ï¼Œä¾‹å¦‚ä¼ å…¥7ï¼Œåˆ™é»˜è®¤åˆå§‹å®¹é‡ä¸º8ï¼›ä¼ å…¥10ï¼Œåˆ™åˆå§‹å®¹é‡ä¸º16ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// å½“ cap ä¼ å…¥ 10 æ—¶</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">tableSizeFor</span><span class="params">(<span class="type">int</span> cap)</span> {</span><br><span class="line">    <span class="comment">// cap-1 æ˜¯ä¸ºäº†é¿å…ä¼ å…¥çš„å€¼å°±æ˜¯2çš„næ¬¡å¹‚</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> cap - <span class="number">1</span>; <span class="comment">// n=9ï¼Œ9çš„äºŒè¿›åˆ¶ï¼š0000 1001</span></span><br><span class="line">     <span class="comment">// 9å‘å³ç§»1ä½ï¼š0 0 0 0 0 1 0 0 å†å’Œnè¿›è¡Œæˆ–è¿ç®— 0000 1101</span></span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">1</span>; <span class="comment">// n=13</span></span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">2</span>; <span class="comment">// n=15</span></span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">4</span>; <span class="comment">// n=15ï¼Œæ­¤æ—¶åœ¨å¾€åè¿ç®—å·²ç»æ²¡ä½œç”¨äº†</span></span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">8</span>; <span class="comment">// n=15</span></span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">16</span>;<span class="comment">// n=15</span></span><br><span class="line">    <span class="comment">// n&lt;0=false  n&gt;2^30=falseï¼Œæ‰€ä»¥èµ°n+1 =15+1 ç»“æœä¸º 16</span></span><br><span class="line">    <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= <span class="number">1</span> &lt;&lt; <span class="number">30</span>) ? <span class="number">1</span> &lt;&lt; <span class="number">30</span> : ;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å…¶å®åˆ°è¿™é‡Œå‘ç°è§„å¾‹äº†ï¼Œåœ¨æƒ³åŠæ³•è®©å„ä¸ªä½ä¸Šçš„å€¼å˜æˆ1ï¼Œå°è¯äº†è§„å¾‹ï¼š 2^n - 1 çš„äºŒè¿›åˆ¶å®é™…ä¸Šå°±æ˜¯ 111â€¦11ï¼Œåœ¨æœ€ååœ¨åŠ ä¸ª1å°±å˜æˆäº†2çš„næ¬¡å¹‚ã€‚</p>
<h3 id="è´Ÿè½½å› å­"><a href="#è´Ÿè½½å› å­" class="headerlink" title="è´Ÿè½½å› å­"></a>è´Ÿè½½å› å­</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * é»˜è®¤çš„è´Ÿè½½å› å­å¤§å°ä¸º 0.75f</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">float</span> <span class="variable">DEFAULT_LOAD_FACTOR</span> <span class="operator">=</span> <span class="number">0.75f</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>å½“æ•°ç»„çš„çš„å¤§å°è¶…è¿‡ä¸´ç•Œå€¼æ˜¯å°±ä¼šæ‰©å®¹ï¼Œthresholdï¼ˆä¸´ç•Œå€¼ï¼‰= capacityï¼ˆå½“å‰å®¹é‡ï¼‰ * loadFactorï¼ˆè´Ÿè½½å› å­ï¼‰ã€‚</p>
<h3 id="é“¾è¡¨æ ‘åŒ–çš„æœ€å°èŠ‚ç‚¹æ•°"><a href="#é“¾è¡¨æ ‘åŒ–çš„æœ€å°èŠ‚ç‚¹æ•°" class="headerlink" title="é“¾è¡¨æ ‘åŒ–çš„æœ€å°èŠ‚ç‚¹æ•°"></a>é“¾è¡¨æ ‘åŒ–çš„æœ€å°èŠ‚ç‚¹æ•°</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å½“é“¾è¡¨çš„èŠ‚ç‚¹æ•°è¶…è¿‡ 8 åï¼Œé“¾è¡¨è½¬çº¢é»‘æ ‘</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">TREEIFY_THRESHOLD</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å½“é“¾è¡¨èŠ‚ç‚¹æ•°å°äº 6 æ—¶ï¼Œæ ‘è½¬é“¾è¡¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">UNTREEIFY_THRESHOLD</span> <span class="operator">=</span> <span class="number">6</span>;</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<h4 id="ä¸ºä»€ä¹ˆæ¡¶é‡Œé¢çš„èŠ‚ç‚¹æ•°ï¼ˆé“¾è¡¨èŠ‚ç‚¹æ•°ï¼‰è¶…è¿‡8åæ‰è½¬ä¸ºçº¢é»‘æ ‘ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ¡¶é‡Œé¢çš„èŠ‚ç‚¹æ•°ï¼ˆé“¾è¡¨èŠ‚ç‚¹æ•°ï¼‰è¶…è¿‡8åæ‰è½¬ä¸ºçº¢é»‘æ ‘ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ¡¶é‡Œé¢çš„èŠ‚ç‚¹æ•°ï¼ˆé“¾è¡¨èŠ‚ç‚¹æ•°ï¼‰è¶…è¿‡8åæ‰è½¬ä¸ºçº¢é»‘æ ‘ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ¡¶é‡Œé¢çš„èŠ‚ç‚¹æ•°ï¼ˆé“¾è¡¨èŠ‚ç‚¹æ•°ï¼‰è¶…è¿‡8åæ‰è½¬ä¸ºçº¢é»‘æ ‘ï¼Ÿ</h4><p>æ¢ä¸ªæé—®å§¿åŠ¿ï¼šHashMapçš„æ ‘åŒ–é—¨æ§›ä¸ºä»€ä¹ˆæ˜¯8ï¼Ÿ</p>
</blockquote>
<p><strong>ä»è®¾è®¡è€…æ€æƒ³è€ƒè™‘</strong></p>
<p>å‡ºäºå¯¹ç©ºé—´å’Œæ—¶é—´çš„æƒè¡¡ï¼Œå› ä¸ºæ ‘èŠ‚ç‚¹çš„å¤§å°çº¦æ˜¯æ™®é€šèŠ‚ç‚¹çš„ä¸¤å€ï¼Œæ‰€ä»¥æˆ‘ä»¬åªåœ¨åŒ…å«äº†è¶³å¤Ÿå¤šèŠ‚ç‚¹çš„æ¡¶é‡Œä½¿ç”¨æ ‘èŠ‚ç‚¹ã€‚å½“å®ƒä»¬å˜å¾—å¤ªå°çš„æ—¶å€™ï¼Œå°±ä¼šè¢«è½¬æ¢ä¸ºæ™®é€šçš„é“¾è¡¨ã€‚åœ¨ä½¿ç”¨åˆ†å¸ƒè‰¯å¥½çš„hashCodeæ—¶ï¼Œå¾ˆå°‘ä¼šä½¿ç”¨æ ‘èŠ‚ç‚¹ã€‚ç†æƒ³çŠ¶æ€ä¸‹ï¼Œåœ¨éšæœºå“ˆå¸Œç ä¸‹ï¼Œç®±å­ä¸­èŠ‚ç‚¹çš„é¢‘ç‡æœä»æ³Šæ¾åˆ†å¸ƒã€‚</p>
<p><strong>ä»æŸ¥è¯¢æ•ˆç‡è€ƒè™‘</strong></p>
<p>çº¢é»‘æ ‘çš„å¹³å‡æŸ¥æ‰¾é•¿åº¦æ˜¯log(n)ï¼Œå¦‚æœé•¿åº¦ä¸º8ï¼Œå¹³å‡æŸ¥æ‰¾é•¿åº¦ä¸ºlog(8)=3ï¼Œé“¾è¡¨çš„å¹³å‡æŸ¥æ‰¾é•¿åº¦ä¸ºn/2ï¼Œå½“é•¿åº¦ä¸º8æ—¶ï¼Œå¹³å‡æŸ¥æ‰¾é•¿åº¦ä¸º8/2=4ï¼Œçº¢é»‘æ ‘çš„æŸ¥æ‰¾æ•ˆç‡æ›´é«˜ï¼Œè¿™æ‰æœ‰è½¬æ¢æˆæ ‘çš„å¿…è¦ï¼›<br>é“¾è¡¨é•¿åº¦å¦‚æœæ˜¯å°äºç­‰äº6ï¼Œ6/2=3ï¼Œè€Œlog(6)=2.6ï¼Œè™½ç„¶é€Ÿåº¦ä¹Ÿå¾ˆå¿«çš„ï¼Œä½†æ˜¯è½¬åŒ–ä¸ºæ ‘ç»“æ„å’Œç”Ÿæˆæ ‘çš„æ—¶é—´å¹¶ä¸ä¼šå¤ªçŸ­ã€‚</p>
<p>ï¼ˆå½“n=6æ—¶ï¼Œ6/2=3 &gt; log(6)æ»¡è¶³è½¬æˆçº¢é»‘æ ‘è¦æ±‚ï¼Œä½†æ˜¯å¦‚æœè½¬ä¸ºçº¢é»‘æ ‘åï¼Œåˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼Œçº¢é»‘æ ‘éœ€è¦ä¸€ç³»åˆ—æ“ä½œæ¥ä¿æŒå¹³è¡¡ï¼Œæ•ˆç‡åè€Œæ›´ä½äº†ï¼‰</p>
<h3 id="é“¾è¡¨æ ‘åŒ–æ•°ç»„çš„æœ€å°å®¹é‡"><a href="#é“¾è¡¨æ ‘åŒ–æ•°ç»„çš„æœ€å°å®¹é‡" class="headerlink" title="é“¾è¡¨æ ‘åŒ–æ•°ç»„çš„æœ€å°å®¹é‡"></a>é“¾è¡¨æ ‘åŒ–æ•°ç»„çš„æœ€å°å®¹é‡</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The smallest table capacity for which bins may be treeified.</span></span><br><span class="line"><span class="comment"> * (Otherwise the table is resized if too many nodes in a bin.)</span></span><br><span class="line"><span class="comment"> * Should be at least 4 * TREEIFY_THRESHOLD to avoid conflicts</span></span><br><span class="line"><span class="comment"> * between resizing and treeification thresholds.</span></span><br><span class="line"><span class="comment"> * å½“æ•°ç»„çš„é•¿åº¦å¤§äº64åæ‰ä¼šæ ‘åŒ–</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MIN_TREEIFY_CAPACITY</span> <span class="operator">=</span> <span class="number">64</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>é“¾è¡¨æ ‘åŒ–çš„ä¸¤ä¸ªæ¡ä»¶ï¼šå•ä¸ªæ¡¶å†…çš„é“¾è¡¨èŠ‚ç‚¹æ•°å¤§äº8å¹¶ä¸”æ•°ç»„å®¹é‡å¤§äº64ï¼›</p>
<h2 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HashMapçš„æ•°ç»„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">transient</span> Node&lt;K,V&gt;[] table;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨äºç¼“å­˜å…·ä½“å…ƒç´ çš„é›†åˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">transient</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The number of key-value mappings contained in this map.</span></span><br><span class="line"><span class="comment"> * HashMapä¸­çš„å®æ—¶å®¹é‡ï¼Œéæ•°ç»„é•¿åº¦</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">transient</span> <span class="type">int</span> size;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¯æ¬¡æ‰©å®¹å’Œæ›´æ”¹Mapç»“æ„çš„è®¡æ•°å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">transient</span> <span class="type">int</span> modCount;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é˜ˆå€¼ï¼ˆä¸´ç•Œå€¼ï¼‰ï¼Œå½“å®é™…å¤§å°ï¼ˆæ•°ç»„å®¹é‡*è´Ÿè½½å› å­ï¼‰è¶…è¿‡ä¸´ç•Œå€¼æ—¶ï¼Œä¼šè¿›è¡Œæ‰©å®¹</span></span><br><span class="line"><span class="comment"> * é»˜è®¤åˆå§‹åŒ– size=16(DEFAULT_INITIAL_CAPACITY)*0.75(DEFAULT_LOAD_FACTOR)=12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> threshold;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è´Ÿè½½å› å­ã€‚0åˆ°1èŒƒå›´å–å€¼ï¼Œç”¨äºè¡¡é‡HashMapæ»¡çš„ç¨‹åº¦ï¼Œå€¼è¶Šå°HashMapè¶Šç¨€ç–ï¼Œå½±å“Hashæ“ä½œåˆ°</span></span><br><span class="line"><span class="comment"> * ä¸€ä¸ªæ•°ç»„ä½ç½®çš„æ¦‚ç‡ï¼Œè®¡ç®— HashMap çš„å®æ—¶åŠ è½½å› å­çš„æ–¹æ³•ä¸ºï¼šsizeï¼ˆå®æ—¶Entryå¤§å°ï¼‰/capacityï¼ˆæ¡¶çš„å®¹é‡ï¼‰ï¼Œè€Œä¸æ˜¯å ç”¨æ¡¶çš„æ•°é‡å»é™¤ä»¥capacity</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">final</span> <span class="type">float</span> loadFactor;</span><br></pre></td></tr></tbody></table></figure>

<p>å¼ºè°ƒä¸€ä¸‹éå¸¸é‡è¦çš„å±æ€§ loadFactorã€‚</p>
<p>loadFactor å¤ªå¤§ä¼šå¯¼è‡´æŸ¥æ‰¾æ•ˆç‡ä½ï¼Œå¤ªå°åˆä¼šå¯¼è‡´æ•°ç»„åˆ©ç”¨ç‡ä½ï¼Œå­˜æ”¾çš„æ•°æ®ä¼šå¾ˆåˆ†æ•£ï¼ŒloadFactoré»˜è®¤çš„0.75f æ˜¯å®˜æ–¹ç»è¿‡å¤§é‡å®éªŒç»™å‡ºçš„ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ä¸´ç•Œå€¼ã€‚å½“æ•°ç»„çš„é•¿åº¦è¾¾åˆ°75%æ—¶ï¼Œè¡¨ç¤ºHashMapå¤ªæŒ¤äº†ï¼Œéœ€è¦æ‰©å®¹ï¼Œè€Œæ‰©å®¹éœ€è¦ rehashã€å¤åˆ¶æ•°æ®ç­‰æ“ä½œï¼Œéå¸¸æ¶ˆè€—æ€§èƒ½ã€‚æ‰€ä»¥å¼€å‘ä¸­å°½é‡å‡å°‘æ‰©å®¹æ¬¡æ•°ï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºHashMapæ—¶æŒ‡å®šåˆå§‹å®¹é‡æ¥å°½é‡é¿å…ã€‚</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆ loadFactor = 0.75f ä¸å»ºè®®ä¿®æ”¹ï¼Ÿ</p>
</blockquote>
<p>thresholdï¼ˆé˜ˆå€¼ï¼‰ = capacity * 0.75ï¼Œé»˜è®¤åˆå§‹åŒ–åé˜ˆå€¼ä¸º12ã€‚</p>
<p>å½“åˆå§‹loadFactorå¤ªå°ï¼Œå¦‚ loadFactor=0.4æ—¶ï¼Œé‚£ä¹ˆè®¡ç®—å‡ºçš„é˜ˆå€¼ 16*0.4=6ï¼Œæ­¤æ—¶çš„æ•°ç»„é•¿åº¦ä¸º16ï¼Œè¾¾åˆ°6ä¸ªå®¹é‡åå°±ä¼šæ‰©å®¹ï¼Œå¯¼è‡´å¦å¤–çš„10ä¸ªç©ºé—´æµªè´¹ã€æ‰©å®¹é‡æ–°è®¡ç®—hashå’Œå¤åˆ¶æ•°æ®ã€‚</p>
<p>å½“åˆå§‹loadFactorå¤ªå¤§ï¼Œå¦‚loadFactor=0.9æ—¶ï¼Œé‚£ä¹ˆè®¡ç®—å‡ºé˜ˆå€¼ä¸º14ï¼Œè®©æ•°ç»„çš„ç©ºé—´å……åˆ†åˆ©ç”¨æ˜¯å¾ˆéš¾çš„ï¼Œé˜ˆå€¼è¿‡å¤§ä¼šå¯¼è‡´å¢å¤§æ¯ä¸ªæ¡¶é‡ŒèŠ‚ç‚¹éå¸¸å¤šçš„æ¦‚ç‡ï¼Œå½“æ•°ç»„é•¿åº¦å¤§äº64èŠ‚ç‚¹é•¿åº¦å¤§äº8ä¹‹åæ ‘åŒ–ï¼Œçº¢é»‘æ ‘ä¸æ–­è¿›è¡Œä¿æŒå¹³è¡¡çš„æ“ä½œï¼Œå¯¼è‡´æ•ˆç‡åè€Œæ›´ä½ã€‚</p>
<h2 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h2><p><strong>HashMap()</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">HashMap</span><span class="params">()</span> {</span><br><span class="line">   <span class="comment">// å°†é»˜è®¤çš„è´Ÿè½½å› å­0.75èµ‹å€¼ç»™loadFactorï¼Œå¹¶æ²¡æœ‰åˆ›å»ºæ•°ç»„</span></span><br><span class="line">   <span class="built_in">this</span>.loadFactor = DEFAULT_LOAD_FACTOR;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>HashMap(int initialCapacity, float loadFactor)</strong></p>
<p>æ„é€ ä¸€ä¸ªå…·æœ‰æŒ‡å®šçš„åˆå§‹å®¹é‡å’Œé»˜è®¤è´Ÿè½½å› å­ï¼ˆ0.75ï¼‰HashMap ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">HashMap</span><span class="params">(<span class="type">int</span> initialCapacity, <span class="type">float</span> loadFactor)</span> {</span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">"Illegal initial capacity: "</span> +</span><br><span class="line">                                           initialCapacity);</span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class="line">        initialCapacity = MAXIMUM_CAPACITY;</span><br><span class="line">    <span class="keyword">if</span> (loadFactor &lt;= <span class="number">0</span> || Float.isNaN(loadFactor))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">"Illegal load factor: "</span> +</span><br><span class="line">                                           loadFactor);</span><br><span class="line">    <span class="built_in">this</span>.loadFactor = loadFactor;</span><br><span class="line">    <span class="comment">// ä¸‹é¢è¿™è¡ŒæŒ‰ç†åº”è¯¥æ˜¯ threshold=tableSizeFor(initialCapacity)*loadFactor</span></span><br><span class="line">    <span class="comment">// ä½†è¿™ä¸æ˜¯BUGï¼Œåœ¨ put æ–¹æ³•ä¸­ä¼šå¯¹é˜ˆå€¼è¿›è¡Œä¿®æ”¹</span></span><br><span class="line">    <span class="built_in">this</span>.threshold = tableSizeFor(initialCapacity);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>HashMap(Map&lt;? extends K, ? extends V&gt; m)</strong></p>
<p>åŒ…å«å¦ä¸€ä¸ª Map çš„æ„é€ å‡½æ•°</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// æ„é€ ä¸€ä¸ªæ˜ å°„å…³ç³»ä¸æŒ‡å®š Map ç›¸åŒçš„æ–° HashMap</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HashMap</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m)</span> {</span><br><span class="line">    <span class="built_in">this</span>.loadFactor = DEFAULT_LOAD_FACTOR;</span><br><span class="line">    putMapEntries(m, <span class="literal">false</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">putMapEntries</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m, <span class="type">boolean</span> evict)</span> {</span><br><span class="line">    <span class="type">int</span> <span class="variable">s</span> <span class="operator">=</span> m.size();</span><br><span class="line">    <span class="keyword">if</span> (s &gt; <span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">if</span> (table == <span class="literal">null</span>) {</span><br><span class="line">            <span class="comment">// ä¸‹é¢å•ç‹¬è®²è¿™ä¸€è¡Œ</span></span><br><span class="line">            <span class="type">float</span> <span class="variable">ft</span> <span class="operator">=</span> ((<span class="type">float</span>)s / loadFactor) + <span class="number">1.0F</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> ((ft &lt; (<span class="type">float</span>)MAXIMUM_CAPACITY) ?</span><br><span class="line">                     (<span class="type">int</span>)ft : MAXIMUM_CAPACITY);</span><br><span class="line">            <span class="comment">// threshold=0</span></span><br><span class="line">            <span class="keyword">if</span> (t &gt; threshold)</span><br><span class="line">                <span class="comment">// åˆå§‹é˜ˆå€¼(threshold)</span></span><br><span class="line">                threshold = tableSizeFor(t);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s &gt; threshold)</span><br><span class="line">            resize();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;? <span class="keyword">extends</span> <span class="title class_">K</span>, ? <span class="keyword">extends</span> <span class="title class_">V</span>&gt; e : m.entrySet()) {</span><br><span class="line">            <span class="type">K</span> <span class="variable">key</span> <span class="operator">=</span> e.getKey();</span><br><span class="line">            <span class="type">V</span> <span class="variable">value</span> <span class="operator">=</span> e.getValue();</span><br><span class="line">            putVal(hash(key), key, value, <span class="literal">false</span>, evict);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸ºä»€ä¹ˆè¦åŠ  1.0Fï¼Ÿ</span></span><br><span class="line"><span class="type">float</span> <span class="variable">ft</span> <span class="operator">=</span> ((<span class="type">float</span>)s / loadFactor) + <span class="number">1.0F</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>s/loadFactor çš„ç»“æœæ˜¯å°æ•°ï¼ŒåŠ  1.0F ä¸ (int)ft ç›¸å½“äºæ˜¯å¯¹å°æ•°åšä¸€ä¸ªå‘ä¸Šå–æ•´ä»¥å°½å¯èƒ½çš„ä¿è¯æ›´å¤§å®¹é‡ï¼Œæ›´å¤§çš„å®¹é‡èƒ½å¤Ÿå‡å°‘ resize çš„è°ƒç”¨æ¬¡æ•°ã€‚æ‰€ä»¥ + 1.0F æ˜¯ä¸ºäº†è·å–æ›´å¤§çš„å®¹é‡ã€‚</p>
<p>ä¾‹å¦‚ï¼šåŸæ¥é›†åˆçš„å…ƒç´ ä¸ªæ•°æ˜¯ 6 ä¸ªï¼Œé‚£ä¹ˆ ft = 6/0.75=8ï¼Œæ˜¯ 2 çš„næ¬¡å¹‚ï¼Œé‚£ä¹ˆæ–°æ•°ç»„å¤§å°å°±æ˜¯ 8 äº†ã€‚ç„¶ååŸæ¥æ•°ç»„çš„æ•°æ®å°±ä¼šå­˜å‚¨åˆ°é•¿åº¦æ˜¯ 8 çš„æ–°æ•°ç»„ä¸­ï¼Œè¿™æ ·ä¼šå¯¼è‡´åœ¨å­˜å‚¨å…ƒç´ çš„æ—¶å€™ï¼Œå®¹é‡ä¸å¤Ÿï¼Œè¿˜å¾—ç»§ç»­æ‰©å®¹ï¼Œé‚£ä¹ˆæ€§èƒ½é™ä½äº†ï¼Œè€Œå¦‚æœ +1 å‘¢ï¼Œæ•°ç»„é•¿åº¦ç›´æ¥å˜ä¸º16äº†ï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ•°ç»„çš„æ‰©å®¹ã€‚</p>
<h2 id="æˆå‘˜æ–¹æ³•"><a href="#æˆå‘˜æ–¹æ³•" class="headerlink" title="æˆå‘˜æ–¹æ³•"></a>æˆå‘˜æ–¹æ³•</h2><p> <strong>put()</strong></p>
<p>å®ç°æ­¥éª¤ï¼š</p>
<p>1ã€å…ˆé€šè¿‡ hash å€¼è®¡ç®—å‡º key æ˜ å°„åˆ°å“ªä¸ªæ¡¶ï¼›</p>
<p>2ã€å¦‚æœæ¡¶ä¸Šæ²¡æœ‰ç¢°æ’å†²çªï¼Œåˆ™ç›´æ¥æ’å…¥ï¼›</p>
<p>3ã€å¦‚æœå‡ºç°ç¢°æ’å†²çªäº†ï¼Œåˆ™éœ€è¦å¤„ç†å†²çªï¼š</p>
<ul>
<li><p>a å¦‚æœè¯¥æ¡¶ä½¿ç”¨çº¢é»‘æ ‘å¤„ç†å†²çªï¼Œåˆ™è°ƒç”¨çº¢é»‘æ ‘çš„æ–¹æ³•æ’å…¥æ•°æ®ï¼›</p>
</li>
<li><p>b å¦åˆ™é‡‡ç”¨ä¼ ç»Ÿçš„é“¾å¼æ–¹æ³•æ’å…¥ã€‚å¦‚æœé“¾çš„é•¿åº¦è¾¾åˆ°ä¸´ç•Œå€¼ï¼Œåˆ™æŠŠé“¾è½¬å˜ä¸ºçº¢é»‘æ ‘ï¼›</p>
</li>
</ul>
<p>4ã€å¦‚æœæ¡¶ä¸­å­˜åœ¨é‡å¤çš„é”®ï¼Œåˆ™ä¸ºè¯¥é”®æ›¿æ¢æ–°å€¼ valueï¼›</p>
<p>5ã€å¦‚æœ size å¤§äºé˜ˆå€¼ thresholdï¼Œåˆ™è¿›è¡Œæ‰©å®¹ï¼›</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">put</span><span class="params">(K key, V value)</span> {</span><br><span class="line">	<span class="keyword">return</span> putVal(hash(key), key, value, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨HashMapä¸­ï¼Œkey å’Œ value æ˜¯å…è®¸ä¸º null çš„</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(Object key)</span> {</span><br><span class="line">    <span class="type">int</span> h;</span><br><span class="line">    <span class="comment">/** å¦‚æœkeyä¸ºnullï¼Œåˆ™è¿”å›hashå€¼ä¸º0</span></span><br><span class="line"><span class="comment">     * å¦‚æœä¸ä¸ºnullï¼Œé¦–å…ˆè®¡ç®—å‡ºkeyçš„hashCodeèµ‹å€¼ç»™hï¼Œ</span></span><br><span class="line"><span class="comment">     * ç„¶åä¸hæ— ç¬¦å·å³ç§»16ä½ï¼ˆä¸ºäº†åˆ é™¤é«˜ä½ï¼Œä¿è¯ä»»ä½•å“ˆå¸Œå€¼éƒ½èƒ½å˜å°ï¼‰åçš„äºŒè¿›åˆ¶è¿›è¡ŒæŒ‰ä½å¼‚æˆ–å¾—åˆ°æœ€åçš„hashå€¼</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="keyword">return</span> (key == <span class="literal">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Implements Map.put and related methods</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> hash hash for key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key the key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value the value to put</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> onlyIfAbsent if true, don't change existing value</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> evict if false, the table is in creation mode.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> previous value, or null if none</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">final</span> V <span class="title function_">putVal</span><span class="params">(<span class="type">int</span> hash, K key, V value, <span class="type">boolean</span> onlyIfAbsent,</span></span><br><span class="line"><span class="params">               <span class="type">boolean</span> evict)</span> {</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="type">int</span> n, i;</span><br><span class="line">    <span class="comment">// åˆæ¬¡è°ƒç”¨putValæ–¹æ³•æ—¶this.tableæ˜¯nullï¼Œåœ¨resizeæ–¹æ³•ä¸­åˆå§‹åŒ–é˜ˆå€¼ï¼Œè¿”å›é‡æ–°åˆ›å»ºçš„æ•°ç»„</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="comment">// é€šè¿‡i = (n - 1) &amp; hash è®¡ç®—å‡ºæ”¾å…¥æ•°ç»„çš„ä¸‹æ ‡ï¼ŒæŠŠ table[i] çš„æ¡¶èµ‹å€¼ç»™ p</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ•°ç»„ä¸­åœ¨içš„ä½ç½®æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="literal">null</span>)</span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">    <span class="comment">// å¦‚æœåœ¨table[i]çš„ä½ç½®ä¸Šæ¡¶é‡Œæœ‰èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="comment">// på°±æ˜¯æ•°ç»„ä¸Šç¬¬iä¸ªæ¡¶(p=table[i])ï¼Œç„¶åæ¯”è¾ƒä¸¤ä¸ªkeyçš„å“ˆå¸Œå€¼å’Œå¼•ç”¨åœ°å€æ˜¯å¦ç›¸åŒ</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œçš„å¤šä¸ªåˆ¤æ–­æ˜¯ä¸ºäº†é¿å…å“ˆå¸Œå€¼ä¸€æ ·ï¼Œkeyä¸ä¸€æ ·çš„æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            e = p;</span><br><span class="line">        <span class="comment">// å¦‚æœä¸¤ä¸ªkeyä¸ç›¸åŒï¼Œåˆ™åˆ¤æ–­å½“å‰æ¡¶ä¸­æ˜¯ä¸æ˜¯æ ‘</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode) </span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="built_in">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="comment">// ä¸¤ä¸ªkeyä¸ç›¸åŒï¼Œä¸æ˜¯æ ‘ï¼Œé‚£ä¹ˆæ¡¶é‡Œå°±æ˜¯é“¾è¡¨</span></span><br><span class="line">        <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">// binCount è¡¨ç¤ºæ˜¯å½“å‰é“¾è¡¨ä¸­çš„ç¬¬binCountä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">binCount</span> <span class="operator">=</span> <span class="number">0</span>; ; ++binCount) {</span><br><span class="line">                <span class="comment">// åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯ä¸æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œç›´æ¥åˆ’å‡ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="literal">null</span>) {</span><br><span class="line">                    p.next = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// æ ‘åŒ–çš„ç¬¬ä¸€è¦æ±‚ï¼šé“¾è¡¨èŠ‚ç‚¹æ•°æ˜¯å¦åˆ°è¾¾æ ‘åŒ–é˜ˆå€¼</span></span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                }</span><br><span class="line">  		       <span class="comment">// è¿™é‡Œçš„åˆ¤æ–­æ˜¯ä¸ºäº†åˆ¤æ–­keyæ˜¯å¦å’Œå½“å‰ç¬¬ binCount ä¸ªèŠ‚ç‚¹çš„keyç›¸åŒï¼Œ</span></span><br><span class="line">                <span class="comment">// å¦‚æœæ’å…¥çš„keyå’Œpçš„è¿™ä¸ªkeyç›¸åŒï¼Œåˆ™é€€å‡ºå¾ªç¯ï¼Œè¯´æ˜å·²ç»æ‰¾åˆ°äº†é‡å¤çš„å€¼ï¼Œ</span></span><br><span class="line">                <span class="comment">// æ²¡å¿…è¦åœ¨æ¥ç€å¾€ä¸‹éå†å®Œæ‰€æœ‰çš„èŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">// å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ç§»åŠ¨æŒ‡é’ˆ</span></span><br><span class="line">                p = e;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// å½“æ’å…¥keyå’Œæ¡¶ä¸­çš„ä¸€ä¸ªkeyç›¸åŒåï¼Œe å°±æ˜¯é€€å‡ºå¾ªç¯ä¹‹å‰æœ€åæŒ‡å‘çš„é‚£ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) { <span class="comment">// existing mapping for key</span></span><br><span class="line">            <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> e.value;</span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="literal">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<h4 id="ä¸ºä»€ä¹ˆè¦é€šè¿‡-n-1-amp-hash-å¾—åˆ°ä¸‹æ ‡ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦é€šè¿‡-n-1-amp-hash-å¾—åˆ°ä¸‹æ ‡ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦é€šè¿‡ (n - 1) &amp; hash å¾—åˆ°ä¸‹æ ‡ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦é€šè¿‡ (n - 1) &amp; hash å¾—åˆ°ä¸‹æ ‡ï¼Ÿ</h4></blockquote>
<p>æ³¨æ„è¿™é‡Œçš„næ˜¯æ•°ç»„çš„å®¹é‡å¤§å°ï¼Œæ­¤å¤„çš„ n-1 ç›¸å½“äº 2çš„næ¬¡å¹‚-1ï¼ŒäºŒè¿›åˆ¶å°±æ˜¯nä¸ª1ï¼Œä¸hashè¿›è¡Œä¸è¿ç®—ï¼Œå¯ä»¥ä¿è¯è®¡ç®—å‡ºæ¥çš„ä¸‹æ ‡åœ¨æ•°ç»„å¤§å°çš„èŒƒå›´å†…ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">å‡è®¾å­˜å‚¨çš„keyæ˜¯k1ï¼Œk1.hashCode()=3366ï¼Œé€šè¿‡hash()è®¡ç®—å‡ºhash=3366</span><br><span class="line">å¦‚æœnå‡å»1ï¼š(n - 1) &amp; hash</span><br><span class="line">0000 0000 0000 0000 0000 0000 0000 1111   15</span><br><span class="line">0000 0000 0000 0000 0000 1101 0010 0110   15&amp;3366</span><br><span class="line">0000 0000 0000 0000 0000 0000 0000 0110   6  ä¸‹æ ‡</span><br></pre></td></tr></tbody></table></figure>

<p>å¦‚æœ n ä¸å‡ 1ï¼Œé¦–å…ˆnæ˜¯2çš„næ¬¡å¹‚ï¼ŒäºŒè¿›åˆ¶æ˜¯ä¸€ä¸ª1åé¢nä¸ª0ï¼Œä¸hashè¿›è¡Œä¸è¿ç®—ï¼Œå¾ˆå¤§æ¦‚ç‡ä¼šé€ æˆè®¡ç®—å‡ºæ¥çš„ä¸‹æ ‡éƒ½æ˜¯0ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">å¦‚æœnä¸å‡1ï¼šn &amp; hash</span><br><span class="line">0000 0000 0000 0000 | 0000 0000 0001 0000  16</span><br><span class="line">0000 0000 0000 0000 | 0000 1101 0010 0110  16&amp;3366</span><br><span class="line">0000 0000 0000 0000 | 0000 0000 0000 0000  0   ä¸‹æ ‡</span><br></pre></td></tr></tbody></table></figure>

<h2 id="é“¾è¡¨æ ‘åŒ–"><a href="#é“¾è¡¨æ ‘åŒ–" class="headerlink" title="é“¾è¡¨æ ‘åŒ–"></a>é“¾è¡¨æ ‘åŒ–</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">treeifyBin</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="type">int</span> hash)</span> {</span><br><span class="line">    <span class="type">int</span> n, index; Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="comment">// æ ‘åŒ–çš„ç¬¬äºŒä¸ªè¦æ±‚ï¼šæ•°ç»„é•¿åº¦æ˜¯å¦è¾¾åˆ°64ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (tab == <span class="literal">null</span> || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY)</span><br><span class="line">         <span class="comment">// èŠ‚ç‚¹æ•°å¤§äº8ï¼Œä½†æ˜¯æ•°ç»„é•¿åº¦æ²¡æœ‰è¾¾åˆ°64è¿›è¡Œæ‰©å®¹ï¼ˆå®¹é‡æ‰©å¤§ä¸¤å€ï¼‰</span></span><br><span class="line">        resize();</span><br><span class="line">    <span class="comment">// e æ˜¯ table[i] è¿™ä¸ªæ¡¶</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ((e = tab[index = (n - <span class="number">1</span>) &amp; hash]) != <span class="literal">null</span>) {</span><br><span class="line">        <span class="comment">// è€å¤–å‘½åï¼šhdæ˜¯headï¼Œtlæ˜¯tail</span></span><br><span class="line">        TreeNode&lt;K,V&gt; hd = <span class="literal">null</span>, tl = <span class="literal">null</span>;</span><br><span class="line">         <span class="comment">// do while æŠŠé“¾è¡¨èŠ‚ç‚¹å¤„ç†æˆæ ‘èŠ‚ç‚¹ç„¶åè¿èµ·æ¥</span></span><br><span class="line">        <span class="keyword">do</span> {</span><br><span class="line">            TreeNode&lt;K,V&gt; p = replacementTreeNode(e, <span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">if</span> (tl == <span class="literal">null</span>)</span><br><span class="line">                hd = p;</span><br><span class="line">            <span class="keyword">else</span> {</span><br><span class="line">                p.prev = tl;</span><br><span class="line">                tl.next = p;</span><br><span class="line">            }</span><br><span class="line">            tl = p;</span><br><span class="line">        } <span class="keyword">while</span> ((e = e.next) != <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">if</span> ((tab[index] = hd) != <span class="literal">null</span>)</span><br><span class="line">            <span class="comment">// è®©æ ‘å¹³è¡¡</span></span><br><span class="line">            hd.treeify(tab);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="æ‰©å®¹"><a href="#æ‰©å®¹" class="headerlink" title="æ‰©å®¹"></a>æ‰©å®¹</h2><blockquote>
<h4 id="ä»€ä¹ˆæ—¶å€™æ‰©å®¹ï¼Ÿ"><a href="#ä»€ä¹ˆæ—¶å€™æ‰©å®¹ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ—¶å€™æ‰©å®¹ï¼Ÿ"></a>ä»€ä¹ˆæ—¶å€™æ‰©å®¹ï¼Ÿ</h4></blockquote>
<p>å½“HashMapä¸­å…ƒç´ ä¸ªæ•°è¶…è¿‡é˜ˆå€¼ï¼ˆthreshold=capacityï¼ˆæ•°ç»„å®¹é‡ï¼‰*loadFactorï¼ˆé»˜è®¤0.75ï¼‰æ—¶æ‰©å®¹ï¼Œcapacity æ‰©å¤§åˆ°2x16=32ã€‚</p>
<p>æ‰©å®¹æ˜¯ä¸€ä¸ªéå¸¸è€—æ€§èƒ½çš„æ“ä½œï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬èƒ½é¢„çŸ¥ HashMapä¸­å…ƒç´ çš„ä¸ªæ•°ï¼Œé‚£ä¹ˆé¢„çŸ¥å…ƒç´ çš„ä¸ªæ•°èƒ½å¤Ÿæœ‰æ•ˆåœ°æé«˜HashMapçš„æ€§èƒ½ã€‚</p>
<blockquote>
<h4 id="HashMapçš„æ‰©å®¹æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#HashMapçš„æ‰©å®¹æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="HashMapçš„æ‰©å®¹æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ"></a>HashMapçš„æ‰©å®¹æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ</h4></blockquote>
<p>è¿›è¡Œæ‰©å®¹ï¼Œä¼šä¼´éšç€ä¸€æ¬¡é‡æ–°è®¡ç®— hash å’Œæ’å…¥çš„ä¸‹æ ‡ï¼Œå¹¶ä¸”ä¼šéå† hash è¡¨ä¸­æ‰€æœ‰çš„å…ƒç´ ï¼Œæ˜¯éå¸¸è€—æ—¶çš„ã€‚åœ¨ç¼–å†™ç¨‹åºä¸­ï¼Œè¦å°½é‡é¿å… resizeã€‚</p>
<p>HashMap åœ¨è¿›è¡Œæ‰©å®¹æ—¶ï¼Œä½¿ç”¨çš„ rehash æ–¹å¼éå¸¸å·§å¦™ï¼Œå› ä¸ºæ¯æ¬¡æ‰©å®¹éƒ½æ˜¯ç¿»å€ï¼Œä¸åŸæ¥è®¡ç®—çš„ (n - 1) &amp; hash çš„ç»“æœç›¸æ¯”ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ª bit ä½ï¼Œæ‰€ä»¥æ–°èŠ‚ç‚¹è¦ä¹ˆå°±åœ¨åŸæ¥çš„ä½ç½®ï¼Œè¦ä¹ˆå°±è¢«åˆ†é…åˆ° â€œåŸä½ç½® + æ—§å®¹é‡â€ è¿™ä¸ªä½ç½®ã€‚</p>
<p>é€šè¿‡ (n-1)&amp;hash è®¡ç®—å‡ºä¸‹æ ‡ï¼Œnæ˜¯æ•°ç»„çš„å®¹é‡å¤§å°ï¼ˆ2çš„næ¬¡å¹‚ï¼‰ï¼Œn-1ç­‰äº2çš„næ¬¡å¹‚-1ï¼ŒäºŒè¿›åˆ¶å°±æ˜¯nä¸ª1ã€‚HashMap æ¯æ¬¡æ‰©å®¹æ˜¯åœ¨åŸæ¥çš„å®¹é‡ä¸Šx2ï¼Œæ‰©å®¹åçš„æ•°ç»„å®¹é‡å¤§å°ä¸º2çš„n+1æ¬¡å¹‚ï¼Œn-1å°±ç­‰äº2çš„n+1æ¬¡å¹‚-1ï¼ŒäºŒè¿›åˆ¶ä¸Šå°±ç›¸å½“äºæ¯”2çš„næ¬¡å¹‚å°±å¤šäº†ä¸€ä¸ªbitä½ã€‚è®¡ç®—å‡ºä¸‹æ ‡çš„äºŒè¿›åˆ¶è¦ä¹ˆä¸å˜ï¼Œè¦ä¹ˆå¤šä¸€ä¸ªbitä½ã€‚</p>
<p><img src="/p/9da5e46/HashMap-rehash.png" alt="rehash"><br>        å› æ­¤ï¼Œåœ¨æ‰©å®¹çš„æ—¶å€™ï¼Œä¸éœ€è¦é‡æ–°è®¡ç®— hashï¼Œåªéœ€è¦çœ‹çœ‹åŸæ¥çš„ hash å€¼æ–°å¢çš„é‚£ä¸ª bit æ˜¯ 1 è¿˜æ˜¯ 0 å°±å¯ä»¥äº†ï¼Œæ˜¯ 0 çš„è¯ç´¢å¼•æ²¡å˜ï¼Œæ˜¯ 1 çš„è¯ç´¢å¼•å˜æˆ <strong>â€œåŸä½ç½® + æ—§å®¹é‡â€</strong> ã€‚å¯ä»¥çœ‹çœ‹ä¸‹å›¾ä¸º 16 æ‰©å……ä¸º 32 çš„ resize ç¤ºæ„å›¾ï¼š</p>
<p><img src="/p/9da5e46/HashMap-resize.png" alt="resize"><br>        æ­£æ˜¯å› ä¸ºè¿™æ ·å·§å¦™çš„ rehash æ–¹å¼ï¼Œæ—¢çœå»äº†é‡æ–°è®¡ç®— hash å€¼çš„æ—¶é—´ï¼Œè€Œä¸”åŒæ—¶ï¼Œç”±äºæ–°å¢çš„ 1 bit æ˜¯ 0 è¿˜æ˜¯ 1 å¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„ï¼Œåœ¨ resize çš„è¿‡ç¨‹ä¸­ä¿è¯äº† rehash ä¹‹åæ¯ä¸ªæ¡¶ä¸Šçš„ç»“ç‚¹æ•°ä¸€å®šå°äºç­‰äºåŸæ¥æ¡¶ä¸Šçš„ç»“ç‚¹æ•°ï¼Œä¿è¯äº† rehash ä¹‹åä¸ä¼šå‡ºç°æ›´ä¸¥é‡çš„ hash å†²çªï¼Œå‡åŒ€çš„æŠŠä¹‹å‰çš„å†²çªçš„ç»“ç‚¹åˆ†æ•£åˆ°æ–°çš„æ¡¶ä¸­äº†ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() {</span><br><span class="line">    Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">oldCap</span> <span class="operator">=</span> (oldTab == <span class="literal">null</span>) ? <span class="number">0</span> : oldTab.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">oldThr</span> <span class="operator">=</span> threshold;</span><br><span class="line">    <span class="comment">// æ–°å®¹é‡ æ–°é˜ˆå€¼</span></span><br><span class="line">    <span class="type">int</span> newCap, newThr = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//======== if...elseif...else...åªæ˜¯ä¸ºäº†åˆå§‹åŒ–æ–°å®¹é‡å’Œæ–°é˜ˆå€¼ =========</span></span><br><span class="line">    <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) {</span><br><span class="line">        <span class="comment">// æœ€å¤§å®¹é‡æ˜¯2çš„30æ¬¡æ–¹</span></span><br><span class="line">        <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) {</span><br><span class="line">            threshold = Integer.MAX_VALUE;</span><br><span class="line">            <span class="keyword">return</span> oldTab;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// æ–°å®¹é‡ç­‰äºæ‰©å®¹å‰çš„å®¹é‡å·¦ç§»ä¸€ä½ï¼ˆç›¸å½“äºX2ï¼‰</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">            <span class="comment">// æ–°é˜ˆå€¼ä¹Ÿæ‰©å¤§X2</span></span><br><span class="line">            newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// å¦‚æœæ—§å®¹é‡ä¸º0ï¼Œæ—§é˜ˆå€¼å¤§äº0ï¼Œåˆ™æ–°å®¹é‡å°±ç­‰äºé˜ˆå€¼</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold</span></span><br><span class="line">        newCap = oldThr;</span><br><span class="line">    <span class="comment">// æ—§å®¹é‡ä¸º0ï¼Œé˜ˆå€¼ä¸º0</span></span><br><span class="line">    <span class="keyword">else</span> {               <span class="comment">// zero initial threshold signifies using defaults</span></span><br><span class="line">        newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class="line">        newThr = (<span class="type">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// å¦‚æœé»˜è®¤çš„åŠ è½½å› å­ä¸º0æˆ–åˆå§‹å®¹é‡ä¸º0</span></span><br><span class="line">    <span class="keyword">if</span> (newThr == <span class="number">0</span>) {</span><br><span class="line">        <span class="comment">// è®¡ç®—æ–°é˜ˆå€¼</span></span><br><span class="line">        <span class="type">float</span> <span class="variable">ft</span> <span class="operator">=</span> (<span class="type">float</span>)newCap * loadFactor;</span><br><span class="line">        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="type">float</span>)MAXIMUM_CAPACITY ?</span><br><span class="line">                  (<span class="type">int</span>)ft : Integer.MAX_VALUE);</span><br><span class="line">    }</span><br><span class="line">    threshold = newThr;</span><br><span class="line">    <span class="meta">@SuppressWarnings({"rawtypes","unchecked"})</span></span><br><span class="line">    Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> <span class="title class_">Node</span>[newCap];</span><br><span class="line">    table = newTab;</span><br><span class="line">    <span class="keyword">if</span> (oldTab != <span class="literal">null</span>) {</span><br><span class="line">        <span class="comment">// éå†å–å‡ºæ—§æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªæ¡¶</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; oldCap; ++j) {</span><br><span class="line">            Node&lt;K,V&gt; e;</span><br><span class="line">            <span class="comment">// æŠŠç¬¬jä¸ªæ¡¶èµ‹å€¼ç»™e</span></span><br><span class="line">            <span class="keyword">if</span> ((e = oldTab[j]) != <span class="literal">null</span>) {</span><br><span class="line">                oldTab[j] = <span class="literal">null</span>;</span><br><span class="line">                <span class="comment">// åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">if</span> (e.next == <span class="literal">null</span>)</span><br><span class="line">                    newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line">                <span class="comment">// æ˜¯æ ‘</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                    ((TreeNode&lt;K,V&gt;)e).split(<span class="built_in">this</span>, newTab, j, oldCap);</span><br><span class="line">                <span class="comment">// æ˜¯é“¾è¡¨</span></span><br><span class="line">                <span class="keyword">else</span> { <span class="comment">// preserve order</span></span><br><span class="line">                    Node&lt;K,V&gt; loHead = <span class="literal">null</span>, loTail = <span class="literal">null</span>;</span><br><span class="line">                    Node&lt;K,V&gt; hiHead = <span class="literal">null</span>, hiTail = <span class="literal">null</span>;</span><br><span class="line">                    Node&lt;K,V&gt; next;</span><br><span class="line">                    <span class="keyword">do</span> {</span><br><span class="line">                        next = e.next;</span><br><span class="line">                        <span class="comment">// ä½¿ç”¨&amp;ï¼ˆä¸è¿ç®—ï¼‰æ¥è®¡ç®—æœ€é«˜ä½æ˜¯0è¿˜æ˜¯1</span></span><br><span class="line">                        <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) {</span><br><span class="line">                      		<span class="comment">// è¿™é‡Œçš„if...else...ç”¨äºèŠ‚ç‚¹çš„ç§»åŠ¨æ“ä½œ</span></span><br><span class="line">                            <span class="keyword">if</span> (loTail == <span class="literal">null</span>)</span><br><span class="line">                                loHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                loTail.next = e;</span><br><span class="line">                            <span class="comment">// å¦‚æœæ˜¯0ï¼ŒæŠŠå½“å‰æ¡¶èµ‹å€¼ç»™loTail</span></span><br><span class="line">                            loTail = e;</span><br><span class="line">                        }</span><br><span class="line">                        <span class="keyword">else</span> {</span><br><span class="line">                            <span class="keyword">if</span> (hiTail == <span class="literal">null</span>)</span><br><span class="line">                                hiHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                hiTail.next = e;</span><br><span class="line">                            <span class="comment">// å¦‚æœæ˜¯1ï¼ŒæŠŠå½“å‰æ¡¶èµ‹å€¼ç»™ hiTail</span></span><br><span class="line">                            hiTail = e;</span><br><span class="line">                        }</span><br><span class="line">                    } <span class="keyword">while</span> ((e = next) != <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// å¦‚æœæ˜¯0ï¼Œæ”¾å›åŸä½ç½®ä¸åŠ¨</span></span><br><span class="line">                    <span class="keyword">if</span> (loTail != <span class="literal">null</span>) {</span><br><span class="line">                        loTail.next = <span class="literal">null</span>;</span><br><span class="line">                        newTab[j] = loHead;</span><br><span class="line">                    }</span><br><span class="line">                    <span class="comment">// å¦‚æœæ˜¯1ï¼Œæ–°çš„ä¸‹æ ‡ä¸ºï¼šæ—§ä¸‹æ ‡+æ—§å®¹é‡</span></span><br><span class="line">                    <span class="keyword">if</span> (hiTail != <span class="literal">null</span>) {</span><br><span class="line">                        hiTail.next = <span class="literal">null</span>;</span><br><span class="line">                        newTab[j + oldCap] = hiHead;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> newTab;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h2><p>æ‰¾åˆ°å…ƒç´ æ‰€åœ¨æ•°ç»„ä¸Šçš„ä½ç½®ï¼Œéå†æ¡¶ï¼Œæ‰¾åˆ°å…ƒç´ å°±åœæ­¢éå†ï¼›å¦‚æœæ˜¯æ ‘ï¼Œåˆ é™¤ä¹‹ååˆ¤æ–­å½“å‰æ¡¶çš„èŠ‚ç‚¹æ˜¯å¦å°äº6ï¼Œå°äºå°±è½¬é“¾è¡¨ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">remove</span><span class="params">(Object key)</span> {</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="comment">// è®¡ç®—keyçš„hashå€¼</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ‰¾åˆ°äº†å°±è¿”å›åˆ é™¤keyçš„valueï¼Œå¦åˆ™è¿”å›null</span></span><br><span class="line">    <span class="keyword">return</span> (e = removeNode(hash(key), key, <span class="literal">null</span>, <span class="literal">false</span>, <span class="literal">true</span>)) == <span class="literal">null</span> ?</span><br><span class="line">        <span class="literal">null</span> : e.value;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Implements Map.remove and related methods</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> hash hash for key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key the key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value the value to match if matchValue, else ignored å¦‚æœå€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> matchValue if true only remove if value is equal æ˜¯å¦å€¼ç›¸ç­‰æ‰åˆ é™¤</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> movable if false do not move other nodes while removing</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the node, or null if none</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title function_">removeNode</span><span class="params">(<span class="type">int</span> hash, Object key, Object value,</span></span><br><span class="line"><span class="params">                           <span class="type">boolean</span> matchValue, <span class="type">boolean</span> movable)</span> {</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="type">int</span> n, index;</span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="literal">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        <span class="comment">// é€šè¿‡åˆ é™¤keyè®¡ç®—çš„ä¸‹æ ‡iï¼Œåœ¨æ•°ç»„ä¸­å»æ‰¾iè¿™ä¸ªä½ç½®</span></span><br><span class="line">        (p = tab[index = (n - <span class="number">1</span>) &amp; hash]) != <span class="literal">null</span>) {</span><br><span class="line">        Node&lt;K,V&gt; node = <span class="literal">null</span>, e; K k; V v;</span><br><span class="line">        <span class="comment">// æ¯”è¾ƒä¸¤ä¸ªkeyæ˜¯å¦å®Œå…¨ç›¸åŒï¼ˆå€¼ã€å¼•ç”¨åœ°å€ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            <span class="comment">// æ‰¾åˆ°è¿™ä¸ªå…ƒç´ ä¹‹åæŠŠè¿™ä¸ªå…ƒç´ èµ‹å€¼ç»™node</span></span><br><span class="line">            node = p;</span><br><span class="line">        <span class="comment">// å¦‚æœè¿˜æœ‰èŠ‚ç‚¹ï¼Œé‚£ä¹ˆéœ€è¦åˆ¤æ–­æ˜¯æ ‘è¿˜æ˜¯é“¾è¡¨åœ¨æ¥ç€éå†</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((e = p.next) != <span class="literal">null</span>) {</span><br><span class="line">            <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key);</span><br><span class="line">            <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">do</span> {</span><br><span class="line">                    <span class="comment">// æ‰¾åˆ°å…ƒç´ å°±é€€å‡ºå¾ªç¯</span></span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                        ((k = e.key) == key ||</span><br><span class="line">                         (key != <span class="literal">null</span> &amp;&amp; key.equals(k)))) {</span><br><span class="line">                        node = e;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    }</span><br><span class="line">                    <span class="comment">// å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ç§»åŠ¨ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ºnull</span></span><br><span class="line">                    p = e;</span><br><span class="line">                } <span class="keyword">while</span> ((e = e.next) != <span class="literal">null</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// æ‰¾åˆ°äº†</span></span><br><span class="line">        <span class="keyword">if</span> (node != <span class="literal">null</span> &amp;&amp; (!matchValue || (v = node.value) == value ||</span><br><span class="line">                             (value != <span class="literal">null</span> &amp;&amp; value.equals(v)))) {</span><br><span class="line">            <span class="keyword">if</span> (node <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                <span class="comment">// çº¢é»‘æ ‘çš„åˆ é™¤æ–¹æ³•</span></span><br><span class="line">                ((TreeNode&lt;K,V&gt;)node).removeTreeNode(<span class="built_in">this</span>, tab, movable);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (node == p)</span><br><span class="line">                tab[index] = node.next;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                p.next = node.next;</span><br><span class="line">            ++modCount;</span><br><span class="line">            --size;</span><br><span class="line">            afterNodeRemoval(node);</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(Object key)</span> {</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="comment">// è®¡ç®—keyçš„hashå€¼</span></span><br><span class="line">    <span class="keyword">return</span> (e = getNode(hash(key), key)) == <span class="literal">null</span> ? <span class="literal">null</span> : e.value;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title function_">getNode</span><span class="params">(<span class="type">int</span> hash, Object key)</span> {</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="type">int</span> n; K k;</span><br><span class="line">    <span class="comment">// é€šè¿‡keyè®¡ç®—çš„ä¸‹æ ‡iï¼Œåˆ¤æ–­åœ¨æ•°ç»„çš„ç¬¬iä¸ªä½ç½®æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="literal">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        (first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="literal">null</span>) {</span><br><span class="line">        <span class="comment">// æ¯”è¾ƒkeyå’Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„keyæ˜¯å¦å®Œå…¨ç›¸åŒ</span></span><br><span class="line">        <span class="keyword">if</span> (first.hash == hash &amp;&amp; <span class="comment">// always check first node</span></span><br><span class="line">            ((k = first.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            <span class="keyword">return</span> first;</span><br><span class="line">        <span class="comment">// æ‰¾ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ¤æ–­ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯æ ‘è¿˜æ˜¯é“¾è¡¨ï¼Œå†æ¥ç€éå†å…¶å®ƒèŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> ((e = first.next) != <span class="literal">null</span>) {</span><br><span class="line">            <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                <span class="keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">            <span class="keyword">do</span> {</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">return</span> e;</span><br><span class="line">            } <span class="keyword">while</span> ((e = e.next) != <span class="literal">null</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>çº¢é»‘æ ‘çš„æŠ˜åŠé€’å½’æŸ¥æ‰¾æ–¹æ³•</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> TreeNode&lt;K,V&gt; <span class="title function_">getTreeNode</span><span class="params">(<span class="type">int</span> h, Object k)</span> {</span><br><span class="line">    <span class="keyword">return</span> ((parent != <span class="literal">null</span>) ? root() : <span class="built_in">this</span>).find(h, k, <span class="literal">null</span>);</span><br><span class="line">}</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * h æŸ¥æ‰¾keyçš„hashå€¼</span></span><br><span class="line"><span class="comment"> * kc å…³é”®å­—keyçš„æ¯”è¾ƒå™¨ç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">final</span> TreeNode&lt;K,V&gt; <span class="title function_">find</span><span class="params">(<span class="type">int</span> h, Object k, Class&lt;?&gt; kc)</span> {</span><br><span class="line">    TreeNode&lt;K,V&gt; p = <span class="built_in">this</span>;</span><br><span class="line">    <span class="keyword">do</span> {</span><br><span class="line">        <span class="comment">// ph å½“å‰èŠ‚ç‚¹çš„hashå€¼ï¼Œpk å½“å‰èŠ‚ç‚¹çš„key</span></span><br><span class="line">        <span class="type">int</span> ph, dir; K pk;</span><br><span class="line">        TreeNode&lt;K,V&gt; pl = p.left, pr = p.right, q;</span><br><span class="line">        <span class="comment">// å½“å‰çš„èŠ‚ç‚¹çš„hashå€¼æ˜¯å¦å¤§äºä¼ å…¥keyçš„hashå€¼</span></span><br><span class="line">        <span class="keyword">if</span> ((ph = p.hash) &gt; h)</span><br><span class="line">            p = pl;</span><br><span class="line">        <span class="comment">// å¦‚æœå°äºï¼Œåˆ™ä»å³èŠ‚ç‚¹èµ‹å€¼ç»™p</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (ph &lt; h)</span><br><span class="line">            p = pr;</span><br><span class="line">        <span class="comment">// å¦‚æœç›¸ç­‰ï¼Œåˆ™æ¯”è¾ƒæ˜¯å¦å®Œå…¨ç›¸ç­‰ï¼ˆå€¼ã€å¼•ç”¨åœ°å€ï¼‰</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((pk = p.key) == k || (k != <span class="literal">null</span> &amp;&amp; k.equals(pk)))</span><br><span class="line">            <span class="keyword">return</span> p;</span><br><span class="line">        <span class="comment">// å¦‚æœå·¦èŠ‚ç‚¹ä¸ºç©ºï¼ŒæŠŠå³èŠ‚ç‚¹èµ‹å€¼ç»™p</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pl == <span class="literal">null</span>)</span><br><span class="line">            p = pr;</span><br><span class="line">        <span class="comment">// å¦‚æœå³èŠ‚ç‚¹ä¸ºç©ºï¼ŒæŠŠå·¦èŠ‚ç‚¹èµ‹å€¼ç»™p</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pr == <span class="literal">null</span>)</span><br><span class="line">            p = pl;</span><br><span class="line">        <span class="comment">// å¦‚æœä¸æŒ‰å“ˆå¸Œå€¼æ’åºï¼Œè€Œæ˜¯æŒ‰ç…§æ¯”è¾ƒå™¨æ’åºï¼Œåˆ™é€šè¿‡æ¯”è¾ƒå™¨è¿”å›å€¼å†³å®šè¿›å…¥å·¦å³ç»“ç‚¹</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((kc != <span class="literal">null</span> ||</span><br><span class="line">                  (kc = comparableClassFor(k)) != <span class="literal">null</span>) &amp;&amp;</span><br><span class="line">                 (dir = compareComparables(kc, k, pk)) != <span class="number">0</span>)</span><br><span class="line">            p = (dir &lt; <span class="number">0</span>) ? pl : pr;</span><br><span class="line">        <span class="comment">// é€’å½’é‡æ–°æŸ¥æ‰¾</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((q = pr.find(h, k, kc)) != <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> q;</span><br><span class="line">        <span class="type">else</span></span><br><span class="line">            <span class="variable">p</span> <span class="operator">=</span> pl;</span><br><span class="line">    } <span class="keyword">while</span> (p != <span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>çº¢é»‘æ ‘çš„æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(logn)</p>
<p>é“¾è¡¨æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(n)</p>
<p>O(logn)&lt;O(n) ï¼Œæ‰€ä»¥çº¢é»‘æ ‘æ•ˆç‡æ¯”é“¾è¡¨é«˜ã€‚</p>
<hr>
<p>åˆ°è¿™é‡Œä¸ºæ­¢ï¼ŒHashMapçš„åŸç†å°±ç®—å®Œäº†ï¼Œä¸‹é¢å›é¡¾ä¸€ä¸‹éå†çš„å››ç§æ–¹å¼ï¼š</p>
<h2 id="HashMapçš„éå†"><a href="#HashMapçš„éå†" class="headerlink" title="HashMapçš„éå†"></a>HashMapçš„éå†</h2><ol>
<li>åˆ†åˆ«éå† key å’Œ value</li>
</ol>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (String key : map.keySet()) {</span><br><span class="line">	System.out.println(key);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">for</span> (Object vlaue : map.values() {</span><br><span class="line">	System.out.println(value);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ol start="2">
<li>ä½¿ç”¨ Iterator è¿­ä»£å™¨è¿­ä»£</li>
</ol>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Iterator&lt;Map.Entry&lt;String, Object&gt;&gt; iterator = map.entrySet().iterator();</span><br><span class="line"><span class="keyword">while</span> (iterator.hasNext()) {</span><br><span class="line">    Map.Entry&lt;String, Object&gt; mapEntry = iterator.next();</span><br><span class="line">    System.out.println(mapEntry.getKey() + <span class="string">"---"</span> + mapEntry.getValue());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ol start="3">
<li>é€šè¿‡ get æ–¹å¼ï¼ˆä¸å»ºè®®ä½¿ç”¨ï¼‰</li>
</ol>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Set&lt;String&gt; keySet = map.keySet();</span><br><span class="line"><span class="keyword">for</span> (String str : keySet) {</span><br><span class="line">	System.out.println(str + <span class="string">"---"</span> + map.get(str));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ ¹æ®é˜¿é‡Œå¼€å‘æ‰‹å†Œï¼Œä¸å»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå› ä¸ºè¿­ä»£ä¸¤æ¬¡ã€‚keySet è·å– Iteratorä¸€æ¬¡ï¼Œè¿˜æœ‰é€šè¿‡ get åˆè¿­ä»£ä¸€æ¬¡ï¼Œé™ä½æ€§èƒ½ã€‚</p>
<ol start="4">
<li>jdk8 ä»¥åä½¿ç”¨ Map.foreach((k,v)-&gt;{ System.out.println(key + â€œâ€”â€œ + value); })</li>
</ol>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">HashMap&lt;String,String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">map.put(<span class="string">"k1"</span>, <span class="string">"v1"</span>);</span><br><span class="line">map.put(<span class="string">"k2"</span>, <span class="string">"v2"</span>);</span><br><span class="line">map.forEach((key, value) -&gt; {</span><br><span class="line">    System.out.println(key + <span class="string">"---"</span> + value);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<h2 id="ã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹çš„å»ºè®®"><a href="#ã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹çš„å»ºè®®" class="headerlink" title="ã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹çš„å»ºè®®"></a>ã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹çš„å»ºè®®</h2><p>å¯ä»¥ä½¿ç”¨ Guava çš„ Maps.newHashMapWithExpectedSize(å®é™…ç”¨é‡)æ¥åˆ›å»ºä¸€ä¸ªåˆç†çš„HashMapã€‚ </p>
<p>å…³äºè®¾ç½® HashMap çš„åˆå§‹åŒ–å®¹é‡ï¼š</p>
<p>æˆ‘ä»¬ä¸Šé¢ä»‹ç»è¿‡ï¼ŒHashMap çš„æ‰©å®¹æœºåˆ¶ï¼Œå°±æ˜¯å½“è¾¾åˆ°æ‰©å®¹æ¡ä»¶æ—¶ä¼šè¿›è¡Œæ‰©å®¹ã€‚HashMap çš„æ‰©å®¹æ¡ä»¶å°±æ˜¯å½“ HashMap ä¸­çš„å…ƒç´ ä¸ªæ•°ï¼ˆsizeï¼‰è¶…è¿‡ä¸´ç•Œå€¼ï¼ˆthresholdï¼‰æ—¶å°±ä¼šè‡ªåŠ¨æ‰©å®¹ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰è®¾ç½®åˆå§‹å®¹é‡å¤§å°ï¼Œéšç€å…ƒç´ çš„ä¸æ–­å¢åŠ ï¼ŒHashMap ä¼šæœ‰å¯èƒ½å‘ç”Ÿå¤šæ¬¡æ‰©å®¹ï¼Œè€Œ HashMap ä¸­çš„æ‰©å®¹æœºåˆ¶å†³å®šäº†æ¯æ¬¡æ‰©å®¹éƒ½éœ€è¦é‡å»º hash è¡¨ï¼Œæ˜¯éå¸¸å½±å“æ€§èƒ½çš„ã€‚</p>
<p>ä½†æ˜¯è®¾ç½®åˆå§‹åŒ–å®¹é‡ï¼Œè®¾ç½®çš„æ•°å€¼ä¸åŒä¹Ÿä¼šå½±å“æ€§èƒ½ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬å·²çŸ¥ HashMap ä¸­å³å°†å­˜æ”¾çš„ KV ä¸ªæ•°çš„æ—¶å€™ï¼Œå®¹é‡è®¾ç½®æˆå¤šå°‘ä¸ºå¥½å‘¢ï¼Ÿ</p>
<p>å…³äºè®¾ç½® HashMap çš„åˆå§‹åŒ–å®¹é‡å¤§å°ï¼š</p>
<p>å¯ä»¥è®¤ä¸ºï¼Œå½“æˆ‘ä»¬æ˜ç¡®çŸ¥é“ HashMap ä¸­å…ƒç´ çš„ä¸ªæ•°çš„æ—¶å€™ï¼ŒæŠŠé»˜è®¤å®¹é‡è®¾ç½®æˆ initialCapacity/ 0.75F + 1.0F æ˜¯ä¸€ä¸ªåœ¨æ€§èƒ½ä¸Šç›¸å¯¹å¥½çš„é€‰æ‹©ï¼Œä½†æ˜¯ï¼ŒåŒæ—¶ä¹Ÿä¼šç‰ºç‰²äº›å†…å­˜ã€‚</p>
<p>è€Œ Jdk å¹¶ä¸ä¼šç›´æ¥æ‹¿ç”¨æˆ·ä¼ è¿›æ¥çš„æ•°å­—å½“åšé»˜è®¤å®¹é‡ï¼Œè€Œæ˜¯ä¼šè¿›è¡Œä¸€ç•ªè¿ç®—ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ª 2 çš„å¹‚ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Objectç±»</title>
    <url>/p/7ace31b3.html</url>
    <content><![CDATA[<html><head></head><body><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// native æ–¹æ³•ï¼Œç”¨äºè¿”å›å½“å‰è¿è¡Œæ—¶å¯¹è±¡çš„ Class å¯¹è±¡ï¼Œä½¿ç”¨äº†final å…³é”®å­—ä¿®é¥°ï¼Œä¸å…è®¸å­ç±»é‡å†™ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> Class&lt;?&gt; getClass()</span><br><span class="line"></span><br><span class="line"> <span class="comment">// native æ–¹æ³•ï¼Œç”¨äºè¿”å›å¯¹è±¡çš„å“ˆå¸Œç ï¼Œä¸»è¦ä½¿ç”¨åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œæ¯”å¦‚ JDK ä¸­çš„HashMapã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”¨äºæ¯”è¾ƒ 2 ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€æ˜¯å¦ç›¸ç­‰ï¼ŒString ç±»å¯¹è¯¥æ–¹æ³•è¿›è¡Œäº†é‡å†™ç”¨æˆ·æ¯”è¾ƒå­—ç¬¦ä¸²çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//naitive æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºå¹¶è¿”å›å½“å‰å¯¹è±¡çš„ä¸€ä»½æ‹·è´ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹äºä»»ä½•å¯¹è±¡ xï¼Œè¡¨è¾¾å¼ x.clone() != x ä¸º trueï¼Œx.clone().getClass()== x.getClass() ä¸º trueã€‚Object æœ¬èº«æ²¡æœ‰å®ç° Cloneable æ¥å£ï¼Œæ‰€ä»¥ä¸é‡å†™ clone æ–¹æ³•å¹¶ä¸”è¿›è¡Œè°ƒç”¨çš„è¯ä¼šå‘ç”ŸCloneNotSupportedException å¼‚å¸¸ã€‚</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">native</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿”å›ç±»çš„åå­—@å®ä¾‹çš„å“ˆå¸Œç çš„ 16 è¿›åˆ¶çš„å­—ç¬¦ä¸²ã€‚å»ºè®® Object æ‰€æœ‰çš„å­ç±»éƒ½é‡å†™è¿™ä¸ªæ–¹æ³•ã€‚</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//native æ–¹æ³•ï¼Œå¹¶ä¸”ä¸èƒ½é‡å†™ã€‚å”¤é†’ä¸€ä¸ªåœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„çº¿ç¨‹(ç›‘è§†å™¨ç›¸å½“äºå°±æ˜¯é”çš„æ¦‚å¿µ)ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…åªä¼šä»»æ„å”¤é†’ä¸€ä¸ªã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//native æ–¹æ³•ï¼Œå¹¶ä¸”ä¸èƒ½é‡å†™ã€‚è·Ÿ notify ä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ä¼šå”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">notifyAll</span><span class="params">()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//native æ–¹æ³•ï¼Œå¹¶ä¸”ä¸èƒ½é‡å†™ã€‚æš‚åœçº¿ç¨‹çš„æ‰§è¡Œã€‚æ³¨æ„ï¼šsleep æ–¹æ³•æ²¡æœ‰é‡Šæ”¾é”ï¼Œè€Œ wait æ–¹æ³•é‡Šæ”¾äº†é” ã€‚timeout æ˜¯ç­‰å¾…æ—¶é—´ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">wait</span><span class="params">(<span class="type">long</span> timeout)</span> <span class="keyword">throws</span> InterruptedException</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¤šäº† nanos å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°è¡¨ç¤ºé¢å¤–æ—¶é—´ï¼ˆä»¥æ¯«å¾®ç§’ä¸ºå•ä½ï¼ŒèŒƒå›´æ˜¯ 0-999999ï¼‰ã€‚ æ‰€ä»¥è¶…æ—¶çš„æ—¶é—´è¿˜éœ€è¦åŠ ä¸Š nanos æ¯«ç§’ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">wait</span><span class="params">(<span class="type">long</span> timeout, <span class="type">int</span> nanos)</span> <span class="keyword">throws</span> InterruptedException</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·Ÿä¹‹å‰çš„ 2 ä¸ª wait æ–¹æ³•ä¸€æ ·ï¼Œåªä¸è¿‡è¯¥æ–¹æ³•ä¸€ç›´ç­‰å¾…ï¼Œæ²¡æœ‰è¶…æ—¶æ—¶é—´è¿™ä¸ªæ¦‚å¿µ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">wait</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ä¾‹è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„æ—¶å€™è§¦å‘çš„æ“ä½œ</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable { }</span><br></pre></td></tr></tbody></table></figure>

</body></html>]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Queueæ¥å£</title>
    <url>/p/18ebe4f.html</url>
    <content><![CDATA[<html><head></head><body><p>é˜Ÿåˆ—çš„ç‰¹ç‚¹æ˜¯å…ˆè¿›å…ˆå‡ºï¼Œæ ˆçš„ç‰¹ç‚¹æ˜¯åè¿›å…ˆå‡ºã€‚Queueç»§æ‰¿Collectionæ¥å£ï¼ŒStackç»§æ‰¿Vectorå®¹å™¨ç±»ï¼Œæœ€é¡¶å±‚æ¥å£ä¹Ÿæ˜¯Collectionã€‚åœ¨Javaä¸­å®¹å™¨åˆ†ä¸ºCollectionå’ŒMapä¸¤å¤§ç±»ã€‚ Collectionå®¶æ—ä¸­é™¤äº†å¸¸è§çš„Listã€Setï¼Œç°åœ¨åˆæ–°å¢ä¸€ä¸ªQueueã€Stackã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Queue</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">Collection</span>&lt;E&gt; {}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="BlockingQueue-çš„å››ç»„API"><a href="#BlockingQueue-çš„å››ç»„API" class="headerlink" title="BlockingQueue çš„å››ç»„API"></a>BlockingQueue çš„å››ç»„API</h3><table>
<thead>
<tr>
<th>æ–¹å¼</th>
<th>æŠ›å‡ºå¼‚å¸¸</th>
<th>ä¸æŠ›å¼‚å¸¸ï¼Œæœ‰è¿”å›å€¼</th>
<th>é˜»å¡ç­‰å¾…</th>
<th>è¶…æ—¶ç­‰å¾…</th>
</tr>
</thead>
<tbody><tr>
<td>å…¥é˜Ÿåˆ—</td>
<td>add</td>
<td>offer</td>
<td>put</td>
<td>offer(Element,Time,TimeUnit)</td>
</tr>
<tr>
<td>å‡ºé˜Ÿåˆ—</td>
<td>remove</td>
<td>poll</td>
<td>take</td>
<td>poll(,)</td>
</tr>
<tr>
<td>è¿”å›å¤´éƒ¨å…ƒç´ </td>
<td>element</td>
<td>peek</td>
<td>-</td>
<td>-</td>
</tr>
</tbody></table>
<p>BlockingQueueä¸»è¦æœ‰ä¸¤ä¸ªå®ç°ï¼šArrayBlockingQueueã€LinkedBlockingQueueã€‚</p>
<p>BlockingQueueçš„å…¶ä¸­ä¸€ç»„æ ¸å¿ƒæ–¹æ³•ï¼ˆåªä»‹ç»å…¶ä¸­ä¸€ç»„ï¼Œå…¶å®ƒä¸‰ç»„ç±»ä¼¼ï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•å</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>offer(anObject)</td>
<td>è¡¨ç¤ºå¦‚æœå¯ä»¥çš„è¯ï¼Œå°†anObjectåŠ åˆ°BlockingQueueé‡Œï¼Œæ”¾å…¥æˆåŠŸè¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚</td>
</tr>
<tr>
<td>offer(E o, long timeout, TimeUnit unit)</td>
<td>å¯ä»¥è®¾å®šç­‰å¾…çš„æ—¶é—´ï¼Œå¦‚æœåœ¨æŒ‡å®šçš„æ—¶é—´å†…ï¼Œè¿˜ä¸èƒ½å¾€é˜Ÿåˆ—ä¸­åŠ å…¥BlockingQueueï¼Œåˆ™è¿”å›å¤±è´¥ã€‚</td>
</tr>
<tr>
<td>put(anObject)</td>
<td>æŠŠanObjectåŠ åˆ°BlockingQueueé‡Œ,å¦‚æœBlockQueueæ²¡æœ‰ç©ºé—´,åˆ™è°ƒç”¨æ­¤æ–¹æ³•çš„çº¿ç¨‹è¢«é˜»æ–­ç›´åˆ°BlockingQueueé‡Œé¢æœ‰ç©ºé—´å†ç»§ç»­ã€‚</td>
</tr>
<tr>
<td>poll(time)</td>
<td>å–èµ°BlockingQueueé‡Œæ’åœ¨é¦–ä½çš„å¯¹è±¡,è‹¥ä¸èƒ½ç«‹å³å–å‡º,åˆ™å¯ä»¥ç­‰timeå‚æ•°è§„å®šçš„æ—¶é—´,å–ä¸åˆ°æ—¶è¿”å›nullã€‚</td>
</tr>
<tr>
<td>poll(long timeout, TimeUnit unit)</td>
<td>ä»BlockingQueueå–å‡ºä¸€ä¸ªé˜Ÿé¦–çš„å¯¹è±¡ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…ï¼Œé˜Ÿåˆ—ä¸€æ—¦æœ‰æ•°æ®å¯å–ï¼Œåˆ™ç«‹å³è¿”å›é˜Ÿåˆ—ä¸­çš„æ•°æ®ã€‚å¦åˆ™ç›´åˆ°æ—¶é—´è¶…æ—¶è¿˜æ²¡æœ‰æ•°æ®å¯å–ï¼Œè¿”å›å¤±è´¥ã€‚</td>
</tr>
<tr>
<td>take()</td>
<td>å–èµ°BlockingQueueé‡Œæ’åœ¨é¦–ä½çš„å¯¹è±¡,è‹¥BlockingQueueä¸ºç©º,é˜»æ–­è¿›å…¥ç­‰å¾…çŠ¶æ€ç›´åˆ°BlockingQueueæœ‰æ–°çš„æ•°æ®è¢«åŠ å…¥;ã€‚</td>
</tr>
<tr>
<td>drainTo()</td>
<td>ä¸€æ¬¡æ€§ä»BlockingQueueè·å–æ‰€æœ‰å¯ç”¨çš„æ•°æ®å¯¹è±¡ï¼ˆè¿˜å¯ä»¥æŒ‡å®šè·å–æ•°æ®çš„ä¸ªæ•°ï¼‰ï¼Œé€šè¿‡è¯¥æ–¹æ³•ï¼Œå¯ä»¥æå‡è·å–æ•°æ®æ•ˆç‡ï¼›ä¸éœ€è¦å¤šæ¬¡åˆ†æ‰¹åŠ é”æˆ–é‡Šæ”¾é”ã€‚</td>
</tr>
</tbody></table>
<p>åœ¨ArrayBlockingQueueä¸­å¯¹poll(long timeout, TimeUnit unit) æ–¹æ³•çš„å…·ä½“å®ç°ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">poll</span><span class="params">(<span class="type">long</span> timeout, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">    <span class="comment">// åº•å±‚ç»Ÿä¸€æ˜¯ä»¥çº³ç§’ä½œä¸ºæ—¶é—´çš„è®¡ç®—å•ä½çš„</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">nanos</span> <span class="operator">=</span> unit.toNanos(timeout);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="built_in">this</span>.lock;</span><br><span class="line">    lock.lockInterruptibly();</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="comment">// è½®è¯¢è·å–å…ƒç´ å‡ºé˜Ÿåˆ—</span></span><br><span class="line">        <span class="keyword">while</span> (count == <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">if</span> (nanos &lt;= <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            nanos = notEmpty.awaitNanos(nanos);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> dequeue();</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        lock.unlock();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>åº”ç”¨ç¤ºä¾‹</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">BlockingQueue&lt;String&gt; queue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line"><span class="comment">// åŒæ­¥é˜Ÿåˆ—ä¸å­˜å‚¨å…ƒç´ ï¼šä¸€ä¸ªå…ƒç´ è¿›å‡ºå®Œæˆåï¼Œä¸‹ä¸€ä¸ªå…ƒç´ æ‰èƒ½è¿›å‡ºã€‚</span></span><br><span class="line">BlockingQueue&lt;String&gt; syncQueue = <span class="keyword">new</span> <span class="title class_">SynchronousQueue</span>&lt;&gt;();</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŠ›å¼‚å¸¸:</span></span><br><span class="line"><span class="comment"> * add()ã€remove()ã€element()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> {</span><br><span class="line">    <span class="comment">// ============== add ============= //</span></span><br><span class="line">    queue.add(<span class="string">"1"</span>);</span><br><span class="line">    queue.add(<span class="string">"2"</span>);</span><br><span class="line">    queue.add(<span class="string">"3"</span>);</span><br><span class="line">    <span class="comment">// å†è¿›ä¸€ä¸ªå…ƒç´ åˆ™æŠ¥é”™</span></span><br><span class="line">    queue.add(<span class="string">"4"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============== element ============= //</span></span><br><span class="line">    <span class="comment">// æ£€æŸ¥é˜Ÿé¦–å…ƒç´ ï¼ˆè¯¥æ“ä½œä¸ä¼šå‡ºé˜Ÿåˆ—ï¼‰</span></span><br><span class="line">    System.out.println(queue.element());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============== remove ============= //</span></span><br><span class="line">    System.out.println(queue.remove());</span><br><span class="line">    System.out.println(queue.remove());</span><br><span class="line">    System.out.println(queue.remove());</span><br><span class="line">    <span class="comment">// å†å–ä¸€ä¸ª</span></span><br><span class="line">    System.out.println(queue.remove());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸æŠ›å¼‚å¸¸ï¼Œæœ‰è¿”å›å€¼</span></span><br><span class="line"><span class="comment"> * offer()ã€poll()ã€peek()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> {</span><br><span class="line">    <span class="comment">// ============== offer ============= //</span></span><br><span class="line">    queue.offer(<span class="string">"1"</span>);</span><br><span class="line">    queue.offer(<span class="string">"2"</span>);</span><br><span class="line">    queue.offer(<span class="string">"3"</span>);</span><br><span class="line">    <span class="comment">// å†æ·»åŠ ä¸€ä¸ª</span></span><br><span class="line">    System.out.println(queue.offer(<span class="string">"4"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============== poll ============= //</span></span><br><span class="line">    <span class="comment">// æ£€æŸ¥é˜Ÿé¦–å…ƒç´ ï¼ˆè¯¥æ“ä½œä¸ä¼šå‡ºé˜Ÿåˆ—ï¼‰</span></span><br><span class="line">    System.out.println(queue.peek());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============== peek ============= //</span></span><br><span class="line">    queue.poll();</span><br><span class="line">    queue.poll();</span><br><span class="line">    queue.poll();</span><br><span class="line">    System.out.println(queue.size());</span><br><span class="line">    <span class="comment">// å†å–ä¸€ä¸ª</span></span><br><span class="line">    System.out.println(queue.poll());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é˜»å¡ç­‰å¾…</span></span><br><span class="line"><span class="comment"> * putã€take</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">    <span class="comment">// ============== put ============= //</span></span><br><span class="line">    queue.put(<span class="string">"1"</span>);</span><br><span class="line">    queue.put(<span class="string">"2"</span>);</span><br><span class="line">    queue.put(<span class="string">"3"</span>);</span><br><span class="line">    <span class="comment">// å†æ·»åŠ ä¸€ä¸ªï¼Œé˜»å¡</span></span><br><span class="line">    queue.put(<span class="string">"4"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============== take ============= //</span></span><br><span class="line">    queue.take();</span><br><span class="line">    queue.take();</span><br><span class="line">    queue.take();</span><br><span class="line">    System.out.println(queue.size());</span><br><span class="line">    <span class="comment">// å†å–ä¸€ä¸ªï¼Œé˜»å¡</span></span><br><span class="line">    queue.take();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¶…æ—¶ç­‰å¾…</span></span><br><span class="line"><span class="comment"> * offerã€poll</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">    queue.offer(<span class="string">"1"</span>);</span><br><span class="line">    queue.offer(<span class="string">"2"</span>);</span><br><span class="line">    queue.offer(<span class="string">"3"</span>);</span><br><span class="line">    <span class="comment">// 2såå…¥é˜Ÿåˆ—å¤±è´¥</span></span><br><span class="line">    System.out.println(queue.offer(<span class="string">"4"</span>, <span class="number">2</span>, TimeUnit.SECONDS));</span><br><span class="line"></span><br><span class="line">    queue.poll();</span><br><span class="line">    queue.poll();</span><br><span class="line">    queue.poll();</span><br><span class="line">    System.out.println(queue.size());</span><br><span class="line">    <span class="comment">// 2såå‡ºé˜Ÿåˆ—å¤±è´¥</span></span><br><span class="line">    System.out.println(queue.poll(<span class="number">2</span>, TimeUnit.SECONDS));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="SynchronousQueue"><a href="#SynchronousQueue" class="headerlink" title="SynchronousQueue"></a>SynchronousQueue</h3><p>åŒæ­¥é˜Ÿåˆ—ï¼Œä¸å­˜å‚¨å…ƒç´ ï¼Œä¸€ä¸ªå…ƒç´ è¿›å‡ºå®Œæˆåï¼Œä¸‹ä¸€ä¸ªå…ƒç´ æ‰èƒ½è¿›å‡ºã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŒæ­¥é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼šçº¿ç¨‹ä¸€å­˜å–ä¸‰ä¸ªå…ƒç´ ï¼Œçº¿ç¨‹äºŒè¯»å–ä¸‰ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test5</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">" put 1"</span>);</span><br><span class="line">            syncQueue.put(<span class="string">"1"</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">" put 2"</span>);</span><br><span class="line">            syncQueue.put(<span class="string">"2"</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">" put 3"</span>);</span><br><span class="line">            syncQueue.put(<span class="string">"3"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }, <span class="string">"A"</span>).start();</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// ç­‰å¾…ä¸¤ç§’å†å–ï¼Œç¡®ä¿çº¿ç¨‹1å…¥é˜Ÿåˆ—æˆåŠŸ</span></span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"=&gt;"</span> + syncQueue.take());</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"=&gt;"</span> + syncQueue.take());</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"=&gt;"</span> + syncQueue.take());</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }, <span class="string">"B"</span>).start();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="PriorityQueue-ä¼˜å…ˆçº§é˜Ÿåˆ—"><a href="#PriorityQueue-ä¼˜å…ˆçº§é˜Ÿåˆ—" class="headerlink" title="PriorityQueue ä¼˜å…ˆçº§é˜Ÿåˆ—"></a>PriorityQueue ä¼˜å…ˆçº§é˜Ÿåˆ—</h3><p>PriorityQueueæ˜¯ä¸€ä¸ªå¸¦æœ‰ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼Œå…ƒç´ æŒ‰ä¼˜å…ˆçº§é¡ºåºè¢«ç§»é™¤ï¼Œè¯¥é˜Ÿåˆ—ä¹Ÿæ²¡æœ‰ä¸Šé™ï¼ˆå³ Integer.MAX_VALUEï¼‰ï¼Œæ— å®¹é‡é™åˆ¶ï¼Œè‡ªåŠ¨æ‰©å®¹ã€‚</p>
<p>æ­¤é˜Ÿåˆ—è™½ç„¶æ²¡æœ‰å®¹é‡é™åˆ¶ï¼Œä½†æ˜¯ä¼šç”±äºæœåŠ¡å™¨èµ„æºè€—å°½æŠ›OutOfMemoryErrorå¼‚å¸¸ã€‚</p>
<p>å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£ä¹ˆå–å…ƒç´ çš„æ“ä½œtakeå°±ä¼šé˜»å¡ï¼Œæ‰€ä»¥æ£€ç´¢æ“ä½œtakeæ˜¯å—é˜»çš„ã€‚</p>
<p>æ”¾å…¥PriorityQueueä¸­çš„å…ƒç´ éœ€è¦å…·æœ‰æ¯”è¾ƒèƒ½åŠ›ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PriorityQueueDemo</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">// è®¾ç½®æ¯”å¯¹æ–¹å¼</span></span><br><span class="line">        PriorityQueue&lt;String&gt; priorityQueue = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;String&gt;() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(String o1, String o2)</span> {</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        priorityQueue.add(<span class="string">"c"</span>);</span><br><span class="line">        priorityQueue.add(<span class="string">"a"</span>);</span><br><span class="line">        priorityQueue.add(<span class="string">"b"</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(priorityQueue.poll());</span><br><span class="line">        System.out.println(priorityQueue.poll());</span><br><span class="line">        System.out.println(priorityQueue.poll());</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å®šä¹‰MessageObjectå­˜æ”¾çš„ä¼˜å…ˆçº§</span></span><br><span class="line">        PriorityQueue&lt;MessageObject&gt; MessageObjectQueue = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;MessageObject&gt;() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(MessageObject o1, MessageObject o2)</span> {</span><br><span class="line">                <span class="comment">// Orderæ¯”è¾ƒå¤§çš„MessageObjectæ”¾åé¢</span></span><br><span class="line">                <span class="keyword">return</span> o1.order &gt; o2.order ? -<span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MessageObject</span> {</span><br><span class="line">        String content;</span><br><span class="line">        <span class="type">int</span> order;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸‹é¢æ¢å¯»ä¸€ä¸‹å»¶æ—¶é˜Ÿåˆ—çš„å®ç°åŸç†ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelayQueue</span>&lt;E <span class="keyword">extends</span> <span class="title class_">Delayed</span>&gt; <span class="keyword">extends</span> <span class="title class_">AbstractQueue</span>&lt;E&gt;</span><br><span class="line">    <span class="keyword">implements</span> <span class="title class_">BlockingQueue</span>&lt;E&gt; {</span><br><span class="line">    <span class="comment">// åŸºäºPriorityQueueæ¥å®ç°çš„å»¶æ—¶é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PriorityQueue&lt;E&gt; q = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;E&gt;();</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>DelayQueueçš„æ³›å‹å¿…é¡»å®ç°Delayedæ¥å£ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Delayed</span> <span class="keyword">extends</span> <span class="title class_">Comparable</span>&lt;Delayed&gt; {</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the remaining delay associated with this object, in the</span></span><br><span class="line"><span class="comment">     * given time unit.</span></span><br><span class="line"><span class="comment">     * è¿™ä¸ªå…ƒç´ éœ€è¦åœ¨é˜Ÿåˆ—ä¸­å¾…å¤šä¹…æ—¶é—´</span></span><br><span class="line"><span class="comment">     </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit the time unit</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the remaining delay; zero or negative values indicate</span></span><br><span class="line"><span class="comment">     * that the delay has already elapsed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">long</span> <span class="title function_">getDelay</span><span class="params">(TimeUnit unit)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>åº”ç”¨ç¤ºä¾‹</strong></p>
<p>çº¿ç¨‹æ± ä¸­çš„å®šæ—¶è°ƒåº¦å°±æ˜¯ä½¿ç”¨è¿™æ ·çš„æ–¹æ³•å®ç°çš„ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelayQueueDemo</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">        DelayQueue&lt;Message&gt; delayQueue = <span class="keyword">new</span> <span class="title class_">DelayQueue</span>&lt;Message&gt;();</span><br><span class="line">        <span class="comment">// è¿™æ¡æ¶ˆæ¯5ç§’åå‘é€</span></span><br><span class="line">        <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="string">"message - 00001"</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + <span class="number">5000L</span>));</span><br><span class="line">        delayQueue.add(message);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) {</span><br><span class="line">            System.out.println(delayQueue.poll());</span><br><span class="line">            Thread.sleep(<span class="number">1000L</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ç°Delayedæ¥å£çš„å…ƒç´ æ‰èƒ½å­˜åˆ°DelayQueue</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Message</span> <span class="keyword">implements</span> <span class="title class_">Delayed</span> {</span><br><span class="line">        String content;</span><br><span class="line">        Date sendTime;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> content  æ¶ˆæ¯å†…å®¹</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> sendTime å®šæ—¶å‘é€</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Message</span><span class="params">(String content, Date sendTime)</span> {</span><br><span class="line">            <span class="built_in">this</span>.content = content;</span><br><span class="line">            <span class="built_in">this</span>.sendTime = sendTime;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * åˆ¤æ–­å½“å‰è¿™ä¸ªå…ƒç´ æ˜¯ä¸æ˜¯å·²ç»åˆ°äº†éœ€è¦è¢«æ‹¿å‡ºæ¥çš„æ—¶é—´</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getDelay</span><span class="params">(TimeUnit unit)</span> {</span><br><span class="line">            <span class="type">long</span> <span class="variable">duration</span> <span class="operator">=</span> sendTime.getTime() - System.currentTimeMillis();</span><br><span class="line">            <span class="keyword">return</span> TimeUnit.NANOSECONDS.convert(duration, TimeUnit.MILLISECONDS);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Delayed o)</span> {</span><br><span class="line">            <span class="keyword">return</span> o.getDelay(TimeUnit.NANOSECONDS) &gt; <span class="built_in">this</span>.getDelay(TimeUnit.NANOSECONDS) ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</body></html>]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨çš„æ’åºæ–¹æ³•</title>
    <url>/p/b07f48bf.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bubble</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[]{<span class="number">2</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">4</span>};</span><br><span class="line">        sort(arr);</span><br><span class="line">        System.out.println(Arrays.toString(arr));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] arr)</span> {</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) {</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt; arr.length - i; j++) {</span><br><span class="line">                <span class="keyword">if</span> (arr[j - <span class="number">1</span>] &gt; arr[j]) {</span><br><span class="line">                    <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arr[j - <span class="number">1</span>];</span><br><span class="line">                    arr[j - <span class="number">1</span>] = arr[j];</span><br><span class="line">                    arr[j] = temp;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="é€‰æ‹©æ’åº"><a href="#é€‰æ‹©æ’åº" class="headerlink" title="é€‰æ‹©æ’åº"></a>é€‰æ‹©æ’åº</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Selection</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[]{<span class="number">2</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">4</span>};</span><br><span class="line">        sort(arr);</span><br><span class="line">        System.out.println(Arrays.toString(arr));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] arr)</span> {</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length - <span class="number">1</span>; i++) {</span><br><span class="line">            <span class="type">int</span> <span class="variable">minIndex</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i + <span class="number">1</span>; j &lt; arr.length; j++) {</span><br><span class="line">                <span class="keyword">if</span> (arr[minIndex] &gt; arr[j]) {</span><br><span class="line">                    minIndex = j;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arr[i];</span><br><span class="line">            arr[i] = arr[minIndex];</span><br><span class="line">            arr[minIndex] = temp;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="æ’å…¥æ’åº"><a href="#æ’å…¥æ’åº" class="headerlink" title="æ’å…¥æ’åº"></a>æ’å…¥æ’åº</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Insertion</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[]{<span class="number">2</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">4</span>};</span><br><span class="line">        sort(arr);</span><br><span class="line">        System.out.println(Arrays.toString(arr));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] arr)</span> {</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; arr.length; i++) {</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i; j &gt; <span class="number">0</span>; j--) {</span><br><span class="line">                <span class="keyword">if</span> (arr[j - <span class="number">1</span>] &gt; arr[j]) {</span><br><span class="line">                    <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arr[j];</span><br><span class="line">                    arr[j] = arr[j - <span class="number">1</span>];</span><br><span class="line">                    arr[j - <span class="number">1</span>] = temp;</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="å¸Œå°”æ’åº"><a href="#å¸Œå°”æ’åº" class="headerlink" title="å¸Œå°”æ’åº"></a>å¸Œå°”æ’åº</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Shell</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] arr)</span> {</span><br><span class="line">        <span class="comment">// å¢é•¿é‡h</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (h &lt;= arr.length / <span class="number">2</span>) {</span><br><span class="line">            h = h * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">while</span> (h &gt;= <span class="number">1</span>) {</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> h; i &lt; arr.length; i++) {</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i; j &gt;= h; j -= h) {</span><br><span class="line">                    <span class="keyword">if</span> (arr[j - h] &gt; arr[j]) {</span><br><span class="line">                        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arr[j];</span><br><span class="line">                        arr[j] = arr[j - h];</span><br><span class="line">                        arr[j - h] = temp;</span><br><span class="line">                    } <span class="keyword">else</span> {</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// å‡å°å¢é•¿é‡</span></span><br><span class="line">            h = h / <span class="number">2</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</body></html>]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>AQSæŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨</title>
    <url>/p/290c6541.html</url>
    <content><![CDATA[<html><head></head><body><p>AQSå…¨ç§°ä¸ºAbstractQueuedSynchronizerï¼Œæä¾›äº†å¯¹èµ„æºå ç”¨ã€é‡Šæ”¾ï¼Œçº¿ç¨‹ç­‰å¾…ã€å”¤é†’ç­‰æ¥å£å’Œå…·ä½“å®ç°ã€‚å¯ä»¥ç”¨åœ¨å„ç§éœ€è¦æ§åˆ¶èµ„æºäº‰ç”¨çš„åœºæ™¯ï¼Œä¾‹å¦‚ReentrantLockã€CountDownLatchã€Semphoreä¸­ã€‚</p>
<h2 id="AQSç»„æˆéƒ¨åˆ†"><a href="#AQSç»„æˆéƒ¨åˆ†" class="headerlink" title="AQSç»„æˆéƒ¨åˆ†"></a>AQSç»„æˆéƒ¨åˆ†</h2><p><img src="/p/290c6541/AQS-%E6%8E%A5%E5%8F%A3.png" alt="image-20210513220313583"></p>
<p>acquireã€acquireSharedï¼šå®šä¹‰äº†èµ„æºäº‰ç”¨çš„é€»è¾‘ï¼Œå¦‚æœæ²¡æ‹¿åˆ°åˆ™ç­‰å¾…ã€‚</p>
<p>tryAcquireã€tryAcquireSharedï¼šå®é™…æ‰§è¡Œå ç”¨èµ„æºçš„æ“ä½œï¼Œå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç”±ä½¿ç”¨è€…å…·ä½“å»å®ç°ã€‚</p>
<p>releaseã€releaseSharedï¼šå®šä¹‰é‡Šæ”¾èµ„æºçš„é€»è¾‘ï¼Œé‡Šæ”¾ä¹‹åé€šçŸ¥åç»­èŠ‚ç‚¹è¿›è¡Œäº‰æŠ¢ã€‚</p>
<p>tryReleaseã€tryReleaseSharedï¼šå®é™…æ‰§è¡Œèµ„æºé‡Šæ”¾çš„æ“ä½œï¼Œå…·ä½“ç”±ä½¿ç”¨è€…å»å®ç°ã€‚</p>
<h2 id="ç®€å•åº”ç”¨AQS"><a href="#ç®€å•åº”ç”¨AQS" class="headerlink" title="ç®€å•åº”ç”¨AQS"></a>ç®€å•åº”ç”¨AQS</h2><p>é€šè¿‡è¿™ä¸ªå®ä¾‹åŠ æ·±å¯¹AQSçš„ç†è§£ï¼Œä¸ºçœ‹æ‡‚æºç æ‰“ä¸‹ä¸€å®šçš„åŸºç¡€ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAqs</span> {</span><br><span class="line">    <span class="comment">// å ç”¨å½“å‰èµ„æºçš„çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">volatile</span> AtomicReference&lt;Thread&gt; owner = <span class="keyword">new</span> <span class="title class_">AtomicReference</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// ä¿å­˜ç­‰å¾…çš„çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">volatile</span> LinkedBlockingQueue&lt;Thread&gt; waiters = <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// è®°å½•èµ„æºçŠ¶æ€</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">volatile</span> <span class="type">AtomicInteger</span> <span class="variable">state</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">acquire</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">addQ</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">while</span> (!tryAcquire()) {</span><br><span class="line">            <span class="keyword">if</span> (addQ) {</span><br><span class="line">                <span class="comment">// æ²¡æ‹¿åˆ°é”ï¼ŒåŠ å…¥åˆ°ç­‰å¾…é›†åˆ</span></span><br><span class="line">                waiters.offer(Thread.currentThread());</span><br><span class="line">                addQ = <span class="literal">false</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="comment">// é˜»å¡ã€æŒ‚èµ·å½“å‰çš„çº¿ç¨‹</span></span><br><span class="line">                LockSupport.park(); </span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// å½“å‰çº¿ç¨‹æ‹¿åˆ°é”åï¼Œç§»é™¤å½“å‰çº¿ç¨‹</span></span><br><span class="line">        waiters.remove(Thread.currentThread()); </span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº¤ç”±ä½¿ç”¨è€…è‡ªå·±å®ç°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryAcquire</span><span class="params">()</span> { </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">release</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">if</span> (tryRelease()) {</span><br><span class="line">            <span class="comment">// é€šçŸ¥ç­‰å¾…è€…</span></span><br><span class="line">            Iterator&lt;Thread&gt; iterator = waiters.iterator();</span><br><span class="line">            <span class="keyword">if</span> (iterator.hasNext()) {</span><br><span class="line">                <span class="type">Thread</span> <span class="variable">next</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">                <span class="comment">// å½“å‰çº¿ç¨‹é‡Šæ”¾èµ„æºåï¼Œå”¤é†’ä¸‹ä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line">                LockSupport.unpark(next); </span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryRelease</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//================== å…±äº«èµ„æºé€»è¾‘ ==================//</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">acquireShared</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">addQ</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">while</span> (tryAcquireShared() &lt; <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">if</span> (addQ) {</span><br><span class="line">                waiters.offer(Thread.currentThread());</span><br><span class="line">                addQ = <span class="literal">false</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                LockSupport.park(); </span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        waiters.remove(Thread.currentThread());</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">tryAcquireShared</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">    }</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">releaseShared</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">if</span> (tryReleaseShared()) {</span><br><span class="line">            Iterator&lt;Thread&gt; iterator = waiters.iterator();</span><br><span class="line">            <span class="keyword">if</span> (iterator.hasNext()) {</span><br><span class="line">                <span class="type">Thread</span> <span class="variable">next</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">                LockSupport.unpark(next);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryReleaseShared</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç»™ä½¿ç”¨è€…æä¾›çŠ¶æ€ä¿®æ”¹æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> AtomicInteger <span class="title function_">getState</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setState</span><span class="params">(AtomicInteger state)</span> {</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="AQSæºç é˜…è¯»"><a href="#AQSæºç é˜…è¯»" class="headerlink" title="AQSæºç é˜…è¯»"></a>AQSæºç é˜…è¯»</h2><p>æºç ä¸­ç­‰å¾…é˜Ÿåˆ—ç»´æŠ¤çš„æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬ä¸Šé¢ä½¿ç”¨çš„BlockingQueueã€‚</p>
<p>åœ¨ç‹¬å æ¨¡å¼ä¸‹å¿½ç•¥ä¸­æ–­çš„æƒ…å†µè·å–é”ã€‚å¦‚æœæ²¡æœ‰æ‹¿åˆ°é”åˆ™å½“å‰çº¿ç¨‹å­˜å…¥é˜Ÿåˆ—ç­‰å¾…åï¼Œä¸æ–­å°è¯•è·å–é”ï¼Œå…·ä½“ä»£ç åœ¨acquireQueued() ä¸­ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">acquire</span><span class="params">(<span class="type">int</span> arg)</span> {</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦æ‹¿åˆ°é”</span></span><br><span class="line">    <span class="keyword">if</span> (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class="line">        selfInterrupt();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">tryAcquire</span><span class="params">(<span class="type">int</span> arg)</span> {</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å¦‚æœç¬¬ä¸€æ¬¡æ‰§è¡ŒtryAcquire() æ²¡æœ‰æ‹¿åˆ°é”ï¼Œåˆ™å½“å‰çº¿ç¨‹å°†è¿›è¡Œè‡ªæ—‹ï¼Œç›´åˆ°æˆåŠŸæ‹¿åˆ°é”ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">acquireQueued</span><span class="params">(<span class="keyword">final</span> Node node, <span class="type">int</span> arg)</span> {</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">failed</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">interrupted</span> <span class="operator">=</span> <span class="literal">false</span>; <span class="comment">// å½“å‰çº¿ç¨‹é‡Šæ”¾ä¸­æ–­çš„æ ‡å¿—ä½</span></span><br><span class="line">        <span class="keyword">for</span> (;;) {<span class="comment">// ä¸æ–­å°è¯•</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> node.predecessor(); <span class="comment">// è·å–å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) { <span class="comment">// å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹æ˜¯headï¼Œå°è¯•æŠ¢ä¸€æ¬¡é”</span></span><br><span class="line">                setHead(node); <span class="comment">// æ›´æ¢head</span></span><br><span class="line">                p.next = <span class="literal">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                failed = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">return</span> interrupted;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// æ£€æŸ¥åœ¨å½“å‰èŠ‚ç‚¹ä¹‹å‰çš„çº¿ç¨‹èŠ‚ç‚¹çŠ¶æ€ï¼Œæ˜¯å¦éœ€è¦æŒ‚èµ·çº¿ç¨‹</span></span><br><span class="line">            <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">                parkAndCheckInterrupt())<span class="comment">// å¦‚æœéœ€è¦æŒ‚èµ·ï¼Œåˆ™é€šè¿‡Parkè¿›å…¥åœè½¦åœºæŒ‚èµ·</span></span><br><span class="line">                interrupted = <span class="literal">true</span>; <span class="comment">// å¦‚æœå‡ºç°ä¸­æ–­ï¼Œåˆ™ä¿®æ”¹æ ‡è®°</span></span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        <span class="keyword">if</span> (failed)</span><br><span class="line">            cancelAcquire(node);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Node <span class="title function_">predecessor</span><span class="params">()</span> <span class="keyword">throws</span> NullPointerException {</span><br><span class="line">    <span class="comment">// å½“å‰èŠ‚ç‚¹å‰å¦‚æœæ²¡æœ‰å…¶å®ƒèŠ‚ç‚¹ï¼Œé‚£å°±è‚¯å®šæ˜¯headèŠ‚ç‚¹</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> prev;</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">shouldParkAfterFailedAcquire</span><span class="params">(Node pred, Node node)</span> {</span><br><span class="line">    <span class="type">int</span> <span class="variable">ws</span> <span class="operator">=</span> pred.waitStatus; <span class="comment">// æ ¹æ® å‰ç½®èŠ‚ç‚¹çš„çŠ¶æ€ æ‰§è¡Œä¸åŒçš„æµç¨‹</span></span><br><span class="line">    <span class="keyword">if</span> (ws == Node.SIGNAL) <span class="comment">// å‰ç½®èŠ‚ç‚¹é‡Šæ”¾é”ä¹‹åä¼šé€šçŸ¥å½“å‰çº¿ç¨‹ï¼ŒæŒ‚èµ·å§</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * This node has already set status asking a release</span></span><br><span class="line"><span class="comment">         * to signal it, so it can safely park.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (ws &gt; <span class="number">0</span>) { <span class="comment">// å‰ç½®èŠ‚ç‚¹å¤„äºCANCELLEDçŠ¶æ€ï¼Œè·³è¿‡å®ƒç»§ç»­å¯»æ‰¾æ­£å¸¸çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”ç”©æ‰ä¸­é—´é‚£æ®µä¸æ­£å¸¸çš„èŠ‚ç‚¹</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Predecessor was cancelled. Skip over predecessors and</span></span><br><span class="line"><span class="comment">         * indicate retry.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">do</span> { <span class="comment">// ä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼Œè¿™æ˜¯ä¸€æ¬¡é˜Ÿåˆ—æ£€æŸ¥</span></span><br><span class="line">            node.prev = pred = pred.prev;</span><br><span class="line">        } <span class="keyword">while</span> (pred.waitStatus &gt; <span class="number">0</span>);</span><br><span class="line">        pred.next = node;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * waitStatus must be 0 or PROPAGATE.  Indicate that we</span></span><br><span class="line"><span class="comment">         * need a signal, but don't park yet.  Caller will need to</span></span><br><span class="line"><span class="comment">         * retry to make sure it cannot acquire before parking.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        compareAndSetWaitStatus(pred, ws, Node.SIGNAL); <span class="comment">// ä¿®æ”¹å‰ç½®çš„çŠ¶æ€ä¸ºSIGNALï¼Œç”¨æ„æ˜¯é‡Šæ”¾é”ä¹‹åä¼šé€šçŸ¥åç»­èŠ‚ç‚¹</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>é‡Šæ”¾èµ„æºã€‚è§£é”æˆåŠŸåï¼Œå•å‘é“¾è¡¨ä¸­çš„çº¿ç¨‹èŠ‚ç‚¹å¾€åç§»ï¼Œå”¤é†’ä¸‹ä¸€ä¸ªçŠ¶æ€æ­£å¸¸çš„çº¿ç¨‹ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">release</span><span class="params">(<span class="type">int</span> arg)</span> {</span><br><span class="line">    <span class="keyword">if</span> (tryRelease(arg)) {</span><br><span class="line">        <span class="type">Node</span> <span class="variable">h</span> <span class="operator">=</span> head; <span class="comment">// ä»å¤´å¼€å§‹æ‰¾</span></span><br><span class="line">        <span class="keyword">if</span> (h != <span class="literal">null</span> &amp;&amp; h.waitStatus != <span class="number">0</span>)</span><br><span class="line">            unparkSuccessor(h); <span class="comment">// å”¤é†’ä¸‹ä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">tryRelease</span><span class="params">(<span class="type">int</span> arg)</span> {</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">unparkSuccessor</span><span class="params">(Node node)</span> {</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * If status is negative (i.e., possibly needing signal) try</span></span><br><span class="line"><span class="comment">     * to clear in anticipation of signalling.  It is OK if this</span></span><br><span class="line"><span class="comment">     * fails or if status is changed by waiting thread.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">ws</span> <span class="operator">=</span> node.waitStatus; <span class="comment">// æ­£åœ¨é‡Šæ”¾é”çš„çº¿ç¨‹èŠ‚ç‚¹çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">if</span> (ws &lt; <span class="number">0</span>)</span><br><span class="line">        compareAndSetWaitStatus(node, ws, <span class="number">0</span>); <span class="comment">// ä¿®æ”¹å½“å‰èŠ‚ç‚¹çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Thread to unpark is held in successor, which is normally</span></span><br><span class="line"><span class="comment">     * just the next node.  But if cancelled or apparently null,</span></span><br><span class="line"><span class="comment">     * traverse backwards from tail to find the actual</span></span><br><span class="line"><span class="comment">     * non-cancelled successor.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">s</span> <span class="operator">=</span> node.next; <span class="comment">// æ‰¾ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> (s == <span class="literal">null</span> || s.waitStatus &gt; <span class="number">0</span>) { <span class="comment">// å¦‚æœä¸å­˜åœ¨æˆ–è€…è¢«å–æ¶ˆäº†ï¼Œç»§ç»­å¯»æ‰¾åˆé€‚çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        s = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">Node</span> <span class="variable">t</span> <span class="operator">=</span> tail; t != <span class="literal">null</span> &amp;&amp; t != node; t = t.prev)</span><br><span class="line">            <span class="keyword">if</span> (t.waitStatus &lt;= <span class="number">0</span>)</span><br><span class="line">                s = t;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (s != <span class="literal">null</span>) <span class="comment">// å¦‚æœæ‰¾åˆ°äº†åˆé€‚çš„èŠ‚ç‚¹ï¼Œå°±å”¤é†’å®ƒ</span></span><br><span class="line">        LockSupport.unpark(s.thread);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>èµ„æºå ç”¨çš„å®Œæ•´æµç¨‹</p>
<p><img src="/p/290c6541/AQS-%E8%B5%84%E6%BA%90%E5%8D%A0%E7%94%A8%E6%B5%81%E7%A8%8B.png" alt="image-20210514131357784"></p>
</body></html>]]></content>
      <tags>
        <tag>JUCå¹¶å‘åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>CAS</title>
    <url>/p/969d9481.html</url>
    <content><![CDATA[<html><head></head><body><p>çº¿ç¨‹çš„ä¸‰å¤§ç‰¹æ€§ï¼šåŸå­æ€§ã€æœ‰åºæ€§ã€å¯è§æ€§ã€‚</p>
<ul>
<li><p>åŸå­æ€§ï¼šä¸€ä¸ªæˆ–å¤šä¸ªæ“ä½œçš„ç¨‹åºæ‰§è¡Œè§†ä½œä¸€ä¸ªæ•´ä½“ï¼Œä¸å¯è¢«åˆ†å‰²ï¼Œä¸å¯è¢«ä¸­æ–­ï¼Œä¸å¯è¢«å¤–ç•Œå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œè¿™äº›æ“ä½œã€‚</p>
</li>
<li><p>æœ‰åºæ€§ï¼šç¨‹åºæŒ‰ä¸€å®šè§„åˆ™è¿›è¡Œé¡ºåºçš„æ‰§è¡Œã€‚</p>
</li>
<li><p>å¯è§æ€§ï¼šå½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå˜é‡æ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³çœ‹çš„åˆ°ä¿®æ”¹çš„å€¼ã€‚</p>
</li>
</ul>
<h2 id="ä»€ä¹ˆæ˜¯CASï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯CASï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯CASï¼Ÿ"></a>ä»€ä¹ˆæ˜¯CASï¼Ÿ</h2><p>CASåœ¨Javaå‡ºç°ï¼Œåœ¨Javaä¸­ç§°ä¸ºè‡ªæ—‹é”ã€‚CASç±»ä¼¼äºsynchronizedé”çš„åŠŸèƒ½ï¼Œä½†ä¸¤è€…åŸç†ä¸åŒã€‚</p>
<p>CASæœºåˆ¶å½“ä¸­ä½¿ç”¨äº†3ä¸ªåŸºæœ¬æ“ä½œæ•°ï¼šå†…å­˜åœ°å€Vï¼Œæ—§çš„é¢„æœŸå€¼Aï¼Œè¦ä¿®æ”¹çš„æ–°å€¼Bã€‚æ›´æ–°ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œåªæœ‰å½“å˜é‡çš„é¢„æœŸå€¼Aå’Œå†…å­˜åœ°å€Vå½“ä¸­çš„å®é™…å€¼ç›¸åŒæ—¶ï¼Œæ‰ä¼šå°†å†…å­˜åœ°å€Vå¯¹åº”çš„å€¼ä¿®æ”¹ä¸ºBã€‚è¿™æ ·è¯´æˆ–è®¸æœ‰äº›æŠ½è±¡ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<ol>
<li>åœ¨å†…å­˜åœ°å€Vå½“ä¸­ï¼Œå­˜å‚¨ç€å€¼ä¸º10çš„å˜é‡ã€‚</li>
</ol>
<p><img src="/p/969d9481/1193919-20180102142540362-571280295.png" alt="img"></p>
<ol start="2">
<li>æ­¤æ—¶çº¿ç¨‹1æƒ³è¦æŠŠå˜é‡çš„å€¼å¢åŠ 1ã€‚å¯¹çº¿ç¨‹1æ¥è¯´ï¼Œæ—§çš„é¢„æœŸå€¼A=10ï¼Œè¦ä¿®æ”¹çš„æ–°å€¼B=11ã€‚</li>
</ol>
<p><img src="/p/969d9481/1193919-20180102142542299-1617994496.png" alt="img"></p>
<ol start="3">
<li>åœ¨çº¿ç¨‹1è¦æäº¤æ›´æ–°ä¹‹å‰ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹2æŠ¢å…ˆä¸€æ­¥ï¼ŒæŠŠå†…å­˜åœ°å€Vä¸­çš„å˜é‡å€¼ç‡å…ˆæ›´æ–°æˆäº†11ã€‚</li>
</ol>
<p><img src="/p/969d9481/1193919-20180102142543784-1625100143.png" alt="img"></p>
<ol start="4">
<li>çº¿ç¨‹1å¼€å§‹æäº¤æ›´æ–°ï¼Œé¦–å…ˆè¿›è¡Œ<strong>Aå’Œåœ°å€Vçš„å®é™…å€¼æ¯”è¾ƒï¼ˆCompareï¼‰</strong>ï¼Œå‘ç°Aä¸ç­‰äºVçš„å®é™…å€¼ï¼Œæäº¤å¤±è´¥ã€‚</li>
</ol>
<p><img src="/p/969d9481/1193919-20180102142545221-837543615.png" alt="img"></p>
<ol start="5">
<li>çº¿ç¨‹1é‡æ–°è·å–å†…å­˜åœ°å€Vçš„å½“å‰å€¼ï¼Œå¹¶é‡æ–°è®¡ç®—æƒ³è¦ä¿®æ”¹çš„æ–°å€¼ã€‚æ­¤æ—¶å¯¹çº¿ç¨‹1æ¥è¯´ï¼ŒA=11ï¼ŒB=12ã€‚è¿™ä¸ªé‡æ–°å°è¯•çš„è¿‡ç¨‹è¢«ç§°ä¸º<strong>è‡ªæ—‹</strong>ã€‚</li>
</ol>
<p><img src="/p/969d9481/1193919-20180102142546909-270453852.png" alt="img"></p>
<ol start="6">
<li>è¿™ä¸€æ¬¡æ¯”è¾ƒå¹¸è¿ï¼Œæ²¡æœ‰å…¶ä»–çº¿ç¨‹æ”¹å˜åœ°å€Vçš„å€¼ã€‚çº¿ç¨‹1è¿›è¡Œ<strong>Compare</strong>ï¼Œå‘ç°Aå’Œåœ°å€Vçš„å®é™…å€¼æ˜¯ç›¸ç­‰çš„ã€‚</li>
</ol>
<p><img src="/p/969d9481/1193919-20180102142548299-328053032-16464619321157.png" alt="img"></p>
<ol start="7">
<li>çº¿ç¨‹1è¿›è¡Œ<strong>SWAP</strong>ï¼ŒæŠŠåœ°å€Vçš„å€¼æ›¿æ¢ä¸ºBï¼Œä¹Ÿå°±æ˜¯12ã€‚</li>
</ol>
<p><img src="/p/969d9481/1193919-20180102142625753-443716413.png" alt="img"></p>
<p>ä»æ€æƒ³ä¸Šæ¥è¯´ï¼ŒSynchronizedå±äº<strong>æ‚²è§‚é”</strong>ï¼Œæ‚²è§‚åœ°è®¤ä¸ºç¨‹åºä¸­çš„å¹¶å‘æƒ…å†µä¸¥é‡ï¼Œæ‰€ä»¥ä¸¥é˜²æ­»å®ˆã€‚CASå±äº<strong>ä¹è§‚é”</strong>ï¼Œä¹è§‚åœ°è®¤ä¸ºç¨‹åºä¸­çš„å¹¶å‘æƒ…å†µä¸é‚£ä¹ˆä¸¥é‡ï¼Œæ‰€ä»¥è®©çº¿ç¨‹ä¸æ–­å»å°è¯•æ›´æ–°ã€‚</p>
<h2 id="JDKä¸­çš„CASåº”ç”¨å®ä¾‹"><a href="#JDKä¸­çš„CASåº”ç”¨å®ä¾‹" class="headerlink" title="JDKä¸­çš„CASåº”ç”¨å®ä¾‹"></a>JDKä¸­çš„CASåº”ç”¨å®ä¾‹</h2><p>åœ¨JDKçš„ java.util.concurrent.atomic åŒ…ä¸‹ï¼Œä¸€ç³»åˆ—ä»¥Atomicå¼€å¤´çš„åŒ…è£…ç±»ã€‚å¦‚AtomicBooleanï¼ŒAtomicIntegerï¼ŒAtomicLongã€‚å®ƒä»¬åˆ†åˆ«ç”¨äºBooleanï¼ŒIntegerï¼ŒLongç±»å‹çš„åŸå­æ€§æ“ä½œã€‚</p>
<p>compareAndSetåˆ©ç”¨JNIæ¥å®ŒæˆCPUæŒ‡ä»¤çš„æ“ä½œã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(<span class="type">int</span> expect, <span class="type">int</span> update)</span> {   </span><br><span class="line">    <span class="keyword">return</span> unsafe.compareAndSwapInt(<span class="built_in">this</span>, valueOffset, expect, update);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h2 id="CASçš„ä¼˜ç‚¹"><a href="#CASçš„ä¼˜ç‚¹" class="headerlink" title="CASçš„ä¼˜ç‚¹"></a>CASçš„ä¼˜ç‚¹</h2><h3 id="æå‡ååé‡"><a href="#æå‡ååé‡" class="headerlink" title="æå‡ååé‡"></a>æå‡ååé‡</h3><p>çº¿ç¨‹ä¸€ç›´å¤„äºæ´»è·ƒçŠ¶æ€ï¼ˆéé˜»å¡ï¼‰ï¼Œä¸éœ€è¦CPUè¿›è¡Œé¢‘ç¹è°ƒåº¦ã€‚</p>
<h3 id="å¯é¿å…æ­»é”"><a href="#å¯é¿å…æ­»é”" class="headerlink" title="å¯é¿å…æ­»é”"></a>å¯é¿å…æ­»é”</h3><p>ä¸ç”¨ synchronized æˆ– Lock å½“ç„¶å°±å¯ä»¥é¿å…æ­»é”ã€‚</p>
<h2 id="CASçš„å¼Šç«¯"><a href="#CASçš„å¼Šç«¯" class="headerlink" title="CASçš„å¼Šç«¯"></a>CASçš„å¼Šç«¯</h2><h3 id="ABAé—®é¢˜"><a href="#ABAé—®é¢˜" class="headerlink" title="ABAé—®é¢˜"></a>ABAé—®é¢˜</h3><p>åœ¨å¹¶å‘ç¯å¢ƒä¸‹ä¼šå‡ºç°çš„ABAé—®é¢˜æ˜¯CASæœºåˆ¶ä¸­çš„ä¸€ä¸ªä¸¥é‡å¼Šç«¯ã€‚</p>
<blockquote>
<p>ä»€ä¹ˆæ˜¯ABAé—®é¢˜ï¼Ÿ</p>
</blockquote>
<p>å‡è®¾ç°åœ¨æœ‰ä¸€ä»½èµ„æºåˆå§‹å€¼ä¸ºAï¼Œæ­¤æ—¶æœ‰ä¸‰ä¸ªçº¿ç¨‹å¯¹è¿™ä»½èµ„æºè¿›è¡ŒCASæ“ä½œï¼š</p>
<ul>
<li>çº¿ç¨‹1ï¼ŒæœŸæœ›å€¼ä¸ºAï¼Œæ¬²æ›´æ–°å€¼ä¸ºB</li>
<li>çº¿ç¨‹2ï¼ŒæœŸæœ›å€¼ä¸ºAï¼Œæ¬²æ›´æ–°å€¼ä¸ºB</li>
<li>çº¿ç¨‹3ï¼ŒæœŸæœ›å€¼ä¸ºBï¼Œæ¬²æ›´æ–°å€¼ä¸ºA</li>
</ul>
<p>çº¿ç¨‹1ç‡å…ˆæŠ¢åˆ°CPUæ—¶é—´ç‰‡ï¼Œçº¿ç¨‹2å› ä¸ºæŸäº›åŸå› é˜»å¡äº†ï¼›çº¿ç¨‹1å–å€¼ä¸Aæ¯”è¾ƒï¼Œå‘ç°ç›¸ç­‰åå°†å€¼æ”¹ä¸ºBï¼›æ­¤æ—¶çº¿ç¨‹3å‡ºç°ï¼Œçº¿ç¨‹3å–å€¼ä¸Bæ¯”è¾ƒï¼Œå‘ç°ç›¸ç­‰åæ”¹ä¸ºAï¼›æ­¤æ—¶çº¿ç¨‹2ä»é˜»å¡ä¸­æ¢å¤å¼€å§‹æ‰§è¡Œï¼Œçº¿ç¨‹2çš„å–å€¼ä¸Aå¯¹æ¯”ç›¸ç­‰ï¼Œæœ€ç»ˆæ”¹ä¸ºBã€‚</p>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹2è™½ç„¶å®Œæˆäº†æ“ä½œï¼Œä½†çº¿ç¨‹2å¹¶ä¸çŸ¥é“è¯¥å€¼ç»è¿‡äº†<code>A-&gt;B-&gt;A</code>çš„è¿™ä¸ªå˜åŒ–è¿‡ç¨‹ã€‚</p>
<p>çœ‹åˆ°è¿™é‡Œå¯èƒ½å¯¹è¿™ä¸ªABAé—®é¢˜è¿˜æ˜¯æ²¡æœ‰æ„Ÿè§‰ï¼Œå†ä¸¾ä¸ªç°å®ä¸­çš„æ —å­ï¼š</p>
<p>å°æ˜ä»ä»–çš„å·¨é¢è´¦æˆ·ä¸­å·²æœ‰çš„100å…ƒä¸­å–èµ°50å…ƒï¼Œé‚£ä»–å–èµ°50åè¿˜å‰©50ï¼Œå‡è®¾ææ¬¾æœºçš„ä»£ç æœ‰BUGï¼Œåå°å¼€äº†ä¸¤ä¸ªçº¿ç¨‹å»æ‰£æ¬¾ï¼š</p>
<ul>
<li>çº¿ç¨‹1ï¼šè·å–å½“å‰å€¼100ï¼ŒæœŸæœ›æ›´æ–°ä¸º50ï¼›</li>
<li>çº¿ç¨‹2ï¼šè·å–å½“å‰å€¼100ï¼ŒæœŸæœ›æ›´æ–°ä¸º50ï¼›</li>
<li>çº¿ç¨‹1ï¼šæ‰§è¡ŒæˆåŠŸï¼Œçº¿ç¨‹2æŸç§åŸå› é˜»å¡äº†ï¼Œæ­¤æ—¶æŸäººç»™å°æ˜è½¬è´¦50ï¼Œå¼€ä¸€ä¸ªçº¿ç¨‹3å»å¤„ç†è½¬è´¦ã€‚</li>
<li>çº¿ç¨‹3ï¼šè·å–å½“å‰å€¼50ï¼ŒæœŸæœ›æ›´æ–°ä¸º100ï¼Œæ­¤æ—¶çº¿ç¨‹3æ‰§è¡ŒæˆåŠŸï¼Œä½™é¢å˜ä¸º100ã€‚</li>
<li>çº¿ç¨‹2ï¼šä»é˜»å¡ä¸­æ¢å¤ï¼Œè·å–åˆ°çš„ä¹Ÿæ˜¯100ï¼Œcompareä¹‹åï¼Œç»§ç»­æ›´æ–°ä½™é¢ä¸º50ï¼ï¼ï¼ï¼ˆå°æ˜å“­å”§å”§ï¼‰</li>
</ul>
<p>æ­¤æ—¶å¯ä»¥çœ‹åˆ°ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå°æ˜ä»100å…ƒå–èµ°50è¿˜å‰©50ï¼Œæœ‰äººè½¬è´¦50è¿‡æ¥ï¼Œé‚£æœ€ç»ˆå°æ˜çš„å­˜æ¬¾ä¸º100å…ƒã€‚åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­è¢«è¿™ä¸ªææ¬¾æœºçš„ABAé—®é¢˜å¼•å‘çš„BUGç»™å¼„æ‰äº†50å—é’±ã€‚</p>
<p>ABAé—®é¢˜çš„å®ä¾‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">AtomicInteger</span> <span class="variable">DATA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; {</span><br><span class="line">        <span class="comment">// æŠ¢åˆ°CPUæ—¶é—´ç‰‡ï¼Œå¼€å§‹å·¥ä½œ</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> DATA.compareAndSet(<span class="number">100</span>, <span class="number">50</span>);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">"æ˜¯å¦æˆåŠŸå°†DATAçš„å€¼ä¿®æ”¹ä¸º50ï¼š"</span> + b);</span><br><span class="line">        <span class="keyword">try</span> { Thread.sleep(<span class="number">1000</span>); } <span class="keyword">catch</span> (InterruptedException ignored) {}</span><br><span class="line">    }, <span class="string">"çº¿ç¨‹1"</span>).start();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; {</span><br><span class="line">        <span class="comment">// å› æŸäº›åŸå› é˜»å¡äº†</span></span><br><span class="line">        <span class="keyword">try</span> { Thread.sleep(<span class="number">3000</span>); } <span class="keyword">catch</span> (InterruptedException ignored) {}</span><br><span class="line">        <span class="comment">// é˜»å¡åæ¢å¤å·¥ä½œ</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> DATA.compareAndSet(<span class="number">100</span>, <span class="number">50</span>);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">"æ˜¯å¦æˆåŠŸå°†DATAçš„å€¼ä¿®æ”¹ä¸º50ï¼š"</span> + b);</span><br><span class="line">    }, <span class="string">"çº¿ç¨‹2"</span>).start();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; {</span><br><span class="line">        <span class="keyword">try</span> { Thread.sleep(<span class="number">2000</span>); } <span class="keyword">catch</span> (InterruptedException ignored) {}</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> DATA.compareAndSet(<span class="number">50</span>, <span class="number">100</span>);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">"æ˜¯å¦æˆåŠŸå°†DATAçš„å€¼ä¿®æ”¹ä¸º100ï¼š"</span> + b);</span><br><span class="line">    }, <span class="string">"çº¿ç¨‹3"</span>).start();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆï¼Œä¸ºä»€ä¹ˆæ˜¯2ï¼Œå› ä¸ºä¸€ä¸ªæ˜¯mainçº¿ç¨‹ï¼Œä¸€ä¸ªæ˜¯åå°çš„GCçº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">while</span> (Thread.activeCount() &gt; <span class="number">2</span>) {</span><br><span class="line">        Thread.yield();</span><br><span class="line">    }</span><br><span class="line">    System.out.println(<span class="string">"DATAæœ€ç»ˆçš„å€¼ä¸ºï¼š"</span> + DATA.get());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight tex"><table><tbody><tr><td class="code"><pre><span class="line">çº¿ç¨‹1æ˜¯å¦æˆåŠŸå°†DATAçš„å€¼ä¿®æ”¹ä¸º50ï¼štrue</span><br><span class="line">çº¿ç¨‹3æ˜¯å¦æˆåŠŸå°†DATAçš„å€¼ä¿®æ”¹ä¸º100ï¼štrue</span><br><span class="line">çº¿ç¨‹2æ˜¯å¦æˆåŠŸå°†DATAçš„å€¼ä¿®æ”¹ä¸º50ï¼štrue</span><br><span class="line">DATAæœ€ç»ˆçš„å€¼ä¸ºï¼š50</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>ABAé—®é¢˜çš„è§£å†³æ–¹æ¡ˆ</p>
</blockquote>
<p>è¿™ä¸ªé—®é¢˜å°±åƒæ˜¯ï¼šæœ‰å¼ ä¸‰ã€æå››ä¸¤ä¸ªå•èº«ç‹—ï¼Œå¼ ä¸‰åœ¨æŸä¸ªæ—¶é—´æ®µå†…æ‰¾åˆ°å¥³æœ‹å‹ä½†æ˜¯åˆåˆ†æ‰‹äº†ï¼Œä½†æ²¡å‘Šè¯‰æå››ï¼Œæ­¤æ—¶æå››è¿˜æ˜¯ä¼šåœ¨å¼ ä¸‰æ˜¯å•èº«ç‹—çš„æƒ…å†µä¸‹å¸¦ä»–å»æ´—è„šã€‚è§£å†³æ–¹æ¡ˆå°±æ˜¯ï¼šå¼ ä¸‰æ¯æ¬¡äº¤å¥³æœ‹å‹éƒ½å–œæ¬¢æ™’æœ‹å‹åœˆï¼Œå¼ ä¸‰æ˜¯æå››çš„ç‰¹åˆ«å…³å¿ƒï¼Œæ¯æ¬¡å¼ ä¸‰å‘æœ‹å‹åœˆéƒ½ä¼šæé†’æå››çœ‹ã€‚</p>
<p>CASæ˜¯ä¹è§‚é”ï¼Œè¿˜è®°å¾—MySQLä¸­ä¹Ÿæœ‰ä¸ªä¹è§‚é”å—ï¼ŸMySQLä¸­çš„ä¹è§‚é”æ˜¯æ¯æ¬¡ä¿®æ”¹å®Œæ•°æ®åï¼Œç•™ä¸‹ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œåœ¨æ¯æ¬¡è¢«æ›´æ–°ä¹‹åç‰ˆæœ¬å·ä¼š+1ï¼Œå³ <code>A-&gt;B-&gt;A</code> å°±å˜æˆäº† <code>1A-&gt;2B-&gt;3A</code> ã€‚</p>
<p>è¡¥å……ä¸€ç‚¹ï¼š</p>
<p>Integer çš„æºç ï¼ˆIntegerCacheï¼‰ é‡Œé¢ç”¨äº†ç¼“å­˜ï¼Œä¼šç¼“å­˜[-128, 127] åŒºé—´çš„å€¼ï¼Œåœ¨ä½¿ç”¨ AtomicInteger éœ€è¦æ ¼å¤–æ³¨æ„ï¼å¾ˆæœ‰å¯èƒ½å€¼è¢«ä¿®æ”¹æˆåŠŸåï¼Œä¸‹ä¸€æ¬¡è¢«getæ—¶ï¼Œä¼šå› ä¸ºç¼“å­˜ï¼Œè€Œå–åˆ°ä¸Šä¸€æ¬¡çš„å€¼ã€‚</p>
<h3 id="CPUå¼€é”€å¤§"><a href="#CPUå¼€é”€å¤§" class="headerlink" title="CPUå¼€é”€å¤§"></a>CPUå¼€é”€å¤§</h3><p>åœ¨å¹¶å‘é‡æ¯”è¾ƒé«˜çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè®¸å¤šçº¿ç¨‹åå¤å°è¯•æ›´æ–°æŸä¸€ä¸ªå˜é‡ï¼Œå´åˆä¸€ç›´æ›´æ–°ä¸æˆåŠŸï¼Œå¾ªç¯å¾€å¤ï¼Œä¼šç»™CPUå¸¦æ¥å¾ˆå¤§çš„å‹åŠ›ã€‚</p>
<h3 id="åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ"><a href="#åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ" class="headerlink" title="åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ"></a>åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ</h3><p>CASæœºåˆ¶æ‰€ä¿è¯çš„åªæ˜¯ä¸€ä¸ªå˜é‡çš„åŸå­æ€§æ“ä½œï¼Œè€Œä¸èƒ½ä¿è¯<strong>æ•´ä¸ªä»£ç å—</strong>çš„åŸå­æ€§ã€‚æ¯”å¦‚éœ€è¦ä¿è¯3ä¸ªå˜é‡å…±åŒè¿›è¡ŒåŸå­æ€§çš„æ›´æ–°ï¼Œå°±ä¸å¾—ä¸ä½¿ç”¨Synchronizedæˆ–Lockäº†ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>JUCå¹¶å‘åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>CPUä¼˜åŒ–æ€§èƒ½çš„æ‰‹æ®µ</title>
    <url>/p/ffba6cb8.html</url>
    <content><![CDATA[<html><head></head><body><p>ä¸ºäº†æé«˜ç¨‹åºè¿è¡Œçš„æ€§èƒ½ï¼Œç°ä»£CPUåœ¨å¾ˆå¤šæ–¹é¢å¯¹ç¨‹åºè¿›è¡Œäº†ä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼šCPUé«˜é€Ÿç¼“å­˜ã€‚å°½å¯èƒ½çš„é¿å…å¤„ç†å™¨è®¿é—®ä¸»å­˜çš„æ—¶é—´å¼€é”€ï¼Œå¤„ç†å™¨å¤§å¤šä¼šåˆ©ç”¨ç¼“å­˜æ¥æé«˜æ€§èƒ½ã€‚</p>
<h2 id="å¤šçº§ç¼“å­˜"><a href="#å¤šçº§ç¼“å­˜" class="headerlink" title="å¤šçº§ç¼“å­˜"></a>å¤šçº§ç¼“å­˜</h2><p><img src="/p/ffba6cb8/CPU%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98%E7%BA%A7%E5%88%AB.png" alt="CPUé«˜é€Ÿç¼“å­˜çº§åˆ«"></p>
<h3 id="ç­‰çº§åˆ’åˆ†"><a href="#ç­‰çº§åˆ’åˆ†" class="headerlink" title="ç­‰çº§åˆ’åˆ†"></a>ç­‰çº§åˆ’åˆ†</h3><p>CPUçš„ç¼“å­˜åˆ†ä¸ºä¸‰ä¸ªçº§åˆ«ï¼Œç¦»CPUè¶Šè¿œç­‰çº§è¶Šå¤§ï¼š</p>
<ul>
<li>L1 Cache(ä¸€çº§ç¼“å­˜)æ˜¯CPUç¬¬ä¸€å±‚é«˜é€Ÿç¼“å­˜ï¼Œåˆ†ä¸º<strong>æ•°æ®ç¼“å­˜</strong>å’Œ<strong>æŒ‡ä»¤ç¼“å­˜</strong>ã€‚ä¸€èˆ¬æœåŠ¡å™¨CPUçš„L1ç¼“å­˜å®¹é‡é€šå¸¸åœ¨ 32-4096KBï¼ˆå®åœ¨æ˜¯å¤ªå°äº†ï¼‰ã€‚</li>
<li>L2 Cache(äºŒçº§ç¼“å­˜) ç”±äºL1çº§é«˜é€Ÿç¼“å­˜å®¹é‡çš„é™åˆ¶ï¼Œä¸ºäº†å†æ¬¡æé«˜CPUçš„è¿ç®—é€Ÿåº¦ï¼Œåœ¨CPUå¤–éƒ¨æ”¾ç½®ä¸€ä¸ªé«˜é€Ÿå­˜å‚¨å™¨ï¼ˆç”±äºåœ¨å¤–éƒ¨ï¼Œæœ‰å»¶è¿Ÿå¯¼è‡´é€Ÿåº¦è¿˜æ˜¯ä¸å¤Ÿå¿«ï¼‰ã€‚</li>
<li>L3 ç°åœ¨çš„éƒ½æ˜¯å†…ç½®çš„ã€‚L3ç¼“å­˜çš„åº”ç”¨å¯ä»¥è¿›ä¸€æ­¥é™ä½å†…å­˜å»¶è¿Ÿï¼ŒåŒæ—¶æå‡å¤§æ•°æ®é‡è®¡ç®—æ—¶çš„å¤„ç†å™¨æ€§èƒ½ã€‚å…·æœ‰è¾ƒå¤§L3ç¼“å­˜çš„å¤„ç†å™¨æä¾›æ›´æœ‰æ•ˆçš„æ–‡ä»¶ç³»ç»Ÿç¼“å­˜è¡Œä¸ºï¼ŒåŠè¾ƒçŸ­æ¶ˆæ¯å’Œå¤„ç†å™¨é˜Ÿåˆ—é•¿åº¦ã€‚ä¸€èˆ¬æ˜¯å¤šæ ¸å…±äº«ä¸€ä¸ªL3ç¼“å­˜ã€‚</li>
</ul>
<h3 id="ç¼“å­˜çš„åŒæ­¥åè®®"><a href="#ç¼“å­˜çš„åŒæ­¥åè®®" class="headerlink" title="ç¼“å­˜çš„åŒæ­¥åè®®"></a>ç¼“å­˜çš„åŒæ­¥åè®®</h3><p>å¤šCPUè¯»å–åŒæ ·çš„æ•°æ®è¿›è¡Œç¼“å­˜ï¼Œè¿›è¡Œä¸åŒçš„è¿ç®—ä¹‹åï¼Œæœ€ç»ˆå†™å…¥ä¸»å†…å­˜ï¼Œé‚£ä¹ˆä»¥å“ªä¸ªCPUä¸ºå‡†ï¼Ÿ</p>
<p>è¿™äº› CPU å‚å•†å°±åˆ¶å®šäº†ä¸€ä¸ªç¼“å­˜ä¸€è‡´æ€§çš„åè®®ï¼Œå°±æ˜¯ MESIåè®®ï¼Œè§„å®šæ¯æ¡ç¼“å­˜æœ‰ä¸€ä¸ªçŠ¶æ€ä½ï¼ŒåŒæ—¶å®šä¹‰äº†å››ä¸ªçŠ¶æ€ï¼š</p>
<ul>
<li><p>ä¿®æ”¹æ€(Modified) ï¼šæ­¤cacheè¡Œå·²è¢«ä¿®æ”¹è¿‡(è„è¡Œ)ï¼Œå†…å®¹å·²ä¸åŒäºä¸»å­˜ï¼Œä¸ºæ­¤cacheä¸“æœ‰</p>
</li>
<li><p>ä¸“æœ‰æ€(Exclusive)ï¼šæ­¤cacheè¡Œå†…å®¹åŒäºä¸»å­˜ï¼Œä½†ä¸å‡ºç°äºå…¶ä»–cacheä¸­ï¼›</p>
</li>
<li><p>å…±äº«æ€(Shared)ï¼šæ­¤cacheè¡Œå†…å®¹åŒäºä¸»å­˜ï¼Œä½†ä¹Ÿå‡ºç°äºå…¶ä»–cacheä¸­ï¼›</p>
</li>
<li><p>æ— æ•ˆæ€(Invalid)ï¼šæ­¤cacheè¡Œå†…å®¹æ— æ•ˆ(ç©ºè¡Œ)ï¼›</p>
</li>
</ul>
<p>å¤šå¤„ç†å™¨æ—¶ï¼Œå•ä¸ªCPUå¯¹ç¼“å­˜ä¸­æ•°æ®è¿›è¡Œäº†æ”¹åŠ¨ï¼Œéœ€é€šçŸ¥ç»™å…¶ä»–CPUã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒCPUå¤„ç†è¦æ§åˆ¶è‡ªå·±çš„è¯»å†™æ“ä½œï¼Œè¿˜è¦ç›‘å¬å…¶ä»–CPUå‘å‡ºçš„é€šçŸ¥ï¼Œä»è€Œä¿è¯æ•°æ®çš„<strong>æœ€ç»ˆä¸€è‡´</strong>ã€‚</p>
<p>ç¼“å­˜ä¸­çš„æ•°æ®ä¸ä¸»å­˜çš„æ•°æ®å¹¶ä¸æ˜¯å®æ—¶åŒæ­¥çš„ï¼Œå„CPUæ ¸å¿ƒé—´çš„ç¼“å­˜æ•°æ®ä¹Ÿä¸æ˜¯å®æ—¶åŒæ­¥çš„ã€‚åœ¨åŒä¸€æ—¶é—´ç‚¹ï¼Œå„ä¸ªCPUæ‰€çœ‹åˆ°åŒä¸€å†…å­˜åœ°å€çš„æ•°æ®å¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ï¼Œå°±ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
<h2 id="æŒ‡ä»¤é‡æ’"><a href="#æŒ‡ä»¤é‡æ’" class="headerlink" title="æŒ‡ä»¤é‡æ’"></a>æŒ‡ä»¤é‡æ’</h2><p>å½“CPU<strong>å†™ç¼“å­˜æ—¶</strong>å‘ç°ç¼“å­˜åŒºå—æ­£è¢«å…¶ä»–CPUå ç”¨ï¼Œä¸ºäº†æé«˜CPUå¤„ç†æ€§èƒ½ï¼Œå¯èƒ½å°†åé¢çš„<strong>è¯»ç¼“å­˜å‘½ä»¤ä¼˜å…ˆæ‰§è¡Œ</strong>ã€‚</p>
<p><img src="/p/ffba6cb8/image-20220305180930700.png" alt="image-20220305180930700"></p>
<p><strong>é‡æ’éœ€è¦éµå¾ª as-if-serial è¯­ä¹‰</strong>ï¼šä¸ç®¡æ€ä¹ˆé‡æ’åº(ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†æé«˜å¹¶è¡Œåº¦)ï¼Œ(å•çº¿ç¨‹)ç¨‹åºçš„æ‰§è¡Œç»“æœä¸èƒ½è¢«æ”¹å˜ã€‚ç¼–è¯‘å™¨ï¼Œruntime å’Œå¤„ç†å™¨éƒ½å¿…é¡»éµå®ˆ as-if-serial è¯­ä¹‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šç¼–è¯‘å™¨å’Œå¤„ç†å™¨<strong>ä¸ä¼šå¯¹å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„æ“ä½œåšé‡æ’åº</strong>ã€‚</p>
<p><code>as-if-serialè¯­ä¹‰</code>æŠŠå•çº¿ç¨‹ç¨‹åºä¿æŠ¤äº†èµ·æ¥ï¼Œæ¢å¥è¯è¯´ï¼š<code>as-if-serialè¯­ä¹‰</code>ä»…åœ¨å•CPUå•çº¿ç¨‹çš„æƒ…å†µä¸‹èƒ½ä¿è¯ç»“æœæ­£ç¡®ã€‚å¤šæ ¸å¤šçº¿ç¨‹ä¸­ï¼ŒæŒ‡ä»¤é€»è¾‘æ— æ³•åˆ†è¾¨å› æœå…³ç³»ï¼Œå¯èƒ½ä¼šå‡ºç°<strong>ä¹±åºæ‰§è¡Œ</strong>ï¼Œå¯¼è‡´ç¨‹åºè¿è¡Œç»“æœé”™è¯¯ï¼Œå°±ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
<h2 id="å†…å­˜å±éšœ"><a href="#å†…å­˜å±éšœ" class="headerlink" title="å†…å­˜å±éšœ"></a>å†…å­˜å±éšœ</h2><p>ä¸è®ºæ˜¯ç¼“å­˜åŒæ­¥è¿˜æ˜¯æŒ‡ä»¤é‡æ’ï¼Œéƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚</p>
<p>å¤„ç†å™¨æä¾›äº†ä¸¤ä¸ªå†…å­˜å±éšœæŒ‡ä»¤(Memory Barrier)ç”¨äºè§£å†³ç¼“å­˜åŒæ­¥å’ŒæŒ‡ä»¤é‡æ’çš„é—®é¢˜ã€‚ </p>
<ul>
<li><p>è¯»å†…å­˜å±éšœ(Load Memory Barrier)ï¼šåœ¨æŒ‡ä»¤å‰æ’å…¥Load Barrierï¼Œå¯ä»¥è®©é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°æ®å¤±æ•ˆï¼Œå¼ºåˆ¶é‡æ–°ä»ä¸»å†…å­˜åŠ è½½æ•°æ®ã€‚å¼ºåˆ¶è¯»å–ä¸»å†…å­˜å†…å®¹ï¼Œè®©CPUç¼“å­˜ä¸ä¸»å†…å­˜ä¿æŒä¸€è‡´ï¼Œé¿å…äº†ç¼“å­˜å¯¼è‡´çš„ä¸€è‡´æ€§é—®é¢˜ã€‚</p>
</li>
<li><p>å†™å†…å­˜å±éšœ(Store Memory Barrier)ï¼šåœ¨æŒ‡ä»¤åæ’å…¥Store Barrierï¼Œèƒ½è®©å†™å…¥ç¼“å­˜ä¸­çš„æœ€æ–°æ•°æ®æ›´æ–°å†™å…¥ä¸»å†…å­˜ï¼Œè®©å…¶ä»–çº¿ç¨‹å¯è§ã€‚å¼ºåˆ¶å†™å…¥ä¸»å†…å­˜ï¼Œè¿™ç§æ˜¾ç¤ºè°ƒç”¨ï¼ŒCPUå°±ä¸ä¼šå› ä¸ºæ€§èƒ½è€ƒè™‘è€Œå»å¯¹æŒ‡ä»¤é‡æ’ã€‚</p>
</li>
</ul>
</body></html>]]></content>
      <tags>
        <tag>JUCå¹¶å‘åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>Callableæ¥å£</title>
    <url>/p/b279e65c.html</url>
    <content><![CDATA[<html><head></head><body><p>Callableæ˜¯ä¸€ä¸ªæ— å…¥å‚ï¼Œæœ‰è¿”å›å€¼ï¼Œå¯æŠ›å¼‚å¸¸çš„ä¸€ä¸ªæ¥å£ã€‚</p>
<p>æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Callable</span>&lt;V&gt; {</span><br><span class="line">    V <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Runnableæ¥å£æ—¢æ— è¿”å›å€¼ï¼Œä¹Ÿæ— å…¥å‚ï¼Œä¸èƒ½æŠ›å¼‚å¸¸</span></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Runnable</span> {</span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>é€šå¸¸ç”¨äºå¸¦è¿”å›å€¼çš„çº¿ç¨‹ï¼Œåœ¨çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åå›è°ƒä¸€ä¸‹è¿™ä¸ªæ¥å£ï¼Œå®ç° Callable&lt;T&gt; æ¥å£åˆ›å»ºçº¿ç¨‹ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadCallable</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException {</span><br><span class="line">        <span class="comment">// FutureTaskæ˜¯ä¸ªé€‚é…ç±»ï¼Œé€‚é…å™¨æ¨¡å¼</span></span><br><span class="line">        FutureTask&lt;String&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">MyThread0403</span>());</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask,<span class="string">"A"</span>).start();</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> futureTask.get();</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç° Callable&lt;T&gt; æ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread0403</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;String&gt; {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">"---&gt;Call()"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"1024"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>FutureTask</strong></p>
<p>FutureTask å®ç°äº†RunnableFutureæ¥å£ï¼Œå¯¹Runnableæ¥å£å’ŒCallableæ¥å£çš„çº¿ç¨‹åšäº†é€‚é…ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FutureTask</span>&lt;V&gt; <span class="keyword">implements</span> <span class="title class_">RunnableFuture</span>&lt;V&gt; {}</span><br><span class="line"></span><br><span class="line"><span class="comment">// RunnableFutureæ¥å£ç»§æ‰¿ä¸Runnableï¼ŒFutureTaské—´æ¥çš„å®ç°äº†Runnableæ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RunnableFuture</span>&lt;V&gt; <span class="keyword">extends</span> <span class="title class_">Runnable</span>, Future&lt;V&gt; {}</span><br></pre></td></tr></tbody></table></figure>

<p>FutureTask æ˜¯å¯å–æ¶ˆå¼çš„å¼‚æ­¥è®¡ç®—ï¼Œè¯¥ç±»æä¾›äº†ä¸€ä¸ªFutureçš„åŸºæœ¬å®ç°ï¼Œå…·æœ‰å¯åŠ¨å’Œå–æ¶ˆè®¡ç®—çš„æ–¹æ³•ï¼ŒæŸ¥è¯¢è®¡ç®—æ˜¯å¦å®Œæ•´ï¼Œå¹¶æ£€ç´¢è®¡ç®—ç»“æœã€‚ ç»“æœåªèƒ½åœ¨è®¡ç®—å®Œæˆåæ‰èƒ½æ£€ç´¢; å¦‚æœè®¡ç®—å°šæœªå®Œæˆï¼Œåˆ™getæ–¹æ³•å°†é˜»æ­¢ã€‚ ä¸€æ—¦è®¡ç®—å®Œæˆï¼Œåˆ™æ— æ³•é‡æ–°å¯åŠ¨æˆ–å–æ¶ˆè®¡ç®—ï¼ˆé™¤éä½¿ç”¨ runAndReset() æ–¹æ³•è°ƒç”¨è®¡ç®— ï¼‰ã€‚ </p>
</body></html>]]></content>
      <tags>
        <tag>JUCå¹¶å‘åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>ForkJoin</title>
    <url>/p/f6316a6c.html</url>
    <content><![CDATA[<html><head></head><body><p>ForkJoinPool æ˜¯ExecutorService æ¥å£çš„å®ç°ï¼Œå®ƒä¸“ä¸ºå¯ä»¥é€’å½’åˆ†è§£æˆå°å—çš„å·¥ä½œè€Œè®¾è®¡ã€‚Java 7å¼€å§‹å¼•å…¥äº†ä¸€ç§æ–°çš„Fork/Joinçº¿ç¨‹æ± ï¼Œå®ƒå¯ä»¥æ‰§è¡Œä¸€ç§ç‰¹æ®Šçš„ä»»åŠ¡ï¼ˆRunnableï¼‰ï¼šæŠŠä¸€ä¸ªå¤§ä»»åŠ¡æ‹†æˆå¤šä¸ªå°ä»»åŠ¡å¹¶è¡Œå¤„ç†ï¼Œæœ€åå°†å­ä»»åŠ¡ç»“æœåˆå¹¶æˆæœ€åçš„è®¡ç®—ç»“æœã€‚å……åˆ†åˆ©ç”¨å¤šçº¿ç¨‹å¤„ç†å™¨çš„ä¼˜åŠ¿ï¼Œæé«˜ç¨‹åºæ€§èƒ½ã€‚</p>
<p><img src="/p/f6316a6c/ForkJoin.png" alt="forkJoin"></p>
<h2 id="é«˜æ€§èƒ½ä½å†²çª"><a href="#é«˜æ€§èƒ½ä½å†²çª" class="headerlink" title="é«˜æ€§èƒ½ä½å†²çª"></a>é«˜æ€§èƒ½ä½å†²çª</h2><ul>
<li><p>æ¯ä¸ªWorkerçº¿ç¨‹éƒ½ç»´æŠ¤ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œå³ForkJoinWorkerThreadä¸­çš„ä»»åŠ¡é˜Ÿåˆ—ï¼›</p>
</li>
<li><p>ForkJoinç»´æŠ¤çš„ä»»åŠ¡é˜Ÿåˆ—æ˜¯åŒç«¯é˜Ÿåˆ—ï¼ˆDeQueueï¼‰ï¼Œå¯ä»¥åŒæ—¶æ”¯æŒLIFOï¼ˆå…ˆè¿›åå‡ºï¼‰å’ŒFIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ï¼›</p>
</li>
<li><p>å­ä»»åŠ¡ä¼šè¢«åŠ å…¥åˆ°åŸå…ˆä»»åŠ¡æ‰€åœ¨ Worker çº¿ç¨‹çš„ä»»åŠ¡é˜Ÿåˆ—ï¼›</p>
</li>
<li><p>å½“ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œçº¿ç¨‹ä¼šéšæœºä»å…¶ä»–çš„ Worker çš„é˜Ÿåˆ—ä¸­æ‹¿èµ°ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œï¼ˆå·¥ä½œçªƒå–ï¼šsteal workï¼‰ï¼Œå·¥ä½œçªƒå–å¸¦æ¥çš„æ€§èƒ½æå‡åç†è®ºï¼ŒAPIçš„å¤æ‚æ€§è¾ƒé«˜ï¼Œå®é™…ç ”å‘ä¸­å¯æ§æ€§æ¥è¯´ä¸å¦‚å…¶ä»–APIã€‚</p>
</li>
</ul>
<h2 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h2><ul>
<li><p>å¦‚æœä¸€ä¸ª Worker çº¿ç¨‹é‡åˆ°äº† join æ“ä½œï¼Œè€Œè¿™æ—¶å€™æ­£åœ¨å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œä¼šç­‰åˆ°è¿™ä¸ªä»»åŠ¡ç»“æŸã€‚å¦åˆ™ç›´æ¥è¿”å›ï¼›</p>
</li>
<li><p>å¦‚æœä¸€ä¸ª Worker çº¿ç¨‹çªƒå–ä»»åŠ¡å¤±è´¥ï¼Œå®ƒä¼šè°ƒç”¨ yield æˆ–è€… sleep ä¹‹ç±»çš„æ–¹æ³•ä¼‘æ¯ä¸€ä¼šå„¿ï¼Œå†å°è¯•ï¼ˆå¦‚æœæ‰€æœ‰çº¿ç¨‹éƒ½æ˜¯ç©ºé—²çŠ¶æ€ï¼Œå³æ²¡æœ‰ä»»åŠ¡æ‰§è¡Œï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¹Ÿä¼šè¿›å…¥é˜»å¡çŠ¶æ€ç­‰å¾…æ–°ä»»åŠ¡çš„åˆ°æ¥ï¼‰ï¼›</p>
</li>
</ul>
<h2 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h2><ul>
<li><p>ä½¿ç”¨å°½å¯èƒ½å°‘çš„çº¿ç¨‹æ± ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæœ€å¥½çš„å†³å®šæ˜¯ä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ± ï¼›</p>
</li>
<li><p>å¦‚æœä¸éœ€è¦ç‰¹å®šè°ƒæ•´ï¼Œè¯·ä½¿ç”¨é»˜è®¤çš„å…¬å…±çº¿ç¨‹æ± ï¼›</p>
</li>
<li><p>ä½¿ç”¨åˆç†çš„é˜ˆå€¼å°†ForkJoinTaskæ‹†åˆ†ä¸ºå­ä»»åŠ¡ï¼›</p>
</li>
<li><p><strong>é¿å…åœ¨ForkJoinTaskä¸­å‡ºç°ä»»ä½•é˜»å¡ï¼ˆä¾‹å¦‚è€—æ—¶IOï¼Œå¤§é‡æŸ¥è¯¢æ•°æ®åº“ã€ç½‘ç»œè¯·æ±‚ç­‰ï¼‰ï¼›</strong></p>
</li>
<li><p>é€‚åˆæ•°æ®å¤„ç†ã€ç»“æœæ±‡æ€»ã€ç»Ÿè®¡ç­‰åœºæ™¯ï¼›</p>
</li>
</ul>
<p>java8å®ä¾‹ï¼šjava.utilArraysç±»ç”¨äºå…¶ parallelSort() æ–¹æ³•ï¼›</p>
<h2 id="åº”ç”¨ç¤ºä¾‹"><a href="#åº”ç”¨ç¤ºä¾‹" class="headerlink" title="åº”ç”¨ç¤ºä¾‹"></a>åº”ç”¨ç¤ºä¾‹</h2><p>ä¾‹å¦‚ï¼Œä¸‹é¢å°†ä» 0 åŠ åˆ° 10_0000_0000ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10_0000_0000L</span>; i++) {</span><br><span class="line">        sum += i;</span><br><span class="line">    }</span><br><span class="line">    System.out.println(sum + <span class="string">",è€—æ—¶ï¼š"</span> + (System.currentTimeMillis() - start) + <span class="string">"ms"</span>);<span class="comment">// è€—æ—¶ï¼š361ms</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä½¿ç”¨ ForkJoinPool æ‰§è¡Œè¯¥ä»»åŠ¡ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException {</span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    <span class="type">ForkJoinPool</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ForkJoinPool</span>();</span><br><span class="line">    ForkJoinTask&lt;Long&gt; task = <span class="keyword">new</span> <span class="title class_">Task04051</span>(<span class="number">0L</span>, <span class="number">10_0000_0000L</span>);</span><br><span class="line">    ForkJoinTask&lt;Long&gt; submit = pool.submit(task);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">result</span> <span class="operator">=</span> submit.get();</span><br><span class="line"></span><br><span class="line">    System.out.println(result + <span class="string">",è€—æ—¶ï¼š"</span> + (System.currentTimeMillis() - start) + <span class="string">"ms"</span>); <span class="comment">// è€—æ—¶ï¼š186ms</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä½¿ç”¨  stream å¹¶è¡Œæ‰§è¡Œä»»åŠ¡ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">	<span class="comment">// ä¸ LongStream ç±»ä¼¼çš„æœ‰DoubleStreamã€IntegerStream ç­‰</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> LongStream.rangeClosed(<span class="number">0L</span>, num).parallel().reduce(<span class="number">0</span>, Long::sum);</span><br><span class="line"></span><br><span class="line">    System.out.println(sum + <span class="string">",è€—æ—¶ï¼š"</span> + (System.currentTimeMillis() - start) + <span class="string">"ms"</span>);<span class="comment">// è€—æ—¶ï¼š126ms</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</body></html>]]></content>
      <tags>
        <tag>JUCå¹¶å‘åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>JMMå†…å­˜æ¨¡å‹</title>
    <url>/p/eb5989ef.html</url>
    <content><![CDATA[<html><head></head><body><p>JMMå…¨ç§°Java Memory Modelï¼ŒJavaå†…å­˜æ¨¡å‹æ˜¯JSR133é‡ŒæŒ‡å‡ºäº†JMMæ˜¯ç”¨æ¥å®šä¹‰ä¸€ä¸ª<strong>ä¸€è‡´çš„ã€è·¨å¹³å°</strong>çš„å†…å­˜æ¨¡å‹ï¼Œæ˜¯ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œç”¨äºå±è”½æ‰å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œè®©Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å¹¶å‘æ•ˆæœã€‚</p>
<h2 id="åŒºåˆ†å¼€å†…å­˜ç»“æ„"><a href="#åŒºåˆ†å¼€å†…å­˜ç»“æ„" class="headerlink" title="åŒºåˆ†å¼€å†…å­˜ç»“æ„"></a>åŒºåˆ†å¼€å†…å­˜ç»“æ„</h2><p>å†…å­˜ç»“æ„å’Œå†…å­˜æ¨¡å‹å®Œå…¨æ˜¯ä¸¤ä¸ªä¸œè¥¿ï¼Œå†…å­˜ç»“æ„æ˜¯ä¸‹å›¾ä¸­çš„è¿™äº›</p>
<p><img src="/p/eb5989ef/webp.webp" alt="img"></p>
<h2 id="ä»€ä¹ˆæ˜¯å†…å­˜æ¨¡å‹"><a href="#ä»€ä¹ˆæ˜¯å†…å­˜æ¨¡å‹" class="headerlink" title="ä»€ä¹ˆæ˜¯å†…å­˜æ¨¡å‹"></a>ä»€ä¹ˆæ˜¯å†…å­˜æ¨¡å‹</h2><p>åœ¨å¤šCPUçš„ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªCPUéƒ½æœ‰å¤šçº§ç¼“å­˜ï¼Œä¸€èˆ¬åˆ†ä¸ºL1ã€L2ã€L3ç¼“å­˜ã€‚å› ä¸ºè¿™äº›ç¼“å­˜çš„å­˜åœ¨ï¼Œæå‡äº†ååé‡ï¼Œå‡è½»äº†æ•°æ®æ€»çº¿ä¸Šæ•°æ®ä¼ è¾“çš„å‹åŠ›ï¼ŒåŒæ—¶ä¹Ÿå¸¦æ¥äº†å¾ˆå¤šæ–°çš„æŒ‘æˆ˜ï¼Œæ¯”å¦‚ä¸¤ä¸ªCPUåŒæ—¶å»æ“ä½œåŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿåœ¨ä»€ä¹ˆæ¡ä»¶ä¸‹ï¼Œå®ƒä»¬å¯ä»¥çœ‹åˆ°ç›¸åŒçš„ç»“æœï¼Ÿè¿™äº›éƒ½æ˜¯éœ€è¦è§£å†³çš„ã€‚</p>
<p>æ‰€ä»¥åœ¨CPUçš„å±‚é¢ï¼Œå†…å­˜æ¨¡å‹å®šä¹‰äº†ä¸€ä¸ªå……åˆ†å¿…è¦æ¡ä»¶ï¼Œä¿è¯å…¶å®ƒCPUçš„å†™å…¥åŠ¨ä½œå¯¹è¯¥CPUæ˜¯å¯è§çš„ï¼Œè€Œä¸”è¯¥CPUçš„å†™å…¥åŠ¨ä½œå¯¹å…¶å®ƒCPUä¹Ÿæ˜¯å¯è§çš„ï¼Œé‚£è¿™ç§å¯è§æ€§ï¼Œåº”è¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ</p>
<p>æœ‰äº›å¤„ç†å™¨æä¾›äº†å¼ºå†…å­˜æ¨¡å‹ï¼Œä»ç¡¬ä»¶å±‚é¢ä¸Šæ”¯æŒæ‰€æœ‰CPUåœ¨ä»»ä½•æ—¶å€™éƒ½èƒ½çœ‹åˆ°å†…å­˜ä¸­ä»»æ„ä½ç½®ç›¸åŒçš„å€¼ã€‚å¤§å¤šæ•°å¤„ç†å™¨æä¾›çš„æ˜¯å¼±å†…å­˜æ¨¡å‹ï¼Œéœ€è¦æ‰§è¡Œä¸€äº›ç‰¹æ®ŠæŒ‡ä»¤ï¼ˆ<code>Memory Barriers</code>å†…å­˜å±éšœï¼‰ï¼Œåˆ·æ–°CPUç¼“å­˜çš„æ•°æ®åˆ°å†…å­˜ä¸­ï¼Œä¿è¯è¿™ä¸ªå†™æ“ä½œèƒ½å¤Ÿè¢«å…¶å®ƒCPUå¯è§ï¼Œæˆ–è€…å°†CPUç¼“å­˜çš„æ•°æ®è®¾ç½®ä¸ºæ— æ•ˆçŠ¶æ€ï¼Œä¿è¯å…¶å®ƒCPUçš„å†™æ“ä½œå¯¹å½“å‰CPUå¯è§ã€‚</p>
<p>å†…å­˜å±éšœé™¤äº†å®ç°CPUä¹‹å‰çš„æ•°æ®å¯è§æ€§ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„èŒè´£æ˜¯<strong>ç¦æ­¢æŒ‡ä»¤çš„é‡æ’åº</strong>ã€‚é‡æ’åºå¯ä»¥å‘ç”Ÿåœ¨å¥½å‡ ä¸ªåœ°æ–¹ï¼šç¼–è¯‘å™¨ã€è¿è¡Œæ—¶ã€JITç­‰ï¼Œé€šè¿‡å†…å­˜å±éšœçš„åŠŸèƒ½ï¼Œå¯ä»¥ç¦æ­¢ä¸€äº›ä¸å¿…è¦ã€æˆ–è€…ä¼šå¸¦æ¥è´Ÿé¢å½±å“çš„é‡æ’åºä¼˜åŒ–ï¼Œåœ¨å†…å­˜æ¨¡å‹çš„èŒƒå›´å†…ï¼Œå®ç°æ›´é«˜çš„æ€§èƒ½ï¼ŒåŒæ—¶ä¿è¯ç¨‹åºçš„æ­£ç¡®æ€§ã€‚</p>
<h2 id="Javaä¸­çš„å†…å­˜æ¨¡å‹"><a href="#Javaä¸­çš„å†…å­˜æ¨¡å‹" class="headerlink" title="Javaä¸­çš„å†…å­˜æ¨¡å‹"></a>Javaä¸­çš„å†…å­˜æ¨¡å‹</h2><ul>
<li>åœ¨Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰ä¸­ï¼Œæè¿°äº†åœ¨å¤šçº¿ç¨‹ä»£ç ä¸­å“ªäº›è¡Œä¸ºæ˜¯è§„èŒƒæ­£ç¡®çš„ï¼Œä»¥åŠå¤šçº¿ç¨‹ä¹‹é—´å¦‚ä½•è¿›è¡Œé€šä¿¡ï¼Œä»£ç ä¸­å˜é‡çš„è¯»å†™è¡Œä¸ºå¦‚ä½•ååº”åˆ°å†…å­˜ã€CPUç¼“å­˜çš„åº•å±‚ç»†èŠ‚ã€‚Javaå†…å­˜æ¨¡å‹ä¸­å®šä¹‰äº†å®ƒä»¬çš„è¡Œä¸ºï¼Œç¡®ä¿æ­£ç¡®åŒæ­¥çš„Javaä»£ç åœ¨æ‰€æœ‰çš„å¤„ç†å™¨æ¶æ„ä¸Šéƒ½èƒ½æ­£ç¡®æ‰§è¡Œã€‚</li>
<li>åœ¨Javaä¸­åŒ…å«äº†å‡ ä¸ªå…³é”®å­—ï¼švolatileã€final å’Œ synchronizedï¼Œå¸®åŠ©ç¨‹åºå‘˜æŠŠä»£ç ä¸­çš„å¹¶å‘éœ€æ±‚æè¿°ç»™ç¼–è¯‘å™¨ã€è§£é‡Šå™¨ï¼Œå†è½¬æˆæœºå™¨æŒ‡ä»¤ä¸‹è¾¾ç»™å¤„ç†å™¨ã€‚</li>
</ul>
<h3 id="å†…å­˜å¯è§æ€§"><a href="#å†…å­˜å¯è§æ€§" class="headerlink" title="å†…å­˜å¯è§æ€§"></a>å†…å­˜å¯è§æ€§</h3><p>ä¸åŒçº¿ç¨‹æ‹¥æœ‰å„è‡ªçš„ç§æœ‰<strong>å·¥ä½œå†…å­˜</strong>ï¼Œå½“çº¿ç¨‹éœ€è¦è¯»å–æˆ–ä¿®æ”¹æŸä¸ªå˜é‡æ—¶ï¼Œä¸èƒ½ç›´æ¥å»æ“ä½œ<strong>ä¸»å†…å­˜</strong>ä¸­çš„å˜é‡ï¼Œè€Œæ˜¯éœ€è¦å°†è¿™ä¸ªå˜é‡è¯»å–åˆ°çº¿ç¨‹çš„<strong>å·¥ä½œå†…å­˜</strong>çš„<strong>å˜é‡å‰¯æœ¬</strong>ä¸­ï¼Œå½“è¯¥çº¿ç¨‹ä¿®æ”¹å…¶å˜é‡å‰¯æœ¬çš„å€¼åï¼Œ<strong>å…¶å®ƒçº¿ç¨‹å¹¶ä¸èƒ½ç«‹åˆ»è¯»å–åˆ°æ–°å€¼</strong>ï¼Œéœ€è¦å°†ä¿®æ”¹åçš„å€¼<strong>åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­</strong>ï¼Œå…¶å®ƒçº¿ç¨‹æ‰èƒ½<strong>ä»ä¸»å†…å­˜è¯»å–åˆ°ä¿®æ”¹åçš„å€¼</strong>ã€‚</p>
<p><img src="/p/eb5989ef/image-20220305205222083.png" alt="image-20220305205222083"></p>
<p>çº¿ç¨‹Aä»ä¸»å­˜ä¸­è¯»åˆ°å€¼flag=trueï¼ŒåŠ è½½åˆ°è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­ï¼ˆå †åŒºï¼‰ï¼Œç”±æ‰§è¡Œå¼•æ“å¤„ç†åå°†å€¼å†èµ‹å€¼ç»™å·¥ä½œå†…å­˜ï¼Œå†™å…¥å­˜å‚¨è¿‡ç¨‹ï¼ˆå­˜å‚¨è¿‡ç¨‹å°±æ˜¯æŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡æ”¾å…¥ä¸»å­˜ä¸­çš„æ“ä½œï¼‰ã€‚</p>
<p>lock ä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠä¸€ä¸ªå˜é‡æ ‡è¯†ä¸ºçº¿ç¨‹ç‹¬å çŠ¶æ€ï¼Œunlock ä¹Ÿæ˜¯ä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå°†è¢«é”å®šçš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åæ‰èƒ½è¢«å…¶å®ƒçº¿ç¨‹é”å®šã€‚</p>
<blockquote>
<p>å¤šçº¿ç¨‹æ“ä½œçº¿ç¨‹å…±äº«çš„å˜é‡æ—¶ï¼Œå˜é‡è¢«å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹åï¼Œå¹¶ä¸èƒ½å»å®æ—¶ä¿®æ”¹å…¶å®ƒçº¿ç¨‹æ­£åœ¨ä½¿ç”¨è¯¥å˜é‡çš„å€¼ï¼Œæ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</p>
</blockquote>
<p>åœ¨ä¸‹é¢è¿™ä¸ªå®ä¾‹ä¸­ï¼Œçº¿ç¨‹Aä»ä¸»å†…å­˜ä¸­è¯»å–åˆ°n=0ï¼ŒåŠ è½½åˆ°è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œä¸€ç§’é’Ÿåï¼Œmainçº¿ç¨‹æŠŠnçš„å€¼æ”¹ä¸º1åå†™å›ä¸»å†…å­˜ï¼Œæ­¤æ—¶Aè¿˜æ²¡æœ‰æ‹¿åˆ°æœ€æ–°çš„å€¼ã€‚æ‰€ä»¥çº¿ç¨‹Aæ˜¯ä¸ä¼šåœæ­¢æ‰§è¡Œçš„ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; {</span><br><span class="line">        <span class="keyword">while</span> (n == <span class="number">0</span>) {</span><br><span class="line">        }</span><br><span class="line">    }, <span class="string">"A"</span>).start();</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// ä¼‘çœ  1s åä¿®æ”¹n=1ï¼Œèƒ½å¦åœæ­¢çº¿ç¨‹Aï¼Ÿ</span></span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    n = <span class="number">1</span>;</span><br><span class="line">    System.out.println(<span class="string">"çº¿ç¨‹åœæ­¢äº†å—ï¼Ÿ"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è§£å†³ï¼šå½“ä¸»å­˜ä¸­çš„å€¼å‘ç”Ÿä¿®æ”¹åï¼Œåº”è¯¥é€šçŸ¥æ‰€æœ‰æ“ä½œä¸»å­˜å˜é‡çš„çº¿ç¨‹ã€‚åœ¨Javaä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ volatile å…³é”®å­—æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>ä¸‹é¢ç»§ç»­å¯¹çº¿ç¨‹å¯è§æ€§é—®é¢˜è¿›è¡Œå‰–æã€‚</p>
<h3 id="çº¿ç¨‹è®¿é—®æ•°æ®çš„å¯è§æ€§é—®é¢˜"><a href="#çº¿ç¨‹è®¿é—®æ•°æ®çš„å¯è§æ€§é—®é¢˜" class="headerlink" title="çº¿ç¨‹è®¿é—®æ•°æ®çš„å¯è§æ€§é—®é¢˜"></a>çº¿ç¨‹è®¿é—®æ•°æ®çš„å¯è§æ€§é—®é¢˜</h3><p>ç¼“å­˜å¼•èµ·çš„å¯è§æ€§é—®é¢˜ã€‚å½“ä¸»å­˜ä¸­çš„dataå‘ç”Ÿæ”¹å˜åï¼Œå…¶ä»–çº¿ç¨‹æ ˆä¸­çš„ä½¿ç”¨çš„ data æ˜¯ä¸èƒ½å¤ŸåŠæ—¶ä¿®æ”¹çš„ã€‚</p>
<p><img src="/p/eb5989ef/image-20220306162004447.png" alt="image-20220306162004447"></p>
<h4 id="æŒ‡ä»¤é‡æ’åºå¼•èµ·çš„å¯è§æ€§é—®é¢˜"><a href="#æŒ‡ä»¤é‡æ’åºå¼•èµ·çš„å¯è§æ€§é—®é¢˜" class="headerlink" title="æŒ‡ä»¤é‡æ’åºå¼•èµ·çš„å¯è§æ€§é—®é¢˜"></a>æŒ‡ä»¤é‡æ’åºå¼•èµ·çš„å¯è§æ€§é—®é¢˜</h4><p>åœ¨Javaå±‚é¢ï¼ŒæŒ‡ä»¤é‡æ’åºä¸èƒ½å¤Ÿé€šè¿‡ javap æŸ¥çœ‹å‡ºclassæ–‡ä»¶ä¸­çš„é‡æ’åºï¼Œè€Œæ˜¯å‘ç”Ÿåœ¨è¿è¡Œæ—¶çš„ç¼–è¯‘å™¨ï¼ˆJIT - Just In Timeï¼‰ï¼Œå°†å­—èŠ‚ç è¿›è¡Œé‡æ’åºç¼–è¯‘æœºå™¨è¯­è¨€ï¼ˆæ±‡ç¼–ï¼‰ã€‚</p>
<blockquote>
<p>ä»€ä¹ˆæ˜¯Just In Timeç¼–è¯‘å™¨?</p>
</blockquote>
<p>Javaç¨‹åºä¸€å¼€å§‹æ˜¯é€šè¿‡è§£é‡Šå™¨ï¼ˆInterpreterï¼‰è¿›è¡Œè§£é‡Šæ‰§è¡Œçš„ã€‚å½“JVMå‘ç°æŸä¸ªæ–¹æ³•æˆ–ä»£ç å—è¿è¡Œç‰¹åˆ«é¢‘ç¹æ—¶ï¼Œå°±ä¼šæŠŠè¿™äº›ä»£ç è®¤å®šä¸ºâ€œçƒ­ç‚¹ä»£ç ï¼ˆHot Spot Codeï¼‰â€ï¼Œç„¶åJVMä¼šæŠŠè¿™äº›ä»£ç ç¼–è¯‘æˆä¸æœ¬åœ°å¹³å°ç›¸å…³çš„æœºå™¨ç ï¼Œå¹¶è¿›è¡Œå„ç§å±‚æ¬¡çš„ä¼˜åŒ–ï¼Œå®Œæˆè¿™ä¸ªä»»åŠ¡çš„ç¼–è¯‘å™¨ç§°ä¸ºï¼šå³æ—¶ç¼–è¯‘å™¨ï¼ˆJust In Time Compilerï¼ŒJITï¼‰ã€‚<br>JITç¼–è¯‘å™¨æ˜¯â€œåŠ¨æ€ç¼–è¯‘å™¨â€çš„ä¸€ç§ï¼Œç›¸å¯¹çš„â€œé™æ€ç¼–è¯‘å™¨â€åˆ™æ˜¯æŒ‡çš„æ¯”å¦‚ï¼šC/C++çš„ç¼–è¯‘å™¨ã€‚<br>æ³¨æ„ï¼š<br>JITå¹¶ä¸æ˜¯JVMçš„å¿…é¡»éƒ¨åˆ†ï¼ŒJVMè§„èŒƒå¹¶æ²¡æœ‰è§„å®šJITå¿…é¡»å­˜åœ¨ï¼Œæ›´æ²¡æœ‰é™å®šå’ŒæŒ‡å¯¼JITã€‚ä½†æ˜¯ï¼ŒJITæ€§èƒ½çš„å¥½åã€ä»£ç ä¼˜åŒ–ç¨‹åº¦çš„é«˜ä½å´æ˜¯è¡¡é‡ä¸€æ¬¾JVMæ˜¯å¦ä¼˜ç§€çš„æœ€å…³é”®æŒ‡æ ‡ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯è™šæ‹Ÿæœºä¸­æœ€æ ¸å¿ƒä¸”æœ€èƒ½ä½“ç°è™šæ‹ŸæœºæŠ€æœ¯æ°´å¹³çš„éƒ¨åˆ†ã€‚</p>
<p><img src="/p/eb5989ef/image-20220306162227282.png" alt="image-20220306162227282"></p>
<p>è¿˜å¯èƒ½å‘ç”Ÿç­‰æ•ˆæ›¿æ¢ã€‚</p>
<p><img src="/p/eb5989ef/image-20220306162316303.png" alt="image-20220306162316303"></p>
<p>å°†ä¸Šé¢è¿™äº›ä»£ç java.exe ç¼–è¯‘æˆclasså­—èŠ‚ç åŠ è½½åˆ°JVMä¹‹åï¼Œé€šè¿‡è¿è¡Œæ—¶ç¼–è¯‘å™¨JITå°†classå­—èŠ‚ç è½¬æˆæ±‡ç¼–æŒ‡ä»¤åè¿›è¡Œé‡æ’åºæˆ–ç­‰æ•ˆæ›¿æ¢ã€‚ </p>
<p>åœ¨è¿è¡Œæ—¶ï¼ŒJVMä¼šæ ¹æ®ä»£ç çš„è°ƒç”¨æƒ…å†µè¿›è¡Œåˆ¤æ–­ï¼šå¦‚æœ n=0ï¼Œé‚£ä¹ˆwhile(n==0) å°±ç›¸å½“äºæ˜¯ä¸€ä¸ªæ­»å¾ªç¯æˆä¸ºçƒ­ç‚¹ä»£ç ï¼Œé‚£ä¹ˆJITå°±ä¼šè®¤ä¸ºå¯ä»¥æ‰§è¡Œæˆä¸º if(n==0){while(true){}} è¿™æ ·çš„ä¼˜åŒ–ï¼Œå°±ä¸ä¼šå†å›å»è¯»å– n çš„å€¼ï¼Œç›¸å½“äºæ‰§è¡Œäº†ä¸€æ¬¡Javaå±‚é¢çš„é‡æ’åºã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (n == <span class="number">0</span>) {}  è¢«JITç¼–è¯‘å™¨æŒ‡ä»¤é‡æ’åºä¸º <span class="keyword">if</span>(n==<span class="number">0</span>){<span class="keyword">while</span>(<span class="literal">true</span>){}}</span><br></pre></td></tr></tbody></table></figure>

<p>å¦‚æœä»£ç æ”¹ä¸ºåŠ é”çš„æ–¹å¼ï¼Œè™šæ‹Ÿæœºå¯¹äºè¿™ç§å…³é”®çš„ä»£ç æ®µå°±ä¸ä¼šè¿›è¡Œä¼˜åŒ–å¤„ç†äº†ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; {</span><br><span class="line">    <span class="keyword">while</span> (n == <span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="built_in">this</span>){</span><br><span class="line">            add();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}, <span class="string">"A"</span>).start();</span><br></pre></td></tr></tbody></table></figure>

<p>JMM å¯ä»¥é€šè¿‡ happens-before æ¨¡å‹å‘ç¨‹åºå‘˜æä¾›è·¨çº¿ç¨‹çš„å†…å­˜å¯è§æ€§ä¿è¯ã€‚</p>
<h4 id="happen-beforeåŸåˆ™"><a href="#happen-beforeåŸåˆ™" class="headerlink" title="happen-beforeåŸåˆ™"></a>happen-beforeåŸåˆ™</h4><p>ä»JDK1.5å¼€å§‹ï¼Œå¼•å…¥äº†ä¸€ä¸ª happens-before çš„æ¦‚å¿µæ¥é˜è¿°å¤šä¸ªçº¿ç¨‹æ“ä½œå…±äº«å˜é‡çš„å¯è§æ€§é—®é¢˜ã€‚æ‰€ä»¥å¯ä»¥è®¤ä¸ºåœ¨JMMä¸­ï¼Œå¦‚æœä¸€ä¸ªæ“ä½œæ‰§è¡Œçš„ç»“æœéœ€è¦å¯¹å¦ä¸€ä¸ªæ“ä½œå¯è§ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ“ä½œå¿…é¡»æ»¡è¶³ happens-before åŸåˆ™ã€‚</p>
<ol>
<li><p>ç¨‹åºé¡ºåºè§„åˆ™ï¼šä¸€ä¸ªçº¿ç¨‹å†…ï¼ŒæŒ‰ç…§ç¨‹åºä»£ç é¡ºåºï¼Œä¹¦å†™åœ¨å‰é¢çš„æ“ä½œå…ˆè¡Œå‘ç”Ÿä¸ä¹¦å†™åœ¨åé¢çš„æ“ä½œã€‚</p>
</li>
<li><p>ç›‘è§†å™¨é”è§„åˆ™ï¼šä¸€ä¸ªunlockæ“ä½œå…ˆè¡Œå‘ç”Ÿä¸åé¢å¯¹åŒä¸€ä¸ªé”çš„lockæ“ä½œè€…ï¼Œè¿™é‡Œå¿…é¡»æŒ‡åŒä¸€ä¸ªé”ï¼Œåé¢æŒ‡çš„æ˜¯æ—¶é—´ä¸Šçš„å…ˆåé¡ºåºã€‚</p>
</li>
<li><p>volatileå˜é‡è§„åˆ™ï¼šå¯¹ä¸€ä¸ªvolatileå˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œï¼Œè¿™é‡Œçš„åé¢åŒæ ·æŒ‡æ—¶é—´ä¸Šçš„å…ˆåé¡ºåºã€‚</p>
</li>
<li><p>çº¿ç¨‹å¯åŠ¨è§„åˆ™ï¼šThread å¯¹è±¡çš„ start() æ–¹æ³•å…ˆè¡Œå‘ç”Ÿäºæ­¤çº¿ç¨‹çš„ä»»æ„åŠ¨ä½œã€‚</p>
</li>
<li><p>çº¿ç¨‹ç»ˆæ­¢è§„åˆ™ï¼šçº¿ç¨‹ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½å…ˆè¡Œå‘ç”Ÿäºå¯¹æ­¤çº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡thread.joinæ–¹æ³•ç»“æŸï¼Œthread.isAliveçš„è¿”å›å€¼ç­‰æ‰‹æ®µæ£€æµ‹åˆ°çº¿ç¨‹å·²ç»ç»ˆæ­¢æ‰§è¡Œã€‚</p>
</li>
<li><p>çº¿ç¨‹ä¸­æ–­è§„åˆ™ï¼šå¯¹çº¿ç¨‹interruptæ–¹æ³•çš„è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç ç›‘æµ‹åˆ°ä¸­æ–­æ—¶é—´çš„å‘ç”Ÿï¼Œå¯ä»¥é€šè¿‡interruptæ–¹æ³•æ£€æµ‹åˆ°æ˜¯å¦åˆä¸­æ–­å‘ç”Ÿã€‚</p>
</li>
<li><p>å¯¹è±¡ç»ˆç»“è§„åˆ™ï¼šä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆï¼Œå…ˆè¡Œå‘ç”Ÿäºå®ƒçš„finalizeæ–¹æ³•çš„å¼€å§‹ã€‚</p>
</li>
<li><p>ä¼ é€’æ€§ï¼šå¦‚æœAå…ˆè¡Œå‘ç”ŸäºBï¼ŒBå…ˆè¡Œå‘ç”ŸäºCï¼Œåˆ™Aå…ˆè¡Œå‘ç”ŸäºCã€‚</p>
</li>
</ol>
<h3 id="å…³é”®å­—-final-åœ¨JMMä¸­çš„å¤„ç†"><a href="#å…³é”®å­—-final-åœ¨JMMä¸­çš„å¤„ç†" class="headerlink" title="å…³é”®å­— final åœ¨JMMä¸­çš„å¤„ç†"></a>å…³é”®å­— <code>final</code> åœ¨JMMä¸­çš„å¤„ç†</h3><p>åœ¨ä¸‹é¢è¿™ä¸ªå®ä¾‹ä¸­ï¼Œåœ¨read() æ–¹æ³•ä¸­ï¼Œä¸€ä¸ªå˜é‡åŠ äº†finalä¿®é¥°ï¼Œä¸€ä¸ªæ²¡åŠ ã€‚</p>
<p>åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹æœªåŠ finalä¿®é¥°ç¬¦å˜é‡çš„å€¼ï¼Œæœ‰å¯èƒ½ä¸º0ï¼Œä¸ä¿è¯å€¼ä¸ºæ„é€ å‡½æ•°ä¸­çš„èµ‹å€¼ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> {</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> x;</span><br><span class="line">    <span class="type">int</span> y;</span><br><span class="line">    <span class="keyword">static</span> A a;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">A</span><span class="params">()</span> {</span><br><span class="line">        x=<span class="number">3</span>;</span><br><span class="line">        y=<span class="number">4</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span>{</span><br><span class="line">        a = <span class="keyword">new</span> <span class="title class_">A</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">()</span>{</span><br><span class="line">        <span class="keyword">if</span>(f!=<span class="literal">null</span>){</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> a.x; <span class="comment">// è‚¯å®šæ˜¯3</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> a.y; <span class="comment">// å¯èƒ½æ˜¯0</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¯»å–è¯¥å…±äº«å¯¹è±¡çš„finalæˆå‘˜å˜é‡ä¹‹å‰ï¼Œå…ˆè¦è¯»å–å…±äº«çš„å¯¹è±¡ã€‚ä¼ªä»£ç ç¤ºä¾‹ï¼šr = new A()ï¼›k = r.a è¿™ä¸¤ä¸ªæ“ä½œä¸èƒ½é‡æ’åºã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>JUCå¹¶å‘åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>ReetrantLock &amp; ReadWriteLock</title>
    <url>/p/5fd8877a.html</url>
    <content><![CDATA[<html><head></head><body><p>ä¸»è¦æœ‰è¯»å†™é”å’Œå¯é‡å…¥é”ä¸¤ä¸ªé‡è¦çš„å®ç°ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Lock</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">lock</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">// åœ¨è·å–é”çš„è¿‡ç¨‹ä¸­å¯ä»¥ä¸­æ–­å½“å‰çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">lockInterruptibly</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException;</span><br><span class="line">    <span class="comment">// å°è¯•éé˜»å¡åœ°è·å–é”ï¼Œç«‹å³è¿”å›</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> time, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span>;</span><br><span class="line">    Condition <span class="title function_">newCondition</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h2><p><strong>ReentrantLock</strong> å®ç°äº† <strong>Lock</strong>æ¥å£ï¼Œ<strong>Lock</strong>æ¥å£ä¸­å®šä¹‰äº† <strong>lock</strong>ä¸ <strong>unlock</strong>ç›¸å…³æ“ä½œï¼Œå¹¶ä¸”è¿˜å­˜åœ¨ <strong>newCondition</strong>æ–¹æ³•ï¼Œè¡¨ç¤ºç”Ÿæˆä¸€ä¸ªæ¡ä»¶ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// AQS æ ¸å¿ƒä»£ç </span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Sync</span> <span class="keyword">extends</span> <span class="title class_">AbstractQueuedSynchronizer</span> {</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">5179523762034025860L</span>;</span><br><span class="line">     </span><br><span class="line">     <span class="comment">// è·å–é”</span></span><br><span class="line">     <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">lock</span><span class="params">()</span>;</span><br><span class="line">     </span><br><span class="line">     <span class="comment">// éå…¬å¹³æ–¹å¼è·å–</span></span><br><span class="line">     <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">nonfairTryAcquire</span><span class="params">(<span class="type">int</span> acquires)</span> {</span><br><span class="line">         <span class="comment">// å½“å‰çº¿ç¨‹</span></span><br><span class="line">         <span class="keyword">final</span> <span class="type">Thread</span> <span class="variable">current</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">         <span class="comment">// è·å–çŠ¶æ€</span></span><br><span class="line">         <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> getState();</span><br><span class="line">         <span class="keyword">if</span> (c == <span class="number">0</span>) { <span class="comment">// è¡¨ç¤ºæ²¡æœ‰çº¿ç¨‹æ­£åœ¨ç«äº‰è¯¥é”</span></span><br><span class="line">             <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, acquires)) { <span class="comment">// æ¯”è¾ƒå¹¶è®¾ç½®çŠ¶æ€æˆåŠŸï¼ŒçŠ¶æ€0è¡¨ç¤ºé”æ²¡æœ‰è¢«å ç”¨</span></span><br><span class="line">                 <span class="comment">// è®¾ç½®å½“å‰çº¿ç¨‹ç‹¬å </span></span><br><span class="line">                 setExclusiveOwnerThread(current); </span><br><span class="line">                 <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// æˆåŠŸ</span></span><br><span class="line">             }</span><br><span class="line">         }</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (current == getExclusiveOwnerThread()) { <span class="comment">// å½“å‰çº¿ç¨‹æ‹¥æœ‰è¯¥é”</span></span><br><span class="line">             <span class="type">int</span> <span class="variable">nextc</span> <span class="operator">=</span> c + acquires; <span class="comment">// å¢åŠ é‡å…¥æ¬¡æ•°</span></span><br><span class="line">             <span class="keyword">if</span> (nextc &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">"Maximum lock count exceeded"</span>);</span><br><span class="line">             <span class="comment">// è®¾ç½®çŠ¶æ€</span></span><br><span class="line">             setState(nextc); </span><br><span class="line">             <span class="comment">// æˆåŠŸ</span></span><br><span class="line">             <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line">         }</span><br><span class="line">         <span class="comment">// å¤±è´¥</span></span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">     }</span><br><span class="line">     </span><br><span class="line">     <span class="comment">// è¯•å›¾åœ¨å…±äº«æ¨¡å¼ä¸‹è·å–å¯¹è±¡çŠ¶æ€ï¼Œæ­¤æ–¹æ³•åº”è¯¥æŸ¥è¯¢æ˜¯å¦å…è®¸å®ƒåœ¨å…±äº«æ¨¡å¼ä¸‹è·å–å¯¹è±¡çŠ¶æ€ï¼Œå¦‚æœå…è®¸ï¼Œåˆ™è·å–å®ƒ</span></span><br><span class="line">     <span class="keyword">protected</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">tryRelease</span><span class="params">(<span class="type">int</span> releases)</span> {</span><br><span class="line">         <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> getState() - releases;</span><br><span class="line">         <span class="keyword">if</span> (Thread.currentThread() != getExclusiveOwnerThread()) <span class="comment">// å½“å‰çº¿ç¨‹ä¸ä¸ºç‹¬å çº¿ç¨‹</span></span><br><span class="line">             <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalMonitorStateException</span>(); <span class="comment">// æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">         <span class="comment">// é‡Šæ”¾æ ‡è¯†</span></span><br><span class="line">         <span class="type">boolean</span> <span class="variable">free</span> <span class="operator">=</span> <span class="literal">false</span>; </span><br><span class="line">         <span class="keyword">if</span> (c == <span class="number">0</span>) {</span><br><span class="line">             free = <span class="literal">true</span>;</span><br><span class="line">             <span class="comment">// å·²ç»é‡Šæ”¾ï¼Œæ¸…ç©ºç‹¬å </span></span><br><span class="line">             setExclusiveOwnerThread(<span class="literal">null</span>); </span><br><span class="line">         }</span><br><span class="line">         <span class="comment">// è®¾ç½®æ ‡è¯†</span></span><br><span class="line">         setState(c); </span><br><span class="line">         <span class="keyword">return</span> free; </span><br><span class="line">     }</span><br><span class="line">     </span><br><span class="line">     <span class="comment">// åˆ¤æ–­èµ„æºæ˜¯å¦è¢«å½“å‰çº¿ç¨‹å æœ‰</span></span><br><span class="line">     <span class="keyword">protected</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">isHeldExclusively</span><span class="params">()</span> {</span><br><span class="line">         <span class="keyword">return</span> getExclusiveOwnerThread() == Thread.currentThread();</span><br><span class="line">     }</span><br><span class="line"> </span><br><span class="line">     <span class="comment">// æ–°ç”Ÿä¸€ä¸ªæ¡ä»¶</span></span><br><span class="line">     <span class="keyword">final</span> ConditionObject <span class="title function_">newCondition</span><span class="params">()</span> {</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConditionObject</span>();</span><br><span class="line">     }</span><br><span class="line"> </span><br><span class="line">     <span class="comment">// è¿”å›èµ„æºçš„å ç”¨çº¿ç¨‹</span></span><br><span class="line">     <span class="keyword">final</span> Thread <span class="title function_">getOwner</span><span class="params">()</span> {        </span><br><span class="line">         <span class="keyword">return</span> getState() == <span class="number">0</span> ? <span class="literal">null</span> : getExclusiveOwnerThread();</span><br><span class="line">     }</span><br><span class="line">     <span class="comment">// è¿”å›çŠ¶æ€</span></span><br><span class="line">     <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getHoldCount</span><span class="params">()</span> {            </span><br><span class="line">         <span class="keyword">return</span> isHeldExclusively() ? getState() : <span class="number">0</span>;</span><br><span class="line">     }</span><br><span class="line"> </span><br><span class="line">     <span class="comment">// èµ„æºæ˜¯å¦è¢«å ç”¨</span></span><br><span class="line">     <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">isLocked</span><span class="params">()</span> {        </span><br><span class="line">         <span class="keyword">return</span> getState() != <span class="number">0</span>;</span><br><span class="line">     }</span><br><span class="line"> </span><br><span class="line">     <span class="comment">// è‡ªå®šä¹‰ååºåˆ—åŒ–é€»è¾‘</span></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span><br><span class="line">         <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException {</span><br><span class="line">         s.defaultReadObject();</span><br><span class="line">         setState(<span class="number">0</span>); <span class="comment">// reset to unlocked state</span></span><br><span class="line">     }</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>

<p>ç‹¬äº«é”ã€æ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”ä¸¤ç§æ¨¡å¼ï¼Œå¯é‡å…¥é”ã€‚</p>
<p><img src="/p/5fd8877a/Lock-ReetrantLock%E9%94%81%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%90%86.png" alt="image-20210429135322710"></p>
<p>åˆå§‹æ—¶æŒæœ‰è€…ä¸ºnullï¼Œè®¡æ•°æ˜¯å½“å‰è°ƒç”¨lock()æ–¹æ³•åŠ é”çš„æ¬¡æ•°ï¼Œunlock()ä¼šå°†è®¡æ•°å‡1ï¼Œå½“è®¡æ•°ä¸º0æ—¶ï¼Œåˆ™è¡¨ç¤ºå½“å‰é”è¢«é‡Šæ”¾ã€‚ï¼ˆè·å–å½“å‰é”çš„æ¬¡æ•° getHoldCount()ï¼‰</p>
<p>å¯é‡å…¥é”çš„è¯ï¼Œåšäº†ä¸€æ¬¡åŠ é”å°±ä¸€å®šè¦æœ‰å¯¹åº”çš„ä¸€æ¬¡è§£é”ï¼Œå¦åˆ™äº§ç”Ÿæ­»é”ã€‚    </p>
<h2 id="ReadWriteLockï¼ˆæ³¨ï¼šä¸æ˜¯Locké”çš„å­ç±»ï¼‰"><a href="#ReadWriteLockï¼ˆæ³¨ï¼šä¸æ˜¯Locké”çš„å­ç±»ï¼‰" class="headerlink" title="ReadWriteLockï¼ˆæ³¨ï¼šä¸æ˜¯Locké”çš„å­ç±»ï¼‰"></a>ReadWriteLockï¼ˆæ³¨ï¼šä¸æ˜¯Locké”çš„å­ç±»ï¼‰</h2><p>ç»´æŠ¤ä¸€å¯¹å…³è”é”ï¼Œä¸€ä¸ªç”¨äºåªè¯»æ“ä½œï¼Œä¸€ä¸ªç”¨äºå†™å…¥;è¯»é”å¯ä»¥ç”±å¤šä¸ªè¯»çº¿ç¨‹åŒæ—¶æŒæœ‰ï¼Œå†™é”æ˜¯æ’ä»–çš„ã€‚</p>
<p>è¯»é”æ‹’ç»å…¶ä»–çº¿ç¨‹è·å¾—å†™é”ï¼Œè¯»é”ä¸æ‹’ç»å…¶ä»–çº¿ç¨‹è·å¾—è¯»é”ï¼Œå¤šä¸ªä¸Šäº†è¯»é”çš„çº¿ç¨‹å¯ä»¥å¹¶å‘è¯»ä¸ä¼šé˜»å¡ã€‚å¤šä¸ªè¯»é”åŒæ—¶ä½œç”¨æœŸé—´ï¼Œå…¶ä»–æƒ³ä¸Šå†™é”çš„çº¿ç¨‹éƒ½å¤„åœ¨ç­‰å¾…çŠ¶æ€ï¼Œå½“æœ€åä¸€ä¸ªè¯»é”é‡Šæ”¾åï¼Œæ‰æœ‰å¯èƒ½ä¸Šé”ã€‚</p>
<p>é€‚åˆè¯»å–çº¿ç¨‹æ¯”å†™å…¥çº¿ç¨‹å¤šçš„åœºæ™¯ï¼Œæ”¹è¿›äº’æ–¥é”çš„æ€§èƒ½ï¼Œç¤ºä¾‹åœºæ™¯:ç¼“å­˜ç»„ä»¶ã€é›†åˆçš„å¹¶å‘çº¿ç¨‹å®‰å…¨æ€§æ”¹é€ ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// è¯»å†™é”æ¡ˆä¾‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LockDemo2</span> {</span><br><span class="line">    <span class="type">ReadWriteLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">LockDemo2</span> <span class="variable">lockDemo2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LockDemo2</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) {</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; {</span><br><span class="line">                lockDemo2.read(Thread.currentThread());</span><br><span class="line">            }, <span class="string">"A"</span> + i).start();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; {</span><br><span class="line">            lockDemo2.write(Thread.currentThread());</span><br><span class="line">        }, <span class="string">"C"</span>).start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤šçº¿ç¨‹è¯»ï¼Œå…±äº«é”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">(Thread t)</span> {</span><br><span class="line">        lock.readLock().lock();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            <span class="keyword">while</span> (System.currentTimeMillis() - start &lt;= <span class="number">1</span>) {</span><br><span class="line">                System.out.println(t.getName() + <span class="string">"æ­£åœ¨ã€è¯»ã€‘æ“ä½œ"</span>);</span><br><span class="line">            }</span><br><span class="line">            System.out.println(t.getName() + <span class="string">"ã€è¯»ã€‘æ“ä½œå®Œæˆ"</span>);</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            lock.readLock().unlock();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç‹¬äº«é”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(Thread t)</span> {</span><br><span class="line">        lock.writeLock().lock();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            <span class="keyword">while</span> (System.currentTimeMillis() - start &lt;= <span class="number">1</span>) {</span><br><span class="line">                System.out.println(t.getName() + <span class="string">"æ­£åœ¨ã€å†™ã€‘æ“ä½œ"</span>);</span><br><span class="line">            }</span><br><span class="line">            System.out.println(t.getName() + <span class="string">"ã€å†™ã€‘æ“ä½œå®Œæˆ"</span>);</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            lock.writeLock().unlock();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="ReadWriteLocké”é™çº§"><a href="#ReadWriteLocké”é™çº§" class="headerlink" title="ReadWriteLocké”é™çº§"></a>ReadWriteLocké”é™çº§</h2><p>é”é™çº§æŒ‡çš„æ˜¯å†™é”é™çº§æˆä¸ºè¯»é”ã€‚æŠŠæŒä½å½“å‰æ‹¥æœ‰çš„å†™é”çš„åŒæ—¶ï¼Œå†è·å–åˆ°è¯»é”,éšåé‡Šæ”¾å†™é”çš„è¿‡ç¨‹ã€‚</p>
<p>å†™é”æ˜¯çº¿ç¨‹ç‹¬å ï¼Œè¯»é”æ˜¯å…±äº«ï¼Œæ‰€ä»¥å†™-&gt;è¯»æ˜¯å‡çº§ã€‚(è¯»~&gt;å†™, æ˜¯ä¸èƒ½å®ç°çš„)</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸€ä¸ªç¼“å­˜demoï¼Œè¯»å†™é”ä¾‹å­ï¼Œå®ç°è¯»å’Œå†™äº’æ–¥ã€å†™å’Œå†™äº’æ–¥ï¼Œä½†æœ‰å¯ä»¥å¤šä¸ªå¹¶å‘çš„è¯»ï¼Œå¯æé«˜ç³»ç»Ÿæ€§èƒ½</span></span><br><span class="line"><span class="comment"> * ReentrantReadWriteLockçš„åº”ç”¨åœºæ™¯ä¸­ï¼Œä½¿ç”¨å†™é”å¯èƒ½æ²¡æœ‰æ³¨æ„åˆ°ç¼“å­˜é—®é¢˜ï¼ˆå‡»ç©¿ã€é›ªå´©ã€ç©¿é€ï¼‰</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> DengJun 2021/4/29</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LockDemo3</span> {</span><br><span class="line">    <span class="comment">// æ•°æ®</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; cache = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// è¯»å†™é”</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">ReadWriteLock</span> <span class="variable">rwl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getData</span><span class="params">(String key)</span> {</span><br><span class="line">        <span class="comment">// ä¸Šè¯»é”ï¼Œå¤šä¸ªè¯»æ—¶å¯ä»¥å¹¶å‘ï¼Œä¸ä¼šé€ æˆå¯¹æ•°æ®çš„ç ´å</span></span><br><span class="line">        rwl.readLock().lock();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            value = cache.get(key);</span><br><span class="line">            <span class="comment">// å¦‚æœæ•°æ®ä¸ºç©º</span></span><br><span class="line">            <span class="keyword">if</span> (value == <span class="literal">null</span>) {</span><br><span class="line">                <span class="comment">// é‡Šæ”¾è¯»é”ä¸Šå†™é”ï¼Œä¸Šå†™é”åï¼Œæ•°æ®ä¸èƒ½è¢«è¯»</span></span><br><span class="line">                rwl.readLock().unlock();</span><br><span class="line">                rwl.writeLock().lock();</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    <span class="comment">// æ­¤å¤„åˆ¤æ–­æ˜¯ä¸ºé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›å…¥åˆ°è¿™é‡Œæ—¶ï¼Œå¤šä¸ªçº¿ç¨‹å¯¹æ•°æ®è¿›è¡Œé‡å¤å†™</span></span><br><span class="line">                    <span class="keyword">if</span> (value == <span class="literal">null</span>) {</span><br><span class="line">                        <span class="comment">// å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œåˆ™å»æŸ¥DBè·å–æ•°æ®</span></span><br><span class="line">                        value = <span class="string">"XXX"</span>;</span><br><span class="line">                    }</span><br><span class="line">                } <span class="keyword">finally</span> {</span><br><span class="line">                    <span class="comment">// è¯»å–æ•°æ®åé‡Šæ”¾å†™é”</span></span><br><span class="line">                    rwl.writeLock().unlock();</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">// è·å–å®Œæ•°æ®åï¼Œæ¢å¤è¯»é”ï¼Œé‡æ–°è¯»å–æ•°æ®</span></span><br><span class="line">                rwl.readLock().lock();</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            <span class="comment">// é‡æ–°è¯»å–æ•°æ®é‡Šæ”¾è¯»é”</span></span><br><span class="line">            value = cache.get(key);</span><br><span class="line">            rwl.readLock().unlock();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h2><p><img src="/p/5fd8877a/Lock-ReentrantLock-Condition%E5%8E%9F%E7%90%86.png" alt="image-20210429171248960"></p>
</body></html>]]></content>
      <tags>
        <tag>JUCå¹¶å‘åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>Semaphoreä¿¡å·é‡</title>
    <url>/p/f353d57c.html</url>
    <content><![CDATA[<html><head></head><body><p>åº”ç”¨åœºæ™¯ï¼šå¤šä¸ªå…±äº«èµ„æºäº’æ–¥ã€å¹¶å‘é™æµï¼ˆå¦‚Hystrixï¼‰ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯ä¿¡å·é‡ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ä¿¡å·é‡ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¿¡å·é‡ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ä¿¡å·é‡ï¼Ÿ</h2><p>ä¿¡å·é‡æ˜¯æ“ä½œç³»ç»Ÿä¸­ï¼Œå®ç°è¿›ç¨‹é—´èµ„æºçš„äº’æ–¥ä¸åŒæ­¥ã€‚ä¿¡å·é‡ç»´æŠ¤äº†ä¸€ç»„è®¸å¯è¯ï¼Œä»¥çº¦æŸè®¿é—®è¢«é™åˆ¶èµ„æºçš„çº¿ç¨‹æ•°ã€‚</p>
<h2 id="Javaä¸­çš„Semaphore"><a href="#Javaä¸­çš„Semaphore" class="headerlink" title="Javaä¸­çš„Semaphore"></a>Javaä¸­çš„Semaphore</h2><p>Javaå¹¶å‘åŒ…ä¸­çš„ Semaphore å¯ä»¥æ§åˆ¶æŸä¸ªèµ„æºè¢«åŒæ—¶è®¿é—®çš„ä»»åŠ¡æ•°ï¼Œå…¶ä¸»è¦æ–¹æ³•æœ‰ï¼š</p>
<ul>
<li>void acquire()ï¼šä»æ­¤ä¿¡å·é‡è·å–ä¸€ä¸ªè®¸å¯ï¼Œåœ¨æä¾›ä¸€ä¸ªè®¸å¯å‰ä¸€ç›´å°†çº¿ç¨‹é˜»å¡ï¼Œå¦åˆ™çº¿ç¨‹è¢«ä¸­æ–­ã€‚</li>
<li>void release()ï¼šé‡Šæ”¾ä¸€ä¸ªè®¸å¯ï¼Œå°†å…¶è¿”å›ç»™ä¿¡å·é‡ã€‚</li>
<li>int availablePermits()ï¼šè¿”å›æ­¤ä¿¡å·é‡ä¸­å½“å‰å¯ç”¨çš„è®¸å¯æ•°ã€‚</li>
<li>boolean hasQueuedThreads()ï¼šæŸ¥è¯¢æ˜¯å¦æœ‰çº¿ç¨‹æ­£åœ¨ç­‰å¾…è·å–ã€‚</li>
</ul>
<p>å¦‚æœè¢«åŒæ—¶è®¿é—®çš„ä»»åŠ¡æ•°å·²æ»¡ï¼Œåˆ™å…¶ä»–acquireçš„ä»»åŠ¡è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªä»»åŠ¡è¢«releaseæ‰ï¼Œå®ƒæ‰èƒ½å¾—åˆ°è®¸å¯ã€‚</p>
<h3 id="åº”ç”¨ç¤ºä¾‹"><a href="#åº”ç”¨ç¤ºä¾‹" class="headerlink" title="åº”ç”¨ç¤ºä¾‹"></a>åº”ç”¨ç¤ºä¾‹</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSemaphore</span><span class="params">()</span> {</span><br><span class="line">    <span class="comment">// å…è®¸é‡ä¸º3ï¼Œå‡è®¾ä¸º3ä¸ªåœè½¦ä½</span></span><br><span class="line">    <span class="type">Semaphore</span> <span class="variable">semaphore</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) {</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                semaphore.acquire();</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"æŠ¢åˆ°è½¦ä½"</span>);</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"ç¦»å¼€è½¦ä½"</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                semaphore.release();</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">        }, <span class="string">""</span> + i).start();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿è¡Œç»“æœ</p>
<figure class="highlight tex"><table><tbody><tr><td class="code"><pre><span class="line">0æŠ¢åˆ°è½¦ä½</span><br><span class="line">1æŠ¢åˆ°è½¦ä½</span><br><span class="line">2æŠ¢åˆ°è½¦ä½</span><br><span class="line">1ç¦»å¼€è½¦ä½</span><br><span class="line">2ç¦»å¼€è½¦ä½</span><br><span class="line">0ç¦»å¼€è½¦ä½</span><br><span class="line">4æŠ¢åˆ°è½¦ä½</span><br><span class="line">3æŠ¢åˆ°è½¦ä½</span><br><span class="line">5æŠ¢åˆ°è½¦ä½</span><br><span class="line">3ç¦»å¼€è½¦ä½</span><br><span class="line">5ç¦»å¼€è½¦ä½</span><br><span class="line">4ç¦»å¼€è½¦ä½</span><br></pre></td></tr></tbody></table></figure>

<p>Semaphroeåº•å±‚ä¹Ÿæ˜¯ç”¨Syncç±»ï¼Œé»˜è®¤æ˜¯éå…¬å¹³çš„ï¼Œä¹Ÿæœ‰å…¬å¹³çš„æ„é€ æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">Semaphore</span><span class="params">(<span class="type">int</span> permits, <span class="type">boolean</span> fair)</span> {</span><br><span class="line">    sync = fair ? <span class="keyword">new</span> <span class="title class_">FairSync</span>(permits) : <span class="keyword">new</span> <span class="title class_">NonfairSync</span>(permits);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å®šä¹‰çš„è®¸å¯æ•°ï¼Œå®é™…æ˜¯è®¾ç½®é”çš„çŠ¶æ€å€¼çš„</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Sync</span> <span class="keyword">extends</span> <span class="title class_">AbstractQueuedSynchronizer</span> {</span><br><span class="line">    Sync(<span class="type">int</span> permits) {</span><br><span class="line">        setState(permits);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="ä¸ºä»€ä¹ˆSemaphoreèƒ½é™åˆ¶åŒæ—¶æ‰§è¡Œçš„çº¿ç¨‹æ•°ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆSemaphoreèƒ½é™åˆ¶åŒæ—¶æ‰§è¡Œçš„çº¿ç¨‹æ•°ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆSemaphoreèƒ½é™åˆ¶åŒæ—¶æ‰§è¡Œçš„çº¿ç¨‹æ•°ï¼Ÿ"></a>ä¸ºä»€ä¹ˆSemaphoreèƒ½é™åˆ¶åŒæ—¶æ‰§è¡Œçš„çº¿ç¨‹æ•°ï¼Ÿ</h3><p>è¿™å°±æ˜¯<code>acquire()</code>çš„ç”¨å¤„äº†</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">acquire</span><span class="params">(<span class="type">int</span> permits)</span> { </span><br><span class="line">	sync.acquireSharedInterruptibly(permits);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç‚¹è¿›Semaphoreä¸­çš„å†…éƒ¨ç±»Syncçš„ <code>acquireSharedInterruptibly</code>è¿™ä¸ªæ–¹æ³•</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">acquireSharedInterruptibly</span><span class="params">(<span class="type">int</span> arg)</span></span><br><span class="line">    <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">    <span class="keyword">if</span> (Thread.interrupted())</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InterruptedException</span>();</span><br><span class="line">    <span class="comment">// å°è¯•è·å–é”ï¼Œè¿”å›å€¼å°äº0å°±æ˜¯è·å–é”å¤±è´¥</span></span><br><span class="line">    <span class="comment">// ä¿¡å·é‡æ˜¯éç‹¬å èµ„æºï¼Œä½¿ç”¨å…±äº«é”æ¥è·å–ä¿¡å·é‡</span></span><br><span class="line">    <span class="keyword">if</span> (tryAcquireShared(arg) &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// å¦‚æœè·å–å¤±è´¥ï¼Œåˆ™è¿›å…¥é˜Ÿåˆ—è¿›è¡Œç­‰å¾…ï¼Œä¹‹å‰å·²ç»è§£æè¿‡</span></span><br><span class="line">        doAcquireSharedInterruptibly(arg);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨<code>doAcquireSharedInterruptibly</code> æ–¹æ³•ä¸­ä¼šæ­»å¾ªç¯éå†é˜Ÿåˆ—ä¸­ç­‰å¾…çš„çº¿ç¨‹ï¼Œä¸æ–­çš„è°ƒç”¨ <code>tryAcquireShared</code> æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doAcquireSharedInterruptibly</span><span class="params">(<span class="type">int</span> arg)</span></span><br><span class="line">    <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> addWaiter(Node.SHARED);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">failed</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">for</span> (;;) {</span><br><span class="line">            <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> node.predecessor();</span><br><span class="line">            <span class="keyword">if</span> (p == head) {</span><br><span class="line">                <span class="comment">// è½®åˆ°çš„çº¿ç¨‹è°ƒç”¨è¯¥æ–¹æ³•è·å–å½“å‰çš„è®¸å¯æ•°</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> tryAcquireShared(arg);</span><br><span class="line">                <span class="keyword">if</span> (r &gt;= <span class="number">0</span>) {</span><br><span class="line">                    setHeadAndPropagate(node, r);</span><br><span class="line">                    p.next = <span class="literal">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                    failed = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">                parkAndCheckInterrupt())</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InterruptedException</span>();</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        <span class="keyword">if</span> (failed)</span><br><span class="line">            cancelAcquire(node);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>tryAcquireShared</code> æ–¹æ³•æœ‰<code>NonfairSync</code> å’Œ <code>FairSync</code> ä¸¤ä¸ªç±»çš„å®ç°ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//----------------------- NonfairSync -------------------------//</span></span><br><span class="line"><span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">tryAcquireShared</span><span class="params">(<span class="type">int</span> acquires)</span> {</span><br><span class="line">    <span class="comment">// è·å–åˆ°æ—¶é—´ç‰‡çš„çº¿ç¨‹ï¼Œåªè¦æœ‰è®¸å¯å°±ç›´æ¥åˆ†é…</span></span><br><span class="line">    <span class="keyword">return</span> nonfairTryAcquireShared(acquires);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">final</span> <span class="type">int</span> <span class="title function_">nonfairTryAcquireShared</span><span class="params">(<span class="type">int</span> acquires)</span> {</span><br><span class="line">    <span class="keyword">for</span> (;;) {</span><br><span class="line">        <span class="comment">// è·å–å½“å‰é”çŠ¶æ€ï¼Œé”çŠ¶æ€å€¼ä¸€å¼€å§‹æ˜¯è‡ªå®šä¹‰çš„</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">available</span> <span class="operator">=</span> getState();</span><br><span class="line">        <span class="comment">// å½“å‰ç”³è¯·åå‰©ä½™çš„é”çŠ¶æ€å€¼</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">remaining</span> <span class="operator">=</span> available - acquires;</span><br><span class="line">        <span class="keyword">if</span> (remaining &lt; <span class="number">0</span> ||</span><br><span class="line">            <span class="comment">// CASæ›¿æ¢é”çŠ¶æ€å€¼</span></span><br><span class="line">            compareAndSetState(available, remaining))</span><br><span class="line">            <span class="keyword">return</span> remaining;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//----------------------- FairSync -------------------------//</span></span><br><span class="line"><span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">tryAcquireShared</span><span class="params">(<span class="type">int</span> acquires)</span> {</span><br><span class="line">    <span class="keyword">for</span> (;;) {</span><br><span class="line">        <span class="comment">// åˆ¤æ–­å½“å‰çº¿ç¨‹åœ¨é˜Ÿåˆ—ä¸­çš„ä½ç½®ï¼Œæ˜¯å¦è½®åˆ°è¯¥çº¿ç¨‹äº†</span></span><br><span class="line">        <span class="keyword">if</span> (hasQueuedPredecessors())</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">available</span> <span class="operator">=</span> getState();</span><br><span class="line">        <span class="type">int</span> <span class="variable">remaining</span> <span class="operator">=</span> available - acquires;</span><br><span class="line">        <span class="keyword">if</span> (remaining &lt; <span class="number">0</span> ||</span><br><span class="line">            compareAndSetState(available, remaining))</span><br><span class="line">            <span class="keyword">return</span> remaining;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Semaphoreé‡Šæ”¾é”"><a href="#Semaphoreé‡Šæ”¾é”" class="headerlink" title="Semaphoreé‡Šæ”¾é”"></a>Semaphoreé‡Šæ”¾é”</h3><p>çº¿ç¨‹è·å–æ‰§è¡Œèµ„æ ¼ä¹‹åéœ€è¦é‡Šæ”¾é”ï¼Œå½“å‰çº¿ç¨‹ä¸é‡Šæ”¾é”çš„è¯ï¼Œä¼šå¯¼è‡´å…¶å®ƒçº¿ç¨‹æ— æ³•è¿›å…¥è·å–è®¸å¯ã€‚é‡Šæ”¾é”è°ƒç”¨çš„æ˜¯AQSä¸­çš„relaseæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">release</span><span class="params">(<span class="type">int</span> permits)</span> {</span><br><span class="line">    <span class="keyword">if</span> (permits &lt; <span class="number">0</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">    sync.releaseShared(permits);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">releaseShared</span><span class="params">(<span class="type">int</span> arg)</span> {</span><br><span class="line">    <span class="keyword">if</span> (tryReleaseShared(arg)) {</span><br><span class="line">        doReleaseShared();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">tryReleaseShared</span><span class="params">(<span class="type">int</span> releases)</span> {</span><br><span class="line">    <span class="keyword">for</span> (;;) {</span><br><span class="line">        <span class="comment">// è·å–é”å½“å‰çŠ¶æ€</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">current</span> <span class="operator">=</span> getState();</span><br><span class="line">        <span class="comment">// é‡Šæ”¾é”å‰å…ˆæ¢å¤è®¸å¯æ•°</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">next</span> <span class="operator">=</span> current + releases;</span><br><span class="line">        <span class="keyword">if</span> (next &lt; current) <span class="comment">// overflow</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">"Maximum permit count exceeded"</span>);</span><br><span class="line">        <span class="comment">// ç”¨CASæ›´æ–°é”çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">if</span> (compareAndSetState(current, next))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</body></html>]]></content>
      <tags>
        <tag>JUCå¹¶å‘åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>å››ç§å•ä¾‹æ¨¡å¼</title>
    <url>/p/e38626a3.html</url>
    <content><![CDATA[<html><head></head><body><p>å…¶å®åœ¨å­¦Spring5æºç çš„æ—¶å€™ï¼Œå°±å·²ç»ç½—åˆ—äº†å„ç§å•ä¾‹æ¨¡å¼ã€‚åœ¨æ­¤ï¼Œå­¦ä¹ è¿‡ java.util.concurrent åŒ…åï¼Œç«™åœ¨å¤šçº¿ç¨‹çš„è§’åº¦ä¸Šåˆ†ææ¯”è¾ƒç»å…¸çš„æ‡’æ±‰æ¨¡å¼çš„åŒé‡é”æ ¡éªŒï¼ˆåˆç§°ä¸ºDCLæ‡’æ±‰å¼ï¼ˆDouble Check Lockï¼‰ï¼‰ã€‚</p>
<h2 id="é€æ­¥è¿›é˜¶ï¼ŒåŸºç¡€ç‰ˆæœ¬"><a href="#é€æ­¥è¿›é˜¶ï¼ŒåŸºç¡€ç‰ˆæœ¬" class="headerlink" title="é€æ­¥è¿›é˜¶ï¼ŒåŸºç¡€ç‰ˆæœ¬"></a>é€æ­¥è¿›é˜¶ï¼ŒåŸºç¡€ç‰ˆæœ¬</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> LazySingleton singleton4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> LazySingleton <span class="title function_">lazy</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">if</span> (singleton4 == <span class="literal">null</span>) {</span><br><span class="line">        singleton4 = <span class="keyword">new</span> <span class="title class_">LazySingleton</span>();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> singleton4;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å­˜åœ¨é—®é¢˜åˆ†æï¼šå¤šçº¿ç¨‹è¿›è¡Œè®¿é—®æ—¶ï¼Œå¯èƒ½å¤šä¸ªçº¿ç¨‹ä¼šåŒæ—¶è¿›å…¥if çš„ä½œç”¨åŸŸä¸­ï¼Œé‚£ä¹ˆå°±ä¼šåˆ›å»ºå¤šä¸ª LazySingleton() å¯¹è±¡ï¼Œå¯¼è‡´è¿™äº›çº¿ç¨‹è¿”å›çš„å¯¹è±¡åœ°å€ä¸ä¸€è‡´ã€‚</p>
<h2 id="æ™®é€šåŠ é”ç‰ˆæœ¬"><a href="#æ™®é€šåŠ é”ç‰ˆæœ¬" class="headerlink" title="æ™®é€šåŠ é”ç‰ˆæœ¬"></a>æ™®é€šåŠ é”ç‰ˆæœ¬</h2><p>ç›´æ¥æ–¹æ³•åŠ é”ï¼Œç¡®å®èƒ½å¤Ÿè§£å†³é—®é¢˜ï¼Œä½†æ˜¯æ€§èƒ½ååˆ†ä½ä¸‹ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> LazySingleton singleton4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> LazySingleton <span class="title function_">lazy</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">if</span> (singleton4 == <span class="literal">null</span>) {</span><br><span class="line">        singleton4 = <span class="keyword">new</span> <span class="title class_">LazySingleton</span>();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> singleton4;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="åŒé‡æ ¡éªŒåŠ é”ç‰ˆæœ¬"><a href="#åŒé‡æ ¡éªŒåŠ é”ç‰ˆæœ¬" class="headerlink" title="åŒé‡æ ¡éªŒåŠ é”ç‰ˆæœ¬"></a>åŒé‡æ ¡éªŒåŠ é”ç‰ˆæœ¬</h2><p>â€‹        å¤šçº¿ç¨‹éƒ½å¯ä»¥è¿›å…¥æ–¹æ³•å’Œç¬¬ä¸€ä¸ª if çš„ä½œç”¨åŸŸï¼Œé”ç±»çš„ç›®çš„æ˜¯ä¿è¯åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥å½“å‰ç±»åè¿›å…¥ç¬¬äºŒä¸ªifä½œç”¨åŸŸåˆ›å»ºå®ä¾‹å¯¹è±¡ï¼Œéšåè§£é”ï¼Œè®©å…¶å®ƒè¿›å…¥ç¬¬ä¸€ä¸ªifä½œç”¨åŸŸçš„é˜»å¡çº¿ç¨‹åœ¨åˆ¤æ–­ä¸€æ¬¡æ˜¯å¦ä¸ºç©ºã€‚<br>â€‹        è™½ç„¶æ€§èƒ½æ˜¯æå‡äº†ï¼Œä½†æ˜¯çœŸçš„çº¿ç¨‹å®‰å…¨å—ï¼Ÿå¹¶å‘ä¸‹çš„æŒ‡ä»¤é‡æ’æ˜¯ä¼šå‡ºé—®é¢˜çš„ï¼Œåˆ†æï¼š singleton4 = new LazySingleton() ä¸æ˜¯åŸå­æ€§æ“ä½œï¼Œæœ‰ä¸‰ä¸ªæ­¥éª¤ï¼š â‘ åˆ†é…å†…å­˜ç©ºé—´ â‘¡æ‰§è¡Œæ„é€ æ–¹æ³•å¹¶å®ä¾‹åŒ–å¯¹è±¡ â‘¢ åˆ†é…å†…å­˜åœ°å€ï¼ŒæŠŠè¿™ä¸ªå¯¹è±¡æŒ‡å‘è¿™ä¸ªç©ºé—´ã€‚CPUæ‰§è¡Œæ—¶ä¸ä¸€å®šæ˜¯æŒ‰ç…§123æ‰§è¡Œçš„ï¼Œå¦‚æœæŒ‰ç…§æ‰§è¡Œé¡ºåºæ˜¯132ï¼Œç¬¬3æ­¥å…ˆæ‰§è¡Œçš„è¯ï¼Œè¿˜æ²¡æœ‰å®Œæˆå®ä¾‹åŒ–ï¼Œå°±æŒ‡å‘è¿™ä¸ªç©ºé—´äº†ï¼Œæ­¤æ—¶çš„ singleton4 ä¸ä¸ºç©ºï¼Œä¸‹ä¸€ä¸ªçº¿ç¨‹è¿›å…¥æ–¹æ³•çš„ç¬¬ä¸€ä¸ªifåˆ¤æ–­èµ°falseï¼Œç›´æ¥è¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œæ­¤æ—¶çš„è¿™ä¸ª singleton4 å¹¶æ²¡æœ‰å®Œæˆå®ä¾‹åŒ–ï¼æ‰€ä»¥å°±ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p>
<p>â€‹    volatile æœ‰ä¸‰å¤§ç‰¹æ€§ï¼š1ã€å¯è§æ€§ï¼›2ã€ç¦æ­¢æŒ‡ä»¤é‡æ’ï¼›3ã€ä¸ä¿è¯åŸå­æ€§ã€‚æ‰€ä»¥ä½¿ç”¨volatile å…³é”®å­—ä¿®é¥°å³å¯ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> LazySingleton singleton4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> LazySingleton <span class="title function_">lazy2</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">    <span class="keyword">if</span> (singleton4 == <span class="literal">null</span>) {</span><br><span class="line">        <span class="keyword">synchronized</span> (LazySingleton.class) {</span><br><span class="line">            <span class="keyword">if</span> (singleton4 == <span class="literal">null</span>) {</span><br><span class="line">                singleton4 = <span class="keyword">new</span> <span class="title class_">LazySingleton</span>();</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> singleton4;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> singleton4;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="å•ä¾‹æ¨¡å¼è¢«ç ´åçš„æƒ…å†µ"><a href="#å•ä¾‹æ¨¡å¼è¢«ç ´åçš„æƒ…å†µ" class="headerlink" title="å•ä¾‹æ¨¡å¼è¢«ç ´åçš„æƒ…å†µ"></a>å•ä¾‹æ¨¡å¼è¢«ç ´åçš„æƒ…å†µ</h2><p>ç ´åå•ä¾‹æ¨¡å¼çš„æ„æ€å°±æ˜¯ï¼šä¸€ä¸ªå•ä¾‹å¯¹è±¡å­˜åœ¨å¤šä¸ªã€‚</p>
<p>åå°„ã€åºåˆ—åŒ–ã€å…‹éš†éƒ½ä¼šç ´åå•ä¾‹æ¨¡å¼ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼šæšä¸¾å•ä¾‹æ¨¡å¼ã€å®¹å™¨å¼å•ä¾‹æ¨¡å¼ï¼ˆConcurrentHashMapï¼‰ã€çº¿ç¨‹éš”ç¦»å¼å•ä¾‹æ¨¡å¼ï¼ˆThreadLocalï¼‰</p>
<p>å°è¯•ç ´åæšä¸¾å•ä¾‹æ¨¡å¼ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">enum</span> <span class="title class_">Lazy4</span> {</span><br><span class="line">    INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Lazy4 <span class="title function_">getInstance</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">Lazy4</span> <span class="variable">instance1</span> <span class="operator">=</span> Lazy4.INSTANCE;</span><br><span class="line">        Constructor&lt;Lazy4&gt; declaredConstructor = Lazy4.class.getDeclaredConstructor(String.class, <span class="type">int</span>.class);</span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Lazy4</span> <span class="variable">instance2</span> <span class="operator">=</span> declaredConstructor.newInstance(); </span><br><span class="line">        System.out.println(instance1); System.out.println(instance2);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

</body></html>]]></content>
      <tags>
        <tag>JUCå¹¶å‘åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>Synchronized VS Lock</title>
    <url>/p/ace4e0d0.html</url>
    <content><![CDATA[<html><head></head><body><p><a href="https://mrdjun.gitee.io/p/8360cd4.html">synchronized æ–‡ç« é˜…è¯»åœ°å€</a></p>
<p><a href="https://mrdjun.gitee.io/p/5fd8877a.html">ReetrantLock &amp; ReadWriteLock æ–‡ç« é˜…è¯»åœ°å€</a></p>
<table>
<thead>
<tr>
<th>ä¸åŒç‚¹</th>
<th>synchronized</th>
<th>lock</th>
</tr>
</thead>
<tbody><tr>
<td>å®ç°æ–¹å¼</td>
<td>åŸºäºJVMå¯¹è±¡ç›‘è§†å™¨</td>
<td>å®ç°äº†AQSæ¥å£ï¼Œé€šè¿‡JDKçš„ API æ‰§è¡Œåº•å±‚çš„æ“ä½œç³»ç»ŸæŒ‡ä»¤</td>
</tr>
<tr>
<td>é«˜çº§ç‰¹æ€§</td>
<td>å¯é‡å…¥ã€éå…¬å¹³</td>
<td>å¯é‡å…¥ã€å¯ä¸­æ–­ã€å¯é€‰æ‹©ï¼ˆéï¼‰å…¬å¹³ã€å¯é€‰æ‹©æ€§é€šçŸ¥çº¿ç¨‹</td>
</tr>
<tr>
<td>æ€§èƒ½æ–¹é¢</td>
<td>jdk1.6å‰æ€§èƒ½è¾ƒå·®</td>
<td>jdk1.5å¼•å…¥ï¼Œå°†åŒæ­¥Synchronizedæ›¿æ¢æˆæ˜¾å¼Lockæ“ä½œ</td>
</tr>
</tbody></table>
<ul>
<li><p>Lockï¼šç”¨äºæ›¿ä»£ synchronized</p>
<pre><code>lock 
unlock
newCondition()
</code></pre>
</li>
<li><p>Conditionï¼šç”¨äºæ›¿ä»£ Object wait notify notifyAll</p>
<pre><code>await();
signal();
signalAll();
</code></pre>
</li>
</ul>
<p>åœ¨JDK1.6åï¼Œsynchronizedçš„å¼•å…¥äº†åå‘é”ã€è‡ªé€‚åº”åå‘é”ç­‰æ‰‹æ®µä½¿å¾—æ€§èƒ½ä¸Locké”ç›¸åª²ç¾ï¼Œç”šè‡³JDKå®˜æ–¹éƒ½å»ºè®®ä½¿ç”¨synchronizedé”ã€‚</p>
<blockquote>
<p>ä¸¤è€…çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ</p>
</blockquote>
<p>èƒ½ç”¨synchronizedå°±ç”¨synchronizedï¼Œåœ¨éœ€è¦ç”¨åˆ°Locké”çš„é«˜çº§ç‰¹æ€§ï¼Œå¦‚å¯ä¸­æ–­ã€æŒ‡å®šçº¿ç¨‹é€šçŸ¥ã€å…¬å¹³é”æ—¶å°±é€‰æ‹©Locké”ä½¿ç”¨ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>JUCå¹¶å‘åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>Synchronized</title>
    <url>/p/8360cd4.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="synchronizedçš„ä½œç”¨"><a href="#synchronizedçš„ä½œç”¨" class="headerlink" title="synchronizedçš„ä½œç”¨"></a>synchronizedçš„ä½œç”¨</h2><p>synchronizedï¼ˆæ‚²è§‚é”åˆå«ç‹¬äº«é”ï¼‰ ç”¨äºä¿éšœåŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§ã€‚</p>
<ol>
<li>åŸå­æ€§ï¼šç¡®ä¿çº¿ç¨‹äº’æ–¥çš„è®¿é—®åŒæ­¥ä»£ç ï¼›</li>
<li>å¯è§æ€§ï¼šä¿è¯å…±äº«å˜é‡çš„ä¿®æ”¹èƒ½å¤ŸåŠæ—¶å¯è§ï¼Œå…¶å®æ˜¯é€šè¿‡Javaå†…å­˜æ¨¡å‹ä¸­çš„ â€œ<strong>å¯¹ä¸€ä¸ªå˜é‡unlockæ“ä½œä¹‹å‰ï¼Œå¿…é¡»è¦åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ï¼›å¦‚æœå¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œlockæ“ä½œï¼Œåˆ™å°†ä¼šæ¸…ç©ºå·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼ï¼Œåœ¨æ‰§è¡Œå¼•æ“ä½¿ç”¨æ­¤å˜é‡å‰ï¼Œéœ€è¦é‡æ–°ä»ä¸»å†…å­˜ä¸­loadæ“ä½œæˆ–assignæ“ä½œåˆå§‹åŒ–å˜é‡å€¼</strong>â€ æ¥ä¿è¯çš„ï¼›</li>
<li>æœ‰åºæ€§ï¼šæœ‰æ•ˆè§£å†³é‡æ’åºé—®é¢˜ï¼Œå³ â€œä¸€ä¸ªunlockæ“ä½œå…ˆè¡Œå‘ç”Ÿ(happen-before)äºåé¢å¯¹åŒä¸€ä¸ªé”çš„lockæ“ä½œâ€ï¼›</li>
</ol>
<p>ä»è¯­æ³•ä¸Šè®²ï¼ŒSynchronizedå¯ä»¥æŠŠä»»ä½•ä¸€ä¸ªénullå¯¹è±¡ä½œä¸ºâ€é”â€ï¼Œåœ¨HotSpot JVMå®ç°ä¸­ï¼Œé”æœ‰ä¸ªä¸“é—¨çš„åå­—ï¼š<strong>å¯¹è±¡ç›‘è§†å™¨ï¼ˆObject Monitorï¼‰</strong>ã€‚Javaä¸­æ¯ä¸ªå¯¹è±¡éƒ½ä¸ä¸€ä¸ªç›‘è§†å™¨ç›¸å…³è”ï¼Œä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¯¹ç›‘è§†å™¨è¿›è¡ŒåŠ é”æˆ–è§£é”ï¼Œè¯•å›¾é”å®šè¯¥ç›‘è§†å™¨çš„å…¶å®ƒçº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å®ƒä»¬å¯ä»¥è·å¾—è¯¥ç›‘è§†å™¨ä¸Šçš„é”å®šä¸ºæ­¢ã€‚ä»€ä¹ˆæ˜¯å¯¹è±¡ç›‘è§†å™¨ï¼Ÿ</p>
<h2 id="ç›‘è§†å™¨ï¼ˆMonitorï¼‰"><a href="#ç›‘è§†å™¨ï¼ˆMonitorï¼‰" class="headerlink" title="ç›‘è§†å™¨ï¼ˆMonitorï¼‰"></a>ç›‘è§†å™¨ï¼ˆMonitorï¼‰</h2><p>å¤§å­¦æœ‰ä¸€é—¨è¯¾å«æ“ä½œç³»ç»Ÿï¼Œå­¦è¿‡çš„åŒå­¦åº”è¯¥éƒ½è®°å¾—ï¼Œç›‘è§†å™¨ï¼ˆMonitorï¼‰æ˜¯æ“ä½œç³»ç»Ÿå®ç°åŒæ­¥çš„é‡è¦åŸºç¡€æ¦‚å¿µã€‚ç›‘è§†å™¨å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªåªæœ‰ä¸€ä¸ªæœåŠ¡å°çš„é“¶è¡Œé—¨åº—ï¼Œä¸€æ¬¡åªèƒ½æœåŠ¡ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚å½“æœ‰äººæ­£åœ¨æœåŠ¡å°æ—¶ï¼Œå…¶ä»–äººå¿…é¡»åœ¨å¤§å…ç­‰å¾…ã€‚æœåŠ¡å°ç©ºé—²æ—¶ï¼Œä¿å®‰ä¼šä»å¤§å…é€‰æ‹©ä¸‹ä¸€ä¸ªæ¶ˆè´¹è€…å»æœåŠ¡å°ï¼Œå¦‚æœè¢«é€‰ä¸­çš„æ¶ˆè´¹è€…æ­£åœ¨é—¨å£æ¥ç”µè¯ï¼Œé‚£ä¹ˆä¿å®‰ä¼šåœ¨ä»–æ‰“å®Œç”µè¯ä¹‹åè¢«é‡æ–°é€‰æ‹©å»æœåŠ¡å°åŠç†ä¸šåŠ¡ã€‚</p>
<p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼ŒæœåŠ¡å°çœ‹åšæ˜¯æ•°æ®å’Œä»£ç ï¼Œä¿å®‰çœ‹åšæ˜¯ç›‘è§†å™¨ã€‚ç›‘è§†å™¨ç›‘è§†çº¿ç¨‹è®¿é—®æ•°æ®ï¼Œç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®æ•°æ®å’Œä»£ç ã€‚</p>
<p>åœ¨Javaçš„è®¾è®¡ä¸­ï¼Œ<strong>æ¯ä¸€ä¸ªJavaå¯¹è±¡è‡ªæ‰“å¨˜èƒé‡Œå‡ºæ¥å°±å¸¦äº†ä¸€æŠŠçœ‹ä¸è§çš„é”ï¼Œå®ƒå«åšç›‘è§†å™¨é”ï¼ˆmonitorï¼‰</strong>ã€‚å¯¹è±¡ç›‘è§†å™¨å®é™…ä¸Šå°±æ˜¯ä¸æ¯ä¸ªå¯¹è±¡å…³è”çš„Monitorå¯¹è±¡ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­ç”±å¯¹è±¡å¤´ã€å®ä¾‹æ•°æ®ã€å¯¹é½å¡«å……ä¸‰å—åŒºåŸŸç»„æˆï¼Œå¯¹è±¡å¤´åŒ…å«Mark Wordã€Klass pointã€Monitorã€‚</p>
<ul>
<li>Mark Worldï¼šå­˜å‚¨å¯¹è±¡çš„HashCodeã€åˆ†ä»£å¹´é¾„ã€é”çš„æ ‡å¿—ä½ä¿¡æ¯ã€‚</li>
<li>Klass pointï¼šå¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šæ­¤å¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚</li>
<li>Monitorï¼šMonitorä¸­æœ‰Ownerå’Œè®¡æ•°å™¨ï¼ŒOwneræŒ‡å‘æŒæœ‰ Monitor çš„çº¿ç¨‹ï¼Œè®¡æ•°å™¨ä» 0 å¼€å§‹è®°å½•è¿›å…¥æ•°ï¼›å¦å¤–è¿˜æœ‰ EntryListã€WaitSet ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œç”¨æ¥å­˜æ”¾è¿›å…¥åŠç­‰å¾…è·å–é”çš„çº¿ç¨‹ã€‚</li>
</ul>
<p>synchronized ç›¸å…³çš„å­—èŠ‚ç æŒ‡ä»¤ï¼šACC_SYNCHRONIZED ä¿®é¥°æ–¹æ³•ã€monitorenter+monitorexit ä¿®é¥°ä»£ç å—ã€‚</p>
<p><img src="/p/8360cd4/image-20201105143058691.png" alt="image-20201105143058691"></p>
<p>è¿›å…¥ synchronized åŒæ­¥å—æ—¶ï¼Œæ‰§è¡Œ monitorenter æŒ‡ä»¤ï¼Œå°è¯•è·å–å½“å‰å¯¹è±¡ Monitor çš„é”ã€‚å¯¹è±¡ç›‘è§†å™¨æ˜¯å¯¹è±¡é”ï¼Œé”çš„æ˜¯å¯¹è±¡è€Œéå¼•ç”¨å˜é‡ï¼Œä½œç”¨ç²’åº¦æ˜¯å¯¹è±¡ ï¼Œå¯ä»¥ç”¨æ¥å®ç°å¯¹ä¸´ç•Œèµ„æºçš„åŒæ­¥äº’æ–¥ï¼ˆMutexï¼‰è®¿é—®ã€‚</p>
<p>åœ¨Javaè™šæ‹Ÿæœºï¼ˆHotSpotï¼‰ä¸­ï¼ŒMonitoræ˜¯ç”±ObjectMonitorå®ç°çš„ï¼Œå…¶ä¸»è¦æ•°æ®ç»“æ„å¦‚ä¸‹ï¼ˆä½äºHotSpotè™šæ‹Ÿæœºæºç ObjectMonitor.hppæ–‡ä»¶ï¼ŒC++å®ç°çš„ï¼‰ï¼š</p>
<figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">ObjectMonitor</span>() {</span><br><span class="line">    _header       = <span class="literal">NULL</span>;</span><br><span class="line">    _count        = <span class="number">0</span>; <span class="comment">// è®°å½•ä¸ªæ•°</span></span><br><span class="line">    _waiters      = <span class="number">0</span>,</span><br><span class="line">    _recursions   = <span class="number">0</span>;</span><br><span class="line">    _object       = <span class="literal">NULL</span>;</span><br><span class="line">    _owner        = <span class="literal">NULL</span>;</span><br><span class="line">    _WaitSet      = <span class="literal">NULL</span>; <span class="comment">// å¤„äºwaitçŠ¶æ€çš„çº¿ç¨‹ï¼Œä¼šè¢«åŠ å…¥åˆ°_WaitSet</span></span><br><span class="line">    _WaitSetLock  = <span class="number">0</span> ;</span><br><span class="line">    _Responsible  = <span class="literal">NULL</span> ;</span><br><span class="line">    _succ         = <span class="literal">NULL</span> ;</span><br><span class="line">    _cxq          = <span class="literal">NULL</span> ;</span><br><span class="line">    FreeNext      = <span class="literal">NULL</span> ;</span><br><span class="line">    _EntryList    = <span class="literal">NULL</span> ; <span class="comment">// å¤„äºç­‰å¾…é”blockçŠ¶æ€çš„çº¿ç¨‹ï¼Œä¼šè¢«åŠ å…¥åˆ°è¯¥åˆ—è¡¨</span></span><br><span class="line">    _SpinFreq     = <span class="number">0</span> ;</span><br><span class="line">    _SpinClock    = <span class="number">0</span> ;</span><br><span class="line">    OwnerIsThread = <span class="number">0</span> ;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ObjectMonitorä¸­æœ‰ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œ_WaitSet å’Œ _EntryListï¼Œç”¨æ¥ä¿å­˜ObjectWaiterå¯¹è±¡åˆ—è¡¨ï¼ˆ æ¯ä¸ªç­‰å¾…é”çš„çº¿ç¨‹éƒ½ä¼šè¢«å°è£…æˆObjectWaiterå¯¹è±¡ ï¼‰ï¼Œ_owneræŒ‡å‘æŒæœ‰ObjectMonitorå¯¹è±¡çš„çº¿ç¨‹ï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€æ®µåŒæ­¥ä»£ç æ—¶ï¼š</p>
<blockquote>
<ol>
<li>å…ˆä¼šè¿›å…¥ _EntryList é›†åˆï¼Œå½“çº¿ç¨‹è·å–åˆ°å¯¹è±¡çš„monitoråï¼Œè¿›å…¥ _OwneråŒºåŸŸå¹¶æŠŠmonitorä¸­çš„ownerå˜é‡è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹ï¼ŒåŒæ—¶monitorä¸­çš„è®¡æ•°å™¨countåŠ 1ï¼›</li>
<li>è‹¥çº¿ç¨‹è°ƒç”¨ wait() æ–¹æ³•ï¼Œå°†é‡Šæ”¾å½“å‰æŒæœ‰çš„monitorï¼Œownerå˜é‡æ¢å¤ä¸ºnullï¼Œcountè‡ªå‡1ï¼ŒåŒæ—¶è¯¥çº¿ç¨‹è¿›å…¥ WaitSeté›†åˆä¸­ç­‰å¾…è¢«å”¤é†’ï¼›</li>
<li>è‹¥å½“å‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œä¹Ÿå°†é‡Šæ”¾monitorï¼ˆé”ï¼‰å¹¶å¤ä½countçš„å€¼ï¼Œä»¥ä¾¿å…¶ä»–çº¿ç¨‹è¿›å…¥è·å–monitor(é”)ï¼›</li>
</ol>
</blockquote>
<p>åŒæ—¶<strong>ï¼ŒMonitorå¯¹è±¡å­˜åœ¨äºæ¯ä¸ªJavaå¯¹è±¡çš„å¯¹è±¡å¤´Mark Wordä¸­ï¼ˆå­˜å‚¨çš„æŒ‡é’ˆçš„æŒ‡å‘ï¼‰ï¼ŒSynchronizedé”ä¾¿æ˜¯é€šè¿‡è¿™ç§æ–¹å¼è·å–é”çš„ï¼Œä¹Ÿæ˜¯ä¸ºä»€ä¹ˆJavaä¸­ä»»æ„å¯¹è±¡å¯ä»¥ä½œä¸ºé”çš„åŸå› ï¼ŒåŒæ—¶notify/notifyAll/waitç­‰æ–¹æ³•ä¼šä½¿ç”¨åˆ°Monitoré”å¯¹è±¡ï¼Œæ‰€ä»¥å¿…é¡»åœ¨åŒæ­¥ä»£ç å—ä¸­ä½¿ç”¨ã€‚</strong></p>
<p>ç›‘è§†å™¨Monitoræœ‰ä¸¤ç§åŒæ­¥æ–¹å¼ï¼šäº’æ–¥ä¸åä½œã€‚å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çº¿ç¨‹ä¹‹é—´å¦‚æœéœ€è¦å…±äº«æ•°æ®ï¼Œéœ€è¦è§£å†³äº’æ–¥è®¿é—®æ•°æ®çš„é—®é¢˜ï¼Œç›‘è§†å™¨å¯ä»¥ç¡®ä¿ç›‘è§†å™¨ä¸Šçš„æ•°æ®åœ¨åŒä¸€æ—¶åˆ»åªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®ã€‚</p>
<p>ä»€ä¹ˆæ—¶å€™éœ€è¦åä½œï¼Ÿ æ¯”å¦‚ï¼š</p>
<blockquote>
<p>ä¸€ä¸ªçº¿ç¨‹å‘ç¼“å†²åŒºå†™æ•°æ®ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä»ç¼“å†²åŒºè¯»æ•°æ®ï¼Œå¦‚æœè¯»çº¿ç¨‹å‘ç°ç¼“å†²åŒºä¸ºç©ºå°±ä¼šç­‰å¾…ï¼Œå½“å†™çº¿ç¨‹å‘ç¼“å†²åŒºå†™å…¥æ•°æ®ï¼Œå°±ä¼šå”¤é†’è¯»çº¿ç¨‹ï¼Œè¿™é‡Œè¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹å°±æ˜¯ä¸€ä¸ªåˆä½œå…³ç³»ã€‚JVMé€šè¿‡Objectç±»çš„waitæ–¹æ³•æ¥ä½¿è‡ªå·±ç­‰å¾…ï¼Œåœ¨è°ƒç”¨waitæ–¹æ³•åï¼Œè¯¥çº¿ç¨‹ä¼šé‡Šæ”¾å®ƒæŒæœ‰çš„ç›‘è§†å™¨ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹é€šçŸ¥å®ƒæ‰æœ‰æ‰§è¡Œçš„æœºä¼šã€‚ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨notifyæ–¹æ³•é€šçŸ¥åœ¨ç­‰å¾…çš„çº¿ç¨‹ï¼Œè¿™ä¸ªç­‰å¾…çš„çº¿ç¨‹å¹¶ä¸ä¼šé©¬ä¸Šæ‰§è¡Œï¼Œè€Œæ˜¯è¦é€šçŸ¥çº¿ç¨‹é‡Šæ”¾ç›‘è§†å™¨åï¼Œå®ƒé‡æ–°è·å–ç›‘è§†å™¨æ‰æœ‰æ‰§è¡Œçš„æœºä¼šã€‚å¦‚æœåˆšå¥½å”¤é†’çš„è¿™ä¸ªçº¿ç¨‹éœ€è¦çš„ç›‘è§†å™¨è¢«å…¶ä»–çº¿ç¨‹æŠ¢å ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹ä¼šç»§ç»­ç­‰å¾…ã€‚Objectç±»ä¸­çš„notifyAllæ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå¯ä»¥å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œæ€»æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚</p>
</blockquote>
<p><img src="/p/8360cd4/2062729-d1cc81ebcf0e912b.png" alt="img"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸€ä¸ªçº¿ç¨‹é€šè¿‡1å·é—¨è¿›å…¥Entry Set(å…¥å£åŒº)ï¼Œå¦‚æœåœ¨å…¥å£åŒºæ²¡æœ‰çº¿ç¨‹ç­‰å¾…ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±ä¼šè·å–ç›‘è§†å™¨æˆä¸ºç›‘è§†å™¨çš„Ownerï¼Œç„¶åæ‰§è¡Œç›‘è§†åŒºåŸŸçš„ä»£ç ã€‚å¦‚æœåœ¨å…¥å£åŒºä¸­æœ‰å…¶å®ƒçº¿ç¨‹åœ¨ç­‰å¾…ï¼Œé‚£ä¹ˆæ–°æ¥çš„çº¿ç¨‹ä¹Ÿä¼šå’Œè¿™äº›çº¿ç¨‹ä¸€èµ·ç­‰å¾…ã€‚çº¿ç¨‹åœ¨æŒæœ‰ç›‘è§†å™¨çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œä¸€ä¸ªæ˜¯æ­£å¸¸æ‰§è¡Œç›‘è§†å™¨åŒºåŸŸçš„ä»£ç ï¼Œé‡Šæ”¾ç›‘è§†å™¨ï¼Œé€šè¿‡5å·é—¨é€€å‡ºç›‘è§†å™¨ï¼›è¿˜æœ‰å¯èƒ½ç­‰å¾…æŸä¸ªæ¡ä»¶çš„å‡ºç°ï¼Œäºæ˜¯å®ƒä¼šé€šè¿‡3å·é—¨åˆ°Wait Setï¼ˆç­‰å¾…åŒºï¼‰ä¼‘æ¯ï¼Œç›´åˆ°ç›¸åº”çš„æ¡ä»¶æ»¡è¶³åå†é€šè¿‡4å·é—¨è¿›å…¥é‡æ–°è·å–ç›‘è§†å™¨å†æ‰§è¡Œã€‚</p>
<p>æ³¨æ„ï¼š</p>
<blockquote>
<p>å½“ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾ç›‘è§†å™¨æ—¶ï¼Œåœ¨å…¥å£åŒºå’Œç­‰å¾…åŒºçš„ç­‰å¾…çº¿ç¨‹éƒ½ä¼šå»ç«äº‰ç›‘è§†å™¨ï¼Œå¦‚æœå…¥å£åŒºçš„çº¿ç¨‹èµ¢äº†ï¼Œä¼šä»2å·é—¨è¿›å…¥ï¼›å¦‚æœç­‰å¾…åŒºçš„çº¿ç¨‹èµ¢äº†ä¼šä»4å·é—¨è¿›å…¥ã€‚åªæœ‰é€šè¿‡3å·é—¨æ‰èƒ½è¿›å…¥ç­‰å¾…åŒºï¼Œåœ¨ç­‰å¾…åŒºä¸­çš„çº¿ç¨‹åªæœ‰é€šè¿‡4å·é—¨æ‰èƒ½é€€å‡ºç­‰å¾…åŒºï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªçº¿ç¨‹åªæœ‰åœ¨æŒæœ‰ç›‘è§†å™¨æ—¶æ‰èƒ½æ‰§è¡Œwaitæ“ä½œï¼Œå¤„äºç­‰å¾…çš„çº¿ç¨‹åªæœ‰å†æ¬¡è·å¾—ç›‘è§†å™¨æ‰èƒ½é€€å‡ºç­‰å¾…çŠ¶æ€ã€‚</p>
</blockquote>
<h2 id="synchronizedçš„åŸºæœ¬ä½¿ç”¨"><a href="#synchronizedçš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="synchronizedçš„åŸºæœ¬ä½¿ç”¨"></a>synchronizedçš„åŸºæœ¬ä½¿ç”¨</h2><p>æ€»å…±å°±ä¸‰ç§ç”¨æ³•ï¼šä¿®é¥°ä»£ç å—ã€ä¿®é¥°å®ä¾‹æ–¹æ³•ã€ä¿®é¥°é™æ€æ–¹æ³•ã€‚</p>
<ol>
<li>ä¿®é¥°ä»£ç å—æ—¶ï¼Œç›‘è§†å™¨é”æ˜¯æ‹¬å·ä¸­çš„é‚£ä¸ªå¯¹è±¡ã€‚</li>
<li>ä¿®é¥°å®ä¾‹æ–¹æ³•æ—¶ï¼Œç›‘è§†å™¨é”æ˜¯å¯¹è±¡å®ä¾‹ï¼ˆthisï¼‰</li>
<li>ä¿®é¥°é™æ€æ–¹æ³•æ—¶ï¼Œç›‘è§†å™¨é”æ˜¯å¯¹è±¡çš„Classå®ä¾‹ï¼Œå› ä¸ºClassæ•°æ®å­˜åœ¨äºæ°¸ä¹…ä»£ï¼Œå› æ­¤é™æ€æ–¹æ³•é”ç›¸å½“äºè¯¥ç±»çš„ä¸€ä¸ªå…¨å±€é”ï¼›</li>
</ol>
<h2 id="åŒæ­¥åŸç†"><a href="#åŒæ­¥åŸç†" class="headerlink" title="åŒæ­¥åŸç†"></a>åŒæ­¥åŸç†</h2><p>synchronizedåœ¨è½¯ä»¶å±‚é¢ä¾èµ–JVMï¼Œè€Œ j.u.c.Lock åœ¨ç¡¬ä»¶å±‚é¢ä¾èµ–ç‰¹æ®Šçš„CPUæŒ‡ä»¤ã€‚</p>
<h2 id="ä¿®é¥°ä»£ç å—çš„åŸç†"><a href="#ä¿®é¥°ä»£ç å—çš„åŸç†" class="headerlink" title="ä¿®é¥°ä»£ç å—çš„åŸç†"></a>ä¿®é¥°ä»£ç å—çš„åŸç†</h2><p>å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—æ—¶ï¼Œé¦–å…ˆæ˜¯éœ€è¦å¾—åˆ°é”æ‰èƒ½æ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œå½“é€€å‡ºæˆ–è€…æŠ›å‡ºå¼‚å¸¸æ—¶å¿…é¡»è¦é‡Šæ”¾é”ï¼Œé‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•æ¥å®ç°è¿™ä¸ªæœºåˆ¶çš„å‘¢ï¼Ÿæˆ‘ä»¬å…ˆçœ‹ä¸€æ®µç®€å•çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronizedDemo</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) {</span><br><span class="line">            System.out.println(<span class="string">"Method 1 start"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åˆ©ç”¨jclasslibæ’ä»¶æŸ¥çœ‹ç¼–è¯‘åçš„å­—èŠ‚ç </p>
<p><img src="/p/8360cd4/image-20220312160414720.png" alt="image-20220312160414720"></p>
<h4 id="monitorenter"><a href="#monitorenter" class="headerlink" title="monitorenter"></a>monitorenter</h4><p>æ¯ä¸ªå¯¹è±¡éƒ½æ˜¯ä¸€ä¸ªç›‘è§†å™¨é”ï¼ˆmonitorï¼‰ã€‚å½“monitorè¢«å ç”¨æ—¶å°±ä¼šå¤„äºé”å®šçŠ¶æ€ï¼Œçº¿ç¨‹æ‰§è¡ŒmonitorenteræŒ‡ä»¤æ—¶å°è¯•è·å–monitorçš„æ‰€æœ‰æƒï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¦‚æœmonitorçš„è¿›å…¥æ•°ä¸º0ï¼Œåˆ™è¯¥çº¿ç¨‹è¿›å…¥monitorï¼Œç„¶åå°†è¿›å…¥æ•°è®¾ç½®ä¸º1ï¼Œè¯¥çº¿ç¨‹å³ä¸ºmonitorçš„æ‰€æœ‰è€…ï¼›</li>
<li>å¦‚æœçº¿ç¨‹å·²ç»å æœ‰è¯¥monitorï¼Œåªæ˜¯å†æ¬¡è¿›å…¥ï¼Œåˆ™è¿›å…¥monitorçš„è¿›å…¥æ•° +1ï¼›</li>
<li>å¦‚æœå…¶ä»–çº¿ç¨‹å·²ç»å ç”¨äº†monitorï¼Œåˆ™è¯¥çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°monitorçš„è¿›å…¥æ•°ä¸º0ï¼Œå†é‡æ–°å°è¯•è·å–monitorçš„æ‰€æœ‰æƒï¼›</li>
</ul>
<h4 id="monitorexit"><a href="#monitorexit" class="headerlink" title="monitorexit"></a>monitorexit</h4><p>æ‰§è¡Œmonitorexitçš„çº¿ç¨‹å¿…é¡»æ˜¯objectrefæ‰€å¯¹åº”çš„monitorçš„æ‰€æœ‰è€…ã€‚æŒ‡ä»¤æ‰§è¡Œæ—¶ï¼Œmonitorçš„è¿›å…¥æ•°å‡1ï¼Œå¦‚æœå‡1åè¿›å…¥æ•°ä¸º0ï¼Œé‚£çº¿ç¨‹é€€å‡ºmonitorï¼Œä¸å†æ˜¯è¿™ä¸ªmonitorçš„æ‰€æœ‰è€…ã€‚å…¶ä»–è¢«è¿™ä¸ªmonitoré˜»å¡çš„çº¿ç¨‹å¯ä»¥å°è¯•å»è·å–è¿™ä¸ª monitor çš„æ‰€æœ‰æƒã€‚</p>
<p>æ³¨æ„è§‚å¯Ÿå›¾ä¸Šå‡ºç°äº†ä¸¤æ¬¡monitorexitï¼Œç¬¬1æ¬¡æ˜¯åŒæ­¥æ­£å¸¸é€€å‡ºé‡Šæ”¾é”ï¼Œç¬¬2æ¬¡æ˜¯å‘ç”Ÿå¼‚æ­¥é€€å‡ºé‡Šæ”¾é”ï¼›</p>
<h3 id="ä¿®é¥°å®ä¾‹æ–¹æ³•çš„åŸç†"><a href="#ä¿®é¥°å®ä¾‹æ–¹æ³•çš„åŸç†" class="headerlink" title="ä¿®é¥°å®ä¾‹æ–¹æ³•çš„åŸç†"></a>ä¿®é¥°å®ä¾‹æ–¹æ³•çš„åŸç†</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> {</span><br><span class="line">    System.out.println(<span class="string">"javer"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>é€šè¿‡<code>javap -v</code> å‘½ä»¤æŸ¥çœ‹å­—èŠ‚ç ä¸­çš„é™„åŠ ä¿¡æ¯ã€‚</p>
<p><img src="/p/8360cd4/image-20220312161514457.png" alt="image-20220312161514457"></p>
<p>æ–¹æ³•çš„åŒæ­¥å¹¶æ²¡æœ‰é€šè¿‡æŒ‡ä»¤ <code>monitorenter</code> å’Œ <code>monitorexit</code> æ¥å®Œæˆï¼ˆç†è®ºä¸Šå…¶å®ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸¤æ¡æŒ‡ä»¤æ¥å®ç°ï¼‰ï¼Œä¸è¿‡ç›¸å¯¹äºæ™®é€šæ–¹æ³•ï¼Œå…¶å¸¸é‡æ± ä¸­å¤šäº† <code>ACC_SYNCHRONIZED</code> æ ‡ç¤ºç¬¦ã€‚JVMå°±æ˜¯æ ¹æ®è¯¥æ ‡ç¤ºç¬¦æ¥å®ç°æ–¹æ³•çš„åŒæ­¥çš„ï¼š</p>
<blockquote>
<p>å½“æ–¹æ³•è°ƒç”¨æ—¶ï¼Œè°ƒç”¨æŒ‡ä»¤å°†ä¼šæ£€æŸ¥æ–¹æ³•çš„ ACC_SYNCHRONIZED è®¿é—®æ ‡å¿—æ˜¯å¦è¢«è®¾ç½®ï¼Œå¦‚æœè®¾ç½®äº†ï¼Œæ‰§è¡Œçº¿ç¨‹å°†å…ˆè·å–monitorï¼Œè·å–æˆåŠŸä¹‹åæ‰èƒ½æ‰§è¡Œæ–¹æ³•ä½“ï¼Œæ–¹æ³•æ‰§è¡Œå®Œåå†é‡Šæ”¾monitorã€‚<strong>åœ¨æ–¹æ³•æ‰§è¡ŒæœŸé—´ï¼Œå…¶ä»–ä»»ä½•çº¿ç¨‹éƒ½æ— æ³•å†è·å¾—åŒä¸€ä¸ªmonitorå¯¹è±¡ã€‚</strong></p>
</blockquote>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¸¤ç§åŒæ­¥æ–¹å¼æœ¬è´¨ä¸Šæ²¡æœ‰åŒºåˆ«ï¼Œåªæ˜¯æ–¹æ³•çš„åŒæ­¥æ˜¯ä¸€ç§éšå¼çš„æ–¹å¼æ¥å®ç°ï¼Œæ— éœ€é€šè¿‡å­—èŠ‚ç æ¥å®Œæˆã€‚ä¸¤ä¸ªæŒ‡ä»¤çš„æ‰§è¡Œæ˜¯JVMé€šè¿‡è°ƒç”¨æ“ä½œç³»ç»Ÿçš„äº’æ–¥åŸè¯­mutexæ¥å®ç°ï¼Œè¢«é˜»å¡çš„çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ã€ç­‰å¾…é‡æ–°è°ƒåº¦ï¼Œä¼šå¯¼è‡´â€œç”¨æˆ·æ€å’Œå†…æ ¸æ€â€ä¸¤ä¸ªæ€ä¹‹é—´æ¥å›åˆ‡æ¢ï¼Œå¯¹æ€§èƒ½æœ‰è¾ƒå¤§å½±å“ã€‚</p>
<p>Synchronizedçš„è¯­ä¹‰åº•å±‚æ˜¯é€šè¿‡ä¸€ä¸ªmonitorçš„å¯¹è±¡æ¥å®Œæˆï¼Œå…¶å®wait/notifyç­‰æ–¹æ³•ä¹Ÿä¾èµ–äºmonitorå¯¹è±¡ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåªæœ‰åœ¨åŒæ­¥çš„å—æˆ–è€…æ–¹æ³•ä¸­æ‰èƒ½è°ƒç”¨wait/notifyç­‰æ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ›å‡º<code>java.lang.IllegalMonitorStateException</code>çš„å¼‚å¸¸çš„åŸå› ã€‚</p>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>åœ¨Java ä¸­ï¼Œåªæœ‰å°†å¯¹è±¡ä½œä¸ºé”è¿™ç§è¯´æ³•ï¼Œæ²¡æœ‰é”æ–¹æ³•è¿™ç§è¯´æ³•ã€‚</li>
<li>åœ¨Javaä¸­ï¼Œé”å°±æ˜¯å¯¹è±¡ï¼Œå¯¹è±¡å¯ä»¥æ˜ å°„æˆé”ï¼Œå“ªä¸ªçº¿ç¨‹æ‹¿åˆ°è¿™æŠŠé”ï¼Œå“ªä¸ªçº¿ç¨‹å°±å¯ä»¥æ‰§è¡Œè¿™ä¸ªå¯¹è±¡ä¸­çš„ synchronized åŒæ­¥æ–¹æ³•ã€‚</li>
<li>å¦‚æœåœ¨æŸå¯¹è±¡ä¸­ä½¿ç”¨äº† synchronized å…³é”®å­—å£°æ˜éé™æ€æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±è¢«å½“æˆé”ã€‚</li>
</ul>
<blockquote>
<p>è¿™é‡Œå­˜åœ¨ä¸€ä¸ªè¯¯åŒºï¼šsynchronizedä¿®é¥°æ–¹æ³•æ—¶ï¼Œå¦‚æœè¯¥æ–¹æ³•æ²¡æœ‰staticå…³é”®å­—ä¸æ˜¯é™æ€æ–¹æ³•ï¼Œåˆ™é”çš„åªæ˜¯è¿™ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ–°åˆ›å»ºä¸€ä¸ªè¿™ä¸ªç±»çš„å¯¹è±¡ï¼Œä¸¤ä¸ªçº¿ç¨‹æ“ä½œä¸æ˜¯åŒä¸€æŠŠé”æ˜¯ä¸ä¼šäº§ç”Ÿç«æ€æ¡ä»¶çš„ã€‚å¦‚æœè¯¥æ–¹æ³•ä¸Šä½¿ç”¨äº†é™æ€å…³é”®å­—ï¼Œåˆ™å½“å‰é”é”çš„æ˜¯è¿™ä¸ªå¯¹è±¡çš„ç±»ï¼Œä½¿ç”¨è¯¥ç±»é‡æ–°åˆ›å»ºå¯¹è±¡å¤šä¸ªçº¿ç¨‹çš„æ“ä½œè¯¥å¯¹è±¡éƒ½ä¼šäº§ç”Ÿé™æ€æ¡ä»¶ã€‚</p>
</blockquote>
<h2 id="åŒæ­¥æ¦‚å¿µ"><a href="#åŒæ­¥æ¦‚å¿µ" class="headerlink" title="åŒæ­¥æ¦‚å¿µ"></a>åŒæ­¥æ¦‚å¿µ</h2><h3 id="Javaå¯¹è±¡çš„ç»“æ„ç»„æˆ"><a href="#Javaå¯¹è±¡çš„ç»“æ„ç»„æˆ" class="headerlink" title="Javaå¯¹è±¡çš„ç»“æ„ç»„æˆ"></a>Javaå¯¹è±¡çš„ç»“æ„ç»„æˆ</h3><p>åœ¨JVMä¸­ï¼Œ<strong>å¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€åˆ†ä¸ºä¸‰å—åŒºåŸŸï¼šå¯¹è±¡å¤´ã€å®ä¾‹æ•°æ®å’Œå¯¹é½å¡«å……ã€‚</strong>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/p/8360cd4/2062729-9a78f7ea7671a031.png" alt="img"></p>
<ol>
<li>å®ä¾‹æ•°æ®ï¼šå­˜æ”¾ç±»çš„å±æ€§æ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬çˆ¶ç±»çš„å±æ€§ä¿¡æ¯ï¼›</li>
<li>å¯¹é½å¡«å……ï¼šå¡«å……æ•°æ®ä¸æ˜¯å¿…é¡»å­˜åœ¨çš„ï¼Œä»…ä»…æ˜¯ä¸ºäº†å­—èŠ‚å¯¹é½ï¼Œç”±äºè™šæ‹Ÿæœºè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ã€‚</li>
<li>å¯¹è±¡å¤´ï¼š<strong>Javaå¯¹è±¡å¤´ä¸€èˆ¬å æœ‰2ä¸ªæœºå™¨ç ï¼ˆåœ¨32ä½è™šæ‹Ÿæœºä¸­ï¼Œ1ä¸ªæœºå™¨ç ç­‰äº4å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯32bitï¼Œåœ¨64ä½è™šæ‹Ÿæœºä¸­ï¼Œ1ä¸ªæœºå™¨ç æ˜¯8ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯64bitï¼‰ï¼Œä½†æ˜¯å¦‚æœå¯¹è±¡æ˜¯æ•°ç»„ç±»å‹ï¼Œåˆ™éœ€è¦3ä¸ªæœºå™¨ç ï¼Œå› ä¸ºJVMè™šæ‹Ÿæœºå¯ä»¥é€šè¿‡Javaå¯¹è±¡çš„å…ƒæ•°æ®ä¿¡æ¯ç¡®å®šJavaå¯¹è±¡çš„å¤§å°ï¼Œä½†æ˜¯æ— æ³•ä»æ•°ç»„çš„å…ƒæ•°æ®æ¥ç¡®è®¤æ•°ç»„çš„å¤§å°ï¼Œæ‰€ä»¥ç”¨ä¸€å—æ¥è®°å½•æ•°ç»„é•¿åº¦ã€‚</strong></li>
</ol>
<h3 id="Javaå¯¹è±¡å¤´çš„ç»“æ„ç»„æˆ"><a href="#Javaå¯¹è±¡å¤´çš„ç»“æ„ç»„æˆ" class="headerlink" title="Javaå¯¹è±¡å¤´çš„ç»“æ„ç»„æˆ"></a>Javaå¯¹è±¡å¤´çš„ç»“æ„ç»„æˆ</h3><p><a href="https://openjdk.java.net/groups/hotspot/docs/HotSpotGlossary.html">åŸæ–‡é“¾æ¥</a></p>
<p>Mark Worldï¼šå­˜å‚¨å¯¹è±¡çš„hashCodeã€é”ä¿¡æ¯ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹ IDã€åå‘æ—¶é—´æˆ³ç­‰ã€‚</p>
<p>Class Metadata Addressï¼šå­˜å‚¨åˆ°å¯¹è±¡ç±»å‹æ•°æ®çš„æŒ‡é’ˆã€‚</p>
<p>Array Lengthï¼šæ•°ç»„çš„é•¿åº¦ï¼ˆå¦‚æœå½“å‰å¯¹è±¡æ˜¯æ•°ç»„ï¼‰ã€‚</p>
<p>ä¸‹å›¾æ˜¯Javaå¯¹è±¡å¤´ æ— é”çŠ¶æ€ä¸‹Mark Wordéƒ¨åˆ†çš„å­˜å‚¨ç»“æ„ï¼ˆ32ä½è™šæ‹Ÿæœºï¼‰ï¼š</p>
<p><img src="/p/8360cd4/2062729-063a9a5dc677cd12.png" alt="img"></p>
<p>å¯¹è±¡å¤´ä¿¡æ¯æ˜¯ä¸å¯¹è±¡è‡ªèº«å®šä¹‰çš„æ•°æ®æ— å…³çš„é¢å¤–å­˜å‚¨æˆæœ¬ï¼Œä½†æ˜¯è€ƒè™‘åˆ°è™šæ‹Ÿæœºçš„ç©ºé—´æ•ˆç‡ï¼ŒMark Word è¢«è®¾è®¡æˆä¸€ä¸ªéå›ºå®šçš„æ•°æ®ç»“æ„ä»¥ä¾¿åœ¨æå°çš„ç©ºé—´å†…å­˜å­˜å‚¨å°½é‡å¤šçš„æ•°æ®ï¼Œå®ƒä¼šæ ¹æ®å¯¹è±¡çš„çŠ¶æ€å¤ç”¨è‡ªå·±çš„å­˜å‚¨ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒMark Wordä¼šéšç€ç¨‹åºçš„è¿è¡Œå‘ç”Ÿå˜åŒ–ï¼Œå¯èƒ½å˜åŒ–ä¸ºå­˜å‚¨ä»¥ä¸‹4ç§æ•°æ®ï¼š</p>
<p><img src="/p/8360cd4/2062729-c63ff6c2d337ad5f.png" alt="img"></p>
<p>Mark Wordå¯èƒ½å­˜å‚¨4ç§æ•°æ®ã€‚åœ¨64ä½è™šæ‹Ÿæœºä¸‹ï¼ŒMark Wordæ˜¯64bitå¤§å°çš„ï¼Œå…¶å­˜å‚¨ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="/p/8360cd4/2062729-5f6d3993ba018942.png" alt="img"></p>
<p>64ä½Mark Wordå­˜å‚¨ç»“æ„ã€‚å¯¹è±¡å¤´çš„æœ€åä¸¤ä½å­˜å‚¨äº†é”çš„æ ‡å¿—ä½ï¼Œ01æ˜¯åˆå§‹çŠ¶æ€ï¼ŒæœªåŠ é”ï¼Œå…¶å¯¹è±¡å¤´é‡Œå­˜å‚¨çš„æ˜¯å¯¹è±¡æœ¬èº«çš„å“ˆå¸Œç ï¼Œéšç€é”çº§åˆ«çš„ä¸åŒï¼Œå¯¹è±¡å¤´é‡Œä¼šå­˜å‚¨ä¸åŒçš„å†…å®¹ã€‚åå‘é”å­˜å‚¨çš„æ˜¯å½“å‰å ç”¨æ­¤å¯¹è±¡çš„çº¿ç¨‹IDï¼›è€Œè½»é‡çº§åˆ™å­˜å‚¨æŒ‡å‘çº¿ç¨‹æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆã€‚ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œâ€œé”â€è¿™ä¸ªä¸œè¥¿ï¼Œå¯èƒ½æ˜¯ä¸ªé”è®°å½•+å¯¹è±¡å¤´é‡Œçš„å¼•ç”¨æŒ‡é’ˆï¼ˆåˆ¤æ–­çº¿ç¨‹æ˜¯å¦æ‹¥æœ‰é”æ—¶å°†çº¿ç¨‹çš„é”è®°å½•åœ°å€å’Œå¯¹è±¡å¤´é‡Œçš„æŒ‡é’ˆåœ°å€æ¯”è¾ƒ)ï¼Œä¹Ÿå¯èƒ½æ˜¯å¯¹è±¡å¤´é‡Œçš„çº¿ç¨‹IDï¼ˆåˆ¤æ–­çº¿ç¨‹æ˜¯å¦æ‹¥æœ‰é”æ—¶å°†çº¿ç¨‹çš„IDå’Œå¯¹è±¡å¤´é‡Œå­˜å‚¨çš„çº¿ç¨‹IDæ¯”è¾ƒï¼‰ã€‚ </p>
<p><img src="/p/8360cd4/2062729-36035cd1936bd2c6.png" alt="img"></p>
<h2 id="å¯¹è±¡å¤´ä¸­Mark-Wordä¸çº¿ç¨‹ä¸­Lock-Record"><a href="#å¯¹è±¡å¤´ä¸­Mark-Wordä¸çº¿ç¨‹ä¸­Lock-Record" class="headerlink" title="å¯¹è±¡å¤´ä¸­Mark Wordä¸çº¿ç¨‹ä¸­Lock Record"></a>å¯¹è±¡å¤´ä¸­Mark Wordä¸çº¿ç¨‹ä¸­Lock Record</h2><p>Lock Record ï¼šç”¨äºè½»é‡çº§é”ä¼˜åŒ–ï¼Œåœ¨çº¿ç¨‹è¿›å…¥åŒæ­¥ä»£ç å—çš„æ—¶å€™ï¼Œå¦‚æœæ­¤åŒæ­¥å¯¹è±¡æ²¡æœ‰è¢«é”å®šï¼Œå³å®ƒçš„é”æ ‡å¿—ä½æ˜¯01ï¼Œåˆ™è™šæ‹Ÿæœºé¦–å…ˆåœ¨å½“å‰çº¿ç¨‹çš„æ ˆä¸­åˆ›å»º Lock Record çš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡çš„Mark Wordçš„æ‹·è´ï¼Œå®˜æ–¹æŠŠè¿™ä¸ªæ‹·è´ç§°ä¸ºDisplaced Mark Wordã€‚åœ¨æ‹·è´å®Œæˆåï¼Œé¦–å…ˆä¼šæŒ‚èµ·æŒæœ‰åå‘é”çš„çº¿ç¨‹ï¼Œå› ä¸ºè¦è¿›è¡Œå°è¯•ä¿®æ”¹é”è®°å½•æŒ‡é’ˆï¼ŒMarkWordä¼šæœ‰å˜åŒ–ï¼Œæ‰€æœ‰çº¿ç¨‹ä¼šåˆ©ç”¨CASå°è¯•å°†MarkWordçš„é”è®°å½•æŒ‡é’ˆæ”¹ä¸ºæŒ‡å‘è‡ªå·±(çº¿ç¨‹)çš„é”è®°å½•ï¼Œç„¶å lock recordçš„owneræŒ‡å‘å¯¹è±¡çš„markwordï¼Œä¿®æ”¹æˆåŠŸçš„çº¿ç¨‹å°†è·å¾—è½»é‡çº§é”ã€‚å¤±è´¥åˆ™çº¿ç¨‹å‡çº§ä¸ºé‡é‡çº§é”ã€‚é‡Šæ”¾æ—¶ä¼šæ£€æŸ¥markwordä¸­çš„lockrecordæŒ‡é’ˆæ˜¯å¦æŒ‡å‘è‡ªå·±(è·å¾—é”çš„çº¿ç¨‹lockrecord)ï¼Œä½¿ç”¨åŸå­çš„CASå°†Displaced Mark Wordæ›¿æ¢å›å¯¹è±¡å¤´ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰ç«äº‰å‘ç”Ÿï¼Œå¦‚æœæ›¿æ¢å¤±è´¥åˆ™å‡çº§ä¸ºé‡é‡çº§é”ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼ŒLockRecordæ˜¯ä¸€ä¸ªçº¿ç¨‹å†…ç‹¬äº«çš„å­˜å‚¨ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå¯ç”¨<code>Monitor Record</code>åˆ—è¡¨ã€‚</p>
<p>æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">CASE</span>(_monitorenter): {</span><br><span class="line">    oop lockee = <span class="built_in">STACK_OBJECT</span>(<span class="number">-1</span>);</span><br><span class="line">    <span class="comment">// derefing's lockee ought to provoke implicit null check</span></span><br><span class="line">    <span class="built_in">CHECK_NULL</span>(lockee);</span><br><span class="line">    <span class="comment">// find a free monitor or one already allocated for this object</span></span><br><span class="line">    <span class="comment">// if we find a matching object then we need a new monitor</span></span><br><span class="line">    <span class="comment">// since this is recursive enter</span></span><br><span class="line">    BasicObjectLock* limit = istate-&gt;<span class="built_in">monitor_base</span>();</span><br><span class="line">    BasicObjectLock* most_recent = (BasicObjectLock*) istate-&gt;<span class="built_in">stack_base</span>();</span><br><span class="line">    BasicObjectLock* entry = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">while</span> (most_recent != limit ) {</span><br><span class="line">        <span class="keyword">if</span> (most_recent-&gt;<span class="built_in">obj</span>() == <span class="literal">NULL</span>) entry = most_recent;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (most_recent-&gt;<span class="built_in">obj</span>() == lockee) <span class="keyword">break</span>;</span><br><span class="line">        most_recent++;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (entry != <span class="literal">NULL</span>) {</span><br><span class="line">        entry-&gt;<span class="built_in">set_obj</span>(lockee);</span><br><span class="line">        <span class="type">int</span> success = <span class="literal">false</span>;</span><br><span class="line">        <span class="type">uintptr_t</span> epoch_mask_in_place = (<span class="type">uintptr_t</span>)markOopDesc::epoch_mask_in_place;</span><br><span class="line"></span><br><span class="line">        markOop mark = lockee-&gt;<span class="built_in">mark</span>();</span><br><span class="line">        <span class="type">intptr_t</span> hash = (<span class="type">intptr_t</span>) markOopDesc::no_hash;</span><br><span class="line">        <span class="comment">// implies UseBiasedLocking</span></span><br><span class="line">        <span class="keyword">if</span> (mark-&gt;<span class="built_in">has_bias_pattern</span>()) {</span><br><span class="line">            <span class="type">uintptr_t</span> thread_ident;</span><br><span class="line">            <span class="type">uintptr_t</span> anticipated_bias_locking_value;</span><br><span class="line">            thread_ident = (<span class="type">uintptr_t</span>)istate-&gt;<span class="built_in">thread</span>();</span><br><span class="line">            anticipated_bias_locking_value =</span><br><span class="line">                (((<span class="type">uintptr_t</span>)lockee-&gt;<span class="built_in">klass</span>()-&gt;<span class="built_in">prototype_header</span>() | thread_ident) ^ (<span class="type">uintptr_t</span>)mark) &amp;</span><br><span class="line">                ~((<span class="type">uintptr_t</span>) markOopDesc::age_mask_in_place);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>  (anticipated_bias_locking_value == <span class="number">0</span>) {</span><br><span class="line">                <span class="comment">// already biased towards this thread, nothing to do</span></span><br><span class="line">                <span class="keyword">if</span> (PrintBiasedLockingStatistics) {</span><br><span class="line">                    (* BiasedLocking::<span class="built_in">biased_lock_entry_count_addr</span>())++;</span><br><span class="line">                }</span><br><span class="line">                success = <span class="literal">true</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((anticipated_bias_locking_value &amp; markOopDesc::biased_lock_mask_in_place) != <span class="number">0</span>) {</span><br><span class="line">                <span class="comment">// try revoke bias</span></span><br><span class="line">                markOop header = lockee-&gt;<span class="built_in">klass</span>()-&gt;<span class="built_in">prototype_header</span>();</span><br><span class="line">                <span class="keyword">if</span> (hash != markOopDesc::no_hash) {</span><br><span class="line">                    header = header-&gt;<span class="built_in">copy_set_hash</span>(hash);</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">if</span> (lockee-&gt;<span class="built_in">cas_set_mark</span>(header, mark) == mark) {</span><br><span class="line">                    <span class="keyword">if</span> (PrintBiasedLockingStatistics)</span><br><span class="line">                        (*BiasedLocking::<span class="built_in">revoked_lock_entry_count_addr</span>())++;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((anticipated_bias_locking_value &amp; epoch_mask_in_place) !=<span class="number">0</span>) {</span><br><span class="line">                <span class="comment">// try rebias</span></span><br><span class="line">                markOop new_header = (markOop) ( (<span class="type">intptr_t</span>) lockee-&gt;<span class="built_in">klass</span>()-&gt;<span class="built_in">prototype_header</span>() | thread_ident);</span><br><span class="line">                <span class="keyword">if</span> (hash != markOopDesc::no_hash) {</span><br><span class="line">                    new_header = new_header-&gt;<span class="built_in">copy_set_hash</span>(hash);</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">if</span> (lockee-&gt;<span class="built_in">cas_set_mark</span>(new_header, mark) == mark) {</span><br><span class="line">                    <span class="keyword">if</span> (PrintBiasedLockingStatistics)</span><br><span class="line">                        (* BiasedLocking::<span class="built_in">rebiased_lock_entry_count_addr</span>())++;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">else</span> {</span><br><span class="line">                    <span class="built_in">CALL_VM</span>(InterpreterRuntime::<span class="built_in">monitorenter</span>(THREAD, entry), handle_exception);</span><br><span class="line">                }</span><br><span class="line">                success = <span class="literal">true</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span> {</span><br><span class="line">                <span class="comment">// try to bias towards thread in case object is anonymously biased</span></span><br><span class="line">                markOop header = (markOop) ((<span class="type">uintptr_t</span>) mark &amp; ((<span class="type">uintptr_t</span>)markOopDesc::biased_lock_mask_in_place |</span><br><span class="line">                                                                (<span class="type">uintptr_t</span>)markOopDesc::age_mask_in_place |</span><br><span class="line">                                                                epoch_mask_in_place));</span><br><span class="line">                <span class="keyword">if</span> (hash != markOopDesc::no_hash) {</span><br><span class="line">                    header = header-&gt;<span class="built_in">copy_set_hash</span>(hash);</span><br><span class="line">                }</span><br><span class="line">                markOop new_header = (markOop) ((<span class="type">uintptr_t</span>) header | thread_ident);</span><br><span class="line">                <span class="comment">// debugging hint</span></span><br><span class="line">                <span class="built_in">DEBUG_ONLY</span>(entry-&gt;<span class="built_in">lock</span>()-&gt;<span class="built_in">set_displaced_header</span>((markOop) (<span class="type">uintptr_t</span>) <span class="number">0xdeaddead</span>);)</span><br><span class="line">                    <span class="keyword">if</span> (lockee-&gt;<span class="built_in">cas_set_mark</span>(new_header, header) == header) {</span><br><span class="line">                        <span class="keyword">if</span> (PrintBiasedLockingStatistics)</span><br><span class="line">                            (* BiasedLocking::<span class="built_in">anonymously_biased_lock_entry_count_addr</span>())++;</span><br><span class="line">                    }</span><br><span class="line">                <span class="keyword">else</span> {</span><br><span class="line">                    <span class="built_in">CALL_VM</span>(InterpreterRuntime::<span class="built_in">monitorenter</span>(THREAD, entry), handle_exception);</span><br><span class="line">                }</span><br><span class="line">                success = <span class="literal">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// traditional lightweight locking</span></span><br><span class="line">        <span class="keyword">if</span> (!success) {</span><br><span class="line">            markOop displaced = lockee-&gt;<span class="built_in">mark</span>()-&gt;<span class="built_in">set_unlocked</span>();</span><br><span class="line">            entry-&gt;<span class="built_in">lock</span>()-&gt;<span class="built_in">set_displaced_header</span>(displaced);</span><br><span class="line">            <span class="type">bool</span> call_vm = UseHeavyMonitors;</span><br><span class="line">            <span class="keyword">if</span> (call_vm || lockee-&gt;<span class="built_in">cas_set_mark</span>((markOop)entry, displaced) != displaced) {</span><br><span class="line">                <span class="comment">// Is it simple recursive case?</span></span><br><span class="line">                <span class="keyword">if</span> (!call_vm &amp;&amp; THREAD-&gt;<span class="built_in">is_lock_owned</span>((address) displaced-&gt;<span class="built_in">clear_lock_bits</span>())) {</span><br><span class="line">                    entry-&gt;<span class="built_in">lock</span>()-&gt;<span class="built_in">set_displaced_header</span>(<span class="literal">NULL</span>);</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    <span class="built_in">CALL_VM</span>(InterpreterRuntime::<span class="built_in">monitorenter</span>(THREAD, entry), handle_exception);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">UPDATE_PC_AND_TOS_AND_CONTINUE</span>(<span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        istate-&gt;<span class="built_in">set_msg</span>(more_monitors);</span><br><span class="line">        <span class="built_in">UPDATE_PC_AND_RETURN</span>(<span class="number">0</span>); <span class="comment">// Re-execute</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>Lock Recordæ˜¯çº¿ç¨‹ç§æœ‰çš„æ•°æ®ç»“æ„</strong>ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå¯ç”¨Lock Recordåˆ—è¡¨ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªå…¨å±€çš„å¯ç”¨åˆ—è¡¨ã€‚æ¯ä¸€ä¸ªè¢«é”ä½çš„å¯¹è±¡Mark Wordéƒ½ä¼šå’Œä¸€ä¸ªLock Recordå…³è”ï¼ˆå¯¹è±¡å¤´çš„MarkWordä¸­çš„Lock WordæŒ‡å‘Lock Recordçš„èµ·å§‹åœ°å€ï¼‰ï¼ŒåŒæ—¶ Lock Record ä¸­æœ‰ä¸€ä¸ª Owner å­—æ®µå­˜æ”¾æ‹¥æœ‰è¯¥é”çš„çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ï¼ˆæˆ–è€…<code>object mark word</code>ï¼‰ï¼Œè¡¨ç¤ºè¯¥é”è¢«è¿™ä¸ªçº¿ç¨‹å ç”¨ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºä¸ºLock Recordçš„å†…éƒ¨ç»“æ„ï¼š</p>
<table>
<thead>
<tr>
<th>Lock Record</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>Owner</td>
<td>åˆå§‹æ—¶ä¸ºNULLè¡¨ç¤ºå½“å‰æ²¡æœ‰ä»»ä½•çº¿ç¨‹æ‹¥æœ‰è¯¥monitor recordï¼Œå½“çº¿ç¨‹æˆåŠŸæ‹¥æœ‰è¯¥é”åä¿å­˜çº¿ç¨‹å”¯ä¸€æ ‡è¯†ï¼Œå½“é”è¢«é‡Šæ”¾æ—¶åˆè®¾ç½®ä¸ºNULLï¼›</td>
</tr>
<tr>
<td>EntryQ</td>
<td>å…³è”ä¸€ä¸ªç³»ç»Ÿäº’æ–¥é”ï¼ˆsemaphoreï¼‰ï¼Œé˜»å¡æ‰€æœ‰è¯•å›¾é”ä½monitor recordå¤±è´¥çš„çº¿ç¨‹ï¼›</td>
</tr>
<tr>
<td>RcThis</td>
<td>è¡¨ç¤ºblockedæˆ–waitingåœ¨è¯¥monitor recordä¸Šçš„æ‰€æœ‰çº¿ç¨‹çš„ä¸ªæ•°ï¼›</td>
</tr>
<tr>
<td>Nest</td>
<td>ç”¨æ¥å®ç° é‡å…¥é”çš„è®¡æ•°ï¼›</td>
</tr>
<tr>
<td>HashCode</td>
<td>ä¿å­˜ä»å¯¹è±¡å¤´æ‹·è´è¿‡æ¥çš„HashCodeå€¼ï¼ˆå¯èƒ½è¿˜åŒ…å«GC ageï¼‰ã€‚</td>
</tr>
<tr>
<td>Candidate</td>
<td>ç”¨æ¥é¿å…ä¸å¿…è¦çš„é˜»å¡æˆ–ç­‰å¾…çº¿ç¨‹å”¤é†’ï¼Œå› ä¸ºæ¯ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤ŸæˆåŠŸæ‹¥æœ‰é”ï¼Œå¦‚æœæ¯æ¬¡å‰ä¸€ä¸ªé‡Šæ”¾é”çš„çº¿ç¨‹å”¤é†’æ‰€æœ‰æ­£åœ¨é˜»å¡æˆ–ç­‰å¾…çš„çº¿ç¨‹ï¼Œä¼šå¼•èµ·ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆä»é˜»å¡åˆ°å°±ç»ªç„¶åå› ä¸ºç«äº‰é”å¤±è´¥åˆè¢«é˜»å¡ï¼‰ä»è€Œå¯¼è‡´æ€§èƒ½ä¸¥é‡ä¸‹é™ã€‚Candidateåªæœ‰ä¸¤ç§å¯èƒ½çš„å€¼0è¡¨ç¤ºæ²¡æœ‰éœ€è¦å”¤é†’çš„çº¿ç¨‹1è¡¨ç¤ºè¦å”¤é†’ä¸€ä¸ªç»§ä»»çº¿ç¨‹æ¥ç«äº‰é”ã€‚</td>
</tr>
</tbody></table>
<h2 id="synchronized-é”é‡å…¥"><a href="#synchronized-é”é‡å…¥" class="headerlink" title="synchronized é”é‡å…¥"></a>synchronized é”é‡å…¥</h2><h3 id="é—®é¢˜å¯¼å…¥"><a href="#é—®é¢˜å¯¼å…¥" class="headerlink" title="é—®é¢˜å¯¼å…¥"></a>é—®é¢˜å¯¼å…¥</h3><blockquote>
<p>å¦‚æœä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº†ä¸€ä¸ªå¯¹è±¡çš„åŒæ­¥æ–¹æ³•ï¼Œé‚£ä¹ˆä»–è¿˜èƒ½ä¸èƒ½åœ¨è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„å¦å¤–ä¸€ä¸ªåŒæ­¥æ–¹æ³•å‘¢ï¼Ÿ</p>
</blockquote>
<p>synchronized é”æ‹¥æœ‰é‡å…¥é”çš„åŠŸèƒ½ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å¾—åˆ°å¯¹è±¡é”ä¹‹åï¼Œå†æ¬¡è¯·æ±‚æ­¤å¯¹è±¡é”æ—¶æ˜¯å¯ä»¥è·å–åˆ°è¯¥å¯¹è±¡é”çš„ï¼Œä¹Ÿå°±å¯ä»¥åœ¨ä¸€ä¸ª synchronized æ–¹æ³• ï¼ˆå—ï¼‰çš„å†…éƒ¨è°ƒç”¨æœ¬ç±»çš„å…¶å®ƒåŠ é”çš„æ–¹æ³•ï¼ˆå—ï¼‰ï¼Œæ˜¯å¯ä»¥ç›´æ¥å¾—åˆ°é”çš„ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªsynchronizedå¯é‡å…¥æ€§éªŒè¯çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service</span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span>  <span class="keyword">void</span> <span class="title function_">fun1</span><span class="params">()</span>{</span><br><span class="line">        System.out.println(<span class="string">"ä¸€å·åŒæ­¥æ–¹æ³•"</span>);</span><br><span class="line">        fun2();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">fun2</span><span class="params">()</span>{</span><br><span class="line">        System.out.println(<span class="string">"äºŒå·åŒæ­¥æ–¹æ³•"</span>);</span><br><span class="line">        fun3();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">fun3</span><span class="params">()</span>{</span><br><span class="line">        System.out.println(<span class="string">"ä¸‰å·åŒæ­¥æ–¹æ³•"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> {</span><br><span class="line">    <span class="keyword">private</span> Service service;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SynThreadText</span><span class="params">(Service service)</span>{</span><br><span class="line">        <span class="built_in">this</span>.service=service;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>{</span><br><span class="line">        service.fun1();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Service</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Service</span>();</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">myThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>(service);</span><br><span class="line">        myThread.start();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">ä¸€å·åŒæ­¥æ–¹æ³•</span><br><span class="line">äºŒå·åŒæ­¥æ–¹æ³•</span><br><span class="line">ä¸‰å·åŒæ­¥æ–¹æ³•</span><br></pre></td></tr></tbody></table></figure>

<h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>å¯é‡å…¥é”åˆåé€’å½’é”ï¼Œæ˜¯æŒ‡åœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–é”çš„æ—¶å€™ï¼Œå†æ¬¡è¿›å…¥è¯¥çº¿ç¨‹çš„å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”ï¼ˆå‰æé”å¯¹è±¡å¾—æ˜¯åŒä¸€ä¸ªå¯¹è±¡æˆ–è€… classï¼‰ï¼Œä¸ä¼šå› ä¸ºä¹‹å‰å·²ç»è·å–è¿‡è¿˜æ²¡é‡Šæ”¾è€Œé˜»å¡ã€‚å¯é‡å…¥é”çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯å¯ä¸€å®šç¨‹åº¦é¿å…æ­»é”ã€‚</p>
<h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>åœ¨object monitor çš„æºç ä¸­æœ‰ä¸€ä¸ª _count å˜é‡ï¼Œå½“è·å–äº†è¯¥é”çš„çº¿ç¨‹å†æ¬¡è·å–é”æ—¶å‘ç°é”æ‹¥æœ‰è€…æ˜¯è‡ªå·±ï¼Œå°±ä¼šæŠŠ _countï¼‹1, å½“é‡Šæ”¾é”å  _countï¼1ã€‚å½“è®¡æ•°å™¨å€¼ä¸º 0 æ—¶ï¼Œé”é‡Œé¢çš„çº¿ç¨‹æ ‡ç¤ºè¢«é‡ç½®ä¸º nullï¼Œè¿™æ—¶å€™è¢«é˜»å¡çš„çº¿ç¨‹ä¼šè¢«å”¤é†’æ¥ç«äº‰è·å–è¯¥é”ã€‚</p>
<h3 id="é”é‡å…¥æ”¯æŒçˆ¶ç±»ç»§æ‰¿"><a href="#é”é‡å…¥æ”¯æŒçˆ¶ç±»ç»§æ‰¿" class="headerlink" title="é”é‡å…¥æ”¯æŒçˆ¶ç±»ç»§æ‰¿"></a>é”é‡å…¥æ”¯æŒçˆ¶ç±»ç»§æ‰¿</h3><p>æ—¢ç„¶ synchronized æ”¯æŒå¯¹è±¡çš„æ–¹æ³•é‡å…¥ï¼Œé‚£ä¹ˆä»–æ˜¯å¦ä¹Ÿæ”¯æŒå­ç±»ç»§æ‰¿çˆ¶ç±»çš„åŒæ­¥æ–¹æ³•é‡å…¥ï¼Ÿ</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SubClass</span> <span class="keyword">extends</span> <span class="title class_">SuperClass</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>{</span><br><span class="line">        <span class="built_in">this</span>.subFun();</span><br><span class="line">    }</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span>  <span class="keyword">void</span> <span class="title function_">subFun</span><span class="params">()</span>{</span><br><span class="line">        System.out.println(<span class="string">"å­ç±»çš„åŒæ­¥æ–¹æ³•"</span>);</span><br><span class="line">        <span class="built_in">this</span>.superSynFun();</span><br><span class="line">    }</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">SubClass</span> <span class="variable">sub</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SubClass</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(sub);</span><br><span class="line">        t.start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SuperClass</span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">superSynFun</span><span class="params">()</span>{</span><br><span class="line">        System.out.println(<span class="string">"çˆ¶ç±»çš„åŒæ­¥æ–¹æ³•"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">å­ç±»çš„åŒæ­¥æ–¹æ³•</span><br><span class="line">çˆ¶ç±»çš„åŒæ­¥æ–¹æ³•</span><br></pre></td></tr></tbody></table></figure>

<p>å¦‚æœè¢«é‡å†™çš„æ–¹æ³•æœ‰synchronizedå…³é”®å­—ï¼Œåœ¨æ‰€é‡å†™æ–¹æ³•å¦‚æœä¸åŠ  synchronized  ä¿®é¥°ï¼Œé‚£å°±æ˜¯éåŒæ­¥æ–¹æ³•ã€‚</p>
<h2 id="é”çš„ä¼˜åŒ–"><a href="#é”çš„ä¼˜åŒ–" class="headerlink" title="é”çš„ä¼˜åŒ–"></a>é”çš„ä¼˜åŒ–</h2><h3 id="è‡ªæ—‹é”"><a href="#è‡ªæ—‹é”" class="headerlink" title="è‡ªæ—‹é”"></a>è‡ªæ—‹é”</h3><p><strong>çº¿ç¨‹çš„é˜»å¡å’Œå”¤é†’éœ€è¦CPUä»ç”¨æˆ·æ€è½¬ä¸ºæ ¸å¿ƒæ€</strong>ï¼Œé¢‘ç¹çš„é˜»å¡å’Œå”¤é†’å¯¹CPUæ¥è¯´æ˜¯ä¸€ä»¶è´Ÿæ‹…å¾ˆé‡çš„å·¥ä½œï¼ŒåŠ¿å¿…ä¼šç»™ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½å¸¦æ¥å¾ˆå¤§çš„å‹åŠ›ã€‚åŒæ—¶æˆ‘ä»¬å‘ç°åœ¨è®¸å¤šåº”ç”¨ä¸Šé¢ï¼Œå¯¹è±¡é”çš„é”çŠ¶æ€åªä¼šæŒç»­å¾ˆçŸ­ä¸€æ®µæ—¶é—´ï¼Œä¸ºäº†è¿™ä¸€æ®µå¾ˆçŸ­çš„æ—¶é—´é¢‘ç¹åœ°é˜»å¡å’Œå”¤é†’çº¿ç¨‹æ˜¯éå¸¸ä¸å€¼å¾—çš„ã€‚</p>
<p>æ‰€ä»¥å¼•å…¥è‡ªæ—‹é”ï¼Œä½•è°“è‡ªæ—‹é”ï¼Ÿ </p>
<p>æ‰€è°“è‡ªæ—‹é”å°±æ˜¯æŒ‡å½“ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–æŸä¸ªé”æ—¶ï¼Œå¦‚æœè¯¥é”å·²è¢«å…¶ä»–çº¿ç¨‹å ç”¨ï¼Œå°±ä¸€ç›´å¾ªç¯æ£€æµ‹é”æ˜¯å¦è¢«é‡Šæ”¾ï¼Œè€Œä¸æ˜¯è¿›å…¥çº¿ç¨‹æŒ‚èµ·æˆ–ç¡çœ çŠ¶æ€ã€‚</p>
<p>è‡ªæ—‹é”é€‚ç”¨äºé”ä¿æŠ¤çš„ä¸´ç•ŒåŒºå¾ˆå°çš„æƒ…å†µï¼Œä¸´ç•ŒåŒºå¾ˆå°çš„è¯ï¼Œé”å ç”¨çš„æ—¶é—´å°±å¾ˆçŸ­ã€‚è‡ªæ—‹ç­‰å¾…ä¸èƒ½æ›¿ä»£é˜»å¡ï¼Œè™½ç„¶å®ƒå¯ä»¥é¿å…çº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„å¼€é”€ï¼Œä½†æ˜¯å®ƒå ç”¨äº†CPUå¤„ç†å™¨çš„æ—¶é—´ã€‚å¦‚æœæŒæœ‰é”çš„çº¿ç¨‹å¾ˆå¿«å°±é‡Šæ”¾äº†é”ï¼Œé‚£ä¹ˆè‡ªæ—‹çš„æ•ˆç‡å°±éå¸¸å¥½ï¼Œåä¹‹ï¼Œè‡ªæ—‹çš„çº¿ç¨‹å°±ä¼šç™½ç™½æ¶ˆè€—æ‰å¤„ç†çš„èµ„æºï¼Œå®ƒä¸ä¼šåšä»»ä½•æœ‰æ„ä¹‰çš„å·¥ä½œï¼Œå…¸å‹çš„å ç€èŒ…å‘ä¸æ‹‰å±ï¼Œè¿™æ ·åè€Œä¼šå¸¦æ¥æ€§èƒ½ä¸Šçš„æµªè´¹ã€‚æ‰€ä»¥è¯´ï¼Œè‡ªæ—‹ç­‰å¾…çš„æ—¶é—´ï¼ˆè‡ªæ—‹çš„æ¬¡æ•°ï¼‰å¿…é¡»è¦æœ‰ä¸€ä¸ªé™åº¦ï¼Œå¦‚æœè‡ªæ—‹è¶…è¿‡äº†å®šä¹‰çš„æ—¶é—´ä»ç„¶æ²¡æœ‰è·å–åˆ°é”ï¼Œåˆ™åº”è¯¥è¢«æŒ‚èµ·ã€‚</p>
<p>è‡ªæ—‹é”åœ¨JDK 1.4.2ä¸­å¼•å…¥ï¼Œé»˜è®¤å…³é—­ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨-XX:+UseSpinningå¼€å¼€å¯ï¼Œåœ¨JDK1.6ä¸­é»˜è®¤å¼€å¯ã€‚åŒæ—¶è‡ªæ—‹çš„é»˜è®¤æ¬¡æ•°ä¸º10æ¬¡ï¼Œå¯ä»¥é€šè¿‡å‚æ•°-XX:PreBlockSpinæ¥è°ƒæ•´ã€‚å¦‚æœé€šè¿‡å‚æ•°-XX:PreBlockSpinæ¥è°ƒæ•´è‡ªæ—‹é”çš„è‡ªæ—‹æ¬¡æ•°ï¼Œä¼šå¸¦æ¥è¯¸å¤šä¸ä¾¿ã€‚å‡å¦‚å°†å‚æ•°è°ƒæ•´ä¸º10ï¼Œä½†æ˜¯ç³»ç»Ÿå¾ˆå¤šçº¿ç¨‹éƒ½æ˜¯ç­‰ä½ åˆšåˆšé€€å‡ºçš„æ—¶å€™å°±é‡Šæ”¾äº†é”ï¼ˆå‡å¦‚å¤šè‡ªæ—‹ä¸€ä¸¤æ¬¡å°±å¯ä»¥è·å–é”ï¼‰ï¼Œæ˜¯ä¸æ˜¯å¾ˆå°´å°¬ã€‚äºæ˜¯JDK1.6å¼•å…¥è‡ªé€‚åº”çš„è‡ªæ—‹é”ï¼Œè®©è™šæ‹Ÿæœºä¼šå˜å¾—è¶Šæ¥è¶Šèªæ˜ã€‚</p>
<h3 id="é€‚åº”æ€§è‡ªæ—‹é”"><a href="#é€‚åº”æ€§è‡ªæ—‹é”" class="headerlink" title="é€‚åº”æ€§è‡ªæ—‹é”"></a>é€‚åº”æ€§è‡ªæ—‹é”</h3><p>JDK 1.6å¼•å…¥äº†æ›´åŠ èªæ˜çš„è‡ªæ—‹é”ï¼Œå³è‡ªé€‚åº”è‡ªæ—‹é”ã€‚æ‰€è°“è‡ªé€‚åº”å°±æ„å‘³ç€è‡ªæ—‹çš„æ¬¡æ•°ä¸å†æ˜¯å›ºå®šçš„ï¼Œå®ƒæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šã€‚é‚£å®ƒå¦‚ä½•è¿›è¡Œé€‚åº”æ€§è‡ªæ—‹å‘¢ï¼Ÿ </p>
<p><strong>çº¿ç¨‹å¦‚æœè‡ªæ—‹æˆåŠŸäº†ï¼Œé‚£ä¹ˆä¸‹æ¬¡è‡ªæ—‹çš„æ¬¡æ•°ä¼šæ›´åŠ å¤šï¼Œå› ä¸ºè™šæ‹Ÿæœºè®¤ä¸ºæ—¢ç„¶ä¸Šæ¬¡æˆåŠŸäº†ï¼Œé‚£ä¹ˆæ­¤æ¬¡è‡ªæ—‹ä¹Ÿå¾ˆæœ‰å¯èƒ½ä¼šå†æ¬¡æˆåŠŸï¼Œé‚£ä¹ˆå®ƒå°±ä¼šå…è®¸è‡ªæ—‹ç­‰å¾…æŒç»­çš„æ¬¡æ•°æ›´å¤šã€‚åä¹‹ï¼Œå¦‚æœå¯¹äºæŸä¸ªé”ï¼Œå¾ˆå°‘æœ‰è‡ªæ—‹èƒ½å¤ŸæˆåŠŸï¼Œé‚£ä¹ˆåœ¨ä»¥åè¦æˆ–è€…è¿™ä¸ªé”çš„æ—¶å€™è‡ªæ—‹çš„æ¬¡æ•°ä¼šå‡å°‘ç”šè‡³çœç•¥æ‰è‡ªæ—‹è¿‡ç¨‹ï¼Œä»¥å…æµªè´¹å¤„ç†å™¨èµ„æºã€‚</strong></p>
<p>æœ‰äº†è‡ªé€‚åº”è‡ªæ—‹é”ï¼Œéšç€ç¨‹åºè¿è¡Œå’Œæ€§èƒ½ç›‘æ§ä¿¡æ¯çš„ä¸æ–­å®Œå–„ï¼Œè™šæ‹Ÿæœºå¯¹ç¨‹åºé”çš„çŠ¶å†µé¢„æµ‹ä¼šè¶Šæ¥è¶Šå‡†ç¡®ï¼Œè™šæ‹Ÿæœºä¼šå˜å¾—è¶Šæ¥è¶Šèªæ˜ã€‚</p>
<h3 id="é”ç²—åŒ–"><a href="#é”ç²—åŒ–" class="headerlink" title="é”ç²—åŒ–"></a>é”ç²—åŒ–</h3><p>å¯é€šè¿‡JITWatchæŸ¥çœ‹è¿è¡Œçš„è¿‡ç¨‹ã€‚é”ç²—è¯æ¦‚å¿µæ¯”è¾ƒå¥½ç†è§£ï¼Œå°±æ˜¯å°†å¤šä¸ªè¿ç»­çš„åŠ é”ã€è§£é”æ“ä½œè¿æ¥åœ¨ä¸€èµ·ï¼Œæ‰©å±•æˆä¸€ä¸ªèŒƒå›´æ›´å¤§çš„é”ã€‚StringBufferä¸­çš„appendæ–¹æ³•ä¸Šæœ‰synchronizedåŒæ­¥å…³é”®å­—ã€‚æ¯æ¬¡appendçš„æ—¶å€™éƒ½éœ€è¦åŠ é”æ“ä½œï¼Œ<strong>JVMæ£€æµ‹åˆ°å¯¹åŒä¸€ä¸ªå¯¹è±¡è¿ç»­åŠ é”ã€è§£é”æ“ä½œï¼Œä¼šåˆå¹¶ä¸€ä¸ªæ›´å¤§èŒƒå›´çš„åŠ é”ã€è§£é”æ“ä½œï¼Œå³åŠ é”è§£é”æ“ä½œä¼šç§»åˆ°forå¾ªç¯ä¹‹å¤–ã€‚</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">100000</span>; i++){</span><br><span class="line">        sb.append(i+<span class="string">""</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// ä¼˜åŒ–å</span></span><br><span class="line">    <span class="keyword">synchronized</span>(<span class="built_in">this</span>) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">100000</span>; i++){</span><br><span class="line">            <span class="comment">// appendçš„synchronizedå…³é”®å­—ä¼šè¢«æ¶ˆé™¤</span></span><br><span class="line">            sb.append(i+<span class="string">""</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="é”æ¶ˆé™¤"><a href="#é”æ¶ˆé™¤" class="headerlink" title="é”æ¶ˆé™¤"></a>é”æ¶ˆé™¤</h3><p>ä¸ºäº†ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œåœ¨è¿›è¡Œæ“ä½œæ—¶éœ€è¦å¯¹è¿™éƒ¨åˆ†æ“ä½œè¿›è¡ŒåŒæ­¥æ§åˆ¶ï¼Œä½†æ˜¯åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼ŒJVMæ£€æµ‹åˆ°ä¸å¯èƒ½å­˜åœ¨å…±äº«æ•°æ®ç«äº‰ï¼Œè¿™æ˜¯JVMä¼šå¯¹è¿™äº›åŒæ­¥é”è¿›è¡Œé”æ¶ˆé™¤ã€‚ä¾‹å¦‚ï¼ŒStringBufferç±»çš„append() æ–¹æ³•ä½¿ç”¨äº† synchronized å…³é”®å­—ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯ä»…ç”¨åœ¨çº¿ç¨‹å°é—­çš„ç¯å¢ƒä¸­ï¼Œåˆ™é”ä¼šæµªè´¹èµ„æºï¼ŒJITå°±ä¼šå¯¹é”è¿›è¡Œæ¶ˆé™¤ã€‚</p>
<blockquote>
<p>é”æ¶ˆé™¤çš„ä¾æ®æ˜¯é€ƒé€¸åˆ†æçš„æ•°æ®æ”¯æŒ</p>
</blockquote>
<p>é€ƒé€¸åˆ†æï¼šå½“ä¸€ä¸ªå¯¹è±¡çš„æŒ‡é’ˆè¢«å¤šä¸ªæ–¹æ³•æˆ–çº¿ç¨‹å¼•ç”¨æ—¶ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªæŒ‡é’ˆå‘ç”Ÿäº†é€ƒé€¸ï¼Œä¼šå‘ç”Ÿé€ƒé€¸çš„ä¸‰ä¸ªåœºæ™¯æ˜¯å…¨å±€å˜é‡èµ‹å€¼ã€æ–¹æ³•è¿”å›å€¼ã€å®ä¾‹å¼•ç”¨ä¼ é€’ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> {  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> B b;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">globalVariablePointerEscape</span><span class="params">()</span> { <span class="comment">// ç»™å…¨å±€å˜é‡èµ‹å€¼ï¼Œå‘ç”Ÿé€ƒé€¸  </span></span><br><span class="line">        b = <span class="keyword">new</span> <span class="title class_">B</span>();  </span><br><span class="line">    }  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> B <span class="title function_">methodPointerEscape</span><span class="params">()</span> { <span class="comment">// æ–¹æ³•è¿”å›å€¼ï¼Œå‘ç”Ÿé€ƒé€¸  </span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">B</span>();  </span><br><span class="line">    }  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">instancePassPointerEscape</span><span class="params">()</span> {  </span><br><span class="line">        methodPointerEscape().printClassName(<span class="built_in">this</span>); <span class="comment">// å®ä¾‹å¼•ç”¨ä¼ é€’ï¼Œå‘ç”Ÿé€ƒé€¸  </span></span><br><span class="line">    }  </span><br><span class="line">}  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> {  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printClassName</span><span class="params">(A a)</span> {  </span><br><span class="line">        System.out.println(a.class.getName());  </span><br><span class="line">    }  </span><br><span class="line">}  </span><br></pre></td></tr></tbody></table></figure>

<p>å¦‚æœä¸å­˜åœ¨ç«äº‰ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦åŠ é”å‘¢ï¼Ÿæ‰€ä»¥é”æ¶ˆé™¤å¯ä»¥èŠ‚çœæ¯«æ— æ„ä¹‰çš„è¯·æ±‚é”çš„æ—¶é—´ã€‚å˜é‡æ˜¯å¦é€ƒé€¸ï¼Œå¯¹äºè™šæ‹Ÿæœºæ¥è¯´éœ€è¦ä½¿ç”¨æ•°æ®æµåˆ†ææ¥ç¡®å®šï¼Œä½†æ˜¯å¯¹äºç¨‹åºå‘˜æ¥è¯´è¿™è¿˜ä¸æ¸…æ¥šä¹ˆï¼Ÿ</p>
<p>æ•°æ®æµï¼šä¾‹å¦‚åœ¨æ–¹æ³•ä¸­ï¼Œå°†å˜é‡Açš„å€¼èµ‹å€¼ç»™äº†å˜é‡Bï¼Œä»£ç A=Bçš„è¿™ä¸ªèµ‹å€¼è¿‡ç¨‹ç²—ç•¥çš„ç§°ä¸ºæ•°æ®æµã€‚</p>
<p>åœ¨æ˜æ˜çŸ¥é“ä¸å­˜åœ¨æ•°æ®ç«äº‰çš„ä»£ç å—å‰åŠ ä¸ŠåŒæ­¥å—ï¼Ÿä½†æ˜¯æœ‰æ—¶å€™ç¨‹åºå¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€æƒ³çš„é‚£æ ·ï¼Ÿè™½ç„¶æ²¡æœ‰æ˜¾ç¤ºä½¿ç”¨é”ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ä¸€äº›JDKçš„å†…ç½®APIæ—¶ï¼Œå¦‚StringBufferã€Vectorã€HashTableç­‰ï¼Œè¿™ä¸ªæ—¶å€™ä¼šå­˜åœ¨éšå½¢çš„åŠ é”æ“ä½œã€‚æ¯”å¦‚StringBufferçš„append()æ–¹æ³•ï¼ŒVectorçš„add()æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">vectorTest</span><span class="params">()</span>{</span><br><span class="line">    Vector&lt;String&gt; vector = <span class="keyword">new</span> <span class="title class_">Vector</span>&lt;String&gt;();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; <span class="number">10</span> ; i++){</span><br><span class="line">        vector.add(i + <span class="string">""</span>);</span><br><span class="line">    }</span><br><span class="line">    System.out.println(vector);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨è¿è¡Œè¿™æ®µä»£ç æ—¶ï¼ŒJVMå¯ä»¥æ˜æ˜¾æ£€æµ‹åˆ°å˜é‡vectoræ²¡æœ‰é€ƒé€¸å‡ºæ–¹æ³•vectorTest()ä¹‹å¤–ï¼Œæ‰€ä»¥JVMå¯ä»¥å¤§èƒ†åœ°å°†vectorå†…éƒ¨çš„åŠ é”æ“ä½œæ¶ˆé™¤ã€‚</p>
<h3 id="åå‘é”"><a href="#åå‘é”" class="headerlink" title="åå‘é”"></a>åå‘é”</h3><p>åå‘é”æ˜¯JDK6ä¸­çš„é‡è¦å¼•è¿›ï¼Œå› ä¸ºHotSpotä½œè€…ç»è¿‡ç ”ç©¶å®è·µå‘ç°ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œä¸ºäº†è®©çº¿ç¨‹è·å¾—é”çš„ä»£ä»·æ›´ä½ï¼Œå¼•è¿›äº†åå‘é”ã€‚</p>
<p>åå‘é”æ˜¯åœ¨å•çº¿ç¨‹æ‰§è¡Œä»£ç å—æ—¶ä½¿ç”¨çš„æœºåˆ¶ï¼Œå¦‚æœåœ¨å¤šçº¿ç¨‹å¹¶å‘çš„ç¯å¢ƒä¸‹ï¼ˆå³çº¿ç¨‹Aå°šæœªæ‰§è¡Œå®ŒåŒæ­¥ä»£ç å—ï¼Œçº¿ç¨‹Bå‘èµ·äº†ç”³è¯·é”çš„ç”³è¯·ï¼‰ï¼Œåˆ™ä¸€å®šä¼šè½¬åŒ–ä¸ºè½»é‡çº§é”æˆ–è€…é‡é‡çº§é”ã€‚</p>
<p>åœ¨JDK5ä¸­åå‘é”é»˜è®¤æ˜¯å…³é—­çš„ï¼Œè€Œåˆ°äº†JDK6ä¸­åå‘é”å·²ç»é»˜è®¤å¼€å¯ã€‚å¦‚æœå¹¶å‘æ•°è¾ƒå¤§åŒæ—¶åŒæ­¥ä»£ç å—æ‰§è¡Œæ—¶é—´è¾ƒé•¿ï¼Œåˆ™è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®çš„æ¦‚ç‡å°±å¾ˆå¤§ï¼Œå°±å¯ä»¥ä½¿ç”¨å‚æ•°-XX:-UseBiasedLockingæ¥ç¦æ­¢åå‘é”(ä½†è¿™æ˜¯ä¸ªJVMå‚æ•°ï¼Œä¸èƒ½é’ˆå¯¹æŸä¸ªå¯¹è±¡é”æ¥å•ç‹¬è®¾ç½®)ã€‚</p>
<p>å¼•å…¥åå‘é”ä¸»è¦ç›®çš„æ˜¯ï¼šä¸ºäº†åœ¨æ²¡æœ‰å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹å°½é‡å‡å°‘ä¸å¿…è¦çš„è½»é‡çº§é”æ‰§è¡Œè·¯å¾„ã€‚å› ä¸ºè½»é‡çº§é”çš„åŠ é”è§£é”æ“ä½œæ˜¯éœ€è¦ä¾èµ–å¤šæ¬¡CASåŸå­æŒ‡ä»¤çš„ï¼Œè€Œåå‘é”åªéœ€è¦åœ¨ç½®æ¢ThreadIDçš„æ—¶å€™ä¾èµ–ä¸€æ¬¡CASåŸå­æŒ‡ä»¤ï¼ˆç”±äºä¸€æ—¦å‡ºç°å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µå°±å¿…é¡»æ’¤é”€åå‘é”ï¼Œæ‰€ä»¥åå‘é”çš„æ’¤é”€æ“ä½œçš„æ€§èƒ½æŸè€—ä¹Ÿå¿…é¡»å°äºèŠ‚çœä¸‹æ¥çš„CASåŸå­æŒ‡ä»¤çš„æ€§èƒ½æ¶ˆè€—ï¼‰ã€‚</p>
<blockquote>
<p>è½»é‡çº§é”æ˜¯ä¸ºäº†åœ¨çº¿ç¨‹äº¤æ›¿æ‰§è¡ŒåŒæ­¥å—æ—¶æé«˜æ€§èƒ½ï¼Œè€Œåå‘é”åˆ™æ˜¯åœ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥å—æ—¶è¿›ä¸€æ­¥æé«˜æ€§èƒ½ã€‚</p>
</blockquote>
<p>é‚£ä¹ˆåå‘é”æ˜¯å¦‚ä½•æ¥å‡å°‘ä¸å¿…è¦çš„CASæ“ä½œå‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹æ— ç«äº‰ä¸‹é”å­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼š</p>
<blockquote>
<p><strong>ç°åœ¨å‡ ä¹æ‰€æœ‰çš„é”éƒ½æ˜¯å¯é‡å…¥çš„ï¼Œå³å·²ç»è·å¾—é”çš„çº¿ç¨‹å¯ä»¥å¤šæ¬¡é”ä½/è§£é”ç›‘è§†å¯¹è±¡ï¼ŒæŒ‰ç…§ä¹‹å‰çš„HotSpotè®¾è®¡ï¼Œæ¯æ¬¡åŠ é”/è§£é”éƒ½ä¼šæ¶‰åŠåˆ°ä¸€äº›CASæ“ä½œï¼ˆæ¯”å¦‚å¯¹ç­‰å¾…é˜Ÿåˆ—çš„CASæ“ä½œï¼‰ï¼ŒCASæ“ä½œä¼šå»¶è¿Ÿæœ¬åœ°è°ƒç”¨ï¼Œå› æ­¤åå‘é”çš„æƒ³æ³•æ˜¯ ä¸€æ—¦çº¿ç¨‹ç¬¬ä¸€æ¬¡è·å¾—äº†ç›‘è§†å¯¹è±¡ï¼Œä¹‹åè®©ç›‘è§†å¯¹è±¡â€œåå‘â€è¿™ä¸ªçº¿ç¨‹ï¼Œä¹‹åçš„å¤šæ¬¡è°ƒç”¨åˆ™å¯ä»¥é¿å…CASæ“ä½œï¼Œè¯´ç™½äº†å°±æ˜¯ç½®ä¸ªå˜é‡ï¼Œå¦‚æœå‘ç°ä¸ºtrueåˆ™æ— éœ€å†èµ°å„ç§åŠ é”/è§£é”æµç¨‹ã€‚</strong></p>
</blockquote>
<p>CASä¸ºä»€ä¹ˆä¼šå¼•å…¥æœ¬åœ°å»¶è¿Ÿï¼Ÿè¿™è¦ä»SMPï¼ˆå¯¹ç§°å¤šå¤„ç†å™¨ï¼‰æ¶æ„è¯´èµ·ï¼Œä¸‹å›¾å¤§æ¦‚è¡¨æ˜äº†SMPçš„ç»“æ„ï¼š</p>
<p><img src="/p/8360cd4/2062729-0f9f45797f3e732a.png" alt="img"></p>
<p>SMPï¼ˆå¯¹ç§°å¤šå¤„ç†å™¨ï¼‰æ¶æ„</p>
<blockquote>
<p>å…¶æ„æ€æ˜¯ æ‰€æœ‰çš„CPUä¼šå…±äº«ä¸€æ¡ç³»ç»Ÿæ€»çº¿ï¼ˆBUSï¼‰ï¼Œé æ­¤æ€»çº¿è¿æ¥ä¸»å­˜ã€‚æ¯ä¸ªæ ¸éƒ½æœ‰è‡ªå·±çš„ä¸€çº§ç¼“å­˜ï¼Œå„æ ¸ç›¸å¯¹äºBUSå¯¹ç§°åˆ†å¸ƒï¼Œå› æ­¤è¿™ç§ç»“æ„ç§°ä¸ºâ€œå¯¹ç§°å¤šå¤„ç†å™¨â€ã€‚</p>
</blockquote>
<p>è€ŒCASçš„å…¨ç§°ä¸ºCompare-And-Swapï¼Œæ˜¯ä¸€æ¡CPUçš„åŸå­æŒ‡ä»¤ï¼Œå…¶ä½œç”¨æ˜¯è®©CPUæ¯”è¾ƒååŸå­åœ°æ›´æ–°æŸä¸ªä½ç½®çš„å€¼ï¼Œç»è¿‡è°ƒæŸ¥å‘ç°ï¼Œå…¶å®ç°æ–¹å¼æ˜¯åŸºäºç¡¬ä»¶å¹³å°çš„æ±‡ç¼–æŒ‡ä»¤ï¼Œå°±æ˜¯è¯´CASæ˜¯é ç¡¬ä»¶å®ç°çš„ï¼ŒJVMåªæ˜¯å°è£…äº†æ±‡ç¼–è°ƒç”¨ï¼Œé‚£äº›AtomicIntegerç±»ä¾¿æ˜¯ä½¿ç”¨äº†è¿™äº›å°è£…åçš„æ¥å£ã€‚</p>
<p>ä¾‹å¦‚ï¼šCore1å’ŒCore2å¯èƒ½ä¼šåŒæ—¶æŠŠä¸»å­˜ä¸­æŸä¸ªä½ç½®çš„å€¼Loadåˆ°è‡ªå·±çš„L1 Cacheä¸­ï¼Œå½“Core1åœ¨è‡ªå·±çš„L1 Cacheä¸­ä¿®æ”¹è¿™ä¸ªä½ç½®çš„å€¼æ—¶ï¼Œä¼šé€šè¿‡æ€»çº¿ï¼Œä½¿Core2ä¸­L1 Cacheå¯¹åº”çš„å€¼â€œå¤±æ•ˆâ€ï¼Œè€ŒCore2ä¸€æ—¦å‘ç°è‡ªå·±L1 Cacheä¸­çš„å€¼å¤±æ•ˆï¼ˆç§°ä¸ºCacheå‘½ä¸­ç¼ºå¤±ï¼‰åˆ™ä¼šé€šè¿‡æ€»çº¿ä»å†…å­˜ä¸­åŠ è½½è¯¥åœ°å€æœ€æ–°çš„å€¼ï¼Œå¤§å®¶é€šè¿‡æ€»çº¿çš„æ¥å›é€šä¿¡ç§°ä¸ºâ€œCacheä¸€è‡´æ€§æµé‡â€ï¼Œå› ä¸ºæ€»çº¿è¢«è®¾è®¡ä¸ºå›ºå®šçš„â€œé€šä¿¡èƒ½åŠ›â€ï¼Œå¦‚æœCacheä¸€è‡´æ€§æµé‡è¿‡å¤§ï¼Œæ€»çº¿å°†æˆä¸ºç“¶é¢ˆã€‚è€Œå½“Core1å’ŒCore2ä¸­çš„å€¼å†æ¬¡ä¸€è‡´æ—¶ï¼Œç§°ä¸ºâ€œCacheä¸€è‡´æ€§â€ï¼Œä»è¿™ä¸ªå±‚é¢æ¥è¯´ï¼Œé”è®¾è®¡çš„ç»ˆæç›®æ ‡ä¾¿æ˜¯å‡å°‘Cacheä¸€è‡´æ€§æµé‡ã€‚</p>
<p>è€ŒCASæ°å¥½ä¼šå¯¼è‡´Cacheä¸€è‡´æ€§æµé‡ï¼Œå¦‚æœæœ‰å¾ˆå¤šçº¿ç¨‹éƒ½å…±äº«åŒä¸€ä¸ªå¯¹è±¡ï¼Œå½“æŸä¸ªCore CASæˆåŠŸæ—¶å¿…ç„¶ä¼šå¼•èµ·æ€»çº¿é£æš´ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„æœ¬åœ°å»¶è¿Ÿï¼Œæœ¬è´¨ä¸Šåå‘é”å°±æ˜¯ä¸ºäº†æ¶ˆé™¤CASï¼Œé™ä½Cacheä¸€è‡´æ€§æµé‡ã€‚</p>
<p><em>Cacheä¸€è‡´æ€§ï¼š</em></p>
<blockquote>
<p>ä¸Šé¢æåˆ°Cacheä¸€è‡´æ€§ï¼Œå…¶å®æ˜¯æœ‰åè®®æ”¯æŒçš„ï¼Œç°åœ¨é€šç”¨çš„åè®®æ˜¯MESIï¼ˆæœ€æ—©ç”±Intelå¼€å§‹æ”¯æŒï¼‰ï¼Œå…·ä½“å‚è€ƒï¼š<a href="http://en.wikipedia.org/wiki/MESI_protocol%E3%80%82">http://en.wikipedia.org/wiki/MESI_protocolã€‚</a></p>
</blockquote>
<p><em>Cacheä¸€è‡´æ€§æµé‡çš„ä¾‹å¤–æƒ…å†µï¼š</em></p>
<blockquote>
<p>å…¶å®ä¹Ÿä¸æ˜¯æ‰€æœ‰çš„CASéƒ½ä¼šå¯¼è‡´æ€»çº¿é£æš´ï¼Œè¿™è·ŸCacheä¸€è‡´æ€§åè®®æœ‰å…³ï¼Œå…·ä½“å‚è€ƒï¼š<a href="http://blogs.oracle.com/dave/entry/biased_locking_in_hotspot">http://blogs.oracle.com/dave/entry/biased_locking_in_hotspot</a></p>
</blockquote>
<p><em>NUMA(Non Uniform Memory Access Achitectureï¼‰æ¶æ„ï¼š</em></p>
<blockquote>
<p>ä¸SMPå¯¹åº”è¿˜æœ‰éå¯¹ç§°å¤šå¤„ç†å™¨æ¶æ„ï¼Œç°åœ¨ä¸»è¦åº”ç”¨åœ¨ä¸€äº›é«˜ç«¯å¤„ç†å™¨ä¸Šï¼Œä¸»è¦ç‰¹ç‚¹æ˜¯æ²¡æœ‰æ€»çº¿ï¼Œæ²¡æœ‰å…¬ç”¨ä¸»å­˜ï¼Œæ¯ä¸ªCoreæœ‰è‡ªå·±çš„å†…å­˜ï¼Œé’ˆå¯¹è¿™ç§ç»“æ„æ­¤å¤„ä¸åšè®¨è®ºã€‚</p>
</blockquote>
<p>æ‰€ä»¥ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨å¯¹è±¡å¤´å’Œæ ˆå¸§ä¸­çš„é”è®°å½•é‡Œå­˜å‚¨é”åå‘çš„çº¿ç¨‹IDï¼Œä»¥åè¯¥çº¿ç¨‹è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸éœ€è¦èŠ±è´¹CASæ“ä½œæ¥äº‰å¤ºé”èµ„æºï¼Œåªéœ€è¦æ£€æŸ¥æ˜¯å¦ä¸ºåå‘é”ã€é”æ ‡è¯†ä¸ºä»¥åŠThreadIDå³å¯ï¼Œå¤„ç†æµç¨‹å¦‚ä¸‹ï¼š</p>
<blockquote>
<ol>
<li>æ£€æµ‹Mark Wordæ˜¯å¦ä¸ºå¯åå‘çŠ¶æ€ï¼Œå³æ˜¯å¦ä¸ºåå‘é”1ï¼Œé”æ ‡è¯†ä½ä¸º01ï¼›</li>
<li>è‹¥ä¸ºå¯åå‘çŠ¶æ€ï¼Œåˆ™æµ‹è¯•çº¿ç¨‹IDæ˜¯å¦ä¸ºå½“å‰çº¿ç¨‹IDï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ‰§è¡Œæ­¥éª¤ï¼ˆ5ï¼‰ï¼Œå¦åˆ™æ‰§è¡Œæ­¥éª¤ï¼ˆ3ï¼‰ï¼›</li>
<li>å¦‚æœæµ‹è¯•çº¿ç¨‹IDä¸ä¸ºå½“å‰çº¿ç¨‹IDï¼Œåˆ™é€šè¿‡CASæ“ä½œç«äº‰é”ï¼Œç«äº‰æˆåŠŸï¼Œåˆ™å°†Mark Wordçš„çº¿ç¨‹IDæ›¿æ¢ä¸ºå½“å‰çº¿ç¨‹IDï¼Œå¦åˆ™æ‰§è¡Œçº¿ç¨‹ï¼ˆ4ï¼‰ï¼›</li>
<li>é€šè¿‡CASç«äº‰é”å¤±è´¥ï¼Œè¯æ˜å½“å‰å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰æƒ…å†µï¼Œå½“åˆ°è¾¾å…¨å±€å®‰å…¨ç‚¹ï¼Œè·å¾—åå‘é”çš„çº¿ç¨‹è¢«æŒ‚èµ·ï¼Œåå‘é”å‡çº§ä¸ºè½»é‡çº§é”ï¼Œç„¶åè¢«é˜»å¡åœ¨å®‰å…¨ç‚¹çš„çº¿ç¨‹ç»§ç»­å¾€ä¸‹æ‰§è¡ŒåŒæ­¥ä»£ç å—ï¼›</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç å—ï¼›</li>
</ol>
</blockquote>
<p>åå‘é”çš„é‡Šæ”¾é‡‡ç”¨äº† ä¸€ç§åªæœ‰ç«äº‰æ‰ä¼šé‡Šæ”¾é”çš„æœºåˆ¶ï¼Œçº¿ç¨‹æ˜¯ä¸ä¼šä¸»åŠ¨å»é‡Šæ”¾åå‘é”ï¼Œéœ€è¦ç­‰å¾…å…¶ä»–çº¿ç¨‹æ¥ç«äº‰ã€‚åå‘é”çš„æ’¤é”€éœ€è¦ ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹ï¼ˆè¿™ä¸ªæ—¶é—´ç‚¹æ˜¯ä¸Šæ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»£ç ï¼‰ã€‚å…¶æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<blockquote>
<ol>
<li>æš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼›</li>
<li>åˆ¤æ–­é”å¯¹è±¡æ˜¯å¦è¿˜å¤„äºè¢«é”å®šçŠ¶æ€ï¼Œå¦ï¼Œåˆ™æ¢å¤åˆ°æ— é”çŠ¶æ€ï¼ˆ01ï¼‰ï¼Œä»¥å…è®¸å…¶ä½™çº¿ç¨‹ç«äº‰ã€‚æ˜¯ï¼Œåˆ™æŒ‚èµ·æŒæœ‰é”çš„å½“å‰çº¿ç¨‹ï¼Œå¹¶å°†æŒ‡å‘å½“å‰çº¿ç¨‹çš„é”è®°å½•åœ°å€çš„æŒ‡é’ˆæ”¾å…¥å¯¹è±¡å¤´Mark Wordï¼Œå‡çº§ä¸ºè½»é‡çº§é”çŠ¶æ€ï¼ˆ00ï¼‰ï¼Œç„¶åæ¢å¤æŒæœ‰é”çš„å½“å‰çº¿ç¨‹ï¼Œè¿›å…¥è½»é‡çº§é”çš„ç«äº‰æ¨¡å¼ï¼›</li>
</ol>
<p>æ³¨æ„ï¼šæ­¤å¤„å°† å½“å‰çº¿ç¨‹æŒ‚èµ·å†æ¢å¤çš„è¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰å‘ç”Ÿé”çš„è½¬ç§»ï¼Œä»ç„¶åœ¨å½“å‰çº¿ç¨‹æ‰‹ä¸­ï¼Œåªæ˜¯ç©¿æ’äº†ä¸ª â€œå°†å¯¹è±¡å¤´ä¸­çš„çº¿ç¨‹IDå˜æ›´ä¸ºæŒ‡å‘é”è®°å½•åœ°å€çš„æŒ‡é’ˆâ€ è¿™ä¹ˆä¸ªäº‹ã€‚</p>
</blockquote>
<p>åå‘é”çš„è·å–å’Œé‡Šæ”¾è¿‡ç¨‹ï¼š</p>
<p><img src="/p/8360cd4/2062729-b4873ca2e39c1db7.png" alt="img"></p>
<h3 id="è½»é‡çº§é”"><a href="#è½»é‡çº§é”" class="headerlink" title="è½»é‡çº§é”"></a>è½»é‡çº§é”</h3><p>å¼•å…¥è½»é‡çº§é”çš„ä¸»è¦ç›®çš„æ˜¯ åœ¨æ²¡æœ‰å¤šçº¿ç¨‹ç«äº‰çš„å‰æä¸‹ï¼Œå‡å°‘ä¼ ç»Ÿçš„é‡é‡çº§é”ä½¿ç”¨æ“ä½œç³»ç»Ÿäº’æ–¥é‡äº§ç”Ÿçš„æ€§èƒ½æ¶ˆè€—ã€‚å½“å…³é—­åå‘é”åŠŸèƒ½æˆ–è€…å¤šä¸ªçº¿ç¨‹ç«äº‰åå‘é”å¯¼è‡´åå‘é”å‡çº§ä¸ºè½»é‡çº§é”ï¼Œåˆ™ä¼šå°è¯•è·å–è½»é‡çº§é”ï¼Œå…¶æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>åœ¨çº¿ç¨‹è¿›å…¥åŒæ­¥å—æ—¶ï¼Œå¦‚æœåŒæ­¥å¯¹è±¡é”çŠ¶æ€ä¸ºæ— é”çŠ¶æ€ï¼ˆé”æ ‡å¿—ä½ä¸ºâ€œ01â€çŠ¶æ€ï¼Œæ˜¯å¦ä¸ºåå‘é”ä¸ºâ€œ0â€ï¼‰ï¼Œè™šæ‹Ÿæœºé¦–å…ˆå°†åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªåä¸ºé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„Mark Wordçš„æ‹·è´ï¼Œå®˜æ–¹ç§°ä¹‹ä¸º Displaced Mark Wordã€‚æ­¤æ—¶çº¿ç¨‹å †æ ˆä¸å¯¹è±¡å¤´çš„çŠ¶æ€å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li>
</ol>
<p><img src="/p/8360cd4/2062729-7e332020d9f252db.png" alt="img"></p>
<ol>
<li>è½»é‡çº§é”CASæ“ä½œä¹‹å‰çº¿ç¨‹å †æ ˆä¸å¯¹è±¡çš„çŠ¶æ€</li>
<li>æ‹·è´å¯¹è±¡å¤´ä¸­çš„Mark Wordå¤åˆ¶åˆ°é”è®°å½•ï¼ˆLock Recordï¼‰ä¸­ï¼›</li>
<li>æ‹·è´æˆåŠŸåï¼Œè™šæ‹Ÿæœºå°†ä½¿ç”¨CASæ“ä½œå°è¯•å°†å¯¹è±¡Mark Wordä¸­çš„Lock Wordæ›´æ–°ä¸ºæŒ‡å‘å½“å‰çº¿ç¨‹Lock Recordçš„æŒ‡é’ˆï¼Œå¹¶å°†Lock recordé‡Œçš„owneræŒ‡é’ˆæŒ‡å‘object mark wordã€‚å¦‚æœæ›´æ–°æˆåŠŸï¼Œåˆ™æ‰§è¡Œæ­¥éª¤ï¼ˆ4ï¼‰ï¼Œå¦åˆ™æ‰§è¡Œæ­¥éª¤ï¼ˆ5ï¼‰ï¼›</li>
<li>å¦‚æœè¿™ä¸ªæ›´æ–°åŠ¨ä½œæˆåŠŸäº†ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°±æ‹¥æœ‰äº†è¯¥å¯¹è±¡çš„é”ï¼Œå¹¶ä¸”å¯¹è±¡Mark Wordçš„é”æ ‡å¿—ä½è®¾ç½®ä¸ºâ€œ00â€ï¼Œå³è¡¨ç¤ºæ­¤å¯¹è±¡å¤„äºè½»é‡çº§é”å®šçŠ¶æ€ï¼Œæ­¤æ—¶çº¿ç¨‹å †æ ˆä¸å¯¹è±¡å¤´çš„çŠ¶æ€å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li>
</ol>
<p><img src="/p/8360cd4/2062729-5e935668eddb8fcd.png" alt="img"></p>
<ol>
<li>è½»é‡çº§é”CASæ“ä½œä¹‹åçº¿ç¨‹å †æ ˆä¸å¯¹è±¡çš„çŠ¶æ€</li>
<li>å¦‚æœè¿™ä¸ªæ›´æ–°æ“ä½œå¤±è´¥äº†ï¼Œè™šæ‹Ÿæœºé¦–å…ˆä¼šæ£€æŸ¥å¯¹è±¡Mark Wordä¸­çš„Lock Wordæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆå¸§ï¼Œå¦‚æœæ˜¯ï¼Œå°±è¯´æ˜å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œé‚£å°±å¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å—ç»§ç»­æ‰§è¡Œã€‚å¦åˆ™è¯´æ˜å¤šä¸ªçº¿ç¨‹ç«äº‰é”ï¼Œè¿›å…¥è‡ªæ—‹æ‰§è¡Œï¼ˆ3ï¼‰ï¼Œè‹¥è‡ªæ—‹ç»“æŸæ—¶ä»æœªè·å¾—é”ï¼Œè½»é‡çº§é”å°±è¦è†¨èƒ€ä¸ºé‡é‡çº§é”ï¼Œé”æ ‡å¿—çš„çŠ¶æ€å€¼å˜ä¸ºâ€œ10â€ï¼ŒMark Wordä¸­å­˜å‚¨çš„å°±æ˜¯æŒ‡å‘é‡é‡çº§é”ï¼ˆäº’æ–¥é‡ï¼‰çš„æŒ‡é’ˆï¼Œå½“å‰çº¿ç¨‹ä»¥åŠåé¢ç­‰å¾…é”çš„çº¿ç¨‹ä¹Ÿè¦è¿›å…¥é˜»å¡çŠ¶æ€ã€‚</li>
</ol>
<p>è½»é‡çº§é”çš„é‡Šæ”¾ä¹Ÿæ˜¯é€šè¿‡CASæ“ä½œæ¥è¿›è¡Œçš„ï¼Œä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<blockquote>
<ol>
<li>é€šè¿‡CASæ“ä½œå°è¯•æŠŠçº¿ç¨‹ä¸­å¤åˆ¶çš„Displaced Mark Wordå¯¹è±¡æ›¿æ¢å½“å‰çš„Mark Wordï¼›</li>
<li>å¦‚æœæ›¿æ¢æˆåŠŸï¼Œæ•´ä¸ªåŒæ­¥è¿‡ç¨‹å°±å®Œæˆäº†ï¼Œæ¢å¤åˆ°æ— é”çŠ¶æ€ï¼ˆ01ï¼‰ï¼›</li>
<li>å¦‚æœæ›¿æ¢å¤±è´¥ï¼Œè¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹å°è¯•è¿‡è·å–è¯¥é”ï¼ˆæ­¤æ—¶é”å·²è†¨èƒ€ï¼‰ï¼Œé‚£å°±è¦åœ¨é‡Šæ”¾é”çš„åŒæ—¶ï¼Œå”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹ï¼›</li>
</ol>
</blockquote>
<p>å¯¹äºè½»é‡çº§é”ï¼Œå…¶æ€§èƒ½æå‡çš„ä¾æ®æ˜¯ â€œå¯¹äºç»å¤§éƒ¨åˆ†çš„é”ï¼Œåœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…éƒ½æ˜¯ä¸ä¼šå­˜åœ¨ç«äº‰çš„â€ï¼Œå¦‚æœæ‰“ç ´è¿™ä¸ªä¾æ®åˆ™é™¤äº†äº’æ–¥çš„å¼€é”€å¤–ï¼Œè¿˜æœ‰é¢å¤–çš„CASæ“ä½œï¼Œå› æ­¤åœ¨æœ‰å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹ï¼Œè½»é‡çº§é”æ¯”é‡é‡çº§é”æ›´æ…¢ã€‚</p>
<p><img src="/p/8360cd4/2062729-b952465daf77e896.png" alt="img"></p>
<p>è½»é‡çº§é”çš„è·å–å’Œé‡Šæ”¾è¿‡ç¨‹</p>
<ol>
<li><p>ä¸ºä»€ä¹ˆå‡çº§ä¸ºè½»é‡é”æ—¶è¦æŠŠå¯¹è±¡å¤´é‡Œçš„Mark Wordå¤åˆ¶åˆ°çº¿ç¨‹æ ˆçš„é”è®°å½•ä¸­å‘¢ï¼Ÿ</p>
<blockquote>
<p>å› ä¸ºåœ¨ç”³è¯·å¯¹è±¡é”æ—¶ éœ€è¦ä»¥è¯¥å€¼ä½œä¸ºCASçš„æ¯”è¾ƒæ¡ä»¶ï¼ŒåŒæ—¶åœ¨å‡çº§åˆ°é‡é‡çº§é”çš„æ—¶å€™ï¼Œèƒ½é€šè¿‡è¿™ä¸ªæ¯”è¾ƒåˆ¤å®šæ˜¯å¦åœ¨æŒæœ‰é”çš„è¿‡ç¨‹ä¸­æ­¤é”è¢«å…¶ä»–çº¿ç¨‹ç”³è¯·è¿‡ï¼Œå¦‚æœè¢«å…¶ä»–çº¿ç¨‹ç”³è¯·äº†ï¼Œåˆ™åœ¨é‡Šæ”¾é”çš„æ—¶å€™è¦å”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹ã€‚</p>
</blockquote>
</li>
<li><p>ä¸ºä»€ä¹ˆä¼šå°è¯•CASä¸æˆåŠŸä»¥åŠä»€ä¹ˆæƒ…å†µä¸‹ä¼šä¸æˆåŠŸï¼Ÿ</p>
<blockquote>
<p>CASæœ¬èº«æ˜¯ä¸å¸¦é”æœºåˆ¶çš„ï¼Œå…¶æ˜¯é€šè¿‡æ¯”è¾ƒè€Œæ¥ã€‚å‡è®¾å¦‚ä¸‹åœºæ™¯ï¼šçº¿ç¨‹Aå’Œçº¿ç¨‹Béƒ½åœ¨å¯¹è±¡å¤´é‡Œçš„é”æ ‡è¯†ä¸ºæ— é”çŠ¶æ€è¿›å…¥ï¼Œé‚£ä¹ˆå¦‚çº¿ç¨‹Aå…ˆæ›´æ–°å¯¹è±¡å¤´ä¸ºå…¶é”è®°å½•æŒ‡é’ˆæˆåŠŸä¹‹åï¼Œçº¿ç¨‹Bå†ç”¨CASå»æ›´æ–°ï¼Œå°±ä¼šå‘ç°æ­¤æ—¶çš„å¯¹è±¡å¤´å·²ç»ä¸æ˜¯å…¶æ“ä½œå‰çš„å¯¹è±¡HashCodeäº†ï¼Œæ‰€ä»¥CASä¼šå¤±è´¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘ç”³è¯·é”çš„æ—¶å€™ä¼šå‘ç”ŸCASå¤±è´¥ã€‚</p>
<p>ç„¶åçº¿ç¨‹Bè¿›è¡ŒCASè‡ªæ—‹ï¼Œç­‰å¾…å¯¹è±¡å¤´çš„é”æ ‡è¯†é‡æ–°å˜å›æ— é”çŠ¶æ€æˆ–å¯¹è±¡å¤´å†…å®¹ç­‰äºå¯¹è±¡HashCodeï¼ˆå› ä¸ºè¿™æ˜¯çº¿ç¨‹BåšCASæ“ä½œå‰çš„å€¼ï¼‰ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€çº¿ç¨‹Aæ‰§è¡Œç»“æŸï¼ˆå‚è§åé¢è½»é‡çº§é”çš„æ’¤é”€ï¼Œåªæœ‰çº¿ç¨‹Aæ‰§è¡Œå®Œæ¯•æ’¤é”€é”äº†æ‰ä¼šé‡ç½®å¯¹è±¡å¤´ï¼‰ï¼Œæ­¤æ—¶çº¿ç¨‹Bçš„CASæ“ä½œç»ˆäºæˆåŠŸäº†ï¼Œäºæ˜¯çº¿ç¨‹Bè·å¾—äº†é”ä»¥åŠæ‰§è¡ŒåŒæ­¥ä»£ç çš„æƒé™ã€‚å¦‚æœçº¿ç¨‹Açš„æ‰§è¡Œæ—¶é—´è¾ƒé•¿ï¼Œçº¿ç¨‹Bç»è¿‡è‹¥å¹²æ¬¡CASæ—¶é’Ÿæ²¡æœ‰æˆåŠŸï¼Œåˆ™é”è†¨èƒ€ä¸ºé‡é‡çº§é”ï¼Œå³çº¿ç¨‹Bè¢«æŒ‚èµ·é˜»å¡ã€ç­‰å¾…é‡æ–°è°ƒåº¦ã€‚</p>
</blockquote>
</li>
</ol>
<p>æ­¤å¤„ï¼Œå¦‚ä½•ç†è§£â€œè½»é‡çº§â€ï¼Ÿâ€œè½»é‡çº§â€æ˜¯ç›¸å¯¹äºä½¿ç”¨æ“ä½œç³»ç»Ÿäº’æ–¥é‡æ¥å®ç°çš„ä¼ ç»Ÿé”è€Œè¨€çš„ã€‚ä½†æ˜¯ï¼Œé¦–å…ˆéœ€è¦å¼ºè°ƒä¸€ç‚¹çš„æ˜¯ï¼Œè½»é‡çº§é”å¹¶ä¸æ˜¯ç”¨æ¥ä»£æ›¿é‡é‡çº§é”çš„ï¼Œå®ƒçš„æœ¬æ„æ˜¯åœ¨æ²¡æœ‰å¤šçº¿ç¨‹ç«äº‰çš„å‰æä¸‹ï¼Œå‡å°‘ä¼ ç»Ÿçš„é‡é‡çº§é”ä½¿ç”¨äº§ç”Ÿçš„æ€§èƒ½æ¶ˆè€—ã€‚</p>
<blockquote>
<p>è½»é‡çº§é”æ‰€é€‚åº”çš„åœºæ™¯æ˜¯çº¿ç¨‹äº¤æ›¿æ‰§è¡ŒåŒæ­¥å—çš„æƒ…å†µï¼Œå¦‚æœå­˜åœ¨åŒä¸€æ—¶é—´è®¿é—®åŒä¸€é”çš„æƒ…å†µï¼Œå¿…ç„¶å°±ä¼šå¯¼è‡´è½»é‡çº§é”è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚</p>
</blockquote>
<h3 id="é‡é‡çº§é”"><a href="#é‡é‡çº§é”" class="headerlink" title="é‡é‡çº§é”"></a>é‡é‡çº§é”</h3><p>Synchronizedæ˜¯é€šè¿‡å¯¹è±¡å†…éƒ¨çš„ä¸€ä¸ªå«åš ç›‘è§†å™¨é”ï¼ˆMonitorï¼‰æ¥å®ç°çš„ã€‚ä½†æ˜¯ç›‘è§†å™¨é”æœ¬è´¨åˆæ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„Mutex Lockæ¥å®ç°çš„ã€‚è€Œæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢è¿™å°±éœ€è¦ä»ç”¨æˆ·æ€è½¬æ¢åˆ°æ ¸å¿ƒæ€ï¼Œè¿™ä¸ªæˆæœ¬éå¸¸é«˜ï¼ŒçŠ¶æ€ä¹‹é—´çš„è½¬æ¢éœ€è¦ç›¸å¯¹æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆSynchronizedæ•ˆç‡ä½çš„åŸå› ã€‚å› æ­¤ï¼Œè¿™ç§ä¾èµ–äºæ“ä½œç³»ç»ŸMutex Lockæ‰€å®ç°çš„é”æˆ‘ä»¬ç§°ä¹‹ä¸º â€œé‡é‡çº§é”â€ã€‚</p>
<h3 id="é”å‡çº§"><a href="#é”å‡çº§" class="headerlink" title="é”å‡çº§"></a>é”å‡çº§</h3><p><img src="/p/8360cd4/2062729-5f1830874fd93080.png" alt="img"></p>
<p>Synchronizedåå‘é”ã€è½»é‡çº§é”åŠé‡é‡çº§é”è½¬æ¢æµç¨‹ï¼š</p>
<p><img src="/p/8360cd4/2062729-61dfb07d48d8588c.png" alt="img"></p>
<h2 id="é”çš„ä¼˜åŠ£"><a href="#é”çš„ä¼˜åŠ£" class="headerlink" title="é”çš„ä¼˜åŠ£"></a>é”çš„ä¼˜åŠ£</h2><p>å„ç§é”å¹¶ä¸æ˜¯ç›¸äº’ä»£æ›¿çš„ï¼Œè€Œæ˜¯åœ¨ä¸åŒåœºæ™¯ä¸‹çš„ä¸åŒé€‰æ‹©ï¼Œç»å¯¹ä¸æ˜¯è¯´é‡é‡çº§é”å°±æ˜¯ä¸åˆé€‚çš„ã€‚æ¯ç§é”æ˜¯åªèƒ½å‡çº§ï¼Œä¸èƒ½é™çº§ï¼Œå³ç”±åå‘é”-&gt;è½»é‡çº§é”-&gt;é‡é‡çº§é”ï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å¼€é”€é€æ¸åŠ å¤§çš„è¿‡ç¨‹ã€‚</p>
<blockquote>
<ol>
<li>å¦‚æœæ˜¯å•çº¿ç¨‹ä½¿ç”¨ï¼Œé‚£åå‘é”æ¯«æ— ç–‘é—®ä»£ä»·æœ€å°ï¼Œå¹¶ä¸”å®ƒå°±èƒ½è§£å†³é—®é¢˜ï¼Œè¿CASéƒ½ä¸ç”¨åšï¼Œä»…ä»…åœ¨å†…å­˜ä¸­æ¯”è¾ƒä¸‹å¯¹è±¡å¤´å°±å¯ä»¥äº†ï¼›</li>
<li>å¦‚æœå‡ºç°äº†å…¶ä»–çº¿ç¨‹ç«äº‰ï¼Œåˆ™åå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼›</li>
<li>å¦‚æœå…¶ä»–çº¿ç¨‹é€šè¿‡ä¸€å®šæ¬¡æ•°çš„CASå°è¯•æ²¡æœ‰æˆåŠŸï¼Œåˆ™è¿›å…¥é‡é‡çº§é”ï¼›</li>
</ol>
</blockquote>
<p>åœ¨ç¬¬3ç§æƒ…å†µä¸‹è¿›å…¥åŒæ­¥ä»£ç å—å°± è¦åšåå‘é”å»ºç«‹ã€åå‘é”æ’¤é”€ã€è½»é‡çº§é”å»ºç«‹ã€å‡çº§åˆ°é‡é‡çº§é”ï¼Œæœ€ç»ˆè¿˜æ˜¯å¾—é é‡é‡çº§é”æ¥è§£å†³é—®é¢˜ï¼Œé‚£è¿™æ ·çš„ä»£ä»·å°±æ¯”ç›´æ¥ç”¨é‡é‡çº§é”è¦å¤§ä¸å°‘äº†ã€‚æ‰€ä»¥ä½¿ç”¨å“ªç§æŠ€æœ¯ï¼Œä¸€å®šè¦çœ‹å…¶æ‰€å¤„çš„ç¯å¢ƒåŠåœºæ™¯ï¼Œåœ¨ç»å¤§å¤šæ•°çš„æƒ…å†µä¸‹ï¼Œåå‘é”æ˜¯æœ‰æ•ˆçš„ï¼Œè¿™æ˜¯åŸºäºHotSpotä½œè€…å‘ç°çš„â€œå¤§å¤šæ•°é”åªä¼šç”±åŒä¸€çº¿ç¨‹å¹¶å‘ç”³è¯·â€çš„ç»éªŒè§„å¾‹ã€‚</p>
<p><img src="/p/8360cd4/2062729-c9740ab79f4d178c.png" alt="img"></p>
</body></html>]]></content>
      <tags>
        <tag>JUCå¹¶å‘åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>çº¿ç¨‹Suspend &amp; Resume</title>
    <url>/p/64fda4e0.html</url>
    <content><![CDATA[<html><head></head><body><table>
<thead>
<tr>
<th>æ–¹æ³•å</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td>suspend</td>
<td>çº¿ç¨‹æš‚åœ</td>
</tr>
<tr>
<td>resume</td>
<td>æ¢å¤çº¿ç¨‹æ‰§è¡Œ</td>
</tr>
</tbody></table>
<h2 id="ä¸€ã€åŸºæœ¬åº”ç”¨"><a href="#ä¸€ã€åŸºæœ¬åº”ç”¨" class="headerlink" title="ä¸€ã€åŸºæœ¬åº”ç”¨"></a>ä¸€ã€åŸºæœ¬åº”ç”¨</h2><p>ä¸€ä¸ªæ¡ˆä¾‹çœ‹æ‡‚ suspend() ä¸ resume() çš„åŸºæœ¬åº”ç”¨ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadSuspendAndResume</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">myThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        myThread.start();</span><br><span class="line">        Thread.sleep(<span class="number">500</span>); <span class="comment">// è®©çº¿ç¨‹æ‰§è¡Œ500æ¯«ç§’</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Aæ®µ</span></span><br><span class="line">        myThread.suspend(); <span class="comment">// æš‚åœ</span></span><br><span class="line">        System.out.println(<span class="string">"A="</span> + System.currentTimeMillis() + <span class="string">" i="</span> + myThread.i); <span class="comment">// æŸ¥çœ‹æš‚åœä¹‹åçš„ç»“æœ</span></span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        System.out.println(<span class="string">"A="</span> + System.currentTimeMillis() + <span class="string">" i="</span> + myThread.i); <span class="comment">// æŸ¥çœ‹500æ¯«ç§’åçš„ç»“æœ</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Bæ®µ</span></span><br><span class="line">        myThread.resume();<span class="comment">// æš‚åœ500æ¯«ç§’ä¹‹åï¼Œä½¿ç”¨resumeæ¢å¤</span></span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">        myThread.suspend();</span><br><span class="line">        System.out.println(<span class="string">"B="</span> + System.currentTimeMillis() + <span class="string">" i="</span> + myThread.i);</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        System.out.println(<span class="string">"B="</span> + System.currentTimeMillis() + <span class="string">" i="</span> + myThread.i);</span><br><span class="line"></span><br><span class="line">        myThread.stop(); <span class="comment">// é”€æ¯çº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">        System.out.println(<span class="string">"END!"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) {</span><br><span class="line">            i++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">A=1613381037365 i=389072852</span><br><span class="line">A=1613381037868 i=389072852</span><br><span class="line">B=1613381038373 i=784162715</span><br><span class="line">B=1613381038889 i=784162715</span><br><span class="line">END!</span><br></pre></td></tr></tbody></table></figure>

<p>ä»æ§åˆ¶å°ä¸Šçš„æ—¶é—´å’Œæ•°å€¼æ¥çœ‹ï¼Œçº¿ç¨‹çš„ç¡®æ˜¯è¢«æš‚åœäº†ï¼Œè€Œä¸”å¯ä»¥æ¢å¤æˆè¿è¡ŒçŠ¶æ€ã€‚</p>
<h2 id="äºŒã€ç¼ºç‚¹â€”â€”ç‹¬å "><a href="#äºŒã€ç¼ºç‚¹â€”â€”ç‹¬å " class="headerlink" title="äºŒã€ç¼ºç‚¹â€”â€”ç‹¬å "></a>äºŒã€ç¼ºç‚¹â€”â€”ç‹¬å </h2><p>è¿™ä¸¤ä¸ªæ–¹æ³•åœ¨ä½¿ç”¨ä¸å½“çš„æƒ…å†µä¸‹ï¼Œææ˜“é€ æˆå…¬å…±åŒæ­¥å¯¹è±¡è¢«ç‹¬å ï¼Œé€ æˆ<strong>æ­»é”</strong>ï¼ˆå…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®å…¬å…±åŒæ­¥å¯¹è±¡ï¼‰çš„ç»“æœã€‚</p>
<p>ç‹¬å æ¡ˆä¾‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SuspendResumeDealLock</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">SuspendResumeDealLock</span> <span class="variable">that</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SuspendResumeDealLock</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> {</span><br><span class="line">                System.out.println(<span class="string">"çº¿ç¨‹aå¯åŠ¨"</span>);</span><br><span class="line">                that.printString();</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line"></span><br><span class="line">        thread1.setName(<span class="string">"a"</span>);</span><br><span class="line">        thread1.start();</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> {</span><br><span class="line">                System.out.println(<span class="string">"çº¿ç¨‹2å¯åŠ¨"</span>);</span><br><span class="line">                that.printString();</span><br><span class="line">                System.out.println(<span class="string">"çº¿ç¨‹2å®Œæˆæ‰“å°!!!!!"</span>);</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line"></span><br><span class="line">        thread2.start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">synchronized</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printString</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"begin"</span>);</span><br><span class="line">        <span class="keyword">if</span> (Thread.currentThread().getName().equals(<span class="string">"a"</span>)) {</span><br><span class="line">            System.out.println(<span class="string">"çº¿ç¨‹aè¿›å…¥æ°¸è¿œæš‚åœ"</span>);</span><br><span class="line">            Thread.currentThread().suspend();</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">"end"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰“å°ç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">çº¿ç¨‹aå¯åŠ¨</span><br><span class="line">çº¿ç¨‹2å¯åŠ¨</span><br><span class="line">begin</span><br><span class="line">çº¿ç¨‹aè¿›å…¥æ°¸è¿œæš‚åœ</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>açº¿ç¨‹æŠŠ printString() æ–¹æ³•é”å®šäº†ï¼Œé€ æˆ thread2 æ— æ³•è¿›å…¥ printString()ã€‚</p>
<h2 id="ä¸‰ã€ç¼ºç‚¹â€”â€”æ•°æ®ä¸å®Œæ•´"><a href="#ä¸‰ã€ç¼ºç‚¹â€”â€”æ•°æ®ä¸å®Œæ•´" class="headerlink" title="ä¸‰ã€ç¼ºç‚¹â€”â€”æ•°æ®ä¸å®Œæ•´"></a>ä¸‰ã€ç¼ºç‚¹â€”â€”æ•°æ®ä¸å®Œæ•´</h2><p>åœ¨ä½¿ç”¨suspend()æ–¹æ³•å’Œresume()æ–¹æ³•æ—¶ï¼Œå®¹æ˜“å‡ºç°çº¿ç¨‹æš‚åœè¿›è€Œå¯¼è‡´æ•°ä¸å®Œæ•´çš„æƒ…å†µã€‚ä¸‹é¢è¿™ä¸ªæ¡ˆä¾‹å°±æ˜¯ä¸€ä¸ªæ•°æ®ä¸å®Œæ•´çš„å®ä¾‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SuspendResumeDealLock_3</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">"1"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">"11"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(String u, String p)</span> {</span><br><span class="line">        <span class="built_in">this</span>.username = u;</span><br><span class="line">        <span class="keyword">if</span> (Thread.currentThread().getName().equals(<span class="string">"a"</span>)) {</span><br><span class="line">            System.out.println(<span class="string">"æš‚åœçº¿ç¨‹a"</span>);</span><br><span class="line">            Thread.currentThread().suspend();</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">this</span>.password = p;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printUsernamePassword</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(username + <span class="string">" "</span> + password);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Run</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Run</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Run</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SuspendResumeDealLock_3</span> <span class="variable">myObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SuspendResumeDealLock_3</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> {</span><br><span class="line">                myObject.setValue(<span class="string">"a"</span>, <span class="string">"aa"</span>);</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line"></span><br><span class="line">        thread.setName(<span class="string">"a"</span>);</span><br><span class="line">        thread.start();</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> {</span><br><span class="line">                myObject.printUsernamePassword();</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">        thread1.start();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">æš‚åœçº¿ç¨‹a</span><br><span class="line">a 11</span><br></pre></td></tr></tbody></table></figure>

<p>çº¿ç¨‹çš„æš‚åœå’Œå”¤é†’åº”å½“ä½¿ç”¨ wait()ã€notify()ã€notifyAll()æ–¹æ³•ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>JUCå¹¶å‘åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¼˜é›…çš„ä¸­æ–­çº¿ç¨‹</title>
    <url>/p/5f59eead.html</url>
    <content><![CDATA[<html><head></head><body><p>ä¸æ¨èä½¿ç”¨ stopã€suspendã€resume è¿™ä¸‰ä¸ªè¿‡æœŸä½œåºŸçš„æ–¹æ³•ï¼Œå› ä¸ºæœ‰å¯èƒ½ä¼šå‘ç”Ÿä¸å¯é¢„æ–™çš„ç»“æœè€Œä¸”å‡ºç°é”™è¯¯åè¿˜æ¯”è¾ƒéš¾å®šä½ã€‚</p>
<p>ä¸æ¨èä½¿ç”¨ Thread.stop() çš„åŸå› ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ä»å¤–é¢è®©çº¿ç¨‹<strong>å¼ºåˆ¶åœæ­¢</strong>ï¼Œå¦‚æœåœæ­¢çš„çº¿ç¨‹æŒæœ‰ä¸€ä¸ªä¸´ç•Œé”ï¼Œ æŠŠä¸€ä¸ªå¯¹è±¡ç½®äºä¸€ä¸ªä¸ä¸€è‡´çš„çŠ¶æ€ï¼ˆåŒ…å«ä¸´ç•Œã€æŒä¹…åŒ–ã€æ¸¸ç¦»ï¼‰ï¼Œè¯´ç™½äº†å°±æ˜¯é€ æˆæ•°æ®ä¸ä¸€è‡´çš„ç»“æœã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåœæ­¢ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨  Thread.interrupt() æ–¹æ³•ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¸ä¼šç»ˆæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹ï¼Œè¿˜éœ€è¦åŠ å…¥ä¸€äº›åˆ¤æ–­æ‰èƒ½å®Œæˆåœæ­¢çº¿ç¨‹ã€‚</p>
<p>åœ¨Javaä¸­æœ‰3ç§æ–¹å¼åœæ­¢æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼š</p>
<p>â€‹        1ã€ä½¿ç”¨é€€å‡ºæ ‡å¿—ï¼Œæ­£å¸¸é€€å‡ºï¼›</p>
<p>â€‹        2ã€ä½¿ç”¨ stop()ï¼Œ å¼ºè¡Œç»ˆæ­¢ï¼›</p>
<p>â€‹        3ã€ä½¿ç”¨ interrupt() æ–¹æ³•ï¼Œä¸­æ–­çº¿ç¨‹ï¼›</p>
<h2 id="interrupt-åˆä½“éªŒ"><a href="#interrupt-åˆä½“éªŒ" class="headerlink" title="interrupt() åˆä½“éªŒ"></a>interrupt() åˆä½“éªŒ</h2><p>â€‹    ä¸€ä¸Šæ¥å°±æŒ‰ç…§ä¸‹é¢è¿™ç§æ–¹å¼è¿è¡Œï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadInterrupt</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">myThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        myThread.start();</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        myThread.interrupt();</span><br><span class="line">        System.out.println(<span class="string">"mrdjun"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> {</span><br><span class="line">        <span class="built_in">super</span>.run();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++) {</span><br><span class="line">            System.out.println(<span class="string">"i="</span> + (i + <span class="number">1</span>));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å‘ç°ç»“æœè¾“å‡ºäº† <strong>1000000</strong> è¡Œï¼Œè€Œä¸” mrdjun è¿˜è¾“å‡ºåœ¨äº†ä¸­é—´ï¼Œè¯´æ˜ interrupt å¹¶æ²¡æœ‰è®©çº¿ç¨‹åœä¸‹æ¥ã€‚</p>
<h2 id="åˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸ºåœæ­¢çŠ¶æ€"><a href="#åˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸ºåœæ­¢çŠ¶æ€" class="headerlink" title="åˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸ºåœæ­¢çŠ¶æ€"></a>åˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸ºåœæ­¢çŠ¶æ€</h2><p>â€‹    ä¸‹é¢Javaæä¾›äº†ä¸¤ä¸ªåˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸ºåœæ­¢çŠ¶æ€çš„æ–¹æ³•ã€‚</p>
<p>â€‹    public static boolean interrupted() ï¼šä½¿ç”¨ Thread.interrupted() æµ‹è¯•å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»ä¸­æ–­ï¼Œæ‰§è¡Œåæ¸…æ¥šçŠ¶æ€æ ‡å¿—å€¼ä¸º false çš„åŠŸèƒ½ã€‚</p>
<p>â€‹    public boolean this.isInterrupted()ï¼š æµ‹è¯• this å…³é”®å­—æ‰€åœ¨ç±»çš„å¯¹è±¡æ˜¯å¦å·²ç»ä¸­æ–­ï¼Œä¸æ¸…æ¥šæ ‡å¿—ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadInterrupt</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">myThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        myThread.start();</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        myThread.interrupt(); <span class="comment">// ä½œç”¨äº myThread å¯¹è±¡</span></span><br><span class="line">        <span class="comment">// isInterrupted æµ‹è¯•å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»ä¸­æ–­</span></span><br><span class="line">        System.out.println(<span class="string">"çº¿ç¨‹æ˜¯å¦åœæ­¢ï¼Ÿ"</span>+myThread.isInterrupted());</span><br><span class="line">        System.out.println(<span class="string">"çº¿ç¨‹æ˜¯å¦åœæ­¢ï¼Ÿ"</span>+myThread.isInterrupted());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>â€‹        è¡¥å……ä¸€ç‚¹ï¼šä¹Ÿå¯ä»¥ä½¿ç”¨ Thread.interrupted() æ¥åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»ä¸­æ–­ï¼Œå› ä¸ºåœ¨ Thread.java è¿™ä¸ªç±»ä¸­è°ƒç”¨é™æ€staticæ–¹æ³•çš„æ—¶å€™ï¼Œå¤§å¤šæ•°æ˜¯é’ˆå¯¹ currentThread() çº¿ç¨‹è¿›è¡Œæ“ä½œçš„ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadInterrupt</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">      	Thread.currentThread().interrupt(); <span class="comment">// ä½œç”¨äº Thread</span></span><br><span class="line">        <span class="comment">// isInterrupted æµ‹è¯•å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»ä¸­æ–­</span></span><br><span class="line">        System.out.println(<span class="string">"çº¿ç¨‹æ˜¯å¦åœæ­¢ï¼Ÿ"</span>+ Thread.interrupted()); <span class="comment">// è¾“å‡º true</span></span><br><span class="line">        System.out.println(<span class="string">"çº¿ç¨‹æ˜¯å¦åœæ­¢ï¼Ÿ"</span>+ Thread.interrupted()); <span class="comment">// è¾“å‡º false</span></span><br><span class="line">        System.out.println(<span class="string">"END!"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å‡ºä¹æ„æ–™çš„æ˜¯ç»“æœè¾“å‡ºä¸ä¸€è‡´ï¼ŒæŸ¥çœ‹å®˜æ–¹å¸®åŠ©æ–‡æ¡£ä¸­çš„ interrupted() è§£é‡Šï¼š</p>
<blockquote>
<p>æµ‹è¯•å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»ä¸­æ–­ã€‚çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ç”±è¯¥æ–¹æ³•æ¸…é™¤ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœè¿ç»­ä¸¤æ¬¡è°ƒç”¨è¯¥æ–¹æ³•ï¼Œåˆ™ç¬¬äºŒæ¬¡è°ƒç”¨å°†è¿”å›falseï¼ˆåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨å·²æ¸…é™¤äº†å…¶ä¸­æ–­çŠ¶æ€ä¹‹åï¼Œä¸”ç¬¬äºŒæ¬¡è°ƒç”¨æ£€éªŒå®Œä¸­æ–­çŠ¶æ€å‰ï¼Œå½“å‰çº¿ç¨‹å†æ¬¡ä¸­æ–­çš„æƒ…å†µé™¤å¤–ï¼‰ã€‚</p>
</blockquote>
<p>isInterrupted() çš„æ–¹æ³•å£°æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isInterrupted</span><span class="params">()</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>å¾ˆæ˜¾ç„¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¸æ˜¯ä¸€ä¸ªstaticæ–¹æ³•ï¼Œä½œç”¨äºè¿™ä¸ªæ–¹æ³•çš„å¯¹è±¡ï¼Œå¦‚ä¸‹ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadInterrupt</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">myThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        myThread.start();</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">	    myThread.interrupt();</span><br><span class="line">        System.out.println(<span class="string">"çº¿ç¨‹æ˜¯å¦åœæ­¢ï¼Ÿ"</span> + myThread.isInterrupted()); <span class="comment">// è¾“å‡º true</span></span><br><span class="line">        System.out.println(<span class="string">"çº¿ç¨‹æ˜¯å¦åœæ­¢ï¼Ÿ"</span> + myThread.isInterrupted()); <span class="comment">// è¾“å‡º true</span></span><br><span class="line">        System.out.println(<span class="string">"END!"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç»¼ä¸Šæ‰€è¿°ï¼Œä¸¤è€…åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<p>ï¼ˆ1ï¼‰Thread.interrupted() æµ‹è¯•çº¿ç¨‹æ˜¯å¦å·²ç»ä¸­æ–­ï¼Œæ‰§è¡Œåå…·æœ‰æ¸…é™¤çŠ¶æ€æ ‡å¿—å€¼ä¸ºfalseçš„åŠŸèƒ½ï¼›</p>
<p>ï¼ˆ2ï¼‰new Thread().isInterrupted() æµ‹è¯•çº¿ç¨‹Threadå¯¹è±¡æ˜¯å¦å·²ç»æ˜¯ä¸­æ–­çŠ¶æ€ï¼Œä¸æ¸…é™¤çŠ¶æ€æ ‡å¿—ï¼›</p>
<h2 id="èƒ½åœæ­¢çš„çº¿ç¨‹â€”â€”å¼‚å¸¸æ³•"><a href="#èƒ½åœæ­¢çš„çº¿ç¨‹â€”â€”å¼‚å¸¸æ³•" class="headerlink" title="èƒ½åœæ­¢çš„çº¿ç¨‹â€”â€”å¼‚å¸¸æ³•"></a>èƒ½åœæ­¢çš„çº¿ç¨‹â€”â€”å¼‚å¸¸æ³•</h2><p>â€‹    åœ¨mainæ–¹æ³•ä¸­ä¸¤ç§’åè°ƒç”¨ Thread å¯¹è±¡çš„ myThread.interrupt() æ–¹æ³•ï¼Œåœ¨çº¿ç¨‹ä¸­çš„forå¾ªç¯ä¸­åŠ å…¥ if åˆ¤æ–­åé¢çš„ä»£ç æ˜¯å¦å¯ä»¥è¿è¡Œã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadInterrupt</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">myThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        myThread.start();</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        myThread.interrupt();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> {</span><br><span class="line">        <span class="built_in">super</span>.run();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5000000</span>; i++) {</span><br><span class="line">                <span class="keyword">if</span> (interrupted()) {</span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹å·²ç»åœæ­¢"</span>);</span><br><span class="line">                    <span class="comment">// é€€å‡ºå½“å‰å¾ªç¯ï¼Œå¦‚æœä¸º return; æˆ– throw new InterruptedException() åˆ™ç›´æ¥é€€å‡ºå½“å‰çº¿ç¨‹</span></span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InterruptedException</span>();</span><br><span class="line">                }</span><br><span class="line">                System.out.println(<span class="string">"i="</span> + (i + <span class="number">1</span>));</span><br><span class="line">            }</span><br><span class="line">            System.out.println(<span class="string">"forå¾ªç¯å¤–é¢çš„è¯­å¥"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æŠ›å‡ºå¼‚å¸¸æ–¹å¼è¯¦æƒ…ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadInterrupt</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="type">MyThread</span> <span class="variable">myThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">            myThread.start();</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            myThread.interrupt();</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> {</span><br><span class="line">        <span class="built_in">super</span>.run();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5000000</span>; i++) {</span><br><span class="line">                <span class="keyword">if</span> (interrupted()) {</span><br><span class="line">                    System.out.println(<span class="string">"çº¿ç¨‹å·²ç»åœæ­¢"</span>);</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InterruptedException</span>();</span><br><span class="line">                }</span><br><span class="line">                System.out.println(<span class="string">"i="</span> + (i + <span class="number">1</span>));</span><br><span class="line">            }</span><br><span class="line">            System.out.println(<span class="string">"forå¾ªç¯å¤–é¢çš„è¯­å¥"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            System.out.println(<span class="string">"æŠ›å‡ºå¼‚å¸¸"</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>é€šè¿‡ä¸‹é¢çš„è¿è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œçº¿ç¨‹ç»ˆäºè¢«æ­£ç¡®çš„åœæ­¢äº†ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">i=<span class="number">312961</span></span><br><span class="line">i=<span class="number">312962</span></span><br><span class="line">çº¿ç¨‹å·²ç»åœæ­¢</span><br><span class="line">æŠ›å‡ºå¼‚å¸¸</span><br><span class="line">java.lang.InterruptedException</span><br><span class="line">	at com.fun.async.test.class03.MyThread.run(ThreadInterrupt.java:<span class="number">34</span>)</span><br></pre></td></tr></tbody></table></figure>

<h2 id="åœ¨-sleep-çŠ¶æ€ä¸‹åœæ­¢çº¿ç¨‹"><a href="#åœ¨-sleep-çŠ¶æ€ä¸‹åœæ­¢çº¿ç¨‹" class="headerlink" title="åœ¨ sleep çŠ¶æ€ä¸‹åœæ­¢çº¿ç¨‹"></a>åœ¨ sleep çŠ¶æ€ä¸‹åœæ­¢çº¿ç¨‹</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SleepThreadInterrupt</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="type">MyThread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">            thread.start();</span><br><span class="line">            Thread.sleep(<span class="number">200</span>); <span class="comment">// å…ˆsleep åœ¨è°ƒç”¨ interrupt</span></span><br><span class="line">            thread.interrupt();</span><br><span class="line">            System.out.println(<span class="string">"complete!"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">            System.out.println(<span class="string">"main catch"</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>{</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> {</span><br><span class="line">            <span class="built_in">super</span>.run();</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                System.out.println(<span class="string">"run start ..."</span>);</span><br><span class="line">                Thread.sleep(<span class="number">200000</span>);</span><br><span class="line">                System.out.println(<span class="string">"run end!"</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                System.out.println(<span class="string">"åœ¨sleepä¸­åœæ­¢ï¼Œè¿›å…¥catchï¼"</span>+<span class="built_in">this</span>.isInterrupted());</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä»ä¸‹é¢çš„è¾“å‡ºç»“æœæ¥çœ‹ï¼Œå¦‚æœçº¿ç¨‹åœ¨ sleep çŠ¶æ€ä¸‹åœæ­¢ï¼Œåˆ™è¯¥çº¿ç¨‹ä¼šè¿›å…¥ catch è¯­å¥ï¼Œå¹¶ä¸”æ¸…é™¤åœæ­¢çŠ¶æ€å€¼ï¼Œå˜æˆfalseã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">run start ...</span><br><span class="line">complete!</span><br><span class="line">åœ¨sleepä¸­åœæ­¢ï¼Œè¿›å…¥<span class="keyword">catch</span>ï¼<span class="literal">false</span></span><br><span class="line">java.lang.InterruptedException: sleep interrupted</span><br><span class="line">	at java.lang.Thread.sleep(Native Method)</span><br><span class="line">	at com.fun.async.test.class03.SleepThreadInterrupt$MyThread.run(SleepThreadInterrupt.java:<span class="number">26</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
</body></html>]]></content>
      <tags>
        <tag>JUCå¹¶å‘åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>Unsafe</title>
    <url>/p/f5630658.html</url>
    <content><![CDATA[<html><head></head><body><p>ä¸»è¦æä¾›ä¸€äº›ç”¨äºæ‰§è¡Œä½çº§åˆ«ã€ä¸å®‰å…¨æ“ä½œçš„æ–¹æ³•ï¼Œå¦‚ç›´æ¥è®¿é—®ç³»ç»Ÿå†…å­˜èµ„æºã€è‡ªä¸»ç®¡ç†å†…å­˜èµ„æºç­‰ã€‚Java æ— æ³•ç›´æ¥æ“ä½œå†…å­˜ï¼ŒUnsafeç±»ç›¸å½“äºJavaçš„åé—¨ï¼Œå¯ä»¥é€šè¿‡C++æ¥æ“ä½œå†…å­˜ã€‚</p>
<p>JDKå¹¶ä¸å»ºè®®ç›´æ¥ä½¿ç”¨Unsafeç±»ï¼Œâ€œUnsafeâ€ ç±»åçš„ç”±æ¥ï¼šåœ¨ç¨‹åºä¸­è¿‡åº¦ã€ä¸æ­£ç¡®ä½¿ç”¨Unsafeç±»ä¼šä½¿å¾—ç¨‹åºå‡ºé”™çš„æ¦‚ç‡å˜å¤§ï¼Œä½¿å¾—Javaè¿™ç§å®‰å…¨çš„è¯­è¨€å˜å¾—ä¸å†â€œå®‰å…¨â€ã€‚è€Œä¸”JDKåº•å±‚æœ‰å¾ˆå¤šé’ˆå¯¹ä¸åŒå¹³å°è¿è¡Œçš„ä»£ç ï¼Œä½¿ç”¨Unsafeç±»å¯èƒ½ä¼šé€ æˆä¸€äº›è·¨å¹³å°çš„é—®é¢˜ã€‚</p>
<blockquote>
<p>Unsafeç±»æä¾›äº†å“ªäº›åŠŸèƒ½ï¼Ÿ</p>
</blockquote>
<p>DirectByteBufferï¼šåœ¨è¯¥ç±»ä¸­ä½¿ç”¨Unsafeå¯¹å†…å­˜è¿›è¡Œç®¡ç†ï¼Œæ˜¯Javaç”¨äºå®ç°å †å¤–å†…å­˜(ç›´æ¥å†…å­˜)çš„ä¸€ä¸ªé‡è¦ç±»ï¼Œé€šå¸¸ç”¨åœ¨é€šä¿¡è¿‡ç¨‹ä¸­åšç¼“å†²æ± ï¼Œå¦‚åœ¨Nettyã€MINAç­‰NIOæ¡†æ¶ä¸­åº”ç”¨å¹¿æ³›ã€‚DirectByteBufferå¯¹äºå †å¤–å†…å­˜çš„åˆ›å»ºã€ä½¿ç”¨ã€é”€æ¯ç­‰é€»è¾‘å‡ç”±Unsafeæä¾›çš„å †å¤–å†…å­˜APIæ¥å®ç°ã€‚</p>
<p>LockSupportï¼šçº¿ç¨‹è°ƒåº¦ã€‚</p>
<p>AtomicIntegerArrayï¼šæ•°ç»„æ“ä½œï¼Œé€šè¿‡è®¡ç®—å†…å­˜åœ°å€çš„åç§»é‡æ¥ç¡®å®šæ¯ä¸ªå…ƒç´ æ‰€åœ¨çš„ä½ç½®ã€‚</p>
<p>StampedLockï¼šå†…å­˜å±éšœã€‚</p>
<p>java.nio.Bitsï¼šç³»ç»Ÿç®¡ç†ï¼Œ è®¡ç®—å¾…ç”³è¯·å†…å­˜æ‰€éœ€å†…å­˜é¡µæ•°é‡çš„é™æ€æ–¹æ³•ï¼Œå…¶ä¾èµ–äºUnsafeä¸­pageSizeæ–¹æ³•è·å–ç³»ç»Ÿå†…å­˜é¡µå¤§å°å®ç°åç»­è®¡ç®—é€»è¾‘,è¯¥ç±»åœ¨ç§åŒ…ä¸­ï¼Œæ— æ³•æ­£å¸¸åˆå§‹åŒ–ã€‚</p>
<p><img src="/p/f5630658/20191211175818692.png" alt="20191211175818692"></p>
<p>åœ¨ <code>java.util.concurrent.atomic</code> åŒ…ä¸‹ç»å¤§å¤šæ•°ç±»çš„æºç ä¸­éƒ½ä½¿ç”¨åˆ°äº†Unsafeè¿™ä¸ªç±»ã€‚ä¾‹å¦‚<code>AtomicInteger</code>ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AtomicInteger</span> <span class="keyword">extends</span> <span class="title class_">Number</span> <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable {</span><br><span class="line">    <span class="comment">// setup to use Unsafe.compareAndSwapInt for updates</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> Unsafe.getUnsafe();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> valueOffset;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            valueOffset = unsafe.objectFieldOffset</span><br><span class="line">                (AtomicInteger.class.getDeclaredField(<span class="string">"value"</span>));</span><br><span class="line">        } <span class="keyword">catch</span> (Exception ex) { <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(ex); }</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨Unsafeç±»ä¸­æœ‰ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> var1 æ“ä½œçš„å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> var2 æ“ä½œå¯¹è±¡çš„å±æ€§åç§»é‡ï¼Œç”¨äºè·å–è¯¥å±æ€§åœ¨å†…å­˜ä¸­çš„å…·ä½“åœ°å€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> var4 æœŸæœ›å€¼ï¼Œè¯»å–ä¼ å…¥å¯¹è±¡oåœ¨å†…å­˜ä¸­åç§»é‡ä¸ºoffsetä½ç½®çš„å€¼ä¸æœŸæœ›å€¼expectedä½œæ¯”è¾ƒ</span></span><br><span class="line"><span class="comment"> *             ç›¸ç­‰å°±æŠŠxå€¼èµ‹å€¼ç»™offsetä½ç½®çš„å€¼ã€‚æ–¹æ³•è¿”å›true</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> var5 ç›®æ ‡å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> ä¸ç›®æ ‡çš„æœŸæœ›å€¼ä¸ç›¸ç­‰è¿”å›false</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">compareAndSwapObject</span><span class="params">(Object var1, <span class="type">long</span> var2, Object var4, Object var5)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">compareAndSwapInt</span><span class="params">(Object var1, <span class="type">long</span> var2, <span class="type">int</span> var4, <span class="type">int</span> var5)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">compareAndSwapLong</span><span class="params">(Object var1, <span class="type">long</span> var2, <span class="type">long</span> var4, <span class="type">long</span> var6)</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>ä½¿ç”¨Unsafeç±»çš„æ–¹æ³•å¯¹çº¿ç¨‹ä¸å®‰å…¨çš„add()æ–¹æ³•è¿›è¡Œä¿®æ”¹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å¹¶ä½¿ç”¨ Unsafe å¯¹è±¡ï¼š</span></span><br><span class="line"><span class="comment"> * Java æ— æ³•ç›´æ¥æ“ä½œå†…å­˜ï¼Œä½†å¯ä»¥é€šè¿‡C++æ¥æ“ä½œå†…å­˜ï¼Œ</span></span><br><span class="line"><span class="comment"> * Unsafeç±»ç›¸å½“äºJavaçš„åé—¨ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªç±»æ¥æ“ä½œå†…å­˜ã€ä¿®æ”¹å¯¹è±¡ã€æ•°ç»„å†…å­˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Unsafe unsafe;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–åˆ°valueå±æ€§åç§»é‡ï¼Œç”¨äºå®šä¹‰valueå±æ€§åœ¨å†…å­˜ä¸­çš„å…·ä½“åœ°å€</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> valueOffset;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="comment">// é€šè¿‡åå°„è·å–Unsafeå¯¹è±¡</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> Unsafe.class.getDeclaredField(<span class="string">"theUnsafe"</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// è·å–Unsafeå®ä¾‹</span></span><br><span class="line">        unsafe = (Unsafe) field.get(<span class="literal">null</span>);</span><br><span class="line">        valueOffset = unsafe.objectFieldOffset(CASDemo.class.getDeclaredField(<span class="string">"value"</span>));</span><br><span class="line">    } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯¥æ–¹æ³•ç»è¿‡ä»¥ä¸‹é—®é¢˜ä¸æ–­æ”¹è¿›</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span> {</span><br><span class="line">    <span class="comment">// 1ã€ä¸‰ä¸ªæ­¥éª¤</span></span><br><span class="line">    <span class="comment">// value++;</span></span><br><span class="line">    <span class="comment">// 2ã€å¯èƒ½ä¼šå¤±è´¥ï¼Œä¸èƒ½æ¯æ¬¡éƒ½æˆåŠŸ</span></span><br><span class="line">    <span class="comment">// unsafe.compareAndSwapInt(this, valueOffset, value, value + 1);</span></span><br><span class="line">    <span class="comment">// 3ã€CAS+æ­»å¾ªç¯é‡è¯•ï¼Œç¡®ä¿æ¯ä¸€æ¬¡éƒ½èƒ½æ“ä½œæˆåŠŸ</span></span><br><span class="line">    <span class="type">int</span> current, target;</span><br><span class="line">    <span class="keyword">do</span> {</span><br><span class="line">        <span class="comment">// å½“å‰å€¼å¯èƒ½è¢«å…¶å®ƒçº¿ç¨‹æ”¹äº†ï¼Œæ¯ä¸€æ¬¡å¾ªç¯éƒ½é‡æ–°è·å–ä¸€æ¬¡å€¼</span></span><br><span class="line">        current = unsafe.getIntVolatile(<span class="built_in">this</span>, valueOffset);</span><br><span class="line">        target = current + <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// current æ˜¯æœŸæœ›å€¼ï¼Œå¦‚æœæ¯”è¾ƒçš„æœŸæœ›å€¼ç›¸åŒåˆ™ä¿®æ”¹ä¸ºå€¼ä¸ºtargetï¼Œå¹¶è¿”å›true</span></span><br><span class="line">    } <span class="keyword">while</span> (!unsafe.compareAndSwapInt(<span class="built_in">this</span>, valueOffset, current, target));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) {</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; {</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">1000</span>; j++) {</span><br><span class="line">                add();</span><br><span class="line">            }</span><br><span class="line">        }).start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">    System.out.println(value);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</body></html>]]></content>
      <tags>
        <tag>JUCå¹¶å‘åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>JVMç±»åŠ è½½å­ç³»ç»Ÿ</title>
    <url>/p/2b3d9fc3.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="ç±»åŠ è½½å™¨"><a href="#ç±»åŠ è½½å™¨" class="headerlink" title="ç±»åŠ è½½å™¨"></a>ç±»åŠ è½½å™¨</h2><p>ç±»åŠ è½½å­ç³»ç»Ÿå°† *.class æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç±»çš„åŠ è½½åˆ†ä¸ºåŠ è½½é˜¶æ®µã€é“¾æ¥é˜¶æ®µã€åˆå§‹åŒ–é˜¶æ®µä¸‰ä¸ªé˜¶æ®µã€‚</p>
<p><img src="/p/2b3d9fc3/JVM-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F.png" alt="JVM-ç±»åŠ è½½å­ç³»ç»Ÿ"></p>
<ul>
<li><p>ç±»åŠ è½½å™¨å­ç³»ç»Ÿè´Ÿè´£ä»æ–‡ä»¶ç³»ç»Ÿæˆ–è€…ç½‘ç»œä¸­åŠ è½½Classæ–‡ä»¶ï¼Œclassæ–‡ä»¶åœ¨æ–‡ä»¶å¼€å¤´æœ‰ç‰¹å®šçš„æ–‡ä»¶æ ‡è¯†ã€‚</p>
</li>
<li><p>ClassLoaderåªè´Ÿè´£classæ–‡ä»¶çš„åŠ è½½ï¼Œè‡³äºå®ƒæ˜¯å¦å¯ä»¥è¿è¡Œï¼Œåˆ™ç”±Execution Engineå†³å®šã€‚</p>
</li>
<li><p>åŠ è½½çš„ç±»ä¿¡æ¯å­˜æ”¾äºä¸€å—ç§°ä¸ºæ–¹æ³•åŒºçš„å†…å­˜ç©ºé—´ã€‚é™¤äº†ç±»çš„ä¿¡æ¯å¤–ï¼Œæ–¹æ³•åŒºä¸­è¿˜ä¼šå­˜æ”¾è¿è¡Œæ—¶å¸¸é‡æ± ä¿¡æ¯ï¼Œå¯èƒ½è¿˜åŒ…æ‹¬å­—ç¬¦ä¸²å­—é¢é‡å’Œæ•°å­—å¸¸é‡(è¿™éƒ¨åˆ†å¸¸é‡ä¿¡æ¯æ˜¯Classæ–‡ä»¶ä¸­å¸¸é‡æ± éƒ¨åˆ†çš„å†…å­˜æ˜ å°„)</p>
</li>
</ul>
<p><img src="/p/2b3d9fc3/JVM%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8.png" alt="image-20210725220740473"></p>
<h2 id="ç±»åŠ è½½å™¨çš„åˆ†ç±»"><a href="#ç±»åŠ è½½å™¨çš„åˆ†ç±»" class="headerlink" title="ç±»åŠ è½½å™¨çš„åˆ†ç±»"></a>ç±»åŠ è½½å™¨çš„åˆ†ç±»</h2><ul>
<li><p>JVMæ”¯æŒä¸¤ç§ç±»å‹çš„ç±»åŠ è½½å™¨ï¼Œåˆ†åˆ«ä¸ºå¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰å’Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆUser-Defined ClassLoaderï¼‰ã€‚</p>
</li>
<li><p>åœ¨Javaè™šæ‹Ÿæœºä¸­ï¼Œå°†æ‰€æœ‰æ´¾ç”ŸäºæŠ½è±¡ç±»çš„ClassLoaderçš„ç±»åŠ è½½å™¨éƒ½åˆ’åˆ†ä¸ºè‡ªå®šä¹‰ç±»åŠ è½½å™¨ã€‚</p>
</li>
<li><p>æ— è®ºç±»åŠ è½½å™¨çš„ç±»å‹å¦‚ä½•åˆ’åˆ†ï¼Œåœ¨ç¨‹åºä¸­æˆ‘ä»¬æœ€å¸¸è§çš„ç±»åŠ è½½å™¨å§‹ç»ˆåªæœ‰3ä¸ªã€‚</p>
</li>
</ul>
<p>åœ¨ sun.misc.Launcherç±»ä¸­ï¼Œæœ‰AppClassLoaderã€ExtClassLoader ä¸¤ä¸ªå†…éƒ¨ç±»ï¼Œéƒ½é—´æ¥çš„ç»§æ‰¿äº†ClassLoaderï¼Œæ‰€ä»¥éƒ½å±äºè‡ªå®šä¹‰ç±»åŠ è½½å™¨ã€‚</p>
<h3 id="Bootstrap-ClassLoader"><a href="#Bootstrap-ClassLoader" class="headerlink" title="Bootstrap ClassLoader"></a>Bootstrap ClassLoader</h3><p>å¯åŠ¨ç±»åŠ è½½å™¨ã€å¼•å¯¼ç±»åŠ è½½å™¨ã€‚</p>
<p>ï¼ˆ1ï¼‰BootstrapClassLoaderæ˜¯ä½¿ç”¨C++å®ç°çš„ï¼ŒåµŒå¥—åœ¨JVMçš„å†…éƒ¨ï¼Œæ‰€ä»¥å…¶å¹¶ä¸ç»§æ‰¿è‡ª java.lang.ClassLoaderï¼Œæ²¡æœ‰çˆ¶åŠ è½½å™¨ã€‚</p>
<p>ï¼ˆ2ï¼‰å®ƒç”¨æ¥åŠ è½½Javaçš„æ ¸å¿ƒåº“ï¼ˆ\jre\lib\rt.jarã€resources.jaræˆ–sun.boot.class.pathè·¯å¾„ä¸‹çš„å†…å®¹ï¼‰ï¼Œç”¨äºæä¾›JVMè‡ªèº«éœ€è¦çš„ç±»ã€‚</p>
<p>ï¼ˆ3ï¼‰åŠ è½½æ‰©å±•ç±»å’Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼Œå¹¶æŒ‡å®šä»–ä»¬çš„çˆ¶ç±»åŠ è½½å™¨ã€‚</p>
<p>ï¼ˆ4ï¼‰å‡ºäºå®‰å…¨è€ƒè™‘ï¼ŒBootstrapå¯åŠ¨ç±»åŠ è½½å™¨åªåŠ è½½åŒ…åä¸º javaã€javaxã€sunç­‰å¼€å¤´çš„ç±»ã€‚</p>
<h3 id="Extension-ClassLoader"><a href="#Extension-ClassLoader" class="headerlink" title="Extension ClassLoader"></a>Extension ClassLoader</h3><p>æ‰©å±•ç±»åŠ è½½å™¨ã€‚</p>
<p>ï¼ˆ1ï¼‰Javaè¯­è¨€ç¼–å†™ï¼Œç”±sun. misc. LauncherSExtClassLoaderå®ç°ã€‚</p>
<p>ï¼ˆ2ï¼‰æ´¾ç”ŸäºClassLoaderç±»ã€‚</p>
<p>ï¼ˆ3ï¼‰çˆ¶ç±»åŠ è½½å™¨æ˜¯Bootstrap ClassLoaderã€‚</p>
<p>ï¼ˆ4ï¼‰ä»java.ext.dirsç³»ç»Ÿå±æ€§æ‰€æŒ‡å®šçš„ç›®å½•ä¸­åŠ è½½ç±»åº“ï¼Œæˆ–ä»JDKçš„å®‰è£…ç›®å½•çš„ jre/lib/ext å­ç›®å½•ï¼ˆæ‰©å±•ç›®å½•ï¼‰åŠ è½½ç±»åº“ã€‚å¦‚æœç”¨æˆ·åˆ›å»ºçš„ JAR æ”¾åœ¨æ­¤ç›®å½•ä¸‹ï¼Œä¹Ÿä¼šè‡ªåŠ¨ç”±æ‰©å±•ç±»åŠ è½½å™¨åŠ è½½ã€‚</p>
<h3 id="Application-ClassLoader"><a href="#Application-ClassLoader" class="headerlink" title="Application ClassLoader"></a>Application ClassLoader</h3><p>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ã€ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚</p>
<p>ï¼ˆ1ï¼‰Java è¯­è¨€ç¼–å†™ï¼Œç”± sun. misc . Launcher$AppClassLoader å®ç°ã€‚</p>
<p>ï¼ˆ2ï¼‰æ´¾ç”Ÿäº ClassLoader ç±»ã€‚</p>
<p>ï¼ˆ3ï¼‰å®ƒè´Ÿè´£åŠ è½½ç¯å¢ƒå˜é‡classpathæˆ–ç³»ç»Ÿå±æ€§ java. class.path æŒ‡å®šè·¯å¾„ä¸‹çš„ç±»åº“ã€‚</p>
<p>ï¼ˆ4ï¼‰è¯¥ç±»åŠ è½½æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼Œä¸€ èˆ¬æ¥è¯´ï¼ŒJavaåº”ç”¨çš„ç±»éƒ½æ˜¯ç”±å®ƒæ¥å®ŒæˆåŠ è½½ã€‚</p>
<p>ï¼ˆ5ï¼‰é€šè¿‡ClassLoader #getSystemClassLoader ()æ–¹æ³•å¯ä»¥è·å–åˆ°è¯¥ç±»åŠ è½½å™¨ã€‚</p>
<h3 id="ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨"><a href="#ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨" class="headerlink" title="ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨"></a>ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h3><p>åœ¨Javaçš„æ—¥å¸¸åº”ç”¨ç¨‹åºå¼€å‘ä¸­ï¼Œç±»çš„åŠ è½½å‡ ä¹æ˜¯ç”±ä¸Šè¿°3ç§ç±»åŠ è½½å™¨ç›¸äº’é…åˆæ‰§è¡Œçš„ï¼Œåœ¨å¿…è¦æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œæ¥å®šåˆ¶ç±»çš„åŠ è½½æ–¹å¼ã€‚</p>
<p>è‡ªå®šä¹‰ç±»åŠ è½½å™¨å¯ä»¥å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<p>ï¼ˆ1ï¼‰éš”ç¦»ç±»åŠ è½½å™¨ã€‚ä¾‹å¦‚ï¼Œå¼•å…¥å¤šä¸ªjaråŒ…æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°åŒ…åç±»åå®Œå…¨ä¸€è‡´çš„æƒ…å†µï¼Œå¯¼è‡´å†²çªã€‚</p>
<p>ï¼ˆ2ï¼‰ä¿®æ”¹ç±»åŠ è½½çš„æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨éœ€è¦æŸä¸ªç±»çš„æ—¶å€™ï¼Œæ‰ä¸»åŠ¨åŠ è½½è¿™ä¸ªç±»ã€‚</p>
<p>ï¼ˆ3ï¼‰æ‰©å±•åŠ è½½æºã€‚ä¾‹å¦‚ï¼Œä»æ•°æ®åº“åŠ è½½ã€‚</p>
<p>ï¼ˆ4ï¼‰é˜²æ­¢æºç æ³„éœ²ã€‚ä¾‹å¦‚ï¼Œå¯¹è¿›è¡ŒåŠ å¯†çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨è¿›è¡Œè§£å¯†åå†åŠ è½½åˆ°JVMã€‚</p>
<h2 id="å…³äºClassLoader"><a href="#å…³äºClassLoader" class="headerlink" title="å…³äºClassLoader"></a>å…³äºClassLoader</h2><h3 id="ClassLoaderç±»çš„å®šä¹‰"><a href="#ClassLoaderç±»çš„å®šä¹‰" class="headerlink" title="ClassLoaderç±»çš„å®šä¹‰"></a>ClassLoaderç±»çš„å®šä¹‰</h3><p>Classloaderç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå…¶åæ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½ç»§æ‰¿è‡ªClassLoaderï¼ˆä¸åŒ…æ‹¬å¯åŠ¨ç±»åŠ è½½å™¨ï¼‰ã€‚</p>
<p><img src="/p/2b3d9fc3/ClassLoader%E7%B1%BB%E7%9A%84%E6%96%B9%E6%B3%95.png" alt="img"></p>
<h3 id="ç»§æ‰¿å…³ç³»"><a href="#ç»§æ‰¿å…³ç³»" class="headerlink" title="ç»§æ‰¿å…³ç³»"></a>ç»§æ‰¿å…³ç³»</h3><p>ClassLoaderçš„ç»§æ‰¿å…³ç³»å¦‚ä¸‹ï¼Œsun.misc.Launcher æ˜¯ä¸€ä¸ªJavaè™šæ‹Ÿæœºçš„å…¥å£åº”ç”¨ã€‚</p>
<p><img src="/p/2b3d9fc3/ClassLoader%E7%9A%84%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB.png" alt="img"></p>
<h3 id="è·å–ClassLoaderçš„é€”å¾„"><a href="#è·å–ClassLoaderçš„é€”å¾„" class="headerlink" title="è·å–ClassLoaderçš„é€”å¾„"></a>è·å–ClassLoaderçš„é€”å¾„</h3><table>
<thead>
<tr>
<th>æ–¹å¼</th>
<th>è°ƒç”¨æ–¹æ³•</th>
</tr>
</thead>
<tbody><tr>
<td>è·å–å½“å‰ç±»çš„classLoader</td>
<td>Clazz.getClassLoader()</td>
</tr>
<tr>
<td>è·å–å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡çš„classLoader</td>
<td>Thread.currentThread().getContextClassLoader()</td>
</tr>
<tr>
<td>è·å–ç³»ç»Ÿçš„classLoader</td>
<td>ClassLoader.getSystemClassloader()</td>
</tr>
<tr>
<td>è·å–è°ƒç”¨è€…çš„classLoader</td>
<td>DriverManager.getCallerClassLoader()</td>
</tr>
</tbody></table>
<h2 id="ç±»çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#ç±»çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç±»çš„ç”Ÿå‘½å‘¨æœŸ"></a>ç±»çš„ç”Ÿå‘½å‘¨æœŸ</h2><p><img src="/p/2b3d9fc3/JVM-%E7%B1%BB%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png" alt="image-20210719225706738"></p>
<blockquote>
<p>Javaå¦‚ä½•çŸ¥é“æˆ‘ä»¬çš„ç±»åœ¨å“ªé‡Œï¼Ÿ</p>
</blockquote>
<p>åœ¨JDK\binç›®å½•æœ‰jpsã€jcmdä¸¤ä¸ªå‘½ä»¤ï¼Œjpsç”¨äºæŸ¥çœ‹å½“å‰çš„Javaè¿›ç¨‹çš„ä¸€äº›ç®€å•æƒ…å†µï¼Œjcmdå¯ç”¨äºæŸ¥çœ‹å †åˆ†æã€ç³»ç»Ÿpropertieså†…å®¹ã€å †å¤–å†…å­˜ä¿¡æ¯ç­‰ã€‚</p>
<p>é€šè¿‡jcmdæŸ¥çœ‹VM.system.propertieså³å¯æŸ¥çœ‹åˆ°å½“å‰Javaç±»çš„æ‰€åœ¨ä½ç½®ã€‚</p>
<h3 id="Loadingï¼ˆåŠ è½½é˜¶æ®µï¼‰"><a href="#Loadingï¼ˆåŠ è½½é˜¶æ®µï¼‰" class="headerlink" title="Loadingï¼ˆåŠ è½½é˜¶æ®µï¼‰"></a>Loadingï¼ˆåŠ è½½é˜¶æ®µï¼‰</h3><p>åŠ è½½â€é˜¶æ®µæ˜¯â€œç±»åŠ è½½â€ç”Ÿå‘½å‘¨æœŸçš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œåœ¨åŠ è½½é˜¶æ®µï¼ŒJVMè¦å®Œæˆä¸‹é¢ä¸‰ä»¶äº‹ï¼š</p>
<p>â‘ ã€é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚</p>
<p>â‘¡ã€å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚</p>
<p>â‘¢ã€åœ¨Javaå †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™äº›æ•°æ®çš„è®¿é—®å…¥å£ã€‚</p>
<p>PSï¼šåŠ è½½ *.class çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</p>
<ul>
<li>ä»æœ¬åœ°ç³»ç»Ÿä¸­ç›´æ¥åŠ è½½</li>
<li>é€šè¿‡ç½‘ç»œè·å–ï¼Œå¦‚Web Applet</li>
<li>ä» ZIP åŒ…ä¸­è¯»å–ï¼Œæˆä¸ºæ—¥åçš„ JARã€EARã€WAR æ ¼å¼çš„åŸºç¡€</li>
<li>è¿è¡Œæ—¶è®¡ç®—ç”Ÿæˆï¼Œä½¿ç”¨æœ€å¤šçš„æ˜¯åŠ¨æ€ä»£ç†æŠ€æœ¯</li>
<li>ä»ä¸“æœ‰æ•°æ®åº“ä¸­æå–.classæ–‡ä»¶ï¼Œæ¯”è¾ƒå°‘è§</li>
<li>ä»åŠ å¯†æ–‡ä»¶ä¸­è·å–ï¼Œå…¸å‹çš„é˜²classæ–‡ä»¶è¢«åç¼–è¯‘çš„ä¿æŠ¤æªæ–½</li>
</ul>
<h3 id="Linkingï¼ˆé“¾æ¥é˜¶æ®µï¼‰"><a href="#Linkingï¼ˆé“¾æ¥é˜¶æ®µï¼‰" class="headerlink" title="Linkingï¼ˆé“¾æ¥é˜¶æ®µï¼‰"></a>Linkingï¼ˆé“¾æ¥é˜¶æ®µï¼‰</h3><h4 id="ï¼ˆ1ï¼‰Verifyï¼ˆéªŒè¯ï¼‰"><a href="#ï¼ˆ1ï¼‰Verifyï¼ˆéªŒè¯ï¼‰" class="headerlink" title="ï¼ˆ1ï¼‰Verifyï¼ˆéªŒè¯ï¼‰"></a>ï¼ˆ1ï¼‰Verifyï¼ˆéªŒè¯ï¼‰</h4><ul>
<li><p>ç›®çš„åœ¨äºç¡®ä¿ Class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œä¿è¯è¢«åŠ è½½ç±»çš„æ­£ç¡®æ€§ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚</p>
</li>
<li><p>ä¸»è¦åŒ…æ‹¬å››ä¸ªæ–¹é¢çš„æ£€æŸ¥ï¼šæ–‡ä»¶æ ¼å¼éªŒè¯ã€å…ƒæ•°æ®éªŒè¯ã€å­—èŠ‚ç éªŒè¯ã€ç¬¦å·å¼•ç”¨éªŒè¯ã€‚</p>
</li>
</ul>
<h5 id="â‘ ã€æ–‡ä»¶æ ¼å¼éªŒè¯"><a href="#â‘ ã€æ–‡ä»¶æ ¼å¼éªŒè¯" class="headerlink" title="â‘ ã€æ–‡ä»¶æ ¼å¼éªŒè¯"></a>â‘ ã€æ–‡ä»¶æ ¼å¼éªŒè¯</h5><p>ã€€ã€€æ ¡éªŒå­—èŠ‚æµæ˜¯å¦ç¬¦åˆClassæ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼Œå¹¶ä¸”èƒ½å¤Ÿè¢«å½“å‰ç‰ˆæœ¬çš„è™šæ‹Ÿæœºå¤„ç†ã€‚</p>
<p>ã€€ã€€ä¸€ã€æ˜¯å¦ä»¥é­”æ•° 0xCAFEBABE å¼€å¤´ã€‚</p>
<p>ã€€ã€€äºŒã€ä¸»ã€æ¬¡ç‰ˆæœ¬å·æ˜¯å¦æ˜¯å½“å‰è™šæ‹Ÿæœºå¤„ç†èŒƒå›´ä¹‹å†…ã€‚</p>
<p>ã€€ã€€ä¸‰ã€å¸¸é‡æ± çš„å¸¸é‡ä¸­æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒçš„å¸¸é‡ç±»å‹ï¼ˆæ£€æŸ¥å¸¸é‡tagæ ‡å¿—ï¼‰</p>
<p>ã€€ã€€å››ã€æŒ‡å‘å¸¸é‡çš„å„ç§ç´¢å¼•å€¼ä¸­æ˜¯å¦æœ‰æŒ‡å‘ä¸å­˜åœ¨çš„å¸¸é‡æˆ–ä¸ç¬¦åˆç±»å‹çš„å¸¸é‡ã€‚</p>
<p>ã€€ã€€äº”ã€CONSTANT_Utf8_info å‹çš„å¸¸é‡ä¸­æ˜¯å¦æœ‰ä¸ç¬¦åˆ UTF8 ç¼–ç çš„æ•°æ®ã€‚</p>
<p>ã€€ã€€å…­ã€Class æ–‡ä»¶ä¸­å„ä¸ªéƒ¨åˆ†åŠæ–‡ä»¶æœ¬èº«æ˜¯å¦æœ‰è¢«åˆ é™¤çš„æˆ–é™„åŠ çš„å…¶ä»–ä¿¡æ¯ã€‚</p>
<p>ã€€ã€€ä»¥ä¸Šæ˜¯ä¸€éƒ¨åˆ†æ ¡éªŒå†…å®¹ï¼Œå½“ç„¶è¿œä¸æ­¢è¿™äº›ã€‚ç»è¿‡è¿™äº›æ ¡éªŒåï¼Œå­—èŠ‚æµæ‰ä¼šè¿›å…¥å†…å­˜çš„æ–¹æ³•åŒºä¸­å­˜å‚¨ï¼Œæ¥ä¸‹æ¥åé¢çš„ä¸‰ä¸ªé˜¶æ®µæ ¡éªŒéƒ½æ˜¯åŸºäºæ–¹æ³•åŒºçš„å­˜å‚¨ç»“æ„è¿›è¡Œçš„ã€‚</p>
<h5 id="â‘¡ã€å…ƒæ•°æ®éªŒè¯"><a href="#â‘¡ã€å…ƒæ•°æ®éªŒè¯" class="headerlink" title="â‘¡ã€å…ƒæ•°æ®éªŒè¯"></a>â‘¡ã€å…ƒæ•°æ®éªŒè¯</h5><p>ã€€ã€€ç¬¬äºŒä¸ªé˜¶æ®µä¸»è¦æ˜¯å¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆJavaè¯­è¨€è§„èŒƒè¦æ±‚ã€‚</p>
<p>ã€€ã€€ä¸€ã€è¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»ï¼ˆé™¤äº†java.lang.Object ç±»ä¹‹å¤–ï¼Œæ‰€æœ‰çš„ç±»éƒ½åº”å½“æœ‰çˆ¶ç±»ï¼‰ã€‚</p>
<p>ã€€ã€€äºŒã€è¿™ä¸ªç±»çš„çˆ¶ç±»æ˜¯å¦ç»§æ‰¿äº†ä¸å…è®¸è¢«ç»§æ‰¿çš„ç±»ï¼ˆè¢«finalä¿®é¥°çš„ç±»ï¼‰ã€‚</p>
<p>ã€€ã€€ä¸‰ã€å¦‚æœè¿™ä¸ªç±»ä¸æ˜¯æŠ½è±¡ç±»ï¼Œæ˜¯å¦å®ç°äº†å…¶çˆ¶ç±»æˆ–æ¥å£ä¹‹ä¸­è¦æ±‚å®ç°çš„æ‰€æœ‰æ™®é€šæ–¹æ³•ã€‚</p>
<p>ã€€ã€€å››ã€ç±»ä¸­çš„å­—æ®µã€æ–¹æ³•æ˜¯å¦ä¸çˆ¶ç±»äº§ç”Ÿäº†çŸ›ç›¾ï¼ˆä¾‹å¦‚è¦†ç›–äº†çˆ¶ç±»çš„finalå­—æ®µã€æˆ–è€…å‡ºç°ä¸ç¬¦åˆè§„åˆ™çš„é‡è½½ï¼‰</p>
<h5 id="â‘¢ã€å­—èŠ‚ç éªŒè¯"><a href="#â‘¢ã€å­—èŠ‚ç éªŒè¯" class="headerlink" title="â‘¢ã€å­—èŠ‚ç éªŒè¯"></a>â‘¢ã€å­—èŠ‚ç éªŒè¯</h5><p>ã€€ã€€ç¬¬ä¸‰ä¸ªé˜¶æ®µå­—èŠ‚ç éªŒè¯æ˜¯æ•´ä¸ªéªŒè¯é˜¶æ®µä¸­æœ€å¤æ‚çš„ï¼Œä¸»è¦æ˜¯è¿›è¡Œæ•°æ®æµå’Œæ§åˆ¶æµåˆ†æã€‚è¯¥é˜¶æ®µå°†å¯¹ç±»çš„æ–¹æ³•è¿›è¡Œåˆ†æï¼Œä¿è¯è¢«æ ¡éªŒçš„æ–¹æ³•åœ¨è¿è¡Œæ—¶ä¸ä¼šåšå‡ºå±å®³è™šæ‹Ÿæœºå®‰å…¨çš„è¡Œä¸ºã€‚</p>
<p>ã€€ã€€ä¸€ã€ä¿è¯ä»»æ„æ—¶åˆ»æ“ä½œæ•°æ ˆä¸­çš„æ•°æ®ç±»å‹ä¸æŒ‡ä»¤ä»£ç åºåˆ—éƒ½èƒ½é…åˆå·¥ä½œã€‚ä¾‹å¦‚ä¸ä¼šå‡ºç°åœ¨æ“ä½œæ•°æ ˆä¸­æ”¾ç½®äº†ä¸€ä¸ª int ç±»å‹çš„æ•°æ®ï¼Œä½¿ç”¨æ—¶å´æŒ‰ç…§ long ç±»å‹æ¥åŠ è½½åˆ°æœ¬åœ°å˜é‡è¡¨ä¸­ã€‚</p>
<p>ã€€ã€€äºŒã€ä¿è¯è·³è½¬æŒ‡ä»¤ä¸ä¼šè·³è½¬åˆ°æ–¹æ³•ä½“ä»¥å¤–çš„å­—èŠ‚ç æŒ‡ä»¤ä¸­ã€‚</p>
<p>ã€€ã€€ä¸‰ã€ä¿è¯æ–¹æ³•ä½“ä¸­çš„ç±»å‹è½¬æ¢æ˜¯æœ‰æ•ˆçš„ã€‚æ¯”å¦‚æŠŠä¸€ä¸ªå­ç±»å¯¹è±¡èµ‹å€¼ç»™çˆ¶ç±»æ•°æ®ç±»å‹ï¼Œè¿™æ˜¯å®‰å…¨çš„ã€‚ä½†æ˜¯æŠŠçˆ¶ç±»å¯¹è±¡èµ‹å€¼ç»™å­ç±»æ•°æ®ç±»å‹ï¼Œç”šè‡³èµ‹å€¼ç»™å®Œå…¨ä¸ç›¸å¹²çš„ç±»å‹ï¼Œè¿™å°±æ˜¯ä¸åˆæ³•çš„ã€‚</p>
<h5 id="â‘£ã€ç¬¦å·å¼•ç”¨éªŒè¯"><a href="#â‘£ã€ç¬¦å·å¼•ç”¨éªŒè¯" class="headerlink" title="â‘£ã€ç¬¦å·å¼•ç”¨éªŒè¯"></a>â‘£ã€ç¬¦å·å¼•ç”¨éªŒè¯</h5><p>ã€€ã€€ç¬¦å·å¼•ç”¨éªŒè¯ä¸»è¦æ˜¯å¯¹ç±»è‡ªèº«ä»¥å¤–ï¼ˆå¸¸é‡æ± ä¸­çš„å„ç§ç¬¦å·å¼•ç”¨ï¼‰çš„ä¿¡æ¯è¿›è¡ŒåŒ¹é…æ€§çš„æ ¡éªŒï¼Œé€šå¸¸éœ€è¦æ ¡éªŒå¦‚ä¸‹å†…å®¹ï¼š</p>
<p>ã€€ã€€ä¸€ã€ç¬¦å·å¼•ç”¨ä¸­é€šè¿‡å­—ç¬¦ä¸²æè¿°çš„å…¨é™å®šåæ˜¯å¦èƒ½å¤Ÿæ‰¾åˆ°ç›¸åº”çš„ç±»ã€‚</p>
<p>ã€€ã€€äºŒã€åœ¨æŒ‡å®šç±»ä¸­æ˜¯å¦å­˜åœ¨ç¬¦åˆæ–¹æ³•çš„å­—æ®µæè¿°ç¬¦åŠç®€å•åç§°æ‰€æè¿°çš„æ–¹æ³•å’Œå­—æ®µã€‚</p>
<p>ã€€ã€€ä¸‰ã€ç¬¦å·å¼•ç”¨ä¸­çš„ç±»ã€å­—æ®µå’Œæ–¹æ³•çš„è®¿é—®æ€§ï¼ˆprivateã€protectedã€publicã€defaultï¼‰æ˜¯å¦å¯ä»¥è¢«å½“å‰ç±»è®¿é—®ã€‚</p>
<h4 id="ï¼ˆ2ï¼‰Prepareï¼ˆå‡†å¤‡ï¼‰"><a href="#ï¼ˆ2ï¼‰Prepareï¼ˆå‡†å¤‡ï¼‰" class="headerlink" title="ï¼ˆ2ï¼‰Prepareï¼ˆå‡†å¤‡ï¼‰"></a>ï¼ˆ2ï¼‰Prepareï¼ˆå‡†å¤‡ï¼‰</h4><ul>
<li>å‡†å¤‡é˜¶æ®µæ˜¯æ­£å¼ä¸º<strong>ç±»å˜é‡</strong>åˆ†é…å†…å­˜å¹¶è®¾ç½®<strong>ç±»å˜é‡</strong>åˆå§‹å€¼çš„é˜¶æ®µï¼Œè¿™äº›å†…å­˜æ˜¯åœ¨æ–¹æ³•åŒºä¸­è¿›è¡Œåˆ†é…ã€‚</li>
</ul>
<p><img src="/p/2b3d9fc3/Java%E4%B8%AD%E5%9F%BA%E6%9C%AC%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%88%9D%E5%A7%8B%E5%80%BC.png" alt="Javaä¸­åŸºæœ¬çš„æ•°æ®ç±»å‹åˆå§‹å€¼"></p>
<ul>
<li>è¿™é‡Œä¸åŒ…å«ç”¨ final ä¿®é¥°çš„staticï¼Œå› ä¸º final åœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¼šåˆ†é…äº†ï¼Œå‡†å¤‡é˜¶æ®µä¼šæ˜¾å¼åˆå§‹åŒ–ã€‚</li>
<li>è¿™é‡Œä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆ†é…åˆå§‹åŒ–ï¼Œç±»å˜é‡ä¼šåˆ†é…åœ¨æ–¹æ³•åŒºä¸­ï¼Œè€Œå®ä¾‹å˜é‡æ˜¯ä¼šéšç€å¯¹è±¡ä¸€èµ·åˆ†é…åˆ°Javaå †ä¸­ã€‚</li>
</ul>
<h4 id="ï¼ˆ3ï¼‰Resolveï¼ˆè§£æï¼‰"><a href="#ï¼ˆ3ï¼‰Resolveï¼ˆè§£æï¼‰" class="headerlink" title="ï¼ˆ3ï¼‰Resolveï¼ˆè§£æï¼‰"></a>ï¼ˆ3ï¼‰Resolveï¼ˆè§£æï¼‰</h4><ul>
<li>å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚</li>
<li>äº‹å®ä¸Šï¼Œè§£ææ“ä½œå¾€å¾€ä¼šä¼´éšç€JVMåœ¨æ‰§è¡Œå®Œåˆå§‹åŒ–ä¹‹ååœ¨æ‰§è¡Œã€‚</li>
<li>ç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referencesï¼‰ï¼šç¬¦å·å¼•ç”¨ä»¥ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦ä½¿ç”¨æ—¶èƒ½æ— æ­§ä¹‰çš„å®šä½åˆ°ç›®æ ‡å³å¯ã€‚ç¬¦å·å¼•ç”¨ä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€æ— å…³ï¼Œå¼•ç”¨çš„ç›®æ ‡ä¸ä¸€å®šå·²ç»åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</li>
<li>ç›´æ¥å¼•ç”¨ï¼ˆDirect Referencesï¼‰ï¼šç›´æ¥å¼•ç”¨å¯ä»¥æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚ç›´æ¥å¼•ç”¨æ˜¯ä¸è™šæ‹Ÿæœºå®ç°å†…å­˜å¸ƒå±€ç›¸å…³çš„ï¼ŒåŒä¸€ä¸ªç¬¦å·å¼•ç”¨åœ¨ä¸åŒè™šæ‹Ÿæœºå®ä¾‹ä¸Šç¿»è¯‘å‡ºæ¥çš„ç›´æ¥å¼•ç”¨ä¸€èˆ¬ä¸ä¼šç›¸åŒã€‚å¦‚æœæœ‰äº†ç›´æ¥å¼•ç”¨ï¼Œé‚£ä¹ˆå¼•ç”¨çš„ç›®æ ‡å¿…å®šå·²ç»åœ¨å†…å­˜ä¸­å­˜åœ¨ã€‚</li>
<li>è§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•å››ç±»ç¬¦å·å¼•ç”¨ï¼Œåˆ†åˆ«å¯¹åº”äºå¸¸é‡æ± çš„ CONSTANT_Class_infoã€CONSTANT_Fieldref_infoã€CONSTANT_Methodref_infoã€CONSTANTS_InterfaceMethodref_info å››ç§ç±»å‹å¸¸é‡ã€‚</li>
</ul>
<h3 id="Initializationï¼ˆåˆå§‹åŒ–é˜¶æ®µï¼‰"><a href="#Initializationï¼ˆåˆå§‹åŒ–é˜¶æ®µï¼‰" class="headerlink" title="Initializationï¼ˆåˆå§‹åŒ–é˜¶æ®µï¼‰"></a>Initializationï¼ˆåˆå§‹åŒ–é˜¶æ®µï¼‰</h3><p>åˆå§‹åŒ–é˜¶æ®µæ˜¯ç±»åŠ è½½é˜¶æ®µçš„æœ€åä¸€æ­¥ï¼Œåˆ°äº†åˆå§‹åŒ–é˜¶æ®µï¼Œç±»å˜é‡å·²ç»è¢«èµ‹å€¼è¿‡åˆå§‹å€¼äº†ï¼Œå¼€å§‹çœŸæ­£æ‰§è¡Œç±»ä¸­å®šä¹‰çš„Javaç¨‹åºä»£ç ï¼ˆæˆ–è€…è¯´æ˜¯å­—èŠ‚ç ï¼‰ï¼Œæ¢å¥è¯æ¥è¯´ï¼Œ<strong>åˆå§‹åŒ–é˜¶æ®µæ˜¯æ‰§è¡Œç±»æ„é€ å™¨&lt;clinit&gt;() æ–¹æ³•çš„è¿‡ç¨‹</strong>ã€‚</p>
<ul>
<li>æ­¤æ–¹æ³•ä¸éœ€å®šä¹‰ï¼Œæ˜¯javacç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€ä»£ç å—ä¸­çš„è¯­å¥åˆå¹¶è€Œæ¥ã€‚</li>
<li>æ„é€ å™¨æ–¹æ³•ä¸­æŒ‡ä»¤æŒ‰è¯­å¥åœ¨æºæ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºæ‰§è¡Œã€‚</li>
<li>&lt;clinit&gt;() ä¸åŒäºç±»çš„æ„é€ å™¨ã€‚å®ƒä¸éœ€è¦æ˜¾å¼çš„è°ƒç”¨çˆ¶ç±»æ„é€ å™¨ï¼Œè™šæ‹Ÿæœºä¼šä¿è¯åœ¨å­ç±»çš„&lt;init&gt;()æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œçˆ¶ç±»çš„&lt;init&gt;()æ–¹æ³•å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚å› æ­¤è™šæ‹Ÿæœºä¸­ç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œçš„&lt;init&gt;()æ–¹æ³•çš„ç±»è‚¯å®šæ˜¯ java.lang.Objectã€‚</li>
<li>è™šæ‹Ÿæœºå¿…é¡»ä¿è¯ä¸€ä¸ªç±»çš„  &lt;clinit&gt;()  æ–¹æ³•åœ¨å¤šçº¿ç¨‹ä¸‹è¢«åŒæ­¥åŠ é”ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶å»åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆåªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªç±»çš„&lt;clinit&gt;() æ–¹æ³•ï¼Œå…¶ä»–çš„çº¿ç¨‹éƒ½éœ€è¦é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æ´»åŠ¨çº¿ç¨‹æ‰§è¡Œ&lt;clinit&gt;() æ–¹æ³•å®Œæ¯•ã€‚å¦‚æœåœ¨ä¸€ä¸ªç±»çš„&lt;clinit&gt;() æ–¹æ³•ä¸­æœ‰å¾ˆè€—æ—¶çš„æ“ä½œï¼Œé‚£ä¹ˆå¯èƒ½é€ æˆå¤šä¸ªè¿›ç¨‹çš„é˜»å¡ã€‚</li>
</ul>
<h2 id="ç±»ä¸ä¼šé‡å¤åŠ è½½"><a href="#ç±»ä¸ä¼šé‡å¤åŠ è½½" class="headerlink" title="ç±»ä¸ä¼šé‡å¤åŠ è½½"></a>ç±»ä¸ä¼šé‡å¤åŠ è½½</h2><p><img src="/p/2b3d9fc3/JVM%E7%B1%BB%E4%B8%8D%E4%BC%9A%E9%87%8D%E5%A4%8D%E5%8A%A0%E8%BD%BD.png" alt="image-20210725224111099"></p>
<h2 id="ç±»çš„å¸è½½"><a href="#ç±»çš„å¸è½½" class="headerlink" title="ç±»çš„å¸è½½"></a>ç±»çš„å¸è½½</h2><p>æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶å°±ä¼šè¢«å¸è½½ï¼š</p>
<p>1ã€è¯¥Classæ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«GCï¼›</p>
<p>2ã€åŠ è½½è¯¥ç±»çš„ClassLoaderå®ä¾‹å·²ç»è¢«GCï¼›</p>
<p>éªŒè¯æ–¹å¼ï¼šJVMå¯åŠ¨ä¸­å¢åŠ  <code>-verbose:class</code>å‚æ•°ï¼Œè¾“å‡ºç±»åŠ è½½å’Œå¸è½½çš„æ—¥å¿—ä¿¡æ¯ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVMåˆ†åŒºä¸ç¨‹åºè¿è¡ŒåŸç†</title>
    <url>/p/df88bc10.html</url>
    <content><![CDATA[<html><head></head><body><p>classæ–‡ä»¶åŒ…å«JAVAç¨‹åºæ‰§è¡Œçš„å­—èŠ‚ç ;æ•°æ®ä¸¥æ ¼æŒ‰ç…§æ ¼å¼ç´§å‡‘æ’åˆ—åœ¨classæ–‡ä»¶ä¸­çš„äºŒè¿›åˆ¶æµï¼Œä¸­é—´æ— ä»»ä½•åˆ†éš”ç¬¦;æ–‡ä»¶å¼€å¤´æœ‰ä¸€ä¸ª0xcafebabe(16è¿›åˆ¶)ç‰¹æ®Šçš„ä¸€ä¸ªæ ‡å¿—ã€‚</p>
<p>å­˜æ”¾æœ‰ï¼šJDKç‰ˆæœ¬ã€è®¿é—®æ ‡å¿—ã€å¸¸é‡æ± ã€å½“å‰ç±»ã€è¶…çº§ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•ã€å±æ€§ï¼Œè¿™äº›æ–‡ä»¶æ˜¯æœ‰å¤æ‚æ ¼å¼çš„ï¼Œä¸“é—¨ç»™JVMè¯»é‡Œé¢çš„å†…å®¹ï¼Œå¯ä»¥å€ŸåŠ©å·¥å…·æŸ¥çœ‹å­—èŠ‚ç æ–‡ä»¶ã€‚</p>
<h2 id="JVMåˆ†åŒº"><a href="#JVMåˆ†åŒº" class="headerlink" title="JVMåˆ†åŒº"></a>JVMåˆ†åŒº</h2><p><img src="/p/df88bc10/image-20220306165204228.png" alt="image-20220306165204228"></p>
<p>JDK1.8åœ¨æ–¹æ³•åŒºä¸­æœ‰è¾ƒå¤§çš„æ”¹åŠ¨ï¼š</p>
<ul>
<li>ç§»é™¤äº†æ°¸ä¹…ä»£ï¼ˆPermGenï¼‰ï¼Œæ›¿æ¢ä¸ºå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰ï¼›</li>
<li>æ°¸ä¹…ä»£ä¸­çš„ class metadata è½¬ç§»åˆ°äº† native memoryï¼ˆæœ¬åœ°å†…å­˜ï¼Œè€Œä¸æ˜¯è™šæ‹Ÿæœºï¼‰ï¼›</li>
<li>æ°¸ä¹…ä»£ä¸­çš„ interned Strings å’Œ class static variables è½¬ç§»åˆ°äº† Java heapï¼›</li>
<li>æ°¸ä¹…ä»£å‚æ•° ï¼ˆPermSize MaxPermSizeï¼‰ -&gt; å…ƒç©ºé—´å‚æ•°ï¼ˆMetaspaceSize MaxMetaspaceSizeï¼‰ï¼›</li>
</ul>
<p><img src="/p/df88bc10/image-20220306165242400.png" alt="image-20220306165242400"></p>
<h3 id="å †å†…å­˜"><a href="#å †å†…å­˜" class="headerlink" title="å †å†…å­˜"></a>å †å†…å­˜</h3><p><img src="/p/df88bc10/image-20220306165302672.png" alt="image-20220306165302672"></p>
<h3 id="è™šæ‹Ÿæœºæ ˆ"><a href="#è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="è™šæ‹Ÿæœºæ ˆ"></a>è™šæ‹Ÿæœºæ ˆ</h3><img src="/p/df88bc10/JVMè™šæ‹Ÿæœºæ ˆåŒº.png" alt="image-20210411134428910" style="zoom:110%;">

<h3 id="æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆ"></a>æœ¬åœ°æ–¹æ³•æ ˆ</h3><img src="/p/df88bc10/JVMæœ¬åœ°æ–¹æ³•æ ˆ.png" alt="image-20210411135011461" style="zoom:110%;">

<h3 id="ç¨‹åºè®¡æ•°å™¨"><a href="#ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨"></a>ç¨‹åºè®¡æ•°å™¨</h3><img src="/p/df88bc10/JVMç¨‹åºè®¡æ•°å™¨-16465568468561.png" alt="image-20210411134803099" style="zoom:110%;">

<img src="/p/df88bc10/Javaç¨‹åºç¼–è¯‘åŸç†ï¼ˆ1ï¼‰-16465568468572.png" alt="image-20210411141220263" style="zoom:110%;">

<h2 id="JVMå±‚é¢â€”â€”ç¨‹åºè¿è¡Œå®Œæ•´åˆ†æ"><a href="#JVMå±‚é¢â€”â€”ç¨‹åºè¿è¡Œå®Œæ•´åˆ†æ" class="headerlink" title="JVMå±‚é¢â€”â€”ç¨‹åºè¿è¡Œå®Œæ•´åˆ†æ"></a>JVMå±‚é¢â€”â€”ç¨‹åºè¿è¡Œå®Œæ•´åˆ†æ</h2><p>æŸ¥çœ‹å­—èŠ‚ç æ–‡ä»¶å†…å®¹ï¼ˆ.classï¼‰ï¼š</p>
<p>1ã€Javap -v xxx.class æ‰“å°åœ¨æ§åˆ¶å°</p>
<p>2ã€Javap -v xxx.class &gt; xxx.txt è¾“å‡ºåˆ°xxx.txtè®°äº‹æœ¬ä¸­</p>
<p><img src="/p/df88bc10/%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%87%E4%BB%B6%E8%AE%BF%E9%97%AE%E6%A0%87%E5%BF%97-16465568468573.png" alt="image-20210411225956114"></p>
<p><img src="/p/df88bc10/%E5%AD%97%E8%8A%82%E7%A0%81%E5%86%85%E5%AE%B9-%E5%B8%B8%E9%87%8F%E6%B1%A0-16465568468574.png" alt="image-20210411230118748"></p>
<p>å°† Demo1 ç±»ä½¿ç”¨Java.exeç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶ï¼ˆclassï¼‰</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">500</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> x / y;</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line">        System.out.println(a + b);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä½¿ç”¨JavapæŸ¥çœ‹å­—èŠ‚ç æ–‡ä»¶</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">D:\jdk1<span class="number">.8</span>\bin&gt;javap.exe -v E:\demo\target\classes\cn\com\demo\test\Demo1.<span class="keyword">class</span></span><br><span class="line"><span class="title class_">Classfile</span> /E:\demo\target\classes\cn\com\demo\test\Demo1.<span class="keyword">class</span></span><br><span class="line">  <span class="title class_">Last</span> modified <span class="number">2021</span>-<span class="number">4</span>-<span class="number">11</span>; size <span class="number">620</span> bytes</span><br><span class="line">  MD5 checksum 71c6b97950ddc7fb31e028064d2763c0</span><br><span class="line">  Compiled from <span class="string">"Demo1.java"</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">cn</span>.com.demo.test.Demo1</span><br><span class="line">  minor version: <span class="number">0</span>  <span class="comment">// æ¬¡ç‰ˆæœ¬å·</span></span><br><span class="line">  major version: <span class="number">52</span> <span class="comment">// ä¸»ç‰ˆæœ¬å·ï¼šJDK5,6,7,8 å¯¹åº”49,50,51,52</span></span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER <span class="comment">// è®¿é—®æ ‡å¿—</span></span><br><span class="line">Constant pool:</span><br><span class="line">   #<span class="number">1</span> = Methodref          #<span class="number">5.</span>#<span class="number">24</span>         <span class="comment">// java/lang/Object."&lt;init&gt;":()V</span></span><br><span class="line">   #<span class="number">2</span> = Fieldref           #<span class="number">25.</span>#<span class="number">26</span>        <span class="comment">// java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">   #<span class="number">3</span> = Methodref          #<span class="number">27.</span>#<span class="number">28</span>        <span class="comment">// java/io/PrintStream.println:(I)V</span></span><br><span class="line">   #<span class="number">4</span> = Class              #<span class="number">29</span>            <span class="comment">// cn/com/newdoone/test/Demo1</span></span><br><span class="line">   #<span class="number">5</span> = Class              #<span class="number">30</span>            <span class="comment">// java/lang/Object</span></span><br><span class="line">   #<span class="number">6</span> = Utf8               &lt;init&gt;</span><br><span class="line">   #<span class="number">7</span> = Utf8               ()V</span><br><span class="line">   #<span class="number">8</span> = Utf8               Code</span><br><span class="line">   #<span class="number">9</span> = Utf8               LineNumberTable</span><br><span class="line">  #<span class="number">10</span> = Utf8               LocalVariableTable</span><br><span class="line">  #<span class="number">11</span> = Utf8               <span class="built_in">this</span></span><br><span class="line">  #<span class="number">12</span> = Utf8               Lcn/com/newdoone/test/Demo1;</span><br><span class="line">  #<span class="number">13</span> = Utf8               main</span><br><span class="line">  #<span class="number">14</span> = Utf8               ([Ljava/lang/String;)V</span><br><span class="line">  #<span class="number">15</span> = Utf8               args</span><br><span class="line">  #<span class="number">16</span> = Utf8               [Ljava/lang/String;</span><br><span class="line">  #<span class="number">17</span> = Utf8               x</span><br><span class="line">  #<span class="number">18</span> = Utf8               I</span><br><span class="line">  #<span class="number">19</span> = Utf8               y</span><br><span class="line">  #<span class="number">20</span> = Utf8               a</span><br><span class="line">  #<span class="number">21</span> = Utf8               b</span><br><span class="line">  #<span class="number">22</span> = Utf8               SourceFile</span><br><span class="line">  #<span class="number">23</span> = Utf8               Demo1.java</span><br><span class="line">  #<span class="number">24</span> = NameAndType        #<span class="number">6</span>:#<span class="number">7</span>          <span class="comment">// "&lt;init&gt;":()V</span></span><br><span class="line">  #<span class="number">25</span> = Class              #<span class="number">31</span>            <span class="comment">// java/lang/System</span></span><br><span class="line">  #<span class="number">26</span> = NameAndType        #<span class="number">32</span>:#<span class="number">33</span>        <span class="comment">// out:Ljava/io/PrintStream;</span></span><br><span class="line">  #<span class="number">27</span> = Class              #<span class="number">34</span>            <span class="comment">// java/io/PrintStream</span></span><br><span class="line">  #<span class="number">28</span> = NameAndType        #<span class="number">35</span>:#<span class="number">36</span>        <span class="comment">// println:(I)V</span></span><br><span class="line">  #<span class="number">29</span> = Utf8               cn/com/newdoone/test/Demo1</span><br><span class="line">  #<span class="number">30</span> = Utf8               java/lang/Object</span><br><span class="line">  #<span class="number">31</span> = Utf8               java/lang/System</span><br><span class="line">  #<span class="number">32</span> = Utf8               out</span><br><span class="line">  #<span class="number">33</span> = Utf8               Ljava/io/PrintStream;</span><br><span class="line">  #<span class="number">34</span> = Utf8               java/io/PrintStream</span><br><span class="line">  #<span class="number">35</span> = Utf8               println</span><br><span class="line">  #<span class="number">36</span> = Utf8               (I)V</span><br><span class="line">{</span><br><span class="line">  <span class="comment">// åœ¨ç±»ä¸­æ²¡æœ‰å†™æ„é€ æ–¹æ³•ï¼Œä½†åœ¨æ­¤å¤„æœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•</span></span><br><span class="line">  <span class="comment">// ç”±æ­¤å¯è§ï¼Œæ²¡æœ‰å®šä¹‰æ„é€ å‡½æ•°æ—¶ï¼Œä¼šæœ‰éšå¼çš„æ— å‚æ„é€ å‡½æ•°ã€‚</span></span><br><span class="line">  <span class="keyword">public</span> cn.com.demo.test.Demo1();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="number">1</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object."&lt;init&gt;":()V</span></span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">6</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="built_in">this</span>   Lcn/com/newdoone/test/Demo1;</span><br><span class="line"> <span class="comment">// ç¨‹åºå…¥å£mainæ–¹æ³•</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(java.lang.String[])</span>;</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      <span class="comment">// æœ¬åœ°å˜é‡æ•°é‡ã€å‚æ•°æ•°é‡ã€æ–¹æ³•å¯¹åº”æ ˆå¸§ä¸­æ“ä½œæ•°æ ˆçš„æ·±åº¦</span></span><br><span class="line">      stack=<span class="number">3</span>, locals=<span class="number">5</span>, args_size=<span class="number">1</span> </span><br><span class="line">       <span class="comment">// ä¸‹é¢æ˜¯ä¸€äº›JVMæ‰§è¡Œè¿™äº›æºç ç¼–è¯‘è¿‡åçš„æŒ‡ä»¤ç </span></span><br><span class="line">       <span class="comment">// javap ç¿»è¯‘å‡ºæ¥æ˜¯æ“ä½œç¬¦ï¼Œclassæ–‡ä»¶å†…å­˜å‚¨çš„æ˜¯æŒ‡ä»¤ç </span></span><br><span class="line">       <span class="comment">// å‰é¢çš„æ•°å­—æ˜¯åç§»é‡ï¼ˆå­—èŠ‚ï¼‰ï¼ŒJVMæ ¹æ®è¿™ä¸ªå»åŒºåˆ†ä¸åŒçš„æŒ‡ä»¤ï¼Œè¯¦æƒ…è§ã€ŠJVMæŒ‡ä»¤ç è¡¨ã€‹ï¼Œåœ¨æœ¬ç¯‡æ–‡ç« ä¸‹é¢ã€‚</span></span><br><span class="line">         <span class="number">0</span>: sipush        <span class="number">500</span></span><br><span class="line">         <span class="number">3</span>: istore_1</span><br><span class="line">         <span class="number">4</span>: sipush        <span class="number">200</span></span><br><span class="line">         <span class="number">7</span>: istore_2</span><br><span class="line">         <span class="number">8</span>: iload_1</span><br><span class="line">         <span class="number">9</span>: iload_2</span><br><span class="line">        <span class="number">10</span>: idiv</span><br><span class="line">        <span class="number">11</span>: istore_3</span><br><span class="line">        <span class="number">12</span>: bipush        <span class="number">50</span></span><br><span class="line">        <span class="number">14</span>: istore        <span class="number">4</span></span><br><span class="line">        <span class="number">16</span>: getstatic     #<span class="number">2</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">        <span class="number">19</span>: iload_3</span><br><span class="line">        <span class="number">20</span>: iload         <span class="number">4</span></span><br><span class="line">        <span class="number">22</span>: iadd</span><br><span class="line">        <span class="number">23</span>: invokevirtual #<span class="number">3</span>                  <span class="comment">// Method java/io/PrintStream.println:(I)V</span></span><br><span class="line">        <span class="number">26</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">8</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">9</span>: <span class="number">4</span></span><br><span class="line">        line <span class="number">10</span>: <span class="number">8</span></span><br><span class="line">        line <span class="number">11</span>: <span class="number">12</span></span><br><span class="line">        line <span class="number">12</span>: <span class="number">16</span></span><br><span class="line">        line <span class="number">13</span>: <span class="number">26</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>      <span class="number">27</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">            <span class="number">4</span>      <span class="number">23</span>     <span class="number">1</span>     x   I</span><br><span class="line">            <span class="number">8</span>      <span class="number">19</span>     <span class="number">2</span>     y   I</span><br><span class="line">           <span class="number">12</span>      <span class="number">15</span>     <span class="number">3</span>     a   I</span><br><span class="line">           <span class="number">16</span>      <span class="number">11</span>     <span class="number">4</span>     b   I</span><br><span class="line">}</span><br><span class="line">SourceFile: <span class="string">"Demo1.java"</span></span><br></pre></td></tr></tbody></table></figure>

<p>ç¬¬ä¸€æ­¥ï¼ŒåŠ è½½ã€‚å°†æˆ‘ä»¬å†™çš„ä»£ç ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œå°†å­—èŠ‚ç åŠ è½½åˆ°æ–¹æ³•åŒºï¼Œå…¶ä¸­ç±»ä¿¡æ¯åŠ è½½åˆ°æ–¹æ³•åŒºï¼Œå­—ç¬¦ä¸²å¸¸é‡åŠ è½½åˆ°å¸¸é‡æ± ã€‚</p>
<p><img src="/p/df88bc10/%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%80%EF%BC%89-16465568468575.png" alt="image-20210411232445707"></p>
<p>ç¬¬äºŒæ­¥ï¼Œè¿è¡Œã€‚JVMåˆ›å»ºçº¿ç¨‹æ¥æ‰§è¡Œä»£ç ï¼Œæ¶‰åŠåˆ°çº¿ç¨‹ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºæ ˆå’Œç¨‹åºè®¡æ•°å™¨å°±ä¼šåˆ†é…ä¸€ä¸ªå½“å‰çº¿ç¨‹ç‹¬å çš„ç©ºé—´ï¼Œç”¨æ¥ä¿å­˜å½“å‰çº¿ç¨‹æ‰§è¡ŒæŒ‡ä»¤ç çš„ä½ç½®ã€‚</p>
<p><img src="/p/df88bc10/%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%EF%BC%88%E4%BA%8C%EF%BC%89-16465568468576.png" alt="image-20210411233544796"></p>
<p>å¼€å§‹æ‰§è¡Œæ“ä½œç ï¼ˆåŠ©è®°ç¬¦ï¼‰ï¼Œç»“åˆã€ŠJVMæŒ‡ä»¤ç è¡¨ã€‹æ¥çœ‹ã€‚é€šè¿‡ä¸Šé¢çš„å­—èŠ‚ç æ–‡ä»¶ä¸­å¯ä»¥å¾—å‡ºï¼Œæœ‰5ä¸ªæœ¬åœ°å˜é‡ï¼Œå˜é‡0æ˜¯æ–¹æ³•å‚æ•°argsã€‚</p>
<p>æ‰§è¡Œ sipush 500 æ“ä½œç ï¼Œsipushçš„æ„æ€æ˜¯(valuebyte1 &lt;&lt; 8) | valuebyte2 å€¼å¸¦ç¬¦å·æ‰©å±•æˆintå€¼å…¥æ ˆã€‚ä¹Ÿå°±æ˜¯è¯´å°†500å‹å…¥æ“ä½œæ•°æ ˆã€‚</p>
<p><img src="/p/df88bc10/%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%89%EF%BC%89-16465568468577.png" alt="image-20210411234151590"></p>
<p>ç¨‹åºè®¡æ•°å™¨ä¿å­˜çš„å½“å‰çº¿ç¨‹æ‰§è¡Œä½ç½®ä¸º3ï¼Œistore_1 å°†æ“ä½œæ•°æ ˆä¸­çš„500ä¿å­˜åˆ°æœ¬åœ°å˜é‡è¡¨åºå·ä¸º1çš„ä½ç½®ã€‚</p>
<p><img src="/p/df88bc10/%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%EF%BC%88%E5%9B%9B%EF%BC%89-16465568468578.png" alt="image-20210411234834340"></p>
<p>ç¨‹åºè®¡æ•°å™¨ä¿å­˜çš„å½“å‰çº¿ç¨‹æ‰§è¡Œä½ç½®ä¸º4ï¼Œbipush 100 å°†100å‹å…¥æ“ä½œæ•°æ ˆï¼Œbipush çš„æ„æ€æ˜¯ valuebyteå€¼å¸¦ç¬¦å·æ‰©å±•æˆintå€¼å…¥æ ˆã€‚</p>
<p><img src="/p/df88bc10/%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%EF%BC%88%E4%BA%94%EF%BC%89-16465568468579.png" alt="image-20210411235134311"></p>
<p>ç¨‹åºè®¡æ•°å™¨ä¿å­˜çš„å½“å‰çº¿ç¨‹æ‰§è¡Œä½ç½®ä¸º6ï¼Œistore_2 å°†æ“ä½œæ•°æ ˆä¸­çš„100å‹å…¥æœ¬åœ°å˜é‡è¡¨ä¸­åºå·ä¸º2çš„ä½ç½®ã€‚</p>
<p><img src="/p/df88bc10/%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%EF%BC%88%E5%85%AD%EF%BC%89-164655684685810.png" alt="image-20210411235413503"></p>
<p>iload_1å’Œiload_2 åˆ†åˆ«è¯»å–æœ¬åœ°å˜é‡è¡¨ä¸­åºå·ä¸º1å’Œ2çš„å€¼å‹å…¥æ“ä½œæ•°æ ˆï¼Œidiv å°†æ ˆé¡¶çš„ä¸¤ä¸ª intç±»å‹æ•°ç›¸é™¤ï¼Œç»“æœå…¥æ ˆ 500/100 = 5ï¼Œistore_3 ä¿å­˜åœ¨æœ¬åœ°å˜é‡è¡¨ä¸­çš„3çš„ä½ç½®ã€‚</p>
<p><img src="/p/df88bc10/%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%83%EF%BC%89-164655684685811.png" alt="image-20210411235703594"></p>
<p>bipush 50 å°†50å‹å…¥æ ˆä¸­ï¼Œistore_4 ä¿å­˜åœ¨æœ¬åœ°å˜é‡è¡¨4çš„ä½ç½®ã€‚</p>
<p><img src="/p/df88bc10/%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%EF%BC%88%E5%85%AB%EF%BC%89-164655684685812.png" alt="image-20210412000117859"></p>
<p>getstatic #2 è¡¨ç¤ºè·å–å¸¸é‡æ± ä¸­ç¬¬2ä¸ªå±æ€§çš„å¼•ç”¨ï¼Œå‹å…¥æ“ä½œæ•°æ ˆã€‚</p>
<p><img src="/p/df88bc10/%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%EF%BC%88%E4%B9%9D%EF%BC%89-164655684685813.png" alt="image-20210412000326682"></p>
<p>iload_3å’Œ iload_4 å–å‡ºæœ¬åœ°å˜é‡è¡¨ä¸­ç¬¬3å’Œç¬¬4çš„å€¼å‹å…¥æ ˆä¸­ã€‚</p>
<p><img src="/p/df88bc10/%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%EF%BC%88%E5%8D%81%EF%BC%89-164655684685814.png" alt="image-20210412000541845"></p>
<p>iadd ç›¸åŠ ã€‚</p>
<p><img src="/p/df88bc10/%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89-164655684685815.png" alt="image-20210412000708796"></p>
<p>invokevirtual #3 ï¼ŒåŸæ¥çš„æ–¹æ³•ä¸æ¥ç€æ‰§è¡Œäº†ï¼Œç¨‹åºè®¡æ•°å™¨é‡æ–°å¼€å§‹è®¡æ•°ï¼Œæ‰§è¡Œå…¶å®ƒæ–¹æ³•å®Œæ¯•ä¹‹åï¼Œåœ¨ç»§ç»­æ‰§è¡Œmainæ–¹æ³•å¯¹åº”çš„æ ˆå¸§ã€‚</p>
<p><img src="/p/df88bc10/%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%EF%BC%88%E5%8D%81%E4%BA%8C%EF%BC%89-164655684685816.png" alt="image-20210412001042190"></p>
<p>æ‰§è¡Œç»“æŸ</p>
<p><img src="/p/df88bc10/%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%EF%BC%88%E5%8D%81%E4%B8%89%EF%BC%89-164655684685817.png" alt="image-20210412001128690"></p>
</body></html>]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>GCè°ƒä¼˜</title>
    <url>/p/3eea71e9.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="G1-GC-è°ƒä¼˜æŒ‡å—"><a href="#G1-GC-è°ƒä¼˜æŒ‡å—" class="headerlink" title="G1 GC è°ƒä¼˜æŒ‡å—"></a>G1 GC è°ƒä¼˜æŒ‡å—</h2><p><a href="https://docs.oracle.com/javase/9/gctuning/garbage-first-garbage-collector.htm">https://docs.oracle.com/javase/9/gctuning/garbage-first-garbage-collector.htm</a></p>
<h3 id="å‚æ•°æ¨¡æ¿"><a href="#å‚æ•°æ¨¡æ¿" class="headerlink" title="å‚æ•°æ¨¡æ¿"></a>å‚æ•°æ¨¡æ¿</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">-Xmx**g -Xms**g -XX:MetaspaceSize=512m -XX:+MaxMetaspaceSize=512m -XX:G1MaxNewSizePercent=50 -XX:G1NewSizePercent=20 -XX:HeapDumpPath=/home/admin/logs -XX:+DisableExplicitGC</span><br></pre></td></tr></tbody></table></figure>

<h3 id="åŸºæœ¬è®¾ç½®"><a href="#åŸºæœ¬è®¾ç½®" class="headerlink" title="åŸºæœ¬è®¾ç½®"></a>åŸºæœ¬è®¾ç½®</h3><ul>
<li>è¯·æ ¹æ®å…·ä½“æƒ…å†µæŒ‡å®šå‚æ•°æ¨¡æ¿ä¸­çš„Xmxå’ŒXmsï¼Œè¿™ä¸¤ä¸ªæ•°å€¼ä¸€èˆ¬å†™æˆä¸€æ ·çš„<br> å…¶æ•°å€¼å¯ä»¥æ ¹æ®ä¸‹é¢çš„æ–¹æ³•æ¨ç®—ï¼š </li>
<li>åœ¨åº”ç”¨æ­£å¸¸æ‰§è¡Œæ—¶ä½¿ç”¨jmapæ‰‹åŠ¨è§¦å‘ä¸€æ¬¡full GC, <code>jmap -histo:live </code> <ul>
<li> ç„¶åè§‚å¯ŸGCæ—¥å¿—é‡Œé¢Full GCä¹‹åæ•´ä¸ªheapçš„å‰©ä½™ç©ºé—´ï¼Œè¿™ä¸ªå¯ä»¥ä¼°ç®—ä¸ºæ´»è·ƒæ•°æ®çš„æ€»å¤§å°LDS (Live Data Set) </li>
<li> ç„¶åæ•´ä¸ªheapçš„å¤§å°å¯ä»¥ç”¨ç»éªŒå…¬å¼ Xmx = LDS * f æ¥è®¡ç®—ï¼Œå…¶ä¸­få› å­æŒ‰ç…§ç»éªŒä¸€èˆ¬æ˜¯å–3~4ã€‚ </li>
</ul>
</li>
<li>æ–°ç”Ÿä»£å¤§å°-Xmn**g<br> é™¤éç»è¿‡ç‰¹åˆ«è°ƒæ ¡ï¼Œå¦åˆ™ä¸æ¨èæ‰‹åŠ¨æŒ‡å®šG1æ–°ç”Ÿä»£å¤§å°ï¼Œå¯èƒ½ä¼šå¯¹G1å†…éƒ¨å‚æ•°çš„è‡ªåŠ¨è°ƒæ•´äº§ç”Ÿå¯¼è‡´ä¸æ­£ç¡®çš„å½±å“ï¼Œæœ€åæƒ…å†µå¯èƒ½å¯¼è‡´é¢‘ç¹çš„Full GCã€‚ </li>
</ul>
<blockquote>
<p>G1çš„youngåŒºå¤§å°æœ‰ä¸‰ä¸ªç­–ç•¥ï¼š1ï¼Œå›ºå®šå¤§å°ï¼›2ï¼Œå›ºå®šä¸Šé™ï¼›3ï¼Œå›ºå®šä¸Šä¸‹é™ï¼Œ è¿™ä¸ªç­–ç•¥ä¼šåœ¨JVMå¯åŠ¨æ—¶æ ¹æ®VMå‚æ•°è¿›è¡Œé€‰æ‹©ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨#3ï¼Œåœ¨5%ï½60%çš„Heapå¤§å°èŒƒå›´å†…è°ƒæ•´ã€‚<br>å¯¹äºè‡ªåŠ¨è°ƒæ•´ç­–ç•¥ï¼Œåœ¨æ ¹æ®å†å²æ•°æ®é¢„æµ‹GCæŒ‡æ ‡æ—¶ï¼ŒG1å‡è®¾å„é¡¹æŒ‡æ ‡æ˜¯æŒ‰ç…§çº¿æ€§å…³ç³»å˜åŒ–çš„ï¼Œ å¯¹äºè¡Œä¸ºå‰§çƒˆå˜åŒ–çš„åº”ç”¨ï¼ŒG1çš„è‡ªåŠ¨è°ƒæ•´ç­–ç•¥æ˜¯æœ‰å¯èƒ½è¢«æ‰“ä¹±çš„ï¼Œå¦‚æœå‘ç°youngåŒºç»å¸¸è¿›å…¥ç‰¹åˆ«å°ä¸Šé™å¯¼è‡´é¢‘ç¹GCï¼Œå¯ä»¥å°è¯•ï¼š<br>1ï¼Œè°ƒå¤§-XX:MaxGCPauseMillis ï¼ˆé»˜è®¤200ï¼‰<br>2ï¼Œè®¾ç½®-XX:+UnlockExperimentalVMOptions -XX:G1NewSizePercent=30ï¼Œæ¥æŠŠyoungåŒºä¸‹é™è°ƒæ•´åˆ°30æˆ–å…¶ä»–æ•°å€¼ï¼ˆæ³¨æ„ï¼šæ­¤æ—¶å¿…é¡»åˆ æ‰-Xmn, -XX:NewRatioç­‰å‚æ•°æ‰å¯ä»¥ç”Ÿæ•ˆï¼‰ã€‚</p>
</blockquote>
<ul>
<li><p>å¯¹äºå†…å­˜å ç”¨æ•æ„Ÿçš„åº”ç”¨ï¼Œå¯ä»¥è®¾ç½®-XX:G1MaxNewSizePercent=<br>å¦‚æœæ˜¯ä»CMSåˆ‡æ¢è¿‡æ¥çš„ï¼Œå¯ä»¥å°è¯•è®¾ç½®value=[CMS -Xmn]/[-Xmx] * 100% </p>
</li>
<li><p>æš‚åœæ—¶é—´-XX:MaxG1PauseMillis=&lt;æ¯«ç§’&gt;<br>è¿™ä¸ªæ•°å€¼é»˜è®¤æ˜¯200msï¼Œå¦‚æœä¸šåŠ¡æ€§èƒ½æŒ‡æ ‡æ²¡æœ‰å‡ºç°é—®é¢˜ï¼Œå¹¶ä¸”å¯¹äºæš‚åœæ²¡æœ‰ç‰¹åˆ«è¦æ±‚ï¼Œä¸æ¨èæ‰‹åŠ¨æŒ‡å®šè¿™ä¸ªå‚æ•°ã€‚è™½ç„¶è¿™æ˜¯ä¸ªè½¯æ€§é™åˆ¶ï¼ŒG1å¹¶ä¸ä¼šä¸¥æ ¼éµå®ˆè¿™ä¸ªæ—¶é—´é™åˆ¶ï¼Œä½†è¿™ä¸ªå‚æ•°ä¼šå½±å“G1å†…éƒ¨å‚æ•°çš„è‡ªåŠ¨è°ƒæ•´ï¼Œå¦‚æœæŒ‡å®šäº†ä¸€ä¸ªè¾ƒå°çš„æš‚åœæ—¶é—´ï¼ŒG1å›æ”¶å™¨å¯èƒ½ä¼šä¸ºäº†å°½é‡æ»¡è¶³è¿™ä¸ªé™åˆ¶è€Œå»ä½¿ç”¨ä¸€äº›æ¯”è¾ƒæ¿€è¿›çš„å‚æ•°ã€‚ </p>
</li>
<li><p>ç£ç›˜æ•æ„Ÿå‹åº”ç”¨å»ºè®®ä½¿ç”¨GC log rotationï¼Œå‚æ•°ä¸º </p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">-Xloggc:/home/admin/logs/gc.log  -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=4 -XX:GCLogFileSize=8m</span><br></pre></td></tr></tbody></table></figure>

<p>JDK8 G1çš„é»˜è®¤GCè¾“å‡ºæ¯”CMSå¤šä¸å°‘å†…å®¹ï¼Œä¼šæ›´å¿«çš„æ¶ˆè€—ç£ç›˜ç©ºé—´ï¼Œgc log rotationä¼šæŒ‡å®šGC logçš„è¾“å‡ºåœ¨å‡ ä¸ªGCæ—¥å¿—æ–‡ä»¶ä¹‹é—´å¾ªç¯æµè½¬ã€‚</p>
<ul>
<li>ä¸è¦ä¸ºäº†ç”¨G1è€Œç”¨G1<br>çº¿ä¸Šç¯å¢ƒçš„å¾ˆå¤šGCç­–ç•¥éƒ½æ˜¯ç»è¿‡å‹æµ‹è°ƒæ ¡çš„ï¼Œ å¦‚æœç›®å‰å·¥ä½œçš„å¾ˆå¥½ï¼Œä¸»è¦æ˜¯æš‚åœæ—¶é—´ï¼ˆGC æ—¥å¿—é‡Œé¢çš„â€realâ€è€—æ—¶ï¼‰ä¸Šæ²¡æœ‰é—®é¢˜ï¼Œä¸æ¨èä¸“é—¨åˆ‡æ¢åˆ°G1ç®—æ³•ï¼Œç‰¹åˆ«æ˜¯æ¯”è¾ƒå°çš„å †ï¼ˆ20Gä»¥ä¸‹çš„ï¼‰ã€‚</li>
</ul>
<h3 id="å¤æ‚åœºæ™¯"><a href="#å¤æ‚åœºæ™¯" class="headerlink" title="å¤æ‚åœºæ™¯"></a>å¤æ‚åœºæ™¯</h3><ul>
<li><p>-XX:G1ReservePercent=10<br> è¿™ä¸ªå‚æ•°æŒ‡å®šäº†G1è¦ä¿ç•™å¤šå°‘ç©ºé—²ç©ºé—´æ¥é˜²æ­¢Promotion failureï¼ŒG1çš„YGCå¤±è´¥ä¼šå¯¼è‡´å¤±è´¥çš„å¹´è½»ä»£regionå…¨éƒ¨å˜æˆè€å¹´ä»£regionï¼Œæ˜¯ä¸€ä¸ªä»£ä»·éå¸¸å¤§çš„æ“ä½œã€‚gclogä¸­åº”è¯¥å°½é‡é¿å…å‡ºç°promotion failureï¼Œå¦‚æœé¢‘ç¹å‡ºç°å¯ä»¥è€ƒè™‘è°ƒå¤§-XX:G1ReservePercentè¿™ä¸ªå‚æ•°(é»˜è®¤10%)ã€‚ </p>
</li>
<li><p>-XX:+G1LogLevel=fine/finer/finest<br> å¯ä»¥æ‰“å°ä¸åŒè¯¦ç»†ç¨‹åº¦çš„GCä¿¡æ¯ </p>
</li>
<li><p>-XX:+G1OptThruput<br> åœ¨8.6.11ä»¥ä¸Šï¼ˆåŒ…æ‹¬ï¼‰çš„ç‰ˆæœ¬ä¸­å¯ä»¥ä½¿ç”¨è¯¥é€‰é¡¹å¼€å¯G1çš„throughputæ¨¡å¼ï¼Œé’ˆå¯¹ç‰¹å®šåœºæ™¯å¯ä»¥é™ä½CPUä½¿ç”¨ç‡çš„åŒæ—¶ç»´æŒè¾ƒä½æš‚åœæ—¶é—´ã€‚ </p>
</li>
</ul>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªé€‰é¡¹éœ€è¦æµ‹è¯•ï¼Œå¦‚æœè§‚å¯Ÿåˆ°GCæš‚åœæ—¶é—´æ˜æ˜¾ä¸Šæ¶¨ï¼Œåˆ™è¯´æ˜åº”ç”¨ä¸é€‚åˆè¿™ä¸ªæ¨¡å¼ï¼›ä¸€èˆ¬ä¸æ¨èè¶…è¿‡20Gçš„å †(ä¸€æ¬¡ygcä¹‹åå‰©ä½™å¤§å°)ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚</p>
</blockquote>
<h2 id="JDK-8-åº”ç”¨åŸºç¡€-jvm-å‚æ•°å‚è€ƒ"><a href="#JDK-8-åº”ç”¨åŸºç¡€-jvm-å‚æ•°å‚è€ƒ" class="headerlink" title="JDK 8 åº”ç”¨åŸºç¡€ jvm å‚æ•°å‚è€ƒ"></a>JDK 8 åº”ç”¨åŸºç¡€ jvm å‚æ•°å‚è€ƒ</h2><h3 id="å‚æ•°å‚è€ƒ-æŒ‰æœºå‹"><a href="#å‚æ•°å‚è€ƒ-æŒ‰æœºå‹" class="headerlink" title="å‚æ•°å‚è€ƒ(æŒ‰æœºå‹)"></a>å‚æ•°å‚è€ƒ(æŒ‰æœºå‹)</h3><h4 id="4C8G"><a href="#4C8G" class="headerlink" title="4C8G"></a>4C8G</h4><ul>
<li>CMS</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">-server -Xms4g -Xmx4g -Xmn2g                                                 \</span><br><span class="line">-XX:+UseConcMarkSweepGC -XX:+CMSScavengeBeforeRemark                         \</span><br><span class="line">-XX:CMSMaxAbortablePrecleanTime=5000 -XX:+CMSClassUnloadingEnabled           \</span><br><span class="line">-XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly     \</span><br><span class="line">-XX:+ExplicitGCInvokesConcurrent -XX:ParallelGCThreads=4                     \</span><br><span class="line">-Xloggc:/home/admin/logs/gc.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps   \</span><br><span class="line">-Dsun.rmi.dgc.server.gcInterval=2592000000                                   \</span><br><span class="line">-Dsun.rmi.dgc.client.gcInterval=2592000000                                   \</span><br><span class="line">-XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=256m                             \</span><br><span class="line">-XX:ReservedCodeCacheSize=256m                                               \</span><br><span class="line">-XX:MaxDirectMemorySize=512m                                                 \</span><br><span class="line">-XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/home/admin/logs            \</span><br><span class="line">-XX:ErrorFile=/home/admin/logs/hs_err_pid%p.log                              \</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>G1</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">-server -Xms4g -Xmx4g -XX:MaxNewSize=2g                                      \</span><br><span class="line">-XX:+UseG1GC -XX:InitiatingHeapOccupancyPercent=40 -XX:G1HeapRegionSize=8m   \</span><br><span class="line">-XX:+ExplicitGCInvokesConcurrent -XX:ParallelGCThreads=4                     \</span><br><span class="line">-Xloggc:/home/admin/logs/gc.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps   \</span><br><span class="line">-Dsun.rmi.dgc.server.gcInterval=2592000000                                   \</span><br><span class="line">-Dsun.rmi.dgc.client.gcInterval=2592000000                                   \</span><br><span class="line">-XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=256m                             \</span><br><span class="line">-XX:ReservedCodeCacheSize=256m                                               \</span><br><span class="line">-XX:MaxDirectMemorySize=512m                                                 \</span><br><span class="line">-XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/home/admin/logs            \</span><br><span class="line">-XX:ErrorFile=/home/admin/logs/hs_err_pid%p.log                              \</span><br></pre></td></tr></tbody></table></figure>

<h4 id="8C16G"><a href="#8C16G" class="headerlink" title="8C16G"></a>8C16G</h4><ul>
<li>CMS</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">-server -Xms10g -Xmx10g -Xmn5g                                               \</span><br><span class="line">-XX:+UseConcMarkSweepGC  -XX:+CMSScavengeBeforeRemark                        \</span><br><span class="line">-XX:CMSMaxAbortablePrecleanTime=5000 -XX:+CMSClassUnloadingEnabled           \</span><br><span class="line">-XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly     \</span><br><span class="line">-XX:+ExplicitGCInvokesConcurrent -XX:ParallelGCThreads=8                     \</span><br><span class="line">-Xloggc:/home/admin/logs/gc.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps   \</span><br><span class="line">-Dsun.rmi.dgc.server.gcInterval=2592000000                                   \</span><br><span class="line">-Dsun.rmi.dgc.client.gcInterval=2592000000                                   \</span><br><span class="line">-XX:MetaspaceSize=512m -XX:MaxMetaspaceSize=512m                             \</span><br><span class="line">-XX:ReservedCodeCacheSize=512m                                               \</span><br><span class="line">-XX:MaxDirectMemorySize=512m                                                 \</span><br><span class="line">-XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/home/admin/logs            \</span><br><span class="line">-XX:ErrorFile=/home/admin/logs/hs_err_pid%p.log                              \</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>G1</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">-server -Xms10g -Xmx10g -XX:MaxNewSize=5g                                    \</span><br><span class="line">-XX:+UseG1GC -XX:InitiatingHeapOccupancyPercent=40 -XX:G1HeapRegionSize=16m  \</span><br><span class="line">-XX:+ExplicitGCInvokesConcurrent -XX:ParallelGCThreads=8                     \</span><br><span class="line">-Xloggc:/home/admin/logs/gc.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps   \</span><br><span class="line">-Dsun.rmi.dgc.server.gcInterval=2592000000                                   \</span><br><span class="line">-Dsun.rmi.dgc.client.gcInterval=2592000000                                   \</span><br><span class="line">-XX:MetaspaceSize=512m -XX:MaxMetaspaceSize=512m                             \</span><br><span class="line">-XX:ReservedCodeCacheSize=512m                                               \</span><br><span class="line">-XX:MaxDirectMemorySize=512m                                                 \</span><br><span class="line">-XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/home/admin/logs            \</span><br><span class="line">-XX:ErrorFile=/home/admin/logs/hs_err_pid%p.log                              \</span><br></pre></td></tr></tbody></table></figure>

<h3 id="å…¶ä»–å»ºè®®"><a href="#å…¶ä»–å»ºè®®" class="headerlink" title="å…¶ä»–å»ºè®®"></a>å…¶ä»–å»ºè®®</h3><p>MaxDirectMemorySizeã€MetaspaceSizeã€MaxMetaspaceæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´</p>
<p>å…³é—­åå‘é”</p>
<ul>
<li>-XX:-UseBiasedLocking</li>
</ul>
<p>åŠ é€Ÿå¯åŠ¨ (8.4.7)</p>
<ul>
<li>-Dcom.alibaba.introspector.findCustomizerClass.skipStrategy=SKIP_ALL (å‚è€ƒAJDK 8Release Note)</li>
</ul>
<p>å¯åŠ¨æ—¶å¼€å¯Attachæœºåˆ¶, é¿å…FGCå¯¼è‡´jcmdç­‰å‘½ä»¤æ— æ³•å“åº”</p>
<ul>
<li>-XX:+StartAttachListener</li>
</ul>
<p>Metaspace Dump (8.5.9_fp1)</p>
<ul>
<li>-XX:+MetaspaceDumpOnOutOfMemoryError -XX:MetaspaceDumpPath=/home/admin/logs</li>
</ul>
<p>å¼‚æ­¥ GC æ—¥å¿— (8.5.9)</p>
<ul>
<li>-XX:+UseAsyncGCLog</li>
</ul>
</body></html>]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVMå‘å±•å†ç¨‹</title>
    <url>/p/a270ae4b.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="Javaå‘å±•çš„é‡å¤§äº‹ä»¶"><a href="#Javaå‘å±•çš„é‡å¤§äº‹ä»¶" class="headerlink" title="Javaå‘å±•çš„é‡å¤§äº‹ä»¶"></a>Javaå‘å±•çš„é‡å¤§äº‹ä»¶</h2><ul>
<li>1990å¹´ï¼Œåœ¨sunå…¬å¸ä¸­ï¼Œç”±Patrick naughtonã€mikesheridanä»¥åŠjames Goslingé¢†å¯¼çš„å°ç»„Green Teamï¼Œå¼€å‘å‡ºæ–°çš„ç¨‹åºè¯­è¨€ï¼Œå‘½åä¸ºOAKï¼ŒåæœŸæ›´åä¸ºJava</li>
<li>1995å¹´ï¼Œsunæ­£å¼å‘å¸ƒJavaå’ŒhotJAVAäº§å“ï¼ŒJavaé¦–æ¬¡å…¬å¼€äº®ç›¸ã€‚</li>
<li>1996å¹´1æœˆ23æ—¥sun Microsystemså‘å¸ƒäº†JDK1.0.</li>
<li>1998å¹´ï¼ŒJDK1.2ç‰ˆæœ¬å‘å¸ƒã€‚åŒæ—¶ï¼Œsunå‘å¸ƒäº†JSP/Servletã€EJBè§„èŒƒï¼Œä»¥åŠå°†Javaåˆ†æˆäº†J2EEã€J2SEå’ŒJ2MEã€‚è¿™è¡¨æ˜Javaå¼€å§‹å‘ä¼ä¸šã€æ¡Œé¢åº”ç”¨å’Œç§»åŠ¨è®¾å¤‡åº”ç”¨3å¤§é¢†åŸŸæŒºè¿›ã€‚</li>
<li>2000å¹´ï¼ŒJDK1.3å‘å¸ƒï¼ŒJava HotSpot Virtual Machineæ­£å¼å‘å¸ƒï¼Œæˆä¸ºJavaé»˜è®¤çš„è™šæ‹Ÿæœºã€‚</li>
<li>2002å¹´ï¼ŒJDK 1.4å‘å¸ƒï¼Œå¤è€çš„classicè™šæ‹Ÿæœºé€€å‡ºå†å²èˆå°ã€‚</li>
<li>2003å¹´åº•ï¼ŒJavaå¹³å°çš„scalaæ­£å¼å‘å¸ƒï¼ŒåŒå¹´Groovyä¹ŸåŠ å…¥äº†Javaé˜µè¥ã€‚</li>
<li>2004å¹´ï¼ŒJDK1.5å‘å¸ƒï¼ŒåŒæ—¶JDK1.5æ”¹åä¸ºJavaSE5.0.</li>
<li>2006å¹´ï¼ŒJDK 6å‘å¸ƒï¼ŒåŒå¹´Javaå¼€æºå¹¶å»ºç«‹äº†openJDKï¼Œé¡ºç†æˆç« ï¼ŒHotspotè™šæ‹Ÿæœºæˆä¸ºäº†OpenJDKä¸­é»˜è®¤çš„è™šæ‹Ÿæœºã€‚</li>
<li>2007å¹´ï¼ŒJavaå¹³å°è¿æ¥äº†æ–°ä¼™ä¼´Clojureã€‚</li>
<li>2008å¹´ï¼ŒOracleæ”¶è´­äº†BEAï¼Œå¾—åˆ°äº†JRockitè™šæ‹Ÿæœºã€‚</li>
<li>2009å¹´ï¼ŒTwitterå®£å¸ƒå°†åå°å¤§éƒ¨åˆ†ç¨‹åºä»rubyè¿ç§»åˆ°Scalaï¼Œè¿™æ˜¯Javaå¹³å°çš„æœ‰ä¸€æ¬¡å¤§è§„æ¨¡åº”ç”¨ã€‚</li>
<li>2010å¹´ï¼ŒOracleæ”¶è´­äº†sunï¼Œè·å¾—Javaå•†æ ‡å’Œæœ€å…·ä»·å€¼çš„hotspotè™šæ‹Ÿæœºã€‚æ­¤æ—¶Oracleæ‹¥æœ‰å¸‚åœºå ç”¨ç‡æœ€é«˜çš„ä¸¤æ¬¾è™šæ‹Ÿæœºhotspotå’ŒJRockitï¼Œå¹¶ä¸”è®¡åˆ’æœªæ¥è¿›è¡Œæ•´åˆï¼šHotRockitã€‚</li>
<li>2011å¹´ï¼ŒJDK7å‘å¸ƒï¼Œåœ¨JDKï¼‘.7ï½•4ä¸­ï¼Œæ­£å¼å¯ç”¨äº†æ–°çš„åƒåœ¾å›æ”¶å™¨G1.</li>
<li>2017å¹´ï¼ŒJDK9å‘å¸ƒï¼Œå°†G1è®¾ç½®ä¸ºé»˜è®¤GCï¼Œæ›¿ä»£CMSã€‚</li>
<li>2017åŒå¹´ï¼ŒIBMçš„J9å¼€æºï¼Œå½¢æˆäº†ç°åœ¨çš„open J9ç¤¾åŒºã€‚</li>
<li>2018å¹´ï¼ŒAndroidçš„Javaä¾µæƒæ¡ˆåˆ¤å†³ï¼ŒGoogleå…¬å¸èµ”å¿Oracleæ€»è®¡88äº¿ç¾å…ƒã€‚</li>
<li>2018åŒå¹´ï¼ŒOracleå®£å¸ƒJavaEEæˆä¸ºå†å²åè¯ï¼ŒJDBCã€JMSã€Servletèµ ä¸EclipseåŸºé‡‘ä¼šã€‚</li>
<li>2018åŒå¹´ï¼ŒJDK11å‘å¸ƒï¼ŒLTSç‰ˆæœ¬çš„JDKï¼Œå‘å¸ƒé©å‘½æ€§çš„ZGCï¼Œè°ƒæ•´JDKæˆæƒè®¸å¯ã€‚</li>
<li>2019å¹´ï¼ŒJDK12å‘å¸ƒï¼ŒåŠ å…¥RedHaté¢†å¯¼å¼€å‘çš„shenandoah GCã€‚</li>
<li>åœ¨JDK11ä¹‹å‰ï¼ŒOracleJDKè¿˜ä¼šå­˜åœ¨ä¸€äº›openJDKä¸­æ²¡æœ‰çš„ã€é—­æºçš„åŠŸèƒ½ã€‚ä½†åœ¨JDK11ä¸­ï¼ŒopenJDKå’ŒOracleJDKä»£ç å®è´¨ä¸Šå·²ç»è¾¾åˆ°å®Œå…¨ä¸€è‡´çš„ç¨‹åº¦ã€‚</li>
</ul>
<h2 id="JVMçš„å‘å±•å†ç¨‹"><a href="#JVMçš„å‘å±•å†ç¨‹" class="headerlink" title="JVMçš„å‘å±•å†ç¨‹"></a>JVMçš„å‘å±•å†ç¨‹</h2><h3 id="Sun-Classic-VM"><a href="#Sun-Classic-VM" class="headerlink" title="Sun Classic VM"></a>Sun Classic VM</h3><ul>
<li>1996å¹´éšJava1.0ç‰ˆæœ¬å‘å¸ƒï¼ŒJDK1.4æ—¶è¢«å®Œå…¨æ·˜æ±°ã€‚</li>
<li>å®ƒåªæä¾›è§£é‡Šå™¨ã€‚</li>
<li>å¦‚æœä½¿ç”¨JITç¼–è¯‘å™¨ï¼Œå°±éœ€è¦è¿›è¡Œå¤–æŒ‚ã€‚ä½†ä¸€æ—¦ä½¿ç”¨äº†JITç¼–è¯‘å™¨ï¼ŒJITä¼šæ¥ç®¡è™šæ‹Ÿæœºçš„æ‰§è¡Œç³»ç»Ÿã€‚è§£é‡Šå™¨å°±ä¸å†å·¥ä½œï¼Œè§£é‡Šå™¨å’Œç¼–è¯‘å™¨ä¸èƒ½é…åˆå·¥ä½œã€‚</li>
<li>ç°åœ¨hotspotå†…ç½®äº†æ­¤è™šæ‹Ÿæœº</li>
</ul>
<h3 id="Exact-VM"><a href="#Exact-VM" class="headerlink" title="Exact VM"></a>Exact VM</h3><ul>
<li>ä¸ºäº†è§£å†³ä¸Šä¸€ä¸ªè™šæ‹Ÿæœºé—®é¢˜ï¼ŒJDK1.2æ—¶ï¼ŒSunæä¾›äº†æ­¤è™šæ‹Ÿæœºã€‚</li>
<li>Exact Managementï¼šå‡†ç¡®å¼å†…å­˜ç®¡ç†<ul>
<li>è™šæ‹Ÿæœºå¯ä»¥çŸ¥é“å†…å­˜ä¸­æŸä¸ªä½ç½®çš„æ•°æ®æ˜¯ä»€ä¹ˆç±»å‹ã€‚</li>
</ul>
</li>
<li>å…·å¤‡ç°ä»£é«˜æ€§èƒ½è™šæ‹Ÿæœºçš„é›å½¢<ul>
<li>çƒ­ç‚¹æ¢æµ‹</li>
<li>ç¼–è¯‘å™¨ä¸è§£é‡Šå™¨æ··åˆå·¥ä½œæ¨¡å¼</li>
</ul>
</li>
<li>åªåœ¨Solariså¹³å°çŸ­æš‚ä½¿ç”¨ï¼Œå…¶å®ƒå¹³å°ä¸Šè¿˜æ˜¯Classic VM<ul>
<li>è‹±é›„æ°”çŸ­ï¼Œç»ˆè¢«Hotspotè™šæ‹Ÿæœºæ›¿æ¢</li>
</ul>
</li>
</ul>
<h3 id="Hotspot-VM"><a href="#Hotspot-VM" class="headerlink" title="Hotspot VM"></a>Hotspot VM</h3><ul>
<li>JDK1.3æ—¶ï¼ŒHotspot VMæˆä¸ºé»˜è®¤è™šæ‹Ÿæœº</li>
<li>ç›®å‰Hotspotå æœ‰ç»å¯¹çš„å¸‚åœºåœ°ä½ã€‚</li>
<li>HotspotæŒ‡çš„å°±æ˜¯çƒ­ç‚¹ä»£ç æ¢æµ‹æŠ€æœ¯ã€‚<ul>
<li>é€šè¿‡è®¡æ•°å™¨æ‰¾åˆ°æœ€å…·æœ‰ç¼–è¯‘ä»·å€¼çš„ä»£ç ï¼Œè§¦å‘å³æ—¶ç¼–è¯‘æˆ–æ ˆä¸Šæ›¿æ¢</li>
<li>é€šè¿‡ç¼–è¯‘å™¨ä¸è§£é‡Šå™¨ååŒå·¥ä½œï¼Œåœ¨æœ€ä¼˜åŒ–çš„ç¨‹åºå“åº”æ—¶é—´ä¸æœ€ä½³æ‰§è¡Œæ€§èƒ½ä¸­å–å¾—å¹³è¡¡ã€‚</li>
</ul>
</li>
</ul>
<h3 id="BEA-çš„-JRockit"><a href="#BEA-çš„-JRockit" class="headerlink" title="BEA çš„ JRockit"></a>BEA çš„ JRockit</h3><ul>
<li>ä¸“æ³¨äºæœåŠ¡å™¨ç«¯åº”ç”¨<ul>
<li>å®ƒå¯ä»¥ä¸å¤ªå…³æ³¨ç¨‹åºçš„å¯åŠ¨é€Ÿåº¦ï¼Œå› æ­¤JRockit å†…éƒ¨ä¸åŒ…å«è§£é‡Šå™¨å®ç°ï¼Œå…¨éƒ¨ä»£ç éƒ½é å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åæ‰§è¡Œã€‚</li>
</ul>
</li>
<li>å¤§é‡çš„è¡Œä¸šåŸºå‡†æµ‹è¯•æ˜¾ç¤ºï¼ŒJRockit JVMæ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„JVM<ul>
<li>æ˜¾è‘—çš„æ€§èƒ½æé«˜ï¼ˆä¸€äº›è¶…è¿‡äº†70%ï¼‰å’Œç¡¬ä»¶æˆæœ¬çš„å‡å°‘ï¼ˆè¾¾50%)</li>
</ul>
</li>
<li>ä¼˜åŠ¿å…¨é¢çš„Javaè¿è¡Œæ—¶è§£å†³æ–¹æ¡ˆç»„åˆ<ul>
<li>JRockit é¢å¯¹å»¶è¿Ÿæ•æ„Ÿå‹åº”ç”¨çš„è§£å†³æ–¹æ¡ˆJRockit Real Timeæä¾›ä»¥æ¯«ç§’æˆ–å¾®å¦™çº§çš„JVMå“åº”æ—¶é—´ï¼Œé€‚åˆè´¢åŠ¡ã€å†›äº‹æŒ‡æŒ¥ã€ç”µä¿¡ç½‘ç»œçš„éœ€è¦ã€‚</li>
<li>Mission ControlæœåŠ¡å¥—ä»¶ï¼šä»¥æä½çš„å¼€é”€æ¥ç›‘æ§ã€ç®¡ç†å’Œåˆ†æç”Ÿäº§ç¯å¢ƒä¸­çš„åº”ç”¨ç¨‹åºçš„å·¥å…·</li>
</ul>
</li>
<li>2008å¹´ï¼ŒBEAè¢«Oracleæ”¶è´­</li>
<li>Oracleå¤§è‡´åœ¨JDK8åœ¨Hotspotä¸Šç§»æ¤äº†JRockitçš„ä¼˜ç§€ç‰¹å¾ã€‚</li>
</ul>
<h3 id="IBM-çš„J9"><a href="#IBM-çš„J9" class="headerlink" title="IBM çš„J9"></a>IBM çš„J9</h3><ul>
<li>å…¨ç§°ï¼šIBM Technology for Java Virtual Machine,ç®€ç§°IT4Jï¼Œå†…éƒ¨ä»£å·ï¼šJ9</li>
<li>å¸‚åœºå®šä½ä¸Hotspotæ¥è¿‘ï¼ŒæœåŠ¡å™¨ç«¯ã€æ¡Œé¢åº”ç”¨ã€åµŒå…¥å¼ç­‰å¤šç”¨é€”JVM</li>
<li>å¹¿æ³›ç”¨äºIBMçš„å„ç§Javaäº§å“ã€‚</li>
<li>ç›®å‰ï¼Œæœ‰å½±å“åŠ›çš„ä¸‰å¤§å•†ç”¨è™šæ‹Ÿæœºä¹‹ä¸€ï¼Œä¹Ÿæ˜¯å·ç§°æ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„Javaè™šæ‹Ÿæœºã€‚</li>
<li>2017å¹´å·¦å³ï¼ŒIBMå‘å¸ƒäº†å¼€æºJ9 VMï¼Œå‘½åä¸ºOpenJ9ï¼Œäº¤ç»™EclipseåŸºé‡‘ä¼šç®¡ç†ï¼Œä¹Ÿç§°ä¸º Eclipse OpenJ9</li>
</ul>
</body></html>]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVM åƒåœ¾å›æ”¶</title>
    <url>/p/d6094941.html</url>
    <content><![CDATA[<html><head></head><body><p>å½“Javaç¨‹åºè¿è¡Œæ—¶ï¼Œæ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡å°±æ˜¯åƒåœ¾ï¼ŒJVMä¼šå¯¹å†…å­˜è¿›è¡Œè‡ªåŠ¨åˆ†é…ä¸å›æ”¶ï¼Œå…¶ä¸­GCçš„ä¸»è¦ä½œç”¨å°±æ˜¯æ¸…é™¤è¿™äº›åƒåœ¾ï¼Œè‡ªåŠ¨é‡Šæ”¾å†…å­˜ã€‚</p>
<h2 id="åƒåœ¾å›æ”¶çš„ç›¸å…³æ¦‚å¿µ"><a href="#åƒåœ¾å›æ”¶çš„ç›¸å…³æ¦‚å¿µ" class="headerlink" title="åƒåœ¾å›æ”¶çš„ç›¸å…³æ¦‚å¿µ"></a>åƒåœ¾å›æ”¶çš„ç›¸å…³æ¦‚å¿µ</h2><h3 id="FGC-FULL-GC"><a href="#FGC-FULL-GC" class="headerlink" title="FGC(FULL GC)"></a>FGC(FULL GC)</h3><p>æ”¶é›†æ•´ä¸ªå †ï¼ŒåŒ…æ‹¬æ–°ç”Ÿä»£ï¼Œè€å¹´ä»£ï¼Œæ°¸ä¹…ä»£æˆ–å…ƒæ•°æ®ç©ºé—´ã€‚</p>
<h3 id="System-gc"><a href="#System-gc" class="headerlink" title="System.gc()"></a>System.gc()</h3><p>è°ƒç”¨<code>System.gc()</code>æˆ–è€…<code>Runtime.getRuntime().gc()</code>ä¼šæ˜¾å¼è§¦å‘fgc(Full GC)ï¼Œä½†Javaè¯­è¨€è§„èŒƒäº†ï¼Œå¹¶ä¸ä¿è¯GCä¸€å®šä¼šæ‰§è¡Œã€‚jvmæœ‰è‡ªå·±çš„gcç­–ç•¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ— éœ€æ‰‹åŠ¨è§¦å‘ã€‚</p>
<h3 id="å†…å­˜æº¢å‡º"><a href="#å†…å­˜æº¢å‡º" class="headerlink" title="å†…å­˜æº¢å‡º"></a>å†…å­˜æº¢å‡º</h3><p>åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œç»™ä¸€ä¸ªå¯¹è±¡åˆ†é…å†…å­˜ç©ºé—´æ—¶ï¼Œæ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ã€‚å¯¹åº”çš„å¼‚å¸¸æ˜¯OutOfMemoryErrorï¼Œç®€ç§°OOMã€‚</p>
<h3 id="å†…å­˜æ³„æ¼"><a href="#å†…å­˜æ³„æ¼" class="headerlink" title="å†…å­˜æ³„æ¼"></a>å†…å­˜æ³„æ¼</h3><p>ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼ŒæŒç»­å æœ‰å†…å­˜å¾—ä¸åˆ°åŠæ—¶çš„é‡Šæ”¾ï¼ˆGCæ— æ³•å›æ”¶è¿™äº›ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼‰ï¼Œä»è€Œé€ æˆå†…å­˜ç©ºé—´çš„æµªè´¹æˆä¸ºå†…å­˜æ³„æ¼ã€‚</p>
<h3 id="STW-Stop-The-World"><a href="#STW-Stop-The-World" class="headerlink" title="STW(Stop The World)"></a>STW(Stop The World)</h3><p>GCäº‹ä»¶å‘ç”Ÿè¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿåº”ç”¨ç¨‹åºçš„åœé¡¿ï¼Œæ•´ä¸ªåº”ç”¨ç¨‹åºéƒ½ä¼šè¢«æš‚åœã€‚ä¸‹é¢å³å°†ä»‹ç»çš„å¯è¾¾æ€§åˆ†æç®—æ³•ä¼šå¯¼è‡´STWï¼Œå› ä¸ºï¼š</p>
<ol>
<li>åˆ†æå·¥ä½œå¿…é¡»åœ¨ä¸€ä¸ªèƒ½ç¡®ä¿ä¸€è‡´æ€§çš„å¿«ç…§ä¸­è¿›è¡Œï¼›</li>
<li>ä¸€è‡´æ€§æŒ‡æ•´ä¸ªåˆ†ææœŸé—´æ•´ä¸ªæ‰§è¡Œç³»ç»Ÿçœ‹èµ·æ¥åƒè¢«å†»ç»“åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šï¼›</li>
<li>å¦‚æœåˆ†æè¿‡ç¨‹ä¸­å¯¹è±¡å¼•ç”¨å…³ç³»è¿˜åœ¨ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœçš„å‡†ç¡®æ€§æ— æ³•ä¿è¯ã€‚</li>
</ol>
<p>GCå®Œæˆä¹‹åï¼ŒSTWä¾¿éšä¹‹ç»“æŸã€‚</p>
<h2 id="Javaä¸­çš„å¼•ç”¨ç±»å‹-Reference"><a href="#Javaä¸­çš„å¼•ç”¨ç±»å‹-Reference" class="headerlink" title="Javaä¸­çš„å¼•ç”¨ç±»å‹(Reference)"></a>Javaä¸­çš„å¼•ç”¨ç±»å‹(Reference)</h2><p>JDK1.2ä¹‹åï¼ŒJavaå¯¹å¼•ç”¨çš„æ¦‚å¿µè¿›è¡Œäº†æ‰©å……ï¼Œåˆ†ä¸ºå¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰ã€è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰ã€å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰ã€è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰å’Œç»ˆç»“å™¨å¼•ç”¨ï¼ˆFinal Referenceï¼‰ï¼š</p>
<p><img src="/p/d6094941/image-20230713004444156.png" alt="image-20230713004444156"></p>
<h3 id="å¼ºå¼•ç”¨ï¼šä¸å›æ”¶"><a href="#å¼ºå¼•ç”¨ï¼šä¸å›æ”¶" class="headerlink" title="å¼ºå¼•ç”¨ï¼šä¸å›æ”¶"></a>å¼ºå¼•ç”¨ï¼šä¸å›æ”¶</h3><p>æœ€ä¼ ç»Ÿçš„å¼•ç”¨å®šä¹‰ï¼Œç¨‹åºä¸­æ™®éå­˜åœ¨çš„å¼•ç”¨èµ‹å€¼ï¼Œç±»ä¼¼<code>Object o = new Object()</code>è¿™ç§å¼•ç”¨å…³ç³»ã€‚æ— è®ºåœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œåªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜åœ¨ï¼Œåƒåœ¾å›æ”¶å™¨å°±æ°¸è¿œä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚æ‰€ä»¥ï¼Œ<strong>å¼ºå¼•ç”¨æ˜¯é€ æˆJavaå†…å­˜æ³„éœ²çš„ä¸»è¦åŸå› ä¹‹ä¸€</strong>ã€‚</p>
<h3 id="è½¯å¼•ç”¨ï¼šå†…å­˜ä¸è¶³å³å›æ”¶"><a href="#è½¯å¼•ç”¨ï¼šå†…å­˜ä¸è¶³å³å›æ”¶" class="headerlink" title="è½¯å¼•ç”¨ï¼šå†…å­˜ä¸è¶³å³å›æ”¶"></a>è½¯å¼•ç”¨ï¼šå†…å­˜ä¸è¶³å³å›æ”¶</h3><p>è½¯å¼•ç”¨æ˜¯ç”¨æ¥æè¿°ä¸€äº›è¿˜æœ‰ç”¨ï¼Œä½†éå¿…éœ€çš„å¯¹è±¡ã€‚åªè¢«è½¯å¼•ç”¨å…³è”ç€çš„å¯¹è±¡ï¼Œåœ¨ç³»ç»Ÿå³å°†è¦å‘ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸å‰ï¼Œä¼šè¢«æ”¾å…¥åˆ°Reference Queueï¼Œè¿›è¡ŒäºŒæ¬¡å›æ”¶ã€‚ç®€è€Œè¨€ä¹‹å°±æ˜¯å†…å­˜ä¸è¶³æ—¶å›æ”¶ã€‚</p>
<p>è½¯å¼•ç”¨å¸¸ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„ç¼“å­˜ï¼Œæ¯”å¦‚å†…å­˜å……è¶³æ—¶ï¼Œå°±æ˜¯ç”¨ç¼“å­˜ï¼Œå†…å­˜ä¸è¶³æ—¶å°±æ¸…é™¤ç¼“å­˜ï¼Œé¿å…ç¨‹åºOOMã€‚</p>
<p>è½¯å¼•ç”¨ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">SoftReference&lt;Object&gt; softReference = <span class="keyword">new</span> <span class="title class_">SoftReference</span>&lt;&gt;(obj);</span><br><span class="line">obj = <span class="literal">null</span>;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="å¼±å¼•ç”¨ï¼šå‘ç°å³å›æ”¶"><a href="#å¼±å¼•ç”¨ï¼šå‘ç°å³å›æ”¶" class="headerlink" title="å¼±å¼•ç”¨ï¼šå‘ç°å³å›æ”¶"></a>å¼±å¼•ç”¨ï¼šå‘ç°å³å›æ”¶</h3><p>å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å‘ç”Ÿä¸ºæ­¢ã€‚åœ¨ç³»ç»ŸGCæ—¶ï¼Œåªè¦å‘ç”Ÿå¼±å¼•ç”¨ï¼Œä¸ç®¡ç³»ç»Ÿå †ç©ºé—´æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›æ”¶ã€‚ç®€è€Œè¨€ä¹‹å°±æ˜¯å‘ç°å³å›æ”¶ã€‚</p>
<p>å¼±å¼•ç”¨ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">WeakReference&lt;Object&gt; weakReference = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;&gt;(obj);</span><br><span class="line">obj = <span class="literal">null</span>;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="è™šå¼•ç”¨ï¼šå¯¹è±¡å›æ”¶è·Ÿè¸ª"><a href="#è™šå¼•ç”¨ï¼šå¯¹è±¡å›æ”¶è·Ÿè¸ª" class="headerlink" title="è™šå¼•ç”¨ï¼šå¯¹è±¡å›æ”¶è·Ÿè¸ª"></a>è™šå¼•ç”¨ï¼šå¯¹è±¡å›æ”¶è·Ÿè¸ª</h3><ul>
<li><p>ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…å­˜åœ¨è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå’Œæ²¡æœ‰å¼•ç”¨å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œéšæ—¶éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚</p>
</li>
<li><p>è™šå¼•ç”¨ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥è·å–è¢«å¼•ç”¨çš„å¯¹è±¡ï¼Œå½“è°ƒç”¨è™šå¼•ç”¨çš„getæ–¹æ³•è·å–å¯¹è±¡æ—¶ï¼Œå°†è¿”å›nullã€‚</p>
</li>
<li><p>ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„åœ¨äºè·Ÿè¸ªåƒåœ¾å›æ”¶è¿‡ç¨‹ã€‚æ¯”å¦‚ï¼šèƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚</p>
</li>
</ul>
<p>è™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">ReferenceQueue&lt;Object&gt; referenceQueue = <span class="keyword">new</span> <span class="title class_">ReferenceQueue</span>&lt;&gt;();</span><br><span class="line">PhantomReference&lt;Object&gt; phantomReference = <span class="keyword">new</span> <span class="title class_">PhantomReference</span>&lt;&gt;(obj, referenceQueue);</span><br><span class="line">obj = <span class="literal">null</span>;</span><br><span class="line">phantomReference.get(); <span class="comment">// null</span></span><br></pre></td></tr></tbody></table></figure>

<p>è™šå¼•ç”¨å¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶åï¼Œä¼šå°†è¿™ä¸ªè™šå¼•ç”¨åŠ å…¥å¼•ç”¨é˜Ÿåˆ—ï¼Œå·²é€šçŸ¥åº”ç”¨ç¨‹åºå¯¹è±¡å›æ”¶æƒ…å†µã€‚è™šå¼•ç”¨çš„å”¯ä¸€ä½œç”¨æ˜¯ç”¨äºè·Ÿè¸ªåƒåœ¾å›æ”¶è¿‡ç¨‹ï¼ˆé€šè¿‡è§‚å¯Ÿå¼•ç”¨é˜Ÿåˆ—é‡Œæ˜¯å¦æœ‰å¯¹åº”çš„è™šå¼•ç”¨ï¼‰ã€‚</p>
<h3 id="ç»ˆç»“å™¨å¼•ç”¨"><a href="#ç»ˆç»“å™¨å¼•ç”¨" class="headerlink" title="ç»ˆç»“å™¨å¼•ç”¨"></a>ç»ˆç»“å™¨å¼•ç”¨</h3><ul>
<li>å®ƒç”¨äºå®ç°å¯¹è±¡çš„finalizeï¼ˆï¼‰æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºç»ˆç»“å™¨å¼•ç”¨ã€‚</li>
<li>æ— éœ€æ‰‹åŠ¨ç¼–ç ï¼Œ<strong>å…¶å†…éƒ¨é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨ã€‚</strong></li>
<li>åœ¨GCæ—¶ï¼Œ ç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿã€‚ç”±Finalizerçº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨å®ƒçš„finalizeï¼ˆï¼‰æ–¹æ³•ï¼Œç¬¬äºŒæ¬¡GCæ—¶æ‰èƒ½å›æ”¶è¢«å¼•ç”¨å¯¹è±¡ã€‚</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang.ref;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Final references, used to implement finalization</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FinalReference</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">Reference</span>&lt;T&gt; {</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FinalReference</span><span class="params">(T referent, ReferenceQueue&lt;? <span class="built_in">super</span> T&gt; q)</span> {</span><br><span class="line">        <span class="built_in">super</span>(referent, q);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h2 id="åƒåœ¾å›æ”¶ç®—æ³•"><a href="#åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="åƒåœ¾å›æ”¶ç®—æ³•"></a>åƒåœ¾å›æ”¶ç®—æ³•</h2><p>åƒåœ¾å›æ”¶åˆ†ä¸º<strong>æ ‡è®°é˜¶æ®µ</strong>ï¼ˆå¯¹è±¡å­˜æ´»åˆ¤æ–­ï¼‰å’Œ<strong>æ¸…é™¤é˜¶æ®µ</strong>ï¼ˆåƒåœ¾å¯¹è±¡å›æ”¶ï¼‰ã€‚</p>
<ol>
<li>æ ‡è®°é˜¶æ®µ</li>
</ol>
<p>åœ¨å †ä¸­å­˜æ”¾è¿™å‡ ä¹æ‰€æœ‰çš„Javaå¯¹è±¡å®ä¾‹ï¼Œåœ¨GCæ‰§è¡Œåƒåœ¾å›æ”¶ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦åŒºåˆ†å‡ºå†…å­˜ä¸­å“ªäº›æ˜¯å­˜æ´»å¯¹è±¡ï¼Œå“ªäº›æ˜¯å·²æ­»äº¡å¯¹è±¡ã€‚åªæœ‰è¢«æ ‡è®°ä¸ºå·²ç»æ­»äº¡çš„å¯¹è±¡ï¼ŒGCæ‰ä¼šè¿›è¡Œå›æ”¶ã€‚è¿™ä¸ªé˜¶æ®µçš„ç®—æ³•åŒ…æ‹¬<strong>å¼•ç”¨è®¡æ•°æ³•</strong>å’Œ<strong>å¯è¾¾æ€§åˆ†æç®—æ³•</strong>ï¼›</p>
<ol start="2">
<li>æ¸…é™¤é˜¶æ®µ</li>
</ol>
<p>å½“æˆåŠŸåˆ†å‡ºå­˜æ´»å’Œæ­»äº¡å¯¹è±¡ä¹‹åï¼ŒGCæ¥ä¸‹æ¥çš„ä»»åŠ¡å°±æ˜¯æ‰§è¡Œåƒåœ¾å›æ”¶ï¼Œé‡Šæ”¾å†…å­˜ã€‚ç›®å‰JVMä¸­æ¯”è¾ƒå¸¸è§çš„ä¸‰ç§åƒåœ¾ç®—æ³•åˆ†åˆ«æ˜¯<strong>æ ‡è®°æ¸…é™¤ç®—æ³•</strong>ã€<strong>å¤åˆ¶ç®—æ³•</strong>ã€<strong>æ ‡è®°å‹ç¼©ç®—æ³•</strong>ã€‚</p>
<h3 id="å¼•ç”¨è®¡æ•°ç®—æ³•"><a href="#å¼•ç”¨è®¡æ•°ç®—æ³•" class="headerlink" title="å¼•ç”¨è®¡æ•°ç®—æ³•"></a>å¼•ç”¨è®¡æ•°ç®—æ³•</h3><p>å¼•ç”¨è®¡æ•°ç®—æ³•ï¼ˆReference Countingï¼‰ç®—æ³•å¯¹æ¯ä¸ªå¯¹è±¡ä¿å­˜ä¸€ä¸ªæ•´å‹çš„å¼•ç”¨è®¡æ•°å™¨å±æ€§ï¼Œç”¨äºè®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µã€‚å¯¹äºä¸€ä¸ªå¯¹è±¡Objectï¼Œåªè¦æœ‰ä»»ä½•ä¸€ä¸ªå¯¹è±¡å¼•ç”¨äº†å®ƒï¼Œåˆ™å®ƒçš„å¼•ç”¨è®¡æ•°å™¨åŠ 1ï¼Œå¼•ç”¨å¤±æ•ˆæ—¶ï¼Œå¼•ç”¨è®¡æ•°å™¨å°±å‡1ã€‚æ‰€ä»¥å½“ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨å€¼ä¸º0æ—¶ï¼Œè¯´æ˜è¯¥å¯¹è±¡ä¸å†è¢«å¼•ç”¨ï¼Œå¯è¿›è¡Œå›æ”¶ã€‚</p>
<p>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ï¼Œåƒåœ¾å›æ”¶æ²¡æœ‰å»¶è¿Ÿï¼›</p>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>è®¡æ•°å™¨çš„å­˜åœ¨å¢åŠ äº†å­˜å‚¨ç©ºé—´çš„å¼€é”€ï¼›</li>
<li>æ¯æ¬¡èµ‹å€¼éƒ½éœ€è¦æ›´æ–°è®¡æ•°å™¨ï¼Œå¢åŠ äº†ç¨‹åºæ—¶é—´å¼€é”€ï¼›</li>
<li>è‡´å‘½é—®é¢˜ï¼šæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨çš„æƒ…å†µï¼ˆæ­£å› ä¸ºå¦‚æ­¤ï¼ŒJavaå‹æ ¹æ²¡æœ‰ä½¿ç”¨è¯¥ç®—æ³•ï¼‰ã€‚</li>
</ol>
<p>ä¸¾ä¸ªå¾ªç¯å¼•ç”¨çš„ä¾‹å­ï¼š</p>
<p><img src="/p/d6094941/QQ20200903-100656@2x.png" alt="QQ20200903-100656@2x"></p>
<p>ä¸Šé¢ä¾‹å­ä¸­ï¼ŒObject1çš„å¼•ç”¨è®¡æ•°å™¨å€¼ä¸º1ï¼Œä½†å®é™…å¯èƒ½è¿™ä¸‰ä¸ªå¯¹è±¡éƒ½å·²ç»ä¸å†è¢«ä½¿ç”¨ï¼Œå®ƒä»¬çš„å¼•ç”¨è®¡æ•°å™¨çš„å€¼éƒ½ä¸ä¸º0ï¼Œæ— æ³•è¢«å›æ”¶ï¼Œè¿™å°±å¯¼è‡´äº†å†…å­˜æ³„éœ²ã€‚</p>
<h3 id="å¯è¾¾æ€§åˆ†æç®—æ³•"><a href="#å¯è¾¾æ€§åˆ†æç®—æ³•" class="headerlink" title="å¯è¾¾æ€§åˆ†æç®—æ³•"></a>å¯è¾¾æ€§åˆ†æç®—æ³•</h3><p>å¯è¾¾æ€§åˆ†æç®—æ³•åŒæ ·å…·å¤‡å®ç°ç®€å•æ‰§è¡Œé«˜æ•ˆç­‰ç‰¹ç‚¹ï¼Œå¹¶ä¸”è¿˜è§£å†³äº†å¼•ç”¨è®¡æ•°ç®—æ³•æ— æ³•å¤„ç†çš„å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œå¯è¾¾æ€§åˆ†æç®—æ³•ä¹Ÿå«æ ¹æœç´¢ç®—æ³•ã€è¿½è¸ªæ€§åƒåœ¾æ”¶é›†ç®—æ³•ã€‚</p>
<h4 id="å¯è¾¾æ€§åˆ†æç®—æ³•çš„åŸºæœ¬æ€è·¯"><a href="#å¯è¾¾æ€§åˆ†æç®—æ³•çš„åŸºæœ¬æ€è·¯" class="headerlink" title="å¯è¾¾æ€§åˆ†æç®—æ³•çš„åŸºæœ¬æ€è·¯"></a>å¯è¾¾æ€§åˆ†æç®—æ³•çš„åŸºæœ¬æ€è·¯</h4><ol>
<li>ä»¥æ ¹å¯¹è±¡é›†åˆï¼ˆGC Rootsï¼‰ä¸ºèµ·ç‚¹ï¼Œä»ä¸Šè‡³ä¸‹æœç´¢è¢«æ ¹å¯¹è±¡è¿æ¥çš„ç›®æ ‡å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œæœç´¢èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼›</li>
<li>å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿ï¼Œåˆ™æ˜¯ä¸å¯è¾¾çš„ï¼Œæ„å‘³ç€å¯¹è±¡å·²ç»æ­»äº¡å±äºåƒåœ¾ï¼›</li>
<li>åªæœ‰é‚£äº›èƒ½å¤Ÿè¢«æ ¹å¯¹è±¡é›†åˆç›´æ¥æˆ–è€…é—´æ¥è¿æ¥çš„å¯¹è±¡æ‰æ˜¯å­˜æ´»å¯¹è±¡ã€‚</li>
</ol>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/p/d6094941/QQ20200903-102802@2x.png" alt="QQ20200903-102802@2x"></p>
<p>ç»¿è‰²å¯¹è±¡ä¸ºå­˜æ´»å¯¹è±¡ï¼Œå®ƒä»¬ç›´æ¥æˆ–é—´æ¥ä¸GC Rootsç›¸è¿ï¼Œæ©™è‰²å¯¹è±¡ä¸ºå¯å›æ”¶å¯¹è±¡ã€‚</p>
<p>é‚£ä¹ˆå“ªäº›å¯¹è±¡å¯ä»¥ä½œä¸ºGC Rootså‘¢ï¼ŸJavaä¸­ï¼ŒGC RootsåŒ…æ‹¬ä»¥ä¸‹å‡ ç±»å…ƒç´ ï¼š</p>
<ol>
<li>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ï¼›</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆå†…å¼•ç”¨çš„å¯¹è±¡ï¼›</li>
<li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ï¼Œå¦‚Javaç±»çš„å¼•ç”¨ç±»å‹é™æ€å˜é‡ï¼›</li>
<li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ï¼›</li>
<li>æ‰€æœ‰è¢«synchronizedæŒæœ‰çš„å¯¹è±¡ï¼›</li>
<li>Javaè™šæ‹Ÿæœºå†…éƒ¨å¼•ç”¨ï¼›</li>
<li>åæ˜ Javaè™šæ‹Ÿæœºå†…éƒ¨æƒ…å†µçš„JMXBeanã€JVMTIä¸­æ³¨å†Œçš„å›è°ƒã€æœ¬åœ°ä»£ç ç¼“å­˜ç­‰ã€‚</li>
</ol>
<p>åœ¨ä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•åˆ¤æ–­å†…å­˜æ˜¯å¦å¯å›æ”¶æ—¶ï¼Œåˆ†æå·¥ä½œå¿…é¡»åœ¨ä¸€ä¸ªèƒ½ä¿éšœä¸€è‡´æ€§çš„å¿«ç…§ä¸­è¿›è¡Œã€‚è¿™ç‚¹ä¹Ÿæ˜¯å¯¼è‡´GCè¿›è¡Œæ—¶å¿…é¡»STWçš„ä¸€ä¸ªé‡è¦åŸå› ã€‚</p>
<h4 id="å¯¹è±¡å¤æ´»æ¼”ç¤º"><a href="#å¯¹è±¡å¤æ´»æ¼”ç¤º" class="headerlink" title="å¯¹è±¡å¤æ´»æ¼”ç¤º"></a>å¯¹è±¡å¤æ´»æ¼”ç¤º</h4><p>å¯¹è±¡çš„finalizationæœºåˆ¶ï¼šå½“åƒåœ¾å›æ”¶å™¨å›æ”¶ä¸€ä¸ªåƒåœ¾å¯¹è±¡ä¹‹å‰ï¼Œæ€»ä¼šå…ˆè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„<code>finalize()</code>æ–¹æ³•ï¼Œç”¨äºåœ¨å¯¹è±¡å›æ”¶æ—¶è¿›è¡Œèµ„æºé‡Šæ”¾ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable { }</span><br></pre></td></tr></tbody></table></figure>

<p><code>finalize()</code>æ–¹æ³•ä¸ºObjectçš„ä¸€ä¸ªéfinalæ–¹æ³•ï¼Œæ‰€ä»¥å­ç±»å¯ä»¥è¿›è¡Œé‡å†™ã€‚</p>
<p>å› ä¸º<code>finalize()</code>æ–¹æ³•çš„å­˜åœ¨ï¼ŒJavaä¸­ä¸€ä¸ªå¯¹è±¡å¯èƒ½å¤„äºä¸‰ç§çŠ¶æ€ï¼š</p>
<ol>
<li>å¯è§¦åŠçš„ï¼Œä»GC Rootså¼€å§‹å¯ä»¥åˆ°è¾¾è¯¥å¯¹è±¡ï¼›</li>
<li>å¯å¤æ´»çš„ï¼Œå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«é‡Šæ”¾ï¼Œä½†å¯¹è±¡å¯èƒ½åœ¨<code>finalize()</code>æ–¹æ³•ä¸­å¤æ´»ï¼›</li>
<li>ä¸å¯è§¦åŠçš„ï¼Œå¯¹è±¡çš„<code>finalize()</code>æ–¹æ³•è¢«è°ƒç”¨ï¼Œå¹¶ä¸”æ²¡æœ‰å¤æ´»ã€‚ä¸å¯è§¦åŠçš„å¯¹è±¡ä¸å¯èƒ½è¢«å¤æ´»ï¼Œ<strong>å› ä¸º<code>finalize()</code>æ–¹æ³•åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡</strong>ã€‚</li>
</ol>
<p>åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶éœ€è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ï¼š</p>
<ol>
<li>å¦‚æœå¯¹è±¡åˆ°GC Rootsæ²¡æœ‰å¼•ç”¨é“¾ï¼Œé‚£ä¹ˆè¿›è¡Œç¬¬ä¸€æ¬¡æ ‡è®°ï¼›</li>
<li>å¯¹å·²ç»æ ‡è®°äº†çš„å¯¹è±¡è¿›è¡Œç­›é€‰ï¼Œåˆ¤æ–­å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œ<code>finalize()</code>æ–¹æ³•ï¼š<ul>
<li>å¦‚æœå¯¹è±¡æ²¡æœ‰é‡å†™<code>finalize()</code>æ–¹æ³•ï¼Œæˆ–è€…<code>finalize()</code>æ–¹æ³•å·²ç»è¢«è°ƒç”¨è¿‡ï¼Œåˆ™è¯¥å¯¹è±¡æ˜¯ä¸å¯è§¦åŠçš„ï¼›</li>
<li>å¦‚æœé‡å†™äº†ï¼Œä½†è¿˜æ²¡æ‰§è¡Œè¿‡ï¼Œåˆ™è¯¥å¯¹è±¡ä¼šè¢«æ”¾å…¥F-Queueé˜Ÿåˆ—ï¼›</li>
<li>GCå¯¹F-Queueé˜Ÿåˆ—ä¸­çš„å¯¹è±¡è¿›è¡Œéå†ï¼Œå¦‚æœå¯¹è±¡åœ¨<code>finalize()</code>æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»æ„ä¸€ä¸ªå¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡è¢«å¤æ´»ï¼Œä»F-Queueé˜Ÿåˆ—ä¸­ç§»å‡ºã€‚å½“è¯¥å¯¹è±¡å†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨çš„æƒ…å†µæ—¶ï¼Œ<code>finalize()</code>æ–¹æ³•ä¸ä¼šå†è¢«è°ƒç”¨ï¼Œè¯¥å¯¹è±¡ç›´æ¥è¢«åˆ¤å®šä¸ºä¸å¯è§¦åŠã€‚</li>
</ul>
</li>
</ol>
<p><code>finalize()</code>æ–¹æ³•æ‰§è¡Œæ˜¯ç”±è™šæ‹Ÿæœºè‡ªåŠ¨åˆ›å»ºçš„ä½ä¼˜å…ˆçº§çš„Finalizerçº¿ç¨‹è§¦å‘ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1200</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨mainçº¿ç¨‹ï¼Œè®©ç¨‹åºé˜»å¡ï¼Œç„¶åç”¨jvisualvmè§‚å¯Ÿçº¿ç¨‹çŠ¶æ€ï¼š</p>
<p><img src="/p/d6094941/image-20230713010613556.png" alt="image-20230713010613556"></p>
<p>ä¸¾ä¸ªå¯¹è±¡é€šè¿‡<code>finalize()</code>æ–¹æ³•å¤æ´»çš„ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é™æ€ç±»å˜é‡ï¼Œå±äºGC Roots</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Main obj;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"finalizeæ–¹æ³•ä¸­ä¸åšä»»ä½•äº‹æƒ…"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            obj = <span class="keyword">new</span> <span class="title class_">Main</span>();</span><br><span class="line">            <span class="comment">// ç§»é™¤å¯¹è±¡å¼•ç”¨é“¾</span></span><br><span class="line">            obj = <span class="literal">null</span>;</span><br><span class="line">            System.gc();</span><br><span class="line">            System.out.println(<span class="string">"ç¬¬ä¸€æ¬¡GC"</span>);</span><br><span class="line">            <span class="comment">// å› ä¸ºFinalizerçº¿ç¨‹ä¼˜å…ˆçº§å¾ˆä½ï¼Œè®©ç¨‹åºæš‚åœ2ç§’ï¼Œç¡®ä¿finalize()æ–¹æ³•è°ƒç”¨</span></span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            isAlive(obj);</span><br><span class="line"></span><br><span class="line">            obj = <span class="literal">null</span>;</span><br><span class="line">            System.gc();</span><br><span class="line">            System.out.println(<span class="string">"ç¬¬äºŒæ¬¡GC"</span>);</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            isAlive(obj);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isAlive</span><span class="params">(Object obj)</span> {</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="literal">null</span>) {</span><br><span class="line">            System.out.println(<span class="string">"å¯¹è±¡å·²æ­»"</span>);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            System.out.println(<span class="string">"å¯¹è±¡è¿˜æ´»ç€"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸Šé¢ä»£ç ä¸­ï¼ŒMainç±»é‡å†™äº†finalize()æ–¹æ³•ï¼Œä½†æ–¹æ³•å†…æ²¡æœ‰å¯ä»¥è®©å¯¹è±¡å¤æ´»çš„é€»è¾‘ã€‚ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">finalizeæ–¹æ³•ä¸­ä¸åšä»»ä½•äº‹æƒ…</span><br><span class="line">ç¬¬ä¸€æ¬¡GC</span><br><span class="line">å¯¹è±¡å·²æ­»</span><br><span class="line">ç¬¬äºŒæ¬¡GC</span><br><span class="line">å¯¹è±¡å·²æ­»</span><br></pre></td></tr></tbody></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œå°†objç½®ä¸ºnullåï¼Œç¬¬ä¸€æ¬¡GCï¼Œè¯¥å¯¹è±¡å°±å·²ç»è¢«å›æ”¶ã€‚</p>
<p>ä¸‹é¢å¾€<code>finalize()</code>æ–¹æ³•ä¸­æ·»åŠ é€»è¾‘ï¼Œè®©å¯¹è±¡å¤æ´»ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> {</span><br><span class="line">    System.out.println(<span class="string">"å¤æ´»obj"</span>);</span><br><span class="line">    <span class="comment">// å¤æ´»å¯¹è±¡</span></span><br><span class="line">    obj = <span class="built_in">this</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">ç¬¬ä¸€æ¬¡GC</span><br><span class="line">å¤æ´»obj</span><br><span class="line">å¯¹è±¡è¿˜æ´»ç€</span><br><span class="line">ç¬¬äºŒæ¬¡GC</span><br><span class="line">å¯¹è±¡å·²æ­»</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸Šé¢ä¾‹å­ä¹Ÿè¯æ˜äº†<code>finalize()</code>æ–¹æ³•æœ€å¤šåªè¢«æ‰§è¡Œä¸€æ¬¡ã€‚</p>
<p>ä¸¥ç¦ä¸»åŠ¨è°ƒç”¨æŸä¸ªå¯¹è±¡çš„finalize()æ–¹æ³•ï¼Œåº”è¯¥äº¤ç»™åƒåœ¾å›æ”¶æœºåˆ¶è°ƒç”¨ï¼Œå› ä¸ºï¼š</p>
<ol>
<li>åœ¨finalize()æ–¹æ³•é‡Œå¯èƒ½å¯¼è‡´å¯¹è±¡å¤æ´»ï¼› </li>
<li>finalize()æ–¹æ³•æ‰§è¡Œæ—¶é—´æ²¡æœ‰ä¿éšœï¼Œå¦‚æœå¯¹è±¡ä¸è¢«å›æ”¶ï¼Œfinalize()æ–¹æ³•æ²¡æœ‰æ‰§è¡Œæœºä¼šï¼›</li>
<li>ä¸€ä¸ªç³Ÿç³•çš„finalize()æ–¹æ³•ä¼šä¸¥é‡å½±å“GCæ€§èƒ½ã€‚</li>
</ol>
<h3 id="æ ‡è®°æ¸…é™¤ç®—æ³•"><a href="#æ ‡è®°æ¸…é™¤ç®—æ³•" class="headerlink" title="æ ‡è®°æ¸…é™¤ç®—æ³•"></a>æ ‡è®°æ¸…é™¤ç®—æ³•</h3><p>æ ‡è®°æ¸…é™¤ç®—æ³•æ‰§è¡Œè¿‡ç¨‹ï¼šå½“å†…å­˜å¿«è¢«è€—å°½æ—¶ï¼Œä¼šåœæ­¢æ•´ä¸ªç¨‹åºï¼ˆSTWï¼‰ï¼Œè¿›è¡Œä¸¤é¡¹å·¥ä½œï¼š</p>
<ul>
<li>æ ‡è®°ï¼šå›æ”¶å™¨ä»GC Rootså¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰å¯è¾¾å¯¹è±¡ï¼ˆåœ¨å¯¹è±¡å¤´ä¸­è¿›è¡Œæ ‡è®°ï¼‰ï¼›</li>
<li>æ¸…é™¤ï¼šå›æ”¶å™¨å¯¹å †å†…å­˜è¿›è¡Œä»å¤´åˆ°å°¾çº¿æ€§éå†ï¼Œå¦‚æœå¯¹è±¡å¤´ä¸­æ²¡æœ‰æ ‡è®°ï¼Œåˆ™è¯´æ˜æ˜¯ä¸å¯è¾¾å¯¹è±¡ï¼Œè¿›è¡Œå›æ”¶ï¼ˆå›æ”¶ç»†èŠ‚ï¼šJVMä¼šç»´æŠ¤ä¸€ä¸ªç©ºé—²åœ°å€åˆ—è¡¨ï¼ŒæŠŠå¯å›æ”¶å¯¹è±¡çš„åœ°å€å­˜æ”¾è¿›æ¥ï¼Œè¿™ä¸ªæ—¶å€™å¯¹è±¡å¹¶æ²¡æœ‰çœŸæ­£è¢«åˆ æ‰ï¼Œä¸‹æ¬¡æ–°å¯¹è±¡è¿›è¡Œåˆ†é…æ—¶å€™ç›´æ¥è¦†ç›–å¯å›æ”¶å¯¹è±¡ï¼‰ã€‚</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>æ•ˆç‡ä¸æ˜¯å¾ˆé«˜ï¼Œå› ä¸ºè¦è¿›è¡Œä¸¤æ¬¡éå†å·¥ä½œï¼›</li>
<li>STWä¼šå½±å“ç”¨æˆ·ä½“éªŒï¼›</li>
<li>è¿™ç§æ–¹å¼æ•´ç†å‡ºæ¥çš„å†…å­˜ä¸æ˜¯è¿ç»­çš„ï¼Œç¢ç‰‡åŒ–ã€‚</li>
</ol>
<h3 id="å¤åˆ¶ç®—æ³•"><a href="#å¤åˆ¶ç®—æ³•" class="headerlink" title="å¤åˆ¶ç®—æ³•"></a>å¤åˆ¶ç®—æ³•</h3><p>ä¸ºäº†è§£å†³æ ‡è®°æ¸…é™¤ç®—æ³•çš„ç¼ºç‚¹ï¼Œå¤åˆ¶ç®—æ³•æå‡ºäº†æ–°æ€è·¯ã€‚</p>
<p>å¤åˆ¶ç®—æ³•çš„åŸºæœ¬æ€æƒ³ï¼šå°†å†…å­˜ä¸€åˆ†ä¸ºäºŒï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ã€‚GCæ—¶ï¼Œå°†å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—æœªä½¿ç”¨çš„å†…å­˜ä¸­ï¼Œç„¶åå½“å‰å†…å­˜å—çš„å¯¹è±¡å…¨éƒ¨æ¸…é™¤ï¼Œä¸¤ä¸ªå†…å­˜å—äº¤äº’è§’è‰²ï¼Œå¦‚æ¬¡å¾ªç¯åå¤ï¼ˆå †å†…å­˜ä¸­çš„å¹¸å­˜è€…0åŒºå’Œ1åŒºå°±æ˜¯è¿™ä¹ˆæçš„ï¼‰ã€‚</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li>ä¸éœ€è¦è¿›è¡Œä¸¤æ¬¡éå†ï¼Œæ•ˆç‡æ›´é«˜ï¼›</li>
<li>å¤åˆ¶ç®—æ³•å¯ä»¥ä¿è¯ç©ºé—´è¿ç»­æ€§ï¼Œæ²¡æœ‰ç¢ç‰‡é—®é¢˜ã€‚</li>
</ol>
<p>å½“ç„¶ä¹Ÿæœ‰ç¼ºç‚¹ï¼š</p>
<ol>
<li>å†…å­˜åªæœ‰ä¸€åŠæ˜¯å¯ç”¨çš„ï¼Œæµªè´¹äº†å†…å­˜ç©ºé—´ï¼›</li>
<li>å¯¹è±¡å¤åˆ¶åï¼Œåœ°å€è‚¯å®šå˜äº†ï¼Œé‚£ä¹ˆæ ˆä¸­å¯¹è±¡çš„å¼•ç”¨åœ°å€ä¹Ÿè¦æ”¹å˜ï¼Œè¿™å°±å¢åŠ äº†æ—¶é—´å¼€é”€ï¼›</li>
<li>æç«¯æƒ…å†µä¸‹ï¼Œå‡å¦‚å½“å‰å†…å­˜å—ä¸­æ²¡æœ‰åƒåœ¾ï¼Œé‚£ä¹ˆéœ€è¦å°†æ‰€æœ‰å­˜æ´»å¯¹è±¡éƒ½å¤åˆ¶åˆ°å¦ä¸€å—å†…å­˜ï¼Œè´¹åŠ›ä¸è®¨å¥½ã€‚</li>
</ol>
<h3 id="æ ‡è®°å‹ç¼©ç®—æ³•"><a href="#æ ‡è®°å‹ç¼©ç®—æ³•" class="headerlink" title="æ ‡è®°å‹ç¼©ç®—æ³•"></a>æ ‡è®°å‹ç¼©ç®—æ³•</h3><p>æ ‡è®°å‹ç¼©ç®—æ³•æ˜¯æ ‡è®°æ¸…é™¤ç®—æ³•çš„æ”¹è¿›ç‰ˆæœ¬ï¼ŒåŸºæœ¬æ€è·¯æ˜¯ï¼š</p>
<ul>
<li>æ ‡è®°ï¼šå’Œæ ‡è®°æ¸…é™¤ç®—æ³•çš„æ ‡è®°é˜¶æ®µä¸€è‡´ï¼›</li>
<li>å‹ç¼©ï¼šå°†å­˜æ´»çš„å¯¹è±¡å‹ç¼©ï¼ˆç§»åŠ¨ï¼‰åˆ°å†…å­˜çš„ä¸€ç«¯ï¼ŒæŒ‰é¡ºåºæ’æ”¾ï¼Œä¹‹åæ¸…ç†è¾¹ç•Œå¤–çš„æ‰€æœ‰ç©ºé—´ã€‚</li>
</ul>
<p>ä½¿ç”¨æ ‡è®°å‹ç¼©ç®—æ³•åï¼Œæˆ‘ä»¬å°±æ²¡å¿…è¦ç»´æŠ¤ä¸€ä¸ªå†…å­˜ç©ºé—²åˆ—è¡¨äº†ï¼Œåªéœ€è¦è®°å½•å†…å­˜ä½¿ç”¨çš„æœ«ç«¯åœ°å€å³å¯ï¼Œæœ‰æ–°å¯¹è±¡éœ€è¦åˆ†é…å†…å­˜æ—¶ï¼Œåªéœ€è¦ä»è¿™ä¸ªæœ«ç«¯åœ°å€å¼€å§‹ç»§ç»­å¾€åæ’ï¼Œç„¶åæ›´æ–°è¿™ä¸ªæœ«ç«¯åœ°å€å³å¯ï¼ˆè¿™ç§åˆ†é…æ–¹å¼ä¹Ÿç§°ä¸ºæŒ‡é’ˆç¢°æ’ï¼‰ã€‚</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li>æ²¡æœ‰ç¢ç‰‡åŒ–é—®é¢˜ï¼›</li>
<li>ä¸ä¼šåƒå¤åˆ¶ç®—æ³•é‚£æ ·ï¼Œæµªè´¹ä¸€åŠçš„å†…å­˜ç©ºé—´ã€‚</li>
</ol>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>ä»æ•ˆç‡ä¸Šæ¥çœ‹ï¼Œå› ä¸ºå¤šäº†å‹ç¼©å¯¹è±¡è¿‡ç¨‹ï¼Œæ‰€ä»¥ä¸åŠæ ‡è®°æ¸…é™¤ç®—æ³•ï¼›</li>
<li>æ¶‰åŠåˆ°å¯¹è±¡çš„ç§»åŠ¨ï¼Œæ‰€ä»¥æ ˆä¸­çš„å¼•ç”¨åœ°å€ä¹Ÿè¦å˜ï¼Œä¹Ÿä¼šå¢åŠ æ—¶é—´å¼€é”€ï¼›</li>
<li>å‹ç¼©è¿‡ç¨‹ä¸­ï¼Œä¹Ÿéœ€è¦STWã€‚</li>
</ol>
<h3 id="ç®—æ³•æ¯”è¾ƒä¸å®é™…åº”ç”¨"><a href="#ç®—æ³•æ¯”è¾ƒä¸å®é™…åº”ç”¨" class="headerlink" title="ç®—æ³•æ¯”è¾ƒä¸å®é™…åº”ç”¨"></a>ç®—æ³•æ¯”è¾ƒä¸å®é™…åº”ç”¨</h3><p>å¯ä»¥çœ‹åˆ°ï¼Œæ²¡æœ‰å®Œç¾çš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œå¤§å®¶éƒ½æœ‰ä¼˜ç¼ºç‚¹ï¼š</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">æ ‡è®°æ¸…é™¤</th>
<th align="left">æ ‡è®°å‹ç¼©</th>
<th align="left">å¤åˆ¶</th>
</tr>
</thead>
<tbody><tr>
<td align="left">é€Ÿåº¦</td>
<td align="left">ä¸­ç­‰</td>
<td align="left">æœ€æ…¢</td>
<td align="left">æœ€å¿«</td>
</tr>
<tr>
<td align="left">å†…å­˜å¼€é”€</td>
<td align="left">å°‘ï¼Œä½†æœ‰ç¢ç‰‡</td>
<td align="left">å°‘ï¼Œæ²¡æœ‰ç¢ç‰‡</td>
<td align="left">å¤šï¼Œæ²¡æœ‰ç¢ç‰‡</td>
</tr>
<tr>
<td align="left">ç§»åŠ¨å¯¹è±¡</td>
<td align="left">å¦</td>
<td align="left">æ˜¯</td>
<td align="left">æ˜¯</td>
</tr>
</tbody></table>
<p>æ²¡æœ‰æœ€å®Œç¾çš„ç®—æ³•ï¼Œåªæœ‰æœ€åˆé€‚çš„ç®—æ³•ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å †å†…å­˜ä¸­é’ˆå¯¹ä¸åŒåŒºåŸŸçš„ç‰¹æ€§ä½¿ç”¨ä¸åŒçš„å›æ”¶ç®—æ³•ï¼Œå–é•¿è¡¥çŸ­ï¼ˆåˆ†ä»£æ”¶é›†ï¼‰ï¼š</p>
<ul>
<li>æ–°ç”Ÿä»£ï¼šè¯¥åŒºåŸŸçš„å¯¹è±¡å¤§å¤šæœç”Ÿå¤•æ­»ï¼Œå­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ï¼Œæ‰€ä»¥å¤åˆ¶ç®—æ³•éå¸¸é€‚åˆç”¨äºè¯¥åŒºåŸŸï¼›</li>
<li>è€å¹´ä»£ï¼šè€å¹´ä»£å†…å­˜åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼Œå›æ”¶ä¸é‚£ä¹ˆé¢‘ç¹ï¼Œæ‰€ä»¥è¿™ä¸ªåŒºåŸŸä¸€èˆ¬ä½¿ç”¨æ ‡è®°æ¸…é™¤æˆ–è€…æ ‡è®°å‹ç¼©ç®—æ³•ã€‚</li>
</ul>
<h3 id="å¢é‡æ”¶é›†ç®—æ³•"><a href="#å¢é‡æ”¶é›†ç®—æ³•" class="headerlink" title="å¢é‡æ”¶é›†ç®—æ³•*"></a>å¢é‡æ”¶é›†ç®—æ³•*</h3><p>ä¸Šè¿°çš„ä¸‰ç§åƒåœ¾å›æ”¶ç®—æ³•éƒ½è¦è¿›è¡ŒSTWï¼Œå¦‚æœä¸€æ¬¡æ€§å°†æ‰€æœ‰çš„åƒåœ¾è¿›è¡Œå¤„ç†ï¼Œä¼šé€ æˆç³»ç»Ÿé•¿æ—¶é—´çš„åœé¡¿ï¼Œä¸ºäº†æ”¹å–„è¿™ä¸ªé—®é¢˜ï¼Œå¢é‡æ”¶é›†ç®—æ³•åº”è¿è€Œç”Ÿã€‚</p>
<p>å¢é‡æ”¶é›†ç®—æ³•è®©åƒåœ¾æ”¶é›†çº¿ç¨‹å’Œåº”ç”¨ç¨‹åºäº¤æ›¿æ‰§è¡Œï¼Œæ¯æ¬¡åƒåœ¾æ”¶é›†çº¿ç¨‹åªæ”¶é›†ä¸€å°ç‰‡åŒºåŸŸçš„å†…å­˜ï¼Œæ¥ç€åˆ‡æ¢åˆ°åº”ç”¨ç¨‹åºçº¿ç¨‹ï¼Œä»¥æ­¤åå¤ï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚ä½†è¯¥ç®—æ³•çš„åŸºç¡€è¿˜æ˜¯ä¼ ç»Ÿçš„æ ‡è®°æ¸…é™¤ç®—æ³•å’Œå¤åˆ¶ç®—æ³•ã€‚</p>
<p>ä¼˜ç‚¹ï¼šæ²¡æœ‰é•¿æ—¶é—´çš„STWï¼›</p>
<p>ç¼ºç‚¹ï¼šçº¿ç¨‹åˆ‡æ¢ä¼šä½¿å¾—åƒåœ¾å›æ”¶çš„æ€»ä½“æˆæœ¬ä¸Šå‡ï¼Œé€ æˆç³»ç»Ÿååé‡ä¸‹é™ã€‚</p>
<h2 id="åƒåœ¾å›æ”¶å™¨"><a href="#åƒåœ¾å›æ”¶å™¨" class="headerlink" title="åƒåœ¾å›æ”¶å™¨"></a>åƒåœ¾å›æ”¶å™¨</h2><h3 id="åƒåœ¾å›æ”¶å™¨æ€§èƒ½æŒ‡æ ‡"><a href="#åƒåœ¾å›æ”¶å™¨æ€§èƒ½æŒ‡æ ‡" class="headerlink" title="åƒåœ¾å›æ”¶å™¨æ€§èƒ½æŒ‡æ ‡"></a>åƒåœ¾å›æ”¶å™¨æ€§èƒ½æŒ‡æ ‡</h3><ul>
<li>ååé‡ï¼šç¨‹åºè¿è¡Œæ—¶é—´å æ€»è¿è¡Œæ—¶é—´ï¼ˆæ€»è¿è¡Œæ—¶é—´=ç¨‹åºè¿è¡Œæ—¶é—´+åƒåœ¾å›æ”¶æ—¶é—´ï¼‰çš„æ¯”ä¾‹ï¼Œåƒåœ¾å›æ”¶æ—¶é—´è¶Šå°‘ï¼Œååé‡è¶Šé«˜ï¼›</li>
<li>æš‚åœæ—¶é—´ï¼šSTWçš„æ—¶é—´ï¼›</li>
<li>å†…å­˜å ç”¨ï¼šJavaå †æ‰€å çš„å¤§å°ã€‚</li>
</ul>
<p>ä»¥ä¸Šä¸‰ç‚¹æ„æˆä¸å¯èƒ½ä¸‰è§’ï¼Œå³ä¸€æ¬¾åƒåœ¾å›æ”¶å™¨ä¸å¯èƒ½åŒæ—¶æ»¡è¶³ä¸‰ç‚¹ã€‚éšç€ç¡¬ä»¶æ°´å¹³çš„æå‡ï¼Œå†…å­˜å ç”¨ä¸å†æ˜¯æˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹ï¼Œè¯„ä¼°åƒåœ¾å›æ”¶å™¨æ€§èƒ½æ—¶ï¼Œé‡ç‚¹å…³æ³¨ååé‡å’Œæš‚åœæ—¶é—´ã€‚ååé‡å’Œæš‚åœæ—¶é—´æ˜¯ç›¸äº’çŸ›ç›¾çš„ï¼Œç›®å‰æˆ‘ä»¬è¿½æ±‚çš„æ•ˆæœæ˜¯ï¼šåœ¨æœ€å¤§ååé‡ä¼˜å…ˆçš„æƒ…å†µä¸‹ï¼Œå‡å°æš‚åœæ—¶é—´ã€‚</p>
<h3 id="åƒåœ¾å›æ”¶å™¨å‘å±•å†å²"><a href="#åƒåœ¾å›æ”¶å™¨å‘å±•å†å²" class="headerlink" title="åƒåœ¾å›æ”¶å™¨å‘å±•å†å²"></a>åƒåœ¾å›æ”¶å™¨å‘å±•å†å²</h3><ul>
<li>1999å¹´JDK 1.3.1 å‘å¸ƒç¬¬ä¸€æ¬¾ä¸²è¡Œæ–¹å¼çš„Serial GCï¼ŒParNewåƒåœ¾å›æ”¶å™¨æ˜¯Serialå›æ”¶å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼›</li>
<li>2002å¹´2æœˆ26ï¼ŒParallel GCå’ŒConcurrent Mark Sweep GCï¼ˆCMSï¼‰è·ŸéšJDK 1.4.2ä¸€èµ·å‘å¸ƒï¼›</li>
<li>Parallel GCåœ¨JDK 1.6åç§°ä¸ºHotSpoté»˜è®¤GCï¼›</li>
<li>2012å¹´ï¼Œåœ¨JDK 1.7u4ç‰ˆæœ¬ä¸­ï¼ŒG1å¯ç”¨ï¼›</li>
<li>2017å¹´ï¼ŒJDK 9ä¸­ï¼ŒG1æˆä¸ºé»˜è®¤åƒåœ¾å›æ”¶å™¨ï¼ŒCMSè¢«æ ‡è®°ä¸ºè¿‡æ—¶ï¼›</li>
<li>2018å¹´3æœˆï¼ŒJDK 10ä¸­æå‡G1å¹¶è¡Œæ€§ï¼›</li>
<li>2018å¹´9æœˆï¼ŒJDK 11å¼•å…¥äº†Epsilonåƒåœ¾å›æ”¶å™¨ï¼ŒåŒæ—¶å¼•å…¥ZGCï¼ˆå®éªŒç‰ˆæœ¬ï¼‰ï¼›</li>
<li>2019å¹´3æœˆï¼ŒJDK 12å‘å¸ƒï¼Œå¢å¼ºG1ï¼Œå¹¶å¼•å…¥Shenandoah GCï¼ˆå®éªŒç‰ˆæœ¬ï¼‰ï¼›</li>
<li>2019å¹´9æœˆï¼ŒJDK 13å‘å¸ƒï¼Œå¢å¼ºZGCï¼›</li>
<li>2020å¹´3æœˆï¼ŒJDK 14å‘å¸ƒï¼Œåˆ é™¤CMSï¼Œæ‹“å±•ZGCåœ¨MACå’ŒWindowsä¸Šçš„åº”ç”¨ã€‚</li>
</ul>
<h3 id="åƒåœ¾å›æ”¶å™¨ç»„åˆ"><a href="#åƒåœ¾å›æ”¶å™¨ç»„åˆ" class="headerlink" title="åƒåœ¾å›æ”¶å™¨ç»„åˆ"></a>åƒåœ¾å›æ”¶å™¨ç»„åˆ</h3><p>7æ¬¾ç»å…¸åƒåœ¾å›æ”¶å™¨é—´çš„ç»„åˆå…³ç³»ï¼š</p>
<p><img src="/p/d6094941/QQ20200915-095724@2x.png" alt="QQ20200915-095724@2x"></p>
<p>è¯´æ˜ï¼š</p>
<ol>
<li>ä¸¤ä¸ªå›æ”¶å™¨é—´æœ‰è¿çº¿ï¼Œè¯´æ˜å®ƒä»¬å¯ä»¥æ­é…ä½¿ç”¨ï¼›</li>
<li>Serial Oldä½œä¸ºCMSå‡ºç°â€œConcurrent Mode Failureâ€å¤±è´¥çš„åå¤‡é¢„æ¡ˆï¼›</li>
<li>G1å¯ç”¨äºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼›</li>
<li>çº¢è‰²è™šçº¿è¿çº¿ï¼šJDK 8å°†è¿™ä¸¤ç»„ç»„åˆå£°æ˜ä¸ºåºŸå¼ƒï¼Œå¹¶åœ¨JDK 9ä¸­å®Œå…¨ç§»é™¤ï¼›</li>
<li>ç»¿è‰²è™šçº¿è¿çº¿ï¼šJDK 14ä¸­ï¼Œå¼ƒç”¨äº†è¯¥ç»„åˆï¼›</li>
<li>ç»¿è‰²è™šçº¿è¾¹æ¡†ï¼šJDK 14ä¸­ï¼Œåˆ é™¤äº†CMSã€‚</li>
</ol>
<h3 id="é»˜è®¤åƒåœ¾å›æ”¶å™¨æŸ¥çœ‹"><a href="#é»˜è®¤åƒåœ¾å›æ”¶å™¨æŸ¥çœ‹" class="headerlink" title="é»˜è®¤åƒåœ¾å›æ”¶å™¨æŸ¥çœ‹"></a>é»˜è®¤åƒåœ¾å›æ”¶å™¨æŸ¥çœ‹</h3><p>ç¼–å†™ä¸€æ®µç®€å•çš„javaç¨‹åºï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        System.out.println(<span class="string">"hello"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ·»åŠ <code>-XX:+PrintCommandLineFlags</code>JVMå‚æ•°é…ç½®ï¼Œåœ¨JDK 8ç¯å¢ƒä¸‹ç¨‹åºè¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">-XX:InitialHeapSize=536870912 -XX:MaxHeapSize=8589934592 -XX:+PrintCommandLineFlags -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseParallelGC </span><br><span class="line">hello</span><br></pre></td></tr></tbody></table></figure>

<p><code>-XX:+UseParallelGC</code>è¯´æ˜JDK 8é»˜è®¤çš„åƒåœ¾å›æ”¶å™¨ä¸ºParallelã€‚</p>
<p>åœ¨JDK 9ç¯å¢ƒä¸‹è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">-XX:G1ConcRefinementThreads=10 -XX:InitialHeapSize=536870912 -XX:MaxHeapSize=8589934592 -XX:+PrintCommandLineFlags -XX:ReservedCodeCacheSize=251658240 -XX:+SegmentedCodeCache -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseG1GC </span><br><span class="line">hello</span><br></pre></td></tr></tbody></table></figure>

<p><code>-XX:+UseG1GC</code>è¯´æ˜JDK 9é»˜è®¤çš„åƒåœ¾å›æ”¶å™¨ä¸ºG1ã€‚</p>
<h3 id="ç»å…¸åƒåœ¾å›æ”¶å™¨ä»‹ç»"><a href="#ç»å…¸åƒåœ¾å›æ”¶å™¨ä»‹ç»" class="headerlink" title="ç»å…¸åƒåœ¾å›æ”¶å™¨ä»‹ç»"></a>ç»å…¸åƒåœ¾å›æ”¶å™¨ä»‹ç»</h3><h4 id="Serialã€Serial-Oldå›æ”¶å™¨"><a href="#Serialã€Serial-Oldå›æ”¶å™¨" class="headerlink" title="Serialã€Serial Oldå›æ”¶å™¨"></a>Serialã€Serial Oldå›æ”¶å™¨</h4><p>Serialåƒåœ¾å›æ”¶å™¨æ˜¯å•çº¿ç¨‹<strong>ä¸²è¡Œå›æ”¶å™¨</strong>ï¼Œä½œä¸ºHotSpotä¸­Clientæ¨¡å¼ä¸‹çš„é»˜è®¤æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†å™¨ã€‚é‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>ã€<strong>ä¸²è¡Œå›æ”¶</strong>å’Œ<strong>STWæœºåˆ¶</strong>çš„æ–¹å¼æ‰§è¡Œå†…å­˜å›æ”¶ã€‚</p>
<p>Serial Oldåƒåœ¾å›æ”¶å™¨ä¸ºSerialæä¾›çš„è€å¹´ä»£åƒåœ¾å›æ”¶å™¨ï¼Œé‡‡ç”¨<strong>æ ‡è®°å‹ç¼©ç®—æ³•</strong>ã€<strong>ä¸²è¡Œå›æ”¶</strong>å’Œ<strong>STWæœºåˆ¶</strong>è¿›è¡Œå†…å­˜å›æ”¶ï¼š</p>
<ul>
<li><p>Serial Oldæ˜¯è¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹é»˜è®¤çš„è€å¹´ä»£åƒåœ¾å›æ”¶å™¨ï¼›</p>
</li>
<li><p>Serial Oldåœ¨Serveræ¨¡å¼ä¸‹ä¸»è¦æœ‰ä¸¤ä¸ªç”¨é€”ï¼š</p>
<p>a. ä¸æ–°ç”Ÿä»£çš„Parallel Scavengeé…åˆä½¿ç”¨ï¼›</p>
<p>b. ä½œä¸ºè€å¹´ä»£CMSå›æ”¶å™¨çš„åå¤‡åƒåœ¾æ”¶é›†æ–¹æ¡ˆã€‚</p>
</li>
</ul>
<p>Serialé€‚ç”¨äºè¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºæˆ–è€…å†…å­˜ä¸å¤§ï¼ˆå‡ åMBåˆ°ä¸€ä¸¤ç™¾MBï¼‰çš„ç¯å¢ƒä¸‹ï¼Œå› ä¸ºæ˜¯ä¸²è¡Œçš„ï¼Œæœ‰è¾ƒé•¿æ—¶é—´çš„STWï¼Œæ‰€ä»¥å¹¶ä¸é€‚ç”¨äºè¦æ±‚å¿«å“åº”ã€äº¤äº’è¾ƒå¼ºçš„åº”ç”¨ã€‚</p>
<p>å¯ä»¥é€šè¿‡<code>XX:+UseSerialGC</code>å‚æ•°å¯ç”¨Serialå›æ”¶å™¨ï¼Œè¡¨ç¤ºæ–°ç”Ÿä»£ä½¿ç”¨Serialï¼Œè€å¹´ä»£ä½¿ç”¨Serial Oldã€‚</p>
<h4 id="ParNewå›æ”¶å™¨"><a href="#ParNewå›æ”¶å™¨" class="headerlink" title="ParNewå›æ”¶å™¨"></a>ParNewå›æ”¶å™¨</h4><p>ParNewæ˜¯Parallel Newä¸¤ä¸ªè¯çš„ç®€å†™ï¼Œæ˜¯Serialçš„å¤šçº¿ç¨‹ç‰ˆæœ¬åƒåœ¾å›æ”¶å™¨ã€‚ParNewæ˜¯å¾ˆå¤šJVMè¿è¡Œåœ¨Serveræ¨¡å¼ä¸‹æ–°ç”Ÿä»£çš„é»˜è®¤åƒåœ¾å›æ”¶å™¨ï¼Œé‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>ã€<strong>å¹¶è¡Œå›æ”¶</strong>å’Œ<strong>STWæœºåˆ¶</strong>è¿›è¡Œå†…å­˜å›æ”¶ã€‚</p>
<p>å¯ä»¥é€šè¿‡<code>XX:+UseParNewGC</code>å‚æ•°å¯ç”¨ParNewå›æ”¶å™¨ï¼Œè¡¨ç¤ºæ–°ç”Ÿä»£ä½¿ç”¨ParNewï¼Œè€å¹´ä»£ä¸å—å½±å“ã€‚</p>
<p>Serialã€ParNewæ­é…Serial Oldå›æ”¶å™¨ç¤ºæ„å›¾ï¼š</p>
<p><img src="/p/d6094941/mVbDKEFY82.jpg" alt="mVbDKEFY82"></p>
<h4 id="Parallelã€Parallel-Oldå›æ”¶å™¨"><a href="#Parallelã€Parallel-Oldå›æ”¶å™¨" class="headerlink" title="Parallelã€Parallel Oldå›æ”¶å™¨"></a>Parallelã€Parallel Oldå›æ”¶å™¨</h4><p>Parallel Scavengeå›æ”¶å™¨ä¹Ÿæ˜¯ä½œç”¨äºæ–°ç”Ÿä»£ï¼ŒåŒæ ·é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œå¹¶è¡Œå›æ”¶å’ŒSTWæœºåˆ¶ã€‚</p>
<p>Parallel Scavengeå’ŒParNewå¯¹æ¯”ï¼š</p>
<ul>
<li>Parallel Scavengeä¸ºååé‡ä¼˜å…ˆçš„åƒåœ¾å›æ”¶å™¨ï¼›</li>
<li>Parallel Scavengeå…·æœ‰è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ã€‚</li>
</ul>
<p>JDK 1.6æä¾›äº†ç”¨äºè€å¹´ä»£çš„å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ â€”â€” Parallel Oldå›æ”¶å™¨ï¼Œç”¨äºæ›¿ä»£Serial Oldå›æ”¶å™¨ã€‚Parallelé‡‡ç”¨æ ‡è®°å‹ç¼©ã€å¹¶è¡Œå›æ”¶å’ŒSTWæœºåˆ¶ã€‚</p>
<p>å¯ä»¥é€šè¿‡<code>-XX:+UseParallelGC</code>æŒ‡å®šæ–°ç”Ÿä»£ä½¿ç”¨Parallel Scavengeå›æ”¶å™¨ï¼›<code>-XX:+UseParallelOldGC</code>æŒ‡å®šè€å¹´ä»£ä½¿ç”¨Parallel Oldå›æ”¶å™¨ï¼Œå®ƒä»¬æ˜¯æˆå¯¹å­˜åœ¨çš„ï¼Œå¼€å¯ä¸€ä¸ªå¦ä¸€ä¸ªä¹Ÿä¼šå¼€å¯ã€‚</p>
<p>æ­¤å¤–è¿˜å¯ä»¥é€šè¿‡<code>-XX:ParallelGCThreads=</code>è®¾ç½®å¹¶è¡Œå›æ”¶å™¨çš„çº¿ç¨‹æ•°ï¼š</p>
<ul>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“CPUæ•°é‡å°äº8ä¸ªæ—¶ï¼Œ<code>-XX:ParallelGCThreads=</code>çš„å€¼ç­‰äºCPUæ•°é‡ï¼›</li>
<li>å½“CPUæ•°é‡å¤§äº8ä¸ªï¼Œ<code>-XX:ParallelGCThreads=</code>çš„å€¼ç­‰äº<code>3+5*CPU_COUNT/8</code>ã€‚</li>
</ul>
<p><code>-XX:+UseAdaptiveSizePolicy</code>å¼€å¯Parallel Scavengeçš„è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ï¼š</p>
<p>è¯¥æ¨¡å¼ä¸‹ï¼Œå¹´è½»ä»£å¤§å°ã€ä¼Šç”¸å›­åŒºå’Œå¹¸å­˜è€…åŒºçš„æ¯”ä¾‹ã€æ™‹å‡è€å¹´ä»£çš„å¯¹è±¡å¹´é¾„é˜ˆå€¼éƒ½ä¼šè‡ªåŠ¨è°ƒæ•´ï¼Œä»¥è¾¾åˆ°åœ¨å †å¤§å°ã€ååé‡å’Œåœé¡¿æ—¶é—´ä¹‹é—´çš„å¹³è¡¡ç‚¹ã€‚</p>
<h4 id="CMSå›æ”¶å™¨"><a href="#CMSå›æ”¶å™¨" class="headerlink" title="CMSå›æ”¶å™¨"></a>CMSå›æ”¶å™¨</h4><p>JDK 1.5 HotSpotæ¨å‡ºäº†ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘å›æ”¶å™¨ â€”â€” CMSï¼ˆConcurrent-Mark-Sweepï¼‰ï¼Œç¬¬ä¸€æ¬¡å®ç°äº†è®©åƒåœ¾å›æ”¶çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹åŒæ—¶å·¥ä½œã€‚CMSçš„å…³æ³¨ç‚¹åœ¨äºå°½å¯èƒ½ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹åœé¡¿çš„æ—¶é—´ã€‚</p>
<p>CMSä½œä¸ºä¸€æ¬¾è€å¹´ä»£çš„åƒåœ¾å›æ”¶å™¨ï¼Œä¸èƒ½å’Œæ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨Parallel Scavengeæ­é…ä½¿ç”¨ï¼Œåªèƒ½å’ŒParNewæˆ–è€…Serialæ­é…ä½¿ç”¨ã€‚</p>
<p>CMSå›æ”¶å™¨ç¤ºæ„å›¾ï¼š</p>
<p><img src="/p/d6094941/AB4KDE85OF.png" alt="AB4KDE85OF"></p>
<p>ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>åˆå§‹æ ‡è®°ï¼ˆInitial-Markï¼‰ï¼šæ‰€æœ‰ç”¨æˆ·çº¿ç¨‹æš‚åœï¼ˆSTWï¼‰ï¼Œè¿™ä¸ªé˜¶æ®µä»…ä»…æ ‡è®°å‡ºGC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œæ‰€ä»¥é€Ÿåº¦éå¸¸å¿«ï¼ŒSTWæ—¶é—´å¾ˆçŸ­ï¼›</li>
<li>å¹¶å‘æ ‡è®°ï¼ˆConcurrent-Markï¼‰ï¼šè¯¥é˜¶æ®µä»GC Rootsç›´æ¥å…³è”å¯¹è±¡å¼€å§‹éå†æ•´ä¸ªå¯¹è±¡é“¾ï¼Œè™½ç„¶è¿™ä¸ªè¿‡ç¨‹è€—æ—¶è¾ƒé•¿ï¼Œä½†å¹¶ä¸éœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹ï¼Œå¹¶å‘æ‰§è¡Œï¼Œæ²¡æœ‰STWï¼›</li>
<li>é‡æ–°æ ‡è®°ï¼ˆRemarkï¼‰ï¼šç”±äºä¸Šä¸€æ­¥ç”¨æˆ·çº¿ç¨‹ä¹Ÿåœ¨æ‰§è¡Œï¼Œæ‰€ä»¥è¿™ä¸€æ­¥ç”¨äºä¿®æ­£å› ç”¨æˆ·çº¿ç¨‹ç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°å‘ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ã€‚è¿™ä¸ªé˜¶æ®µä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µè€—æ—¶é•¿ä¸€ç‚¹ï¼Œä½†è¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µä½ï¼›</li>
<li>å¹¶å‘æ¸…é™¤ï¼ˆConcurrent-Sweepï¼‰ï¼šè¯¥é˜¶æ®µæ¸…ç†åˆ é™¤åƒåœ¾ï¼Œå›æ”¶ç©ºé—´ã€‚ç”±äºæ²¡æœ‰ç§»åŠ¨å¯¹è±¡ï¼Œæ‰€ä»¥è¯¥é˜¶æ®µä¹Ÿä¸éœ€è¦STWã€‚</li>
</ol>
<p>CMSçš„ä¼˜ç¼ºç‚¹éƒ½å¾ˆæ˜æ˜¾ï¼š</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>å¹¶å‘æ”¶é›†ï¼›</li>
<li>ä½å»¶è¿Ÿã€‚</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>ä¼šäº§ç”Ÿç¢ç‰‡ã€‚å› ä¸ºæ¸…ç†é˜¶æ®µç”¨æˆ·çº¿çº¿ç¨‹è¿˜åœ¨æ‰§è¡Œï¼Œæ‰€ä»¥åªèƒ½é‡‡ç”¨ä¸ç§»åŠ¨å¯¹è±¡çš„æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œè€Œè¯¥ç®—æ³•ä¼šäº§ç”Ÿç¢ç‰‡é—®é¢˜ï¼›</li>
<li>å¯¹CPUèµ„æºæ•æ„Ÿã€‚CPUèµ„æºé™¤äº†ç”¨äºç”¨æˆ·çº¿ç¨‹å¤–ï¼Œè¿˜éœ€åˆ†é…ä¸€éƒ¨åˆ†ç”¨äºå¤„ç†åƒåœ¾å›æ”¶ï¼Œé™ä½äº†ååé‡ï¼›</li>
<li>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ã€‚å¹¶å‘æ ‡è®°é˜¶æ®µï¼Œç”¨æˆ·çº¿ç¨‹å¹¶æœªåœæ­¢ï¼Œè¯¥é˜¶æ®µä¹Ÿä¼šäº§ç”Ÿåƒåœ¾ï¼Œ CMSæ— æ³•å¯¹è¿™äº›åƒåœ¾è¿›è¡Œæ ‡è®°ï¼Œåªèƒ½ç•™åˆ°ä¸‹æ¬¡GCæ—¶å¤„ç†ã€‚</li>
</ul>
<p>æ­¤å¤–ï¼ŒCMSåœ¨å›æ”¶è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºç”¨æˆ·çº¿ç¨‹å¹¶æ²¡æœ‰ä¸­æ–­ï¼Œæ‰€ä»¥è¿˜éœ€ç¡®ä¿ç”¨æˆ·çº¿ç¨‹æœ‰è¶³å¤Ÿçš„å†…å­˜å¯ç”¨ã€‚æ¢å¥è¯è¯´ï¼ŒCMSå›æ”¶å™¨ä¸èƒ½ç­‰è€å¹´ä»£å³å°†è¢«å¡«æ»¡æ—¶æ‰å»å›æ”¶ï¼Œè€Œåº”å½“å †å†…å­˜ä½¿ç”¨ç‡åˆ°è¾¾ä¸€å®šé˜ˆå€¼æ—¶ï¼Œä¾¿å¼€å§‹è¿›è¡Œå›æ”¶ã€‚å¦‚æœCMSè¿è¡ŒæœŸé—´é¢„ç•™å†…å­˜ä¸è¶³ï¼Œå°±ä¼šå‡ºç°ä¸€æ¬¡â€œConcurrent Mode Failureâ€å¤±è´¥ï¼Œè™šæ‹Ÿæœºä¼šå¯åŠ¨åå¤‡æ–¹æ¡ˆï¼Œä¸´æ—¶å¯ç”¨Serial Oldå›æ”¶å™¨æ¥å®Œæˆè€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€‚</p>
<p>CMSå›æ”¶å™¨å¯è®¾ç½®å‚æ•°ï¼š</p>
<ul>
<li><code>-XX:+UseConcMarkSweepGC</code>ï¼Œå¼€å¯CMS GCï¼Œå¼€å¯åï¼Œ<code>-XX:+UseParNewGC</code>ä¼šè‡ªåŠ¨æ‰“å¼€ï¼›</li>
<li><code>-XX:CMSInitiatingOccupanyFraction=</code>ï¼Œè®¾ç½®å †å†…å­˜ä½¿ç”¨ç‡é˜ˆå€¼ï¼Œä¸€æ—¦è¾¾åˆ°è¿™ä¸ªé˜ˆå€¼ï¼ŒCMSå¼€å§‹è¿›è¡Œå›æ”¶ï¼ˆJDK5åŠä¹‹å‰ï¼Œé»˜è®¤å€¼ä¸º68ï¼ŒJDK6åŠä»¥ä¸Šç‰ˆæœ¬é»˜è®¤å€¼ä¸º92%ï¼‰ï¼›</li>
<li><code>-XX:+UseCMSCompactAtFullCollection</code>ï¼ŒæŒ‡å®šåœ¨CMSå›æ”¶å®Œè€å¹´ä»£åï¼Œå¯¹å†…å­˜ç©ºé—´è¿›è¡Œå‹ç¼©å¤„ç†ï¼Œä»¥é¿å…ç¢ç‰‡åŒ–é—®é¢˜ï¼›</li>
<li><code>-XX:CMSFullGCsBeforeCompaction</code>ï¼Œè®¾ç½®æ‰§è¡Œå¤šå°‘æ¬¡CMS GCåï¼Œå¯¹å†…å­˜ç©ºé—´è¿›è¡Œå‹ç¼©æ•´ç†ï¼›</li>
<li><code>-XX:ParallelCMSThreads=</code>ï¼Œè®¾ç½®CMSçš„çº¿ç¨‹æ•°ã€‚é»˜è®¤å¯åŠ¨çš„çº¿ç¨‹æ•°ä¸º<code>(ParallelGCThreads+3)/4</code>ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå½“CPUä¸ªæ•°å°äº8æ—¶ï¼ŒParallelGCThreadsçš„é»˜è®¤å€¼ä¸ºCPUä¸ªæ•°ï¼Œæ‰€ä»¥å¯¹äºä¸€ä¸ª8æ ¸CPUï¼Œé»˜è®¤å¯åŠ¨çš„CMSçº¿ç¨‹æ•°ä¸º3ï¼Œæ¢å¥è¯è¯´åªæœ‰62.5%çš„CPUèµ„æºç”¨äºå¤„ç†ç”¨æˆ·çº¿ç¨‹ã€‚æ‰€ä»¥CMSä¸é€‚åˆååé‡è¦æ±‚é«˜çš„åœºæ™¯ã€‚</li>
</ul>
<h4 id="G1å›æ”¶å™¨"><a href="#G1å›æ”¶å™¨" class="headerlink" title="G1å›æ”¶å™¨"></a>G1å›æ”¶å™¨</h4><p>G1ï¼ˆGarbage Firstï¼‰å›æ”¶å™¨æŠŠå †å†…å­˜åˆ†å‰²æˆå¾ˆå¤šä¸ç›¸å…³çš„åŒºåŸŸï¼ˆregionï¼Œç‰©ç†ä¸Šä¸è¿ç»­ï¼‰ï¼Œä½¿ç”¨ä¸åŒåŒºåŸŸæ¥è¡¨ç¤ºä¼Šç”¸å›­åŒºï¼Œå¹¸å­˜è€…åŒºå’Œè€å¹´ä»£ã€‚</p>
<p>G1ä¼šé¿å…å¯¹æ•´ä¸ªJavaå †è¿›è¡Œåƒåœ¾æ”¶é›†ï¼Œå®ƒä¼šè·Ÿè¸ªå„ä¸ªregioné‡Œåƒåœ¾å›æ”¶çš„ä»·å€¼å¤§å°ï¼ˆå›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°åŠæ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼ï¼‰ï¼Œåœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„regionã€‚</p>
<p><strong>regionçš„è¯´æ˜</strong></p>
<p><img src="/p/d6094941/QQ20200922-143837@2x.png" alt="QQ20200922-143837@2x"></p>
<ul>
<li>Eè¡¨ç¤ºä¼Šç”¸å›­åŒºï¼ŒSè¡¨ç¤ºå¹¸å­˜è€…åŒºã€Oè¡¨ç¤ºè€å¹´ä»£ï¼Œç©ºç™½è¡¨ç¤ºæœªä½¿ç”¨çš„å†…å­˜åŒºåŸŸï¼›</li>
<li>ä¸€ä¸ªregionåœ¨åŒä¸€æ—¶é—´å†…åªèƒ½å±äºä¸€ç§è§’è‰²ï¼›</li>
<li>G1æ–°å¢äº†ä¸€ä¸ªå…¨æ–°çš„å†…å­˜åŒºåŸŸâ€”â€”Humongousï¼Œä¸»è¦ç”¨äºå­˜æ”¾å¤§å¯¹è±¡ã€‚</li>
</ul>
<p>G1å›æ”¶åƒåœ¾è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/p/d6094941/QQ20200922-142231@2x.png" alt="QQ20200922-142231@2x"></p>
<ol>
<li><strong>åˆå§‹æ ‡è®°</strong>ï¼šä»…ä»…æ˜¯æ ‡è®°GC Rootsèƒ½ç›´æ¥å…³è”çš„å¯¹è±¡ï¼Œéœ€è¦STWï¼Œä½†è¿™ä¸ªè¿‡ç¨‹éå¸¸å¿«ï¼›</li>
<li><strong>å¹¶å‘æ ‡è®°</strong>ï¼šä»GC Rootså‡ºå‘ï¼Œå¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ‰¾å‡ºå­˜æ´»å¯¹è±¡ï¼Œè¯¥é˜¶æ®µè€—æ—¶è¾ƒé•¿ï¼Œä½†æ˜¯å¯ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼›</li>
<li><strong>æœ€ç»ˆæ ‡è®°</strong>ï¼šä¸»è¦ä¿®æ­£åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µå› ä¸ºç”¨æˆ·çº¿ç¨‹ç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°è®°å½•äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œéœ€è¦STWï¼›</li>
<li><strong>ç­›é€‰å›æ”¶</strong>ï¼šå°†å„ä¸ªregionåˆ†åŒºçš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„åœé¡¿æ—¶é—´åˆ¶å®šå›æ”¶è®¡åˆ’ã€‚è¿™é˜¶æ®µåœé¡¿ç”¨æˆ·çº¿ç¨‹ï¼ŒSTWã€‚</li>
</ol>
<p>G1å›æ”¶å™¨çš„ä¼˜ç¼ºç‚¹ï¼š</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>å¹¶è¡Œä¸å¹¶å‘ï¼›</li>
<li>åˆ†ä»£æ”¶é›†ï¼Œå¯ä»¥é‡‡ç”¨ä¸åŒçš„ç®—æ³•å¤„ç†ä¸åŒçš„å¯¹è±¡ï¼›</li>
<li>ç©ºé—´æ•´åˆï¼Œæ ‡è®°å‹ç¼©ç®—æ³•æ„å‘³ç€ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼›</li>
<li>å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šä¸€ä¸ªé•¿åº¦ä¸ºMæ¯«ç§’æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨åƒåœ¾å›æ”¶çš„æ—¶é—´ä¸è¶…è¿‡Næ¯«ç§’ï¼ˆæ ¹æ®ä¼˜å…ˆåˆ—è¡¨ä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„regionï¼‰ã€‚</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>åœ¨å°å†…å­˜ç¯å¢ƒä¸‹å’ŒCMSç›¸æ¯”æ²¡æœ‰ä¼˜åŠ¿ï¼ŒG1é€‚åˆå¤§çš„å †å†…å­˜ï¼›</li>
<li>åœ¨ç”¨æˆ·ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒG1æ— è®ºæ˜¯ä¸ºäº†åƒåœ¾å›æ”¶äº§ç”Ÿçš„å†…å­˜å ç”¨ï¼Œè¿˜æ˜¯ç¨‹åºè¿è¡Œæ—¶çš„é¢å¤–æ‰§è¡Œè´Ÿè½½éƒ½è¦æ¯”CMSé«˜ã€‚</li>
</ul>
<p>G1å›æ”¶å™¨ç›¸å…³å‚æ•°è®¾ç½®ï¼š</p>
<ul>
<li><code>-XX:+UseG1GC</code>ï¼Œå¼€å¯G1 GCï¼›</li>
<li><code>-XX:G1HeapRegionSize=</code>ï¼Œè®¾ç½®regionçš„å¤§å°ã€‚å€¼ä¸º2çš„å¹‚ï¼ŒèŒƒå›´æ˜¯1MBåˆ°32MBä¹‹é—´ï¼Œç›®æ ‡æ˜¯æ ¹æ®æœ€å°å †å†…å­˜å¤§å°åˆ’åˆ†å‡ºçº¦2048ä¸ªåŒºåŸŸã€‚æ‰€ä»¥å¦‚æœè¿™ä¸ªå€¼è®¾ç½®ä¸º2MBï¼Œé‚£ä¹ˆå †æœ€å°å†…å­˜å¤§çº¦ä¸º4GBï¼›</li>
<li><code>-XX:MaxGCPauseMillis=</code>ï¼Œè®¾ç½®æœŸæœ›è¾¾åˆ°çš„æœ€å¤§GCåœé¡¿æ—¶é—´æŒ‡æ ‡ï¼ˆJVMä¼šå°½åŠ›å®ç°ï¼Œä½†ä¸ä¿è¯è¾¾åˆ°ï¼‰ï¼Œé»˜è®¤å€¼ä¸º200msï¼›</li>
<li><code>-XX:ParallelGCThread=</code>ï¼Œè®¾ç½®STWæ—¶GCçº¿ç¨‹æ•°å€¼ï¼Œæœ€å¤šè®¾ç½®ä¸º8ï¼›</li>
<li><code>-XX:ConcGCThreads=</code>ï¼Œè®¾ç½®å¹¶å‘æ ‡è®°çš„çº¿ç¨‹æ•°ï¼Œæ¨èå€¼ä¸ºParallelGCThreadçš„1/4å·¦å³ï¼›</li>
<li><code>-XX:InitiatingHeapOccupancyPercent=</code>ï¼Œè®¾ç½®è§¦å‘å¹¶å‘GCå‘¨æœŸçš„Javaå †å ç”¨ç‡é˜ˆå€¼ï¼Œè¶…è¿‡è¿™ä¸ªå€¼å°±è§¦å‘GCï¼Œé»˜è®¤å€¼ä¸º45ã€‚</li>
</ul>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>ä¸Šé¢è¿™å‡ æ¬¾ç»å…¸çš„åƒåœ¾å›æ”¶å™¨å„æœ‰ç‰¹ç‚¹ï¼Œå…·ä½“ä½¿ç”¨çš„æ—¶å€™éœ€è¦æ ¹æ®å…·ä½“çš„æƒ…å†µé€‰ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶å™¨ï¼š</p>
<p><img src="/p/d6094941/QQ20200915-104531@2x.png" alt="QQ20200915-104531@2x"></p>
<table>
<thead>
<tr>
<th align="left">åƒåœ¾å›æ”¶å™¨</th>
<th align="left">åˆ†ç±»</th>
<th align="left">ä½œç”¨ä½ç½®</th>
<th align="left">ä½¿ç”¨ç®—æ³•</th>
<th align="left">ç‰¹ç‚¹</th>
<th align="left">é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Serial</td>
<td align="left">ä¸²è¡Œ</td>
<td align="left">æ–°ç”Ÿä»£</td>
<td align="left">å¤åˆ¶ç®—æ³•</td>
<td align="left">å“åº”é€Ÿåº¦ä¼˜å…ˆ</td>
<td align="left">é€‚ç”¨äºå•CPUç¯å¢ƒä¸‹çš„Clientæ¨¡å¼</td>
</tr>
<tr>
<td align="left">ParNew</td>
<td align="left">å¹¶è¡Œ</td>
<td align="left">æ–°ç”Ÿä»£</td>
<td align="left">å¤åˆ¶ç®—æ³•</td>
<td align="left">å“åº”é€Ÿåº¦ä¼˜å…ˆ</td>
<td align="left">å¤šCPUç¯å¢ƒServeræ¨¡å¼ä¸‹ä¸CMSé…åˆä½¿ç”¨</td>
</tr>
<tr>
<td align="left">Parallel</td>
<td align="left">å¹¶è¡Œ</td>
<td align="left">æ–°ç”Ÿä»£</td>
<td align="left">å¤åˆ¶ç®—æ³•</td>
<td align="left">ååé‡ä¼˜å…ˆ</td>
<td align="left">é€‚ç”¨äºåå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„åœºæ™¯</td>
</tr>
<tr>
<td align="left">Serial Old</td>
<td align="left">ä¸²è¡Œ</td>
<td align="left">è€å¹´ä»£</td>
<td align="left">æ ‡è®°-å‹ç¼©ç®—æ³•</td>
<td align="left">å“åº”é€Ÿåº¦ä¼˜å…ˆ</td>
<td align="left">å•CPUç¯å¢ƒä¸‹çš„Clientæ¨¡å¼</td>
</tr>
<tr>
<td align="left">Parallel Old</td>
<td align="left">å¹¶è¡Œ</td>
<td align="left">è€å¹´ä»£</td>
<td align="left">æ ‡è®°-å‹ç¼©ç®—æ³•</td>
<td align="left">ååé‡ä¼˜å…ˆ</td>
<td align="left">é€‚ç”¨äºåå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„åœºæ™¯</td>
</tr>
<tr>
<td align="left">CMS</td>
<td align="left">å¹¶å‘</td>
<td align="left">è€å¹´ä»£</td>
<td align="left">æ ‡è®°-å‹ç¼©ç®—æ³•</td>
<td align="left">å“åº”é€Ÿåº¦ä¼˜å…ˆ</td>
<td align="left">é€‚ç”¨äºäº’è”ç½‘æˆ–B/Sä¸šåŠ¡</td>
</tr>
<tr>
<td align="left">G1</td>
<td align="left">å¹¶è¡Œä¸å¹¶å‘</td>
<td align="left">æ–°ç”Ÿä»£ã€è€å¹´ä»£</td>
<td align="left">å¤åˆ¶ç®—æ³• æ ‡è®°-å‹ç¼©ç®—æ³•</td>
<td align="left">å“åº”é€Ÿåº¦ä¼˜å…ˆ</td>
<td align="left">é¢å‘æœåŠ¡ç«¯åº”ç”¨</td>
</tr>
</tbody></table>
</body></html>]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVMå †ç©ºé—´</title>
    <url>/p/3b62062d.html</url>
    <content><![CDATA[<html><head></head><body><p>ä¸€ä¸ªè¿›ç¨‹å¯¹åº”ä¸€ä¸ªJVMçš„å®ä¾‹ï¼Œè¿›ç¨‹å¯ä»¥ç†è§£ä¸ºï¼Œä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„mainæ–¹æ³•å°±æ˜¯ä¸€ä¸ªJVMçš„å®ä¾‹ã€‚</p>
<h2 id="å †çš„â€œæ ¸å¿ƒâ€æ¦‚è¿°"><a href="#å †çš„â€œæ ¸å¿ƒâ€æ¦‚è¿°" class="headerlink" title="å †çš„â€œæ ¸å¿ƒâ€æ¦‚è¿°"></a>å †çš„â€œæ ¸å¿ƒâ€æ¦‚è¿°</h2><ul>
<li><p>ä¸€ä¸ª JVM å®ä¾‹åªå­˜åœ¨ä¸€ä¸ªå †å†…å­˜ï¼Œå †ä¹Ÿæ˜¯Javaå†…å­˜ç®¡ç†çš„æ ¸å¿ƒåŒºåŸŸã€‚</p>
</li>
<li><p>Javaå †åŒºåœ¨JVMå¯åŠ¨çš„æ—¶å€™å³è¢«åˆ›å»ºï¼Œå…¶ç©ºé—´å¤§å°ä¹Ÿå°±ç¡®å®šäº†ã€‚æ˜¯JVM ç®¡ç†çš„æœ€å¤§ä¸€å—å†…å­˜ç©ºé—´ã€‚å †å†…å­˜çš„å¤§å°æ˜¯å¯ä»¥è°ƒèŠ‚çš„ã€‚</p>
</li>
<li><p>ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹è§„å®šï¼Œå †å¯ä»¥å¤„äºç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œä½†åœ¨é€»è¾‘ä¸Šå®ƒåº”è¯¥è¢«è§†ä¸ºè¿ç»­çš„ã€‚</p>
</li>
<li><p>æ‰€æœ‰çš„çº¿ç¨‹å…±äº«Javaå †ï¼Œåœ¨è¿™é‡Œè¿˜å¯ä»¥åˆ’åˆ†çº¿ç¨‹ç§æœ‰çš„ç¼“å†²åŒº(Thread Local Allocation Bufferï¼Œ TLAB) ã€‚æ‰€ä»¥è¯´JVMçš„æ•´å—å †ç©ºé—´éƒ½æ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œè¿™æ˜¯ä¸æ­£ç¡®çš„ã€‚</p>
</li>
<li><p>æ•°ç»„å’Œå¯¹è±¡å¯èƒ½æ°¸è¿œä¸ä¼šå­˜å‚¨åœ¨æ ˆä¸Šï¼Œå› ä¸ºæ ˆå¸§ä¸­ä¿å­˜å¼•ç”¨ï¼Œè¿™ä¸ªå¼•ç”¨æŒ‡å‘å¯¹è±¡æˆ–è€…æ•°ç»„åœ¨å †ä¸­çš„ä½ç½®ã€‚</p>
</li>
<li><p>åœ¨æ–¹æ³•ç»“æŸåï¼Œå †ä¸­çš„å¯¹è±¡ä¸ä¼šé©¬ä¸Šè¢«ç§»é™¤ï¼Œä»…ä»…åœ¨åƒåœ¾æ”¶é›†å™¨çš„æ—¶å€™æ‰ä¼šè¢«ç§»é™¤ã€‚</p>
</li>
<li><p>å †æ˜¯GCï¼ˆGarbage Collectionï¼‰æ‰§è¡Œåƒåœ¾å›æ”¶çš„é‡ç‚¹åŒºåŸŸã€‚</p>
</li>
</ul>
<h2 id="å †çš„å†…å­˜ç»†åˆ†"><a href="#å †çš„å†…å­˜ç»†åˆ†" class="headerlink" title="å †çš„å†…å­˜ç»†åˆ†"></a>å †çš„å†…å­˜ç»†åˆ†</h2><p>ç°ä»£åƒåœ¾æ”¶é›†å™¨å¤§éƒ¨åˆ†åŸºäº<strong>åˆ†ä»£åƒåœ¾æ”¶é›†ç®—æ³•</strong>ã€‚</p>
<p>JDK1.7 å †ä¸­æœ‰ä¸€å—å«æ°¸ä¹…åŒºï¼Œåœ¨JDK1.8ä¹‹åå°±æ”¹ä¸ºå…ƒæ•°æ®åŒºäº†ã€‚</p>
<p>Java 7åŠä¹‹å‰å †å†…å­˜é€»è¾‘ä¸Šåˆ†ä¸ºï¼šæ–°ç”ŸåŒº+å…»è€åŒº+æ°¸ä¹…åŒº</p>
<table>
<thead>
<tr>
<th>è‹±æ–‡å</th>
<th>ä¸­æ–‡å</th>
</tr>
</thead>
<tbody><tr>
<td>Young/New Generation Space</td>
<td>æ–°ç”ŸåŒº</td>
</tr>
<tr>
<td>Old/Tenure generation space</td>
<td>å…»è€åŒº</td>
</tr>
<tr>
<td>Perm/Permanent Space</td>
<td>æ°¸ä¹…åŒº</td>
</tr>
</tbody></table>
<p>Java 8åŠä¹‹åå †å†…å­˜é€»è¾‘åˆ†ä¸ºï¼šæ–°ç”ŸåŒº+å…»è€åŒº+å…ƒæ•°æ®åŒºï¼ˆå…ƒç©ºé—´ï¼‰</p>
<table>
<thead>
<tr>
<th>è‹±æ–‡å</th>
<th>ä¸­æ–‡å</th>
</tr>
</thead>
<tbody><tr>
<td>Young/New Generation Space</td>
<td>æ–°ç”ŸåŒºï¼Œç»†åˆ†ä¸ºEdenåŒºå’ŒSurvivoråŒº</td>
</tr>
<tr>
<td>Old/Tenure generation space</td>
<td>å…»è€åŒº</td>
</tr>
<tr>
<td>Permanent Space</td>
<td>å…ƒç©ºé—´</td>
</tr>
</tbody></table>
<blockquote>
<p>å¦‚ä½•æŸ¥çœ‹åˆ†ä»£ä¿¡æ¯</p>
</blockquote>
<p>é€šè¿‡æ·»åŠ VMå‚æ•° <code>-XX:+PrintGCDetails</code> ï¼Œåœ¨ç¨‹åºæ‰§è¡Œæ—¶ä¼šæ‰“å°å‡ºåˆ†ä»£ä¿¡æ¯ã€‚</p>
<h2 id="å †ç©ºé—´çš„å¤§å°ä¸OOM"><a href="#å †ç©ºé—´çš„å¤§å°ä¸OOM" class="headerlink" title="å †ç©ºé—´çš„å¤§å°ä¸OOM"></a>å †ç©ºé—´çš„å¤§å°ä¸OOM</h2><p>Java å †åŒºç”¨äºå­˜å‚¨Javaå¯¹è±¡å®ä¾‹ï¼Œé‚£ä¹ˆå †çš„å¤§å°åœ¨JVMå¯åŠ¨æ—¶å°±å·²ç»è®¾å®šå¥½äº†ï¼Œå¯é€šè¿‡é€‰é¡¹<code>-XMx</code> å’Œ <code>-Xms</code>æ¥è®¾ç½®ï¼š</p>
<ul>
<li><p><code>-Xms</code> ç”¨äºè¡¨ç¤ºå †ç©ºé—´ï¼ˆå¹´è½»ä»£+è€å¹´ä»£ï¼‰çš„èµ·å§‹å†…å­˜ï¼Œç­‰ä»·äº <code>-XX:InitialHeapSize</code></p>
</li>
<li><p><code>-Xmx</code> ç”¨äºè¡¨ç¤ºå †åŒºçš„æœ€å¤§å†…å­˜ï¼Œç­‰ä»·äº <code>-XX:MaxHeapSize</code></p>
</li>
</ul>
<p>å„å‚æ•°å«ä¹‰ï¼Œ<a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html">ç‚¹å‡»å‰å¾€å®˜ç½‘</a>ï¼š</p>
<ul>
<li>-Xï¼šJVMçš„è¿è¡Œå‚æ•°ã€‚</li>
<li>msï¼šmemory start</li>
<li>mx: memory max</li>
</ul>
<p>å¦‚ä½•ä½¿ç”¨å‚æ•°</p>
<p><img src="/p/3b62062d/JVM-Xmxsize.png" alt="image-20211007171622965"></p>
<p>ä¸€æ—¦å †åŒºä¸­çš„å†…å­˜å¤§å°è¶…è¿‡ <code>-Xmx</code> æ‰€æŒ‡å®šçš„æœ€å¤§å†…å­˜æ—¶ï¼Œå°±ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ï¼ˆOOMï¼‰ã€‚</p>
<p>é€šå¸¸ä¼šå°†<code>-Xms</code> å’Œ<code>-Xmx</code> ä¸¤ä¸ªå‚æ•°é…ç½®ç›¸åŒçš„å€¼ï¼Œå…¶<strong>ç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨Javaåƒåœ¾å›æ”¶æœºåˆ¶æ¸…ç†å®Œå †åŒºåä¸éœ€è¦é‡æ–°åˆ†å‰²è®¡ç®—å †çš„å¤§å°ï¼Œä»è€Œæå‡æ€§èƒ½ã€‚</strong></p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆå§‹å†…å­˜å¤§å°ï¼šç‰©ç†å†…å­˜å¤§å° / 64ï¼Œæœ€å¤§å†…å­˜å¤§å°ï¼šç‰©ç†ç”µè„‘å†…å­˜å¤§å° / 4ã€‚</p>
<p>è¯·çœ‹ä¸‹æ–¹ç¨‹åºå®ä¾‹ï¼Œæœ¬æœºæ˜¯16Gçš„è¿è¡Œå†…å­˜ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeapSpaceInitial</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">//è¿”å›Javaè™šæ‹Ÿæœºä¸­çš„å †å†…å­˜æ€»é‡</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">initialMemory</span> <span class="operator">=</span> Runtime.getRuntime().totalMemory() / <span class="number">1024</span> / <span class="number">1024</span>;</span><br><span class="line">        <span class="comment">//è¿”å›Javaè™šæ‹Ÿæœºè¯•å›¾ä½¿ç”¨çš„æœ€å¤§å †å†…å­˜é‡</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">maxMemory</span> <span class="operator">=</span> Runtime.getRuntime().maxMemory() / <span class="number">1024</span> / <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"-Xms : "</span> + initialMemory + <span class="string">"M"</span>);</span><br><span class="line">        System.out.println(<span class="string">"-Xmx : "</span> + maxMemory + <span class="string">"M"</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"ç³»ç»Ÿå†…å­˜å¤§å°ä¸ºï¼š"</span> + initialMemory * <span class="number">64.0</span> / <span class="number">1024</span> + <span class="string">"G"</span>);</span><br><span class="line">        System.out.println(<span class="string">"ç³»ç»Ÿå†…å­˜å¤§å°ä¸ºï¼š"</span> + maxMemory * <span class="number">4.0</span> / <span class="number">1024</span> + <span class="string">"G"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰§è¡Œç»“æœ</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">-Xms : 243M</span><br><span class="line">-Xmx : 3596M</span><br><span class="line">ç³»ç»Ÿå†…å­˜å¤§å°ä¸ºï¼š15.1875G</span><br><span class="line">ç³»ç»Ÿå†…å­˜å¤§å°ä¸ºï¼š14.046875G</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>åœ¨å¼€å‘ä¸­ï¼Œå»ºè®® Xms å’Œ Xmx è®¾ç½®ä¸ºç›¸åŒçš„å¤§å°ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>ä¾‹å¦‚ï¼ŒXmxè®¾ç½®ä¸º1Gï¼ŒXmsè®¾ç½®ä¸º100Mï¼Œå½“ç¨‹åºè¿è¡Œæ—¶å†…å­˜ä¸è¶³äº†ï¼Œå°±ä¼šä¸æ–­çš„æ‰©å®¹ï¼›å½“ç”¨ä¸åˆ°è¿™äº›å†…å­˜ä¹‹åï¼Œå°±ä¼šä¸æ–­çš„é™ä½åˆ°åˆå§‹å€¼å¤§å°ã€‚åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œä¸æ–­çš„è°ƒèŠ‚å †å†…å­˜çš„å¤§å°å’ŒGCï¼Œä¼šç»™æœºå™¨å¸¦æ¥é¢å¤–çš„å‹åŠ›ã€‚</p>
<p>ç°åœ¨ç»™ç¨‹åºåŠ ä¸Šç¡çœ çš„ä»£ç å¹¶è®¾ç½®ä¸ŠVMå‚æ•° <code>-Xms100M -Xmx100M</code></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">TimeUnit.SECONDS.sleep(<span class="number">100</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">-Xms : 96M</span><br><span class="line">-Xmx : 96M</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å…¶å®ƒçš„4Må†…å­˜å»å“ªäº†ï¼Ÿ</strong></p>
<p>å€ŸåŠ©<code>jps</code>æŸ¥çœ‹Javaç¨‹åºçš„è¿›ç¨‹å’Œ<code>jstat</code>æŸ¥çœ‹å†…å­˜çš„ä½¿ç”¨æƒ…å†µ</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">C:\Users\Administrator&gt;jps</span><br><span class="line">9008</span><br><span class="line">3524 Jps</span><br><span class="line">9076 RemoteMavenServer36</span><br><span class="line">8968 HeapSpaceInitial</span><br><span class="line">7356 Launcher</span><br></pre></td></tr></tbody></table></figure>

<p>å†è¾“å…¥ <code>jstat -gc 8968</code>å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">C:\Users\Administrator&gt;jstat -gc 8968</span><br><span class="line"> S S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line">4044096.0 4096.0  0.0    0.0   25600.0   3603.8   68608.0      0.0     4480.0 769.7  384.0   75.8    0     0.000    0      0.000    0.000</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™é‡Œçš„<code>OC</code>ï¼ˆOld Countï¼‰å’Œ<code>OU</code>ï¼ˆOld Usedï¼‰ï¼Œæ–°ç”Ÿä»£åˆ†ä¸ºä¼Šç”¸å›­åŒºï¼ˆEï¼‰ã€å¹¸å­˜è€…0åŒºï¼ˆS0ï¼‰å’Œå¹¸å­˜è€…1åŒºï¼ˆS1ï¼‰ã€‚</p>
<p>å †å†…å­˜=æ–°ç”Ÿä»£+è€å¹´ä»£ = S0C + S1C + EC + OC = 4096 + 4096 + 25600 + 68608 = 102400 / 1024 = 100 M</p>
<p>è¿™é‡Œå®Œæ•´çš„å†…å­˜è®¡ç®—å‡ºæ¥ï¼Œç¡®å®æ˜¯100Mï¼ŒçœŸæ­£é€ æˆè¿™ 4M æ²¡æœ‰æ‰“å°å‡ºæ¥çš„åŸå› æ˜¯ï¼šJVMå­˜æ”¾å¯¹è±¡çš„è¯ï¼Œå®é™…ä¸Šæ˜¯å­˜æ”¾åœ¨EåŒºä»¥åŠS0åŒº<strong>æˆ–</strong>S1åŒºï¼ˆS0å’ŒS1åªèƒ½äºŒé€‰ä¸€çš„å»ç”¨ï¼Œä¸»è¦åŸå› å’Œåƒåœ¾å›æ”¶çš„ç®—æ³•æœ‰å…³ï¼‰ï¼Œæ‰€ä»¥å°‘åŠ ä¸Šä¸€ä¸ªSurviveåŒºå°±æ˜¯çœŸæ­£åˆå§‹åŒ–çš„å†…å­˜å¤§å°çš„åŸå› ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVMæ•´ä½“ç»“æ„</title>
    <url>/p/4868cbd5.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="Javaç¨‹åºè¿è¡Œæµç¨‹"><a href="#Javaç¨‹åºè¿è¡Œæµç¨‹" class="headerlink" title="Javaç¨‹åºè¿è¡Œæµç¨‹"></a>Javaç¨‹åºè¿è¡Œæµç¨‹</h2><p>åœ¨è®¡ç®—æœºç³»ç»Ÿä½“ç³»ä¸­å¹¶ä¸è®¤è¯†é«˜çº§è¯­è¨€ï¼Œéœ€è¦è½¬æˆæ±‡ç¼–ï¼Œå†ç”±è½¬æœºå™¨æŒ‡ä»¤ã€‚</p>
<p><img src="/p/4868cbd5/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%B1%82%E9%9D%A2%E7%9A%84%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E6%89%A7%E8%A1%8C%E6%A6%82%E8%A7%88.png" alt="image-20210822134201260"></p>
<p>*.javaæ–‡ä»¶é€šè¿‡ javac ç¼–è¯‘æˆ *.classæ–‡ä»¶ï¼Œé€šè¿‡ ClassLoader åŠ è½½åˆ°JVMç»è¿‡é“¾æ¥é˜¶æ®µï¼ˆæš‚æ—¶ä¸æ‡‚å¯ç•¥è¿‡ï¼‰åï¼Œåœ¨è¿è¡Œæ—¶é€šè¿‡è§£é‡Šå™¨è§£é‡Šæ‰§è¡Œã€‚</p>
<p><img src="/p/4868cbd5/ClassLoader%E7%9A%84%E8%81%8C%E8%83%BD.png" alt="image-20210418105759073"></p>
<h2 id="Javaä»£ç æ‰§è¡Œæµç¨‹"><a href="#Javaä»£ç æ‰§è¡Œæµç¨‹" class="headerlink" title="Javaä»£ç æ‰§è¡Œæµç¨‹"></a>Javaä»£ç æ‰§è¡Œæµç¨‹</h2><p>æˆ‘ä»¬ç¼–å†™çš„Javaæºç é¦–å…ˆç»è¿‡Javaç¼–è¯‘å™¨ï¼ˆä¹Ÿç§°å‰ç«¯ç¼–è¯‘å™¨ï¼‰ï¼Œåªè¦å…¶ä¸­ä¸€ä¸ªç¼–è¯‘çš„ç¯èŠ‚å‡ºç°äº†é—®é¢˜éƒ½ä¸èƒ½æ­£å¸¸ç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶ã€‚</p>
<p><img src="/p/4868cbd5/Java%E4%BB%A3%E7%A0%81%E7%9A%84%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B.png" alt="Javaä»£ç çš„æ‰§è¡Œæµç¨‹"></p>
<p>è§£é‡Šå™¨ï¼ˆè§£é‡Šæ‰§è¡Œï¼‰å’ŒJITç¼–è¯‘å™¨ï¼ˆç¼–è¯‘æ‰§è¡Œï¼‰ï¼š</p>
<p>è§£é‡Šå™¨ï¼šä¿è¯å“åº”æ—¶é—´ï¼Œè¿è¡Œæ—¶å¯¹å­—èŠ‚ç æŒ‡ä»¤è¿›è¡Œé€è¡Œè§£é‡Šæ‰§è¡Œã€‚</p>
<p>JITç¼–è¯‘å™¨ï¼šäºŒæ¬¡ç¼–è¯‘ï¼Œå°†çƒ­ç‚¹ä»£ç ç›´æ¥ç¼–è¯‘æˆæœºå™¨æŒ‡ä»¤ï¼Œå¹¶æŠŠè¿™äº›æœºå™¨æŒ‡ä»¤ç¼“å­˜èµ·æ¥ã€‚</p>
<h2 id="JVMçš„æ•´ä½“ç»“æ„"><a href="#JVMçš„æ•´ä½“ç»“æ„" class="headerlink" title="JVMçš„æ•´ä½“ç»“æ„"></a>JVMçš„æ•´ä½“ç»“æ„</h2><p>HotSpot VMæ˜¯ç›®å‰å¸‚é¢ä¸Šæ€§èƒ½è™šæ‹Ÿæœºçš„ä»£è¡¨ä½œä¹‹ä¸€ï¼Œ<strong>è§£é‡Šå™¨ä¸å³æ—¶ç¼–è¯‘å™¨å¹¶å­˜</strong>ã€‚</p>
<p><img src="/p/4868cbd5/JVM%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%9E%8B.png" alt="img"></p>
<h2 id="JVMçš„æ¶æ„æ¨¡å‹"><a href="#JVMçš„æ¶æ„æ¨¡å‹" class="headerlink" title="JVMçš„æ¶æ„æ¨¡å‹"></a>JVMçš„æ¶æ„æ¨¡å‹</h2><p>javaç¼–è¯‘å™¨è¾“å…¥æŒ‡ä»¤æµæ˜¯<strong>åŸºäºæ ˆ</strong>çš„æŒ‡ä»¤é›†æ¶æ„ï¼Œå¦å¤–ä¸€ç§æŒ‡ä»¤æ¶æ„<strong>åŸºäºå¯„å­˜å™¨</strong>æŒ‡ä»¤é›†æ¶æ„ã€‚</p>
<p><strong>åŸºäºæ ˆçš„æŒ‡ä»¤é›†æ¶æ„ç‰¹ç‚¹</strong></p>
<p>ã€€ã€€1.è®¾è®¡å’Œå®ç°æ›´ç®€å•ï¼Œé€‚ç”¨äºèµ„æºå—é™çš„ç³»ç»Ÿï¼›ï¼ˆæ ˆçš„èµ„æºæœ‰é™ï¼‰</p>
<p>ã€€ã€€2.é¿å¼€äº†å¯„å­˜å™¨çš„åˆ†é…éš¾é¢˜ï¼šä½¿ç”¨çš„æ˜¯é›¶åœ°å€æŒ‡ä»¤åˆ†é…æ–¹å¼ï¼ˆé›¶åœ°å€æŒ‡ä»¤ï¼šåªæœ‰æ“ä½œæ•°ï¼Œæ²¡æœ‰åœ°å€æŒ‡å‘æ“ä½œæ•°ï¼‰</p>
<p>ã€€ã€€3.æŒ‡ä»¤æµä¸­å¤§éƒ¨åˆ†æŒ‡ä»¤æ˜¯é›¶åœ°å€æŒ‡ä»¤ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¾èµ–äºæ ˆæ“ä½œã€‚</p>
<p>ã€€ã€€ã€€ã€€ä¼˜ç‚¹ï¼šæŒ‡ä»¤é›†åˆå°ï¼Œç¼–è¯‘å™¨å®¹æ˜“å®ç°ã€‚</p>
<p>ã€€ã€€ã€€ã€€ç¼ºç‚¹ï¼šå®Œæˆä¸€é¡¹æ“ä½œéœ€è¦æ›´å¤šçš„æŒ‡ä»¤å®Œæˆï¼ˆæ ˆçš„åŸå› å¯¼è‡´ï¼‰ï¼Œæ•ˆç‡ä½ã€‚</p>
<p>ã€€ã€€4.ä¸éœ€è¦ç¡¬ä»¶çš„æ”¯æŒï¼Œå¯ç§»æ¤æ€§å¥½ï¼Œåˆ©äºè·¨å¹³å°ï¼ˆæ²¡æœ‰å’Œç¡¬ä»¶æŒ‚é’©ï¼‰</p>
<p><strong>åŸºäºå¯„å­˜å™¨æŒ‡ä»¤é›†æ¶æ„ç‰¹ç‚¹</strong></p>
<p>ã€€ã€€1.å…¸å‹åº”ç”¨ï¼šä¼ ç»Ÿpcä»¥åŠandroidçš„Davlikè™šæ‹Ÿæœº</p>
<p>ã€€ã€€2.æŒ‡ä»¤é›†æ¶æ„ä¾èµ–äºç¡¬ä»¶ï¼Œå¯ç§»æ¤æ€§å·®</p>
<p>ã€€ã€€3.æ€§èƒ½ä¼˜ç§€ï¼Œæ‰§è¡Œæ•ˆç‡é«˜ï¼ˆå› ä¸ºèŠ±è´¹æ›´å°‘çš„æŒ‡ä»¤å»æ‰§è¡Œä¸€ä¸ªæ“ä½œï¼‰</p>
<p>ã€€ã€€4.å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå¯„å­˜å™¨æŒ‡ä»¤é›†å¾€å¾€éƒ½æ˜¯ä¸€åœ°å€æŒ‡ä»¤ã€äºŒåœ°å€æŒ‡ä»¤å’Œä¸‰åœ°å€æŒ‡ä»¤ä¸ºä¸»ï¼ˆæŒ‡ä»¤é›†åˆå¤§ï¼‰</p>
<h2 id="JVMçš„ç”Ÿå‘½å‘¨æœŸ"><a href="#JVMçš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="JVMçš„ç”Ÿå‘½å‘¨æœŸ"></a>JVMçš„ç”Ÿå‘½å‘¨æœŸ</h2><p>JVMå¯åŠ¨ -&gt; æ‰§è¡Œ -&gt; é€€å‡ºã€‚</p>
<h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><p>Java è™šæ‹Ÿæœºçš„å¯åŠ¨æ˜¯é€šè¿‡å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoader ï¼‰åˆ›å»ºä¸€ä¸ªåˆå§‹ç±»ï¼ˆInitial Classï¼‰æ¥å®Œæˆçš„è¿™ä¸ªç±»æ˜¯è™šæ‹Ÿæœºçš„å…·ä½“å®ç°æ¥æŒ‡å®šçš„ã€‚</p>
<h3 id="æ‰§è¡Œ"><a href="#æ‰§è¡Œ" class="headerlink" title="æ‰§è¡Œ"></a>æ‰§è¡Œ</h3><ul>
<li>ä¸€ä¸ªè¿è¡Œä¸­çš„Javaè™šæ‹Ÿæœºæœ‰ç€ä¸€ä¸ªæ¸…æ™°çš„ä»»åŠ¡ï¼šæ‰§è¡ŒJavaç¨‹åº</li>
<li>ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶å®ƒæ‰è¿è¡Œï¼Œç¨‹åºç»“æŸæ—¶å®ƒå°±åœæ­¢ã€‚</li>
<li>æ‰§è¡Œä¸€ä¸ªJavaç¨‹åºçš„æ—¶å€™ï¼ŒçœŸæ­£åœ¨æ‰§è¡Œçš„æ˜¯ä¸€ä¸ªJavaè™šæ‹Ÿæœºçš„è¿›ç¨‹ã€‚</li>
</ul>
<h3 id="é€€å‡º"><a href="#é€€å‡º" class="headerlink" title="é€€å‡º"></a>é€€å‡º</h3><p>æœ‰å¦‚ä¸‹å‡ ç§æƒ…å†µï¼š</p>
<ul>
<li>ç¨‹åºæ­£å¸¸ç»“æŸ</li>
<li>ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°äº†å¼‚å¸¸æˆ–é”™è¯¯è€Œå¼‚å¸¸ç»ˆæ­¢ã€‚</li>
<li>ç”±äºæ“ä½œç³»ç»Ÿå‡ºç°é”™è¯¯è€Œå¯¼è‡´Javaè™šæ‹Ÿæœºè¿›ç¨‹ç»ˆæ­¢ã€‚</li>
<li>æŸçº¿ç¨‹è°ƒç”¨Runtimeç±»æˆ–Systemç±»çš„exitæ–¹æ³•ï¼Œæˆ–Runtimeç±»çš„haltæ–¹æ³•ï¼Œå¹¶ä¸”Javaå®‰å…¨ç®¡ç†å™¨ä¹Ÿå…è®¸è¿™æ¬¡exitæˆ–haltæ“ä½œã€‚</li>
<li>é™¤æ­¤ä¹‹å¤–ï¼ŒJNIï¼ˆJava Native Interfaceï¼‰è§„èŒƒæè¿°äº†ç”¨JNI Invocation APIæ¥åŠ è½½æˆ–å¸è½½ Javaè™šæ‹Ÿæœºæ—¶ï¼ŒJavaè™šæ‹Ÿæœºçš„é€€å‡ºã€‚</li>
</ul>
<h2 id="æ‰§è¡Œå¼•æ“ç»“æ„"><a href="#æ‰§è¡Œå¼•æ“ç»“æ„" class="headerlink" title="æ‰§è¡Œå¼•æ“ç»“æ„"></a>æ‰§è¡Œå¼•æ“ç»“æ„</h2><p><img src="/p/4868cbd5/%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E7%BB%93%E6%9E%84.png" alt="img"></p>
</body></html>]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVMæœ¬åœ°æ–¹æ³•æ¥å£</title>
    <url>/p/3bd2308d.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="ä»€ä¹ˆæ˜¯æœ¬åœ°æ–¹æ³•ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æœ¬åœ°æ–¹æ³•ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æœ¬åœ°æ–¹æ³•ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æœ¬åœ°æ–¹æ³•ï¼Ÿ</h2><p>ç®€å•åœ°è®²ï¼Œä¸€ä¸ª<code>Native Methodå°±æ˜¯ä¸€ä¸ªJavaè°ƒç”¨éJavaä»£ç çš„æ¥å£</code>ã€‚ä¸€ä¸ªNative Methodæ˜¯è¿™æ ·ä¸€ä¸ªJavaæ–¹æ³•:è¯¥æ–¹æ³•çš„å®ç°ç”±éJavaè¯­è¨€å®ç°,æ¯”å¦‚Cã€‚è¿™ä¸ªç‰¹å¾å¹¶éJavaæ‰€æŒæœ‰,æœ‰å¾ˆå¤šå…¶å®ƒçš„ç¼–ç¨‹è¯­è¨€éƒ½æœ‰è¿™ä¸€æœºåˆ¶,æ¯”å¦‚åœ¨C++ä¸­,ä½ å¯ä»¥ç”¨externâ€Câ€å‘ŠçŸ¥C++ç¼–è¯‘å™¨å»è°ƒç”¨ä¸€ä¸ªCçš„å‡½æ•°ã€‚<br> â€œA native method is a Java method whose implementation is provided by non-java code.â€<br> åœ¨å®šä¹‰ä¸€ä¸ªnative methodæ—¶,å¹¶ä¸æä¾›å®ç°ä½“(æœ‰äº›åƒå®šä¹‰ä¸€ä¸ªJava interface),å› ä¸ºå…¶å®ç°ä½“æ˜¯ç”±éJavaè¯­è¨€åœ¨å¤–é¢å®ç°çš„ã€‚<br> æœ¬åœ°æ¥å£çš„ä½œç”¨æ˜¯èåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸ºJavaæ‰€ç”¨,å®ƒçš„åˆè¡·æ˜¯èåˆC/C++ç¨‹åºã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-Native-Method"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-Native-Method" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Native Method?"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Native Method?</h2><p>Javaä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿,ç„¶è€Œæœ‰äº›å±‚æ¬¡çš„ä»»åŠ¡ç”¨Javaå®ç°èµ·æ¥ä¸å®¹æ˜“ï¼Œæˆ–è€…æˆ‘ä»¬å¯¹ç¨‹åºçš„æ•ˆç‡å¾ˆåœ¨æ„æ—¶ï¼Œé—®é¢˜å°±æ¥äº†ã€‚</p>
<ul>
<li>ä¸Javaç¯å¢ƒå¤–äº¤äº’<br><strong>æœ‰æ—¶Javaåº”ç”¨éœ€è¦ä¸Javaå¤–é¢çš„ç¯å¢ƒäº¤äº’,è¿™æ˜¯æœ¬åœ°æ–¹æ³•å­˜åœ¨çš„ä¸»è¦åŸå› ã€‚</strong>ä½ å¯ä»¥æƒ³æƒ³Javaéœ€è¦ä¸ä¸€äº›åº•å±‚ç³»ç»Ÿï¼Œå¦‚æ“ä½œç³»ç»Ÿæˆ–æŸäº›ç¡¬ä»¶äº¤æ¢ä¿¡æ¯æ—¶çš„æƒ…å†µã€‚æœ¬åœ°æ–¹æ³•æ­£æ˜¯è¿™æ ·ä¸€ç§äº¤æµæœºåˆ¶ï¼šå®ƒä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªéå¸¸ç®€æ´çš„æ¥å£ï¼Œè€Œä¸”æˆ‘ä»¬æ— éœ€å»äº†è§£Javaåº”ç”¨ä¹‹å¤–çš„ç¹ççš„ç»†èŠ‚ã€‚</li>
<li>ä¸æ“ä½œç³»ç»Ÿäº¤äº’<br>JVMæ”¯æŒç€Javaè¯­è¨€æœ¬èº«å’Œè¿è¡Œæ—¶åº“ï¼Œå®ƒæ˜¯Javaç¨‹åºèµ–ä»¥ç”Ÿå­˜çš„å¹³å°ï¼Œå®ƒç”±ä¸€ä¸ªè§£é‡Šå™¨(è§£é‡Šå­—èŠ‚ç )å’Œä¸€äº›è¿æ¥åˆ°æœ¬åœ°ä»£ç çš„åº“ç»„æˆã€‚ç„¶è€Œä¸ç®¡æ€æ ·ï¼Œå®ƒæ¯•ç«Ÿä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿ,å®ƒç»å¸¸ä¾èµ–äºä¸€äº›åº•å±‚ç³»ç»Ÿçš„æ”¯æŒã€‚è¿™äº›åº•å±‚ç³»ç»Ÿå¸¸å¸¸æ˜¯å¼ºå¤§çš„æ“ä½œç³»ç»Ÿã€‚<strong>é€šè¿‡ä½¿ç”¨æœ¬åœ°æ–¹æ³•,æˆ‘ä»¬å¾—ä»¥ç”¨Javaå®ç°äº†jreçš„ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’,ç”šè‡³JVMçš„ä¸€äº›éƒ¨åˆ†å°±æ˜¯ç”¨Cå†™çš„ã€‚</strong>è¿˜æœ‰ï¼Œå¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨ä¸€äº›Javaè¯­è¨€æœ¬èº«æ²¡æœ‰æä¾›å°è£…çš„æ“ä½œç³»ç»Ÿçš„ç‰¹æ€§æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä½¿ç”¨æœ¬åœ°æ–¹æ³•ã€‚</li>
<li>Sunâ€™s Java<br><strong>Sunçš„è§£é‡Šå™¨æ˜¯ç”¨cå®ç°çš„ï¼Œè¿™ä½¿å¾—å®ƒèƒ½åƒä¸€äº›æ™®é€šçš„Cä¸€æ ·ä¸å¤–éƒ¨äº¤äº’ã€‚</strong>jreå¤§éƒ¨åˆ†æ˜¯ç”¨Javaå®ç°çš„ï¼Œå®ƒä¹Ÿé€šè¿‡ä¸€äº›æœ¬åœ°æ–¹æ³•ä¸å¤–ç•Œäº¤äº’ã€‚ä¾‹å¦‚ï¼šç±»java.lang.Threadçš„setPriority()æ–¹æ³•æ˜¯ç”¨Javaå®ç°çš„,ä½†æ˜¯å®ƒå®ç°è°ƒç”¨çš„æ˜¯è¯¥ç±»é‡Œçš„æœ¬åœ°æ–¹æ³•setPriority()ã€‚è¿™ä¸ªæœ¬åœ°æ–¹æ³•æ˜¯ç”¨Cå®ç°çš„,å¹¶è¢«æ¤å…¥JVMå†…éƒ¨,åœ¨windows 95çš„å¹³å°ä¸Š,è¿™ä¸ªæœ¬åœ°æ–¹æ³•æœ€ç»ˆå°†è°ƒç”¨win32 SetPriority() APIã€‚è¿™æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•çš„å…·ä½“å®ç°ç”±JVMç›´æ¥æä¾›,æ›´å¤šçš„æƒ…å†µæ˜¯æœ¬åœ°æ–¹æ³•ç”±å¤–éƒ¨çš„åŠ¨æ€é“¾æ¥åº“(external dynamic link library)æä¾›,ç„¶åè¢«JVMè°ƒç”¨ã€‚</li>
</ul>
<h2 id="æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆ"></a>æœ¬åœ°æ–¹æ³•æ ˆ</h2><p><strong>â€œæ ˆç®¡è¿è¡Œï¼Œå †ç®¡å­˜å‚¨â€</strong></p>
<p>Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç†Javaæ–¹æ³•çš„è°ƒç”¨ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ã€‚</p>
<p>å…è®¸è¢«å®ç°å›ºå®šæˆ–è€…å¯åŠ¨æ€æ‰©å±•çš„å†…å­˜å¤§å°ï¼ˆåœ¨å†…å­˜æº¢å‡ºæ–¹é¢æ˜¯ç›¸åŒçš„ï¼‰ã€‚</p>
<ul>
<li>å¦‚æœçº¿ç¨‹è¯·æ±‚åˆ†é…çš„æ ˆå®¹é‡è¶…è¿‡æœ¬åœ°æ–¹æ³•æ ˆå…è®¸çš„æœ€å¤§å®¹é‡ï¼ŒJavaè™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ª <code>StackOverFlowError </code> å¼‚å¸¸ã€‚</li>
<li>å¦‚æœæœ¬åœ°æ–¹æ³•æ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œå¹¶ä¸”åœ¨å°è¯•æ‰©å±•çš„æ—¶å€™æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œæˆ–è€…åœ¨åˆ›å»ºæ–°çš„çº¿ç¨‹æ—¶æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å»åˆ›å»ºå¯¹åº”çš„æœ¬åœ°æ–¹æ³•æ ˆï¼Œé‚£ä¹ˆJavaè™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ª <code>outOfMemoryError</code>å¼‚å¸¸ã€‚</li>
</ul>
<p>æœ¬åœ°æ–¹æ³•æ˜¯ä½¿ç”¨Cè¯­è¨€å®ç°çš„ã€‚</p>
<p>å®ƒçš„å…·ä½“åšæ³•æ˜¯ <code>Native Method Stack</code> ä¸­ç™»è®° <code>native</code> æ–¹æ³•ï¼Œåœ¨<code>Execution Engine</code> æ‰§è¡Œæ—¶åŠ è½½æœ¬åœ°æ–¹æ³•åº“ã€‚</p>
<p>å½“æŸä¸ªçº¿ç¨‹è°ƒç”¨ä¸€ä¸ªæœ¬åœ°æ–¹æ³•æ—¶ï¼Œå®ƒå°±è¿›å…¥äº†ä¸€ä¸ªå…¨æ–°çš„å¹¶ä¸”ä¸åœ¨å—è™šæ‹Ÿæœºé™åˆ¶çš„ä¸–ç•Œï¼Œå®ƒå’Œè™šæ‹Ÿæœºæ‹¥æœ‰åŒæ ·çš„æƒé™ï¼š</p>
<ul>
<li>æœ¬åœ°æ–¹æ³•å¯ä»¥é€šè¿‡æœ¬åœ°æ–¹æ³•æ¥å£æ¥è®¿é—®è™šæ‹Ÿæœºå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºã€‚</li>
<li>å®ƒç”šè‡³å¯ä»¥ç›´æ¥ä½¿ç”¨æœ¬åœ°å¤„ç†å™¨ä¸­çš„å¯„å­˜å™¨ã€‚</li>
<li>ç›´æ¥ä»æœ¬åœ°å†…å­˜çš„å †ä¸­åˆ†é…ä»»æ„æ•°é‡çš„å†…å­˜ã€‚</li>
</ul>
<p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„JVMéƒ½æ”¯æŒæœ¬åœ°æ–¹æ³•ã€‚å› ä¸ºJavaè™›æ‹Ÿæœºè§„èŒƒå¹¶æ²¡æœ‰æ˜ç¡®è¦æ±‚æœ¬åœ°æ–¹æ³•æ ˆçš„ä½¿ç”¨è¯­è¨€ã€å…·ä½“å®ç°æ–¹å¼ã€æ•°æ®ç»“æ„ç­‰ã€‚å¦‚æœJVMäº§å“ä¸æ‰“ç®—æ”¯æŒnativeæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æ— éœ€å®ç°æœ¬åœ°æ–¹æ³•æ ˆã€‚</p>
<p>åœ¨Hotspot JVMä¸­ï¼Œ ç›´æ¥å°†æœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVMå¯¹è±¡çš„åˆ†é…è¿‡ç¨‹</title>
    <url>/p/baebd9bc.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="MinorGCã€YoungGCã€MajorGCã€FullGCçš„åŒºåˆ«"><a href="#MinorGCã€YoungGCã€MajorGCã€FullGCçš„åŒºåˆ«" class="headerlink" title="MinorGCã€YoungGCã€MajorGCã€FullGCçš„åŒºåˆ«"></a>MinorGCã€YoungGCã€MajorGCã€FullGCçš„åŒºåˆ«</h2><p>å®é™…ä¸Šï¼ŒMinorGCåˆç§°ä¸º YoungGCï¼Œå®Œå…¨ç­‰ä»·ã€‚YoungGC çš„è§¦å‘æ¡ä»¶æ˜¯ Eden æ»¡äº†çš„æ—¶å€™ï¼Œä¼šä¸€èµ·å› Eden å’Œ S0æˆ–S1ã€‚æ³¨æ„ï¼šå½“å¹¸å­˜è€…åŒºæ»¡äº†ä¹‹åæ˜¯ä¸ä¼šè§¦å‘YoungGCçš„ã€‚</p>
<p>MajorGCæ˜¯é’ˆå¯¹è€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€‚FullGCæ˜¯å°†æ–°ç”Ÿä»£ã€è€å¹´ä»£ã€æ–¹æ³•åŒºä¸€èµ·å›æ”¶ã€‚æˆ‘ä»¬å¤§éƒ¨åˆ†æ—¶å€™å›æ”¶çš„éƒ½æ˜¯æŒ‡æ–°ç”Ÿä»£ã€‚</p>
<p>é’ˆå¯¹Hotspot Vmçš„å®ç°ï¼Œå®ƒé‡Œé¢çš„GCæŒ‰ç…§å›æ”¶åŒºåŸŸåˆåˆ†ä¸ºä¸¤å¤§ç±»ï¼šéƒ¨åˆ†æ”¶é›†ï¼ˆPartial GCï¼‰ã€æ•´å †æ”¶é›†ï¼ˆFull GCï¼‰ã€‚</p>
<h3 id="éƒ¨åˆ†æ”¶é›†"><a href="#éƒ¨åˆ†æ”¶é›†" class="headerlink" title="éƒ¨åˆ†æ”¶é›†"></a>éƒ¨åˆ†æ”¶é›†</h3><ul>
<li>æ–°ç”Ÿä»£æ”¶é›†ï¼ˆMinor GC / Young GCï¼‰ï¼šåªæ˜¯æ–°ç”Ÿä»£ï¼ˆEden \ S0,S1)çš„åƒåœ¾æ”¶é›†å™¨ã€‚</li>
<li>è€å¹´ä»£æ”¶é›†ï¼ˆMajor GC / Old GCï¼‰ï¼šåªæ˜¯è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚ç›®å‰åªæœ‰CMS GCä¼šæœ‰å•ç‹¬æ”¶é›†è€å¹´ä»£çš„è¡Œä¸ºï¼Œå¾ˆå¤šæ—¶å€™Major GCä¼šå’ŒFull GCæ··æ·†ä½¿ç”¨ï¼Œéœ€è¦å…·ä½“åˆ†è¾¨æ˜¯è€å¹´ä»£å›æ”¶è¿˜æ˜¯æ•´å †å›æ”¶ã€‚</li>
<li>æ··åˆæ”¶é›†ï¼ˆMixed GCï¼‰ï¼šæ”¶é›†æ•´ä¸ªæ–°ç”Ÿä»£ä»¥åŠéƒ¨åˆ†è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚ç›®å‰åªæœ‰G1 GCä¼šæœ‰è¿™ç§è¡Œä¸ºã€‚</li>
</ul>
<h3 id="æ•´å †æ”¶é›†"><a href="#æ•´å †æ”¶é›†" class="headerlink" title="æ•´å †æ”¶é›†"></a>æ•´å †æ”¶é›†</h3><p>æ”¶é›†æ•´ä¸ªJavaå †åŒºã€æ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†å™¨ã€‚</p>
<h3 id="è€å¹´ä»£GC-Major-GC-Full-GC-è§¦å‘æœºåˆ¶"><a href="#è€å¹´ä»£GC-Major-GC-Full-GC-è§¦å‘æœºåˆ¶" class="headerlink" title="è€å¹´ä»£GC(Major GC/Full GC)è§¦å‘æœºåˆ¶"></a>è€å¹´ä»£GC(Major GC/Full GC)è§¦å‘æœºåˆ¶</h3><ul>
<li>æŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„GC,å¯¹è±¡ä»è€å¹´ä»£æ¶ˆå¤±æ—¶,æˆ‘ä»¬è¯´â€Major GCâ€æˆ–â€Full GCâ€å‘ç”Ÿäº†ã€‚</li>
<li>å‡ºç°äº†Major GC,ç»å¸¸ä¼šä¼´éšè‡³å°‘ä¸€æ¬¡çš„Minor GC(ä½†éç»å¯¹çš„,åœ¨Parallel Scavengeæ”¶é›†å™¨çš„æ”¶é›†ç­–ç•¥é‡Œå°±æœ‰ç›´æ¥è¿›è¡ŒMajor GCçš„ç­–ç•¥é€‰æ‹©è¿‡ç¨‹)ã€‚ä¹Ÿå°±æ˜¯åœ¨è€å¹´ä»£ç©ºé—´ä¸è¶³æ—¶,ä¼šå…ˆå°è¯•è§¦å‘Minor GCã€‚å¦‚æœä¹‹åç©ºé—´è¿˜ä¸è¶³,åˆ™è§¦å‘Major GCã€‚</li>
<li>Major GCçš„é€Ÿåº¦ä¸€èˆ¬ä¼šæ¯”Minor GCæ…¢10å€ä»¥ä¸Š,STWçš„æ—¶é—´æ›´é•¿ã€‚</li>
<li>å¦‚æœ Major GC ä¹‹åå†…å­˜è¿˜æ˜¯ä¸è¶³ï¼Œå°±æŠ¥å‡ºOOMçš„é”™è¯¯äº†ã€‚</li>
</ul>
<h2 id="å¯¹è±¡åˆ†é…è¿‡ç¨‹æ¦‚è¿°"><a href="#å¯¹è±¡åˆ†é…è¿‡ç¨‹æ¦‚è¿°" class="headerlink" title="å¯¹è±¡åˆ†é…è¿‡ç¨‹æ¦‚è¿°"></a>å¯¹è±¡åˆ†é…è¿‡ç¨‹æ¦‚è¿°</h2><p>ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜æ˜¯ä¸€ä»¶éå¸¸ä¸¥è°¨å’Œå¤æ‚çš„ä»»åŠ¡ï¼ŒJVMçš„è®¾è®¡è€…ä»¬ä¸ä»…éœ€è¦è€ƒè™‘å†…å­˜å¦‚ä½•åˆ†é…ã€åœ¨å“ªé‡Œåˆ†é…ç­‰é—®é¢˜ï¼Œå¹¶ä¸”ç”±äºå†…å­˜åˆ†é…ç®—æ³•ä¸å†…å­˜å›æ”¶ç®—æ³•å¯†åˆ‡ç›¸å…³ï¼Œæ‰€ä»¥è¿˜éœ€è¦è€ƒè™‘GCæ‰§è¡Œå®Œå†…å­˜å›æ”¶åæ˜¯å¦ä¼šåœ¨å†…å­˜ç©ºé—´ä¸­äº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚</p>
<p>New çš„å¯¹è±¡å…ˆæ”¾åœ¨ä¼Šç”¸å›­åŒºï¼Œå½“ä¼Šç”¸å›­åŒºçš„ç©ºé—´å¡«æ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼ŒJVMçš„åƒåœ¾å›æ”¶æœŸå°†å¯¹ä¼Šç”¸å›­åŒºè¿›è¡Œåƒåœ¾å›æ”¶ï¼ˆMinor GCï¼‰ï¼Œå°†ä¼Šç”¸å›­åŒºä¸­çš„ä¸åœ¨è¢«å…¶ä»–å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡è¿›è¡Œé”€æ¯ï¼Œå†åŠ è½½æ–°çš„å¯¹è±¡åˆ°ä¼Šç”¸å›­åŒºï¼Œç„¶åå°†ä¼Šç”¸å›­åŒºä¸­çš„å‰©ä½™å¯¹è±¡ç§»åŠ¨åˆ°å¹¸å­˜è€…0åŒºï¼ˆS0ï¼‰ï¼Œå¦‚æœå†æ¬¡è§¦å‘åƒåœ¾å›æ”¶ï¼Œæ­¤æ—¶ä¸Šæ¬¡å¹¸å­˜ä¸‹æ¥çš„æ”¾åˆ°å¹¸å­˜è€…0åŒºï¼Œå¦‚æœæ²¡æœ‰å›æ”¶ï¼Œå°±ä¼šæ”¾åˆ°å¹¸å­˜è€…1åŒºï¼ˆS1ï¼‰ã€‚å¦‚æœå†æ¬¡ç»å†åƒåœ¾å›æ”¶ï¼Œæ­¤æ—¶ä¼šé‡æ–°æ”¾åˆ°S0åŒºï¼Œæ¥ç€å†å»S1ï¼Œå¦‚æœå†æ¬¡ç»å†åƒåœ¾å›æ”¶ï¼Œæ­¤æ—¶ä¼šé‡æ–°æ”¾å›S0ï¼Œæ¥ç€å†å»S1ï¼Œå¦‚æ­¤å¾ªç¯ç›´åˆ°ç¬¬15æ¬¡ï¼ˆé»˜è®¤ï¼Œå¯ä»¥é€šè¿‡<code>-XX:MaxTenuringThreshold=N</code>è®¾ç½®ï¼‰è½¬å»è€å¹´ä»£ã€‚</p>
<h2 id="GCè¿‡ç¨‹"><a href="#GCè¿‡ç¨‹" class="headerlink" title="GCè¿‡ç¨‹"></a>GCè¿‡ç¨‹</h2><h3 id="ç¬¬ä¸€æ¬¡GC"><a href="#ç¬¬ä¸€æ¬¡GC" class="headerlink" title="ç¬¬ä¸€æ¬¡GC"></a>ç¬¬ä¸€æ¬¡GC</h3><p>å½“ä¼Šç”¸å›­åŒºçš„ç©ºé—´æ»¡äº†ï¼Œå¹¶ä¸”ç¨‹åºåˆéœ€è¦åˆ›å»ºæ–°çš„å¯¹è±¡æ—¶ï¼ŒJVMåƒåœ¾å›æ”¶å™¨å°†ä¼Šç”¸å›­åŒºè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå°†ä¼Šç”¸å›­åŒºçš„ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡è¿›è¡Œé”€æ¯ï¼Œå†åœ¨ä¼Šç”¸å›­åŒºåˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</p>
<p>ç„¶åå°†ä¼Šç”¸å›­åŒºå‰©ä½™çš„å¯¹è±¡ç§»åŠ¨åˆ°S0ï¼Œæ¯ä¸ªå¯¹è±¡è¢«åˆ†é…äº†ä¸€ä¸ªå¹´é¾„è®¡æ•°å™¨ï¼ˆageï¼‰ï¼Œæ¯è¿›è¡Œä¸€æ¬¡GCï¼Œå¹¸å­˜ä¸‹æ¥çš„å¯¹è±¡ageç´¯åŠ ï¼Œä¸Šé¢çš„ä¸¤ä¸ªå¹¸å­˜å¯¹è±¡ageè¢«èµ‹å€¼ä¸º1ã€‚</p>
<p>æ­¤æ¬¡GCå®Œæˆåï¼Œä¼Šç”¸å›­åŒºæ˜¯ç©ºçš„ã€‚</p>
<p><img src="/p/baebd9bc/JVM-%E7%AC%AC%E4%B8%80%E6%AC%A1GC%E8%BF%87%E7%A8%8B.png" alt="image-20211018225038962"></p>
<p>S0åŒºå’ŒS1åŒºï¼Œä¹Ÿè¢«å«åšFromåŒºå’ŒToåŒºï¼Œåˆ¤æ–­äºŒè€…å¾ˆç®€å•ï¼Œè°æ˜¯ç©ºçš„è°æ˜¯ToåŒºï¼Œåˆ™å¦å¤–ä¸€ä¸ªå°±æ˜¯FromåŒºï¼›</p>
<h3 id="ç¬¬äºŒæ¬¡GC"><a href="#ç¬¬äºŒæ¬¡GC" class="headerlink" title="ç¬¬äºŒæ¬¡GC"></a>ç¬¬äºŒæ¬¡GC</h3><p>å½“ä¼Šç”¸å›­åŒºç©ºé—´åˆæ»¡äº†æ—¶ï¼Œè¿›è¡Œç¬¬äºŒæ¬¡GCï¼Œå°†ä¼Šç”¸å›­åŒºå¹¸å­˜çš„å¯¹è±¡æ”¾å…¥S1åŒºï¼Œageæ­¤æ—¶ä¸º1ï¼›</p>
<p>åŒæ—¶å¯¹S0åŒºçš„å¯¹è±¡è¿›è¡Œåˆ¤æ–­æ˜¯å¦è¿˜è¢«ä½¿ç”¨ï¼Œå¦‚æœè¢«ä½¿ç”¨çš„è¯ï¼Œå°±å°†å…¶æ”¾å…¥S1åŒºï¼Œageç´¯åŠ æ­¤æ—¶ä¸º2ï¼›</p>
<p>ç¬¬äºŒæ¬¡GCå®Œæˆåï¼ŒS0åŒºä¸ºç©ºäº†ï¼Œæ­¤æ—¶S0åŒºä¸ºToåŒºï¼ŒS1åŒºä¸ºFromåŒºï¼›</p>
<p><img src="/p/baebd9bc/JVM-%E7%AC%AC%E4%BA%8C%E6%AC%A1GC%E8%BF%87%E7%A8%8B.png" alt="image-20211018225544620"></p>
<h3 id="ç¬¬Næ¬¡GC"><a href="#ç¬¬Næ¬¡GC" class="headerlink" title="ç¬¬Næ¬¡GC"></a>ç¬¬Næ¬¡GC</h3><p>ç¬¬Næ¬¡GCæ—¶ï¼Œæˆ‘ä»¬å‘ç°S1åŒºçš„æœ‰ä¸¤ä¸ªå¯¹è±¡çš„ageå·²ç»æ˜¯15äº†ï¼Œå¦‚æœæ­¤æ—¶è¿™ä¸¤ä¸ªå¯¹è±¡è¿˜æ˜¯è¢«å¼•ç”¨çš„ï¼Œåˆ™å°†å…¶æ™‹å‡åˆ°OldåŒºï¼›</p>
<p>å…¶ä¸­15ä¸ºé»˜è®¤é˜ˆå€¼ï¼Œè¿™ä¸ªé˜ˆå€¼æ˜¯å¯ä»¥è‡ªå·±è®¾ç½®ï¼š<code>-XX:MaxTenuringThreshold=N</code></p>
<p><img src="/p/baebd9bc/JVM-%E7%AC%ACN%E6%AC%A1GC%E8%BF%87%E7%A8%8B.png" alt="image-20211018225827055"></p>
<h2 id="å¯¹è±¡åˆ†é…çš„ç‰¹æ®Šæƒ…å†µ"><a href="#å¯¹è±¡åˆ†é…çš„ç‰¹æ®Šæƒ…å†µ" class="headerlink" title="å¯¹è±¡åˆ†é…çš„ç‰¹æ®Šæƒ…å†µ"></a>å¯¹è±¡åˆ†é…çš„ç‰¹æ®Šæƒ…å†µ</h2><p>åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡æ—¶ï¼Œé¦–å…ˆåˆ¤æ–­EdenåŒºæ˜¯å¦æ”¾å¾—ä¸‹ï¼Œå¦‚æœæ”¾å¾—ä¸‹ï¼Œå°±ä¸ºå…¶åˆ†é…å†…å­˜ï¼Œæ”¾ä¸ä¸‹çš„è¯ï¼Œå°±è¿›è¡ŒYGCï¼›</p>
<p>ç„¶åå†åˆ¤æ–­EdenåŒºæ˜¯å¦æ”¾å¾—ä¸‹ï¼Œå¦‚æœæ­¤æ—¶æ”¾å¾—ä¸‹çš„è¯ï¼Œå°±ä¸ºå…¶åˆ†é…å†…å­˜ï¼›</p>
<p>å¦‚æœè¿˜æ˜¯æ”¾ä¸ä¸‹ï¼Œè¯´æ˜è¿™ä¸ªå¯¹è±¡æ¯”ä¼Šç”¸å›­åŒºçš„ç©ºé—´è¿˜è¦å¤§ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ä¸ªè¶…å¤§å¯¹è±¡ï¼Œæ­¤æ—¶å°†å…¶æ”¾å…¥OldåŒºï¼›</p>
<p>å¦‚æœOldåŒºä¹Ÿæ”¾ä¸ä¸‹ï¼Œå°±è¿›è¡ŒFGCï¼Œç„¶åå†åˆ¤æ–­OldåŒºèƒ½ä¸èƒ½æ”¾ä¸‹ï¼Œæ”¾å¾—ä¸‹å°±å­˜åœ¨OldåŒºï¼Œå¦‚æœè¿˜æ˜¯æ”¾ä¸ä¸‹ï¼Œå°±ä¼šå‡ºç°OOMå¼‚å¸¸ï¼›</p>
<p>åœ¨è¿›è¡ŒYGCçš„æ—¶å€™ï¼Œå¹¸å­˜çš„å¯¹è±¡ä¼šæ”¾å…¥å¹¸å­˜åŒºï¼Œæ­¤æ—¶åˆ¤æ–­æ˜¯å¦èƒ½æ”¾ä¸‹ï¼Œå¦‚æœå¹¸å­˜åŒºæ”¾ä¸ä¸‹ï¼Œå°±ä¼šç›´æ¥æ”¾å…¥OldåŒºã€‚</p>
<p><img src="/p/baebd9bc/JVM-%E7%89%B9%E6%AE%8A%E7%9A%84GC%E8%BF%87%E7%A8%8B.png" alt="image-20211018230016194"></p>
</body></html>]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVMå¯¹ä»£ç çš„ä¼˜åŒ–</title>
    <url>/p/c69e3549.html</url>
    <content><![CDATA[<html><head></head><body><p>JVMï¼ˆHotSpotï¼‰åœ¨å“ªäº›é˜¶æ®µèƒ½å¯¹å¼€å‘è€…å†™çš„ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Ÿåœ¨Javaä¸­çš„ä¸‰ç§ç¼–è¯‘æ–¹å¼ä¸­ï¼šå‰ç«¯ç¼–è¯‘ï¼ˆJavacï¼‰ã€å³æ—¶ç¼–è¯‘ï¼ˆJust In Timeï¼‰ã€æå‰ç¼–è¯‘ï¼ˆAhead Of Timeï¼‰ã€‚</p>
<p>Javaçš„æ‰§è¡Œè¿‡ç¨‹æ•´ä½“å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œåœ¨ç¬¬ä¸€æ­¥æ­¥ä¸­ç”±javacå°†æºç ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šè¿›è¡Œè¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æï¼Œç¼–è¯‘åŸç†ä¸­è¿™éƒ¨åˆ†çš„ç¼–è¯‘ç§°ä¸ºå‰ç«¯ç¼–è¯‘ã€‚å³.javaæˆåŠŸç¼–è¯‘ä¸º.classçš„è¿‡ç¨‹ã€‚</p>
<h2 id="å‰ç«¯ç¼–è¯‘"><a href="#å‰ç«¯ç¼–è¯‘" class="headerlink" title="å‰ç«¯ç¼–è¯‘"></a>å‰ç«¯ç¼–è¯‘</h2><p>å‰ç«¯ç¼–è¯‘å™¨ Javacï¼ˆæ˜¯Javaè¯­è¨€å†™çš„ï¼‰ ï¼Œç¼–è¯‘è¿‡ç¨‹å¦‚ä¸‹å›¾ã€‚å‰æœŸç¼–è¯‘ä¼˜åŒ–ä»£ç ä¸»è¦åˆ†ä¸º<strong>ç¼–è¯‘è¿‡ç¨‹</strong>å’Œ<strong>è¯­æ³•ç³–</strong>çš„ä¼˜åŒ–ã€‚</p>
<p><img src="/p/c69e3549/JVM-Javac%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B.png" alt="Javacçš„ç¼–è¯‘è¿‡ç¨‹"></p>
<h3 id="è§£æä¸å¡«å……ç¬¦å·è¡¨"><a href="#è§£æä¸å¡«å……ç¬¦å·è¡¨" class="headerlink" title="è§£æä¸å¡«å……ç¬¦å·è¡¨"></a>è§£æä¸å¡«å……ç¬¦å·è¡¨</h3><ul>
<li>è¯æ³•è¯­æ³•åˆ†æï¼šæºä»£ç çš„å­—ç¬¦æµ ==&gt; æ ‡è®°tokené›†åˆ<ul>
<li>å¦‚ int a = b + 2;  â‡’  int , a , = , b , + , 2</li>
</ul>
</li>
<li>æ ¹æ®tokenåºåˆ—æ„é€ <strong>æŠ½è±¡è¯­æ³•æ ‘</strong></li>
<li>æ­¤åï¼Œç¼–è¯‘å™¨åŸºæœ¬ä¸Šä¸ä¼šå†æ“ä½œæºä»£ç ï¼Œè€Œæ˜¯æ“ä½œæŠ½è±¡è¯­æ³•æ ‘</li>
<li>å¡«å……ç¬¦å·è¡¨ï¼šç”±ä¸€ç»„ç¬¦å·åœ°å€å’Œç¬¦å·ä¿¡æ¯æ„æˆ</li>
</ul>
<h3 id="æ³¨è§£å¤„ç†"><a href="#æ³¨è§£å¤„ç†" class="headerlink" title="æ³¨è§£å¤„ç†"></a>æ³¨è§£å¤„ç†</h3><p>JDK1.5åJavaå¼€å§‹æ”¯æŒæ³¨è§£ï¼ŒJDK1.6ä¸­æä¾›äº†ä¸€ç»„<strong>æ’ä»¶å¼æ³¨è§£å¤„ç†å™¨</strong>çš„æ ‡å‡†APIï¼Œå¯ä»¥è‡ªå®šä¹‰æ³¨è§£å¤„ç†å™¨æ¥å¹²é¢„ç¼–è¯‘å™¨çš„è¡Œä¸ºã€‚åŸç†æ˜¯å¹²é¢„ç”Ÿæˆçš„å­—èŠ‚ç çš„æ–‡ä»¶ã€‚</p>
<p>å¯ä»¥æŠŠæ³¨è§£å¤„ç†å™¨çœ‹ä½œæ˜¯ç¼–è¯‘å™¨çš„æ’ä»¶ï¼Œåœ¨ç¼–è¯‘æœŸé—´å¯¹æ³¨è§£è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥å¯¹è¯­æ³•æ ‘è¿›è¡Œè¯»å–ã€ä¿®æ”¹ã€æ·»åŠ ä»»æ„å…ƒç´ ï¼›ä½†å¦‚æœæœ‰æ³¨è§£å¤„ç†å™¨ä¿®æ”¹äº†è¯­æ³•æ ‘ï¼ˆASTï¼‰ï¼Œç¼–è¯‘å™¨å°†è¿”å›è§£æåŠå¡«å……ç¬¦å·è¡¨çš„è¿‡ç¨‹ï¼Œé‡æ–°å¤„ç†ï¼Œç›´åˆ°æ²¡æœ‰æ³¨è§£å¤„ç†å™¨ä¿®æ”¹ä¸ºæ­¢ï¼Œæ¯ä¸€æ¬¡é‡æ–°å¤„ç†å¾ªç¯ç§°ä¸ºä¸€ä¸ªRoundã€‚</p>
<h3 id="è¯­æ³•åˆ†æä¸å­—èŠ‚ç ç”Ÿæˆ"><a href="#è¯­æ³•åˆ†æä¸å­—èŠ‚ç ç”Ÿæˆ" class="headerlink" title="è¯­æ³•åˆ†æä¸å­—èŠ‚ç ç”Ÿæˆ"></a>è¯­æ³•åˆ†æä¸å­—èŠ‚ç ç”Ÿæˆ</h3><p>å¯¹ç»“æ„ä¸Šæ­£ç¡®çš„ä»£ç è¿›è¡Œæ£€æŸ¥ï¼šç±»å‹æ£€æŸ¥ã€ä»£ç é€»è¾‘æ£€æŸ¥ã€‚</p>
<p>è§£æè¯­æ³•ç³–ï¼šè¯­æ³•ç³–æ˜¯æŒ‡åœ¨è®¡ç®—æœºè¯­è¨€ä¸­æ·»åŠ çš„æŸç§è¯­æ³•ï¼Œè¿™ç§è¯­æ³•å¯¹è¯­è¨€çš„åŠŸèƒ½æ²¡æœ‰å½±å“ï¼Œä½†æ˜¯æ›´æ–¹ä¾¿ç¨‹åºå‘˜çš„ä½¿ç”¨ã€‚JVMæ˜¯ä¸æ”¯æŒè¯­æ³•ç³–çš„è¯­æ³•çš„ï¼Œæ‰€ä»¥éœ€è¦å‰ç«¯ç¼–è¯‘å™¨å°†å…¶è¿˜åŸä¸ºç®€å•çš„åŸºç¡€è¯­æ³•ç»“æ„ã€‚å¸¸è§çš„æœ‰å¦‚ä¸‹è§£æï¼ˆä»¥ä¸‹è¯æ˜å¯é€šè¿‡å­—èŠ‚ç åç¼–è¯‘è¿‡æ¥æŸ¥çœ‹ï¼‰ï¼š</p>
<h4 id="æ³›å‹ä¸ç±»å‹æ“¦é™¤"><a href="#æ³›å‹ä¸ç±»å‹æ“¦é™¤" class="headerlink" title="æ³›å‹ä¸ç±»å‹æ“¦é™¤"></a>æ³›å‹ä¸ç±»å‹æ“¦é™¤</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(); </span><br><span class="line"><span class="comment">//æ“¦é™¤å</span></span><br><span class="line"><span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br></pre></td></tr></tbody></table></figure>

<p>å¦‚æœæœ‰ç±»ä¸­æœ‰ä»¥ä¸‹æ³›å‹é‡è½½çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œç±»å‹æ“¦é™¤åè¿˜èƒ½ç¼–è¯‘é€šè¿‡å—ï¼Ÿ</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GenericType</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">(List&lt;String&gt; list)</span>{</span><br><span class="line">        System.out.print(<span class="string">"invoke method(List&lt;String&gt; list)"</span>);</span><br><span class="line">    } </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">(List&lt;Integer&gt; list)</span>{</span><br><span class="line">        System.out.print(<span class="string">"invoke method(List&lt;Integer&gt; list)"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç¼–è¯‘ä¸é€šè¿‡ï¼Œä¸å…è®¸æ³›å‹é‡è½½ã€‚</p>
<h4 id="è‡ªåŠ¨æ‹†è£…ç®±"><a href="#è‡ªåŠ¨æ‹†è£…ç®±" class="headerlink" title="è‡ªåŠ¨æ‹†è£…ç®±"></a>è‡ªåŠ¨æ‹†è£…ç®±</h4><p>è£…ç®±ï¼šåŸºæœ¬ç±»å‹å˜ä¸ºåŒ…è£…ç±»å‹ã€‚ä¾‹å¦‚ï¼šInteger n = 1;</p>
<p>æ‹†ç®±ï¼šåŒ…è£…ç±»å‹å˜ä¸ºåŸºæœ¬ç±»å‹ã€‚ä¾‹å¦‚ï¼šint i = n;</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line"><span class="comment">// JDK1.7 ç¼–è¯‘å</span></span><br><span class="line">List&lt;Integer&gt; list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="comment">// JDK1.8 ç¼–è¯‘å</span></span><br><span class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="keyword">new</span> <span class="title class_">Integer</span>[] {</span><br><span class="line">    Integer.valueOf(<span class="number">1</span>),Integer.valueOf(<span class="number">2</span>),Integer.valueOf(<span class="number">3</span>)</span><br><span class="line">}); </span><br></pre></td></tr></tbody></table></figure>

<h4 id="éå†å¾ªç¯è½¬è¿­ä»£å™¨"><a href="#éå†å¾ªç¯è½¬è¿­ä»£å™¨" class="headerlink" title="éå†å¾ªç¯è½¬è¿­ä»£å™¨"></a>éå†å¾ªç¯è½¬è¿­ä»£å™¨</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (Integer i : list) {</span><br><span class="line">    sum += i;</span><br><span class="line">}</span><br><span class="line"><span class="comment">// ç¼–è¯‘å</span></span><br><span class="line"><span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">Iterator</span> <span class="variable">localIterator</span> <span class="operator">=</span> list.iterator();localIterator.hasNext();){</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> ((Integer) localIterator.next()).intValue();</span><br><span class="line">    sum += i;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="æ¡ä»¶ç¼–è¯‘æ“¦é™¤ä¸æˆç«‹çš„åˆ†æ”¯"><a href="#æ¡ä»¶ç¼–è¯‘æ“¦é™¤ä¸æˆç«‹çš„åˆ†æ”¯" class="headerlink" title="æ¡ä»¶ç¼–è¯‘æ“¦é™¤ä¸æˆç«‹çš„åˆ†æ”¯"></a>æ¡ä»¶ç¼–è¯‘æ“¦é™¤ä¸æˆç«‹çš„åˆ†æ”¯</h4><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) {</span><br><span class="line">    System.out.println(<span class="string">"hello"</span>);</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">    System.out.println(<span class="string">"mrdjun"</span>);</span><br><span class="line">}</span><br><span class="line"><span class="comment">// ç¼–è¯‘å</span></span><br><span class="line">System.out.println(<span class="string">"hello"</span>);</span><br></pre></td></tr></tbody></table></figure>

<h4 id="å¯å˜é•¿å‚æ•°å°è£…æˆæ•°ç»„å‚æ•°"><a href="#å¯å˜é•¿å‚æ•°å°è£…æˆæ•°ç»„å‚æ•°" class="headerlink" title="å¯å˜é•¿å‚æ•°å°è£…æˆæ•°ç»„å‚æ•°"></a>å¯å˜é•¿å‚æ•°å°è£…æˆæ•°ç»„å‚æ•°</h4><p>JDK1.5æ–°ç‰¹æ€§ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span>... args)</span> {</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i : args) {</span><br><span class="line">        a += i;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">}</span><br><span class="line"><span class="comment">// ç¼–è¯‘å</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span>... args)</span> {</span><br><span class="line">    <span class="type">int</span>[] var2 = args;</span><br><span class="line">    <span class="type">int</span> <span class="variable">var3</span> <span class="operator">=</span> args.length;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">var4</span> <span class="operator">=</span> <span class="number">0</span>; var4 &lt; var3; ++var4) {</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> var2[var4];</span><br><span class="line">        a += i;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å­—èŠ‚ç ç”Ÿæˆï¼šå­—èŠ‚ç æ˜¯IRç ï¼ŒIRç å¤§è‡´å¯ä»¥ç†è§£ä¸ºéœ€è¦å†è½¬ä¸€æ¬¡æ‰èƒ½è®©æœºå™¨è¯†åˆ«ã€‚</p>
<h2 id="å³æ—¶ç¼–è¯‘"><a href="#å³æ—¶ç¼–è¯‘" class="headerlink" title="å³æ—¶ç¼–è¯‘"></a>å³æ—¶ç¼–è¯‘</h2><p>è¿è¡ŒæœŸç¼–è¯‘å™¨ï¼ˆJITï¼‰çš„ä»£ç ä¼˜åŒ–ï¼Œç®€å•æ¥è¯´å°±æ˜¯ä¸€å¥è¯ï¼šå°†çƒ­ç‚¹ä»£ç ç›´æ¥ç¼–è¯‘æˆæœºå™¨ç è¿›è¡Œæ‰§è¡Œå’Œé€ƒé€¸åˆ†æã€‚</p>
<p>JVMä¸­é›†æˆäº†ä¸¤ç§ç¼–è¯‘å™¨ï¼šClient Compilerã€Server Compilerï¼Œé€šå¸¸å°†å‰è€…ç§°ä¸ºC1ç¼–è¯‘å™¨ï¼Œåè€…ç§°ä¸ºC2ç¼–è¯‘å™¨ã€‚Client Compileræ³¨é‡å¯åŠ¨é€Ÿåº¦å’Œå±€éƒ¨çš„ä¼˜åŒ–ï¼ŒServer Compileråˆ™æ›´åŠ å…³æ³¨å…¨å±€çš„ä¼˜åŒ–ï¼Œæ€§èƒ½ä¼šæ›´å¥½ï¼Œä½†ç”±äºä¼šè¿›è¡Œæ›´å¤šçš„å…¨å±€åˆ†æï¼Œæ‰€ä»¥å¯åŠ¨é€Ÿåº¦ä¼šå˜æ…¢ã€‚ä¸¤ç§ç¼–è¯‘å™¨æœ‰ç€ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œåœ¨è™šæ‹Ÿæœºä¸­åŒæ—¶å‘æŒ¥ä½œç”¨ã€‚</p>
<h3 id="â€œå°†çƒ­ç‚¹ä»£ç ç›´æ¥ç¼–è¯‘æˆæœºå™¨ç è¿›è¡Œæ‰§è¡Œâ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"><a href="#â€œå°†çƒ­ç‚¹ä»£ç ç›´æ¥ç¼–è¯‘æˆæœºå™¨ç è¿›è¡Œæ‰§è¡Œâ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ" class="headerlink" title="â€œå°†çƒ­ç‚¹ä»£ç ç›´æ¥ç¼–è¯‘æˆæœºå™¨ç è¿›è¡Œæ‰§è¡Œâ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"></a>â€œå°†çƒ­ç‚¹ä»£ç ç›´æ¥ç¼–è¯‘æˆæœºå™¨ç è¿›è¡Œæ‰§è¡Œâ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</h3><p>å¸¸è§çš„ç¼–è¯‘å‹è¯­è¨€å¦‚C++ï¼Œé€šå¸¸ä¼šæŠŠä»£ç ç›´æ¥ç¼–è¯‘æˆCPUæ‰€èƒ½ç†è§£çš„æœºå™¨ç æ¥è¿è¡Œã€‚è€ŒJavaä¸ºäº†å®ç°â€œä¸€æ¬¡ç¼–è¯‘ï¼Œå¤„å¤„è¿è¡Œâ€çš„ç‰¹æ€§ï¼ŒæŠŠç¼–è¯‘çš„è¿‡ç¨‹åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œé¦–å…ˆå®ƒä¼šå…ˆç”±javacç¼–è¯‘æˆé€šç”¨çš„ä¸­é—´å½¢å¼â€”â€”å­—èŠ‚ç ï¼ˆIRç ï¼‰ï¼Œç„¶åå†ç”±è§£é‡Šå™¨é€æ¡å°†å­—èŠ‚ç è§£é‡Šä¸ºæœºå™¨ç æ¥æ‰§è¡Œã€‚æ‰€ä»¥åœ¨æ€§èƒ½ä¸Šï¼ŒJavaé€šå¸¸ä¸å¦‚C++è¿™ç±»ç¼–è¯‘å‹è¯­è¨€ã€‚</p>
<p>ä¸ºäº†ä¼˜åŒ–Javaçš„æ€§èƒ½ ï¼ŒJVMåœ¨è§£é‡Šå™¨ä¹‹å¤–å¼•å…¥äº†å³æ—¶ï¼ˆJust In Timeï¼‰ç¼–è¯‘å™¨ï¼šå½“ç¨‹åºè¿è¡Œæ—¶ï¼Œè§£é‡Šå™¨é¦–å…ˆå‘æŒ¥ä½œç”¨ï¼Œä»£ç å¯ä»¥ç›´æ¥æ‰§è¡Œã€‚éšç€æ—¶é—´æ¨ç§»ï¼Œå³æ—¶ç¼–è¯‘å™¨é€æ¸å‘æŒ¥ä½œç”¨ï¼ŒæŠŠè¶Šæ¥è¶Šå¤šçš„ä»£ç ç¼–è¯‘ä¼˜åŒ–æˆæœ¬åœ°ä»£ç ï¼Œæ¥è·å–æ›´é«˜çš„æ‰§è¡Œæ•ˆç‡ã€‚è§£é‡Šå™¨è¿™æ—¶å¯ä»¥ä½œä¸ºç¼–è¯‘è¿è¡Œçš„é™çº§æ‰‹æ®µï¼Œåœ¨ä¸€äº›ä¸å¯é çš„ç¼–è¯‘ä¼˜åŒ–å‡ºç°é—®é¢˜æ—¶ï¼Œå†åˆ‡æ¢å›è§£é‡Šæ‰§è¡Œï¼Œä¿è¯ç¨‹åºå¯ä»¥æ­£å¸¸è¿è¡Œã€‚</p>
<p>å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰æå¤§åœ°æé«˜äº†Javaç¨‹åºçš„è¿è¡Œé€Ÿåº¦ï¼Œè€Œä¸”è·Ÿé™æ€ç¼–è¯‘ç›¸æ¯”ï¼Œå³æ—¶ç¼–è¯‘å™¨å¯ä»¥é€‰æ‹©æ€§åœ°ç¼–è¯‘çƒ­ç‚¹ä»£ç ï¼Œçœå»äº†å¾ˆå¤šç¼–è¯‘æ—¶é—´ï¼Œä¹ŸèŠ‚çœå¾ˆå¤šçš„ç©ºé—´ã€‚ç›®å‰ï¼Œå³æ—¶ç¼–è¯‘å™¨å·²ç»éå¸¸æˆç†Ÿäº†ï¼Œåœ¨æ€§èƒ½å±‚é¢ç”šè‡³å¯ä»¥å’Œç¼–è¯‘å‹è¯­è¨€ç›¸æ¯”ã€‚ä¸è¿‡åœ¨è¿™ä¸ªé¢†åŸŸï¼Œå¤§å®¶ä¾ç„¶åœ¨ä¸æ–­æ¢ç´¢å¦‚ä½•ç»“åˆä¸åŒçš„ç¼–è¯‘æ–¹å¼ï¼Œä½¿ç”¨æ›´åŠ æ™ºèƒ½çš„æ‰‹æ®µæ¥æå‡ç¨‹åºçš„è¿è¡Œé€Ÿåº¦ã€‚</p>
<h3 id="æ€ä¹ˆæ ·æ‰ä¼šè¢«è®¤ä¸ºæ˜¯çƒ­ç‚¹ä»£ç å‘¢ï¼Ÿ"><a href="#æ€ä¹ˆæ ·æ‰ä¼šè¢«è®¤ä¸ºæ˜¯çƒ­ç‚¹ä»£ç å‘¢ï¼Ÿ" class="headerlink" title="æ€ä¹ˆæ ·æ‰ä¼šè¢«è®¤ä¸ºæ˜¯çƒ­ç‚¹ä»£ç å‘¢ï¼Ÿ"></a>æ€ä¹ˆæ ·æ‰ä¼šè¢«è®¤ä¸ºæ˜¯çƒ­ç‚¹ä»£ç å‘¢ï¼Ÿ</h3><p>JVMä¸­ä¼šè®¾ç½®ä¸€ä¸ªé˜ˆå€¼ï¼Œå½“æ–¹æ³•æˆ–è€…ä»£ç å—çš„åœ¨ä¸€å®šæ—¶é—´å†…çš„è°ƒç”¨æ¬¡æ•°è¶…è¿‡è¿™ä¸ªé˜ˆå€¼æ—¶å°±ä¼šè¢«ç¼–è¯‘ï¼Œå­˜å…¥codeCacheä¸­ã€‚å½“ä¸‹æ¬¡æ‰§è¡Œæ—¶ï¼Œå†é‡åˆ°è¿™æ®µä»£ç ï¼Œå°±ä¼šä»codeCacheä¸­è¯»å–æœºå™¨ç ï¼Œç›´æ¥æ‰§è¡Œï¼Œä»¥æ­¤æ¥æå‡ç¨‹åºè¿è¡Œçš„æ€§èƒ½ã€‚æ•´ä½“çš„æ‰§è¡Œè¿‡ç¨‹å¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/p/c69e3549/JVM-%E7%83%AD%E7%82%B9%E4%BB%A3%E7%A0%81%E7%9A%84%E5%88%A4%E5%AE%9A%E8%BF%87%E7%A8%8B.png" alt="img"></p>
<h3 id="é€ƒé€¸åˆ†æ"><a href="#é€ƒé€¸åˆ†æ" class="headerlink" title="é€ƒé€¸åˆ†æ"></a>é€ƒé€¸åˆ†æ</h3><p>å…ˆè§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯é€ƒé€¸åˆ†æã€‚å‡å¦‚ä½ è¦è·‘ï¼Œæˆ‘è¦åˆ†æä½ ä¸ºä»€ä¹ˆè¦è·‘ï¼Œè¦è·‘åˆ°å“ªé‡Œå»ã€‚è¿™ä¸ªåˆ†æçš„è¿‡ç¨‹å°±å«é€ƒé€¸åˆ†æã€‚</p>
<p>é€ƒé€¸åˆ†æçš„ç›®çš„ä¹Ÿå¾ˆæ˜ç¡®ï¼šåˆ¤æ–­å¯¹è±¡çš„ä½œç”¨åŸŸæ˜¯å¦è¶…å‡ºå‡½æ•°ä½“ï¼Œå³åˆ¤æ–­æ˜¯å¦é€ƒé€¸å‡ºå‡½æ•°ä½“ã€‚</p>
<p><code>-XX:+DoEscapeAnalysis</code> å¯ç”¨é€ƒé€¸åˆ†æï¼ˆJDK1.8é»˜è®¤å¼€å¯ï¼‰ã€‚</p>
<h4 id="æ ˆä¸Šåˆ†é…"><a href="#æ ˆä¸Šåˆ†é…" class="headerlink" title="æ ˆä¸Šåˆ†é…"></a>æ ˆä¸Šåˆ†é…</h4><p>å¯¹é‚£äº›ä½œç”¨äºä¸ä¼šé€ƒé€¸å‡ºæ–¹æ³•çš„å¯¹è±¡ï¼Œåœ¨åˆ†é…å†…å­˜æ—¶ï¼Œä¸åœ¨å°†å¯¹è±¡åˆ†é…åœ¨å †å†…å­˜ä¸­ï¼Œè€Œæ˜¯å°†å¯¹è±¡å±æ€§æ‰“æ•£ååˆ†é…åœ¨çº¿ç¨‹ç§æœ‰æ ˆå†…å­˜ä¸Šï¼Œè¿™æ ·éšç€æ–¹æ³•è°ƒç”¨ç»“æŸï¼Œæ ˆä¸Šåˆ†é…æ‰“æ•£çš„å¯¹è±¡ä¹Ÿè¢«å›æ”¶æ‰ï¼Œä¸åœ¨å¢åŠ  GC é¢å¤–å‹åŠ›ã€‚</p>
<p>æ ˆä¸Šåˆ†é…é€Ÿåº¦å¿«ï¼Œä½†æ ˆç©ºé—´å°ï¼Œå¤§å¯¹è±¡æ— æ³•å®ç°æ ˆä¸Šåˆ†é…ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// æ ˆä¸Šåˆ†é…ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">build</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    u.setAge(<span class="number">25</span>);</span><br><span class="line">    u.setName(<span class="string">"mrdjun"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>é‚£ä¹ˆç°åœ¨å°±å¯ä»¥å›ç­”ä¸€ä¸ªé—®é¢˜äº†ï¼šåœ¨Javaä¸­åˆ›å»ºçš„å¯¹è±¡ä¸€å®šåœ¨å †ä¸­å—ï¼Ÿ</p>
<p>å¯¹è±¡åˆ†é…æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/p/c69e3549/JVM-%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%86%E9%85%8D%E6%B5%81%E7%A8%8B.png" alt="img"></p>
<h4 id="æ ‡é‡æ›¿æ¢"><a href="#æ ‡é‡æ›¿æ¢" class="headerlink" title="æ ‡é‡æ›¿æ¢"></a>æ ‡é‡æ›¿æ¢</h4><p>å½“ä¸€ä¸ªæ–¹æ³•ä¸­çš„å¯¹è±¡æœªå‘ç”Ÿé€ƒé€¸æ—¶ï¼Œä¼šå°†è¿™ä¸ªå¯¹è±¡çš„å±æ€§æ‹†åˆ†ä¸ºå¤šä¸ªå˜é‡ã€‚ä¾‹å¦‚ä¸‹é¢æœ‰è¿™æ ·ä¸€ä¸ªå¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Point</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> x;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> y;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨æ–¹æ³•ä¸­ä½¿ç”¨</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">Point</span> <span class="variable">point</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Point</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    System.out.println(point.getX() + <span class="string">","</span> + point.getY());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å½“ point å¯¹è±¡åœ¨åé¢çš„æ‰§è¡Œè¿‡ç¨‹ä¸­æœªç”¨åˆ°æ—¶ï¼Œç»è¿‡ç¼–è¯‘åï¼Œä»£ç ä¼šå˜æˆä¸‹é¢è¿™ä¸ªç»“æ„ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    System.out.println(x + <span class="string">","</span> + y);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç®€å•åœ°è¯´ï¼Œå°±æ˜¯ç”¨æ ‡é‡æ›¿æ¢èšåˆé‡ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¦‚æœåˆ›å»ºçš„å¯¹è±¡å¹¶æœªç”¨åˆ°å…¶ä¸­çš„å…¨éƒ¨å˜é‡ï¼Œåˆ™å¯ä»¥èŠ‚çœä¸€å®šçš„å†…å­˜ã€‚å¯¹äºä»£ç æ‰§è¡Œè€Œè¨€ï¼Œæ— éœ€å»æ‰¾å¯¹è±¡çš„å¼•ç”¨ï¼Œä¹Ÿä¼šæ›´å¿«ã€‚</p>
<ul>
<li><p>æ ‡é‡æ˜¯æŒ‡ä¸å¯åˆ†å‰²çš„é‡ï¼Œå¦‚javaä¸­åŸºæœ¬æ•°æ®ç±»å‹å’Œreferenceç±»å‹ï¼Œç›¸å¯¹çš„ä¸€ä¸ªæ•°æ®å¯ä»¥ç»§ç»­åˆ†è§£ï¼Œç§°ä¸ºèšåˆé‡ï¼›</p>
</li>
<li><p>å¦‚æœæŠŠä¸€ä¸ªå¯¹è±¡æ‹†æ•£ï¼Œå°†å…¶æˆå‘˜å˜é‡æ¢å¤åˆ°åŸºæœ¬ç±»å‹æ¥è®¿é—®å°±å«åšæ ‡é‡æ›¿æ¢ï¼›</p>
</li>
<li><p>å¦‚æœé€ƒé€¸åˆ†æå‘ç°ä¸€ä¸ªå¯¹è±¡ä¸ä¼šè¢«å¤–éƒ¨è®¿é—®ï¼Œå¹¶ä¸”è¯¥å¯¹è±¡å¯ä»¥è¢«æ‹†æ•£ï¼Œé‚£ä¹ˆç»è¿‡ä¼˜åŒ–ä¹‹åï¼Œå¹¶ä¸ç›´æ¥ç”Ÿæˆè¯¥å¯¹è±¡ï¼Œè€Œæ˜¯åœ¨æ ˆä¸Šåˆ›å»ºè‹¥å¹²ä¸ªæˆå‘˜å˜é‡ï¼›</p>
</li>
</ul>
<p><code>-XX:+EliminateAllocations</code> å¯ç”¨æ ‡é‡æ›¿æ¢ï¼ˆJDK1.8é»˜è®¤å¼€å¯ï¼‰ã€‚</p>
<p><code>-XX:+PrintEliminateAllocations</code> æŸ¥çœ‹æ ‡é‡æ›¿æ¢çš„æƒ…å†µã€‚</p>
<h4 id="åŒæ­¥çœç•¥"><a href="#åŒæ­¥çœç•¥" class="headerlink" title="åŒæ­¥çœç•¥"></a>åŒæ­¥çœç•¥</h4><p>ä¹Ÿå°±æ˜¯â€œé”æ¶ˆé™¤â€ã€‚åœ¨é€ƒé€¸åˆ†æè¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡è¢«å‘ç°åªèƒ½ä»ä¸€ä¸ªçº¿ç¨‹è¢«è®¿é—®åˆ°ï¼Œé‚£ä¹ˆå¯¹äºè¿™ä¸ªå¯¹è±¡çš„æ“ä½œæ— éœ€è€ƒè™‘åŒæ­¥ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">Object</span> <span class="variable">mrjdun</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">synchronized</span>(mrjdun) {</span><br><span class="line">        System.out.println(mrjdun);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä»£ç ä¸­å¯¹<code>mrjdun</code>è¿™ä¸ªå¯¹è±¡è¿›è¡ŒåŠ é”ï¼Œä½†æ˜¯<code>mrjdun</code>å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåªåœ¨f()æ–¹æ³•ä¸­ï¼Œå¹¶ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰€è®¿é—®çš„æƒ…å†µï¼ŒJITç¼–è¯‘é˜¶æ®µå°±ä¼šä¼˜åŒ–æˆä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">Object</span> <span class="variable">mrjdun</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    System.out.println(mrjdun);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="æå‰ç¼–è¯‘"><a href="#æå‰ç¼–è¯‘" class="headerlink" title="æå‰ç¼–è¯‘"></a>æå‰ç¼–è¯‘</h2><p>é™æ€æå‰ç¼–è¯‘å™¨ï¼ˆAOTï¼‰ï¼šç›´æ¥æŠŠç¨‹åºç¼–è¯‘æˆä¸ç›®æ ‡æœºå™¨æŒ‡ä»¤é›†ç›¸å…³çš„äºŒè¿›åˆ¶ä»£ç çš„è¿‡ç¨‹ã€‚</p>
<p>ç›®å‰æœ‰ä¸¤ç§ä¸»è¦çš„å®ç°æ–¹å¼ï¼š</p>
<p>ä¸ä¼ ç»ŸCã€C++ç¼–è¯‘å™¨ç±»ä¼¼ï¼Œåœ¨ç¨‹åºè¿è¡Œä¹‹å‰æŠŠç¨‹åºä»£ç ç¼–è¯‘æˆæœºå™¨ç çš„é™æ€ç¿»è¯‘å·¥ä½œ<br>æŠŠåŸæœ¬å³æ—¶ç¼–è¯‘å™¨åœ¨è¿è¡Œæ—¶è¦åšçš„ç¼–è¯‘å·¥ä½œæå‰åšå¥½å¹¶ä¿å­˜ä¸‹æ¥ï¼Œä¸‹æ¬¡è¿è¡Œåˆ°è¿™äº›ä»£ç ï¼ˆè­¬å¦‚å…¬å…±åº“ä»£ç åœ¨è¢«åŒä¸€å°æœºå™¨å…¶ä»–Javaè¿›ç¨‹ä½¿ç”¨ï¼‰æ—¶ç›´æ¥æŠŠå®ƒåŠ è½½è¿›æ¥ä½¿ç”¨<br>ç¬¬ä¸€ç§å®ç°æ–¹å¼åœ¨Javaä¸­çš„å­˜åœ¨ä»·å€¼ç›´æŒ‡å³æ—¶ç¼–è¯‘çš„æœ€å¤§å¼±ç‚¹ï¼šå³æ—¶ç¼–è¯‘è¦å ç”¨ç¨‹åºè¿è¡Œæ—¶é—´å’Œè¿ç®—èµ„æºã€‚ä¾‹å¦‚æœ€è€—æ—¶çš„ä¼˜åŒ–æªæ–½ä¹‹ä¸€ï¼šè¿‡ç¨‹è§åˆ†æï¼Œå¿…é¡»åœ¨å…¨ç¨‹åºèŒƒå›´å†…åšå¤§é‡è€—æ—¶çš„è®¡ç®—å·¥ä½œï¼Œå¦‚æœæ˜¯åœ¨ç¨‹åºè¿è¡Œä¹‹å‰è¿›è¡Œçš„é™æ€ç¼–è¯‘ï¼Œè¿™äº›è€—æ—¶æ“ä½œå°±å¯ä»¥å¤§èƒ†çš„è¿›è¡Œã€‚</p>
<p>å¯¹äºç¬¬äºŒç§æ–¹å¼ï¼Œæœ¬è´¨ä¸Šæ˜¯ç»™å³æ—¶ç¼–è¯‘å™¨åšç¼“å­˜åŠ é€Ÿï¼Œå»æ”¹å–„Javaç¨‹åºçš„å¯åŠ¨æ—¶é—´ï¼Œä»¥åŠéœ€è¦ä¸€æ®µæ—¶é—´é¢„çƒ­ä¹‹åæ‰èƒ½è¾¾åˆ°æœ€é«˜æ€§èƒ½çš„é—®é¢˜ã€‚è¿™ç§æå‰ç¼–è¯‘è¢«ç§°ä¸ºåŠ¨æ€æå‰ç¼–è¯‘æˆ–è€…ç›´æ¥å«å³æ—¶ç¼–è¯‘ç¼“å­˜ã€‚HotSpotè¿è¡Œæ—¶å¯ä»¥ç›´æ¥åŠ è½½è¿™äº›ç¼–è¯‘ç»“æœï¼Œå®ç°å¿«é€Ÿç¨‹åºå¯åŠ¨é€Ÿåº¦ï¼Œå‡å°‘ç¨‹åºè¾¾åˆ°å…¨é€Ÿè¿è¡ŒçŠ¶æ€æ‰€éœ€è¦çš„æ—¶é—´ã€‚</p>
<p>ä½†æ˜¯å³æ—¶ç¼–è¯‘ç›¸æ¯”äºæå‰ç¼–è¯‘ä¹Ÿæœ‰å¾ˆå¤šä¼˜ç‚¹ï¼š</p>
<p>æ€§èƒ½åˆ†æåˆ¶å¯¼ä¼˜åŒ–ã€‚è§£é‡Šå™¨å’Œå®¢æˆ·ç«¯ç¼–è¯‘å™¨åœ¨è¿è¡ŒæœŸé—´ä¼šä¸æ–­æ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¸€èˆ¬æ— æ³•åœ¨é™æ€åˆ†ææ˜¯è·å¾—ï¼Œæˆ–è€…ä¸ä¸€å®šå­˜åœ¨å”¯ä¸€çš„è§£ï¼Œä½†åœ¨åŠ¨æ€è¿è¡Œæ—¶å¾ˆå®¹æ˜“å¾—åˆ°<br>åŸºé‡‘é¢„æµ‹æ€§ä¼˜åŒ–ã€‚é™æ€ä¼˜åŒ–æ— è®ºä½•æ—¶éƒ½å¿…é¡»ä¿è¯ä¼˜åŒ–åçš„æ‰€æœ‰ç¨‹åºå¤–éƒ¨å¯è§å½±å“ï¼ˆä¸ä»…ä»…æ˜¯æ‰§è¡Œç»“æœï¼‰ä¸ä¼˜åŒ–å‰å¿…é¡»æ˜¯ä¸€è‡´çš„ã€‚å³æ—¶ç¼–è¯‘çš„ç­–ç•¥å°±å¯ä»¥ä¸å¿…é‚£ä¹ˆä¿å®ˆï¼Œå¦‚æœæ€§èƒ½ç›‘æ§ä¿¡æ¯èƒ½å¤Ÿæ”¯æŒå®ƒåšå‡ºä¸€äº›æ­£ç¡®çš„å¯èƒ½å¾ˆå¤§ä½†æ˜¯æ— æ³•ä¿è¯ç»å¯¹æ­£ç¡®çš„é¢„æµ‹åˆ¤æ–­ï¼Œå°±å¯ä»¥è¿›è¡Œå¤§èƒ†çš„ä¼˜åŒ–ï¼Œå¤§ä¸äº†é€€å›åˆ°ä½çº§iæŒ‰ä¸€èµ·ç”šè‡³è§£é‡Šå™¨ä¸Šè¿è¡Œã€‚è€Œè¿™æ ·çš„ä¼˜åŒ–å¾€å¾€èƒ½å¤Ÿå¤§å¹…åº¦é™ä½ç›®æ ‡ç¨‹åºçš„å¤æ‚åº¦ï¼Œè¾“å‡ºè¿è¡Œé€Ÿåº¦éå¸¸é«˜çš„ä»£ç <br>é“¾æ¥æ—¶ä¼˜åŒ–ã€‚ç”±äºJavaå¤©ç”Ÿæ˜¯åŠ¨æ€è¿æ¥çš„ï¼Œæ‰€ä»¥æå‰ç¼–è¯‘æ— æ³•åšåˆ°é“¾æ¥åçš„ä¼˜åŒ–ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVMåŒäº²å§”æ´¾æ¨¡å‹</title>
    <url>/p/2a88658c.html</url>
    <content><![CDATA[<html><head></head><body><p>Javaè™šæ‹Ÿæœºå¯¹classæ–‡ä»¶é‡‡ç”¨çš„æ˜¯<strong>æŒ‰éœ€åŠ è½½</strong>çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´å½“éœ€è¦ä½¿ç”¨è¯¥ç±»æ—¶æ‰ä¼šå°†å®ƒçš„classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ç”Ÿæˆclasså¯¹è±¡ã€‚è€Œä¸”åŠ è½½æŸä¸ªç±»çš„classæ–‡ä»¶æ—¶ï¼ŒJavaè™šæ‹Ÿæœºé‡‡ç”¨çš„æ˜¯<strong>åŒäº²å§”æ´¾æ¨¡å¼</strong>ï¼Œå³æŠŠè¯·æ±‚äº¤ç”±çˆ¶ç±»å¤„ç†ï¼Œå®ƒæ˜¯ä¸€ç§ä»»åŠ¡å§”æ´¾æ¨¡å¼ã€‚</p>
<blockquote>
<p>Tipsï¼šå¦‚æœåœ¨å·¥ç¨‹ç›®å½•çš„srcä¸‹æ–°å»ºä¸€ä¸ªåä¸º java.lang çš„åŒ…ï¼Œåœ¨å…¶ä¸­æ–°å»ºä¸€ä¸ªç±»åStringçš„ç±»ï¼Œè¿™ä¸ªç±»èƒ½å¤Ÿæ­£å¸¸è¿è¡Œå—ï¼Ÿ</p>
</blockquote>
<p>ç¨‹åºä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">String</span> {</span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        System.out.println(<span class="string">"èƒ½å¤Ÿåˆå§‹åŒ–æˆ‘å—ï¼Ÿ"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        java.lang.<span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">java</span>.lang.String();</span><br><span class="line">        System.out.println(<span class="string">"hello,world"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">hello,world</span><br></pre></td></tr></tbody></table></figure>

<p>è¯´æ˜å¹¶æœªåˆå§‹åŒ–åœ¨java.langåŒ…ä¸‹è‡ªå®šä¹‰çš„Stringç±»ã€‚è¿™æ˜¯åŒäº²å§”æ´¾æœºåˆ¶ä¿æŠ¤äº†æˆ‘ä»¬ç³»ç»Ÿæ ¸å¿ƒAPIä¸å®¹æ˜“è¢«ç ´åã€‚</p>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>1ã€å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½è¯·æ±‚ï¼Œå®ƒå¹¶ä¸ä¼šè‡ªå·±å…ˆå»åŠ è½½ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™çˆ¶ç±»çš„åŠ è½½å™¨å»æ‰§è¡Œã€‚</p>
<p>2ã€å¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜å­˜åœ¨å…¶çˆ¶ç±»åŠ è½½å™¨ï¼Œåˆ™è¿›ä¸€æ­¥å‘ä¸Šå§”æ‰˜ï¼Œä¾æ¬¡é€’å½’è¯·æ±‚æœ€ç»ˆå°†åˆ°è¾¾é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ã€‚</p>
<p>3ã€å¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»åŠ è½½ä»»åŠ¡ï¼Œå°±æˆåŠŸè¿”å›ï¼Œå€˜è‹¥çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆæ­¤åŠ è½½ä»»åŠ¡ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ï¼Œè¿™å°±æ˜¯åŒäº²å§”æ´¾æ¨¡å¼ã€‚</p>
<p><img src="/p/2a88658c/%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.png" alt="image-20210830234508802"></p>
<p>åœ¨ java.lang åŒ…ä¸‹çš„ ClassLoader ç±»ä¸­çš„ loadClass æ–¹æ³•ï¼Œæºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Class&lt;?&gt; loadClass(String name) <span class="keyword">throws</span> ClassNotFoundException {</span><br><span class="line">    <span class="keyword">return</span> loadClass(name, <span class="literal">false</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="type">boolean</span> resolve)</span><br><span class="line">    <span class="keyword">throws</span> ClassNotFoundException {</span><br><span class="line">    <span class="comment">// é¦–å…ˆï¼Œæ£€æŸ¥æ˜¯å¦å·²ç»è¢«ç±»åŠ è½½å™¨åŠ è½½è¿‡</span></span><br><span class="line">    Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="literal">null</span>) {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// å­˜åœ¨çˆ¶åŠ è½½å™¨ï¼Œé€’å½’çš„äº¤ç”±çˆ¶åŠ è½½å™¨</span></span><br><span class="line">            <span class="keyword">if</span> (parent != <span class="literal">null</span>) {</span><br><span class="line">                c = parent.loadClass(name, <span class="literal">false</span>);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="comment">// ç›´åˆ°æœ€ä¸Šé¢çš„Bootstrapç±»åŠ è½½å™¨</span></span><br><span class="line">                c = findBootstrapClassOrNull(name);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (ClassNotFoundException e) {</span><br><span class="line">            <span class="comment">// ClassNotFoundException thrown if class not found</span></span><br><span class="line">            <span class="comment">// from the non-null parent class loader</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (c == <span class="literal">null</span>) {</span><br><span class="line">            <span class="comment">// If still not found, then invoke findClass in order</span></span><br><span class="line">            <span class="comment">// to find the class.</span></span><br><span class="line">            c = findClass(name);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å…¶å®è¿™æ®µä»£ç å·²ç»å¾ˆå¥½çš„è§£é‡Šäº†åŒäº²å§”æ´¾æœºåˆ¶ï¼Œåœ¨ç»“åˆä¸‹å›¾åŠ æ·±ç†è§£</p>
<p><img src="/p/2a88658c/JVM-ClassLoader-Step.png" alt="JVM-ClassLoader-Step"></p>
<h2 id="ä¸ºä»€ä¹ˆè¦è®¾è®¡è¿™ç§æœºåˆ¶"><a href="#ä¸ºä»€ä¹ˆè¦è®¾è®¡è¿™ç§æœºåˆ¶" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è®¾è®¡è¿™ç§æœºåˆ¶"></a>ä¸ºä»€ä¹ˆè¦è®¾è®¡è¿™ç§æœºåˆ¶</h2><p>1ã€ä¿æŠ¤ç¨‹åºå®‰å…¨ï¼Œé˜²æ­¢æ ¸å¿ƒAPIè¢«éšæ„ç¯¡æ”¹ã€‚åœ¨java.langåŒ…ä¸‹ï¼Œå¼€å‘è€…è‡ªå®šä¹‰çš„ç±»ä¸­çš„mainæ–¹æ³•ä¸å…è®¸æ‰§è¡Œï¼Œé˜²æ­¢æ¶æ„ä»£ç å¯¹ç¨‹åºäº§ç”Ÿç ´åã€‚</p>
<p>2ã€é¿å…ç±»çš„é‡å¤åŠ è½½ã€‚ä¸€ä¸ªç±»åªä¼šè¢«åŠ è½½ä¸€æ¬¡ã€‚</p>
<h2 id="æ²™ç®±å®‰å…¨æœºåˆ¶"><a href="#æ²™ç®±å®‰å…¨æœºåˆ¶" class="headerlink" title="æ²™ç®±å®‰å…¨æœºåˆ¶"></a>æ²™ç®±å®‰å…¨æœºåˆ¶</h2><p>è‡ªå®šä¹‰stringç±»ï¼Œä½†æ˜¯åœ¨åŠ è½½è‡ªå®šä¹‰Stringç±»çš„æ—¶å€™ä¼šç‡å…ˆä½¿ç”¨å¼•å¯¼ç±»åŠ è½½å™¨åŠ è½½ï¼Œè€Œå¼•å¯¼ç±»åŠ è½½å™¨åœ¨åŠ è½½çš„è¿‡ç¨‹ä¸­ä¼šå…ˆåŠ è½½jdkè‡ªå¸¦çš„æ–‡ä»¶(rt. jaråŒ…ä¸­java\lang\String.class)ï¼ŒæŠ¥é”™ä¿¡æ¯è¯´æ²¡æœ‰mainæ–¹æ³•ï¼Œå°±æ˜¯å› ä¸ºåŠ è½½çš„æ˜¯rt. jaråŒ…ä¸­çš„Stringç±»ã€‚è¿™æ ·å¯ä»¥ä¿è¯å¯¹javaæ ¸å¿ƒæºä»£ç çš„ä¿æŠ¤ï¼Œè¿™å°±æ˜¯<strong>æ²™ç®±å®‰å…¨æœºåˆ¶</strong>ã€‚</p>
<h2 id="è¡¥å……å†…å®¹"><a href="#è¡¥å……å†…å®¹" class="headerlink" title="è¡¥å……å†…å®¹"></a>è¡¥å……å†…å®¹</h2><blockquote>
<p>åœ¨JVMä¸­è¡¨ç¤ºä¸¤ä¸ªclasså¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªç±»çš„ä¸¤ä¸ªå¿…è¦æ¡ä»¶</p>
</blockquote>
<p>1ã€ç±»çš„å®Œæ•´è·¯å¾„ä¸€ç›´ï¼ˆåŒ…å+ç±»åï¼‰ã€‚</p>
<p>2ã€åŠ è½½è¿™ä¸ªç±»çš„ClassLoaderå¿…é¡»ç›¸åŒã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œåœ¨JVMä¸­ï¼Œ å³ä½¿è¿™ä¸¤ä¸ªç±»å¯¹è±¡(classå¯¹è±¡)æ¥æºåŒä¸€ä¸ªClassæ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªè™šæ‹Ÿæœºæ‰€åŠ è½½ï¼Œä½†åªè¦åŠ è½½å®ƒä»¬çš„ClassLoaderå®ä¾‹å¯¹è±¡ä¸åŒï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªç±»å¯¹è±¡ä¹Ÿæ˜¯ä¸ç›¸ç­‰çš„ã€‚</p>
<blockquote>
<p>å¯¹ç±»åŠ è½½å™¨çš„å¼•ç”¨</p>
</blockquote>
<p>JVMå¿…é¡»çŸ¥é“â€“ä¸ªç±»å‹æ˜¯ç”±å¯åŠ¨åŠ è½½å™¨åŠ è½½çš„è¿˜æ˜¯ç”±ç”¨æˆ·ç±»åŠ è½½<br>å™¨åŠ è½½çš„ã€‚å¦‚æœä¸€ä¸ªç±»å‹æ˜¯ç”±ç”¨æˆ·ç±»åŠ è½½å™¨åŠ è½½çš„ï¼Œé‚£ä¹ˆJVMä¼šå°†è¿™ä¸ªç±»åŠ è½½å™¨çš„ä¸€ä¸ªå¼•ç”¨ä½œä¸ºç±»å‹ä¿¡æ¯çš„ä¸€éƒ¨åˆ†ä¿å­˜åœ¨æ–¹æ³•åŒºä¸­ã€‚å½“è§£æä¸€ä¸ªç±»å‹åˆ°å¦ä¸€ä¸ªç±»å‹çš„å¼•ç”¨çš„æ—¶å€™ï¼ŒJVMéœ€è¦ä¿è¯è¿™ä¸¤ä¸ªç±»å‹çš„ç±»åŠ è½½å™¨æ˜¯ç›¸åŒçš„ã€‚</p>
<blockquote>
<p>Javaç¨‹åºå¯¹ç±»çš„ä½¿ç”¨æ–¹å¼åˆ†ä¸ºï¼šä¸»åŠ¨ä½¿ç”¨ã€è¢«åŠ¨ä½¿ç”¨ä¸¤ç§æ–¹å¼</p>
</blockquote>
<p> ä¸»åŠ¨ä½¿ç”¨ï¼Œåˆåˆ†ä¸ºä¸ƒç§æƒ…å†µ:</p>
<p>1ã€åˆ›å»ºç±»çš„å®ä¾‹</p>
<p>2ã€è®¿é—®æŸä¸ªç±»æˆ–è€…æ¥å£çš„é™æ€å˜é‡,æˆ–è€…å¯¹è¯¥é™æ€å˜é‡èµ‹å€¼</p>
<p>3ã€åå°„( æ¯”å¦‚:Class.forName(â€œjava.lang.String)))</p>
<p>4ã€åˆå§‹åŒ–ä¸€ä¸ªç±»çš„å­ç±»</p>
<p>5ã€javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶è¢«æ ‡æ˜ä¸ºå¯åŠ¨ç±»çš„ç±»</p>
<p>6ã€java 7å¼€å§‹æä¾›çš„åŠ¨æ€è¯­è¨€æ”¯æŒ</p>
<p>é™¤äº†ä»¥ä¸Šä¸ƒç§æƒ…å†µ,å…¶ä»–ä½¿ç”¨Javaç±»çš„æ–¹å¼éƒ½è¢«çœ‹ä½œæ˜¯å¯¹ç±»çš„è¢«åŠ¨ä½¿ç”¨éƒ½ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ–ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVMç¨‹åºè®¡æ•°å™¨</title>
    <url>/p/1e963439.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="è¿è¡Œæ—¶æ•°æ®åŒº"><a href="#è¿è¡Œæ—¶æ•°æ®åŒº" class="headerlink" title="è¿è¡Œæ—¶æ•°æ®åŒº"></a>è¿è¡Œæ—¶æ•°æ®åŒº</h2><p><img src="/p/1e963439/JVM-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA.png" alt="image-20210906231826602"></p>
<p>Javaè™šæ‹Ÿæœºå®šä¹‰äº†ä¸€ç³»åˆ—é€»è¾‘æ•°æ®åŒºåŸŸï¼Œæœ‰äº›æ˜¯éšç€è™šæ‹Ÿæœºçš„å¯åŠ¨è€Œåˆ›å»ºï¼Œè™šæ‹Ÿæœºçš„å…³é—­è€Œé”€æ¯ã€‚è¿˜æœ‰ä¸€éƒ¨åˆ†æ˜¯éšç€çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸåˆ›å»ºé”€æ¯çš„ã€‚</p>
<p>æˆ‘ä»¬æœ‰å¿…è¦æ·±å…¥äº†è§£è¿™å—çš„å†…å®¹ï¼Œå› ä¸ºå®ƒå°†å†³å®šæœåŠ¡å™¨æ€§èƒ½ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦å¯¹æ•´ä¸ªè¿è¡Œæ—¶åŒºåŸŸç”±æ•´ä½“çš„è®¤è¯†å¹¶ä¸”äº†è§£äº†æ¯ä¸ªåŒºåŸŸçš„ç”Ÿå‘½å‘¨æœŸä»¥åŠä½œç”¨ä¹‹åæ‰èƒ½é€šè¿‡ç›¸åº”çš„è°ƒå‚æ¥æå‡ç³»ç»Ÿæ€§èƒ½ã€‚é™¤æ­¤ä¹‹å¤–è¿˜æœ‰åŠ©äºå¿«é€Ÿå®šä½è™šæ‹Ÿæœºçš„ç›¸å…³Error.</p>
<h2 id="ç¨‹åºè®¡æ•°å™¨ï¼ˆPCå¯„å­˜å™¨ï¼‰"><a href="#ç¨‹åºè®¡æ•°å™¨ï¼ˆPCå¯„å­˜å™¨ï¼‰" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨ï¼ˆPCå¯„å­˜å™¨ï¼‰"></a>ç¨‹åºè®¡æ•°å™¨ï¼ˆPCå¯„å­˜å™¨ï¼‰</h2><p><img src="/p/1e963439/JVM-PC%E5%AF%84%E5%AD%98%E5%99%A8.png" alt="image-20210907233021888"></p>
<p>JVMä¸­çš„ç¨‹åºè®¡æ•°å¯„å­˜å™¨(Program Counter Register) ä¸­ï¼ŒRegister çš„å‘½åæºäºCPUçš„å¯„å­˜å™¨ï¼Œå¯„å­˜å™¨å­˜å‚¨æŒ‡ä»¤ç›¸å…³çš„ç°åœºä¿¡æ¯ã€‚CPUåª æœ‰æŠŠæ•°æ®è£…è½½åˆ°å¯„å­˜å™¨æ‰èƒ½å¤Ÿè¿è¡Œã€‚</p>
<p>è¿™é‡Œï¼Œå¹¶éæ˜¯å¹¿ä¹‰ä¸Šæ‰€æŒ‡çš„ç‰©ç†å¯„å­˜å™¨ï¼Œæˆ–è®¸å°†å…¶ç¿»è¯‘ä¸ºPCè®¡æ•°å™¨(æˆ–æŒ‡ä»¤è®¡æ•°å™¨)ä¼šæ›´åŠ è´´åˆ‡(ä¹Ÿç§°ä¸ºç¨‹åºé’©å­)ï¼Œå¹¶ä¸”ä¹Ÿä¸å®¹æ˜“å¼•èµ·- -äº›ä¸å¿…è¦çš„è¯¯ä¼šã€‚JVMä¸­çš„PCå¯„å­˜å™¨æ˜¯å¯¹ç‰©ç†PCå¯„å­˜å™¨çš„ä¸€-ç§æŠ½è±¡æ¨¡æ‹Ÿã€‚</p>
<ul>
<li>ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—å¾ˆå°çš„å†…å­˜ç©ºé—´ï¼Œå‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œä¹Ÿæ˜¯é€Ÿåº¦æœ€å¿«çš„å­˜å‚¨åŒºåŸŸ</li>
<li>åœ¨JVMè§„èŒƒä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä»–è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´</li>
<li>ä»»ä½•æ—¶å€™ä¸€ä¸ªçº¿ç¨‹éƒ½åªæœ‰ä¸€ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„å½“å‰æ–¹æ³•ã€‚ç¨‹åºè®¡æ•°å™¨ä¼šå­˜å‚¨å½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„Javaæ–¹æ³•çš„JVMæŒ‡ä»¤çš„åœ°å€ï¼›æˆ–è€…å¦‚æœåœ¨æ‰§è¡Œçš„æ˜¯nativeæ–¹æ³•ï¼Œåˆ™æ˜¯æœªæŒ‡å®šå€¼ï¼ˆundefindï¼‰</li>
<li>ä»–æ˜¯ç¨‹åºæ§åˆ¶æµçš„æŒ‡ç¤ºå™¨ï¼Œåˆ†æ”¯ï¼Œå¾ªç¯ï¼Œè·³è½¬ï¼Œå¼‚å¸¸å¤„ç†ï¼Œçº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½æ˜¯éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚</li>
<li>å­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤</li>
<li>å”¯ä¸€ä¸€ä¸ªåœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½•OutMemoryErroræƒ…å†µçš„åŒºåŸŸ</li>
</ul>
<blockquote>
<p>ä½¿ç”¨PCå¯„å­˜å™¨å­˜å‚¨å­—èŠ‚ç æŒ‡ä»¤åœ°å€æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p>
</blockquote>
<p>å› ä¸ºCPUéœ€è¦ä¸åœçš„åˆ‡æ¢å„ä¸ªçº¿ç¨‹ï¼Œè¿™æ—¶å€™åˆ‡æ¢å›æ¥ä»¥åï¼Œå°±å¾—çŸ¥é“æ¥ç€ä»å“ªé‡Œå¼€å§‹ç»§ç»­æ‰§è¡Œ</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆä½¿ç”¨PCå¯„å­˜å™¨è®°å½•å½“å‰çº¿ç¨‹çš„æ‰§è¡Œåœ°å€ï¼Ÿ</p>
</blockquote>
<p>JVMçš„å­—èŠ‚ç è§£é‡Šå™¨å°±éœ€è¦é€šè¿‡æ”¹å˜PCå¯„å­˜å™¨çš„å€¼æ¥æ˜ç¡®ä¸‹ä¸€æ¡åº”è¯¥æ‰§è¡Œä»€ä¹ˆæ ·çš„å­—èŠ‚ç ã€‚</p>
<blockquote>
<p>PCå¯„å­˜å™¨ä¸ºä»€ä¹ˆä¼šè¢«è®¾å®šä¸ºçº¿ç¨‹ç§æœ‰çš„ï¼Ÿ</p>
</blockquote>
<p>ä¸ºäº†èƒ½å¤Ÿå‡†ç¡®åœ°è®°å½•å„ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„å½“å‰å­—èŠ‚ç æŒ‡ä»¤åœ°å€ï¼Œæœ€å¥½çš„åŠæ³•è‡ªç„¶æ˜¯ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½åˆ†é…ä¸€ä¸ªPCå¯„å­˜å™¨</p>
<p>ç”±äºCPUæ—¶é—´ç‰‡è½®æµé™åˆ¶ï¼Œä¼—å¤šçº¿ç¨‹åœ¨å¹¶å‘æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä»»ä½•ä¸€ä¸ªç¡®å®šçš„æ—¶åˆ»ï¼Œä¸€ä¸ªå¤„ç†å™¨æˆ–è€…å¤šæ ¸å¤„ç†å™¨ä¸­çš„ä¸€ä¸ªå†…æ ¸ï¼Œåªä¼šæ‰§è¡ŒæŸä¸€ä¸ªçº¿ç¨‹ä¸­çš„ä¸€æ¡æŒ‡ä»¤ï¼Œè¿™æ ·å¿…ç„¶å¯¼è‡´ç»å¸¸ä¸­æ–­æˆ–æ¢å¤ï¼Œå¦‚ä½•ä¿è¯åˆ†æ¯«ä¸å·®å‘¢ï¼Ÿæ¯ä¸ªçº¿ç¨‹åœ¨åˆ›å»ºåï¼Œéƒ½ä¼šäº§ç”Ÿè‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨å’Œæ ˆå¸§ï¼Œç¨‹åºè®¡æ•°å™¨åœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´äº’ä¸å½±å“ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVMæ ˆåŠæ ˆå¸§</title>
    <url>/p/79c43ec4.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h2><h3 id="æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ˜¯ä»€ä¹ˆï¼Ÿ"></a>æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>Javaè™šæ‹Ÿæœºæ ˆ(Java virtual Machine stack) ï¼Œæ—©æœŸä¹Ÿå«Javaæ ˆã€‚æ¯ä¸ªçº¿ç¨‹åœ¨åˆ›å»ºæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºæ ˆ,å…¶å†…éƒ¨ä¿å­˜ä¸€ä¸ªä¸ªçš„æ ˆå¸§(stack Frame) ,å¯¹åº”ç€ä¸€æ¬¡æ¬¡çš„Javaæ–¹æ³•è°ƒç”¨ï¼Œæ¯ä¸ªæ–¹æ³•è¢«è°ƒç”¨æ‰§è¡Œçš„æ—¶å€™ï¼ŒJavaè™šæ‹Ÿæœºéƒ½ä¼šåŒæ­¥åˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰ã€‚</p>
<h3 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h3><p>å›é¡¾ä¸€ä¸‹ï¼šæ–¹æ³•åŒºï¼ˆä¿å­˜ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰ï¼‰å’Œå †å†…å­˜ï¼ˆä¿å­˜å¯¹è±¡çš„å®ä¾‹ç­‰ï¼‰æ˜¯çº¿ç¨‹å…±äº«çš„ã€‚æ ˆã€ç¨‹åºè®¡æ•°å™¨ã€æœ¬åœ°æ–¹æ³•æ ˆæ˜¯çº¿ç¨‹ç‹¬äº«çš„ã€‚æ‰€ä»¥è¯´è™šæ‹Ÿæœºæ ˆå®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒã€‚</p>
<h3 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h3><p>ä¸»ç®¡Javaç¨‹åºçš„è¿è¡Œï¼Œå®ƒä¿å­˜æ–¹æ³•çš„å±€éƒ¨å˜é‡ï¼ˆ8ä¸­åŸºæœ¬æ•°æ®ç±»å‹ï¼‰ã€éƒ¨åˆ†ç»“æœï¼Œå¹¶å‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å›ã€‚</p>
<h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul>
<li>æ ˆæ˜¯ä¸€ç§å¿«é€Ÿæœ‰æ•ˆçš„é¢åˆ†é…å­˜å‚¨æ–¹å¼ï¼Œè®¿é—®é€Ÿåº¦ä»…æ¬¡äºç¨‹åºè®¡æ•°å™¨</li>
<li>JVM ç›´æ¥å¯¹ Java æ ˆçš„æ“ä½œåªæœ‰ä¸¤ä¸ª<ul>
<li>æ¯ä¸ªæ–¹æ³•æ‰§è¡Œï¼Œä¼´éšç€è¿›æ ˆï¼ˆå…¥æ ˆã€å‹æ ˆï¼‰</li>
<li>æ‰§è¡Œç»“æŸåçš„å‡ºæ ˆå·¥ä½œ</li>
</ul>
</li>
<li>å¯¹æ ˆæ¥è¯´ä¸å­˜åœ¨åƒåœ¾å›æ”¶é—®é¢˜ï¼ˆå¯èƒ½ä¼šæº¢å‡ºï¼‰</li>
</ul>
<h3 id="æ ˆä¸­å¯èƒ½çš„å¼‚å¸¸"><a href="#æ ˆä¸­å¯èƒ½çš„å¼‚å¸¸" class="headerlink" title="æ ˆä¸­å¯èƒ½çš„å¼‚å¸¸"></a>æ ˆä¸­å¯èƒ½çš„å¼‚å¸¸</h3><p>Java è™šæ‹Ÿæœºè§„èŒƒå…è®¸ Java æ ˆçš„å¤§å°æ˜¯åŠ¨æ€çš„æˆ–è€…æ˜¯å›ºå®šä¸å˜çš„ã€‚</p>
<ul>
<li>å¦‚æœé‡‡ç”¨å›ºå®šå¤§å°çš„ Java è™šæ‹Ÿæœºæ ˆï¼Œé‚£æ¯ä¸€ä¸ªçº¿ç¨‹çš„ Java è™šæ‹Ÿæœºæ ˆå®¹é‡å¯ä»¥åœ¨çº¿ç¨‹åˆ›å»ºçš„æ—¶å€™ç‹¬ç«‹é€‰å®šã€‚å¦‚æœçº¿ç¨‹è¯·æ±‚åˆ†é…çš„æ ˆå®¹é‡è¶…è¿‡ Javaè™šæ‹Ÿæœºæ ˆå…è®¸çš„æœ€å¤§å®¹é‡ï¼ŒJava è™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ª <code>StackOverflowError</code> å¼‚å¸¸ã€‚</li>
<li>å¦‚æœ Java è™šæ‹Ÿæœºæ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œå¹¶ä¸”åœ¨å°è¯•æ‰©å±•çš„æ—¶å€™æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œæˆ–è€…åœ¨åˆ›å»ºæ–°çš„çº¿ç¨‹æ—¶æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å»åˆ›å»ºå¯¹åº”çš„è™šæ‹Ÿæœºæ ˆï¼Œé‚£ Java è™šæ‹Ÿæœºä¼šæŠ›å‡ºä¸€ä¸ª <code>OutOfMemoryError</code> å¼‚å¸¸ã€‚</li>
</ul>
<h3 id="è®¾ç½®ç¨‹åºè¿è¡Œæ—¶æ ˆå†…å­˜å¤§å°"><a href="#è®¾ç½®ç¨‹åºè¿è¡Œæ—¶æ ˆå†…å­˜å¤§å°" class="headerlink" title="è®¾ç½®ç¨‹åºè¿è¡Œæ—¶æ ˆå†…å­˜å¤§å°"></a>è®¾ç½®ç¨‹åºè¿è¡Œæ—¶æ ˆå†…å­˜å¤§å°</h3><p>å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<a href="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html#BGBCIEFC">https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html#BGBCIEFC</a></p>
<p>ä½¿ç”¨å‚æ•° -Xss è®¾ç½®çº¿ç¨‹çš„æœ€å¤§æ ˆç©ºé—´ï¼Œæ ˆçš„å¤§å°ç›´æ¥å†³å®šäº†å‡½æ•°è°ƒç”¨çš„æœ€å¤§å¯è¾¾æ·±åº¦ã€‚</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">-Xss1m</span><br><span class="line">-Xss1024k</span><br><span class="line">-Xss1048576</span><br></pre></td></tr></tbody></table></figure>

<h3 id="æ ˆè¿è¡ŒåŸç†"><a href="#æ ˆè¿è¡ŒåŸç†" class="headerlink" title="æ ˆè¿è¡ŒåŸç†"></a>æ ˆè¿è¡ŒåŸç†</h3><ul>
<li>JVM ç›´æ¥å¯¹ Java æ ˆçš„æ“ä½œåªæœ‰ä¸¤ä¸ªï¼Œå°±æ˜¯å¯¹æ ˆå¸§çš„å‹æ ˆå’Œå‡ºæ ˆï¼Œéµå¾ªâ€œå…ˆè¿›å…ˆå‡ºâ€æˆ–â€œåè¿›å…ˆå‡ºâ€çš„åŸåˆ™</li>
<li>åœ¨ä¸€æ¡æ´»åŠ¨çº¿ç¨‹ä¸­ï¼Œä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œåªä¼šæœ‰ä¸€ä¸ªæ´»åŠ¨çš„æ ˆå¸§ã€‚å³åªæœ‰å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•çš„æ ˆå¸§ï¼ˆæ ˆé¡¶æ ˆå¸§ï¼‰æ˜¯æœ‰æ•ˆçš„ï¼Œè¿™ä¸ªæ ˆå¸§è¢«ç§°ä¸ºå½“å‰æ ˆå¸§ï¼ˆCurrent Frameï¼‰ï¼Œä¸å½“å‰æ ˆå¸§ç›¸å¯¹åº”çš„æ–¹æ³•å°±æ˜¯å½“å‰æ–¹æ³•ï¼ˆCurrent Methodï¼‰ï¼Œå®šä¹‰è¿™ä¸ªæ–¹æ³•çš„ç±»å°±æ˜¯å½“å‰ç±»ï¼ˆCurrent Classï¼‰</li>
<li>æ‰§è¡Œå¼•æ“è¿è¡Œçš„æ‰€æœ‰å­—èŠ‚ç æŒ‡ä»¤åªé’ˆå¯¹å½“å‰æ ˆå¸§è¿›è¡Œæ“ä½œ</li>
<li>å¦‚æœåœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨äº†å…¶ä»–æ–¹æ³•ï¼Œå¯¹åº”çš„æ–°çš„æ ˆå¸§ä¼šè¢«åˆ›å»ºå‡ºæ¥ï¼Œæ”¾åœ¨æ ˆçš„é¡¶ç«¯ï¼Œç§°ä¸ºæ–°çš„å½“å‰å¸§</li>
<li>ä¸åŒçº¿ç¨‹ä¸­æ‰€åŒ…å«çš„æ ˆå¸§æ˜¯ä¸å…è®¸ç›¸äº’å¼•ç”¨çš„ï¼Œå³ä¸å¯èƒ½åœ¨ä¸€ä¸ªæ ˆå¸§ä¹‹ä¸­å¼•ç”¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„æ ˆå¸§</li>
<li>å¦‚æœå½“å‰æ–¹æ³•è°ƒç”¨äº†å…¶ä»–æ–¹æ³•ï¼Œæ–¹æ³•è¿”å›ä¹‹é™…ï¼Œå½“å‰æ ˆå¸§ä¼šä¼ å›æ­¤æ–¹æ³•çš„æ‰§è¡Œç»“æœç»™å‰ä¸€ä¸ªæ ˆå¸§ï¼Œæ¥ç€ï¼Œè™šæ‹Ÿæœºä¼šä¸¢å¼ƒå½“å‰æ ˆå¸§ï¼Œä½¿å¾—å‰ä¸€ä¸ªæ ˆå¸§é‡æ–°ç§°ä¸ºå½“å‰æ ˆå¸§</li>
<li>Java æ–¹æ³•æœ‰ä¸¤ç§è¿”å›å‡½æ•°çš„æ–¹å¼ï¼Œä¸€ç§æ˜¯æ­£å¸¸çš„å‡½æ•°è¿”å›ï¼Œä½¿ç”¨ returnï¼Œå¦ä¸€ç§æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œä¸ç®¡ä½¿ç”¨å“ªç§ï¼Œéƒ½ä¼šå¯¼è‡´æ ˆå¸§è¢«å¼¹å‡ºã€‚</li>
</ul>
<h2 id="æ ˆå¸§çš„å†…éƒ¨ç»“æ„"><a href="#æ ˆå¸§çš„å†…éƒ¨ç»“æ„" class="headerlink" title="æ ˆå¸§çš„å†…éƒ¨ç»“æ„"></a>æ ˆå¸§çš„å†…éƒ¨ç»“æ„</h2><p>æ¯ä¸ªæ ˆå¸§åŒ…å«5ä¸ªç»„æˆéƒ¨åˆ†ï¼šå±€éƒ¨å˜é‡è¡¨ï¼ˆLocal Variablesï¼‰ã€æ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰ã€åŠ¨æ€é“¾æ¥ï¼ˆDynamic Linkingï¼‰ã€æ–¹æ³•è¿”å›åœ°å€ï¼ˆReturn Addressï¼‰å’Œä¸€äº›é™„åŠ ä¿¡æ¯ã€‚</p>
<p><img src="/p/79c43ec4/JVM-%E6%A0%88%E5%B8%A7%E7%9A%84%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84.png" alt="img"></p>
<h3 id="å±€éƒ¨å˜é‡è¡¨ï¼ˆLocal-Variablesï¼‰"><a href="#å±€éƒ¨å˜é‡è¡¨ï¼ˆLocal-Variablesï¼‰" class="headerlink" title="å±€éƒ¨å˜é‡è¡¨ï¼ˆLocal Variablesï¼‰"></a>å±€éƒ¨å˜é‡è¡¨ï¼ˆLocal Variablesï¼‰</h3><ul>
<li>å±€éƒ¨å˜é‡è¡¨ä¹Ÿè¢«ç§°ä¸ºå±€éƒ¨å˜é‡æ•°ç»„æˆ–æœ¬åœ°å˜é‡è¡¨ã€‚</li>
<li>å®šä¹‰ä¸ºä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œä¸»è¦ç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡ï¼Œè¿™äº›æ•°æ®ç±»å‹åŒ…æ‹¬å„ç±»åŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡å¼•ç”¨ï¼ˆreferenceï¼‰ï¼Œä»¥åŠreturnAddress ç±»å‹</li>
<li>ç”±äºå±€éƒ¨å˜é‡è¡¨æ˜¯å»ºç«‹åœ¨çº¿ç¨‹çš„æ ˆä¸Šï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„æ•°æ®ï¼Œå› æ­¤ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜</li>
<li>å±€éƒ¨å˜é‡è¡¨æ‰€éœ€çš„å®¹é‡å¤§å°æ˜¯åœ¨ç¼–è¯‘æœŸç¡®å®šçš„ï¼Œå¹¶ä¿å­˜åœ¨æ–¹æ³•çš„Code å±æ€§çš„ maximum local variables æ•°æ®é¡¹ä¸­ã€‚åœ¨æ–¹æ³•è¿è¡ŒæœŸé—´æ˜¯ä¸ä¼šæ”¹å˜å±€éƒ¨å˜é‡è¡¨çš„å¤§å°çš„</li>
<li><strong>æ–¹æ³•åµŒå¥—è°ƒç”¨çš„æ¬¡æ•°ç”±æ ˆçš„å¤§å°æ¥å†³å®šï¼Œä¸€èˆ¬æ¥è¯´æ ˆè¶Šå¤§ï¼Œæ–¹æ³•åµŒå¥—è°ƒç”¨æ¬¡æ•°è¶Šå¤šã€‚</strong>å¯¹ä¸€ä¸ªå‡½æ•°è€Œè¨€ï¼Œå®ƒçš„å‚æ•°å’Œå±€éƒ¨å˜é‡è¶Šå¤šï¼Œä½¿å¾—å±€éƒ¨å˜é‡è¡¨è†¨èƒ€ï¼Œå®ƒçš„æ ˆå¸§å°±è¶Šå¤§ï¼Œä»¥æ»¡è¶³æ–¹æ³•è°ƒç”¨æ‰€éœ€ä¼ é€’çš„ä¿¡æ¯å¢å¤§çš„éœ€æ±‚ã€‚è¿›è€Œå‡½æ•°è°ƒç”¨å°±ä¼šå ç”¨æ›´å¤šçš„æ ˆç©ºé—´ï¼Œå¯¼è‡´å…¶åµŒå¥—è°ƒç”¨çš„æ¬¡æ•°å°±ä¼šå‡å°‘ã€‚</li>
<li><strong>å±€éƒ¨å˜é‡è¡¨ä¸­çš„å˜é‡åªåœ¨å½“å‰æ–¹æ³•è°ƒç”¨ä¸­æœ‰æ•ˆã€‚</strong>åœ¨æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œè™šæ‹Ÿæœºé€šè¿‡ä½¿ç”¨å±€éƒ¨å˜é‡è¡¨å®Œæˆå‚æ•°å€¼åˆ°å‚æ•°å˜é‡åˆ—è¡¨çš„ä¼ é€’è¿‡ç¨‹ã€‚<strong>å½“æ–¹æ³•è°ƒç”¨ç»“æŸåï¼Œéšç€æ–¹æ³•æ ˆå¸§çš„é”€æ¯ï¼Œå±€éƒ¨å˜é‡è¡¨ä¹Ÿä¼šéšä¹‹é”€æ¯ã€‚</strong></li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LocalVariablesTest</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span>  <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">LocalVariablesTest</span> <span class="variable">localVariablesTest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LocalVariablesTest</span>();</span><br><span class="line">        localVariablesTest.test1();</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/p/79c43ec4/JClassLib-%E6%9F%A5%E7%9C%8B%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%87%E4%BB%B6.png" alt="image-20210912140552384"></p>
<blockquote>
<h4 id="å…³äºSlotçš„ç†è§£"><a href="#å…³äºSlotçš„ç†è§£" class="headerlink" title="å…³äºSlotçš„ç†è§£"></a>å…³äºSlotçš„ç†è§£</h4></blockquote>
<ul>
<li><p>å‚æ•°å€¼çš„å­˜æ”¾æ€»æ˜¯åœ¨å±€éƒ¨å˜é‡æ•°ç»„çš„index0å¼€å§‹ï¼Œåˆ°æ•°ç»„é•¿åº¦-1çš„ç´¢å¼•ç»“æŸã€‚</p>
</li>
<li><p>å±€éƒ¨å˜é‡è¡¨ï¼Œ<strong>æœ€åŸºæœ¬çš„å­˜å‚¨å•å…ƒæ˜¯slotï¼ˆå˜é‡æ§½ï¼‰ã€‚</strong></p>
</li>
<li><p>å±€éƒ¨å˜é‡è¡¨ä¸­å­˜æ”¾ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§åŸºæœ¬æ•°æ®ç±»å‹(8ç§)ï¼Œå¼•ç”¨ç±»å‹(reference)ï¼ŒreturnAddressç±»å‹çš„å˜é‡ã€‚</p>
</li>
<li><p>åœ¨å±€éƒ¨å˜é‡è¡¨é‡Œï¼Œ<strong>32ä½ä»¥å†…çš„ç±»å‹åªå ç”¨ä¸€ä¸ªslotï¼ˆåŒ…æ‹¬returnAddressç±»å‹ï¼‰ï¼Œ64ä½çš„ç±»å‹ï¼ˆlongå’Œdouble)å ç”¨ä¸¤ä¸ªslotã€‚</strong></p>
<ul>
<li>byte ã€ short ã€ charåœ¨å­˜å‚¨å‰è¢«è½¬æ¢ä¸ºintï¼Œbooleanä¹Ÿè¢«è½¬æ¢ä¸ºintï¼Œ0è¡¨ç¤ºfalse ï¼Œé0è¡¨ç¤ºtrueã€‚</li>
<li>longå’Œdoubleåˆ™å æ®ä¸¤ä¸ªslotã€‚</li>
</ul>
<p><img src="/p/79c43ec4/JVM-%E9%99%A4double%E5%92%8Clong%E5%A4%96%E5%85%B6%E5%AE%83%E6%95%B0%E5%80%BC%E7%B1%BB%E5%9E%8B%E5%8D%A01%E4%B8%AAslot.png" alt="image-20210912154134474"></p>
</li>
</ul>
<p><img src="/p/79c43ec4/JVM-double%E5%92%8Clong%E4%BC%9A%E5%8D%A0%E6%8D%AE%E4%B8%A4%E4%B8%AAslot.png" alt="image-20210912153951967"></p>
<ul>
<li><p>JVMä¼šä¸ºå±€éƒ¨å˜é‡è¡¨ä¸­çš„æ¯ä¸€ä¸ªSlotéƒ½åˆ†é…ä¸€ä¸ªè®¿é—®ç´¢å¼•ï¼Œé€šè¿‡è¿™ä¸ªç´¢å¼•å³å¯æˆåŠŸè®¿é—®åˆ°å±€éƒ¨å˜é‡è¡¨ä¸­æŒ‡å®šçš„å±€éƒ¨å˜é‡å€¼ã€‚</p>
</li>
<li><p>å½“ä¸€ä¸ªå®ä¾‹æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œå®ƒçš„æ–¹æ³•å‚æ•°å’Œæ–¹æ³•ä½“å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡å°†ä¼šæŒ‰ç…§é¡ºåºè¢«å¤åˆ¶åˆ°å±€éƒ¨å˜é‡è¡¨ä¸­çš„æ¯ä¸€ä¸ªslotä¸Šã€‚</p>
</li>
<li><p>å¦‚æœéœ€è¦è®¿é—®å±€éƒ¨å˜é‡è¡¨ä¸­ä¸€ä¸ª64bitçš„å±€éƒ¨å˜é‡å€¼æ—¶ï¼Œåªéœ€è¦ä½¿ç”¨å‰ä¸€ä¸ªç´¢å¼•å³å¯ã€‚ï¼ˆæ¯”å¦‚:è®¿é—®longæˆ–doubleç±»å‹å˜é‡ï¼‰</p>
</li>
<li><p>å¦‚æœå½“å‰å¸§æ˜¯ç”±æ„é€ æ–¹æ³•æˆ–è€…å®ä¾‹æ–¹æ³•åˆ›å»ºçš„ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å¼•ç”¨<strong>this</strong> å°†ä¼šå­˜æ”¾åœ¨indexä¸º0çš„slotå¤„ï¼Œå…¶ä½™çš„å‚æ•°æŒ‰ç…§å‚æ•°è¡¨é¡ºåºç»§ç»­æ’åˆ—ã€‚</p>
</li>
</ul>
<p><img src="/p/79c43ec4/JVM-%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E4%B8%8D%E5%AD%98%E5%9C%A8this.png" alt="image-20210912152018987"></p>
<p><img src="/p/79c43ec4/JVM-%E9%9D%9E%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AAslot%E4%B8%BAthis.png" alt="image-20210912152337316"></p>
<blockquote>
<h4 id="Tipsï¼šSlotçš„é‡å¤åˆ©ç”¨"><a href="#Tipsï¼šSlotçš„é‡å¤åˆ©ç”¨" class="headerlink" title="Tipsï¼šSlotçš„é‡å¤åˆ©ç”¨"></a>Tipsï¼šSlotçš„é‡å¤åˆ©ç”¨</h4></blockquote>
<p>æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨ä¸­çš„Slotï¼ˆæ§½ä½ï¼‰æ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œå¦‚æœä¸€ä¸ªå±€éƒ¨å˜é‡è¿‡äº†å…¶ä½œç”¨åŸŸï¼Œé‚£ä¹ˆåœ¨å…¶ä½œç”¨åŸŸä¹‹åç”³æ˜çš„æ–°çš„å±€éƒ¨å˜é‡å°±å¾ˆæœ‰å¯èƒ½ä¼šå¤ç”¨è¿‡æœŸå±€éƒ¨å˜é‡çš„æ§½ä½ï¼Œä»è€Œè¾¾åˆ°èŠ‚çœèµ„æºçš„ç›®çš„ã€‚</p>
<p>ä¸‹é¢çœ‹ä¸€ä¸ªæ¡ˆä¾‹ï¼Œä¸‹é¢è¿™ä¸ªæ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨çš„é•¿åº¦å¤§å°ä¸éš¾çœ‹å‡ºæ˜¯4ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    b = a + <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> a + <span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸‹é¢è¿™ä¸ªæ¡ˆä¾‹å‘¢ï¼Ÿå®é™…ä¸Šæ˜¯é•¿åº¦æ˜¯3ã€‚è¿™é‡Œå°±å­˜åœ¨ä¸€ä¸ªslotå¤ç”¨çš„æ¦‚å¿µã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    {</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        b = a + <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> a + <span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/p/79c43ec4/JVM-slot%E7%9A%84%E5%A4%8D%E7%94%A8.png" alt="image-20210912155238955"></p>
<blockquote>
<h4 id="Tipsï¼šé™æ€å˜é‡ä¸å±€éƒ¨å˜é‡çš„å¯¹æ¯”"><a href="#Tipsï¼šé™æ€å˜é‡ä¸å±€éƒ¨å˜é‡çš„å¯¹æ¯”" class="headerlink" title="Tipsï¼šé™æ€å˜é‡ä¸å±€éƒ¨å˜é‡çš„å¯¹æ¯”"></a>Tipsï¼šé™æ€å˜é‡ä¸å±€éƒ¨å˜é‡çš„å¯¹æ¯”</h4></blockquote>
<p>æŒ‰ç…§æ•°æ®ç±»å‹åˆ†ï¼šâ‘  åŸºæœ¬æ•°æ®ç±»å‹ â‘¡ å¼•ç”¨æ•°æ®ç±»å‹</p>
<p>æŒ‰ç…§åœ¨ç±»ä¸­å£°æ˜çš„ä½ç½®åˆ†ï¼š</p>
<p> â‘  æˆå‘˜å˜é‡ï¼šåœ¨ä½¿ç”¨å‰ï¼Œéƒ½ç»å†è¿‡é»˜è®¤åˆå§‹åŒ–èµ‹å€¼ã€‚</p>
<ul>
<li>ç±»å˜é‡ï¼ˆé™æ€çš„æˆå‘˜å˜é‡ï¼‰</li>
</ul>
<p>Linking çš„ prepare é˜¶æ®µï¼šç»™ç±»å˜é‡é»˜è®¤èµ‹å€¼ã€‚</p>
<p>initialé˜¶æ®µï¼šç»™ç±»å˜é‡æ˜¾å¼èµ‹å€¼å³é™æ€ä»£ç å—èµ‹å€¼ã€‚</p>
<ul>
<li>å®ä¾‹å˜é‡ï¼ˆéé™æ€çš„æˆå‘˜å˜é‡ï¼‰ï¼šéšç€å¯¹è±¡çš„åˆ›å»ºï¼Œä¼šåœ¨å †ç©ºé—´ä¸­åˆ†é…å®ä¾‹å˜é‡ç©ºé—´ï¼Œå¹¶è¿›è¡Œé»˜è®¤èµ‹å€¼</li>
</ul>
<p>â‘¡ å±€éƒ¨å˜é‡ï¼šåœ¨ä½¿ç”¨å‰ï¼Œå¿…é¡»è¦è¿›è¡Œæ˜¾å¼èµ‹å€¼çš„ï¼å¦åˆ™ï¼Œç¼–è¯‘ä¸é€šè¿‡ã€‚</p>
<p>åœ¨æ ˆå¸§ä¸­ï¼Œä¸æ€§èƒ½è°ƒä¼˜å…³ç³»æœ€ä¸ºå¯†åˆ‡çš„éƒ¨åˆ†å°±æ˜¯å‰é¢æåˆ°çš„å±€éƒ¨å˜é‡è¡¨ã€‚åœ¨æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œè™šæ‹Ÿæœºä½¿ç”¨å±€éƒ¨å˜é‡è¡¨å®Œæˆæ–¹æ³•çš„ä¼ é€’ã€‚</p>
<p>å±€éƒ¨å˜é‡è¡¨ä¸­çš„å˜é‡ä¹Ÿæ˜¯é‡è¦çš„åƒåœ¾å›æ”¶æ ¹èŠ‚ç‚¹ï¼Œåªè¦è¢«å±€éƒ¨å˜é‡è¡¨ä¸­ç›´æ¥æˆ–é—´æ¥å¼•ç”¨çš„å¯¹è±¡éƒ½ä¸ä¼šè¢«å›æ”¶ã€‚</p>
<h3 id="æ“ä½œæ•°æ ˆï¼ˆOperand-Stackï¼‰"><a href="#æ“ä½œæ•°æ ˆï¼ˆOperand-Stackï¼‰" class="headerlink" title="æ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰"></a>æ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰</h3><p>æ¯ä¸€ä¸ªç‹¬ç«‹çš„æ ˆå¸§ä¸­é™¤äº†åŒ…å«å±€éƒ¨å˜é‡è¡¨ä»¥å¤–ï¼Œè¿˜åŒ…å«ä¸€ä¸ªåè¿›å…ˆå‡ºï¼ˆLast-In-First-Outï¼‰çš„æ“ä½œæ•°æ ˆï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºè¡¨è¾¾å¼æ ˆï¼ˆExpression Stackï¼‰</p>
<p>æ“ä½œæ•°æ ˆï¼Œåœ¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ ¹æ®å­—èŠ‚ç æŒ‡ä»¤ï¼Œå¾€æ ˆä¸­å†™å…¥æ•°æ®æˆ–æå–æ•°æ®å³å…¥æ ˆï¼ˆpushï¼‰å‡ºæ ˆï¼ˆpopï¼‰</p>
<ul>
<li>æŸäº›å­—èŠ‚ç æŒ‡ä»¤å°†å€¼å‹å…¥æ“ä½œæ•°æ ˆï¼Œå…¶ä½™çš„å­—èŠ‚ç æŒ‡ä»¤å°†æ“ä½œæ•°å–å‡ºæ ˆã€‚ä½¿ç”¨å®ƒä»¬åå†æŠŠç»“æœå‹å…¥æ ˆã€‚</li>
<li>æ¯”å¦‚ï¼šæ‰§è¡Œèµ‹å€¼ã€äº¤æ¢ã€æ±‚å’Œç­‰æ“ä½œã€‚</li>
</ul>
<p>å¦‚æœè¢«è°ƒç”¨çš„æ–¹æ³•å¸¦æœ‰è¿”å›å€¼çš„è¯ï¼Œå…¶è¿”å›å€¼å°†ä¼šè¢«å‹å…¥å½“å‰æ ˆå¸§çš„æ“ä½œæ•°æ ˆä¸­ï¼Œå¹¶æ›´æ–° PC å¯„å­˜å™¨ä¸­ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</p>
<p>æ“ä½œæ•°æ ˆä¸­å…ƒç´ çš„æ•°æ®ç±»å‹å¿…é¡»ä¸å­—èŠ‚ç æŒ‡ä»¤çš„åºåˆ—ä¸¥æ ¼åŒ¹é…ï¼Œè¿™ç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸé—´è¿›è¡ŒéªŒè¯ï¼ŒåŒæ—¶åœ¨ç±»åŠ è½½çš„è¿‡ç¨‹ä¸­çš„ç±»æ£€éªŒé˜¶æ®µçš„æ•°æ®æµåˆ†æé˜¶æ®µè¦å†æ¬¡éªŒè¯</p>
<p>å¦å¤–ï¼ŒJava è™šæ‹Ÿæœºçš„è§£é‡Šå¼•æ“æ˜¯åŸºäºæ ˆçš„æ‰§è¡Œå¼•æ“ï¼Œå…¶ä¸­çš„æ ˆæŒ‡çš„æ˜¯æ“ä½œæ•°æ ˆã€‚</p>
<p>æ“ä½œæ•°æ ˆï¼Œä¸»è¦ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹ä¸­çš„ä¸­é—´ç»“æœï¼ŒåŒæ—¶ä½œä¸ºè®¡ç®—è¿‡ç¨‹ä¸­å˜é‡ä¸´æ—¶çš„å­˜å‚¨ç©ºé—´ã€‚</p>
<p>æ“ä½œæ•°æ ˆå°±æ˜¯ JVM æ‰§è¡Œå¼•æ“çš„ä¸€ä¸ªå·¥ä½œåŒºï¼Œå½“ä¸€ä¸ªæ–¹æ³•åˆšå¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸€ä¸ªæ–°çš„æ ˆå¸§ä¹Ÿä¼šéšä¹‹è¢«åˆ›å»ºå‡ºæ¥ï¼Œè¿™ä¸ªæ–¹æ³•çš„æ“ä½œæ•°æ ˆæ˜¯ç©ºçš„ã€‚</p>
<p>æ¯ä¸€ä¸ªæ“ä½œæ•°æ ˆéƒ½ä¼šæ‹¥æœ‰ä¸€ä¸ªæ˜ç¡®çš„æ ˆæ·±åº¦ç”¨äºå­˜å‚¨æ•°å€¼ï¼Œå…¶æ‰€éœ€è¦çš„æœ€å¤§æ·±åº¦åœ¨ç¼–è¯‘å™¨å°±å®šä¹‰å¥½äº†ï¼Œä¿å­˜åœ¨æ–¹æ³•çš„ code å±æ€§é‡Œï¼Œæ˜¯ max_stack çš„å€¼</p>
<p>æ ˆä¸­çš„ä»»ä½•ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯å¯ä»¥ä»»æ„çš„ Java æ•°æ®ç±»å‹</p>
<ul>
<li>32 bit çš„ç±»å‹å ç”¨ä¸€ä¸ªæ ˆå•ä½æ·±åº¦</li>
<li>64 bit çš„ç±»å‹å ç”¨ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦</li>
</ul>
<p>æ“ä½œæ•°æ ˆå¹¶éé‡‡ç”¨è®¿é—®ç´¢å¼•çš„æ–¹å¼æ¥è¿›è¡Œæ•°æ®è®¿é—®çš„ï¼Œè€Œæ˜¯åªèƒ½é€šè¿‡æ ‡å‡†çš„å…¥æ ˆï¼ˆpushï¼‰å’Œå‡ºæ ˆï¼ˆpopï¼‰æ“ä½œæ¥å®Œæˆä¸€æ¬¡æ•°æ®è®¿é—®ã€‚</p>
<blockquote>
<p><strong>æ ˆé¡¶ç¼“å­˜æŠ€æœ¯</strong></p>
</blockquote>
<p>åŸºäºæ ˆå¼æ¶æ„çš„è™šæ‹Ÿæœºæ‰€ä½¿ç”¨çš„é›¶åœ°å€æŒ‡ä»¤æ›´åŠ ç´§å‡‘ï¼Œä½†å®Œæˆä¸€é¡¹æ“ä½œçš„æ—¶å€™å¿…ç„¶éœ€è¦æ›´å¤šçš„å…¥æ ˆå’Œå‡ºæ ˆæŒ‡ä»¤ï¼Œè¿™åŒæ—¶ä¹Ÿå°±æ„å‘³ç€éœ€è¦ä½¿ç”¨æ›´å¤šåˆ†æ´¾æŒ‡ä»¤ï¼ˆinstruction dispatchï¼‰æ¬¡æ•°å’Œå†…å­˜è¯»å†™æ¬¡æ•°ã€‚</p>
<p>ç”±äºæ“ä½œæ•°æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œå› æ­¤é¢‘ç¹æ‰§è¡Œå†…å­˜è¯»å†™æ“ä½œå¿…ç„¶ä¼šå½±å“æ‰§è¡Œé€Ÿåº¦ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒHotSpot JVM çš„è®¾è®¡è€…æå‡ºäº†æ ˆé¡¶ç¼“å­˜ï¼ˆToSï¼ŒTop-of-Stack Cashingï¼‰æŠ€æœ¯ï¼Œå°†æ ˆé¡¶å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç† CPU çš„å¯„å­˜å™¨ä¸­ï¼Œæ¥é™ä½å†…å­˜çš„è¯»å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ•ˆç‡ã€‚</p>
<h3 id="åŠ¨æ€é“¾æ¥ï¼ˆDynamic-Linkingï¼‰"><a href="#åŠ¨æ€é“¾æ¥ï¼ˆDynamic-Linkingï¼‰" class="headerlink" title="åŠ¨æ€é“¾æ¥ï¼ˆDynamic Linkingï¼‰"></a>åŠ¨æ€é“¾æ¥ï¼ˆDynamic Linkingï¼‰</h3><p>æ¯ä¸€ä¸ªæ ˆå¸§å†…éƒ¨éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± ä¸­<strong>è¯¥æ ˆå¸§æ‰€å±æ–¹æ³•çš„å¼•ç”¨</strong>ã€‚åŒ…å«è¿™ä¸ª å¼•ç”¨çš„ç›®çš„å°±æ˜¯ä¸ºäº†æ”¯æŒå½“å‰æ–¹æ³•çš„ä»£ç èƒ½å¤Ÿå®ç°åŠ¨æ€é“¾æ¥ã€‚æ¯”å¦‚ï¼šinvokedynamicæŒ‡ä»¤ã€‚</p>
<p>åœ¨ Java æºæ–‡ä»¶è¢«ç¼–è¯‘åˆ°å­—èŠ‚ç æ–‡ä»¶ä¸­æ—¶ï¼Œæ‰€æœ‰çš„å˜é‡å’Œæ–¹æ³•å¼•ç”¨éƒ½ä½œä¸ºç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referenceï¼‰ä¿å­˜åœ¨ class æ–‡ä»¶çš„å¸¸é‡æ± é‡Œã€‚æ¯”å¦‚ï¼šæè¿°ä¸€ä¸ªæ–¹æ³•è°ƒç”¨äº†å…¶ä»–æ–¹æ³•æ—¶ï¼Œå°±æ˜¯é€šè¿‡å¸¸é‡æ± ä¸­æŒ‡å‘æ–¹æ³•çš„ç¬¦å·å¼•ç”¨æ¥è¡¨ç¤ºçš„ï¼Œé‚£ä¹ˆåŠ¨æ€é“¾æ¥çš„ä½œç”¨å°±æ˜¯ä¸ºäº†å°†è¿™äº›ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºè°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ã€‚</p>
<blockquote>
<h4 id="ä¸ºä»€ä¹ˆéœ€è¦å¸¸é‡æ± ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦å¸¸é‡æ± ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦å¸¸é‡æ± ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦å¸¸é‡æ± ï¼Ÿ</h4></blockquote>
<p>å¸¸é‡æ± çš„ä½œç”¨ï¼šä¸ºäº†æä¾›ä¸€äº›ç¬¦å·å’Œå¸¸é‡ï¼Œä¾¿äºæŒ‡ä»¤çš„è¯†åˆ«ã€‚</p>
<blockquote>
<h4 id="æ–¹æ³•çš„è°ƒç”¨ï¼ˆåŠ¨æ€åˆ†æ´¾å’Œé™æ€åˆ†æ´¾ï¼‰"><a href="#æ–¹æ³•çš„è°ƒç”¨ï¼ˆåŠ¨æ€åˆ†æ´¾å’Œé™æ€åˆ†æ´¾ï¼‰" class="headerlink" title="æ–¹æ³•çš„è°ƒç”¨ï¼ˆåŠ¨æ€åˆ†æ´¾å’Œé™æ€åˆ†æ´¾ï¼‰"></a>æ–¹æ³•çš„è°ƒç”¨ï¼ˆåŠ¨æ€åˆ†æ´¾å’Œé™æ€åˆ†æ´¾ï¼‰</h4></blockquote>
<p>åœ¨ JVM ä¸­ï¼Œå°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºè°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ä¸æ–¹æ³•çš„ç»‘å®šæœºåˆ¶ç›¸å…³ã€‚</p>
<p><strong>é™æ€é“¾æ¥</strong></p>
<p>å½“ä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶è¢«è£…è½½è¿› JVM å†…éƒ¨æ—¶ï¼Œå¦‚æœè¢«è°ƒç”¨çš„<strong>ç›®æ ‡æ–¹æ³•åœ¨ç¼–è¯‘å™¨å¯çŸ¥</strong>ï¼Œä¸”è¿è¡ŒæœŸä¿æŒä¸å˜æ—¶ï¼Œè¿™ç§æƒ…å†µä¸‹å°†è°ƒç”¨æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ç§°ä¸ºé™æ€é“¾æ¥ã€‚</p>
<p><strong>åŠ¨æ€é“¾æ¥</strong></p>
<p>å¦‚æœè¢«è°ƒç”¨æ–¹æ³•åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šä¸‹æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªèƒ½å¤Ÿåœ¨ç¨‹åºè¿è¡ŒæœŸå°†è°ƒç”¨æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼Œç”±äºè¿™ç§å¼•ç”¨è½¬æ¢è¿‡ç¨‹ä¸­å…·å¤‡åŠ¨æ€æ€§ï¼Œå› æ­¤ä¹Ÿå°±è¢«ç§°ä¸ºåŠ¨æ€é“¾æ¥ã€‚</p>
<blockquote>
<h4 id="æ–¹æ³•çš„ç»‘å®šæœºåˆ¶"><a href="#æ–¹æ³•çš„ç»‘å®šæœºåˆ¶" class="headerlink" title="æ–¹æ³•çš„ç»‘å®šæœºåˆ¶"></a>æ–¹æ³•çš„ç»‘å®šæœºåˆ¶</h4></blockquote>
<p>å¯¹åº”çš„æ–¹æ³•çš„ç»‘å®šæœºåˆ¶ä¸ºï¼šæ—©èµ·ç»‘å®šï¼ˆEarly Bindingï¼‰å’Œæ™šæœŸç»‘å®šï¼ˆLate Bindingï¼‰ã€‚ç»‘å®šæ˜¯ä¸€ä¸ªå­—æ®µã€æ–¹æ³•æˆ–è€…ç±»åœ¨ç¬¦å·å¼•ç”¨è¢«æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ï¼Œè¿™ä»…ä»…å‘ç”Ÿä¸€æ¬¡ã€‚</p>
<p><strong>æ—©æœŸç»‘å®š</strong></p>
<p>å’Œé™æ€é“¾æ¥å¯¹åº”ã€‚</p>
<p>æ—©èµ·ç»‘å®šå°±æ˜¯æŒ‡è¢«è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•å¦‚æœåœ¨ç¼–è¯‘æœŸå¯çŸ¥ï¼Œä¸”è¿è¡ŒæœŸä¿æŒä¸å˜æ—¶ï¼Œå³å¯å°†è¿™ä¸ªæ–¹æ³•ä¸æ‰€å±çš„ç±»å‹è¿›è¡Œç»‘å®šï¼Œè¿™æ ·ä¸€æ¥ï¼Œç”±äºæ˜ç¡®äº†è¢«è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•ç©¶ç«Ÿæ˜¯å“ªä¸€ä¸ªï¼Œå› æ­¤ä¹Ÿå°±å¯ä»¥ä½¿ç”¨é™æ€é“¾æ¥çš„æ–¹å¼å°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ã€‚</p>
<p><strong>æ™šæœŸç»‘å®š</strong></p>
<p>å’ŒåŠ¨æ€é“¾æ¥å¯¹åº”ã€‚</p>
<p>å¦‚æœè¢«è°ƒç”¨çš„æ–¹æ³•åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šä¸‹æ¥ï¼Œåªèƒ½å¤Ÿåœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ç±»å‹ç»‘å®šç›¸å…³çš„æ–¹æ³•ï¼Œè¿™ç§ç»‘å®šæ–¹å¼ä¹Ÿå°±è¢«ç§°ä¹‹ä¸ºæ™šæœŸç»‘å®šã€‚ä¾‹å¦‚å¤šæ€ã€‚</p>
<blockquote>
<h4 id="è™šæ–¹æ³•å’Œéè™šæ–¹æ³•"><a href="#è™šæ–¹æ³•å’Œéè™šæ–¹æ³•" class="headerlink" title="è™šæ–¹æ³•å’Œéè™šæ–¹æ³•"></a>è™šæ–¹æ³•å’Œéè™šæ–¹æ³•</h4></blockquote>
<p>å¦‚æœæ–¹æ³•åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å…·ä½“çš„è°ƒç”¨ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬åœ¨è¿è¡Œæ—¶æ˜¯ä¸å¯å˜çš„ã€‚è¿™æ ·çš„æ–¹æ³•ç§°ä¸ºéè™šæ–¹æ³•ã€‚</p>
<p>é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€finalæ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³•éƒ½æ˜¯éè™šæ–¹æ³•ï¼Œå…¶ä»–æ–¹æ³•ç§°ä¸ºè™šæ–¹æ³•ã€‚</p>
<p>å­ç±»å¯¹è±¡çš„å¤šæ€çš„ä½¿ç”¨å‰æï¼š</p>
<ul>
<li>ç±»çš„ç»§æ‰¿å…³ç³»</li>
<li>æ–¹æ³•çš„é‡å†™</li>
</ul>
<p>è™šæ‹Ÿæœºä¸­æä¾›äº†ä»¥ä¸‹å‡ æ¡æ–¹æ³•è°ƒç”¨æŒ‡ä»¤ï¼š</p>
<p>1ã€æ™®é€šè°ƒç”¨æŒ‡ä»¤</p>
<ul>
<li><p>invokestaticï¼šè°ƒç”¨é™æ€æ–¹æ³•ï¼Œè§£æé˜¶æ®µç¡®å®šå”¯ä¸€æ–¹æ³•ç‰ˆæœ¬ã€‚å®ƒå¯¹åº”çš„æ˜¯éè™šæ–¹æ³•ã€‚</p>
</li>
<li><p>invokespecialï¼šè°ƒç”¨&lt;init&gt;æ–¹æ³•ã€ç§æœ‰åŠçˆ¶ç±»æ–¹æ³•ï¼Œè§£æé˜¶æ®µç¡®å®šå”¯ä¸€æ–¹æ³•ç‰ˆæœ¬ã€‚å®ƒå¯¹åº”çš„æ˜¯éè™šæ–¹æ³•ã€‚</p>
</li>
<li><p>invokevirtualï¼šè°ƒç”¨æ‰€æœ‰è™šæ–¹æ³•ã€‚final ä¿®é¥°çš„æ–¹æ³•æ˜¯éè™šæ–¹æ³•ã€‚final ä¿®é¥°é™¤å¤–çš„æ–¹æ³•æ˜¯è™šæ–¹æ³•ã€‚</p>
</li>
<li><p>invokeinterfaceï¼šè°ƒç”¨æ¥å£æ–¹æ³•ã€‚å®ƒå¯¹åº”çš„æ˜¯è™šæ–¹æ³•ã€‚</p>
</li>
</ul>
<p>2ã€åŠ¨æ€è°ƒç”¨æŒ‡ä»¤</p>
<ul>
<li><p>invokedynamicï¼šåŠ¨æ€è§£æå‡ºéœ€è¦è°ƒç”¨çš„æ–¹æ³•ï¼Œç„¶åæ‰§è¡Œã€‚</p>
</li>
<li><p>å‰å››æ¡æŒ‡ä»¤å›ºåŒ–åœ¨è™šæ‹Ÿæœºå†…éƒ¨ï¼Œæ–¹æ³•çš„è°ƒç”¨æ‰§è¡Œä¸å¯äººä¸ºå¹²é¢„ï¼Œè€Œ invokedynamic æŒ‡ä»¤åˆ™æ”¯æŒç”±ç”¨æˆ·ç¡®å®šæ–¹æ³•ç‰ˆæœ¬ã€‚å…¶ä¸­ invokestatic æŒ‡ä»¤ å’Œinvokespecial æŒ‡ä»¤è°ƒç”¨çš„æ–¹æ³•ç§°ä¸ºéè™šæ–¹æ³•ï¼Œå…¶ä½™çš„ï¼ˆfinalä¿®é¥°çš„é™¤å¤–ï¼‰ç§°ä¸ºè™šæ–¹æ³•ã€‚</p>
</li>
</ul>
<blockquote>
<h4 id="åŠ¨æ€ç±»å‹è¯­è¨€å’Œé™æ€ç±»å‹è¯­è¨€"><a href="#åŠ¨æ€ç±»å‹è¯­è¨€å’Œé™æ€ç±»å‹è¯­è¨€" class="headerlink" title="åŠ¨æ€ç±»å‹è¯­è¨€å’Œé™æ€ç±»å‹è¯­è¨€"></a>åŠ¨æ€ç±»å‹è¯­è¨€å’Œé™æ€ç±»å‹è¯­è¨€</h4></blockquote>
<p>åŠ¨æ€ç±»å‹è¯­è¨€å’Œé™æ€ç±»å‹è¯­è¨€ä¸¤è€…çš„åŒºåˆ«åœ¨äºå¯¹ç±»å‹çš„æ£€æŸ¥æ˜¯åœ¨ç¼–è¯‘æœŸè¿˜æ˜¯åœ¨è¿è¡ŒæœŸã€‚</p>
<ul>
<li>é™æ€ç±»å‹è¯­è¨€æ»¡è¶³å‰è€…</li>
<li>åŠ¨æ€ç±»å‹è¯­è¨€æ»¡è¶³åè€…</li>
</ul>
<p>ä¾‹å¦‚åœ¨Javaä¸­ï¼ŒString info = â€œhello,worldâ€;æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ä½¿ç”¨ String info  = 10;å°±ä¼šæŠ¥é”™ï¼Œè¯´æ˜Javaæ˜¯åœ¨ç¼–è¯‘æœŸæ£€æŸ¥çš„ã€‚</p>
<p>åœ¨Python ä¸­, info = 100; åœ¨è¿è¡Œæ—¶æ‰èƒ½åˆ¤æ–­infoæ˜¯ä¸€ä¸ªæ•°å€¼ç±»å‹ã€‚</p>
<blockquote>
<h4 id="å…³äº-invokeDynamic-æŒ‡ä»¤"><a href="#å…³äº-invokeDynamic-æŒ‡ä»¤" class="headerlink" title="å…³äº invokeDynamic æŒ‡ä»¤"></a>å…³äº <code>invokeDynamic</code> æŒ‡ä»¤</h4></blockquote>
<p>ä¸ºäº†æ›´å¥½çš„æ”¯æŒåŠ¨æ€ç±»å‹è¯­è¨€ï¼ŒJava7é€šè¿‡JSR292ç»™JVMå¢åŠ äº†ä¸€æ¡æ–°çš„å­—èŠ‚ç æŒ‡ä»¤ï¼šinvokedynamicã€‚ä¹‹åï¼ŒJVMä¸Šé¢çš„ä¸€äº›åŠ¨æ€ç±»å‹è¯­è¨€ï¼Œæ¯”å¦‚Groovyï¼ˆ2.0+ï¼‰å’ŒJRubyï¼ˆ1.7.0+ï¼‰éƒ½å¼€å§‹æ”¯æŒinvokedynamicã€‚ä¸ºåŠ¨æ€è¯­è¨€é‡èº«å®šåˆ¶çš„invokedynamicæŒ‡ä»¤ï¼Œä¹Ÿè¢«ç”¨åˆ°äº†Java8çš„Lambdaè¡¨è¾¾å¼ï¼ˆJSR335ï¼‰å®ç°ä¸Šã€‚</p>
<p>ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼Œç¼–è¯‘åæ‰“å¼€å­—èŠ‚ç æ–‡ä»¶å¯ä»¥çœ‹åˆ° <code>invokeDynamic</code> æŒ‡ä»¤ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InvokeDynamicTest</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">x</span> <span class="operator">=</span> () -&gt; {</span><br><span class="line">            <span class="comment">//System.out.println("Hello, World!"); </span></span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<h4 id="æ–¹æ³•é‡å†™çš„æœ¬è´¨"><a href="#æ–¹æ³•é‡å†™çš„æœ¬è´¨" class="headerlink" title="æ–¹æ³•é‡å†™çš„æœ¬è´¨"></a>æ–¹æ³•é‡å†™çš„æœ¬è´¨</h4></blockquote>
<ul>
<li><p>æ‰¾åˆ°æ“ä½œæ•°æ ˆé¡¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ‰€æ‰§è¡Œçš„å¯¹è±¡çš„å®é™…ç±»å‹è®°ä½œCã€‚</p>
</li>
<li><p>å¦‚æœåœ¨ç±»å‹Cä¸­æ‰¾åˆ°ä¸å¸¸é‡ä¸­çš„æè¿°ç¬¦å·ç®€å•åç§°éƒ½ç›¸ç¬¦çš„æ–¹æ³•ï¼Œåˆ™è¿›è¡Œè®¿é—®æƒé™æ ¡éªŒï¼Œå¦‚æœæ ¡éªŒé€šè¿‡ï¼Œåˆ™è¿”å›è¿™ä¸ªæ–¹æ³•çš„ç›´æ¥å¼•ç”¨ï¼ŒæŸ¥æ‰¾è¿‡ç¨‹ç»“æŸï¼›å¦‚æœä¸é€šè¿‡ï¼Œåˆ™è¿”å› <code>java.lang.IllegalAccessError</code> å¼‚å¸¸ã€‚</p>
</li>
<li><p>å¦åˆ™ï¼ŒæŒ‰ç…§ç»§æ‰¿å…³ç³»ä»ä¸‹å¾€ä¸Šä¾æ¬¡å¯¹Cçš„å„ä¸ªçˆ¶ç±»è¿›è¡Œç¬¬2æ­¥çš„æœç´¢å’ŒéªŒè¯è¿‡ç¨‹ã€‚</p>
</li>
<li><p>å¦‚æœå§‹ç»ˆæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ–¹æ³•ï¼Œåˆ™æŠ›å‡º <code>java.lang.AbstractMethodError</code> å¼‚å¸¸ã€‚<code>IllegalAccessError</code>ï¼š</p>
<p>ç¨‹åºè¯•å›¾è®¿é—®æˆ–ä¿®æ”¹ä¸€ä¸ªå±æ€§æˆ–è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªå±æ€§æˆ–æ–¹æ³•ï¼Œä½ æ²¡æœ‰æƒé™è®¿é—®ã€‚ä¸€èˆ¬çš„è¿™ä¸ªä¼šå¼•æ“ç¼–è¯‘å™¨å¼‚å¸¸ï¼Œè¿™ä¸ªé”™è¯¯å¦‚æœå‘ç”Ÿåœ¨è¿è¡Œæ—¶ï¼Œå°±è¯´æ˜ä¸€ä¸ªç±»å‘ç”Ÿäº†ä¸å…¼å®¹çš„æ”¹å˜ã€‚</p>
</li>
</ul>
<blockquote>
<h4 id="è™šæ–¹æ³•è¡¨"><a href="#è™šæ–¹æ³•è¡¨" class="headerlink" title="è™šæ–¹æ³•è¡¨"></a>è™šæ–¹æ³•è¡¨</h4></blockquote>
<ul>
<li><p>åœ¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹ä¸­ï¼Œä¼šå¾ˆé¢‘ç¹çš„ä½¿ç”¨åˆ°åŠ¨æ€åˆ†æ´¾ï¼Œå¦‚æœåœ¨æ¯æ¬¡åŠ¨æ€åˆ†æ´¾çš„è¿‡ç¨‹ä¸­éƒ½è¦é‡æ–°åœ¨ç±»çš„æ–¹æ³•å…ƒæ•°æ®ä¸­æœç´¢åˆé€‚çš„ç›®æ ‡çš„è¯å°±å¯èƒ½å½±å“åˆ°æ‰§è¡Œæ•ˆç‡ã€‚å› æ­¤ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼ŒJVMé‡‡ç”¨åœ¨ç±»çš„æ–¹æ³•åŒºå»ºç«‹ä¸€ä¸ªè™šæ–¹æ³•è¡¨(virtual method table) (éè™šæ–¹æ³•ä¸ä¼šå‡ºç°åœ¨è¡¨ä¸­)æ¥å®ç°ã€‚ä½¿ç”¨ç´¢å¼•è¡¨æ¥ä»£æ›¿æŸ¥æ‰¾ã€‚</p>
</li>
<li><p>æ¯ä¸ªç±»ä¸­éƒ½æœ‰ä¸€ä¸ªè™šæ–¹æ³•è¡¨ï¼Œè¡¨ä¸­å­˜æ”¾ç€å„ä¸ªæ–¹æ³•çš„å®é™…å…¥å£ã€‚</p>
</li>
<li><p>é‚£ä¹ˆè™šæ–¹æ³•è¡¨ä»€ä¹ˆæ—¶å€™è¢«åˆ›å»ºï¼Ÿ</p>
</li>
</ul>
<p>è™šæ–¹æ³•è¡¨ä¼šåœ¨ç±»åŠ è½½çš„é“¾æ¥é˜¶æ®µè¢«åˆ›å»ºå’Œå¼€å§‹åˆå§‹åŒ–ï¼Œç±»çš„å˜é‡åˆå§‹å€¼å‡†å¤‡å®Œæˆä»¥åï¼ŒJVMä¼šæŠŠç±»çš„æ–¹æ³•è¡¨ä¹Ÿåˆå§‹åŒ–å®Œæ¯•ã€‚</p>
<p>å›é¡¾ä¸€ä¸‹é“¾æ¥é˜¶æ®µï¼šé“¾æ¥é˜¶æ®µåˆ†ä¸ºéªŒè¯ã€å‡†å¤‡ã€è§£æä¸‰ä¸ªé˜¶æ®µï¼Œåœ¨è§£æé˜¶æ®µæ—¶ï¼Œä¼šå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚</p>
<h3 id="æ–¹æ³•è¿”å›åœ°å€ï¼ˆReturn-Addressï¼‰"><a href="#æ–¹æ³•è¿”å›åœ°å€ï¼ˆReturn-Addressï¼‰" class="headerlink" title="æ–¹æ³•è¿”å›åœ°å€ï¼ˆReturn Addressï¼‰"></a>æ–¹æ³•è¿”å›åœ°å€ï¼ˆ<code>Return Address</code>ï¼‰</h3><p>æ–¹æ³•è¿”å›åœ°å€ã€åŠ¨æ€é“¾æ¥ã€ä¸€äº›é™„åŠ ä¿¡æ¯ç»Ÿç§°ä¸ºå¸§æ•°æ®åŒºã€‚</p>
<ul>
<li>å­˜æ”¾è°ƒç”¨è¯¥æ–¹æ³•çš„ pc å¯„å­˜å™¨çš„å€¼ï¼ˆPCå¯„å­˜å™¨å­˜æ”¾çš„æ˜¯ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„å€¼ï¼‰</li>
<li>ä¸€ä¸ªæ–¹æ³•çš„ç»“æŸï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š<ul>
<li>æ­£å¸¸æ‰§è¡Œå®Œæˆ</li>
<li>å‡ºç°æœªå¤„ç†çš„å¼‚å¸¸ï¼Œéæ­£å¸¸é€€å‡º</li>
</ul>
</li>
<li>æ— è®ºé€šè¿‡å“ªç§æ–¹å¼é€€å‡ºï¼Œåœ¨æ–¹æ³•é€€å‡ºåéƒ½è¿”å›åˆ°è¯¥æ–¹æ³•è¢«è°ƒç”¨çš„ä½ç½®ã€‚æ–¹æ³•æ­£å¸¸é€€å‡ºæ—¶ï¼Œè°ƒç”¨è€…çš„ pc è®¡æ•°å™¨çš„å€¼ä½œä¸ºè¿”å›åœ°å€ï¼Œå³è°ƒç”¨è¯¥æ–¹æ³•çš„æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚è€Œé€šè¿‡å¼‚å¸¸é€€å‡ºçš„ï¼Œè¿”å›åœ°å€æ˜¯è¦é€šè¿‡å¼‚å¸¸è¡¨æ¥ç¡®å®šï¼Œæ ˆå¸§ä¸­ä¸€èˆ¬ä¸ä¼šä¿å­˜è¿™éƒ¨åˆ†ä¿¡æ¯ã€‚</li>
<li>æœ¬è´¨ä¸Šï¼Œæ–¹æ³•çš„é€€å‡ºå°±æ˜¯å½“å‰æ ˆå¸§å‡ºæ ˆçš„è¿‡ç¨‹ã€‚æ­¤æ—¶ï¼Œéœ€è¦æ¢å¤ä¸Šå±‚æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€å°†è¿”å›å€¼å‹å…¥è°ƒç”¨è€…æ ˆå¸§çš„æ“ä½œæ•°æ ˆã€è®¾ç½® PC å¯„å­˜å™¨å€¼ç­‰ï¼Œè®©è°ƒç”¨è€…æ–¹æ³•ç»§ç»­æ‰§è¡Œä¸‹å»ã€‚</li>
<li>æ­£å¸¸å®Œæˆé€€å‡ºå’Œå¼‚å¸¸é€€å‡ºçš„åŒºåˆ«åœ¨äºï¼šé€šè¿‡å¼‚å¸¸å®Œæˆå‡ºå£é€€å‡ºçš„ä¸ä¼šç»™ä»–çš„ä¸Šå±‚è°ƒç”¨è€…äº§ç”Ÿä»»ä½•çš„è¿”å›å€¼</li>
</ul>
<h3 id="ä¸€äº›é™„åŠ ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰"><a href="#ä¸€äº›é™„åŠ ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="ä¸€äº›é™„åŠ ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰"></a>ä¸€äº›é™„åŠ ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰</h3><p>æ ˆå¸§ä¸­è¿˜å…è®¸æºå¸¦ä¸JVMå®ç°ç›¸å…³çš„ä¸€äº›é™„åŠ ä¿¡æ¯ï¼Œä¾‹å¦‚å¯¹ç¨‹åºè°ƒè¯•æ”¯æŒçš„ä¿¡æ¯ã€‚</p>
<h2 id="æ ˆçš„ç›¸å…³é¢è¯•é¢˜"><a href="#æ ˆçš„ç›¸å…³é¢è¯•é¢˜" class="headerlink" title="æ ˆçš„ç›¸å…³é¢è¯•é¢˜"></a>æ ˆçš„ç›¸å…³é¢è¯•é¢˜</h2><h3 id="ä¸¾ä¾‹æ ˆæº¢å‡ºçš„æƒ…å†µï¼ˆStackOverflowErrorï¼‰"><a href="#ä¸¾ä¾‹æ ˆæº¢å‡ºçš„æƒ…å†µï¼ˆStackOverflowErrorï¼‰" class="headerlink" title="ä¸¾ä¾‹æ ˆæº¢å‡ºçš„æƒ…å†µï¼ˆStackOverflowErrorï¼‰"></a>ä¸¾ä¾‹æ ˆæº¢å‡ºçš„æƒ…å†µï¼ˆStackOverflowErrorï¼‰</h3><p>é€šè¿‡ -Xss è®¾ç½®æ ˆçš„å¤§å°åï¼Œä¾‹å¦‚ä¸€ä¸ªæ–¹æ³•é€’å½’è°ƒç”¨ï¼Œèƒ½è°ƒå¤šå°‘æ¬¡å°±å–å†³äºæ ˆçš„å¤§å°ã€‚æ ˆç©ºé—´ä¸è¶³æ—¶ï¼Œå°±ä¼šå‡ºç°OOMã€‚è°ƒæ•´æ ˆå¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—ã€‚</p>
<h3 id="è°ƒæ•´æ ˆå¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—"><a href="#è°ƒæ•´æ ˆå¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—" class="headerlink" title="è°ƒæ•´æ ˆå¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—"></a>è°ƒæ•´æ ˆå¤§å°ï¼Œå°±èƒ½ä¿è¯ä¸å‡ºç°æº¢å‡ºå—</h3><p>ä¸èƒ½ã€‚å¦‚æœæ˜¯æ­»å¾ªç¯ï¼Œä¸ç®¡æ ˆçš„å¤§å°æ˜¯å¤šå°‘éƒ½ä¼šå‡ºç°æº¢å‡ºã€‚</p>
<h3 id="åˆ†é…çš„æ ˆå†…å­˜è¶Šå¤§è¶Šå¥½å—"><a href="#åˆ†é…çš„æ ˆå†…å­˜è¶Šå¤§è¶Šå¥½å—" class="headerlink" title="åˆ†é…çš„æ ˆå†…å­˜è¶Šå¤§è¶Šå¥½å—"></a>åˆ†é…çš„æ ˆå†…å­˜è¶Šå¤§è¶Šå¥½å—</h3><p>ä¸æ˜¯ã€‚æ•´ä¸ªè™šæ‹Ÿæœºçš„å†…å­˜ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œæ ˆå˜å¤§äº†ï¼Œå†…å­˜ä¸­çš„å‰©ä½™ç©ºé—´ä¼šå˜å°ï¼Œç”šè‡³å‡ºç°OOMã€‚</p>
<h3 id="åƒåœ¾å›æ”¶æ˜¯å¦ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆ"><a href="#åƒåœ¾å›æ”¶æ˜¯å¦ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="åƒåœ¾å›æ”¶æ˜¯å¦ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆ"></a>åƒåœ¾å›æ”¶æ˜¯å¦ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆ</h3><p>ä¸ä¼šã€‚è™šæ‹Ÿæœºæ ˆæ˜¯ä¸ªæ ˆç»“æ„ï¼Œåªå­˜åœ¨è¿›æ ˆå’Œå‡ºæ ˆä¸¤ä¸ªæ“ä½œã€‚</p>
<table>
<thead>
<tr>
<th>ç»“æ„åç§°</th>
<th>å¯èƒ½Error</th>
<th>å¯èƒ½GC</th>
</tr>
</thead>
<tbody><tr>
<td>ç¨‹åºè®¡æ•°å™¨</td>
<td>x</td>
<td>x</td>
</tr>
<tr>
<td>æœ¬åœ°æ–¹æ³•æ ˆ</td>
<td>x</td>
<td>âˆš</td>
</tr>
<tr>
<td>è™šæ‹Ÿæœºæ ˆ</td>
<td>âˆš</td>
<td>x</td>
</tr>
</tbody></table>
</body></html>]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>TLAB(Thread Local Allocation Buffer)</title>
    <url>/p/5bb29d6f.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>å †åŒºæ˜¯ä¸€å—çº¿ç¨‹å…±äº«åŒºåŸŸï¼Œéçº¿ç¨‹å®‰å…¨ã€‚å¦‚æœéœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œéœ€è¦å€ŸåŠ©é”ï¼Œä½†ä¼šå½±å“å†…å­˜çš„åˆ†é…é€Ÿåº¦ã€‚</p>
<p>å¤šçº¿ç¨‹åŒæ—¶åˆ†é…å†…å­˜æ—¶ï¼Œä½¿ç”¨ TLAB å¯ä»¥é¿å…ä¸€ç³»åˆ—çš„éçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ŒåŒæ—¶è¿˜èƒ½æå‡å†…å­˜åˆ†é…çš„ååé‡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†è¿™ç§å†…å­˜åˆ†é…æ–¹å¼ç§°ä¹‹ä¸º<strong>å¿«é€Ÿåˆ†é…ç­–ç•¥</strong>ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯TLABï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯TLABï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯TLABï¼Ÿ"></a>ä»€ä¹ˆæ˜¯TLABï¼Ÿ</h2><p>ä»å†…å­˜æ¨¡å‹çš„è§’åº¦ï¼Œåœ¨EdenåŒºä¸­åˆ’åˆ†çš„ä¸€ä¸ªåŒºåŸŸå«åšTLABï¼ˆTLAB å…¨ç§° Thread Local Allocation Bufferï¼‰ï¼Œæœ¬åœ°åˆ†é…ç¼“å­˜åŒºï¼Œæ˜¯JVMä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…äº†ä¸€ä¸ªç§æœ‰çš„ç¼“å­˜åŒºåŸŸï¼Œå ç”¨å†…å­˜æ˜¯æ•´ä¸ªEdençš„1%ï¼Œå ç”¨ç©ºé—´éå¸¸å°ã€‚</p>
<h2 id="å®é™…åº”ç”¨TLAB"><a href="#å®é™…åº”ç”¨TLAB" class="headerlink" title="å®é™…åº”ç”¨TLAB"></a>å®é™…åº”ç”¨TLAB</h2><p>å°½ç®¡ä¸æ˜¯æ‰€æœ‰å¯¹è±¡å®ä¾‹éƒ½èƒ½å¤Ÿåœ¨TLABä¸­æˆåŠŸåˆ†é…å†…å­˜ï¼ˆå› ä¸ºTLABå†…å­˜å¾ˆå°ï¼‰ï¼Œä½†JVMç¡®å®æ˜¯å°†TLABä½œä¸ºå†…å­˜åˆ†é…çš„é¦–é€‰ã€‚</p>
<p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‚æ•° <code>-XX:TLABWasteTargetPercent</code>æ¥è®¾ç½®TLABç©ºé—´æ‰€å ç”¨ Eden ç©ºé—´çš„ç™¾åˆ†æ¯”å¤§å°ã€‚</p>
<p>ä¸€æ—¦å¯¹è±¡åœ¨TLABç©ºé—´åˆ†é…å¤±è´¥æ—¶ï¼ˆä¾‹å¦‚ç©ºé—´ä¸è¶³ï¼‰ï¼ŒJVMå°±ä¼šå°è¯•é€šè¿‡ä½¿ç”¨åŠ é”æœºåˆ¶æ¥ç¡®ä¿æ•°æ®æ“ä½œçš„åŸå­æ€§ï¼Œä»è€Œç›´æ¥åœ¨Edenç©ºé—´ä¸­åˆ†é…å†…å­˜ã€‚</p>
<p><img src="/p/5bb29d6f/JVM-TLAB.png" alt="JVM-TLAB"></p>
<p>ç°åœ¨newä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åTLABåˆ†é…ï¼Œå¦‚æœTLABç©ºé—´å¤Ÿç”¨ï¼Œé‚£ä¹ˆå°±å¯¹è±¡å®ä¾‹åŒ–ï¼Œå¦‚æœä¸å¤Ÿç”¨å°±åªèƒ½ç”¨Edenå…¬å…±çš„éƒ¨åˆ†ï¼Œå¦‚æœè¿˜ä¸å¤Ÿç”¨ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘GCã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVMå¹´è½»ä»£ä¸è€å¹´ä»£</title>
    <url>/p/5ecdfc3e.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="å †åŒºåˆ’åˆ†"><a href="#å †åŒºåˆ’åˆ†" class="headerlink" title="å †åŒºåˆ’åˆ†"></a>å †åŒºåˆ’åˆ†</h2><p>Javaå †åŒºåˆ†ä¸ºå¹´è½»ä»£ï¼ˆYoung Genï¼‰ä¸è€å¹´ä»£ï¼ˆOld Genï¼‰ã€‚å­˜å‚¨åœ¨JVMä¸­çš„Javaå¯¹è±¡å¯ä»¥è¢«åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<p>1ã€ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„ç¬æ—¶å¯¹è±¡ï¼Œè¿™ç±»å¯¹è±¡çš„åˆ›å»ºå’Œæ¶ˆäº¡éƒ½éå¸¸è¿…é€Ÿï¼ˆå¦‚è½¯å¼•ç”¨å¯¹è±¡ï¼Œä¸€æ—¦GCå°±ä¼šè¢«å›æ”¶ï¼‰ã€‚</p>
<p>2ã€ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿ï¼Œåœ¨æŸäº›æç«¯çš„æƒ…å†µä¸‹è¿˜èƒ½å¤Ÿä¸JVMçš„ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€ç›´ã€‚</p>
<p>å…¶ä¸­å¹´è½»ä»£åˆå¯ä»¥åˆ’åˆ†ä¸ºEdenåŒºã€Survivor0åŒºï¼ˆfromåŒºï¼‰ã€Survivor1åŒºï¼ˆtoåŒºï¼‰ã€‚</p>
<p><img src="/p/5ecdfc3e/JVM-%E5%B9%B4%E8%BD%BB%E4%BB%A3%E4%B8%8E%E8%80%81%E5%B9%B4%E4%BB%A3.png" alt="image-20211008224055196"></p>
<h2 id="å‚æ•°è°ƒé…"><a href="#å‚æ•°è°ƒé…" class="headerlink" title="å‚æ•°è°ƒé…"></a>å‚æ•°è°ƒé…</h2><p><img src="/p/5ecdfc3e/JVM-%E5%A0%86%E5%8C%BA%E5%8F%82%E6%95%B0%E8%B0%83%E9%85%8D.png" alt="img"></p>
<p>é…ç½®æ–°ç”Ÿä»£ä¸è€å¹´ä»£åœ¨å †ç»“æ„çš„å æ¯”ï¼š</p>
<p>1ã€é»˜è®¤ <code>-XX:NewRatio=2</code>ï¼Œè¡¨ç¤ºæ–°ç”Ÿä»£å  1ï¼Œè€å¹´ä»£å  2ï¼Œæ–°ç”Ÿä»£å æ•´ä¸ªå †çš„ 1/2ã€‚</p>
<p>å¦‚ä½•çŸ¥é“é»˜è®¤æ˜¯1:2 çš„å‘¢ï¼Œå¯ä»¥é€šè¿‡JVMå®˜ç½‘æŸ¥è¿™ä¸ªæŒ‡ä»¤ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤æ¥æŸ¥çœ‹ï¼š</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">jps</span><br><span class="line">jinfo -flag NewRatio [è¿›ç¨‹ID]</span><br></pre></td></tr></tbody></table></figure>

<p>2ã€å¯ä»¥ä¿®æ”¹ <code>-XX:NewRatio=4</code>ï¼Œè¡¨ç¤ºæ–°ç”Ÿä»£å 1ï¼Œè€å¹´ä»£å 4ï¼Œæ–°ç”Ÿä»£å æ•´ä¸ªå †çš„ 1/5ã€‚</p>
<blockquote>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œæ˜¯ä¸ä¼šè°ƒåŠ¨æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ï¼Œé‚£ä¹ˆä»€ä¹ˆæ—¶å€™ä¼šè°ƒè¿™ä¸ªæ¯”ä¾‹å‘¢ï¼Ÿ</p>
</blockquote>
<p>æ˜ç¡®çŸ¥é“å¤§å¤šæ•°å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒé•¿æ—¶ï¼Œå°±å»ºè®®å°†è€å¹´ä»£è°ƒå¤§ä¸€äº›ï¼Œå¯ä»¥å¤šå­˜å‚¨ä¸€äº›å¯¹è±¡ã€‚</p>
<h2 id="å…³äºEdenã€S0ä¸S1çš„ç©ºé—´æ¯”ä¾‹é—®é¢˜"><a href="#å…³äºEdenã€S0ä¸S1çš„ç©ºé—´æ¯”ä¾‹é—®é¢˜" class="headerlink" title="å…³äºEdenã€S0ä¸S1çš„ç©ºé—´æ¯”ä¾‹é—®é¢˜"></a>å…³äºEdenã€S0ä¸S1çš„ç©ºé—´æ¯”ä¾‹é—®é¢˜</h2><p>1ã€åœ¨ HotSpot ä¸­ï¼ŒEdenç©ºé—´å’Œå¦å¤–ä¸¤ä¸ª Survivor ç©ºé—´ç¼ºçœæ‰€å çš„æ¯”ä¾‹æ˜¯ 8:1:1ã€‚</p>
<blockquote>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œ<code>Eden:S0:S1=8:1:1</code>æ˜¯çœŸçš„å—ï¼Ÿ</p>
</blockquote>
<p>æŸ¥çœ‹é»˜è®¤çš„æ¯”ä¾‹ï¼š</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">jps</span><br><span class="line">jinfo -flag SurvivorRatio [è¿›ç¨‹ID]</span><br><span class="line"><span class="comment"># æŸ¥è¯¢ç»“æœä¸º -XX:SurvivorRatio=8</span></span><br></pre></td></tr></tbody></table></figure>

<p>æŸ¥è¯¢ç»“æœç¡®å®æ˜¯8:1:1ï¼Œä½†é€šè¿‡ <code>jvisualvm</code> æŸ¥çœ‹åˆ°çš„å®é™…æƒ…å†µå´æ˜¯ 6:1:1 ï¼ŒåŸå› æ˜¯å› ä¸ºJVMæœ‰è‡ªé€‚åº”çš„å†…å­˜åˆ†é…ç­–ç•¥ï¼Œé€šè¿‡è®¾ç½®å‚æ•° <code>-XX:-UseAdaptiveSizePolicy -XX:SurvivorRatio=8</code> æ¥å…³é—­è‡ªé€‚åº”ç­–ç•¥ï¼Œå¹¶è°ƒæ•´ç©ºé—´æ¯”ä¾‹ä¸º8:1:1ã€‚</p>
<p>2ã€å‡ ä¹æ‰€æœ‰çš„Javaå¯¹è±¡éƒ½æ˜¯åœ¨EdenåŒºè¢«newå‡ºæ¥çš„ï¼Œå¦‚æœå¯¹è±¡éå¸¸å¤§ï¼Œä»¥è‡³äºEdenè£…ä¸ä¸‹ï¼Œå°±ä¼šåœ¨è€å¹´ä»£newå‡ºæ¥ã€‚</p>
<p>3ã€ç»å¤§éƒ¨åˆ†çš„Javaå¯¹è±¡çš„é”€æ¯éƒ½æ˜¯åœ¨EdenåŒºï¼ˆæ–°ç”Ÿä»£ï¼‰è¿›è¡Œï¼ŒIBMå…¬å¸çš„ä¸“é—¨ç ”ç©¶è¡¨æ˜ï¼Œæ–°ç”Ÿä»£ä¸­80%çš„å¯¹è±¡éƒ½æ˜¯â€œæœç”Ÿå¤•æ­»â€çš„ã€‚</p>
<p>4ã€å¯ä»¥ä½¿ç”¨é€‰é¡¹â€œ-Xmnâ€ è®¾ç½®EdenåŒºï¼ˆæ–°ç”Ÿä»£ï¼‰çš„æœ€å¤§å†…å­˜å¤§å°ï¼Œè¿™ä¸ªå‚æ•°ä¸€èˆ¬ä½¿ç”¨é»˜è®¤å€¼å°±å¯ä»¥äº†ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux lsblkå‘½ä»¤</title>
    <url>/p/da8acf6b.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>lsblkï¼ˆlist block devicesï¼‰ä¼šåˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ç¡¬ç›˜ã€Uç›˜ã€å…‰é©±ç­‰<strong>å—è®¾å¤‡</strong>çš„ä¿¡æ¯ï¼Œä»¥åŠåˆ†åŒºå’ŒæŒ‚è½½ç‚¹ç­‰ã€‚å¸¸ç”¨äºæŸ¥çœ‹ç£ç›˜çš„æŒ‚è½½æƒ…å†µã€ç£ç›˜åˆ†åŒºã€ç£ç›˜çš„æ–‡ä»¶ç±»å‹(ext4ã€xfsã€ntfsç­‰)ã€æ’æŸ¥å­˜å‚¨è®¾å¤‡é—®é¢˜ã€‚</p>
<h2 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h2><p>lsblk [OPTIONS]</p>
<ul>
<li>OPTIONSï¼šé€‰é¡¹å‚æ•°</li>
</ul>
<table>
<thead>
<tr>
<th>é€‰é¡¹å‚æ•°</th>
<th>ä»‹ç»</th>
</tr>
</thead>
<tbody><tr>
<td><code>-a</code>(all)</td>
<td>æ˜¾ç¤ºæ‰€æœ‰å—è®¾å¤‡(åŒ…æ‹¬æ²¡æœ‰æŒ‚è½½çš„è®¾å¤‡)ã€‚åœ¨å•ç‹¬ä½¿ç”¨lsblkå‘½ä»¤æ—¶ï¼Œä¼šå¿½ç•¥æ²¡æœ‰åˆ†åŒºçš„è®¾å¤‡ï¼Œé€šè¿‡<code>-a</code>å‚æ•°å¯ä»¥ç¡®ä¿åˆ—å‡ºæ‰€æœ‰è®¾å¤‡ã€‚</td>
</tr>
<tr>
<td><code>-f</code>(filesystem)</td>
<td>æ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ï¼ˆè®¾å¤‡ä½¿ç”¨æƒ…å†µã€æŒ‚è½½ç‚¹ã€æ–‡ä»¶ç³»ç»Ÿç±»å‹ç­‰ï¼‰ã€‚</td>
</tr>
<tr>
<td><code>-m</code>(permissions)</td>
<td>æ˜¾ç¤ºè®¾å¤‡çš„æƒé™ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œè®¾å¤‡çš„è¯»å†™æƒé™ã€‚</td>
</tr>
<tr>
<td><code>-o</code>(output)</td>
<td>è‡ªå®šä¹‰è¾“å‡ºçš„åˆ—ã€‚ä¾‹å¦‚ï¼Œ<code>lsblk -o NAME,SIZE,FSTYPE,MOUNTPOINT</code> åªä¼šæ˜¾ç¤ºè®¾å¤‡åç§°ã€å¤§å°ã€æ–‡ä»¶ç³»ç»Ÿç±»å‹å’ŒæŒ‚è½½ç‚¹ã€‚</td>
</tr>
<tr>
<td><code>-d</code>(device)</td>
<td>åªæ˜¾ç¤ºåŸå§‹è®¾å¤‡ï¼Œä¸æ˜¾ç¤ºåˆ†åŒºä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œåªæƒ³çœ‹ç¡¬ç›˜æœ¬èº«ï¼Œä¸æƒ³çœ‹åˆ†åŒºã€‚</td>
</tr>
</tbody></table>
<h2 id="åŸºæœ¬åŠŸèƒ½"><a href="#åŸºæœ¬åŠŸèƒ½" class="headerlink" title="åŸºæœ¬åŠŸèƒ½"></a>åŸºæœ¬åŠŸèƒ½</h2><h3 id="lsblk-a"><a href="#lsblk-a" class="headerlink" title="lsblk -a"></a><code>lsblk -a</code></h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># lsblk -a</span></span><br><span class="line">NAME                      MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">sda                         8:0    0 232.9G 0 disk</span><br><span class="line">â”œâ”€sda1                      8:1    0 512M   0 part /boot/efi</span><br><span class="line">â”œâ”€sda2                      8:2    0 128M   0 part /boot</span><br><span class="line">â””â”€sda3                      8:3    0 232.3G 0 part /</span><br><span class="line">sdv                        65:80   0 14.6T  0 disk /root/disks/25</span><br><span class="line">sdw                        65:96   0 14.6T  0 disk /root/disks/28</span><br><span class="line">sdx                        65:112  0 14.6T  0 disk /root/disks/26</span><br><span class="line">sdy                        65:128  0 14.6T  0 disk /root/disks/27</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å‚æ•°å«ä¹‰</strong></p>
<p>sdaçš„æ ‘çŠ¶ç»“æ„ï¼š<code>sda1</code>ã€<code>sda2</code>ã€<code>sda3</code> æ˜¯ <code>sda</code> ç¡¬ç›˜çš„åˆ†åŒºã€‚</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>NAME</td>
<td>è®¾å¤‡åç§°</td>
</tr>
<tr>
<td>MAJ:MIN</td>
<td>è®¾å¤‡çš„ä¸»è®¾å¤‡å·å’Œæ¬¡è®¾å¤‡å·ï¼ŒLinuxç³»ç»Ÿä¸­è®¾å¤‡çš„å”¯ä¸€æ ‡è¯†ï¼Œç”¨æˆ·ä¾§ä¸å…³å¿ƒã€‚</td>
</tr>
<tr>
<td>RM</td>
<td>è¡¨ç¤ºè®¾å¤‡æ˜¯å¦æ˜¯å¯ç§»åŠ¨è®¾å¤‡ã€‚<code>1</code> è¡¨ç¤ºæ˜¯å¯ç§»åŠ¨è®¾å¤‡ï¼ˆæ¯”å¦‚ U ç›˜ï¼‰ï¼Œ<code>0</code> è¡¨ç¤ºä¸æ˜¯å¯ç§»åŠ¨è®¾å¤‡ï¼ˆæ¯”å¦‚å†…ç½®ç¡¬ç›˜ï¼‰ã€‚</td>
</tr>
<tr>
<td>SIZE</td>
<td>è®¾å¤‡çš„å­˜å‚¨å¤§å°ï¼Œä¾‹å¦‚14.6Tä»£è¡¨ç¡¬ç›˜çš„å¤§å°ã€‚</td>
</tr>
<tr>
<td>RO</td>
<td>è¡¨ç¤ºè®¾å¤‡æ˜¯å¦æ˜¯åªè¯»çš„ã€‚<code>0</code> è¡¨ç¤ºå¯ä»¥è¯»å†™ï¼Œ<code>1</code> è¡¨ç¤ºåªè¯»ã€‚</td>
</tr>
<tr>
<td>TYPE</td>
<td>è®¾å¤‡çš„ç±»å‹ï¼Œ<code>disk</code> è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç¡¬ç›˜ï¼ˆæˆ–è€…ç±»ä¼¼ç¡¬ç›˜çš„è®¾å¤‡ï¼‰ï¼Œ<code>part</code> è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåˆ†åŒºã€‚</td>
</tr>
<tr>
<td>MOUNTPOINTS</td>
<td>è®¾å¤‡çš„æŒ‚è½½ç‚¹ã€‚å¦‚æœä¸€ä¸ªè®¾å¤‡è¢«æŒ‚è½½åˆ°äº†æŸä¸ªç›®å½•ï¼Œè¿™é‡Œå°±ä¼šæ˜¾ç¤ºæŒ‚è½½çš„è·¯å¾„ã€‚æ¯”å¦‚ <code>/</code> è¡¨ç¤ºæ ¹ç›®å½•ï¼Œè®¾å¤‡<code>sdv</code>è¢«æŒ‚è½½åˆ°äº†<code>/root/disks/25</code>ç›®å½•ä¸‹ã€‚å¦‚æœè®¾å¤‡æ²¡æœ‰æŒ‚è½½ï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºä¸ºç©ºã€‚</td>
</tr>
</tbody></table>
<p><code>lsblk -f</code></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># lsblk -f</span></span><br><span class="line">NAME   FSTYPE   FSVER   LABEL UUID                                   FSAVAIL FSUSE% MOUNTPOINTS</span><br><span class="line">sdv    ext4     1.0           e9833d5b-20fd-44de-a8bd-76e8e4582901      9.6T    34% /root/disks/25</span><br><span class="line">sdw    ext4     1.0           eba1d424-0e27-440d-92a0-4f53a36357e6      5.1T    65% /root/disks/28</span><br><span class="line">sdx    ext4     1.0           bc6a6972-9749-4daa-b014-912545f9d4e5      1.6T    89% /root/disks/26</span><br><span class="line">sdy    ext4     1.0           f91546ca-2547-4fa2-951b-fe06a5151409      6.5T    56% /root/disks/27</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å‚æ•°å«ä¹‰</strong></p>
<table>
<thead>
<tr>
<th align="left">å‚æ•°</th>
<th align="left">å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>NAME</code></td>
<td align="left">è®¾å¤‡åç§°ï¼Œæ¯”å¦‚ç¡¬ç›˜ï¼ˆ<code>sda</code>ï¼‰ã€åˆ†åŒºï¼ˆ<code>sda1</code>ï¼‰ç­‰</td>
</tr>
<tr>
<td align="left"><code>FSTYPE</code>(FileSystem Type)</td>
<td align="left">æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼Œæ¯”å¦‚ <code>ext4</code>ã€<code>xfs</code>ã€<code>ntfs</code> ç­‰</td>
</tr>
<tr>
<td align="left"><code>FSVER</code>(FileSystem Version)</td>
<td align="left">æ–‡ä»¶ç³»ç»Ÿçš„ç‰ˆæœ¬å·</td>
</tr>
<tr>
<td align="left"><code>LABEL</code></td>
<td align="left">è®¾å¤‡çš„æ ‡ç­¾ï¼Œç”¨æˆ·å¯ä»¥ç»™è®¾å¤‡è‡ªå®šä¹‰åç§°</td>
</tr>
<tr>
<td align="left"><code>UUID</code></td>
<td align="left">è®¾å¤‡çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œæ¯ä¸ªè®¾å¤‡éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ UUID</td>
</tr>
<tr>
<td align="left"><code>FSAVAIL</code></td>
<td align="left">æ–‡ä»¶ç³»ç»Ÿä¸­å¯ç”¨çš„ç©ºé—´å¤§å°</td>
</tr>
<tr>
<td align="left"><code>FSUSE%</code>(FileSystem Use Percentage)</td>
<td align="left">æ–‡ä»¶ç³»ç»Ÿçš„ä½¿ç”¨ç‡ï¼Œä»¥ç™¾åˆ†æ¯”è¡¨ç¤º</td>
</tr>
<tr>
<td align="left"><code>MOUNTPOINTS</code></td>
<td align="left">è®¾å¤‡çš„æŒ‚è½½ç‚¹ï¼Œæ˜¾ç¤ºè®¾å¤‡æŒ‚è½½åˆ°çš„ç›®å½•è·¯å¾„</td>
</tr>
</tbody></table>
<blockquote>
<p>æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€‚äº†è§£æ–‡ä»¶ç³»ç»Ÿç±»å‹å¯ä»¥å¸®åŠ©ä½ åˆ¤æ–­è®¾å¤‡çš„ç”¨é€”ï¼Œä»¥åŠæ˜¯å¦éœ€è¦ç‰¹å®šçš„å·¥å…·æ¥æ“ä½œå®ƒã€‚å¸¸è§çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹æœ‰ï¼š</p>
<ul>
<li><code>ext4</code>ï¼šLinux ç³»ç»Ÿå¸¸ç”¨çš„æ–‡ä»¶ç³»ç»Ÿã€‚</li>
<li><code>xfs</code>ï¼šå¦ä¸€ç§é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä¹Ÿå¸¸ç”¨äº Linuxã€‚</li>
<li><code>ntfs</code>ï¼šWindows ç³»ç»Ÿå¸¸ç”¨çš„æ–‡ä»¶ç³»ç»Ÿã€‚</li>
<li><code>vfat</code>ï¼šå¸¸ç”¨äº U ç›˜ç­‰ç§»åŠ¨å­˜å‚¨è®¾å¤‡ã€‚</li>
</ul>
</blockquote>
<p><code>lsblk -m</code></p>
<p><code>sdv</code>ã€<code>sdw</code>ã€<code>sdx</code>ã€<code>sdy</code> éƒ½æ˜¯ç¡¬ç›˜è®¾å¤‡çš„åç§°ï¼Œå¦‚æœæœ‰åˆ†åŒºï¼Œå¯èƒ½ä¼šçœ‹åˆ°ç±»ä¼¼ <code>sdv1</code>ã€<code>sdv2</code> ç­‰ã€‚</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># lsblk -m</span></span><br><span class="line">NAME                       SIZE OWNER GROUP MODE</span><br><span class="line">sdv                       14.6T root  disk  brw-rw----</span><br><span class="line">sdw                       14.6T root  disk  brw-rw----</span><br><span class="line">sdx                       14.6T root  disk  brw-rw----</span><br><span class="line">sdy                       14.6T root  disk  brw-rw----</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å‚æ•°å«ä¹‰</strong>.</p>
<p><code>brw-rw----</code>è§£é‡Šï¼š</p>
<ul>
<li><code>b</code>ï¼šè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå—è®¾å¤‡ï¼ˆblock deviceï¼‰ã€‚</li>
<li><code>rw-</code>ï¼šè¡¨ç¤ºæ‰€æœ‰è€…ï¼ˆ<code>root</code>ï¼‰å¯¹è¯¥è®¾å¤‡æœ‰è¯»å†™æƒé™ã€‚</li>
<li><code>rw-</code>ï¼šè¡¨ç¤ºæ‰€å±ç»„ï¼ˆ<code>disk</code>ï¼‰å¯¹è¯¥è®¾å¤‡æœ‰è¯»å†™æƒé™ã€‚</li>
<li><code>----</code>ï¼šè¡¨ç¤ºå…¶ä»–ç”¨æˆ·å¯¹è¯¥è®¾å¤‡æ²¡æœ‰æƒé™ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th align="left">åˆ—å</th>
<th align="left">å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>NAME</code></td>
<td align="left">è®¾å¤‡åç§°ï¼Œæ¯”å¦‚ç¡¬ç›˜ï¼ˆ<code>sda</code>ï¼‰ã€åˆ†åŒºï¼ˆ<code>sda1</code>ï¼‰ç­‰ã€‚</td>
</tr>
<tr>
<td align="left"><code>SIZE</code></td>
<td align="left">è®¾å¤‡çš„å¤§å°ï¼Œå•ä½é€šå¸¸æ˜¯å­—èŠ‚ï¼ˆBï¼‰ã€åƒå­—èŠ‚ï¼ˆKï¼‰ã€å…†å­—èŠ‚ï¼ˆMï¼‰ã€å‰å­—èŠ‚ï¼ˆGï¼‰æˆ–å¤ªå­—èŠ‚ï¼ˆTï¼‰ã€‚</td>
</tr>
<tr>
<td align="left"><code>OWNER</code></td>
<td align="left">è®¾å¤‡çš„æ‰€æœ‰è€…ç”¨æˆ·åã€‚</td>
</tr>
<tr>
<td align="left"><code>GROUP</code></td>
<td align="left">è®¾å¤‡æ‰€å±çš„ç”¨æˆ·ç»„åã€‚</td>
</tr>
<tr>
<td align="left"><code>MODE</code></td>
<td align="left">è®¾å¤‡çš„è®¿é—®æƒé™æ¨¡å¼ã€‚</td>
</tr>
</tbody></table>
<p><code>lsblk -d</code></p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># lsblk -d</span></span><br><span class="line">NAME  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">sda     8:0    1 57.6G  0 disk </span><br><span class="line">sdv    65:80   0 14.6T  0 disk /root/disks/25</span><br><span class="line">sdw    65:96   0 14.6T  0 disk /root/disks/28</span><br><span class="line">sdx    65:112  0 14.6T  0 disk /root/disks/26</span><br><span class="line">sdy    65:128  0 14.6T  0 disk /root/disks/27</span><br></pre></td></tr></tbody></table></figure>

</body></html>]]></content>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux topå‘½ä»¤</title>
    <url>/p/4c6cbbb6.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="å†…å®¹å«ä¹‰"><a href="#å†…å®¹å«ä¹‰" class="headerlink" title="å†…å®¹å«ä¹‰"></a>å†…å®¹å«ä¹‰</h2><p>ä½¿ç”¨<code>top</code>å‘½ä»¤åï¼Œ<code>top</code> ä¼šä»¥å…¨å±æ¨¡å¼æ˜¾ç¤ºå½“å‰ç³»ç»Ÿçš„å®æ—¶è¿è¡Œä¿¡æ¯ï¼š</p>
<p><img src="/p/4c6cbbb6/image-20250316172656385.png" alt="image-20250316172656385"></p>
<h3 id="é¡¶éƒ¨åŒºåŸŸ"><a href="#é¡¶éƒ¨åŒºåŸŸ" class="headerlink" title="é¡¶éƒ¨åŒºåŸŸ"></a>é¡¶éƒ¨åŒºåŸŸ</h3><p>é¡¶éƒ¨åŒºåŸŸæ˜¾ç¤ºä¸€äº›ç³»ç»Ÿæ¦‚è§ˆä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">top - 05:25:34 up 17:12,  6 <span class="built_in">users</span>,  load average: 0.09, 0.07, 0.06</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>å½“å‰æ—¶é—´</strong>ï¼šæ˜¾ç¤ºç³»ç»Ÿå½“å‰çš„æ—¶é—´ã€‚</li>
<li><strong>è¿è¡Œæ—¶é—´</strong>ï¼šæ˜¾ç¤ºç³»ç»Ÿè‡ªä¸Šæ¬¡å¯åŠ¨ä»¥æ¥çš„è¿è¡Œæ—¶é—´ã€‚</li>
<li><strong>ç”¨æˆ·æ•°é‡</strong>ï¼šæ˜¾ç¤ºå½“å‰ç™»å½•ç³»ç»Ÿçš„ç”¨æˆ·æ•°é‡ã€‚</li>
<li><strong>ç³»ç»Ÿè´Ÿè½½å¹³å‡å€¼</strong>ï¼šæ˜¾ç¤ºç³»ç»Ÿåœ¨è¿‡å» 1 åˆ†é’Ÿã€5 åˆ†é’Ÿå’Œ 15 åˆ†é’Ÿå†…çš„å¹³å‡è´Ÿè½½ã€‚è¿™äº›å€¼è¶Šä½ï¼Œè¯´æ˜ç³»ç»Ÿè¶Šç©ºé—²ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå½“ 1 åˆ†é’Ÿå¹³å‡è´Ÿè½½å€¼æ¥è¿‘ç³»ç»Ÿçš„ CPU æ ¸å¿ƒæ•°æ—¶ï¼Œç³»ç»Ÿå¯èƒ½å¼€å§‹å‡ºç°æ€§èƒ½ç“¶é¢ˆã€‚</li>
</ul>
<h3 id="ä¸­é—´åŒºåŸŸ"><a href="#ä¸­é—´åŒºåŸŸ" class="headerlink" title="ä¸­é—´åŒºåŸŸ"></a>ä¸­é—´åŒºåŸŸ</h3><p>ä¸­é—´åŒºåŸŸæ˜¾ç¤ºç³»ç»Ÿèµ„æºçš„ä½¿ç”¨æƒ…å†µã€‚</p>
<p>ä»»åŠ¡ï¼ˆè¿›ç¨‹ï¼‰æ•°é‡ï¼šæ˜¾ç¤ºå½“å‰ç³»ç»Ÿä¸­è¿è¡Œçš„è¿›ç¨‹æ€»æ•°ä»¥åŠå¤„äºè¿è¡Œã€ç¡çœ ã€åœæ­¢ã€åƒµå°¸çŠ¶æ€çš„è¿›ç¨‹æ•°é‡ã€‚</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">Tasks: 148 total,   1 running, 147 sleeping,   0 stopped,   0 zombie</span><br></pre></td></tr></tbody></table></figure>

<h4 id="CPUçš„ä½¿ç”¨ç‡"><a href="#CPUçš„ä½¿ç”¨ç‡" class="headerlink" title="CPUçš„ä½¿ç”¨ç‡"></a>CPUçš„ä½¿ç”¨ç‡</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">%Cpu(s):  0.0 us,  0.1 sy,  0.0 ni, 99.8 <span class="built_in">id</span>,  0.0 wa,  0.0 hi,  0.1 si,  0.0 st</span><br></pre></td></tr></tbody></table></figure>

<table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td>us</td>
<td>ç”¨æˆ·ç©ºé—´å ç”¨CPUç™¾åˆ†æ¯”</td>
</tr>
<tr>
<td>sy</td>
<td>å†…æ ¸ç©ºé—´å ç”¨CPUç™¾åˆ†æ¯”</td>
</tr>
<tr>
<td>ni</td>
<td>ç”¨æˆ·è¿›ç¨‹ç©ºé—´å†…æ”¹å˜è¿‡ä¼˜å…ˆçº§çš„è¿›ç¨‹å ç”¨CPUç™¾åˆ†æ¯”</td>
</tr>
<tr>
<td>id</td>
<td>ç©ºé—²CPUç™¾åˆ†æ¯”</td>
</tr>
<tr>
<td>wa</td>
<td>ç­‰å¾…è¾“å…¥è¾“å‡ºçš„CPUæ—¶é—´ç™¾åˆ†æ¯”</td>
</tr>
<tr>
<td>hi</td>
<td>ç¡¬ä¸­æ–­ï¼ˆHardware IRQï¼‰å ç”¨CPUçš„ç™¾åˆ†æ¯”</td>
</tr>
<tr>
<td>si</td>
<td>è½¯ä¸­æ–­ï¼ˆSoftware Interruptsï¼‰å ç”¨CPUçš„ç™¾åˆ†æ¯”</td>
</tr>
<tr>
<td>st</td>
<td>ç”¨äºæœ‰è™šæ‹Ÿcpuçš„æƒ…å†µï¼Œç”¨æ¥æŒ‡ç¤ºè¢«è™šæ‹Ÿæœºå·æ‰çš„cpuæ—¶é—´</td>
</tr>
</tbody></table>
<h4 id="å†…å­˜ä½¿ç”¨æƒ…å†µ"><a href="#å†…å­˜ä½¿ç”¨æƒ…å†µ" class="headerlink" title="å†…å­˜ä½¿ç”¨æƒ…å†µ"></a>å†…å­˜ä½¿ç”¨æƒ…å†µ</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">KiB Mem :  2895276 total,   531200 free,  1752092 used,   611984 buff/cache</span><br></pre></td></tr></tbody></table></figure>

<table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td>total</td>
<td>å†…å­˜æ€»é‡</td>
</tr>
<tr>
<td>used</td>
<td>å·²ä½¿ç”¨å†…å­˜</td>
</tr>
<tr>
<td>free</td>
<td>å†…å­˜ç©ºé—²é‡</td>
</tr>
<tr>
<td>buffers</td>
<td>ç”¨ä½œå†…æ ¸ç¼“å­˜çš„å†…å­˜é‡</td>
</tr>
</tbody></table>
<h4 id="äº¤æ¢ä½¿ç”¨æƒ…å†µ"><a href="#äº¤æ¢ä½¿ç”¨æƒ…å†µ" class="headerlink" title="äº¤æ¢ä½¿ç”¨æƒ…å†µ"></a>äº¤æ¢ä½¿ç”¨æƒ…å†µ</h4><p>äº¤æ¢ç©ºé—´æ˜¯ç£ç›˜ä¸Šçš„ä¸€å—åŒºåŸŸï¼Œå½“ç³»ç»Ÿçš„ç‰©ç†å†…å­˜ï¼ˆRAMï¼‰ä¸è¶³æ—¶ï¼Œç³»ç»Ÿä¼šå°†ä¸€äº›ä¸å¸¸ç”¨çš„å†…å­˜é¡µé¢ç§»åŠ¨åˆ°äº¤æ¢ç©ºé—´ä¸­ï¼Œä»¥é‡Šæ”¾ç‰©ç†å†…å­˜ä¾›å…¶ä»–è¿›ç¨‹ä½¿ç”¨ã€‚</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">KiB Swap:  2097148 total,  1878780 free,   218368 used.   947784 avail Mem</span><br></pre></td></tr></tbody></table></figure>

<table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td>total</td>
<td>ç³»ç»Ÿåˆ†é…çš„æ€»äº¤æ¢ç©ºé—´å¤§å°</td>
</tr>
<tr>
<td>free</td>
<td>å½“å‰æœªä½¿ç”¨çš„äº¤æ¢ç©ºé—´å¤§å°</td>
</tr>
<tr>
<td>used</td>
<td>å·²ä½¿ç”¨çš„ç©ºé—´å¤§å°</td>
</tr>
<tr>
<td>avail Mem</td>
<td>å½“å‰å¯ç”¨çš„ç‰©ç†å†…å­˜å¤§å°</td>
</tr>
</tbody></table>
<h3 id="è¿›ç¨‹åˆ—è¡¨åŒºåŸŸ"><a href="#è¿›ç¨‹åˆ—è¡¨åŒºåŸŸ" class="headerlink" title="è¿›ç¨‹åˆ—è¡¨åŒºåŸŸ"></a>è¿›ç¨‹åˆ—è¡¨åŒºåŸŸ</h3><p>åˆ—è¡¨ä¸­çš„è¿›ç¨‹æ˜¯æŒ‰ç…§CPUçš„å ç”¨é‡æ¥æ’åºã€‚</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"> PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND</span><br><span class="line">41168 1000      20   0 4282368 870172  22536 S   0.7 30.1   6:26.60 java</span><br><span class="line">  480 root      20   0       0      0      0 S   0.3  0.0   0:52.01 xfsaild/dm-0</span><br></pre></td></tr></tbody></table></figure>

<table>
<thead>
<tr>
<th>åˆ—å</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>PID</td>
<td>è¿›ç¨‹ID</td>
</tr>
<tr>
<td>USER</td>
<td>è¿›ç¨‹æ‰€æœ‰è€…çš„ç”¨æˆ·å</td>
</tr>
<tr>
<td>PR</td>
<td>ä¼˜å…ˆçº§</td>
</tr>
<tr>
<td>NI</td>
<td>niceå€¼ã€‚è´Ÿå€¼è¡¨ç¤ºé«˜ä¼˜å…ˆçº§ï¼Œæ­£å€¼è¡¨ç¤ºä½ä¼˜å…ˆçº§</td>
</tr>
<tr>
<td>VIRT</td>
<td>è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜æ€»é‡ï¼Œå•ä½kbã€‚VIRT=SWAP+RES</td>
</tr>
<tr>
<td>RES</td>
<td>è¿›ç¨‹ä½¿ç”¨çš„ã€æœªè¢«æ¢å‡ºçš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kbã€‚RES=CODE+DATA</td>
</tr>
<tr>
<td>SHR</td>
<td>å…±äº«å†…å­˜å¤§å°ï¼Œå•ä½kbã€‚</td>
</tr>
<tr>
<td>S</td>
<td>è¿›ç¨‹çŠ¶æ€ã€‚D=ä¸å¯ä¸­æ–­çš„ç¡çœ çŠ¶æ€ R=è¿è¡Œ S=ç¡çœ  T=è·Ÿè¸ª/åœæ­¢ Z=åƒµå°¸è¿›ç¨‹</td>
</tr>
<tr>
<td>%CPU</td>
<td>ä¸Šæ¬¡æ›´æ–°åˆ°ç°åœ¨çš„CPUæ—¶é—´å ç”¨ç™¾åˆ†æ¯”</td>
</tr>
<tr>
<td>%MEM</td>
<td>è¿›ç¨‹ä½¿ç”¨çš„ç‰©ç†å†…å­˜ç™¾åˆ†æ¯”</td>
</tr>
<tr>
<td>TIME+</td>
<td>è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´æ€»è®¡ï¼Œå•ä½1/100ç§’</td>
</tr>
<tr>
<td>COMMAND</td>
<td>å‘½ä»¤å/å‘½ä»¤è¡Œ</td>
</tr>
</tbody></table>
<h2 id="å¸¸ç”¨åŠŸèƒ½å’Œå¿«æ·é”®"><a href="#å¸¸ç”¨åŠŸèƒ½å’Œå¿«æ·é”®" class="headerlink" title="å¸¸ç”¨åŠŸèƒ½å’Œå¿«æ·é”®"></a>å¸¸ç”¨åŠŸèƒ½å’Œå¿«æ·é”®</h2><table>
<thead>
<tr>
<th align="left">åŠŸèƒ½</th>
<th align="left">å¿«æ·é”®</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">æŒ‰ CPU ä½¿ç”¨ç‡æ’åº</td>
<td align="left"><code>P</code></td>
<td align="left">æŒ‰ CPU ä½¿ç”¨ç‡é™åºæ’åºï¼Œå¿«é€Ÿæ‰¾åˆ°å ç”¨ CPU èµ„æºæœ€å¤šçš„è¿›ç¨‹ã€‚</td>
</tr>
<tr>
<td align="left">æŒ‰å†…å­˜ä½¿ç”¨ç‡æ’åº</td>
<td align="left"><code>M</code></td>
<td align="left">æŒ‰å†…å­˜ä½¿ç”¨ç‡é™åºæ’åºï¼Œå¿«é€Ÿæ‰¾åˆ°å ç”¨å†…å­˜æœ€å¤šçš„è¿›ç¨‹ã€‚</td>
</tr>
<tr>
<td align="left">æ˜¾ç¤ºå®Œæ•´å‘½ä»¤è¡Œ</td>
<td align="left"><code>c</code></td>
<td align="left">åˆ‡æ¢æ˜¾ç¤ºå®Œæ•´çš„å‘½ä»¤è¡Œï¼ŒæŸ¥çœ‹è¿›ç¨‹çš„è¯¦ç»†å‘½ä»¤è¡Œä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td align="left">ç»ˆæ­¢è¿›ç¨‹</td>
<td align="left"><code>k</code></td>
<td align="left">ç»ˆæ­¢æŒ‡å®šçš„è¿›ç¨‹ï¼Œè¾“å…¥è¿›ç¨‹ ID åå¯ä»¥é€‰æ‹©å‘é€ä¸åŒçš„ä¿¡å·ã€‚</td>
</tr>
<tr>
<td align="left">è°ƒæ•´è¿›ç¨‹ä¼˜å…ˆçº§</td>
<td align="left"><code>r</code></td>
<td align="left">è°ƒæ•´æŒ‡å®šè¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼ˆnice å€¼ï¼‰ï¼Œä¼˜åŒ–è¿›ç¨‹çš„è¿è¡Œä¼˜å…ˆçº§ã€‚</td>
</tr>
<tr>
<td align="left">æ˜¾ç¤ºæ¯ä¸ª CPU æ ¸å¿ƒçš„ä½¿ç”¨æƒ…å†µ</td>
<td align="left"><code>1</code></td>
<td align="left">æ˜¾ç¤ºæ¯ä¸ª CPU æ ¸å¿ƒçš„ä½¿ç”¨æƒ…å†µï¼Œäº†è§£å¤šæ ¸ç³»ç»Ÿçš„è´Ÿè½½åˆ†å¸ƒã€‚</td>
</tr>
<tr>
<td align="left">æŒ‰ç”¨æˆ·è¿‡æ»¤è¿›ç¨‹</td>
<td align="left"><code>u</code></td>
<td align="left">æŒ‰ç”¨æˆ·è¿‡æ»¤è¿›ç¨‹ï¼Œåªæ˜¾ç¤ºæŒ‡å®šç”¨æˆ·è¿è¡Œçš„è¿›ç¨‹ã€‚</td>
</tr>
<tr>
<td align="left">æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</td>
<td align="left"><code>h</code> æˆ– <code>?</code></td>
<td align="left">æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„å¿«æ·é”®åŠå…¶åŠŸèƒ½ï¼Œå¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°ä½¿ç”¨ <code>top</code>ã€‚</td>
</tr>
<tr>
<td align="left">æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯</td>
<td align="left"><code>A</code></td>
<td align="left">æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ï¼Œç¡®ä¿ä¸ä¼šé—æ¼ä»»ä½•é‡è¦ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td align="left">é€€å‡º <code>top</code></td>
<td align="left"><code>q</code></td>
<td align="left">é€€å‡º <code>top</code>ï¼Œè¿”å›åˆ°ç»ˆç«¯ã€‚</td>
</tr>
</tbody></table>
<h3 id="æ’æŸ¥-CPU-ä½¿ç”¨ç‡è¿‡é«˜"><a href="#æ’æŸ¥-CPU-ä½¿ç”¨ç‡è¿‡é«˜" class="headerlink" title="æ’æŸ¥ CPU ä½¿ç”¨ç‡è¿‡é«˜"></a>æ’æŸ¥ CPU ä½¿ç”¨ç‡è¿‡é«˜</h3><ol>
<li>å¯åŠ¨ <code>top</code>ã€‚</li>
<li>æŒ‰ä¸‹ <code>P</code> é”®ï¼ŒæŒ‰ CPU ä½¿ç”¨ç‡é™åºæ’åºã€‚</li>
<li>æŸ¥æ‰¾å ç”¨ CPU èµ„æºæœ€å¤šçš„è¿›ç¨‹ã€‚</li>
<li>å¦‚æœéœ€è¦ï¼Œå¯ä»¥æŒ‰ä¸‹ <code>c</code> é”®æŸ¥çœ‹å®Œæ•´å‘½ä»¤è¡Œï¼Œç¡®è®¤å…·ä½“è¿è¡Œçš„è„šæœ¬æˆ–å‚æ•°ã€‚</li>
<li>å¦‚æœéœ€è¦ç»ˆæ­¢è¯¥è¿›ç¨‹ï¼Œå¯ä»¥æŒ‰ä¸‹ <code>k</code> é”®ï¼Œè¾“å…¥è¿›ç¨‹ ID å¹¶ç¡®è®¤ã€‚</li>
</ol>
<h3 id="æ’æŸ¥å†…å­˜ä¸è¶³"><a href="#æ’æŸ¥å†…å­˜ä¸è¶³" class="headerlink" title="æ’æŸ¥å†…å­˜ä¸è¶³"></a>æ’æŸ¥å†…å­˜ä¸è¶³</h3><ol>
<li>å¯åŠ¨ <code>top</code>ã€‚</li>
<li>æŒ‰ä¸‹ <code>M</code> é”®ï¼ŒæŒ‰å†…å­˜ä½¿ç”¨ç‡é™åºæ’åºã€‚</li>
<li>æŸ¥æ‰¾å ç”¨å†…å­˜æœ€å¤šçš„è¿›ç¨‹ã€‚</li>
<li>å¦‚æœéœ€è¦ï¼Œå¯ä»¥æŒ‰ä¸‹ <code>c</code> é”®æŸ¥çœ‹å®Œæ•´å‘½ä»¤è¡Œï¼Œç¡®è®¤å…·ä½“è¿è¡Œçš„è„šæœ¬æˆ–å‚æ•°ã€‚</li>
<li>å¦‚æœéœ€è¦ç»ˆæ­¢è¯¥è¿›ç¨‹ï¼Œå¯ä»¥æŒ‰ä¸‹ <code>k</code> é”®ï¼Œè¾“å…¥è¿›ç¨‹ ID å¹¶ç¡®è®¤ã€‚</li>
</ol>
<h3 id="ç›‘æ§ç‰¹å®šç”¨æˆ·çš„è¿›ç¨‹"><a href="#ç›‘æ§ç‰¹å®šç”¨æˆ·çš„è¿›ç¨‹" class="headerlink" title="ç›‘æ§ç‰¹å®šç”¨æˆ·çš„è¿›ç¨‹"></a>ç›‘æ§ç‰¹å®šç”¨æˆ·çš„è¿›ç¨‹</h3><ol>
<li>å¯åŠ¨ <code>top</code>ã€‚</li>
<li>æŒ‰ä¸‹ <code>u</code> é”®ï¼Œè¾“å…¥ç”¨æˆ·åã€‚</li>
<li>æŸ¥çœ‹è¯¥ç”¨æˆ·è¿è¡Œçš„è¿›ç¨‹åŠå…¶èµ„æºä½¿ç”¨æƒ…å†µã€‚</li>
<li>å¦‚æœéœ€è¦ï¼Œå¯ä»¥æŒ‰ä¸‹ <code>c</code> é”®æŸ¥çœ‹å®Œæ•´å‘½ä»¤è¡Œï¼Œç¡®è®¤å…·ä½“è¿è¡Œçš„è„šæœ¬æˆ–å‚æ•°ã€‚</li>
</ol>
</body></html>]]></content>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸è§MQ</title>
    <url>/p/3a45e88c.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="ActiveMQ"><a href="#ActiveMQ" class="headerlink" title="ActiveMQ"></a>ActiveMQ</h2><p>æ¶ˆæ¯ä¸­é—´ä»¶æ¥å—å¹¶è½¬å‘æ¶ˆæ¯ã€‚ä½ å¯ä»¥æŠŠå®ƒå½“åšä¸€ä¸ªå¿«é€’ç«™ç‚¹ï¼Œå½“ä½ è¦å‘é€ä¸€ä¸ªåŒ…è£¹æ—¶ï¼Œä½ æŠŠä½ çš„åŒ…è£¹æ”¾åˆ°å¿«é€’ç«™ï¼Œå¿«é€’å‘˜æœ€ç»ˆä¼šæŠŠä½ çš„å¿«é€’é€åˆ°æ”¶ä»¶äººé‚£é‡Œï¼ŒæŒ‰ç…§è¿™ç§é€»è¾‘æ¶ˆæ¯ä¸­é—´ä»¶å°±æ˜¯ä¸€ä¸ªå¿«é€’ç«™ï¼Œä¸€ä¸ªå¿«é€’å‘˜å¸®ä½ ä¼ é€’å¿«ä»¶ã€‚å®ƒä¸å¿«é€’ç«™çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œå®ƒä¸å¤„ç†å¿«ä»¶è€Œæ˜¯æ¥æ”¶ï¼Œå­˜å‚¨å’Œè½¬å‘æ¶ˆæ¯æ•°æ®ã€‚</p>
<p><strong>ä¼˜ç‚¹</strong></p>
<p>å•æœºååé‡ä¸‡çº§ï¼Œæ—¶æ•ˆæ€§msçº§ï¼Œå¯ç”¨æ€§é«˜ï¼ŒåŸºäºä¸»ä»æ¶æ„å®ç°é«˜å¯ç”¨æ€§ï¼Œæ¶ˆæ¯å¯é æ€§è¾ƒä½çš„æ¦‚ç‡ä¸¢å¤±æ•°æ®ã€‚</p>
<p><strong>ç¼ºç‚¹</strong></p>
<p>å®˜æ–¹ç¤¾åŒºç°åœ¨å¯¹ActiveMQ 5.xç»´æŠ¤è¶Šæ¥è¶Šå°‘ï¼Œé«˜ååé‡åœºæ™¯è¾ƒå°‘ä½¿ç”¨ã€‚</p>
<h2 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h2><p>å¤§æ•°æ®çš„æ€æ‰‹é”ï¼Œè°ˆåˆ°å¤§æ•°æ®é¢†åŸŸå†…çš„æ¶ˆæ¯ä¼ è¾“ï¼Œåˆ™ç»•ä¸å¼€Kafkaï¼Œè¿™æ¬¾ä¸ºå¤§æ•°æ®è€Œç”Ÿçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œä»¥å…¶ç™¾ä¸‡çº§TPSçš„ååé‡åå£°å¤§å™ªï¼Œè¿…é€Ÿæˆä¸ºå¤§æ•°æ®é¢†åŸŸçš„å® å„¿ï¼Œåœ¨æ•°æ®é‡‡é›†ã€ä¼ è¾“ã€å­˜å‚¨çš„è¿‡ç¨‹ä¸­å‘æŒ¥ç€ä¸¾è¶³è½»é‡çš„ä½œç”¨ã€‚ç›®å‰å·²ç»è¢«LinkedInï¼ŒUber, Twitter, Netflixç­‰å¤§å…¬å¸æ‰€é‡‡çº³ã€‚</p>
<p><strong>ä¼˜ç‚¹</strong></p>
<p>æ€§èƒ½å“è¶Šï¼Œå•æœºå†™å…¥TPSçº¦åœ¨ç™¾ä¸‡æ¡/ç§’ï¼Œæœ€å¤§çš„ä¼˜ç‚¹ï¼Œå°±æ˜¯ååé‡é«˜ã€‚æ—¶æ•ˆæ€§msçº§å¯ç”¨æ€§éå¸¸é«˜ï¼Œkafkaæ˜¯åˆ†å¸ƒå¼çš„ï¼Œä¸€ä¸ªæ•°æ®å¤šä¸ªå‰¯æœ¬ï¼Œå°‘æ•°æœºå™¨å®•æœºï¼Œä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œä¸ä¼šå¯¼è‡´ä¸å¯ç”¨,æ¶ˆè´¹è€…é‡‡ç”¨Pullæ–¹å¼è·å–æ¶ˆæ¯, æ¶ˆæ¯æœ‰åº, é€šè¿‡æ§åˆ¶èƒ½å¤Ÿä¿è¯æ‰€æœ‰æ¶ˆæ¯è¢«æ¶ˆè´¹ä¸”ä»…è¢«æ¶ˆè´¹ä¸€æ¬¡;æœ‰ä¼˜ç§€çš„ç¬¬ä¸‰æ–¹Kafka Webç®¡ç†ç•Œé¢Kafka-Managerï¼›åœ¨æ—¥å¿—é¢†åŸŸæ¯”è¾ƒæˆç†Ÿï¼Œè¢«å¤šå®¶å…¬å¸å’Œå¤šä¸ªå¼€æºé¡¹ç›®ä½¿ç”¨ï¼›åŠŸèƒ½æ”¯æŒï¼šåŠŸèƒ½è¾ƒä¸ºç®€å•ï¼Œä¸»è¦æ”¯æŒç®€å•çš„MQåŠŸèƒ½ï¼Œåœ¨å¤§æ•°æ®é¢†åŸŸçš„å®æ—¶è®¡ç®—ä»¥åŠæ—¥å¿—é‡‡é›†è¢«å¤§è§„æ¨¡ä½¿ç”¨ã€‚</p>
<p><strong>ç¼ºç‚¹</strong></p>
<p>Kafkaå•æœºè¶…è¿‡64ä¸ªé˜Ÿåˆ—/åˆ†åŒºï¼ŒLoadä¼šå‘ç”Ÿæ˜æ˜¾çš„é£™é«˜ç°è±¡ï¼Œé˜Ÿåˆ—è¶Šå¤šï¼Œloadè¶Šé«˜ï¼Œå‘é€æ¶ˆæ¯å“åº”æ—¶é—´å˜é•¿ï¼Œä½¿ç”¨çŸ­è½®è¯¢æ–¹å¼ï¼Œå®æ—¶æ€§å–å†³äºè½®è¯¢é—´éš”æ—¶é—´ï¼Œæ¶ˆè´¹å¤±è´¥ä¸æ”¯æŒé‡è¯•ï¼›æ”¯æŒæ¶ˆæ¯é¡ºåºï¼Œä½†æ˜¯ä¸€å°ä»£ç†å®•æœºåï¼Œå°±ä¼šäº§ç”Ÿæ¶ˆæ¯ä¹±åºï¼Œç¤¾åŒºæ›´æ–°è¾ƒæ…¢ï¼›</p>
<h2 id="RocketMQ"><a href="#RocketMQ" class="headerlink" title="RocketMQ"></a>RocketMQ</h2><p>RocketMQ å‡ºè‡ªé˜¿é‡Œå·´å·´çš„å¼€æºäº§å“ï¼Œç”¨Javaè¯­è¨€å®ç°ï¼Œåœ¨è®¾è®¡æ—¶å‚è€ƒäº†Kafkaï¼Œå¹¶åšå‡ºäº†è‡ªå·±çš„ä¸€äº›æ”¹è¿›ã€‚è¢«é˜¿é‡Œå·´å·´å¹¿æ³›åº”ç”¨åœ¨è®¢å•ï¼Œäº¤æ˜“ï¼Œå……å€¼ï¼Œæµè®¡ç®—ï¼Œæ¶ˆæ¯æ¨é€ï¼Œæ—¥å¿—æµå¼å¤„ç†ï¼Œbinglogåˆ†å‘ç­‰åœºæ™¯ã€‚</p>
<p><strong>ä¼˜ç‚¹</strong></p>
<p>å•æœºååé‡åä¸‡çº§,å¯ç”¨æ€§éå¸¸é«˜ï¼Œåˆ†å¸ƒå¼æ¶æ„ï¼Œæ¶ˆæ¯å¯ä»¥åšåˆ°0ä¸¢å¤±ï¼ŒMQ åŠŸèƒ½è¾ƒä¸ºå®Œå–„ï¼Œè¿˜æ˜¯åˆ†å¸ƒå¼çš„ï¼Œæ‰©å±•æ€§å¥½ï¼Œæ”¯æŒ10äº¿çº§åˆ«çš„æ¶ˆæ¯å †ç§¯ï¼Œä¸ä¼šå› ä¸ºå †ç§¯å¯¼è‡´æ€§èƒ½ä¸‹é™,æºç æ˜¯ Java æˆ‘ä»¬å¯ä»¥è‡ªå·±é˜…è¯»æºç ï¼Œå®šåˆ¶è‡ªå·±å…¬å¸çš„ MQã€‚</p>
<p><strong>ç¼ºç‚¹</strong></p>
<p>æ”¯æŒçš„å®¢æˆ·ç«¯è¯­è¨€ä¸å¤šï¼Œç›®å‰æ˜¯JavaåŠc++ï¼Œå…¶ä¸­c++ä¸æˆç†Ÿï¼›ç¤¾åŒºæ´»è·ƒåº¦ä¸€èˆ¬ï¼Œæ²¡æœ‰åœ¨MQæ ¸å¿ƒä¸­å»å®ç°JMSç­‰æ¥å£ï¼Œæœ‰äº›ç³»ç»Ÿè¦è¿ç§»éœ€è¦ä¿®æ”¹å¤§é‡ä»£ç ã€‚</p>
<h2 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h2><p>2007å¹´å‘å¸ƒï¼Œæ˜¯ä¸€ä¸ªåœ¨AMQP(é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®)åŸºç¡€ä¸Šå®Œæˆçš„ï¼Œå¯å¤ç”¨çš„ä¼ä¸šæ¶ˆæ¯ç³»ç»Ÿï¼Œæ˜¯å½“å‰æœ€ä¸»æµçš„æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹ä¸€ã€‚</p>
<p><strong>ä¼˜ç‚¹</strong></p>
<p>ç”±äºerlangè¯­è¨€çš„é«˜å¹¶å‘ç‰¹æ€§ï¼Œæ€§èƒ½è¾ƒå¥½ï¼›ååé‡åˆ°ä¸‡çº§ï¼ŒMQåŠŸèƒ½æ¯”è¾ƒå®Œå¤‡,å¥å£®ã€ç¨³å®šã€æ˜“ç”¨ã€è·¨å¹³å°ã€æ”¯æŒå¤šç§è¯­è¨€å¦‚ï¼šPythonã€Rubyã€.NETã€Javaã€JMSã€Cã€PHPã€ActionScriptã€XMPPã€STOMP ç­‰ï¼Œæ”¯æŒAJAXæ–‡æ¡£é½å…¨ï¼›å¼€æºæä¾›çš„ç®¡ç†ç•Œé¢éå¸¸æ£’ï¼Œç”¨èµ·æ¥å¾ˆå¥½ç”¨,ç¤¾åŒºæ´»è·ƒåº¦é«˜ï¼›æ›´æ–°é¢‘ç‡ç›¸å½“é«˜ã€‚</p>
<p><strong>ç¼ºç‚¹</strong></p>
<p>æ€§èƒ½æ¯”Kafkaå·®è¿œäº†ã€‚erlang è¯­è¨€ã€‚</p>
<h2 id="å¦‚ä½•æ­£ç¡®é€‰æ‹©ä½¿ç”¨å“ªä¸ªMQï¼Ÿ"><a href="#å¦‚ä½•æ­£ç¡®é€‰æ‹©ä½¿ç”¨å“ªä¸ªMQï¼Ÿ" class="headerlink" title="å¦‚ä½•æ­£ç¡®é€‰æ‹©ä½¿ç”¨å“ªä¸ªMQï¼Ÿ"></a>å¦‚ä½•æ­£ç¡®é€‰æ‹©ä½¿ç”¨å“ªä¸ªMQï¼Ÿ</h2><p><strong>Kafka</strong></p>
<p>Kafkaä¸»è¦ç‰¹ç‚¹æ˜¯åŸºäºPullçš„æ¨¡å¼æ¥å¤„ç†æ¶ˆæ¯æ¶ˆè´¹ï¼Œè¿½æ±‚é«˜ååé‡ï¼Œä¸€å¼€å§‹çš„ç›®çš„å°±æ˜¯ç”¨äºæ—¥å¿—æ”¶é›†å’Œä¼ è¾“ï¼Œé€‚åˆäº§ç”Ÿ<strong>å¤§é‡æ•°æ®</strong>çš„äº’è”ç½‘æœåŠ¡çš„æ•°æ®æ”¶é›†ä¸šåŠ¡ã€‚<strong>å¤§å‹å…¬å¸</strong>å»ºè®®å¯ä»¥é€‰ç”¨ï¼Œå¦‚æœæœ‰<strong>æ—¥å¿—é‡‡é›†</strong>åŠŸèƒ½ï¼Œè‚¯å®šæ˜¯é¦–é€‰ kafkaäº†ã€‚</p>
<p><strong>RocketMQ</strong></p>
<p>å¤©ç”Ÿä¸º<strong>é‡‘èäº’è”ç½‘</strong>é¢†åŸŸè€Œç”Ÿï¼Œå¯¹äºå¯é æ€§è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ï¼Œå°¤å…¶æ˜¯ç”µå•†é‡Œé¢çš„è®¢å•æ‰£æ¬¾ï¼Œä»¥åŠä¸šåŠ¡å‰Šå³°ï¼Œåœ¨å¤§é‡äº¤æ˜“æ¶Œå…¥æ—¶ï¼Œåç«¯å¯èƒ½æ— æ³•åŠæ—¶å¤„ç†çš„æƒ…å†µã€‚RoketMQåœ¨ç¨³å®šæ€§ä¸Šå¯èƒ½æ›´å€¼å¾—ä¿¡èµ–ï¼Œè¿™äº›ä¸šåŠ¡åœºæ™¯åœ¨é˜¿é‡ŒåŒ11å·²ç»ç»å†äº†å¤šæ¬¡è€ƒéªŒï¼Œå¦‚æœä½ çš„ä¸šåŠ¡æœ‰ä¸Šè¿°å¹¶å‘åœºæ™¯ï¼Œå»ºè®®å¯ä»¥é€‰æ‹©RocketMQã€‚</p>
<p><strong>RabbitMQ</strong></p>
<p>ç»“åˆerlangè¯­è¨€æœ¬èº«çš„å¹¶å‘ä¼˜åŠ¿ï¼Œæ€§èƒ½å¥½<strong>æ—¶æ•ˆæ€§å¾®ç§’çº§</strong>ï¼Œç¤¾åŒºæ´»è·ƒåº¦ä¹Ÿæ¯”è¾ƒé«˜ï¼Œç®¡ç†ç•Œé¢ç”¨èµ·æ¥ååˆ†æ–¹ä¾¿ï¼Œå¦‚æœä½ çš„<strong>æ•°æ®é‡æ²¡æœ‰é‚£ä¹ˆå¤§</strong>ï¼Œä¸­å°å‹å…¬å¸ä¼˜å…ˆé€‰æ‹©åŠŸèƒ½æ¯”è¾ƒå®Œå¤‡çš„RabbitMQã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>æ¶ˆæ¯ä¸­é—´ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title>MQçš„ç›¸å…³æ¦‚å¿µ</title>
    <url>/p/e13d4c3.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="ä»€ä¹ˆæ˜¯MQï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯MQï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯MQï¼Ÿ"></a>ä»€ä¹ˆæ˜¯MQï¼Ÿ</h2><p>MQ(messagequeue)ï¼Œä»å­—é¢æ„æ€ä¸Šçœ‹ï¼Œæœ¬è´¨æ˜¯ä¸ªé˜Ÿåˆ—ï¼ŒFIFOå…ˆå…¥å…ˆå‡ºï¼Œåªä¸è¿‡é˜Ÿåˆ—ä¸­å­˜æ”¾çš„å†…å®¹æ˜¯messageè€Œå·²ï¼Œè¿˜æ˜¯ä¸€ç§è·¨è¿›ç¨‹çš„é€šä¿¡æœºåˆ¶ï¼Œç”¨äºä¸Šä¸‹æ¸¸ä¼ é€’æ¶ˆæ¯ã€‚åœ¨äº’è”ç½‘æ¶æ„ä¸­ï¼ŒMQæ˜¯ä¸€ç§éå¸¸å¸¸è§çš„ä¸Šä¸‹æ¸¸â€œé€»è¾‘è§£è€¦+ç‰©ç†è§£è€¦â€çš„æ¶ˆæ¯é€šä¿¡æœåŠ¡ã€‚ä½¿ç”¨äº†MQä¹‹åï¼Œæ¶ˆæ¯å‘é€ä¸Šæ¸¸åªéœ€è¦ä¾èµ–MQï¼Œä¸ç”¨ä¾èµ–å…¶ä»–æœåŠ¡ã€‚</p>
<p>æ¶ˆæ¯ä¸­é—´ä»¶æ¥å—å¹¶è½¬å‘æ¶ˆæ¯ã€‚ä½ å¯ä»¥æŠŠå®ƒå½“åšä¸€ä¸ªå¿«é€’ç«™ç‚¹ï¼Œå½“ä½ è¦å‘é€ä¸€ä¸ªåŒ…è£¹æ—¶ï¼Œä½ æŠŠä½ çš„åŒ…è£¹æ”¾åˆ°å¿«é€’ç«™ï¼Œå¿«é€’å‘˜æœ€ç»ˆä¼šæŠŠä½ çš„å¿«é€’é€åˆ°æ”¶ä»¶äººé‚£é‡Œï¼ŒæŒ‰ç…§è¿™ç§é€»è¾‘æ¶ˆæ¯ä¸­é—´ä»¶å°±æ˜¯ä¸€ä¸ªå¿«é€’ç«™ï¼Œä¸€ä¸ªå¿«é€’å‘˜å¸®ä½ ä¼ é€’å¿«ä»¶ã€‚å®ƒä¸å¿«é€’ç«™çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œå®ƒä¸å¤„ç†å¿«ä»¶è€Œæ˜¯æ¥æ”¶ï¼Œå­˜å‚¨å’Œè½¬å‘æ¶ˆæ¯æ•°æ®ã€‚</p>
<h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><p>1ã€ç”¨æˆ·æ³¨å†Œçš„æ¡ˆä¾‹ã€‚ç”¨æˆ·æ³¨å†Œ -&gt; æ³¨å†Œä¿¡æ¯å†™å…¥æ•°æ®åº“æˆåŠŸ(éœ€50ms) -&gt; å‘é€é‚®ä»¶(éœ€50ms) -&gt; å‘é€çŸ­ä¿¡(éœ€50ms) ï¼Œè¿™æ•´ä¸ªæ“ä½œåŒæ­¥æ‰§è¡Œçš„è¯ï¼Œé‚£ä¹ˆå“åº”éœ€è¦150msï¼›å¦‚æœæ”¹ä¸ºå¼‚æ­¥æ‰§è¡Œï¼Œå‘é€é‚®ä»¶å’ŒçŸ­ä¿¡å¤šçº¿ç¨‹å»æ‰§è¡Œï¼Œå¼€å¯çº¿ç¨‹çš„æ—¶é—´éœ€è¦50msï¼Œé‚£ä¹ˆå“åº”æ—¶é—´å°±éœ€è¦100msï¼Œä¸”å‘é€æ˜¯å¦æˆåŠŸæ˜¯ä¸å¥½å»ç›´æ¥åˆ¤æ–­çš„ï¼›å¦‚æœä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”¨æˆ·æ³¨å†Œ -&gt; æ³¨å†Œä¿¡æ¯å†™å…¥æ•°æ®åº“æˆåŠŸ(éœ€50ms)  -&gt; å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—(5ms) -&gt; å¼‚æ­¥å‘é€é‚®ä»¶å’ŒçŸ­ä¿¡ï¼Œæ•´ä¸ªå“åº”æ—¶é—´åªéœ€è¦55msï¼Œå…¶ä»–æœåŠ¡åœ¨ä»æ¶ˆæ¯é˜Ÿåˆ—æ‹¿åˆ°ç”¨æˆ·æ³¨å†ŒæˆåŠŸçš„æ¶ˆæ¯ï¼Œéšåå‘é€é‚®ä»¶å’ŒçŸ­ä¿¡ã€‚</p>
<p>2ã€åº”ç”¨è§£è€¦ã€‚ä»¥ä¸‹è®¢å•ä¸ºä¾‹ï¼Œç”¨æˆ·ä¸‹äº†ä¸€ä¸ªè®¢å•åï¼Œè®¢å•ç³»ç»Ÿä¼šè°ƒç”¨åº“å­˜ç³»ç»Ÿè¿›è¡Œå‡åº“å­˜ï¼Œä¸‹è®¢å•æ—¶ä¼ äº†3ä¸ªå‚æ•°ï¼Œè°ƒç”¨åº“å­˜ç³»ç»ŸAPIæ—¶ä¼ äº†5ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°ä¸å˜è¿˜å¥½ï¼Œä½†æ˜¯è®¢å•ç³»ç»Ÿå’Œåº“å­˜ç³»ç»Ÿç»å¸¸ä¼šå‡çº§ï¼Œå‡åº“å­˜çš„æ¥å£ä¼šç»å¸¸å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆè®¢å•ç³»ç»Ÿå°±å¿…é¡»æ¥ä¿®æ”¹å¯¹åº”è°ƒç”¨ä»£ç å¹¶è¿›è¡Œé‡æ–°éƒ¨ç½²ã€‚è¿™æ ·ä¼šéå¸¸çš„éº»çƒ¦ï¼Œå¼•å…¥æ¶ˆæ¯é˜Ÿä¹‹åï¼Œè®¢å•ç³»ç»Ÿåªéœ€è¦æŠŠå«æœ‰â€è°ä¹°äº†å¤šå°‘ä¸ªä»€ä¹ˆå•†å“â€å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—å³å¯ï¼Œä¸ç”¨å…³å¿ƒåº“å­˜ç³»ç»Ÿçš„æ¥å£ï¼Œåº“å­˜ç³»ç»Ÿå®æ—¶è®¢é˜…æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåªè¦æœ‰æ¶ˆæ¯ï¼Œåº“å­˜ç³»ç»Ÿå°±ä¼šæ”¶åˆ°è¿™ä¸ªæ¶ˆæ¯ï¼Œå®Œæˆä¸šåŠ¡é€»è¾‘ã€‚</p>
<p>3ã€æµé‡æ§åˆ¶ï¼ˆå‰Šå³°ï¼‰ã€‚ä»¥ç§’æ€å•†å“ä¸ºä¾‹ï¼Œåœ¨å¼€å¯ç§’æ€çš„ä¸€ç¬é—´å‡è®¾æœ‰100ä¸‡ä¸ªè¯·æ±‚ï¼Œå°±ç®—æœåŠ¡å™¨èƒ½å¤Ÿæ¥æ”¶è¿™ä¹ˆå¤šè¯·æ±‚ï¼Œè¦æ‰§è¡Œä¸‹è®¢å•ç­‰ä¸€ç³»åˆ—ä¸šåŠ¡ä»£ç ï¼Œåå°å°±ä¼šéå¸¸æ…¢ï¼Œå¯¼è‡´è¯·æ±‚ä¸€ç›´é˜»å¡ç›´åˆ°æœåŠ¡å™¨å®•æœºã€‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä¹‹åï¼Œå¤§é‡è¯·æ±‚è¿›æ¥åï¼Œå…¨éƒ¨å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå†™å…¥æˆåŠŸä¹‹åç›´æ¥å“åº”ç”¨æˆ·ï¼Œå…¶å®ƒæœåŠ¡å†æŒ¨ä¸ªæŒ¨ä¸ªçš„ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯åæ‰§è¡Œä¸šåŠ¡ä»£ç ï¼Œå°±ç®—åå°å¤„ç†èƒ½åŠ›åªæœ‰1så¤„ç†ä¸€ä¸ªï¼Œå¤§ä¸äº†èŠ±è´¹100ä¸‡ç§’å°±è¡Œäº†ï¼Œæ°¸è¿œä¸ä¼šè®©æœºå™¨å®•æœºã€‚</p>
<p>4ã€å¼‚æ­¥å¤„ç†ã€‚æœ‰äº›æœåŠ¡é—´è°ƒç”¨æ˜¯å¼‚æ­¥çš„ï¼Œä¾‹å¦‚Aè°ƒç”¨Bï¼ŒBéœ€è¦èŠ±è´¹å¾ˆé•¿æ—¶é—´æ‰§è¡Œï¼Œä½†æ˜¯Aéœ€è¦çŸ¥é“Bä»€ä¹ˆæ—¶å€™å¯ä»¥æ‰§è¡Œå®Œï¼Œä»¥å‰ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼ŒAè¿‡ä¸€æ®µæ—¶é—´å»è°ƒç”¨Bçš„æŸ¥è¯¢apiæŸ¥è¯¢ã€‚æˆ–è€…Aæä¾›ä¸€ä¸ªcallback apiï¼ŒBæ‰§è¡Œå®Œä¹‹åè°ƒç”¨apié€šçŸ¥AæœåŠ¡ã€‚è¿™ä¸¤ç§æ–¹å¼éƒ½ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œä½¿ç”¨æ¶ˆæ¯æ€»çº¿ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒAè°ƒç”¨BæœåŠ¡åï¼Œåªéœ€è¦ç›‘å¬Bå¤„ç†å®Œæˆçš„æ¶ˆæ¯ï¼Œå½“Bå¤„ç†å®Œæˆåï¼Œä¼šå‘é€ä¸€æ¡æ¶ˆæ¯ç»™MQï¼ŒMQä¼šå°†æ­¤æ¶ˆæ¯è½¬å‘ç»™AæœåŠ¡ã€‚è¿™æ ·AæœåŠ¡æ—¢ä¸ç”¨å¾ªç¯è°ƒç”¨Bçš„æŸ¥è¯¢apiï¼Œä¹Ÿä¸ç”¨æä¾›callback apiã€‚åŒæ ·BæœåŠ¡ä¹Ÿä¸ç”¨åšè¿™äº›æ“ä½œã€‚AæœåŠ¡è¿˜èƒ½åŠæ—¶çš„å¾—åˆ°å¼‚æ­¥å¤„ç†æˆåŠŸçš„æ¶ˆæ¯ã€‚</p>
<p><img src="/p/e13d4c3/MQ-%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86%E5%AE%8C%E6%88%90%E9%80%9A%E7%9F%A5%E6%B5%81%E7%A8%8B.png" alt="image-20210619134102517"></p>
<h2 id="MQæ˜¯æ¶ˆæ¯é€šä¿¡çš„æ¨¡å‹"><a href="#MQæ˜¯æ¶ˆæ¯é€šä¿¡çš„æ¨¡å‹" class="headerlink" title="MQæ˜¯æ¶ˆæ¯é€šä¿¡çš„æ¨¡å‹"></a>MQæ˜¯æ¶ˆæ¯é€šä¿¡çš„æ¨¡å‹</h2><p>å®ç°MQçš„å¤§è‡´æœ‰ä¸¤ç§ä¸»æµæ–¹å¼ï¼šAMQPã€JMSã€‚</p>
<h2 id="AMQP"><a href="#AMQP" class="headerlink" title="AMQP"></a>AMQP</h2><p>AMQPé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼Œæ˜¯ä¸€ä¸ª<strong>è¿›ç¨‹é—´ä¼ é€’å¼‚æ­¥æ¶ˆæ¯çš„ç½‘ç»œåè®®</strong>ï¼Œæ›´å‡†ç¡®çš„è¯´æ˜¯ä¸€ç§binary wire-level protocolï¼ˆé“¾æ¥åè®®ï¼‰ã€‚è¿™æ˜¯å…¶å’ŒJMSçš„æœ¬è´¨å·®åˆ«ï¼ŒAMQPä¸ä»APIå±‚è¿›è¡Œé™å®šï¼Œè€Œæ˜¯ç›´æ¥å®šä¹‰ç½‘ç»œäº¤æ¢çš„æ•°æ®æ ¼å¼ã€‚</p>
<h2 id="JMS"><a href="#JMS" class="headerlink" title="JMS"></a>JMS</h2><p>JMSå³Javaæ¶ˆæ¯æœåŠ¡ï¼ˆJavaMessage Serviceï¼‰åº”ç”¨ç¨‹åºæ¥å£ï¼Œæ˜¯ä¸€ä¸ªJavaå¹³å°ä¸­å…³äºé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆMOMï¼‰çš„APIï¼Œç”¨äºåœ¨ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´ï¼Œæˆ–åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‘é€æ¶ˆæ¯ï¼Œè¿›è¡Œå¼‚æ­¥é€šä¿¡ã€‚</p>
<h2 id="AMQP-ä¸-JMS-åŒºåˆ«"><a href="#AMQP-ä¸-JMS-åŒºåˆ«" class="headerlink" title="AMQP ä¸ JMS åŒºåˆ«"></a>AMQP ä¸ JMS åŒºåˆ«</h2><p>JMSæ˜¯å®šä¹‰äº†ç»Ÿä¸€çš„æ¥å£ï¼Œæ¥å¯¹æ¶ˆæ¯æ“ä½œè¿›è¡Œç»Ÿä¸€ï¼›AMQPæ˜¯é€šè¿‡è§„å®šåè®®æ¥ç»Ÿä¸€æ•°æ®äº¤äº’çš„æ ¼å¼ã€‚</p>
<p>JMSé™å®šäº†å¿…é¡»ä½¿ç”¨Javaè¯­è¨€ï¼›AMQPåªæ˜¯åè®®ï¼Œä¸è§„å®šå®ç°æ–¹å¼ï¼Œå› æ­¤æ˜¯è·¨è¯­è¨€çš„ã€‚</p>
<p>JMSè§„å®šäº†ä¸¤ç§æ¶ˆæ¯æ¨¡å¼ï¼›è€ŒAMQPçš„æ¶ˆæ¯æ¨¡å¼æ›´åŠ ä¸°å¯Œã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>æ¶ˆæ¯ä¸­é—´ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMQå¤‡ä»½äº¤æ¢æœº</title>
    <url>/p/ad15fb59.html</url>
    <content><![CDATA[<html><head></head><body><p>â€‹        é€šè¿‡æ¶ˆæ¯å›é€€æœºåˆ¶å’Œmandatoryå‚æ•°ï¼Œå¯ä»¥å¤„ç†äº¤æ¢æœºæŠ•é€’å¤±è´¥çš„æ¶ˆæ¯ã€‚</p>
<p>â€‹        æ¶ˆæ¯å›é€€åˆ°ç”Ÿäº§è€…åï¼Œæœ‰æ—¶å€™å¹¶ä¸çŸ¥é“è¯¥å¦‚ä½•å¤„ç†è¿™äº›æ— æ³•è·¯ç”±çš„æ¶ˆæ¯ï¼Œæœ€å¤šå°±æ˜¯æ‰“ä¸ªæ—¥å¿—ï¼Œå­˜åˆ°ç¼“å­˜å®šæ—¶æŠ•é€’ï¼Œè¶…å‡ºæŠ•é€’å¤±è´¥æ¬¡æ•°è¿›è¡ŒæŠ¥è­¦ï¼Œå†æ‰‹åŠ¨å¤„ç†ï¼Œæ‰‹åŠ¨çš„é€šç—…å°±æ˜¯éº»çƒ¦æ˜“å‡ºé”™ã€‚æ­¤å¤–ï¼Œç”Ÿäº§è€…ä¸æ­¢ä¸€å°æœºå™¨ï¼Œé‚£ä¹ˆæ¯å°éƒ½éœ€è¦å†™å¤„ç†è¿™äº›å›é€€æ¶ˆæ¯çš„é€»è¾‘ä»£ç ï¼Œåè€Œå¢åŠ äº†ç”Ÿäº§è€…çš„å¤æ‚æ€§ã€‚</p>
<blockquote>
<p><strong>é‚£ä¹ˆæ—¢ä¸ä¸¢å¤±æ¶ˆæ¯ï¼Œåˆä¸å¢åŠ ç”Ÿäº§è€…çš„å¤æ‚æ€§ï¼Œè¯¥æ€ä¹ˆåšï¼Ÿ</strong></p>
</blockquote>
<p>â€‹        å¯ä»¥ä¸ºé˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœºæ¥å­˜å‚¨æŠ•é€’å¤±è´¥çš„æ¶ˆæ¯ï¼Œå¯æ˜¯è¿™äº›ä¸å¯è·¯ç”±æ¶ˆæ¯æ ¹æœ¬æ²¡æœ‰æœºä¼šè¿›å…¥åˆ°é˜Ÿåˆ—ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—æ¥ä¿å­˜æ¶ˆæ¯ã€‚åœ¨ RabbitMQ ä¸­ï¼Œæœ‰ä¸€ç§å¤‡ä»½äº¤æ¢æœºçš„æœºåˆ¶å­˜åœ¨ï¼Œå¯ä»¥å¾ˆå¥½çš„åº”å¯¹è¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 id="å¤‡ä»½äº¤æ¢æœº"><a href="#å¤‡ä»½äº¤æ¢æœº" class="headerlink" title="å¤‡ä»½äº¤æ¢æœº"></a>å¤‡ä»½äº¤æ¢æœº</h2><p>â€‹        å¤‡ä»½äº¤æ¢æœºå¯ä»¥ç†è§£ä¸º RabbitMQ ä¸­äº¤æ¢æœºçš„â€œå¤‡èƒâ€ï¼Œå½“æˆ‘ä»¬ä¸ºæŸä¸€ä¸ªäº¤æ¢æœºå£°æ˜ä¸€ä¸ªå¯¹åº”çš„å¤‡ä»½äº¤æ¢æœºæ—¶ï¼Œå°±æ˜¯ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªå¤‡èƒï¼Œå½“äº¤æ¢æœºæ¥æ”¶åˆ°ä¸€æ¡ä¸å¯è·¯ç”±æ¶ˆæ¯æ—¶ï¼Œå°†ä¼šæŠŠè¿™æ¡æ¶ˆæ¯è½¬å‘åˆ°å¤‡ä»½äº¤æ¢æœºä¸­ï¼Œç”±å¤‡ä»½äº¤æ¢æœºæ¥è¿›è¡Œè½¬å‘å’Œå¤„ç†ï¼Œé€šå¸¸å¤‡ä»½äº¤æ¢æœºçš„ç±»å‹ä¸º Fanout ï¼Œè¿™æ ·å°±èƒ½æŠŠæ‰€æœ‰æ¶ˆæ¯éƒ½æŠ•é€’åˆ°ä¸å…¶ç»‘å®šçš„é˜Ÿåˆ—ä¸­ï¼Œç„¶åæˆ‘ä»¬åœ¨å¤‡ä»½äº¤æ¢æœºä¸‹ç»‘å®šä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™æ ·æ‰€æœ‰é‚£äº›åŸäº¤æ¢æœºæ— æ³•è¢«è·¯ç”±çš„æ¶ˆæ¯ï¼Œå°±ä¼šéƒ½è¿›å…¥è¿™ä¸ªé˜Ÿåˆ—äº†ã€‚ å½“ç„¶ï¼Œè¿˜å¯ä»¥å»ºç«‹ä¸€ä¸ªæŠ¥è­¦é˜Ÿåˆ—ï¼Œç”¨ç‹¬ç«‹çš„æ¶ˆè´¹è€…æ¥è¿›è¡Œç›‘æµ‹å’ŒæŠ¥è­¦ã€‚</p>
<h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>â€‹        æ–°å¢ä¸€ä¸ªå¤‡ä»½äº¤æ¢æœºï¼Œç»‘å®šåœ¨ confirm.exchange ä¸Šï¼Œå½“ confirm.exchange æŠ•é€’æ¶ˆæ¯åˆ°é˜Ÿåˆ—å¤±è´¥åï¼Œå°†äº¤ç»™å¤‡ä»½äº¤æ¢æœºæ¥æŠ•é€’æ¶ˆæ¯ï¼Œè®¾ç½®äº¤æ¢æœºç±»å‹ä¸º fanoutï¼Œæœ‰ä¸¤ä¸ªé˜Ÿåˆ— backup.queueï¼Œè¿˜æœ‰ä¸€ä¸ªæŠ¥è­¦é˜Ÿåˆ—ç”¨æ¥å‘ŠçŸ¥æˆ‘ä»¬å­˜åœ¨å¼‚å¸¸æƒ…å†µã€‚</p>
<p><img src="/p/ad15fb59/RabbitMQ-%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A4%87%E4%BB%BD%E6%96%B9%E6%A1%88.png" alt="image-20210626155027879"></p>
<p>ConfirmConfig æ–°å¢é…ç½®</p>
<p>ä¿®æ”¹ confirm.exchange çš„ä»£ç ï¼Œç»‘å®šä¸Šå¤‡ä»½äº¤æ¢æœºï¼Œå£°æ˜å…¶å®ƒç»„ä»¶ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‘å¸ƒç¡®è®¤æœºåˆ¶-ç¤ºä¾‹ä½¿ç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">"confirm.queue"</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">"confirm.exchange"</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ROUTING_KEY_CONFIRM</span> <span class="operator">=</span> <span class="string">"confirm.routing"</span>;</span><br><span class="line"><span class="comment">/** å¤‡ä»½äº¤æ¢æœºå¸¸é‡ */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">CONFIRM_BACKUP_EXCHANGE</span> <span class="operator">=</span> <span class="string">"backup.exchange"</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">CONFIRM_BACKUP_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">"backup.queue"</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">CONFIRM_WARNING_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">"warning.queue"</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean(CONFIRM_EXCHANGE_NAME)</span></span><br><span class="line"><span class="keyword">public</span> DirectExchange <span class="title function_">confirmExchange</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> ExchangeBuilder.directExchange(CONFIRM_EXCHANGE_NAME)</span><br><span class="line">        .durable(<span class="literal">true</span>)</span><br><span class="line">        <span class="comment">// è®¾ç½®å¤‡ä»½äº¤æ¢æœº</span></span><br><span class="line">        .alternate(CONFIRM_BACKUP_EXCHANGE)</span><br><span class="line">        .build();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤‡ä»½äº¤æ¢æœº</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean(CONFIRM_BACKUP_EXCHANGE)</span></span><br><span class="line"><span class="keyword">public</span> FanoutExchange <span class="title function_">backupExchange</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FanoutExchange</span>(CONFIRM_BACKUP_EXCHANGE);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å£°æ˜å¤‡ä»½é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean(CONFIRM_BACKUP_QUEUE_NAME)</span></span><br><span class="line"><span class="keyword">public</span> Queue <span class="title function_">backupQueue</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> QueueBuilder.durable(CONFIRM_BACKUP_QUEUE_NAME).build();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å£°æ˜è­¦å‘Šé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean(CONFIRM_WARNING_QUEUE_NAME)</span></span><br><span class="line"><span class="keyword">public</span> Queue <span class="title function_">warnQueue</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> QueueBuilder.durable(CONFIRM_WARNING_QUEUE_NAME).build();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤‡ä»½é˜Ÿåˆ—ç»‘å®šå¤‡ä»½äº¤æ¢æœº</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Binding <span class="title function_">backupQueueBindingExchange</span><span class="params">(<span class="meta">@Qualifier(CONFIRM_BACKUP_QUEUE_NAME)</span> Queue queue,</span></span><br><span class="line"><span class="params">                                          <span class="meta">@Qualifier(CONFIRM_BACKUP_EXCHANGE)</span> FanoutExchange exchange)</span> {</span><br><span class="line">    <span class="keyword">return</span> BindingBuilder.bind(queue).to(exchange);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŠ¥è­¦é˜Ÿåˆ—ç»‘å®šå¤‡ä»½äº¤æ¢æœº</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Binding <span class="title function_">warnQueueBindingExchange</span><span class="params">(<span class="meta">@Qualifier(CONFIRM_WARNING_QUEUE_NAME)</span> Queue queue,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@Qualifier(CONFIRM_BACKUP_EXCHANGE)</span> FanoutExchange exchange)</span> {</span><br><span class="line">    <span class="keyword">return</span> BindingBuilder.bind(queue).to(exchange);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç”Ÿäº§è€…æ–°å¢æµ‹è¯•æ–¹æ³•</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºå¤±è´¥ï¼Œç”±å¤‡ä»½äº¤æ¢æœºæŠ•é€’æ¶ˆæ¯.</span></span><br><span class="line"><span class="comment"> * NoSuchRoutingKey æ˜¯ä¸€ä¸ªä¸å­˜åœ¨çš„è·¯ç”±é”®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping("/sendFailMsg/{msg}")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendFailMsg</span><span class="params">(<span class="meta">@PathVariable("msg")</span> String msg)</span> {</span><br><span class="line">    <span class="type">CorrelationData</span> <span class="variable">correlationData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(UUID.randomUUID().toString());</span><br><span class="line">    rabbitTemplate.convertAndSend(MqConstant.CONFIRM_EXCHANGE_NAME, <span class="string">"NoSuchRoutingKey"</span>, msg, correlationData);</span><br><span class="line">    log.info(<span class="string">"å‘é€æ¶ˆæ¯æˆåŠŸï¼Œæ¶ˆæ¯å†…å®¹ï¼š{}"</span>, msg);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹å¤‡ä»½é˜Ÿåˆ—çš„æ¶ˆæ¯ã€æ¶ˆè´¹è­¦å‘Šé˜Ÿåˆ—çš„æ¶ˆæ¯ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = {CONFIRM_BACKUP_QUEUE_NAME})</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveBackupMessage</span><span class="params">(Message message, Channel channel)</span>{</span><br><span class="line">    log.info(<span class="string">"æ¥æ”¶åˆ°æ— æ³•æŠ•é€’çš„æ¶ˆæ¯ä¸ºï¼š{}"</span>, <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = {CONFIRM_WARNING_QUEUE_NAME})</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveWarnMessage</span><span class="params">(Message message, Channel channel)</span>{</span><br><span class="line">    log.warn(<span class="string">"æ¥æ”¶åˆ°æ— æ³•æŠ•é€’çš„æ¶ˆæ¯ä¸ºï¼š{}"</span>, <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰§è¡Œç»“æœ</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">----------------------------- ç”Ÿäº§è€…æ—¥å¿— --------------------------------</span><br><span class="line">2021-06-26 17:31:30.126  INFO 156 --- [nio-8005-exec-1] c.f.t.r.p.boot.ConfirmMessageProducer    : å‘é€æ¶ˆæ¯æˆåŠŸï¼Œæ¶ˆæ¯å†…å®¹ï¼šhello</span><br><span class="line">2021-06-26 17:31:30.131  INFO 156 --- [nectionFactory1] c.f.t.r.p.boot.ConfirmMessageCallback    : äº¤æ¢æœºå·²æ”¶åˆ° id=1ef4f524-81e2-4f43-a8e1-d2b0969da0c1 çš„æ¶ˆæ¯</span><br><span class="line">----------------------------- æ¶ˆè´¹è€…æ—¥å¿— ------------------------------</span><br><span class="line">2021-06-26 17:31:30.132  WARN 21284 --- [ntContainer] c.f.t.r.c.boot.ConfirmMessageConsumer    : æ¥æ”¶åˆ°æ— æ³•æŠ•é€’çš„æ¶ˆæ¯ä¸ºï¼šhello</span><br><span class="line">2021-06-26 17:31:30.132  INFO 21284 --- [ntContainer] c.f.t.r.c.boot.ConfirmMessageConsumer    : æ¥æ”¶åˆ°æ— æ³•æŠ•é€’çš„æ¶ˆæ¯ä¸ºï¼šhello</span><br></pre></td></tr></tbody></table></figure>

<p><strong>æ—¥å¿—ä¸­ç¼ºå°‘äº†å›é€€æ–¹æ³•ä¸­çš„æ—¥å¿—æ‰“å°ï¼Œä¸ºä»€ä¹ˆä¹‹å‰é…ç½®çš„å›é€€æ–¹æ³•æ²¡æœ‰å›è°ƒï¼Ÿ</strong></p>
<p>mandatory å‚æ•°ä¸å¤‡ä»½äº¤æ¢æœºå¯ä»¥ä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœä¸¤è€…åŒæ—¶å¼€å¯ï¼Œå¤‡ä»½äº¤æ¢æœºçš„ä¼˜å…ˆçº§æ›´é«˜ã€‚  </p>
</body></html>]]></content>
      <tags>
        <tag>æ¶ˆæ¯ä¸­é—´ä»¶</tag>
        <tag>RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ-RabbitMQæ­»ä¿¡é˜Ÿåˆ—</title>
    <url>/p/c4df0303.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="æ­»ä¿¡çš„æ¦‚å¿µ"><a href="#æ­»ä¿¡çš„æ¦‚å¿µ" class="headerlink" title="æ­»ä¿¡çš„æ¦‚å¿µ"></a>æ­»ä¿¡çš„æ¦‚å¿µ</h2><p>æ­»ä¿¡ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æ— æ³•è¢«æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œå­—é¢æ„æ€å¯ä»¥è¿™æ ·ç†è§£ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œproducer å°†æ¶ˆæ¯æŠ•é€’åˆ° broker æˆ–è€…ç›´æ¥åˆ° queue é‡Œäº†ï¼Œconsumer ä» queue å–å‡ºæ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼Œä½†æŸäº›æ—¶å€™ç”±äºç‰¹å®šçš„<strong>åŸå› å¯¼è‡´</strong> <strong>queue</strong> <strong>ä¸­çš„æŸäº›æ¶ˆæ¯æ— æ³•è¢«æ¶ˆè´¹</strong>ï¼Œè¿™æ ·çš„æ¶ˆæ¯å¦‚æœæ²¡æœ‰åç»­çš„å¤„ç†ï¼Œå°±å˜æˆäº†æ­»ä¿¡ï¼Œæœ‰æ­»ä¿¡è‡ªç„¶å°±æœ‰äº†æ­»ä¿¡é˜Ÿåˆ—ã€‚</p>
<p>â€‹        åº”ç”¨åœºæ™¯ï¼šä¸ºäº†ä¿è¯è®¢å•ä¸šåŠ¡çš„æ¶ˆæ¯æ•°æ®ä¸ä¸¢å¤±ï¼Œéœ€è¦ä½¿ç”¨åˆ° RabbitMQ çš„æ­»ä¿¡é˜Ÿåˆ—æœºåˆ¶ï¼Œå½“æ¶ˆæ¯æ¶ˆè´¹å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå°†æ¶ˆæ¯æŠ•å…¥æ­»ä¿¡é˜Ÿåˆ—ä¸­ã€‚è¿˜æœ‰æ¯”å¦‚è¯´ï¼šç”¨æˆ·åœ¨å•†åŸä¸‹å•æˆåŠŸå¹¶ç‚¹å‡»å»æ”¯ä»˜ååœ¨æŒ‡å®šæ—¶é—´æœªæ”¯ä»˜æ—¶è‡ªåŠ¨å¤±æ•ˆã€‚</p>
<h2 id="æ­»ä¿¡çš„æ¥æº"><a href="#æ­»ä¿¡çš„æ¥æº" class="headerlink" title="æ­»ä¿¡çš„æ¥æº"></a>æ­»ä¿¡çš„æ¥æº</h2><p>1ã€æ¶ˆæ¯ TTL è¿‡æœŸã€‚</p>
<p>2ã€é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦(é˜Ÿåˆ—æ»¡äº†ï¼Œæ— æ³•å†æ·»åŠ æ•°æ®åˆ° mq ä¸­)ã€‚</p>
<p>3ã€æ¶ˆæ¯è¢«æ‹’ç»(basic.reject æˆ– basic.nack)å¹¶ä¸” æ¶ˆæ¯ä¸é‡æ–°æ”¾å›å¯¹å’ï¼ˆrequeue=falseï¼‰ã€‚</p>
<h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><p>â€‹        ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ° normal_Exchangeäº¤æ¢æœºï¼Œäº¤æ¢æœºæ ¹æ® normalRoutingKey è·¯ç”±é”®å‘é€åˆ° normalQueue é˜Ÿåˆ—ï¼Œå½“æ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­ ttl è¶…è¿‡10såï¼Œæ¶ˆæ¯ç§°ä¸ºæ­»ä¿¡ï¼Œè½¬å‘åˆ°dead-exchange äº¤æ¢æœºï¼Œäº¤æ¢æœºæ ¹æ® deadRoutingKey è·¯ç”±é”®å‘é€åˆ° deadQueue é˜Ÿåˆ—ã€‚</p>
<p>â€‹        æ¶ˆè´¹è€…1è´Ÿè´£æ¶ˆè´¹æ¶ˆæ¯æ­£å¸¸çš„é˜Ÿåˆ—ï¼Œé¦–å…ˆå¼€å¯åˆ›å»ºå‡ºäº¤æ¢æœºã€é˜Ÿåˆ—ä¹‹é—´çš„å…³ç³»ï¼Œä¹‹åå…³é—­è¯¥æ¶ˆè´¹è€…ï¼Œéšåè¿è¡Œç”Ÿäº§è€…ï¼Œè§‚å¯ŸRabbitMQå›¾å½¢åŒ–ç•Œé¢æ­£å¸¸çš„æ¶ˆæ¯ ttl è¿‡æœŸåè¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ã€‚</p>
<p>â€‹        æ¶ˆè´¹è€…2åªè´Ÿè´£æ¶ˆè´¹æ­»ä¿¡é˜Ÿåˆ—ã€‚</p>
<p><img src="/p/c4df0303/RabbitMQ-%E6%B6%88%E6%81%AF%E8%BD%AC%E4%B8%BA%E6%AD%BB%E4%BF%A1%E6%B5%81%E7%A8%8B.png" alt="image-20210621230631642"></p>
<h3 id="æƒ…å†µ1ï¼šæ¶ˆæ¯TTLè¿‡æœŸ"><a href="#æƒ…å†µ1ï¼šæ¶ˆæ¯TTLè¿‡æœŸ" class="headerlink" title="æƒ…å†µ1ï¼šæ¶ˆæ¯TTLè¿‡æœŸ"></a>æƒ…å†µ1ï¼šæ¶ˆæ¯TTLè¿‡æœŸ</h3><p>åº”ç”¨åœºæ™¯å¦‚è®¢å•è¿‡æœŸï¼Œè®¢å•åœ¨10åˆ†é’Ÿå†…æœªæ”¯ä»˜åå–æ¶ˆè®¢å•ã€‚10åˆ†é’Ÿttlè¿‡æœŸçš„æ¶ˆæ¯è½¬ä¸ºæ­»ä¿¡ï¼Œè®©ä¸“é—¨æ¶ˆè´¹æ­»ä¿¡é˜Ÿåˆ—çš„æ¶ˆè´¹è€…å»å¤„ç†è¿™äº›è¿‡æœŸçš„è®¢å•ã€‚</p>
<p><strong>æ¶ˆè´¹è€…1</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageDeadConsumer1</span> {</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">"normal"</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">"normalExchange"</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ROUTING_KEY_NORMAL</span> <span class="operator">=</span> <span class="string">"normalRouting"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">"dead"</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">"deadExchange"</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">ROUTING_KEY_DEAD</span> <span class="operator">=</span> <span class="string">"deadRouting"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">"192.168.19.128"</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// ç»‘å®šäº¤æ¢æœº</span></span><br><span class="line">        channel.exchangeDeclare(NORMAL_EXCHANGE_NAME, BuiltinExchangeType.DIRECT);</span><br><span class="line">        channel.exchangeDeclare(DEAD_EXCHANGE_NAME, BuiltinExchangeType.DIRECT);</span><br><span class="line">        <span class="comment">// æ·»åŠ æ­»ä¿¡é˜Ÿåˆ—å‚æ•°</span></span><br><span class="line">        Map&lt;String, Object&gt; arguments = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">        arguments.put(<span class="string">"x-dead-letter-exchange"</span>, DEAD_EXCHANGE_NAME);</span><br><span class="line">        arguments.put(<span class="string">"x-dead-letter-routing-key"</span>, ROUTING_KEY_DEAD);</span><br><span class="line">        <span class="comment">// ç»‘å®šé˜Ÿåˆ—</span></span><br><span class="line">        channel.queueDeclare(DEAD_QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// æ­£å¸¸é˜Ÿåˆ—å°†å¼‚å¸¸æ¶ˆæ¯ï¼ˆttlå¤±æ•ˆã€æ¶ˆæ¯è¢«æ‹’ç»ã€é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦ï¼‰è½¬åˆ°æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueDeclare(NORMAL_QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, arguments);</span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—ç»‘å®šäº¤æ¢æœºå’Œè·¯ç”±é”®</span></span><br><span class="line">        channel.queueBind(DEAD_QUEUE_NAME, DEAD_EXCHANGE_NAME, ROUTING_KEY_DEAD);</span><br><span class="line">        channel.queueBind(NORMAL_QUEUE_NAME, NORMAL_EXCHANGE_NAME, ROUTING_KEY_NORMAL);</span><br><span class="line">        System.out.println(<span class="string">"ç­‰å¾…æ¥æ”¶æ¶ˆæ¯..."</span>);</span><br><span class="line">        <span class="comment">// æ¥æ”¶åˆ°æ¶ˆæ¯åè§¦å‘å›è°ƒ</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, delivery) -&gt; {</span><br><span class="line">            <span class="type">byte</span>[] msgBytes = delivery.getBody();</span><br><span class="line">            System.out.println(<span class="string">"æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šæ¶ˆæ¯ID="</span> + consumerTag + <span class="string">"===&gt;"</span> + <span class="keyword">new</span> <span class="title class_">String</span>(msgBytes));</span><br><span class="line">        };</span><br><span class="line">        <span class="comment">// æ¶ˆæ¯æ¶ˆè´¹è¢«ä¸­æ–­ï¼ˆå–æ¶ˆï¼‰</span></span><br><span class="line">        <span class="type">CancelCallback</span> <span class="variable">cancelCallback</span> <span class="operator">=</span> consumerTag -&gt; {</span><br><span class="line">            System.out.println(<span class="string">"æ¶ˆæ¯è¢«ä¸­æ–­ï¼šæ¶ˆæ¯ID="</span> + consumerTag);</span><br><span class="line">        };</span><br><span class="line">        channel.basicConsume(NORMAL_QUEUE_NAME, <span class="literal">true</span>, deliverCallback, cancelCallback);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>ç”Ÿäº§è€…</strong></p>
<p>ç”Ÿäº§è€…å†³å®šæ¶ˆæ¯ä¸€å‘å‡ºå»å¤šä¹…è½¬ä¸ºæ­»ä¿¡ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageDeadProducer</span> {</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">"normalExchange"</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ROUTING_KEY_NORMAL</span> <span class="operator">=</span> <span class="string">"normalRouting"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">"192.168.19.128"</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœåœ¨10så†…ï¼Œæ¶ˆè´¹è€…ä¸æ¥æ”¶åˆ™è½¬å‘åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­</span></span><br><span class="line">        AMQP.<span class="type">BasicProperties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AMQP</span>.BasicProperties()</span><br><span class="line">            .builder()</span><br><span class="line">            <span class="comment">// å•ä½ms</span></span><br><span class="line">            .expiration(<span class="string">"10000"</span>)</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) {</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">"message_"</span> + i;</span><br><span class="line">            channel.basicPublish(NORMAL_EXCHANGE_NAME, ROUTING_KEY_NORMAL, properties, (msg).getBytes(StandardCharsets.UTF_8));</span><br><span class="line">            System.out.println(<span class="string">"æ¶ˆæ¯["</span> + msg + <span class="string">"]å‘é€å®Œæˆ"</span>);</span><br><span class="line">        }</span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>æ¶ˆè´¹è€…2</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageDeadConsumer2</span> {</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> DEAD_QUEUE_NAME;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">"192.168.19.128"</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="literal">true</span>, (consumerTag, delivery) -&gt; {</span><br><span class="line">            <span class="type">byte</span>[] msgBytes = delivery.getBody();</span><br><span class="line">            System.out.println(<span class="string">"æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šæ¶ˆæ¯ID="</span> + consumerTag + <span class="string">"===&gt;"</span> + <span class="keyword">new</span> <span class="title class_">String</span>(msgBytes));</span><br><span class="line">        }, consumerTag -&gt; {</span><br><span class="line">            System.out.println(<span class="string">"æ¶ˆæ¯è¢«ä¸­æ–­ï¼šæ¶ˆæ¯ID="</span> + consumerTag);</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="æƒ…å†µ2ï¼šé˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦"><a href="#æƒ…å†µ2ï¼šé˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦" class="headerlink" title="æƒ…å†µ2ï¼šé˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦"></a>æƒ…å†µ2ï¼šé˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦</h3><p>æ¶ˆè´¹è€…1ä»£ç ä¿®æ”¹æ–°å¢å‚æ•°æ¥æ”¶æœ€å¤§é˜Ÿåˆ—çš„å‚æ•°å€¼ä¸º5ï¼Œæ³¨æ„æ­¤æ—¶éœ€è¦æŠŠåŸå…ˆé˜Ÿåˆ—åˆ é™¤ï¼Œå› ä¸ºå‚æ•°æ”¹å˜äº†ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// ä¿®æ”¹æ¶ˆè´¹è€…1çš„å‚æ•°ä»£ç </span></span><br><span class="line">Map&lt;String, Object&gt; arguments = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">arguments.put(<span class="string">"x-dead-letter-exchange"</span>, DEAD_EXCHANGE_NAME);</span><br><span class="line">arguments.put(<span class="string">"x-dead-letter-routing-key"</span>, ROUTING_KEY_DEAD);</span><br><span class="line"><span class="comment">// æƒ…å†µ2ï¼šé˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦(é˜Ÿåˆ—æ»¡äº†ï¼Œæ— æ³•å†æ·»åŠ æ•°æ®åˆ° mq ä¸­)</span></span><br><span class="line"><span class="comment">// è®¾ç½®æœ€å¤§é•¿åº¦ä¸º6ï¼Œæ³¨æ„æ­¤æ—¶éœ€è¦æŠŠåŸå…ˆé˜Ÿåˆ—åˆ é™¤ï¼Œå› ä¸ºå‚æ•°æ”¹å˜äº†ã€‚</span></span><br><span class="line">arguments.put(<span class="string">"x-max-length"</span>, <span class="number">5</span>);</span><br></pre></td></tr></tbody></table></figure>

<h3 id="æƒ…å†µ3ï¼šæ¶ˆæ¯è¢«æ‹’ç»"><a href="#æƒ…å†µ3ï¼šæ¶ˆæ¯è¢«æ‹’ç»" class="headerlink" title="æƒ…å†µ3ï¼šæ¶ˆæ¯è¢«æ‹’ç»"></a>æƒ…å†µ3ï¼šæ¶ˆæ¯è¢«æ‹’ç»</h3><p>åœ¨æ¶ˆè´¹è€…1ä¸­è°ƒç”¨ channel.basicReject() æ–¹æ³•æ‹’ç»æ¶ˆæ¯ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">    <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">    connectionFactory.setHost(<span class="string">"192.168.19.128"</span>);	</span><br><span class="line">    connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">    connectionFactory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">    connectionFactory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">    <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">    <span class="comment">// ç»‘å®šäº¤æ¢æœº</span></span><br><span class="line">    channel.exchangeDeclare(NORMAL_EXCHANGE_NAME, BuiltinExchangeType.DIRECT);</span><br><span class="line">    channel.exchangeDeclare(DEAD_EXCHANGE_NAME, BuiltinExchangeType.DIRECT);</span><br><span class="line">    <span class="comment">// æ·»åŠ æ­»ä¿¡é˜Ÿåˆ—å‚æ•°</span></span><br><span class="line">    Map&lt;String, Object&gt; arguments = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">    arguments.put(<span class="string">"x-dead-letter-exchange"</span>, DEAD_EXCHANGE_NAME);</span><br><span class="line">    arguments.put(<span class="string">"x-dead-letter-routing-key"</span>, ROUTING_KEY_DEAD);</span><br><span class="line">    <span class="comment">// æƒ…å†µ2ï¼šé˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦(é˜Ÿåˆ—æ»¡äº†ï¼Œæ— æ³•å†æ·»åŠ æ•°æ®åˆ° mq ä¸­)</span></span><br><span class="line">    <span class="comment">// è®¾ç½®æœ€å¤§é•¿åº¦ä¸º6ï¼Œæ³¨æ„æ­¤æ—¶éœ€è¦æŠŠåŸå…ˆé˜Ÿåˆ—åˆ é™¤ï¼Œå› ä¸ºå‚æ•°æ”¹å˜äº†ã€‚</span></span><br><span class="line">    <span class="comment">// arguments.put("x-max-length", 5);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»‘å®šé˜Ÿåˆ—</span></span><br><span class="line">    channel.queueDeclare(DEAD_QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="comment">// æ­£å¸¸é˜Ÿåˆ—å°†å¼‚å¸¸æ¶ˆæ¯ï¼ˆttlå¤±æ•ˆã€æ¶ˆæ¯è¢«æ‹’ç»ã€é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦ï¼‰è½¬åˆ°æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line">    channel.queueDeclare(NORMAL_QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, arguments);</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—ç»‘å®šäº¤æ¢æœºå’Œè·¯ç”±é”®</span></span><br><span class="line">    channel.queueBind(DEAD_QUEUE_NAME, DEAD_EXCHANGE_NAME, ROUTING_KEY_DEAD);</span><br><span class="line">    channel.queueBind(NORMAL_QUEUE_NAME, NORMAL_EXCHANGE_NAME, ROUTING_KEY_NORMAL);</span><br><span class="line">    System.out.println(<span class="string">"ç­‰å¾…æ¥æ”¶æ¶ˆæ¯..."</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥æ”¶åˆ°æ¶ˆæ¯åè§¦å‘å›è°ƒ</span></span><br><span class="line">    <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, delivery) -&gt; {</span><br><span class="line">        <span class="type">byte</span>[] msgBytes = delivery.getBody();</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(msgBytes);</span><br><span class="line">        <span class="type">long</span> <span class="variable">deliveryTag</span> <span class="operator">=</span> delivery.getEnvelope().getDeliveryTag();</span><br><span class="line">        <span class="comment">// æƒ…å†µ3ï¼šæ‹’ç»æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">if</span> (msg.equals(<span class="string">"message_5"</span>)) {</span><br><span class="line">            <span class="comment">// æ˜¯å¦é‡æ–°æ”¾å›é˜Ÿåˆ—</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">requeue</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">            channel.basicReject(deliveryTag, requeue);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            System.out.println(<span class="string">"æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šæ¶ˆæ¯ID="</span> + consumerTag + <span class="string">"===&gt;"</span> + msg);</span><br><span class="line">            channel.basicAck(deliveryTag, <span class="literal">false</span>);</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æƒ…å†µ3ï¼šå¼€å¯æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line">    channel.basicConsume(NORMAL_QUEUE_NAME, <span class="literal">false</span>, deliverCallback, consumerTag -&gt; {</span><br><span class="line">        System.out.println(<span class="string">"æ¶ˆæ¯è¢«ä¸­æ–­ï¼šæ¶ˆæ¯ID="</span> + consumerTag);</span><br><span class="line">    });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</body></html>]]></content>
      <tags>
        <tag>æ¶ˆæ¯ä¸­é—´ä»¶</tag>
        <tag>RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMQå»¶æ—¶é˜Ÿåˆ—</title>
    <url>/p/a4765550.html</url>
    <content><![CDATA[<html><head></head><body></body></html>]]></content>
      <tags>
        <tag>æ¶ˆæ¯ä¸­é—´ä»¶</tag>
        <tag>RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMQçš„å››å¤§æ ¸å¿ƒæ¦‚å¿µ</title>
    <url>/p/9a89eebd.html</url>
    <content><![CDATA[<html><head></head><body><p><strong>ç”Ÿäº§è€…ï¼Œäº¤æ¢æœºï¼Œé˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…</strong>ã€‚å››å¤§æ ¸å¿ƒç±»ä¼¼äºä»¥ä¸‹çš„ååŒå…³ç³»ã€‚</p>
<p><img src="/p/9a89eebd/RabbitMQ-%E5%9B%9B%E5%A4%A7%E6%A0%B8%E5%BF%83%E7%A4%BA%E4%BE%8B.png" alt="image-20210619160155955"></p>
<p>å››å¤§æ ¸å¿ƒçš„ç›¸äº’å…³è”ã€‚</p>
<p><img src="/p/9a89eebd/RabbitMQ-%E5%9B%9B%E5%A4%A7%E6%A0%B8%E5%BF%83%E5%85%B3%E7%B3%BB.png" alt="image-20210619160347762"></p>
<p><strong>ç”Ÿäº§è€…</strong></p>
<p>äº§ç”Ÿæ•°æ®å‘é€æ¶ˆæ¯çš„ç¨‹åºæ˜¯ç”Ÿäº§è€…</p>
<p><strong>äº¤æ¢æœº</strong></p>
<p>äº¤æ¢æœºæ˜¯ RabbitMQ éå¸¸é‡è¦çš„ä¸€ä¸ªéƒ¨ä»¶ï¼Œä¸€æ–¹é¢å®ƒæ¥æ”¶æ¥è‡ªç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œå¦ä¸€æ–¹é¢å®ƒå°†æ¶ˆæ¯æ¨é€åˆ°é˜Ÿåˆ—ä¸­ã€‚äº¤æ¢æœºå¿…é¡»ç¡®åˆ‡çŸ¥é“å¦‚ä½•å¤„ç†å®ƒæ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œæ˜¯å°†è¿™äº›æ¶ˆæ¯æ¨é€åˆ°ç‰¹å®šé˜Ÿåˆ—è¿˜æ˜¯æ¨é€åˆ°å¤šä¸ªé˜Ÿåˆ—ï¼Œäº¦æˆ–è€…æ˜¯æŠŠæ¶ˆæ¯ä¸¢å¼ƒï¼Œè¿™ä¸ªå¾—æœ‰äº¤æ¢æœºç±»å‹å†³å®šã€‚</p>
<p><strong>é˜Ÿåˆ—</strong></p>
<p>é˜Ÿåˆ—æ˜¯ RabbitMQ å†…éƒ¨ä½¿ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œå°½ç®¡æ¶ˆæ¯æµç» RabbitMQ å’Œåº”ç”¨ç¨‹åºï¼Œä½†å®ƒä»¬åªèƒ½å­˜å‚¨åœ¨é˜Ÿåˆ—ä¸­ã€‚é˜Ÿåˆ—ä»…å—ä¸»æœºçš„å†…å­˜å’Œç£ç›˜é™åˆ¶çš„çº¦æŸï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¤§çš„æ¶ˆæ¯ç¼“å†²åŒºã€‚è®¸å¤šç”Ÿäº§è€…å¯ä»¥å°†æ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè®¸å¤šæ¶ˆè´¹è€…å¯ä»¥å°è¯•ä»ä¸€ä¸ªé˜Ÿåˆ—æ¥æ”¶æ•°æ®ã€‚è¿™å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨é˜Ÿåˆ—çš„æ–¹å¼ã€‚</p>
<p><strong>æ¶ˆè´¹è€…</strong></p>
<p>æ¶ˆè´¹ä¸æ¥æ”¶å…·æœ‰ç›¸ä¼¼çš„å«ä¹‰ã€‚æ¶ˆè´¹è€…å¤§å¤šæ—¶å€™æ˜¯ä¸€ä¸ªç­‰å¾…æ¥æ”¶æ¶ˆæ¯çš„ç¨‹åºã€‚è¯·æ³¨æ„ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…å’Œæ¶ˆæ¯ä¸­é—´ä»¶å¾ˆå¤šæ—¶å€™å¹¶ä¸åœ¨åŒä¸€æœºå™¨ä¸Šã€‚åŒä¸€ä¸ªåº”ç”¨ç¨‹åºæ—¢å¯ä»¥æ˜¯ç”Ÿäº§è€…åˆæ˜¯å¯ä»¥æ˜¯æ¶ˆè´¹è€…ã€‚</p>
<p><strong>å„ä¸ªåè¯ä»‹ç»</strong></p>
<p><img src="/p/9a89eebd/RabbitMQ-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="image-20210619161230922"></p>
<p><strong>Broker</strong></p>
<p>æ¥æ”¶å’Œåˆ†å‘æ¶ˆæ¯çš„åº”ç”¨ï¼ŒRabbitMQ Serverå°±æ˜¯Message Broker </p>
<p><strong>Virtual host</strong></p>
<p>å‡ºäºå¤šç§Ÿæˆ·å’Œå®‰å…¨å› ç´ è®¾è®¡çš„ï¼ŒæŠŠAMQP çš„åŸºæœ¬ç»„ä»¶åˆ’åˆ†åˆ°ä¸€ä¸ªè™šæ‹Ÿçš„åˆ†ç»„ä¸­ï¼Œç±»ä¼¼äºç½‘ç»œä¸­çš„namespaceæ¦‚å¿µã€‚å½“å¤šä¸ªä¸åŒçš„ç”¨æˆ·ä½¿ç”¨åŒä¸€ä¸ªRabbitMQserveræä¾›çš„æœåŠ¡æ—¶ï¼Œå¯ä»¥åˆ’åˆ†å‡ºå¤šä¸ªvhostï¼Œæ¯ä¸ªç”¨æˆ·åœ¨è‡ªå·±çš„vhost åˆ›å»ºexchangeï¼queue ç­‰ã€‚</p>
<p><strong>Connection</strong></p>
<p>publisherï¼consumerå’Œbrokerä¹‹é—´çš„TCPè¿æ¥ </p>
<p><strong>Channel</strong></p>
<p>å¦‚æœæ¯ä¸€æ¬¡è®¿é—® RabbitMQ éƒ½å»ºç«‹ä¸€ä¸ªConnectionï¼Œåœ¨æ¶ˆæ¯é‡å¤§çš„æ—¶å€™å»ºç«‹TCP  Connectionçš„å¼€é”€å°†æ˜¯å·¨å¤§çš„ï¼Œæ•ˆç‡ä¹Ÿè¾ƒä½ã€‚Channelæ˜¯åœ¨connectionå†…éƒ¨å»ºç«‹çš„é€»è¾‘è¿æ¥ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ”¯æŒå¤šçº¿ç¨‹ï¼Œé€šå¸¸æ¯ä¸ªthreadåˆ›å»ºå•ç‹¬çš„channelè¿›è¡Œé€šè®¯ï¼ŒAMQP methodåŒ…å«äº†channel id å¸®åŠ©å®¢æˆ·ç«¯å’Œ message broker è¯†åˆ«channelï¼Œæ‰€ä»¥channelä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„ã€‚Channelä½œä¸ºè½»é‡çº§çš„Connectionæå¤§å‡å°‘äº†æ“ä½œç³»ç»Ÿå»ºç«‹TCP connectionçš„å¼€é”€ã€‚</p>
<p><strong>Exchange</strong></p>
<p>message åˆ°è¾¾broker çš„ç¬¬ä¸€ç«™ï¼Œæ ¹æ®åˆ†å‘è§„åˆ™ï¼ŒåŒ¹é…æŸ¥è¯¢è¡¨ä¸­çš„routing keyï¼Œåˆ†å‘æ¶ˆæ¯åˆ°queue ä¸­å»ã€‚å¸¸ç”¨çš„ç±»å‹æœ‰ï¼šdirect (point-to-point), topic (publish-subscribe) and fanout  (multicast)ã€‚</p>
<p>å³ä½¿ä½¿ç”¨çš„æ˜¯ç®€å•æ¨¡å¼ï¼Œç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€ç»™RabbitMQé»˜è®¤çš„äº¤æ¢æœºã€‚</p>
<p><strong>Queue</strong></p>
<p>æ¶ˆæ¯æœ€ç»ˆè¢«é€åˆ°è¿™é‡Œç­‰å¾…consumerå–èµ°ã€‚</p>
<p><strong>Binding</strong></p>
<p>exchangeå’Œqueueä¹‹é—´çš„è™šæ‹Ÿè¿æ¥ï¼Œbindingä¸­å¯ä»¥åŒ…å«routing keyï¼ŒBindingä¿¡æ¯è¢«ä¿å­˜åˆ°exchangeä¸­çš„æŸ¥è¯¢è¡¨ä¸­ï¼Œç”¨äºmessageçš„åˆ†å‘ä¾æ®ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>æ¶ˆæ¯ä¸­é—´ä»¶</tag>
        <tag>RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMQçš„å®‰è£…</title>
    <url>/p/984e2ca0.html</url>
    <content><![CDATA[<html><head></head><body><p><a href="https://www.rabbitmq.com/">RabbitMQå®˜ç½‘</a></p>
<h2 id="å®‰è£…RabbitMQ"><a href="#å®‰è£…RabbitMQ" class="headerlink" title="å®‰è£…RabbitMQ"></a>å®‰è£…RabbitMQ</h2><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">docker run -d --restart=always -p 5672:5672 -p 15672:15672 --name rabbitmq -v ${RABBITMQ_DIR}/data:/mydata/rabbitmq  -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=admin rabbitmq:management</span><br></pre></td></tr></tbody></table></figure>

<p>è®¿é—® ip:15672ï¼ˆå¦‚ 127.0.0.1:15672ï¼‰</p>
<p><img src="/p/984e2ca0/RabbitMQ-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86.png" alt="image-20210619153907851"></p>
<h3 id="è¶…çº§ç®¡ç†å‘˜-administrator"><a href="#è¶…çº§ç®¡ç†å‘˜-administrator" class="headerlink" title="è¶…çº§ç®¡ç†å‘˜(administrator)"></a>è¶…çº§ç®¡ç†å‘˜(administrator)</h3><p>å¯ç™»é™†ç®¡ç†æ§åˆ¶å°ï¼Œå¯æŸ¥çœ‹æ‰€æœ‰çš„ä¿¡æ¯ï¼Œå¹¶ä¸”å¯ä»¥å¯¹ç”¨æˆ·ï¼Œç­–ç•¥(policy)è¿›è¡Œæ“ä½œã€‚</p>
<h3 id="ç›‘æ§è€…-monitoring"><a href="#ç›‘æ§è€…-monitoring" class="headerlink" title="ç›‘æ§è€…(monitoring)"></a>ç›‘æ§è€…(monitoring)</h3><p>å¯ç™»é™†ç®¡ç†æ§åˆ¶å°ï¼ŒåŒæ—¶å¯ä»¥æŸ¥çœ‹rabbitmqèŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯(è¿›ç¨‹æ•°ï¼Œå†…å­˜ä½¿ç”¨æƒ…å†µï¼Œç£ç›˜ä½¿ç”¨æƒ…å†µç­‰)</p>
<h3 id="ç­–ç•¥åˆ¶å®šè€…-policymaker"><a href="#ç­–ç•¥åˆ¶å®šè€…-policymaker" class="headerlink" title="ç­–ç•¥åˆ¶å®šè€…(policymaker)"></a>ç­–ç•¥åˆ¶å®šè€…(policymaker)</h3><p>å¯ç™»é™†ç®¡ç†æ§åˆ¶å°, åŒæ—¶å¯ä»¥å¯¹policyè¿›è¡Œç®¡ç†ã€‚ä½†æ— æ³•æŸ¥çœ‹èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯(ä¸Šå›¾çº¢æ¡†æ ‡è¯†çš„éƒ¨åˆ†)ã€‚</p>
<h3 id="æ™®é€šç®¡ç†è€…-management"><a href="#æ™®é€šç®¡ç†è€…-management" class="headerlink" title="æ™®é€šç®¡ç†è€…(management)"></a>æ™®é€šç®¡ç†è€…(management)</h3><p>ä»…å¯ç™»é™†ç®¡ç†æ§åˆ¶å°ï¼Œæ— æ³•çœ‹åˆ°èŠ‚ç‚¹ä¿¡æ¯ï¼Œä¹Ÿæ— æ³•å¯¹ç­–ç•¥è¿›è¡Œç®¡ç†ã€‚</p>
<h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>æ— æ³•ç™»é™†ç®¡ç†æ§åˆ¶å°ï¼Œé€šå¸¸å°±æ˜¯æ™®é€šçš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€‚</p>
<h2 id="Virtual-Hostsé…ç½®"><a href="#Virtual-Hostsé…ç½®" class="headerlink" title="Virtual Hostsé…ç½®"></a>Virtual Hostsé…ç½®</h2><p>åƒmysqlæ‹¥æœ‰æ•°æ®åº“çš„æ¦‚å¿µå¹¶ä¸”å¯ä»¥æŒ‡å®šç”¨æˆ·å¯¹åº“å’Œè¡¨ç­‰æ“ä½œçš„æƒé™ã€‚RabbitMQä¹Ÿæœ‰ç±»ä¼¼çš„æƒé™ç®¡ç†ï¼›åœ¨RabbitMQä¸­å¯ä»¥è™šæ‹Ÿæ¶ˆæ¯æœåŠ¡å™¨Virtual Hostï¼Œæ¯ä¸ªVirtual Hostsç›¸å½“äºä¸€ä¸ªç›¸å¯¹ç‹¬ç«‹çš„RabbitMQæœåŠ¡å™¨ï¼Œæ¯ä¸ªVirtualHostä¹‹é—´æ˜¯ç›¸äº’éš”ç¦»çš„ã€‚exchangeã€queueã€messageä¸èƒ½äº’é€šã€‚ ç›¸å½“äºmysqlçš„dbã€‚Virtual Nameä¸€èˆ¬ä»¥/å¼€å¤´ã€‚</p>
<h3 id="åˆ›å»ºVirtual-Hosts"><a href="#åˆ›å»ºVirtual-Hosts" class="headerlink" title="åˆ›å»ºVirtual Hosts"></a>åˆ›å»ºVirtual Hosts</h3><p><img src="/p/984e2ca0/RabbitMQ-%E5%88%9B%E5%BB%BAVirtualHosts.png" alt="image-20210619154832923"></p>
<h3 id="è®¾ç½®Virtual-Hostsæƒé™"><a href="#è®¾ç½®Virtual-Hostsæƒé™" class="headerlink" title="è®¾ç½®Virtual Hostsæƒé™"></a>è®¾ç½®Virtual Hostsæƒé™</h3><p><img src="/p/984e2ca0/RabbitMQ-%E8%AE%BE%E7%BD%AEVirtualHosts%E6%9D%83%E9%99%90.png" alt="image-20210619154957203"></p>
<p>![image-20210619155027666](MQ-RabbitMQ-Install/RabbitMQ - è®¾ç½®Virtual Hostsæƒé™.png)</p>
<p>userï¼šç”¨æˆ·å</p>
<p>configure ï¼šä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨æˆ·å¯¹ç¬¦åˆè¯¥æ­£åˆ™è¡¨è¾¾å¼çš„æ‰€æœ‰èµ„æºæ‹¥æœ‰ configure æ“ä½œçš„æƒé™</p>
<p>writeï¼šä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨æˆ·å¯¹ç¬¦åˆè¯¥æ­£åˆ™è¡¨è¾¾å¼çš„æ‰€æœ‰èµ„æºæ‹¥æœ‰ write æ“ä½œçš„æƒé™</p>
<p>readï¼šä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨æˆ·å¯¹ç¬¦åˆè¯¥æ­£åˆ™è¡¨è¾¾å¼çš„æ‰€æœ‰èµ„æºæ‹¥æœ‰ read æ“ä½œçš„æƒé™</p>
</body></html>]]></content>
      <tags>
        <tag>æ¶ˆæ¯ä¸­é—´ä»¶</tag>
        <tag>RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMQæƒ°æ€§é˜Ÿåˆ—</title>
    <url>/p/b8aa99c2.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="ä»€ä¹ˆæ˜¯æƒ°æ€§é˜Ÿåˆ—"><a href="#ä»€ä¹ˆæ˜¯æƒ°æ€§é˜Ÿåˆ—" class="headerlink" title="ä»€ä¹ˆæ˜¯æƒ°æ€§é˜Ÿåˆ—"></a>ä»€ä¹ˆæ˜¯æƒ°æ€§é˜Ÿåˆ—</h2><p>â€‹        æƒ°æ€§é˜Ÿåˆ—ä¼šå°½å¯èƒ½çš„å°†ä»»ä½•æ¶ˆæ¯å­˜å…¥ç£ç›˜ï¼Œè¿™æ ·å¯ä»¥å‡å°‘äº†å†…å­˜çš„æ¶ˆè€—ï¼Œå½“æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°ç›¸åº”çš„æ¶ˆæ¯æ—¶æ‰ä¼šè¢«åŠ è½½åˆ°å†…å­˜ï¼Œä¼šå¢åŠ I/Oçš„ä½¿ç”¨ã€‚</p>
<p>ä¸‹é¢çœ‹ä¸€ç»„100ä¸‡æ•°æ®çš„å†…å­˜å¼€é”€ï¼š</p>
<p><img src="/p/b8aa99c2/RabbitMQ-%E6%83%B0%E6%80%A7%E9%98%9F%E5%88%97%E4%B8%8E%E6%99%AE%E9%80%9A%E9%98%9F%E5%88%97%E6%AF%94%E8%BE%83%E5%86%85%E5%AD%98%E5%BC%80%E9%94%80.png" alt="image-20210626204816045"></p>
<p>â€‹        åœ¨å‘é€ 1 ç™¾ä¸‡æ¡æ¶ˆæ¯ï¼Œæ¯æ¡æ¶ˆæ¯å¤§æ¦‚å  1KB çš„æƒ…å†µä¸‹ï¼Œæ™®é€šé˜Ÿåˆ—å ç”¨å†…å­˜æ˜¯ 1.2GBï¼Œè€Œæƒ°æ€§é˜Ÿåˆ—ä»…ä»…å ç”¨ 1.5MB ã€‚</p>
<h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h2><p>ï¼ˆ1ï¼‰æ”¯æŒå­˜å‚¨å¤§é‡æ¶ˆæ¯çš„é•¿é˜Ÿåˆ—ã€‚  </p>
<p>ï¼ˆ2ï¼‰æ¶ˆæ¯å¤§é‡ç§¯å‹çš„æ—¶å€™ï¼Œæ¶ˆè´¹é€Ÿåº¦å¤ªæ…¢ï¼Œåˆ°äº†æ¶ˆæ¯å¤§çˆ†å‘çš„æ—¶å€™ï¼ŒMQæœåŠ¡å™¨ä¼šæ’‘ä¸ä½ï¼Œæœºä¼šå½±å“å…¶å®ƒé˜Ÿåˆ—çš„æ¶ˆæ¯æ”¶å‘ã€‚é‚£ä¹ˆæ¶ˆæ¯å°±å¯ä»¥å†™å…¥ç£ç›˜ï¼Œéœ€è¦çš„æ—¶å€™å†åŠ è½½åˆ°å†…å­˜ã€‚</p>
<p>ï¼ˆ3ï¼‰å½“æ¶ˆè´¹è€…ç”±äºå„ç§å„æ ·çš„åŸå› ï¼ˆæ¯”å¦‚æ¶ˆè´¹è€…ä¸‹çº¿ã€å®•æœºäº¦æˆ–è€…æ˜¯ç”±äºç»´æŠ¤è€Œå…³é—­ç­‰ï¼‰è€Œè‡´ä½¿é•¿æ—¶é—´å†…ä¸èƒ½æ¶ˆè´¹æ¶ˆæ¯é€ æˆå †ç§¯æ—¶ï¼Œæƒ°æ€§é˜Ÿåˆ—å°±å¾ˆæœ‰å¿…è¦äº†ã€‚</p>
<h2 id="æƒ°æ€§é˜Ÿåˆ—"><a href="#æƒ°æ€§é˜Ÿåˆ—" class="headerlink" title="æƒ°æ€§é˜Ÿåˆ—"></a>æƒ°æ€§é˜Ÿåˆ—</h2><p>â€‹        æƒ°æ€§é˜Ÿåˆ—æœ‰ä¸¤ç§æ¨¡å¼ï¼šdefaultå’Œlazyã€‚é»˜è®¤defaultæ¨¡å¼ï¼Œåœ¨3.6.0ä¹‹å‰çš„ç‰ˆæœ¬æ— éœ€åšä»»ä½•å˜æ›´ã€‚lazyæ˜¯æƒ°æ€§é˜Ÿåˆ—çš„æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨channel.queueDeclareæ–¹æ³•çš„æ—¶å€™åœ¨å‚æ•°ä¸­è®¾ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡Policyçš„æ–¹å¼è®¾ç½®ï¼Œå¦‚æœä¸€ä¸ªé˜Ÿåˆ—åŒæ—¶ä½¿ç”¨è¿™ä¸¤ç§æ–¹å¼è®¾ç½®çš„è¯ï¼Œé‚£ä¹ˆPolicyçš„æ–¹å¼å…·å¤‡æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚å¦‚æœè¦é€šè¿‡å£°æ˜çš„æ–¹å¼æ”¹å˜å·²æœ‰é˜Ÿåˆ—çš„æ¨¡å¼çš„è¯ï¼Œé‚£ä¹ˆåªèƒ½å…ˆåˆ é™¤é˜Ÿåˆ—ï¼Œç„¶åå†é‡æ–°å£°æ˜ä¸€ä¸ªæ–°çš„ã€‚</p>
<p>åœ¨é˜Ÿåˆ—å£°æ˜çš„æ—¶å€™å¯ä»¥é€šè¿‡â€œx-queue-modeâ€å‚æ•°æ¥è®¾ç½®é˜Ÿåˆ—çš„æ¨¡å¼ï¼Œå–å€¼ä¸ºâ€œdefaultâ€å’Œâ€œlazyâ€ã€‚ä¸‹é¢ç¤ºä¾‹ä¸­æ¼”ç¤ºäº†ä¸€ä¸ªæƒ°æ€§é˜Ÿåˆ—çš„å£°æ˜ç»†èŠ‚ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Map&lt;String, Object&gt; args = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line">args.put(<span class="string">"x-queue-mode"</span>, <span class="string">"lazy"</span>);</span><br><span class="line"><span class="comment">// æ¶ˆæ¯åˆ°åº•éœ€ä¸éœ€è¦æŒä¹…åŒ–ï¼Ÿ</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">durable</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">channel.queueDeclare(<span class="string">"myqueue"</span>, durable, <span class="literal">false</span>, <span class="literal">false</span>, args);  </span><br></pre></td></tr></tbody></table></figure>

<p>lazy queue æ¶ˆæ¯ä¸æŒä¹…åŒ– ï¼Œ ä½†æ˜¯è¿™ç§æ¨¡å¼è¿˜æ˜¯ä¼šæŠŠæ¶ˆæ¯æ”¾åˆ°ç¡¬ç›˜é‡Œï¼ŒRAMçš„ä½¿ç”¨ç‡ä¼šä¸€ç›´å¾ˆç¨³å®šï¼Œä½†æ˜¯é‡å¯åä¸€æ ·ä¼šä¸¢å¤±æ¶ˆæ¯</p>
<p>lazy queue æ¶ˆæ¯æŒä¹…åŒ–ï¼Œè¿™ç§æ–¹å¼æ— ç–‘æ˜¯æœ€ä½³æ­é…ï¼Œæ¶ˆæ¯æ”¾åˆ°ç¡¬ç›˜å¹¶ä¸”ä¸ä¼šå› ä¸ºæœåŠ¡å™¨é‡å¯è€Œä¸¢å¤±ï¼Œé¢å¯¹é«˜å¹¶å‘ä¹Ÿæ˜¯ä»å®¹ä¸å·²ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>æ¶ˆæ¯ä¸­é—´ä»¶</tag>
        <tag>RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMQæ¶ˆæ¯åº”ç­”(ACK)</title>
    <url>/p/d8b7ee3.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h2><p>æ¶ˆè´¹è€…å®Œæˆä¸€ä¸ªä»»åŠ¡å¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†ä¸€ä¸ªé•¿çš„ä»»åŠ¡å¹¶ä»…åªå®Œæˆäº†éƒ¨åˆ†çªç„¶å®ƒæŒ‚æ‰äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼ŸRabbitMQ ä¸€æ—¦å‘æ¶ˆè´¹è€…ä¼ é€’äº†ä¸€æ¡æ¶ˆæ¯ï¼Œä¾¿ç«‹å³å°†è¯¥æ¶ˆæ¯æ ‡è®°ä¸ºåˆ é™¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œçªç„¶æœ‰ä¸ªæ¶ˆè´¹è€…æŒ‚æ‰äº†ï¼Œæˆ‘ä»¬å°†ä¸¢å¤±æ­£åœ¨å¤„ç†çš„æ¶ˆæ¯ã€‚ä»¥åŠåç»­å‘é€ç»™è¯¥æ¶ˆè´¹è¿™çš„æ¶ˆæ¯ï¼Œå› ä¸ºå®ƒæ— æ³•æ¥æ”¶åˆ°ã€‚</p>
<p>ä¸ºäº†ä¿è¯æ¶ˆæ¯åœ¨å‘é€è¿‡ç¨‹ä¸­ä¸ä¸¢å¤±ï¼Œrabbitmq å¼•å…¥æ¶ˆæ¯åº”ç­”æœºåˆ¶ï¼Œæ¶ˆæ¯åº”ç­”å°±æ˜¯ï¼š<strong>æ¶ˆè´¹è€…åœ¨æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶ä¸”å¤„ç†è¯¥æ¶ˆæ¯ä¹‹åï¼Œå‘Šè¯‰ rabbitmq å®ƒå·²ç»å¤„ç†äº†ï¼Œrabbitmq å¯ä»¥æŠŠè¯¥æ¶ˆæ¯åˆ é™¤äº†ã€‚</strong></p>
<p><img src="/p/d8b7ee3/image-20220505233249302.png" alt="image-20220505233249302"></p>
<h2 id="è‡ªåŠ¨åº”ç­”"><a href="#è‡ªåŠ¨åº”ç­”" class="headerlink" title="è‡ªåŠ¨åº”ç­”"></a>è‡ªåŠ¨åº”ç­”</h2><p>æ¶ˆè´¹è€…æ¥æ”¶åˆ°ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯åï¼Œå°±ä¼šè¿›è¡ŒTCPåè®®çš„ACKåº”ç­”ï¼Œè¡¨ç¤ºå·²ç»ä¼ é€æˆåŠŸï¼Œè¿™ç§æ¨¡å¼éœ€è¦åœ¨<strong>é«˜ååé‡å’Œæ•°æ®ä¼ è¾“å®‰å…¨æ€§æ–¹é¢åšæƒè¡¡</strong>ï¼Œå› ä¸ºè¿™ç§æ¨¡å¼å¦‚æœæ¶ˆæ¯åœ¨æ¥æ”¶åˆ°ä¹‹å‰ï¼Œæ¶ˆè´¹è€…é‚£è¾¹å‡ºç°è¿æ¥æˆ–è€… channel å…³é—­ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¸¢å¤±äº†ã€‚</p>
<p>å¦ä¸€æ–¹é¢è¿™ç§æ¨¡å¼æ¶ˆè´¹è€…é‚£è¾¹å¯ä»¥ä¼ é€’è¿‡è½½çš„æ¶ˆæ¯ï¼Œ<strong>æ²¡æœ‰å¯¹ä¼ é€’çš„æ¶ˆæ¯æ•°é‡è¿›è¡Œé™åˆ¶</strong>ï¼Œå½“ç„¶è¿™æ ·æœ‰å¯èƒ½ä½¿å¾—æ¶ˆè´¹è€…è¿™è¾¹ç”±äºæ¥æ”¶å¤ªå¤šè¿˜æ¥ä¸åŠå¤„ç†çš„æ¶ˆæ¯ï¼Œå¯¼è‡´è¿™äº›æ¶ˆæ¯çš„ç§¯å‹ï¼Œæœ€ç»ˆä½¿å¾—å†…å­˜è€—å°½ï¼Œæœ€ç»ˆè¿™äº›æ¶ˆè´¹è€…çº¿ç¨‹è¢«æ“ä½œç³»ç»Ÿæ€æ­»ï¼Œ<strong>æ‰€ä»¥è¿™ç§æ¨¡å¼ä»…é€‚ç”¨åœ¨æ¶ˆè´¹è€…å¯ä»¥é«˜æ•ˆå¹¶ä»¥æŸç§é€Ÿç‡èƒ½å¤Ÿå¤„ç†è¿™äº›æ¶ˆæ¯çš„æƒ…å†µä¸‹ä½¿ç”¨</strong>ã€‚</p>
<h2 id="æ¶ˆæ¯åº”ç­”çš„æ–¹æ³•"><a href="#æ¶ˆæ¯åº”ç­”çš„æ–¹æ³•" class="headerlink" title="æ¶ˆæ¯åº”ç­”çš„æ–¹æ³•"></a>æ¶ˆæ¯åº”ç­”çš„æ–¹æ³•</h2><ul>
<li>Channel.basicAck(ç”¨äºè‚¯å®šç¡®è®¤)ï¼ŒRabbitMQ å·²çŸ¥é“è¯¥æ¶ˆæ¯å¹¶ä¸”æˆåŠŸçš„å¤„ç†æ¶ˆæ¯ï¼Œå¯ä»¥å°†å…¶ä¸¢å¼ƒäº†ã€‚</li>
<li>Channel.basicNack(ç”¨äºå¦å®šç¡®è®¤) </li>
<li>Channel.basicReject(ç”¨äºå¦å®šç¡®è®¤) ä¸ Channel.basicNack() ç›¸æ¯”å°‘ä¸€ä¸ªå‚æ•°ï¼Œä¸å¤„ç†è¯¥æ¶ˆæ¯äº†ç›´æ¥æ‹’ç»ï¼Œå¯ä»¥å°†å…¶ä¸¢å¼ƒäº†</li>
</ul>
<h2 id="Multiple-æ‰¹é‡"><a href="#Multiple-æ‰¹é‡" class="headerlink" title="Multiple(æ‰¹é‡)"></a>Multiple(æ‰¹é‡)</h2><p>æ‰‹åŠ¨åº”ç­”çš„å¥½å¤„æ˜¯å¯ä»¥æ‰¹é‡åº”ç­”å¹¶ä¸”å‡å°‘ç½‘ç»œæ‹¥å µã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> multiple true to acknowledge all messages up to and</span></span><br><span class="line"><span class="comment"> * including the supplied delivery tag; false to acknowledge just </span></span><br><span class="line"><span class="comment"> * the supplied delivery tag.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">basicAck</span><span class="params">(<span class="type">long</span> deliveryTag, <span class="type">boolean</span> multiple)</span> <span class="keyword">throws</span> IOException;</span><br></pre></td></tr></tbody></table></figure>

<p>multiple çš„ true å’Œ false ä»£è¡¨ä¸åŒæ„æ€ï¼š</p>
<ul>
<li><p>true ä»£è¡¨æ‰¹é‡åº”ç­” channel ä¸Šæœªåº”ç­”çš„æ¶ˆæ¯ï¼Œæ¯”å¦‚è¯´ channel ä¸Šæœ‰ä¼ é€ tag çš„æ¶ˆæ¯ 5,6,7,8 å½“å‰ tag æ˜¯ 8 é‚£ä¹ˆæ­¤æ—¶ 5-8 çš„è¿™äº›è¿˜æœªåº”ç­”çš„æ¶ˆæ¯éƒ½ä¼šè¢«ç¡®è®¤æ”¶åˆ°æ¶ˆæ¯åº”ç­”ã€‚</p>
</li>
<li><p>false åŒä¸Šé¢ç›¸æ¯”åªä¼šåº”ç­” tag=8 çš„æ¶ˆæ¯ 5,6,7 è¿™ä¸‰ä¸ªæ¶ˆæ¯ä¾ç„¶ä¸ä¼šè¢«ç¡®è®¤æ”¶åˆ°æ¶ˆæ¯åº”ç­”ã€‚</p>
</li>
</ul>
<p>å»ºè®®æ²¡æœ‰ç‰¹æ®Šè¦æ±‚éƒ½è®¾ç½®ä¸º falseã€‚</p>
<h2 id="å¦‚ä½•é¿å…å†…å­˜è€—å°½ï¼Ÿ"><a href="#å¦‚ä½•é¿å…å†…å­˜è€—å°½ï¼Ÿ" class="headerlink" title="å¦‚ä½•é¿å…å†…å­˜è€—å°½ï¼Ÿ"></a>å¦‚ä½•é¿å…å†…å­˜è€—å°½ï¼Ÿ</h2><p>é€šè¿‡è®¾ç½®Channelçš„QOSæ¥é™åˆ¶å®¢æˆ·ç«¯æ¥å—æ¶ˆæ¯æœ€å¤§æ•°é‡ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">channel.BasicQos(<span class="number">0</span>,<span class="number">1</span>,<span class="literal">false</span>);</span><br></pre></td></tr></tbody></table></figure>

<h2 id="æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ"><a href="#æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ" class="headerlink" title="æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ"></a>æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ</h2><p>å¦‚æœæ¶ˆè´¹è€…ç”±äºæŸäº›åŸå› å¤±å»è¿æ¥(å…¶é€šé“å·²å…³é—­ï¼Œè¿æ¥å·²å…³é—­æˆ– TCP è¿æ¥ä¸¢å¤±)ï¼Œå¯¼è‡´æ¶ˆæ¯æœªå‘é€ ACK ç¡®è®¤ï¼ŒRabbitMQ å°†äº†è§£åˆ°æ¶ˆæ¯æœªå®Œå…¨å¤„ç†ï¼Œå¹¶å°†å¯¹å…¶é‡æ–°æ’é˜Ÿã€‚å¦‚æœæ­¤æ—¶å…¶ä»–æ¶ˆè´¹è€…å¯ä»¥å¤„ç†ï¼Œå®ƒå°†å¾ˆå¿«å°†å…¶é‡æ–°åˆ†å‘ç»™å¦ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚è¿™æ ·ï¼Œå³ä½¿æŸä¸ªæ¶ˆè´¹è€…å¶å°”æ­»äº¡ï¼Œä¹Ÿå¯ä»¥ç¡®ä¿ä¸ä¼šä¸¢å¤±ä»»ä½•æ¶ˆæ¯ã€‚</p>
<p><img src="/p/d8b7ee3/RabbitMQ-%E6%B6%88%E6%81%AF%E8%87%AA%E5%8A%A8%E9%87%8D%E6%96%B0%E5%85%A5%E9%98%9F%E6%9C%BA%E5%88%B6.png" alt="image-20210619230427516"></p>
<h2 id="æ¶ˆæ¯æ‰‹åŠ¨åº”ç­”æ³¨æ„äº‹é¡¹"><a href="#æ¶ˆæ¯æ‰‹åŠ¨åº”ç­”æ³¨æ„äº‹é¡¹" class="headerlink" title="æ¶ˆæ¯æ‰‹åŠ¨åº”ç­”æ³¨æ„äº‹é¡¹"></a>æ¶ˆæ¯æ‰‹åŠ¨åº”ç­”æ³¨æ„äº‹é¡¹</h2><p>æ‰‹åŠ¨åº”ç­”å°±æ˜¯æ‰‹åŠ¨æ§åˆ¶ä»€ä¹ˆæ—¶å€™è¿›è¡ŒACKåº”ç­”ã€‚é»˜è®¤æ¶ˆæ¯é‡‡ç”¨çš„æ˜¯è‡ªåŠ¨åº”ç­”ï¼Œæ‰€ä»¥è¦æƒ³å®ç°æ¶ˆæ¯æ¶ˆè´¹è¿‡ç¨‹ä¸­ä¸ä¸¢å¤±ï¼Œéœ€è¦æŠŠè‡ªåŠ¨åº”ç­”ä¿®æ”¹ä¸ºæ‰‹åŠ¨åº”ç­”ã€‚</p>
<p><strong>ä»£ç ç¤ºä¾‹</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageConfirmProducer</span> {</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> ACK_QUEUE_NAME;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">"192.168.19.128"</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">        <span class="comment">// å»ºç«‹è¿æ¥</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªè¿æ¥ä¸­çš„channel</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) {</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">"message_"</span> + i;</span><br><span class="line">            channel.basicPublish(<span class="string">""</span>, QUEUE_NAME, <span class="literal">null</span>, (msg).getBytes(StandardCharsets.UTF_8));</span><br><span class="line">            System.out.println(<span class="string">"æ¶ˆæ¯["</span> + msg + <span class="string">"]å‘é€å®Œæˆ"</span>);</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ¶ˆè´¹è€…1ã€2ã€3ä»£ç </p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageConfirmConsumer1</span> {</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> ACK_QUEUE_NAME;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">"192.168.19.128"</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// å£°æ˜é˜Ÿåˆ—-channel.queueDeclare(åç§°ï¼Œæ˜¯å¦æŒä¹…åŒ–ï¼Œæ˜¯å¦ç‹¬å æœ¬è¿æ¥,æ˜¯å¦è‡ªåŠ¨åˆ é™¤,é™„åŠ å‚æ•°)</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Consumer</span> <span class="variable">callback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel) {</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> consumerTag æ¶ˆè´¹è€…æ ‡ç­¾ï¼Œåœ¨channel.basicConsumeæ—¶å€™å¯ä»¥æŒ‡å®š</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> envelope æ¶ˆæ¯åŒ…çš„å†…å®¹ï¼Œå¯ä»ä¸­è·å–æ¶ˆæ¯idï¼Œæ¶ˆæ¯routingkeyï¼Œäº¤æ¢æœºï¼Œæ¶ˆæ¯å’Œé‡ä¼ æ ‡å¿—(æ”¶åˆ°æ¶ˆæ¯å¤±è´¥åæ˜¯å¦éœ€è¦é‡æ–°å‘é€)</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> properties  å±æ€§ä¿¡æ¯(ç”Ÿäº§è€…çš„å‘é€æ—¶æŒ‡å®š)</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> body æ¶ˆæ¯å†…å®¹</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@throws</span> IOException e</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="type">byte</span>[] body)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">                <span class="comment">//è·¯ç”±çš„key</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">routingKey</span> <span class="operator">=</span> envelope.getRoutingKey();</span><br><span class="line">                <span class="comment">//è·å–äº¤æ¢æœºä¿¡æ¯</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">exchange</span> <span class="operator">=</span> envelope.getExchange();</span><br><span class="line">                <span class="comment">//è·å–æ¶ˆæ¯ID</span></span><br><span class="line">                <span class="type">long</span> <span class="variable">deliveryTag</span> <span class="operator">=</span> envelope.getDeliveryTag();</span><br><span class="line">                <span class="comment">//è·å–æ¶ˆæ¯ä¿¡æ¯</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(body, StandardCharsets.UTF_8);</span><br><span class="line">                System.out.println(<span class="string">"routingKey:"</span> + routingKey +</span><br><span class="line">                        <span class="string">",exchange:"</span> + exchange +</span><br><span class="line">                        <span class="string">",deliveryTag:"</span> + deliveryTag +</span><br><span class="line">                        <span class="string">",message:"</span> + message);</span><br><span class="line">                <span class="comment">// è®¾ç½®ä¸ºä¸æ‰¹é‡åº”ç­”</span></span><br><span class="line">                <span class="type">boolean</span> <span class="variable">multiple</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">                <span class="comment">// deliveryTagæ˜¯æ¶ˆæ¯æ ‡è®°tag</span></span><br><span class="line">                channel.basicAck(deliveryTag, multiple);</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">autoAck</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        channel.basicConsume(QUEUE_NAME, autoAck, callback);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</body></html>]]></content>
      <tags>
        <tag>æ¶ˆæ¯ä¸­é—´ä»¶</tag>
        <tag>RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMQæ¶ˆæ¯çš„å‘å¸ƒç¡®è®¤(ä¸Š)</title>
    <url>/p/607540b1.html</url>
    <content><![CDATA[<html><head></head><body><p>åœºæ™¯æè¿°ï¼šæ¶ˆæ¯æŒä¹…åŒ–æ˜¯æŒ‡æ¶ˆæ¯ä¿å­˜åœ¨ç£ç›˜ä¸Šï¼Œå¦‚æœæ¶ˆæ¯è¿˜æ²¡æ¥å¾—åŠå†™å…¥ç£ç›˜å°±å‘ç”Ÿå®•æœºï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¸€æ ·ä¼šå‘ç”Ÿä¸¢å¤±ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼šç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„åˆ°äº†æ‰€æœ‰åŒ¹é…çš„é˜Ÿåˆ—ä¹‹åï¼Œé˜Ÿåˆ—å†™å…¥ç£ç›˜æˆåŠŸåå†å›å¤ç”Ÿäº§è€…ã€‚</p>
<blockquote>
<p><strong>å¦‚ä½•100%ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ</strong></p>
</blockquote>
<p>åšå¥½è¿™ä¸‰æ­¥ï¼Œæ¶ˆæ¯æ‰èƒ½ç»å¯¹ä¸ä¸¢å¤±ï¼š</p>
<p>â‘ é˜Ÿåˆ—æŒä¹…åŒ–</p>
<p>â‘¡é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æŒä¹…åŒ–</p>
<p>â‘¢å‘å¸ƒç¡®è®¤</p>
<h2 id="å‘å¸ƒç¡®è®¤åŸç†"><a href="#å‘å¸ƒç¡®è®¤åŸç†" class="headerlink" title="å‘å¸ƒç¡®è®¤åŸç†"></a>å‘å¸ƒç¡®è®¤åŸç†</h2><p>â€‹        ç”Ÿäº§è€…å°†ä¿¡é“è®¾ç½®æˆ confirm æ¨¡å¼ï¼Œä¸€æ—¦ä¿¡é“è¿›å…¥ confirm æ¨¡å¼ï¼Œ<strong>æ‰€æœ‰åœ¨è¯¥ä¿¡é“ä¸Šé¢å‘å¸ƒçš„æ¶ˆæ¯éƒ½å°†ä¼šè¢«æŒ‡æ´¾ä¸€ä¸ªå”¯ä¸€çš„ ID</strong>(ä» 1 å¼€å§‹)ï¼Œä¸€æ—¦æ¶ˆæ¯è¢«æŠ•é€’åˆ°æ‰€æœ‰åŒ¹é…çš„é˜Ÿåˆ—ä¹‹åï¼Œbrokerå°±ä¼šå‘é€ä¸€ä¸ªç¡®è®¤ç»™ç”Ÿäº§è€…(åŒ…å«æ¶ˆæ¯çš„å”¯ä¸€ ID)ï¼Œè¿™å°±ä½¿å¾—ç”Ÿäº§è€…çŸ¥é“æ¶ˆæ¯å·²ç»æ­£ç¡®åˆ°è¾¾ç›®çš„é˜Ÿåˆ—äº†ï¼Œå¦‚æœæ¶ˆæ¯å’Œé˜Ÿåˆ—æ˜¯å¯æŒä¹…åŒ–çš„ï¼Œé‚£ä¹ˆç¡®è®¤æ¶ˆæ¯ä¼šåœ¨å°†æ¶ˆæ¯å†™å…¥ç£ç›˜ä¹‹åå‘å‡ºï¼Œbroker å›ä¼ ç»™ç”Ÿäº§è€…çš„ç¡®è®¤æ¶ˆæ¯ä¸­ delivery-tag åŸŸåŒ…å«äº†ç¡®è®¤æ¶ˆæ¯çš„åºåˆ—å·ï¼Œæ­¤å¤– broker ä¹Ÿå¯ä»¥è®¾ç½®basic.ack çš„ multiple åŸŸï¼Œè¡¨ç¤ºåˆ°è¿™ä¸ªåºåˆ—å·ä¹‹å‰çš„æ‰€æœ‰æ¶ˆæ¯éƒ½å·²ç»å¾—åˆ°äº†å¤„ç†ã€‚</p>
<p>â€‹        confirm æ¨¡å¼æœ€å¤§çš„å¥½å¤„åœ¨äºä»–æ˜¯å¼‚æ­¥çš„ï¼Œä¸€æ—¦å‘å¸ƒä¸€æ¡æ¶ˆæ¯ï¼Œç”Ÿäº§è€…åº”ç”¨ç¨‹åºå°±å¯ä»¥åœ¨ç­‰ä¿¡é“è¿”å›ç¡®è®¤çš„åŒæ—¶ç»§ç»­å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯ï¼Œå½“æ¶ˆæ¯æœ€ç»ˆå¾—åˆ°ç¡®è®¤ä¹‹åï¼Œç”Ÿäº§è€…åº”ç”¨ä¾¿å¯ä»¥é€šè¿‡å›è°ƒæ–¹æ³•æ¥å¤„ç†è¯¥ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚æœ RabbitMQ å› ä¸ºè‡ªèº«å†…éƒ¨é”™è¯¯å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œå°±ä¼šå‘é€ä¸€æ¡ nack æ¶ˆæ¯ï¼Œç”Ÿäº§è€…åº”ç”¨ç¨‹åºåŒæ ·å¯ä»¥åœ¨å›è°ƒæ–¹æ³•ä¸­å¤„ç†è¯¥ nack æ¶ˆæ¯ã€‚</p>
<h2 id="å‘å¸ƒç¡®è®¤ç­–ç•¥"><a href="#å‘å¸ƒç¡®è®¤ç­–ç•¥" class="headerlink" title="å‘å¸ƒç¡®è®¤ç­–ç•¥"></a>å‘å¸ƒç¡®è®¤ç­–ç•¥</h2><p>å‘å¸ƒç¡®è®¤é»˜è®¤æ˜¯æ²¡æœ‰å¼€å¯çš„ï¼Œå¦‚æœè¦å¼€å¯éœ€è¦è°ƒç”¨æ–¹æ³• confirmSelectã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">channel.confirmSelect();</span><br></pre></td></tr></tbody></table></figure>

<p>å‘å¸ƒä¸€æ¡æ¶ˆæ¯ç¡®è®¤ä¸€æ¬¡ï¼Œè¿˜æ˜¯å‘å¸ƒä¸€æ‰¹æ¶ˆæ¯ç¡®è®¤ä¸€æ¬¡å‘¢ï¼ŸRabbitMQæä¾›äº†ä»¥ä¸‹å‡ ç§ç­–ç•¥ï¼š</p>
<h3 id="å•ä¸ªå‘å¸ƒç¡®è®¤"><a href="#å•ä¸ªå‘å¸ƒç¡®è®¤" class="headerlink" title="å•ä¸ªå‘å¸ƒç¡®è®¤"></a>å•ä¸ªå‘å¸ƒç¡®è®¤</h3><p>â€‹        å‘ä¸€æ¡ç¡®è®¤ä¸€æ¡ï¼Œç¡®è®¤åæ‰èƒ½ç»§ç»­å‘é€ä¸‹ä¸€æ¡ã€‚è¿™æ˜¯ä¸€ç§ç®€å•çš„ç¡®è®¤æ–¹å¼ï¼Œå®ƒæ˜¯ä¸€ç§<strong>åŒæ­¥ç¡®è®¤å‘å¸ƒ</strong>çš„æ–¹å¼ã€‚waitForConfirmsOrDie(long)è¿™ä¸ªæ–¹æ³•åªæœ‰åœ¨æ¶ˆæ¯è¢«ç¡®è®¤çš„æ—¶å€™æ‰è¿”å›ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´èŒƒå›´å†…è¿™ä¸ªæ¶ˆæ¯æ²¡æœ‰è¢«ç¡®è®¤é‚£ä¹ˆå®ƒå°†æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>â€‹        è¿™ç§ç¡®è®¤æ–¹å¼æœ‰ä¸€ä¸ªæœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯ï¼š<strong>å‘å¸ƒé€Ÿåº¦ç‰¹åˆ«æ…¢ï¼Œ</strong>å› ä¸ºå¦‚æœæ²¡æœ‰ç¡®è®¤å‘å¸ƒçš„æ¶ˆæ¯å°±ä¼šé˜»å¡æ‰€æœ‰åç»­æ¶ˆæ¯çš„å‘å¸ƒï¼Œè¿™ç§æ–¹å¼æœ€å¤šæä¾›æ¯ç§’ä¸è¶…è¿‡æ•°ç™¾æ¡å‘å¸ƒæ¶ˆæ¯çš„ååé‡ã€‚å½“ç„¶å¯¹äºæŸäº›åº”ç”¨ç¨‹åºæ¥è¯´è¿™å¯èƒ½å·²ç»è¶³å¤Ÿäº†ã€‚</p>
<p><strong>ä»£ç å®ç°</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">"confirm"</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">singleConfirm</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">    <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> getChannel();</span><br><span class="line">    <span class="comment">// ç»‘å®šé˜Ÿåˆ—</span></span><br><span class="line">    channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="comment">// å¼€å¯å‘å¸ƒç¡®è®¤æœºåˆ¶</span></span><br><span class="line">    channel.confirmSelect();</span><br><span class="line">    <span class="comment">// ç”¨äºç»Ÿè®¡å‘é€1000æ¡æ¶ˆæ¯èŠ±è´¹çš„æ—¶é—´</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">1000</span>; i++) {</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">"message_"</span> + i;</span><br><span class="line">        channel.basicPublish(<span class="string">""</span>, QUEUE_NAME, <span class="literal">null</span>, (msg).getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> channel.waitForConfirms();</span><br><span class="line">        <span class="keyword">if</span> (flag) {</span><br><span class="line">            System.out.println(<span class="string">"æ¶ˆæ¯["</span> + msg + <span class="string">"]å‘é€å®Œæˆ"</span>);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            System.err.println(<span class="string">"æ¶ˆæ¯["</span> + msg + <span class="string">"]å‘é€å¤±è´¥"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">"å‘é€æ¶ˆæ¯å®Œæˆï¼Œè€—æ—¶ï¼š"</span> + (end - start) + <span class="string">"ms"</span>);</span><br><span class="line">}</span><br><span class="line"><span class="comment">// æŠ½å–æ–¹æ³•</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Channel <span class="title function_">getChannel</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TimeoutException {</span><br><span class="line">    <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">    connectionFactory.setHost(<span class="string">"192.168.19.128"</span>);</span><br><span class="line">    connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">    connectionFactory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">    connectionFactory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">    <span class="keyword">return</span> connection.createChannel();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰§è¡Œç»“æœ</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">å‘é€æ¶ˆæ¯å®Œæˆï¼Œè€—æ—¶ï¼š686ms</span><br></pre></td></tr></tbody></table></figure>

<h3 id="æ‰¹é‡ç¡®è®¤å‘å¸ƒ"><a href="#æ‰¹é‡ç¡®è®¤å‘å¸ƒ" class="headerlink" title="æ‰¹é‡ç¡®è®¤å‘å¸ƒ"></a>æ‰¹é‡ç¡®è®¤å‘å¸ƒ</h3><p>å•ä¸ªå‘å¸ƒç¡®è®¤çš„æ–¹å¼éå¸¸æ…¢ï¼Œæ‰¹é‡å‘å¸ƒä¸ä¹‹ç›¸æ¯”ï¼Œå…ˆå‘å¸ƒä¸€æ‰¹æ¶ˆæ¯ç„¶åä¸€èµ·ç¡®è®¤å¯ä»¥æå¤§åœ°æé«˜ååé‡ï¼Œå½“ç„¶è¿™ç§æ–¹å¼çš„ç¼ºç‚¹å°±æ˜¯ï¼šå½“å‘ç”Ÿæ•…éšœå¯¼è‡´å‘å¸ƒå‡ºç°é—®é¢˜æ—¶ï¼Œä¸çŸ¥é“æ˜¯å“ªä¸ªæ¶ˆæ¯å‡ºç°é—®é¢˜äº†ï¼Œæˆ‘ä»¬å¿…é¡»å°†æ•´ä¸ªæ‰¹å¤„ç†ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œä»¥è®°å½•é‡è¦çš„ä¿¡æ¯è€Œåé‡æ–°å‘å¸ƒæ¶ˆæ¯ã€‚å½“ç„¶è¿™ç§æ–¹æ¡ˆä»ç„¶æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿä¸€æ ·é˜»å¡æ¶ˆæ¯çš„å‘å¸ƒã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">multipleConfirm</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">    <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> getChannel();</span><br><span class="line">    <span class="comment">// ç»‘å®šé˜Ÿåˆ—</span></span><br><span class="line">    channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="comment">// å¼€å¯å‘å¸ƒç¡®è®¤æœºåˆ¶</span></span><br><span class="line">    channel.confirmSelect();</span><br><span class="line">    <span class="comment">// ç”¨äºç»Ÿè®¡å‘é€1000æ¡æ¶ˆæ¯èŠ±è´¹çš„æ—¶é—´</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="comment">// æ‰¹é‡ç¡®è®¤æ¶ˆæ¯å¤§å°</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">batchSize</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">1000</span>; i++) {</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">"message_"</span> + i;</span><br><span class="line">        channel.basicPublish(<span class="string">""</span>, QUEUE_NAME, <span class="literal">null</span>, (msg).getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        <span class="comment">// æ¯å‘å¸ƒ200æ¡æ¶ˆæ¯ç¡®è®¤ä¸€æ¬¡</span></span><br><span class="line">        <span class="keyword">if</span> (i % batchSize == <span class="number">0</span>) {</span><br><span class="line">            channel.waitForConfirms();</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">"æ¶ˆæ¯["</span> + msg + <span class="string">"]å‘é€å®Œæˆ"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">"å‘é€æ¶ˆæ¯å®Œæˆï¼Œè€—æ—¶ï¼š"</span> + (end - start) + <span class="string">"ms"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰§è¡Œç»“æœ</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">å‘é€æ¶ˆæ¯å®Œæˆï¼Œè€—æ—¶ï¼š109ms</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰¹é‡ä¸å•ä¸ªå‘å¸ƒç¡®è®¤ç›¸æ¯”ï¼Œæ‰¹é‡é«˜æ•ˆäº†è®¸å¤šï¼Œä½†æ˜¯å¯é æ€§æ¬ ç¼ºã€‚è¿˜æœ‰ä¸€ç§å‘å¸ƒç¡®è®¤çš„ç­–ç•¥å³é«˜æ•ˆåˆå¯é ã€‚</p>
<h3 id="å¼‚æ­¥ç¡®è®¤å‘å¸ƒ"><a href="#å¼‚æ­¥ç¡®è®¤å‘å¸ƒ" class="headerlink" title="å¼‚æ­¥ç¡®è®¤å‘å¸ƒ"></a>å¼‚æ­¥ç¡®è®¤å‘å¸ƒ</h3><p>â€‹        å¼‚æ­¥ç¡®è®¤è™½ç„¶ç¼–ç¨‹é€»è¾‘æ¯”ä¸Šä¸¤ä¸ªè¦å¤æ‚ï¼Œä½†æ˜¯æ€§ä»·æ¯”æœ€é«˜ï¼Œæ— è®ºæ˜¯å¯é æ€§è¿˜æ˜¯æ•ˆç‡éƒ½æ²¡å¾—è¯´ï¼Œä»–æ˜¯åˆ©ç”¨å›è°ƒå‡½æ•°æ¥è¾¾åˆ°æ¶ˆæ¯å¯é æ€§ä¼ é€’çš„ï¼Œè¿™ä¸ªä¸­é—´ä»¶ä¹Ÿæ˜¯é€šè¿‡å‡½æ•°å›è°ƒæ¥ä¿è¯æ˜¯å¦æŠ•é€’æˆåŠŸï¼Œä¸‹é¢å°±è®©æˆ‘ä»¬æ¥è¯¦ç»†è®²è§£å¼‚æ­¥ç¡®è®¤æ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">asyncConfirm</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">    <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> getChannel();</span><br><span class="line">    <span class="comment">// ç»‘å®šé˜Ÿåˆ—</span></span><br><span class="line">    channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="comment">// å¼€å¯å‘å¸ƒç¡®è®¤æœºåˆ¶</span></span><br><span class="line">    channel.confirmSelect();</span><br><span class="line">    <span class="comment">// ackæˆåŠŸçš„æ¶ˆæ¯å›è°ƒ</span></span><br><span class="line">    <span class="type">ConfirmCallback</span> <span class="variable">ackCallback</span> <span class="operator">=</span> (deliveryTag, multiple) -&gt; {</span><br><span class="line">        System.out.println(<span class="string">"æ¶ˆæ¯["</span> + deliveryTag + <span class="string">"]å‘é€å®Œæˆ"</span>);</span><br><span class="line">    };</span><br><span class="line">    <span class="comment">// ackå¤±è´¥çš„æ¶ˆæ¯å›è°ƒ - æš‚ä¸å¤„ç†</span></span><br><span class="line">    <span class="type">ConfirmCallback</span> <span class="variable">nackCallback</span> <span class="operator">=</span> (deliveryTag, multiple) -&gt; {</span><br><span class="line">        System.out.println(<span class="string">"æ¶ˆæ¯["</span> + deliveryTag + <span class="string">"]å‘é€å¤±è´¥"</span>);</span><br><span class="line">    };</span><br><span class="line">    <span class="comment">// è®¾ç½®ç›‘å¬å™¨ - å¼‚æ­¥é€šçŸ¥</span></span><br><span class="line">    channel.addConfirmListener(ackCallback, nackCallback);</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) {</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">"message_"</span> + i;</span><br><span class="line">        channel.basicPublish(<span class="string">""</span>, QUEUE_NAME, <span class="literal">null</span>, (msg).getBytes(StandardCharsets.UTF_8));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">"å‘é€æ¶ˆæ¯å®Œæˆï¼Œè€—æ—¶ï¼š"</span> + (end - start) + <span class="string">"ms"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰§è¡Œç»“æœ</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">å‘é€æ¶ˆæ¯å®Œæˆï¼Œè€—æ—¶ï¼š53ms</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p><strong>å¦‚ä½•å¤„ç†ackå¤±è´¥çš„æ¶ˆæ¯ï¼Ÿ</strong></p>
</blockquote>
<p>å°†æ¶ˆæ¯æ”¾å›é˜Ÿåˆ—ç»§ç»­å‘é€å³å¯ï¼Œç›´åˆ°è¯¥æ¶ˆæ¯å‘é€æˆåŠŸã€‚</p>
<p>ä»£ç å®ç°æ€è·¯ï¼šä½¿ç”¨ä¸€ä¸ªå®¹å™¨ï¼ˆCollectionæˆ–Mapå®¹å™¨ï¼‰è£…ä¸‹å‘é€çš„å…¨éƒ¨æ¶ˆæ¯ï¼Œåœ¨ACKæˆåŠŸçš„å›è°ƒæ–¹æ³•ä¸­ç§»é™¤è¯¥å…ƒç´ ï¼Œå‰©ä¸‹çš„å°±æ˜¯ACKå¤±è´¥çš„æ¶ˆæ¯ã€‚</p>
<p>éœ€è¦ä¿å­˜æ¶ˆæ¯IDä»¥åŠå¯¹åº”çš„æ¶ˆæ¯å†…å®¹ï¼Œåˆ é™¤çš„æ—¶å€™éœ€è¦æ ¹æ®IDæ¥åˆ ï¼Œæ‰€ä»¥å®¹å™¨é€‰ç”¨Mapï¼ŒMapä¸­å¹¶å‘ç¯å¢ƒä¸‹çš„æœ€å¥½çš„é€‰æ‹©æ˜¯ConcurrentHashMapå’ŒConcurrentSkipListMapï¼ŒConcurrentHashMapä¸èƒ½ä¿è¯å…ƒç´ çš„æœ‰åºæ€§ï¼Œæ‰€ä»¥ä½¿ç”¨è·³è¡¨ConcurrentSkipListMapï¼Œå…¶åº•å±‚æ˜¯åŒå‘é“¾è¡¨çš„æ•°æ®ç»“æ„å¹¶ä¸”å¦å¤–ç»´æŠ¤äº†ä¸€ä¸ªå¤šå±‚çº§ç´¢å¼•é“¾è¡¨ï¼Œç‰¹æ€§æ˜¯å¢åˆ å¿«æœ‰åºï¼ˆé“¾è¡¨ç‰¹æ€§ï¼‰ã€æŸ¥è¯¢é€Ÿåº¦å¿«ï¼ˆå¯ä»¥ä»£æ›¿å¹³è¡¡æ ‘çš„æ•°æ®ç»“æ„ï¼‰ã€‚</p>
<p><strong>ä»£ç å®ç°</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> ConcurrentSkipListMap&lt;Long, String&gt; messages = <span class="keyword">new</span> <span class="title class_">ConcurrentSkipListMap</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">asyncConfirm</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">    <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> getChannel();</span><br><span class="line">    <span class="comment">// ç»‘å®šé˜Ÿåˆ—</span></span><br><span class="line">    channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="comment">// å¼€å¯å‘å¸ƒç¡®è®¤æœºåˆ¶</span></span><br><span class="line">    channel.confirmSelect();</span><br><span class="line">    <span class="comment">// ackæˆåŠŸçš„æ¶ˆæ¯å›è°ƒ</span></span><br><span class="line">    <span class="type">ConfirmCallback</span> <span class="variable">ackCallback</span> <span class="operator">=</span> (deliveryTag, multiple) -&gt; {</span><br><span class="line">        <span class="keyword">if</span> (multiple) {</span><br><span class="line">            ConcurrentNavigableMap&lt;Long, String&gt; confirmed = messages.headMap(deliveryTag);</span><br><span class="line">            confirmed.clear();</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            messages.remove(deliveryTag);</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">"æ¶ˆæ¯tag["</span> + deliveryTag + <span class="string">"]å·²ç¡®è®¤"</span>);</span><br><span class="line">    };</span><br><span class="line">    <span class="comment">// ackå¤±è´¥çš„æ¶ˆæ¯å›è°ƒ</span></span><br><span class="line">    <span class="type">ConfirmCallback</span> <span class="variable">nackCallback</span> <span class="operator">=</span> (deliveryTag, multiple) -&gt; {</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> messages.get(deliveryTag);</span><br><span class="line">        <span class="comment">// é‡æ–°å‘é€</span></span><br><span class="line">        channel.basicPublish(<span class="string">""</span>, QUEUE_NAME, <span class="literal">null</span>, (message).getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        System.out.println(<span class="string">"æ¶ˆæ¯tag["</span> + deliveryTag + <span class="string">"]æ¶ˆæ¯å†…å®¹["</span> + message + <span class="string">"]æœªç¡®è®¤"</span>);</span><br><span class="line">    };</span><br><span class="line">    <span class="comment">// è®¾ç½®ç›‘å¬å™¨ - å¼‚æ­¥é€šçŸ¥</span></span><br><span class="line">    channel.addConfirmListener(ackCallback, nackCallback);</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) {</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">"message_"</span> + i;</span><br><span class="line">        channel.basicPublish(<span class="string">""</span>, QUEUE_NAME, <span class="literal">null</span>, (msg).getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        <span class="comment">// kä¸ºæ¶ˆæ¯åºå·ï¼Œvä¸ºæ¶ˆæ¯å†…å®¹å­˜å…¥Map</span></span><br><span class="line">        messages.put(channel.getNextPublishSeqNo(), msg);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">"å‘é€æ¶ˆæ¯å®Œæˆï¼Œè€—æ—¶ï¼š"</span> + (end - start) + <span class="string">"ms"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</body></html>]]></content>
      <tags>
        <tag>æ¶ˆæ¯ä¸­é—´ä»¶</tag>
        <tag>RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMQæ¶ˆæ¯çš„å‘å¸ƒç¡®è®¤(ä¸‹)</title>
    <url>/p/796e71f0.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="ç¡®è®¤æœºåˆ¶æ–¹æ¡ˆ"><a href="#ç¡®è®¤æœºåˆ¶æ–¹æ¡ˆ" class="headerlink" title="ç¡®è®¤æœºåˆ¶æ–¹æ¡ˆ"></a>ç¡®è®¤æœºåˆ¶æ–¹æ¡ˆ</h2><p>â€‹        åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç”±äºä¸€äº›ä¸æ˜åŸå› ï¼Œå¯¼è‡´rabbitmqé‡å¯ï¼Œåœ¨RabbitMQé‡å¯æœŸé—´ç”Ÿäº§è€…æ¶ˆæ¯æŠ•é€’å¤±è´¥ï¼Œå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†å’Œæ¢å¤ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å¼€å§‹æ€è€ƒï¼Œå¦‚ä½•æ‰èƒ½è¿›è¡ŒRabbitMQçš„æ¶ˆæ¯å¯é æŠ•é€’å‘¢ï¼Ÿç‰¹åˆ«æ˜¯åœ¨è¿™æ ·æ¯”è¾ƒæç«¯çš„æƒ…å†µï¼ŒRabbitMQé›†ç¾¤ä¸å¯ç”¨çš„æ—¶å€™ï¼Œæ— æ³•æŠ•é€’çš„æ¶ˆæ¯è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">åº”ç”¨[xxx]åœ¨[08-1516:36:04]å‘ç”Ÿ[é”™è¯¯æ—¥å¿—å¼‚å¸¸]ï¼ŒalertId=[xxx]ã€‚ç”±[org.springframework.amqp.rabbit.listener.BlockingQueueConsumer:start:620]è§¦å‘ã€‚</span><br><span class="line">åº”ç”¨xxxå¯èƒ½åŸå› å¦‚ä¸‹</span><br><span class="line">æœåŠ¡åä¸ºï¼šxxx</span><br><span class="line">å¼‚å¸¸ä¸ºï¼šorg.springframework.amqp.rabbit.listener.BlockingQueueConsumer:start:620,</span><br><span class="line">äº§ç”ŸåŸå› å¦‚ä¸‹:1.org.springframework.amqp.rabbit.listener.QueuesNotAvailableException:</span><br><span class="line">Cannotpreparequeueforlistener.Eitherthequeuedoesn'texistorthebrokerwillnot</span><br><span class="line">allowustouseit.||Consumerreceivedfatal=falseexceptiononstartup:</span><br></pre></td></tr></tbody></table></figure>

<p>ç»“åˆä¸‹é¢çš„ä¸€ç§ç¡®è®¤æœºåˆ¶æ–¹æ¡ˆå†ä¸€èµ·åˆ†æä¸€ä¸‹æ¶ˆæ¯ä¸¢å¤±åº”è¯¥å¦‚ä½•å¤„ç†ï¼š</p>
<p><img src="/p/796e71f0/RabbitMQ-%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%E6%9C%BA%E5%88%B6%E6%96%B9%E6%A1%88-%E9%AB%98%E7%BA%A7%E7%AF%87.png" alt="image-20210625201209218"></p>
<p>â€‹        é€šè¿‡ä¸¤ä¸ªå¼‚å¸¸æ¥çœ‹èƒ½å¤Ÿç¡®å®š RabbitMQ æœåŠ¡å™¨å·²ç»å®•æœºäº†ã€‚ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°RabbitMQ ä¸­çš„äº¤æ¢æœºXï¼Œéšåè½¬å‘ç»™ç»‘å®šäº†è¯¥è·¯ç”±é”®çš„é˜Ÿåˆ—ï¼Œæ­¤æ—¶å½“RabbitMQå®•æœºäº†ï¼Œæ— è®ºæ­¤æ—¶çš„äº¤æ¢æœºæ˜¯å¦å­˜åœ¨ï¼Œé‚£ä¹ˆæ¶ˆæ¯éƒ½å°†ç›´æ¥ä¸¢å¤±äº†ã€‚æ— è®ºäº¤æ¢æœºæ˜¯å¦å­˜åœ¨ï¼Œåªè¦æ¶ˆæ¯æ²¡å‘å‡ºå»ï¼Œå°±å¯ä»¥å­˜æ”¾åœ¨ç¼“å­˜ä¸­ï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºæˆ–è€…äº¤æ¢æœºæŠ•é€’æ¶ˆæ¯åˆ°é˜Ÿåˆ—ï¼Œéƒ½æ˜¯ä¸çŸ¥é“æ¶ˆæ¯æœ‰æ²¡æœ‰å‘é€æˆåŠŸçš„ï¼Œäº¤æ¢æœºæŠ•é€’å¤±è´¥çš„æ¶ˆæ¯æ˜¯ä¸èƒ½ç¡®å®šçš„ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨ç¼“å­˜ï¼Œä½†ç”Ÿäº§è€…æœ‰å‘å¸ƒç¡®è®¤çš„æœºåˆ¶ã€‚</p>
<p>â€‹        å¯¹äºç”Ÿäº§è€…æŠ•é€’å¤±è´¥çš„æ¶ˆæ¯å¤„ç†æ–¹æ¡ˆæ˜¯å¼€å¯ç¡®è®¤æœºåˆ¶ï¼Œç”Ÿäº§è€…å°†æ²¡æœ‰å‘é€æˆåŠŸçš„æ¶ˆæ¯ä¿å­˜åˆ°ç¼“å­˜ï¼Œåœ¨å†™ä¸ªå®šæ—¶ä»»åŠ¡é‡å‘ç¼“å­˜ä¸­çš„æ¶ˆæ¯ã€‚é‚£ä¹ˆäº¤æ¢æœºæŠ•é€’å¤±è´¥çš„æ¶ˆæ¯åº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ</p>
<p>å…ˆå†™ä¸€ä¸ªç®€å•å®ç°ä¸‹é¢è¿™ä¸ªç¡®è®¤å‘å¸ƒçš„åœºæ™¯ï¼š</p>
<p><img src="/p/796e71f0/RabbitMQ-%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0%E9%80%BB%E8%BE%91-%E9%AB%98%E7%BA%A7%E7%AF%87.png" alt="image-20210625220807639"></p>
<p>ç»“åˆSpringBootå¯¹è¿™äº›ç»„ä»¶è¿›è¡Œæ³¨å†Œå’Œç»‘å®šï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfirmConfig</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(CONFIRM_EXCHANGE_NAME)</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">confirmExchange</span><span class="params">()</span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(CONFIRM_EXCHANGE_NAME);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(CONFIRM_QUEUE_NAME)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">confirmQueue</span><span class="params">()</span>{</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(CONFIRM_QUEUE_NAME).build();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">confirmQueueBinDingExchange</span><span class="params">(<span class="meta">@Qualifier(CONFIRM_QUEUE_NAME)</span> Queue queue,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@Qualifier(CONFIRM_EXCHANGE_NAME)</span> DirectExchange exchange)</span>{</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(exchange).with(ROUTING_KEY_CONFIRM);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç”Ÿäº§è€…</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/confirm")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfirmMessageProducer</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ­£å¸¸æ¥æ”¶æ¶ˆæ¯çš„æƒ…å†µ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping("/sendMsg/{msg}")</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(<span class="meta">@PathVariable("msg")</span> String msg)</span> {</span><br><span class="line">        rabbitTemplate.convertAndSend(MqConstant.CONFIRM_EXCHANGE_NAME, MqConstant.ROUTING_KEY_CONFIRM, msg);</span><br><span class="line">        log.info(<span class="string">"å‘é€æ¶ˆæ¯æˆåŠŸï¼Œæ¶ˆæ¯å†…å®¹ï¼š{}"</span>, msg);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ¶ˆè´¹è€…</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfirmMessageConsumer</span> {</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ­£å¸¸å‘é€æ¶ˆæ¯çš„æƒ…å†µ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = {CONFIRM_QUEUE_NAME})</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveConfirmMessage</span><span class="params">(Message message, Channel channel)</span> {</span><br><span class="line">        log.info(<span class="string">"æ¥æ”¶åˆ°é˜Ÿåˆ—ï¼š{}çš„æ¶ˆæ¯ä¸ºï¼š{}"</span>, CONFIRM_QUEUE_NAME, <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>â€‹        ä¸Šé¢æ˜¯æ­£å¸¸æ”¶å‘æ¶ˆæ¯çš„æƒ…å†µã€‚é‚£ä¹ˆå½“æ¶ˆè´¹è€…ç»™äº¤æ¢æœºå‘é€æ¶ˆæ¯æ—¶ï¼Œæ­¤æ—¶äº¤æ¢æœºæ­£å¤„äºå¼‚å¸¸çŠ¶æ€ï¼ˆé‡å¯ã€æ–­ç½‘ç­‰å„ç§æƒ…å†µï¼‰ï¼Œåº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿåˆ©ç”¨RabbitMQæä¾›çš„å›è°ƒæ¥å£æ¥å¤„ç†å¼‚å¸¸æƒ…å†µã€‚</p>
<h2 id="å›è°ƒæ¶ˆæ¯"><a href="#å›è°ƒæ¶ˆæ¯" class="headerlink" title="å›è°ƒæ¶ˆæ¯"></a>å›è°ƒæ¶ˆæ¯</h2><h3 id="publisher-confirm-type"><a href="#publisher-confirm-type" class="headerlink" title="publisher-confirm-type"></a>publisher-confirm-type</h3><p>â€‹        é¦–å…ˆéœ€è¦åœ¨ properties.yml ä¸­å¼€å¯å‘å¸ƒç¡®è®¤æ¨¡å¼çš„é…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">publisher-confirm-type:</span> <span class="string">correlated</span></span><br></pre></td></tr></tbody></table></figure>

<p>publisher-confirm-typeå±æ€§æœ‰ä¸‰ä¸ªå¯é€‰å€¼ï¼š</p>
<ul>
<li>noneï¼ˆé»˜è®¤ï¼‰ï¼šå…³é—­å‘å¸ƒç¡®è®¤æ¨¡å¼ã€‚</li>
<li>correlatedï¼šæ¶ˆæ¯ä»ç”Ÿäº§è€…å‘é€åˆ°äº¤æ¢æœºåè§¦å‘å›è°ƒæ–¹æ³•ã€‚</li>
<li>simpleï¼šä¼šè§¦å‘å›è°ƒæ–¹æ³•ï¼Œç›¸å½“äºå•ä¸ªç¡®è®¤ï¼ˆå‘ä¸€æ¡ç¡®è®¤ä¸€æ¡ï¼‰ã€‚åœ¨å‘å¸ƒæ¶ˆæ¯æˆåŠŸåä½¿ç”¨rabbitTemplateè°ƒç”¨waitForConfirmsæˆ–waitForConfirmsOrDieæ–¹æ³•ç­‰å¾…brokerèŠ‚ç‚¹è¿”å›å‘é€ç»“æœï¼Œæ ¹æ®è¿”å›ç»“æœæ¥åˆ¤å®šä¸‹ä¸€æ­¥çš„é€»è¾‘ï¼Œè¦æ³¨æ„çš„ç‚¹æ˜¯ waitForConfirmsOrDieæ–¹æ³•å¦‚æœè¿”å›falseåˆ™ä¼šå…³é—­channelï¼Œåˆ™æ¥ä¸‹æ¥æ— æ³•å‘é€æ¶ˆæ¯åˆ°brokerã€‚</li>
</ul>
<h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><p>â€‹        å®ç° RabbitMQTemplate.ConfirmCallBack æ¥å£ï¼Œå®ç°æ¥å£ä¸­çš„ confirm æ–¹æ³•ï¼Œå³å¯è·å¾—æ¶ˆæ¯å‘é€æˆåŠŸè¿˜æ˜¯å‘é€å¤±è´¥çš„çŠ¶æ€ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfirmMessageCallback</span> <span class="keyword">implements</span> <span class="title class_">RabbitTemplate</span>.ConfirmCallback {</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº¤æ¢æœºæ— è®ºæ˜¯å¦æ”¶åˆ°æ¶ˆæ¯çš„å›è°ƒæ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> correlationData æ¶ˆæ¯ç›¸å…³æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ack             äº¤æ¢æœºæ˜¯å¦æ”¶åˆ°æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cause           åŸå› </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(<span class="meta">@Nullable</span> CorrelationData correlationData, <span class="type">boolean</span> ack, <span class="meta">@Nullable</span> String cause)</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> correlationData != <span class="literal">null</span> ? correlationData.getId() : <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">if</span> (ack) {</span><br><span class="line">            log.info(<span class="string">"äº¤æ¢æœºå·²æ”¶åˆ° id={} çš„æ¶ˆæ¯"</span>, id);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            log.info(<span class="string">"äº¤æ¢æœºæœªæ”¶åˆ° id={} çš„æ¶ˆæ¯ï¼ŒåŸå› :{}"</span>, id, cause);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨ ConfirmConfig ä¸­åŠ å…¥é…ç½®ï¼Œç»™ RabbitMQTemplate é…ç½®å…¶å†…éƒ¨å±æ€§ ConfirmCallbackã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setConfirmCallback</span><span class="params">(RabbitTemplate rabbitTemplate)</span>{</span><br><span class="line">    rabbitTemplate.setConfirmCallback(<span class="keyword">new</span> <span class="title class_">ConfirmMessageCallback</span>());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç”Ÿäº§è€…æ–°å¢æµ‹è¯•æ¥å£ï¼Œè°ƒç”¨å¦å¤–ä¸€ä¸ªå‘é€æ¶ˆæ¯çš„æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping("/sendMsgCallback/{msg}")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirmed</span><span class="params">(<span class="meta">@PathVariable("msg")</span> String msg)</span> {</span><br><span class="line">    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">    <span class="comment">// è¯¥å¯¹è±¡å°†åœ¨å›è°ƒæ—¶æºå¸¦åˆ°å›è°ƒæ–¹æ³•ä¸­</span></span><br><span class="line">    <span class="type">CorrelationData</span> <span class="variable">correlationData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(id);</span><br><span class="line"></span><br><span class="line">    rabbitTemplate.convertAndSend(MqConstant.CONFIRM_EXCHANGE_NAME,</span><br><span class="line">                                  MqConstant.ROUTING_KEY_CONFIRM, msg, correlationData);</span><br><span class="line">    log.info(<span class="string">"å‘é€æ¶ˆæ¯æˆåŠŸï¼Œæ¶ˆæ¯id={}ï¼Œå†…å®¹ï¼š{}"</span>, id, msg);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>â€‹        ç°åœ¨è§£å†³äº†æ¶ˆè´¹è€…ç»™äº¤æ¢æœºå‘é€æ¶ˆæ¯æ—¶ï¼Œäº¤æ¢æœºæ­£å¤„äºå¼‚å¸¸çŠ¶æ€çš„æƒ…å†µï¼Œä½†æ˜¯å½“äº¤æ¢æœºå¯ç”¨ï¼Œè€Œé˜Ÿåˆ—ä¸¢å¤±è€Œæ”¶ä¸åˆ°æ¶ˆæ¯çš„æƒ…å†µåº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿè¿›è¡Œæ¶ˆæ¯å›é€€ã€‚</p>
<h2 id="å›é€€æ¶ˆæ¯"><a href="#å›é€€æ¶ˆæ¯" class="headerlink" title="å›é€€æ¶ˆæ¯"></a>å›é€€æ¶ˆæ¯</h2><p>â€‹        åœ¨ç”Ÿäº§è€…å¼€å¯å‘å¸ƒç¡®è®¤æœºåˆ¶åï¼Œèƒ½å¤Ÿç¡®ä¿æ¶ˆæ¯ä»ç”Ÿäº§è€…åˆ°è¾¾äº¤æ¢æœºï¼Œä½†æ˜¯æ— æ³•ç¡®ä¿äº¤æ¢æœºå°†æ¶ˆæ¯å‘é€ç»™é˜Ÿåˆ—ä¸ä¸¢å¤±ã€‚è§£å†³è¿™ä¸ªé—®é¢˜ï¼šåœ¨ç”Ÿäº§è€…å¼€å¯æ¶ˆæ¯å›é€€çš„é…ç½®åï¼Œå½“äº¤æ¢æœºæ— æ³•æ­£å¸¸æŠ•é€’æ—¶ï¼Œä¼šè§¦å‘æ¶ˆæ¯å›é€€çš„å›è°ƒæ–¹æ³•ï¼Œè®©ç”Ÿäº§è€…èƒ½å¤ŸçŸ¥é“å“ªäº›æ¶ˆæ¯å›é€€åå»é‡æ–°å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚</p>
<p>å¼€å¯å›é€€æ¶ˆæ¯çš„é…ç½®</p>
<figure class="highlight yml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">publisher-confirm-type:</span> <span class="string">correlated</span></span><br><span class="line">    <span class="attr">publisher-returns:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">template:</span></span><br><span class="line">      <span class="comment"># trueï¼šäº¤æ¢æœºæ— æ³•å°†æ¶ˆæ¯è¿›è¡Œè·¯ç”±æ—¶ï¼Œä¼šå°†è¯¥æ¶ˆæ¯è¿”å›ç»™ç”Ÿäº§è€…ï¼ˆå›è°ƒæ¶ˆæ¯å›é€€æ¥å£ï¼‰</span></span><br><span class="line">      <span class="comment"># falseï¼šå¦‚æœå‘ç°æ¶ˆæ¯æ— æ³•è¿›è¡Œè·¯ç”±ï¼Œåˆ™ç›´æ¥ä¸¢å¼ƒ</span></span><br><span class="line">      <span class="attr">mandatory:</span> <span class="literal">true</span>  </span><br></pre></td></tr></tbody></table></figure>

<p>å®ç° RabbitTemplate å†…éƒ¨çš„ ReturnsCallback æ¥å£</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfirmMessageReturnCallback</span> <span class="keyword">implements</span> <span class="title class_">RabbitTemplate</span>.ReturnsCallback {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnedMessage</span><span class="params">(<span class="meta">@NonNull</span> ReturnedMessage message)</span> {</span><br><span class="line">        log.info(<span class="string">"æ¶ˆæ¯ {} é€€å›ï¼Œé€€å›åŸå› {},äº¤æ¢æœº{},è·¯ç”±é”®{}"</span>, <span class="keyword">new</span> <span class="title class_">String</span>(message.getMessage().getBody()),</span><br><span class="line">                 message.getReplyText(), message.getExchange(), message.getRoutingKey());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨ConfirmConfigä¸­å°†å›é€€æ¥å£é…ç½®åˆ° RabbitMQTemplate</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setConfirmCallback</span><span class="params">(RabbitTemplate rabbitTemplate)</span>{</span><br><span class="line">    </span><br><span class="line">    rabbitTemplate.setConfirmCallback(<span class="keyword">new</span> <span class="title class_">ConfirmMessageCallback</span>());</span><br><span class="line">    rabbitTemplate.setReturnsCallback(<span class="keyword">new</span> <span class="title class_">ConfirmMessageReturnCallback</span>());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç”Ÿäº§è€…æ–°å¢æ¥å£</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ©ç”¨äº¤æ¢æœºæŠ•é€’æ¶ˆæ¯å¤±è´¥çš„å›è°ƒæ–¹æ³•ï¼Œæ¥å¤„ç†æ¶ˆæ¯æŠ•é€’å¤±è´¥çš„æƒ…å†µ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping("/sendMsgReturnBack/{msg}")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMsgReturnBack</span><span class="params">(<span class="meta">@PathVariable("msg")</span> String msg)</span>{</span><br><span class="line">    <span class="comment">// æŠ•é€’åˆ°ä¸€ä¸ªä¸å­˜åœ¨çš„é˜Ÿåˆ—ï¼Œæµ‹è¯•æ¶ˆæ¯æ˜¯å¦å›è°ƒæˆåŠŸ</span></span><br><span class="line">    <span class="type">CorrelationData</span> <span class="variable">correlationData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(UUID.randomUUID().toString());</span><br><span class="line">    rabbitTemplate.convertAndSend(MqConstant.CONFIRM_EXCHANGE_NAME, <span class="string">"NoSuchRoutingKey"</span>, msg, correlationData);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç¡®ä¿æ¶ˆæ¯å‘é€æˆåŠŸï¼š</p>
<p>1ã€å¼€å¯å‘å¸ƒç¡®è®¤æœºåˆ¶å¹¶ä¸”å®ç°å‘é€æ¶ˆæ¯çš„å›è°ƒæ¥å£æ¥ç¡®ä¿ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°RabbitMQæˆåŠŸã€‚</p>
<p>2ã€å¼€å¯æ¶ˆæ¯å›é€€æœºåˆ¶å’Œmandatoryå‚æ•°ï¼Œè®©æ— æ³•è·¯ç”±çš„æ¶ˆæ¯è¿›è¡Œå›è°ƒï¼Œå¹¶ä¸”å®ç°å›é€€æ¥å£æ¥ç¡®ä¿ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºæŠ•é€’æ¶ˆæ¯å¤±è´¥çš„æ¥å£ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>æ¶ˆæ¯ä¸­é—´ä»¶</tag>
        <tag>RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMQæ¶ˆæ¯æŒä¹…åŒ–</title>
    <url>/p/b760ec60.html</url>
    <content><![CDATA[<html><head></head><body><p>æ‰‹åŠ¨ACKåº”ç­”å¯ä»¥å¤„ç†ä»»åŠ¡ä¸ä¸¢å¤±çš„æƒ…å†µï¼Œä½†æ˜¯å¦‚ä½•ä¿éšœå½“ RabbitMQ æœåŠ¡åœæ‰ä»¥åæ¶ˆæ¯ç”Ÿäº§è€…å‘é€è¿‡æ¥çš„æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ</p>
<p>é»˜è®¤æƒ…å†µä¸‹ RabbitMQ é€€å‡ºæˆ–ç”±äºæŸç§åŸå› å´©æºƒæ—¶ï¼Œå®ƒå¿½è§†é˜Ÿåˆ—å’Œæ¶ˆæ¯ï¼Œé™¤éå‘ŠçŸ¥å®ƒä¸è¦è¿™æ ·åšã€‚ç¡®ä¿æ¶ˆæ¯ä¸ä¼šä¸¢å¤±éœ€è¦åšä¸¤ä»¶äº‹ï¼š<strong>éœ€è¦å°†é˜Ÿåˆ—å’Œæ¶ˆæ¯éƒ½æ ‡è®°ä¸ºæŒä¹…åŒ–</strong>ã€‚</p>
<p>æœ¬ç« èŠ‚å®ç°ç®€å•çš„é˜Ÿåˆ—å’Œæ¶ˆæ¯çš„æŒä¹…åŒ–åŠŸèƒ½ï¼Œæ›´åŠ å¼ºæœ‰åŠ›çš„æŒä¹…åŒ–ç­–ç•¥ï¼Œåœ¨åé¢å‘å¸ƒç¡®è®¤ç« èŠ‚å†è¯¦è¿°ã€‚</p>
<h2 id="é˜Ÿåˆ—æŒä¹…åŒ–"><a href="#é˜Ÿåˆ—æŒä¹…åŒ–" class="headerlink" title="é˜Ÿåˆ—æŒä¹…åŒ–"></a>é˜Ÿåˆ—æŒä¹…åŒ–</h2><p>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„ä¿¡é“éƒ½éœ€è¦å°†ä¸‹é¢çš„ queueDeclare() æ–¹æ³•çš„ durable å±æ€§è®¾ç½®å€¼ä¸º trueã€‚</p>
<p>åœ¨com.rabbitmq.client.Channelç±»ä¸­ï¼Œæœ‰ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Declare a queue</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> queue the name of the queue</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> durable æ˜¯å¦æŒä¹…åŒ–åˆ°ç£ç›˜ true if we are declaring a durable queue (the queue will survive a server restart)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> exclusive true if we are declaring an exclusive queue (restricted to this connection)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> autoDelete true if we are declaring an autodelete queue (server will delete it when no longer in use)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arguments other properties (construction arguments) for the queue</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a declaration-confirm method to indicate the queue was successfully declared</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">Queue.DeclareOk <span class="title function_">queueDeclare</span><span class="params">(String queue, <span class="type">boolean</span> durable, <span class="type">boolean</span> exclusive, <span class="type">boolean</span> autoDelete,</span></span><br><span class="line"><span class="params">                             Map&lt;String, Object&gt; arguments)</span> <span class="keyword">throws</span> IOException;</span><br></pre></td></tr></tbody></table></figure>

<h2 id="æ¶ˆæ¯æŒä¹…åŒ–"><a href="#æ¶ˆæ¯æŒä¹…åŒ–" class="headerlink" title="æ¶ˆæ¯æŒä¹…åŒ–"></a>æ¶ˆæ¯æŒä¹…åŒ–</h2><p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„ä¿¡é“è®¾ç½®ä¸Šå‚æ•° MessageProperties.PERSISTENT_TEXT_PLAINï¼Œè¡¨ç¤ºæ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">channel.basicPublish(<span class="string">""</span>, QUEUE_NAME, MessageProperties.PERSISTENT_TEXT_PLAIN, (msg).getBytes(StandardCharsets.UTF_8));</span><br></pre></td></tr></tbody></table></figure>

</body></html>]]></content>
      <tags>
        <tag>æ¶ˆæ¯ä¸­é—´ä»¶</tag>
        <tag>RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMQæ¶ˆæ¯çš„ä¸å…¬å¹³åˆ†å‘</title>
    <url>/p/3700606c.html</url>
    <content><![CDATA[<html><head></head><body><p>åœ¨æœ€å¼€å§‹çš„æ—¶å€™æˆ‘ä»¬å­¦ä¹ åˆ° RabbitMQ åˆ†å‘æ¶ˆæ¯é‡‡ç”¨çš„è½®è¯¢åˆ†å‘ï¼Œä½†æ˜¯åœ¨æŸç§åœºæ™¯ä¸‹è¿™ç§ç­–ç•¥å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œæ¯”æ–¹è¯´æœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…åœ¨å¤„ç†ä»»åŠ¡ï¼Œå…¶ä¸­æœ‰ä¸ªæ¶ˆè´¹è€… 1 å¤„ç†ä»»åŠ¡çš„é€Ÿåº¦éå¸¸å¿«ï¼Œè€Œå¦å¤–ä¸€ä¸ªæ¶ˆè´¹è€… 2 å¤„ç†é€Ÿåº¦å´å¾ˆæ…¢ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¿˜æ˜¯é‡‡ç”¨è½®è®­åˆ†å‘çš„åŒ–å°±ä¼šåˆ°è¿™å¤„ç†é€Ÿåº¦å¿«çš„è¿™ä¸ªæ¶ˆè´¹è€…å¾ˆå¤§ä¸€éƒ¨åˆ†æ—¶é—´å¤„äºç©ºé—²çŠ¶æ€ï¼Œè€Œå¤„ç†æ…¢çš„é‚£ä¸ªæ¶ˆè´¹è€…ä¸€ç›´åœ¨å¹²æ´»ï¼Œè¿™ç§åˆ†é…æ–¹å¼åœ¨è¿™ç§æƒ…å†µä¸‹å…¶å®å°±ä¸å¤ªå¥½ï¼Œä½†æ˜¯RabbitMQ å¹¶ä¸çŸ¥é“è¿™ç§æƒ…å†µå®ƒä¾ç„¶å¾ˆå…¬å¹³çš„è¿›è¡Œåˆ†å‘ã€‚</p>
<p>ä¸ºäº†é¿å…ä¸Šè¿°æƒ…å†µï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨ä¸å…¬å¹³åˆ†å‘ï¼ˆèƒ½è€…å¤šåŠ³ï¼‰ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½éœ€è¦è®¾ç½®å‚æ•° channel.basicQos(1);</p>
<p><img src="/p/3700606c/RabbitMQ-%E6%B6%88%E6%81%AF%E7%9A%84%E4%B8%8D%E5%85%AC%E5%B9%B3%E5%88%86%E5%8F%91.png" alt="image-20210620163005387"></p>
<p>æ„æ€å°±æ˜¯å¦‚æœè¿™ä¸ªä»»åŠ¡æˆ‘è¿˜æ²¡æœ‰å¤„ç†å®Œæˆ–è€…æˆ‘è¿˜æ²¡æœ‰åº”ç­”ä½ ï¼Œä½ å…ˆåˆ«åˆ†é…ç»™æˆ‘ï¼Œæˆ‘ç›®å‰åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡ï¼Œç„¶årabbitmqå°±ä¼šæŠŠè¯¥ä»»åŠ¡åˆ†é…ç»™æ²¡æœ‰é‚£ä¹ˆå¿™çš„é‚£ä¸ªç©ºé—²æ¶ˆè´¹è€…ï¼Œå½“ç„¶å¦‚æœæ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½æ²¡æœ‰å®Œæˆæ‰‹ä¸Šä»»åŠ¡ï¼Œé˜Ÿåˆ—è¿˜åœ¨ä¸åœçš„æ·»åŠ æ–°ä»»åŠ¡ï¼Œé˜Ÿåˆ—æœ‰å¯èƒ½å°±ä¼šé‡åˆ°é˜Ÿåˆ—è¢«æ’‘æ»¡çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™å°±åªèƒ½æ·»åŠ æ–°çš„workeræˆ–è€…æ”¹å˜å…¶ä»–å­˜å‚¨ä»»åŠ¡çš„ç­–ç•¥ã€‚</p>
<p><strong>ç¤ºä¾‹ä»£ç </strong></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageQosProducer</span> {</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> QOS_QUEUE_NAME;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">"192.168.19.128"</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸ºä¸å…¬å¹³åˆ†å‘</span></span><br><span class="line">        channel.basicQos(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—æŒä¹…åŒ–</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) {</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">"message_"</span> + i;</span><br><span class="line">            <span class="comment">// æ¶ˆæ¯æŒä¹…åŒ–</span></span><br><span class="line">            channel.basicPublish(<span class="string">""</span>, QUEUE_NAME, MessageProperties.PERSISTENT_TEXT_PLAIN, (msg).getBytes(StandardCharsets.UTF_8));</span><br><span class="line">            System.out.println(<span class="string">"æ¶ˆæ¯["</span> + msg + <span class="string">"]å‘é€å®Œæˆ"</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p> æ¶ˆè´¹è€…1å¤„ç†ä»»åŠ¡æ—¶é—´ä¸º5sï¼Œæ¶ˆè´¹è€…2å¤„ç†ä»»åŠ¡æ—¶é—´ä¸º1sï¼Œæ‰€ä»¥2å¤„ç†çš„ä»»åŠ¡æ¯”1æ›´å¤šã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageQosConsumer1</span> {</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> QOS_QUEUE_NAME;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">"192.168.19.128"</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// è®¾ç½®æŒä¹…åŒ–</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        channel.basicQos(<span class="number">1</span>);</span><br><span class="line">        <span class="type">Consumer</span> <span class="variable">callback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel) {</span><br><span class="line">            <span class="meta">@SneakyThrows</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="type">byte</span>[] body)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">                <span class="comment">//è·¯ç”±çš„key</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">routingKey</span> <span class="operator">=</span> envelope.getRoutingKey();</span><br><span class="line">                <span class="comment">//è·å–äº¤æ¢æœºä¿¡æ¯</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">exchange</span> <span class="operator">=</span> envelope.getExchange();</span><br><span class="line">                <span class="comment">//è·å–æ¶ˆæ¯ID</span></span><br><span class="line">                <span class="type">long</span> <span class="variable">deliveryTag</span> <span class="operator">=</span> envelope.getDeliveryTag();</span><br><span class="line">                <span class="comment">//è·å–æ¶ˆæ¯ä¿¡æ¯</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(body, StandardCharsets.UTF_8);</span><br><span class="line">                System.out.println(<span class="string">"routingKey:"</span> + routingKey +</span><br><span class="line">                        <span class="string">",exchange:"</span> + exchange +</span><br><span class="line">                        <span class="string">",deliveryTag:"</span> + deliveryTag +</span><br><span class="line">                        <span class="string">",message:"</span> + message);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// æ¨¡æ‹Ÿå¤„ç†ä»»åŠ¡çš„æ—¶é—´</span></span><br><span class="line">                <span class="comment">// æ¶ˆè´¹è€…1è®¾ç½®ä¸º5sï¼Œæ¶ˆè´¹è€…2è®¾ç½®ä¸º1s</span></span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// deliveryTagæ˜¯æ¶ˆæ¯æ ‡è®°tag ,è®¾ç½®ä¸ºä¸æ‰¹é‡åº”ç­”</span></span><br><span class="line">                channel.basicAck(deliveryTag, <span class="literal">false</span>);</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="literal">false</span>, callback);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="é¢„å–å€¼ï¼ˆprefetchCountï¼‰"><a href="#é¢„å–å€¼ï¼ˆprefetchCountï¼‰" class="headerlink" title="é¢„å–å€¼ï¼ˆprefetchCountï¼‰"></a>é¢„å–å€¼ï¼ˆprefetchCountï¼‰</h2><p>åœ¨ä¸Šé¢æ¡ˆä¾‹ä¸­é€šè¿‡è®¾ç½®ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„ channel.basicQos(1) æ¥å®ç°æ¶ˆæ¯çš„ä¸å…¬å¹³åˆ†å‘ã€‚é‚£ä¹ˆè¿™ä¸ª1æ˜¯ä»€ä¹ˆå«ä¹‰å‘¢ï¼Ÿè¿™ä¸ªå°±æ˜¯å½“å‰æ¶ˆè´¹è€…ç†è®ºä¸Šè·å–çš„æ¶ˆæ¯æ¡æ•°ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Request a specific prefetchCount "quality of service" settings</span></span><br><span class="line"><span class="comment"> * for this channel.</span></span><br><span class="line"><span class="comment"> * Note the prefetch count must be between 0 and 65535 (unsigned short in AMQP 0-9-1).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> prefetchCount maximum number of messages that the server</span></span><br><span class="line"><span class="comment"> *                      will deliver, 0 if unlimited</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> java.io.IOException if an error is encountered</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #basicQos(int, int, boolean)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">basicQos</span><span class="params">(<span class="type">int</span> prefetchCount)</span> <span class="keyword">throws</span> IOException;</span><br></pre></td></tr></tbody></table></figure>

<p>æœ¬èº«æ¶ˆæ¯çš„å‘é€å°±æ˜¯å¼‚æ­¥å‘é€çš„ï¼Œæ‰€ä»¥åœ¨ä»»ä½•æ—¶å€™ï¼Œchannel ä¸Šè‚¯å®šä¸æ­¢åªæœ‰ä¸€ä¸ªæ¶ˆæ¯å¦å¤–æ¥è‡ªæ¶ˆè´¹è€…çš„æ‰‹åŠ¨ç¡®è®¤æœ¬è´¨ä¸Šä¹Ÿæ˜¯å¼‚æ­¥çš„ã€‚å› æ­¤è¿™é‡Œå°±å­˜åœ¨ä¸€ä¸ªæœªç¡®è®¤çš„æ¶ˆæ¯ç¼“å†²åŒºï¼Œå› æ­¤å¸Œæœ›å¼€å‘äººå‘˜èƒ½<strong>é™åˆ¶æ­¤ç¼“å†²åŒºçš„å¤§å°ï¼Œä»¥é¿å…ç¼“å†²åŒºé‡Œé¢æ— é™åˆ¶çš„æœªç¡®è®¤æ¶ˆæ¯é—®é¢˜</strong>ã€‚è¿™ä¸ªæ—¶å€™å°±å¯ä»¥é€šè¿‡ä½¿ç”¨ basic.qos æ–¹æ³•è®¾ç½®â€œé¢„å–è®¡æ•°â€å€¼æ¥å®Œæˆçš„ã€‚<strong>è¯¥å€¼å®šä¹‰é€šé“ä¸Šå…è®¸çš„æœªç¡®è®¤æ¶ˆæ¯çš„æœ€å¤§æ•°é‡</strong>ã€‚ä¸€æ—¦æ•°é‡è¾¾åˆ°é…ç½®çš„æ•°é‡ï¼ŒRabbitMQ å°†åœæ­¢åœ¨é€šé“ä¸Šä¼ é€’æ›´å¤šæ¶ˆæ¯ï¼Œé™¤éè‡³å°‘æœ‰ä¸€ä¸ªæœªå¤„ç†çš„æ¶ˆæ¯è¢«ç¡®è®¤ï¼Œä¾‹å¦‚ï¼Œå‡è®¾åœ¨é€šé“ä¸Šæœ‰æœªç¡®è®¤çš„æ¶ˆæ¯ 5ã€6ã€7ï¼Œ8ï¼Œå¹¶ä¸”é€šé“çš„é¢„å–è®¡æ•°è®¾ç½®ä¸º 4ï¼Œæ­¤æ—¶ RabbitMQ å°†ä¸ä¼šåœ¨è¯¥é€šé“ä¸Šå†ä¼ é€’ä»»ä½•æ¶ˆæ¯ï¼Œé™¤éè‡³å°‘æœ‰ä¸€ä¸ªæœªåº”ç­”çš„æ¶ˆæ¯è¢« ackã€‚æ¯”æ–¹è¯´ tag=6 è¿™ä¸ªæ¶ˆæ¯åˆšåˆšè¢«ç¡®è®¤ ACKï¼ŒRabbitMQ å°†ä¼šæ„ŸçŸ¥è¿™ä¸ªæƒ…å†µåˆ°å¹¶å†å‘é€ä¸€æ¡æ¶ˆæ¯ã€‚æ¶ˆæ¯åº”ç­”å’Œ QoS é¢„å–å€¼å¯¹ç”¨æˆ·ååé‡æœ‰é‡å¤§å½±å“ã€‚é€šå¸¸ï¼Œå¢åŠ é¢„å–å°†æé«˜å‘æ¶ˆè´¹è€…ä¼ é€’æ¶ˆæ¯çš„é€Ÿåº¦ã€‚<strong>è™½ç„¶è‡ªåŠ¨åº”ç­”ä¼ è¾“æ¶ˆæ¯é€Ÿç‡æ˜¯æœ€ä½³çš„ï¼Œä½†æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å·²ä¼ é€’ä½†å°šæœªå¤„ç†çš„æ¶ˆæ¯çš„æ•°é‡ä¹Ÿä¼šå¢åŠ ï¼Œä»è€Œå¢åŠ äº†æ¶ˆè´¹è€…çš„RAM</strong> <strong>æ¶ˆè€—</strong>(éšæœºå­˜å–å­˜å‚¨å™¨)åº”è¯¥å°å¿ƒä½¿ç”¨å…·æœ‰æ— é™é¢„å¤„ç†çš„è‡ªåŠ¨ç¡®è®¤æ¨¡å¼æˆ–æ‰‹åŠ¨ç¡®è®¤æ¨¡å¼ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹äº†å¤§é‡çš„æ¶ˆæ¯å¦‚æœæ²¡æœ‰ç¡®è®¤çš„è¯ï¼Œä¼šå¯¼è‡´æ¶ˆè´¹è€…è¿æ¥èŠ‚ç‚¹çš„å†…å­˜æ¶ˆè€—å˜å¤§ï¼Œæ‰€ä»¥æ‰¾åˆ°åˆé€‚çš„é¢„å–å€¼æ˜¯ä¸€ä¸ªåå¤è¯•éªŒçš„è¿‡ç¨‹ï¼Œä¸åŒçš„è´Ÿè½½è¯¥å€¼å–å€¼ä¹Ÿä¸åŒ 100 åˆ° 300 èŒƒå›´å†…çš„å€¼é€šå¸¸å¯æä¾›æœ€ä½³çš„ååé‡ï¼Œå¹¶ä¸”ä¸ä¼šç»™æ¶ˆè´¹è€…å¸¦æ¥å¤ªå¤§çš„é£é™©ã€‚é¢„å–å€¼ä¸º 1 æ˜¯æœ€ä¿å®ˆçš„ã€‚å½“ç„¶è¿™å°†ä½¿ååé‡å˜å¾—å¾ˆä½ï¼Œç‰¹åˆ«æ˜¯æ¶ˆè´¹è€…è¿æ¥å»¶è¿Ÿå¾ˆä¸¥é‡çš„æƒ…å†µä¸‹ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¶ˆè´¹è€…è¿æ¥ç­‰å¾…æ—¶é—´è¾ƒé•¿çš„ç¯å¢ƒä¸­ã€‚å¯¹äºå¤§å¤šæ•°åº”ç”¨æ¥è¯´ï¼Œç¨å¾®é«˜ä¸€ç‚¹çš„å€¼å°†æ˜¯æœ€ä½³çš„ã€‚</p>
<p><img src="/p/3700606c/RabbitMQ-%E9%A2%84%E5%8F%96%E5%80%BC.png" alt="image-20210620164043190"></p>
</body></html>]]></content>
      <tags>
        <tag>æ¶ˆæ¯ä¸­é—´ä»¶</tag>
        <tag>RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMQä¼˜å…ˆçº§é˜Ÿåˆ—</title>
    <url>/p/87548d77.html</url>
    <content><![CDATA[<html><head></head><body><p>åœ¨ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­ï¼Œé’ˆå¯¹ç”Ÿäº§è€…ç»™æ¶ˆæ¯è®¾ç½®çš„ä¼˜å…ˆçº§è¿›è¡Œæ’åºï¼Œä¼˜å…ˆçº§è¶Šå¤§çš„è¶Šå…ˆè¢«æ¶ˆè´¹è€…æ¶ˆè´¹ã€‚å¦‚æœåœ¨æ¶ˆè´¹è€…çš„æ¶ˆè´¹é€Ÿåº¦å¤§äºç”Ÿäº§è€…çš„é€Ÿåº¦ï¼Œä¸”Brokerä¸­æ²¡æœ‰æ¶ˆæ¯å †ç§¯çš„æƒ…å†µä¸‹ï¼Œå¯¹å‘é€çš„æ¶ˆæ¯è®¾ç½®ä¼˜å…ˆçº§æ²¡æœ‰æ„ä¹‰ã€‚</p>
<p>åœ¨ç”Ÿäº§è€…ï¼ŒæŒ‰å¦‚ä¸‹æ–¹å¼ç»™æ¶ˆæ¯è®¾ç½® priority å±æ€§</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">AMQP.<span class="type">BasicProperties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AMQP</span>.BasicProperties().builder()</span><br><span class="line">    			<span class="comment">// è®¾ç½®å½“å‰æ¶ˆæ¯çš„ä¼˜å…ˆçº§</span></span><br><span class="line">                .priority(<span class="number">5</span>).build();</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨æ¶ˆè´¹è€…ï¼ŒæŒ‰å¦‚ä¸‹æ–¹å¼å£°æ˜ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œä¼˜å…ˆçº§çš„å–å€¼èŒƒå›´æ˜¯0-255ï¼Œæ¨èä½¿ç”¨ 10ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Map&lt;String,Object&gt; arguments = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">1</span>);</span><br><span class="line">arguments.put(<span class="string">"x-max-priority"</span>,<span class="number">10</span>);</span><br><span class="line">channel.queueDeclare(<span class="string">"queue_name"</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, arguments);</span><br></pre></td></tr></tbody></table></figure>

<p><strong>åœ¨RabbitMQçš„æ§åˆ¶å°æ·»åŠ ä¼˜å…ˆçº§é˜Ÿåˆ—</strong></p>
<p><img src="/p/87548d77/RabbitMQ-%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%96%B0%E5%A2%9E%E4%BC%98%E5%85%88%E7%BA%A7%E9%98%9F%E5%88%97.png" alt="image-20210626201354937"></p>
<p><strong>ä»£ç ç¤ºä¾‹</strong></p>
<p>ç”Ÿäº§è€…</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessagePriorityProducer</span> {</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">"priority"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">"192.168.19.128"</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®å½“å‰æ¶ˆæ¯çš„ä¼˜å…ˆçº§</span></span><br><span class="line">        AMQP.<span class="type">BasicProperties</span> <span class="variable">properties1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AMQP</span>.BasicProperties()</span><br><span class="line">            .builder()</span><br><span class="line">            .priority(<span class="number">5</span>)</span><br><span class="line">            .build();</span><br><span class="line">        <span class="comment">// è¯æ˜æ˜¯ä¼˜å…ˆçº§è¶Šå¤§è¶Šå…ˆè¢«æ¶ˆè´¹</span></span><br><span class="line">        AMQP.<span class="type">BasicProperties</span> <span class="variable">properties2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AMQP</span>.BasicProperties()</span><br><span class="line">            .builder()</span><br><span class="line">            .priority(<span class="number">3</span>)</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) {</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">"message_"</span> + i;</span><br><span class="line">            <span class="comment">// i=5çš„æ¶ˆæ¯ä¼˜å…ˆå¤„ç†</span></span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">5</span>) {</span><br><span class="line">                channel.basicPublish(<span class="string">""</span>, QUEUE_NAME, properties1, message.getBytes());</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="number">7</span>) {</span><br><span class="line">                channel.basicPublish(<span class="string">""</span>, QUEUE_NAME, properties2, message.getBytes());</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                channel.basicPublish(<span class="string">""</span>, QUEUE_NAME, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">            }</span><br><span class="line">            System.out.println(<span class="string">"å‘é€æ¶ˆæ¯å®Œæˆ:"</span> + message);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ¶ˆè´¹è€…</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessagePriorityConsumer</span> {</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">"priority"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">"192.168.19.128"</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®ä¼˜å…ˆçº§æœ€å¤§å€¼ï¼Œå–å€¼èŒƒå›´ä¸º0-255</span></span><br><span class="line">        Map&lt;String,Object&gt; arguments = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">1</span>);</span><br><span class="line">        arguments.put(<span class="string">"x-max-priority"</span>,<span class="number">10</span>);</span><br><span class="line">        <span class="comment">// å£°æ˜ä¼˜å…ˆçº§é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, arguments);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"ç­‰å¾…æ¥æ”¶æ¶ˆæ¯..."</span>);</span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="literal">true</span>, (consumerTag, delivery) -&gt; {</span><br><span class="line">            <span class="type">byte</span>[] msgBytes = delivery.getBody();</span><br><span class="line">            System.out.println(<span class="string">"æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šæ¶ˆæ¯ID="</span> + consumerTag + <span class="string">"===&gt;"</span> + <span class="keyword">new</span> <span class="title class_">String</span>(msgBytes));</span><br><span class="line">        }, consumerTag -&gt; {</span><br><span class="line">            System.out.println(<span class="string">"æ¶ˆæ¯è¢«ä¸­æ–­ï¼šæ¶ˆæ¯ID="</span> + consumerTag);</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</body></html>]]></content>
      <tags>
        <tag>æ¶ˆæ¯ä¸­é—´ä»¶</tag>
        <tag>RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMQçš„å…­ç§æ¨¡å¼</title>
    <url>/p/40f0af9d.html</url>
    <content><![CDATA[<html><head></head><body><p><a href="https://www.rabbitmq.com/getstarted.html">å®˜ç½‘é“¾æ¥</a></p>
<p>ç®€å•æ¨¡å¼ï¼Œworkæ¨¡å¼ï¼ŒPublish/Subscribeå‘å¸ƒä¸è®¢é˜…æ¨¡å¼ï¼ŒRoutingè·¯ç”±æ¨¡å¼ï¼ŒTopicsä¸»é¢˜æ¨¡å¼ï¼ŒRPCè¿œç¨‹è°ƒç”¨æ¨¡å¼ï¼ˆè¿œç¨‹è°ƒç”¨ï¼Œä¸å¤ªç®—MQï¼›ä¸ä½œä»‹ç»ï¼‰ï¼›</p>
<p><img src="/p/40f0af9d/RabbitMQ-%E5%85%AD%E7%A7%8D%E6%A8%A1%E5%BC%8F.png" alt="image-20210619144630056"></p>
<h2 id="ç®€å•æ¨¡å¼ï¼ˆSimpleï¼‰"><a href="#ç®€å•æ¨¡å¼ï¼ˆSimpleï¼‰" class="headerlink" title="ç®€å•æ¨¡å¼ï¼ˆSimpleï¼‰"></a>ç®€å•æ¨¡å¼ï¼ˆSimpleï¼‰</h2><p><img src="/p/40f0af9d/RabbitMQ-%E7%AE%80%E6%98%93%E6%A8%A1%E5%BC%8F.png" alt="image-20210619172049952"></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleProducer</span> {</span><br><span class="line">    <span class="type">String</span> <span class="variable">SIMPLE_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">"hello"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">"192.168.19.128"</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">        <span class="comment">// å»ºç«‹è¿æ¥</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªè¿æ¥ä¸­çš„channel</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Declare a queue</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@see</span> com.rabbitmq.client.AMQP.Queue.Declare</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@see</span> com.rabbitmq.client.AMQP.Queue.DeclareOk</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> queue the name of the queue</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> durable true if we are declaring a durable queue (the queue will survive a server restart)</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> exclusive è¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ï¼Œæ˜¯å¦è¿›è¡Œæ¶ˆæ¯å…±äº«ï¼Œtrue-å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œfalse - åªèƒ½ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">         *                  true if we are declaring an exclusive queue (restricted to this connection)</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> autoDelete æœ€åä¸€ä¸ªæ¶ˆè´¹è€…æ–­å¼€è¿æ¥ä»¥åï¼Œè¯¥é˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         *                  true if we are declaring an autodelete queue (server will delete it when no longer in use)</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> arguments other properties (construction arguments) for the queue</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> a declaration-confirm method to indicate the queue was successfully declared</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@throws</span> java.io.IOException if an error is encountered</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * queueDeclare(String queue, boolean durable, boolean exclusive, boolean autoDelete,Map&lt;String, Object&gt; arguments)</span></span><br><span class="line"><span class="comment">         **/</span></span><br><span class="line">        channel.queueDeclare(SIMPLE_QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Publish a message.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * Publishing to a non-existent exchange will result in a channel-level</span></span><br><span class="line"><span class="comment">         * protocol exception, which closes the channel.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * Invocations of &lt;code&gt;Channel#basicPublish&lt;/code&gt; will eventually block if a</span></span><br><span class="line"><span class="comment">         * &lt;a href="https://www.rabbitmq.com/alarms.html"&gt;resource-driven alarm&lt;/a&gt; is in effect.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@see</span> com.rabbitmq.client.AMQP.Basic.Publish</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@see</span> &lt;a href="https://www.rabbitmq.com/alarms.html"&gt;Resource-driven alarms&lt;/a&gt;</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> exchange the exchange to publish the message to</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> routingKey the routing key</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> props other properties for the message - routing headers etc</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> body the message body</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@throws</span> java.io.IOException if an error is encountered</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicPublish(<span class="string">""</span>, SIMPLE_QUEUE_NAME, <span class="literal">null</span>, <span class="string">"hello,world!"</span>.getBytes(StandardCharsets.UTF_8));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"æ¶ˆæ¯å‘é€å®Œæˆ"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleConsumer</span> {</span><br><span class="line">    <span class="type">String</span> <span class="variable">SIMPLE_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">"hello"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">"192.168.19.128"</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line"></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Start a non-nolocal, non-exclusive consumer, with</span></span><br><span class="line"><span class="comment">         * a server-generated consumerTag.</span></span><br><span class="line"><span class="comment">         * Provide access only to &lt;code&gt;basic.deliver&lt;/code&gt; and</span></span><br><span class="line"><span class="comment">         * &lt;code&gt;basic.cancel&lt;/code&gt; AMQP methods (which is sufficient</span></span><br><span class="line"><span class="comment">         * for most cases). See methods with a {<span class="doctag">@link</span> Consumer} argument</span></span><br><span class="line"><span class="comment">         * to have access to all the application callbacks.</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> queue the name of the queue</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> autoAck è‡ªåŠ¨åº”ç­”ï¼Œæ¥æ”¶åˆ°æ¶ˆæ¯å°±å›å¤æœåŠ¡ç«¯ true if the server should consider messages</span></span><br><span class="line"><span class="comment">         * acknowledged once delivered; false if the server should expect</span></span><br><span class="line"><span class="comment">         * explicit acknowledgements</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> deliverCallback callback when a message is delivered</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> cancelCallback callback when the consumer is cancelled</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> the consumerTag generated by the server</span></span><br><span class="line"><span class="comment">         * String basicConsume(String queue, boolean autoAck, DeliverCallback deliverCallback, CancelCallback cancelCallback)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicConsume(SIMPLE_QUEUE_NAME, <span class="literal">true</span>,</span><br><span class="line">                <span class="comment">// æ¶ˆæ¯ä¼ é€’ç›‘å¬ï¼Œæ¥æ”¶åˆ°æ¶ˆæ¯æ—¶è§¦å‘</span></span><br><span class="line">                (consumerTag, message) -&gt; {</span><br><span class="line">                    <span class="type">byte</span>[] msgBytes = message.getBody();</span><br><span class="line">                    System.out.println(<span class="string">"æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š"</span> + <span class="keyword">new</span> <span class="title class_">String</span>(msgBytes));</span><br><span class="line">                },</span><br><span class="line">                <span class="comment">// å–æ¶ˆæ¶ˆæ¯æ—¶çš„å›è°ƒ</span></span><br><span class="line">                consumerTag -&gt; {</span><br><span class="line">                    System.out.println(<span class="string">"æ¶ˆæ¯æ¶ˆè´¹è¢«ä¸­æ–­"</span>);</span><br><span class="line">                });</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ï¼ˆWork-Queuesï¼‰"><a href="#å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ï¼ˆWork-Queuesï¼‰" class="headerlink" title="å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ï¼ˆWork Queuesï¼‰"></a>å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ï¼ˆWork Queuesï¼‰</h2><p><img src="/p/40f0af9d/RabbitMQ-%E5%B7%A5%E4%BD%9C%E9%98%9F%E5%88%97%E6%A8%A1%E5%BC%8F.png" alt="image-20210619172222080"></p>
<p>å·¥ä½œé˜Ÿåˆ—ï¼ˆWork Queuesï¼‰ä¸å…¥é—¨ç¨‹åºçš„ç®€å•æ¨¡å¼ç›¸æ¯”ï¼Œå¤šäº†ä¸€ä¸ªæˆ–ä¸€äº›æ¶ˆè´¹ç«¯ï¼Œå¤šä¸ªæ¶ˆè´¹ç«¯å…±åŒæ¶ˆè´¹åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚å·¥ä½œé˜Ÿåˆ—ï¼ˆåˆç§°ä¸ºä»»åŠ¡é˜Ÿåˆ—ï¼‰çš„ä¸»è¦æ€æƒ³æ˜¯é¿å…ç«‹å³æ‰§è¡Œèµ„æºå¯†é›†å‹ä»»åŠ¡ï¼Œè€Œä¸å¾—ä¸ç­‰å¾…å®ƒå®Œæˆã€‚ç›¸åæˆ‘ä»¬å®‰æ’ä»»åŠ¡åœ¨ä¹‹åæ‰§è¡Œã€‚æˆ‘ä»¬æŠŠä»»åŠ¡å°è£…ä¸ºæ¶ˆæ¯å¹¶å°†å…¶å‘é€åˆ°é˜Ÿåˆ—ã€‚åœ¨åå°è¿è¡Œçš„å·¥ä½œè¿›ç¨‹å°†å¼¹å‡ºä»»åŠ¡å¹¶æœ€ç»ˆæ‰§è¡Œä½œä¸šã€‚å½“æœ‰å¤šä¸ªå·¥ä½œçº¿ç¨‹æ—¶ï¼Œè¿™äº›å·¥ä½œçº¿ç¨‹å°†ä¸€èµ·å¤„ç†è¿™äº›ä»»åŠ¡ã€‚</p>
<p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šå¯¹äºä»»åŠ¡è¿‡é‡æˆ–ä»»åŠ¡è¾ƒå¤šæƒ…å†µï¼ˆæ¶ˆæ¯ç§¯å‹ï¼‰ï¼Œä½¿ç”¨å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ä½¿ç”¨å¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥æé«˜ä»»åŠ¡å¤„ç†çš„é€Ÿåº¦ã€‚</p>
<h3 id="è½®è¯¢åˆ†å‘æ¶ˆæ¯"><a href="#è½®è¯¢åˆ†å‘æ¶ˆæ¯" class="headerlink" title="è½®è¯¢åˆ†å‘æ¶ˆæ¯"></a><strong>è½®è¯¢åˆ†å‘æ¶ˆæ¯</strong></h3><p>ä¸€ä¸ªæ¶ˆæ¯åªèƒ½è¢«å¤„ç†ä¸€æ¬¡ï¼Œä¸å¯ä»¥è¢«å¤„ç†å¤šæ¬¡ã€‚</p>
<p><img src="/p/40f0af9d/RabbitMQ-%E5%B7%A5%E4%BD%9C%E9%98%9F%E5%88%97%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%B6%88%E6%81%AF%E5%88%86%E5%8F%91.png" alt="image-20210619173847176"></p>
<p>åˆ›å»ºä¸€ä¸ªç”Ÿäº§è€…ï¼Œæ¯ä¸€ç§’å‘é€ä¸€æ¬¡æ¶ˆæ¯</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WorkQueueProducer</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">"192.168.19.128"</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">        <span class="comment">// å»ºç«‹è¿æ¥</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªè¿æ¥ä¸­çš„channel</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line"></span><br><span class="line">        channel.queueDeclare(WORK_QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) {</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">"message_"</span> + i;</span><br><span class="line">            channel.basicPublish(<span class="string">""</span>, WORK_QUEUE_NAME, <span class="literal">null</span>, (msg).getBytes(StandardCharsets.UTF_8));</span><br><span class="line">            System.out.println(<span class="string">"æ¶ˆæ¯["</span> + msg + <span class="string">"]å‘é€å®Œæˆ"</span>);</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ¶ˆè´¹è€…1ã€æ¶ˆè´¹è€…2ã€æ¶ˆè´¹è€…3çš„ä»£ç ä¸€æ ·ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WorkQueueConsumer1</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException {</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">"192.168.19.128"</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line"></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        channel.basicConsume(WORK_QUEUE_NAME, <span class="literal">true</span>,</span><br><span class="line">                <span class="comment">// æ¶ˆæ¯ä¼ é€’é€šçŸ¥</span></span><br><span class="line">                (consumerTag, message) -&gt; {</span><br><span class="line">                    <span class="type">byte</span>[] msgBytes = message.getBody();</span><br><span class="line">                    System.out.println(<span class="string">"æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š"</span> + <span class="keyword">new</span> <span class="title class_">String</span>(msgBytes));</span><br><span class="line">                },</span><br><span class="line">                <span class="comment">// å–æ¶ˆæ¶ˆæ¯æ—¶çš„å›è°ƒ</span></span><br><span class="line">                consumerTag -&gt; {</span><br><span class="line">                    System.out.println(<span class="string">"æ¶ˆæ¯æ¶ˆè´¹è¢«ä¸­æ–­"</span>);</span><br><span class="line">                });</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPublish-subscribeï¼‰"><a href="#å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPublish-subscribeï¼‰" class="headerlink" title="å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPublish subscribeï¼‰"></a>å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPublish subscribeï¼‰</h2><p><img src="/p/40f0af9d/RabbitMQ-%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F.png" alt="image-20210619175938554"></p>
<p>åœ¨å‘å¸ƒè®¢é˜…æ¨¡å‹ä¸­ï¼Œå¤šäº†ä¸€ä¸ªx(exchange)è§’è‰²ï¼Œè€Œä¸”è¿‡ç¨‹ç•¥æœ‰å˜åŒ–ã€‚</p>
<p><strong>P</strong>ï¼šç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯è¦å‘é€æ¶ˆæ¯çš„ç¨‹åºï¼Œä½†æ˜¯ä¸å†å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯å‘ç»™Xï¼ˆäº¤æ¢æœºï¼‰</p>
<p><strong>C</strong>ï¼šæ¶ˆè´¹è€…ï¼Œæ¶ˆæ¯çš„æ¥å—è€…ï¼Œä¼šä¸€ç›´ç›‘å¬æ¶ˆæ¯åˆ°æ¥ã€‚</p>
<p><strong>Queue</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¥æ”¶æ¶ˆæ¯ã€ç¼“å­˜æ¶ˆæ¯ã€‚</p>
<p><strong>Exchange</strong>ï¼šäº¤æ¢æœºï¼Œå›¾ä¸­çš„Xã€‚ä¸€æ–¹é¢ï¼Œæ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ã€‚å¦ä¸€æ–¹é¢ï¼ŒçŸ¥é“å¦‚ä½•å¤„ç†æ¶ˆæ¯ï¼Œä¾‹å¦‚é€’äº¤ç»™æŸä¸ªç‰¹åˆ«é˜Ÿåˆ—ã€é€’äº¤ç»™æ‰€æœ‰é˜Ÿåˆ—ã€æˆ–æ˜¯å°†æ¶ˆæ¯ä¸¢å¼ƒã€‚åˆ°åº•å¦‚ä½•æ“ä½œï¼Œå–å†³äºExchangeçš„ç±»å‹ã€‚Exchangeæœ‰å¸¸è§ä»¥ä¸‹3ç§ç±»å‹ï¼š</p>
<ul>
<li><p>Fanoutï¼šå¹¿æ’­ï¼Œå°†æ¶ˆæ¯äº¤ç»™æ‰€æœ‰ç»‘å®šåˆ°äº¤æ¢æœºçš„é˜Ÿåˆ—</p>
</li>
<li><p>Directï¼šå®šå‘ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆæŒ‡å®šrouting key çš„é˜Ÿåˆ—</p>
</li>
<li><p>Topicï¼šé€šé…ç¬¦ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆrouting patternï¼ˆè·¯ç”±æ¨¡å¼ï¼‰ çš„é˜Ÿåˆ—</p>
</li>
</ul>
<p><strong>Exchangeï¼ˆäº¤æ¢æœºï¼‰åªè´Ÿè´£è½¬å‘æ¶ˆæ¯ï¼Œä¸å…·å¤‡å­˜å‚¨æ¶ˆæ¯çš„èƒ½åŠ›</strong>ï¼Œå› æ­¤å¦‚æœæ²¡æœ‰ä»»ä½•é˜Ÿåˆ—ä¸Exchange<strong>ç»‘å®š</strong>ï¼Œæˆ–è€…æ²¡æœ‰ç¬¦åˆè·¯ç”±è§„åˆ™çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šä¸¢å¤±ï¼</p>
<p><img src="/p/40f0af9d/RabbitMQ-Exchange%E4%BA%A4%E6%8D%A2%E6%9C%BA.png" alt="image-20210619185256018"></p>
<h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a><strong>ä»£ç å®ç°</strong></h3><p>ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘ç»™äº¤æ¢æœº</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FanoutProducer</span> {</span><br><span class="line">    <span class="type">String</span> <span class="variable">FANOUT_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">"fanout"</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">FANOUT_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">"fanoutExchange"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">"192.168.19.128"</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">        <span class="comment">// å»ºç«‹è¿æ¥</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªè¿æ¥ä¸­çš„channel</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// å£°æ˜äº¤æ¢æœº - channel.exchangeDeclare(äº¤æ¢æœºåå­—,äº¤æ¢æœºç±»å‹)</span></span><br><span class="line">        channel.exchangeDeclare(FANOUT_EXCHANGE_NAME, BuiltinExchangeType.FANOUT);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) {</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">"message_"</span> + i;</span><br><span class="line">            <span class="comment">// æ¶ˆæ¯å‘é€-channel.basicPublish(äº¤æ¢æœº[é»˜è®¤Default Exchage],è·¯ç”±key[ç®€å•æ¨¡å¼å¯ä»¥ä¼ é€’é˜Ÿåˆ—åç§°],æ¶ˆæ¯å…¶å®ƒå±æ€§,æ¶ˆæ¯å†…å®¹)</span></span><br><span class="line">            channel.basicPublish(FANOUT_EXCHANGE_NAME, <span class="string">""</span>, <span class="literal">null</span>, (msg).getBytes(StandardCharsets.UTF_8));</span><br><span class="line">            System.out.println(<span class="string">"æ¶ˆæ¯["</span> + msg + <span class="string">"]å‘é€å®Œæˆ"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// å…³é—­èµ„æº-channel.close();connection.close()</span></span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ¶ˆè´¹è€…1ã€æ¶ˆè´¹è€…2ã€æ¶ˆè´¹è€…3ä»£ç å‡ä¸€è‡´ã€‚æ¶ˆè´¹è€…éœ€è¦ç»‘å®šé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ç»‘å®šäº¤æ¢æœºã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FanoutConsumer1</span> {</span><br><span class="line">    <span class="type">String</span> <span class="variable">FANOUT_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">"fanout"</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">FANOUT_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">"fanoutExchange"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">"192.168.19.128"</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line"></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// å£°æ˜é˜Ÿåˆ—-channel.queueDeclare(åç§°ï¼Œæ˜¯å¦æŒä¹…åŒ–ï¼Œæ˜¯å¦ç‹¬å æœ¬è¿æ¥,æ˜¯å¦è‡ªåŠ¨åˆ é™¤,é™„åŠ å‚æ•°)</span></span><br><span class="line">        channel.queueDeclare(FANOUT_QUEUE_NAME, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—ç»‘å®šäº¤æ¢æœº-channel.queueBind(é˜Ÿåˆ—å, äº¤æ¢æœºå, è·¯ç”±key[å¹¿æ’­æ¶ˆæ¯è®¾ç½®ä¸ºç©ºä¸²])</span></span><br><span class="line">        channel.queueBind(FANOUT_QUEUE_NAME, FANOUT_EXCHANGE_NAME, <span class="string">""</span>);</span><br><span class="line">        channel.basicConsume(FANOUT_QUEUE_NAME, <span class="literal">true</span>,</span><br><span class="line">                (consumerTag, message) -&gt; {</span><br><span class="line">                    <span class="type">byte</span>[] msgBytes = message.getBody();</span><br><span class="line">                    System.out.println(<span class="string">"æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š"</span> + <span class="keyword">new</span> <span class="title class_">String</span>(msgBytes));</span><br><span class="line">                },</span><br><span class="line">                consumerTag -&gt; {</span><br><span class="line">                    System.out.println(<span class="string">"æ¶ˆæ¯æ¶ˆè´¹è¢«ä¸­æ–­"</span>);</span><br><span class="line">                });</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="è·¯ç”±æ¨¡å¼ï¼ˆRoutingï¼‰"><a href="#è·¯ç”±æ¨¡å¼ï¼ˆRoutingï¼‰" class="headerlink" title="è·¯ç”±æ¨¡å¼ï¼ˆRoutingï¼‰"></a>è·¯ç”±æ¨¡å¼ï¼ˆRoutingï¼‰</h2><p>1.é˜Ÿåˆ—ä¸äº¤æ¢æœºçš„ç»‘å®šï¼Œä¸èƒ½æ˜¯ä»»æ„ç»‘å®šäº†ï¼Œè€Œæ˜¯è¦æŒ‡å®šä¸€ä¸ªRoutingKeyï¼ˆè·¯ç”±keyï¼‰ã€‚</p>
<p>2.æ¶ˆæ¯çš„å‘é€æ”¾åœ¨å‘ Exchangeå‘é€æ¶ˆæ¯æ—¶ï¼Œä¹Ÿå¿…é¡»æŒ‡å®šæ¶ˆæ¯çš„ RoutingKeyã€‚</p>
<p>3.Exchangeä¸å†æŠŠæ¶ˆæ¯äº¤ç»™æ¯ä¸€ä¸ªç»‘å®šçš„é˜Ÿåˆ—ï¼Œè€Œæ˜¯æ ¹æ®æ¶ˆæ¯çš„Routing Keyè¿›è¡Œåˆ¤æ–­ï¼Œåªæœ‰é˜Ÿåˆ—çš„Routingkeyä¸æ¶ˆæ¯çš„ Routing keyå®Œå…¨ä¸€è‡´ï¼Œæ‰ä¼šæ¥æ”¶åˆ°æ¶ˆæ¯ã€‚</p>
<p><img src="/p/40f0af9d/RabbitMQ-%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%BC%8F.png" alt="image-20210619201413347"></p>
<p>Pï¼šç”Ÿäº§è€…ï¼Œå‘Exchangeå‘é€æ¶ˆæ¯ï¼Œå‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šæŒ‡å®šä¸€ä¸ªrouting keyã€‚</p>
<p>Xï¼šExchangeï¼ˆäº¤æ¢æœºï¼‰ï¼Œæ¥æ”¶ç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œç„¶åæŠŠæ¶ˆæ¯é€’äº¤ç»™ ä¸routing keyå®Œå…¨åŒ¹é…çš„é˜Ÿåˆ—ã€‚</p>
<p>C1ï¼šæ¶ˆè´¹è€…ï¼Œå…¶æ‰€åœ¨é˜Ÿåˆ—æŒ‡å®šäº†éœ€è¦routing key ä¸º error çš„æ¶ˆæ¯</p>
<p>C2ï¼šæ¶ˆè´¹è€…ï¼Œå…¶æ‰€åœ¨é˜Ÿåˆ—æŒ‡å®šäº†éœ€è¦routing key ä¸º infoã€errorã€warning çš„æ¶ˆæ¯</p>
<h3 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><p>ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€ç»™äº¤æ¢æœºä¹‹å‰ï¼Œéœ€è¦ç»™æ¶ˆæ¯è®¾ç½®ä¸Šè·¯ç”±é”®ï¼Œäº¤æ¢æœºä¼šæ ¹æ®è·¯ç”±é”®å‘é€ç»™æŒ‡å®šé˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…æ ¹æ®è‡ªå·±çš„è·¯ç”±é”®è·å–æŒ‡å®šé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoutingProducer</span> {</span><br><span class="line">    <span class="type">String</span> <span class="variable">ROUTING_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">"routing"</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">ROUTING_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">"routingExchange"</span>;</span><br><span class="line">    <span class="comment">/**  è·¯ç”±é”®1 */</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">ROUTING_KEY_ERROR</span> <span class="operator">=</span> <span class="string">"log.error"</span>;</span><br><span class="line">    <span class="comment">/** è·¯ç”±é”®2 */</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">ROUTING_KEY_INFO</span> <span class="operator">=</span> <span class="string">"log.info"</span>;</span><br><span class="line">    <span class="comment">/** è·¯ç”±é”®3 */</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">ROUTING_KEY_WARNING</span> <span class="operator">=</span> <span class="string">"log.warning"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">"192.168.19.128"</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">        <span class="comment">// å»ºç«‹è¿æ¥</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªè¿æ¥ä¸­çš„channel</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// å£°æ˜äº¤æ¢æœº - channel.exchangeDeclare(äº¤æ¢æœºåå­—,äº¤æ¢æœºç±»å‹)</span></span><br><span class="line">        channel.exchangeDeclare(ROUTING_EXCHANGE_NAME, BuiltinExchangeType.DIRECT);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) {</span><br><span class="line">            <span class="comment">// å‘é€æ¶ˆæ¯çš„æ—¶å€™æ ¹æ®ç›¸å…³é€»è¾‘æŒ‡å®šç›¸åº”çš„routing keyã€‚</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">routingKey</span> <span class="operator">=</span> <span class="string">""</span>;</span><br><span class="line">            <span class="keyword">switch</span> (i / <span class="number">3</span>) {</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">//å‡è®¾i=0ï¼Œä¸ºerroræ¶ˆæ¯</span></span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                    routingKey = ROUTING_KEY_ERROR;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">//å‡è®¾i=1ï¼Œä¸ºinfoæ¶ˆæ¯</span></span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    routingKey = ROUTING_KEY_INFO;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">//å‡è®¾i=2ï¼Œä¸ºwarningæ¶ˆæ¯</span></span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    routingKey = ROUTING_KEY_WARNING;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">"message_"</span> + i;</span><br><span class="line">            <span class="comment">// æ¶ˆæ¯å‘é€-channel.basicPublish(äº¤æ¢æœº[é»˜è®¤Default Exchage],è·¯ç”±key[ç®€å•æ¨¡å¼å¯ä»¥ä¼ é€’é˜Ÿåˆ—åç§°],æ¶ˆæ¯å…¶å®ƒå±æ€§,æ¶ˆæ¯å†…å®¹)</span></span><br><span class="line">            channel.basicPublish(ROUTING_EXCHANGE_NAME, routingKey, <span class="literal">null</span>, (msg).getBytes(StandardCharsets.UTF_8));</span><br><span class="line">            System.out.println(<span class="string">"æ¶ˆæ¯["</span> + msg + <span class="string">"]å‘é€å®Œæˆ"</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…³é—­èµ„æº-channel.close();connection.close()</span></span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ¶ˆè´¹è€…1ã€2ã€3ä»£ç å‡ä¸€è‡´ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoutingConsumer1</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">"192.168.19.128"</span>);</span><br><span class="line">        connectionFactory.setPort(<span class="number">5672</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line"></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// å£°æ˜é˜Ÿåˆ—-channel.queueDeclare(åç§°ï¼Œæ˜¯å¦æŒä¹…åŒ–ï¼Œæ˜¯å¦ç‹¬å æœ¬è¿æ¥,æ˜¯å¦è‡ªåŠ¨åˆ é™¤,é™„åŠ å‚æ•°)</span></span><br><span class="line">        channel.queueDeclare(ROUTING_QUEUE_NAME, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—ç»‘å®šäº¤æ¢æœº-channel.queueBind(é˜Ÿåˆ—å, äº¤æ¢æœºå, è·¯ç”±key[å¹¿æ’­æ¶ˆæ¯è®¾ç½®ä¸ºç©ºä¸²])</span></span><br><span class="line">        channel.queueBind(ROUTING_QUEUE_NAME, ROUTING_EXCHANGE_NAME, ROUTING_KEY_ERROR);</span><br><span class="line">        <span class="comment">// autoAck æ˜¯å¦è‡ªåŠ¨åº”ç­”ï¼Œtrueä¸ºè‡ªåŠ¨åº”ç­”[mqæ¥æ”¶åˆ°å›å¤ä¼šåˆ é™¤æ¶ˆæ¯]</span></span><br><span class="line">        channel.basicConsume(ROUTING_QUEUE_NAME, <span class="literal">true</span>,</span><br><span class="line">                (consumerTag, message) -&gt; {</span><br><span class="line">                    <span class="type">byte</span>[] msgBytes = message.getBody();</span><br><span class="line">                    System.out.println(<span class="string">"æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šæ¶ˆæ¯ID="</span> + consumerTag + <span class="string">"===&gt;"</span> + <span class="keyword">new</span> <span class="title class_">String</span>(msgBytes));</span><br><span class="line">                },</span><br><span class="line">                consumerTag -&gt; {</span><br><span class="line">                    System.out.println(<span class="string">"æ¶ˆæ¯æ¶ˆè´¹è¢«ä¸­æ–­"</span>);</span><br><span class="line">                });</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Topic-é€šé…ç¬¦æ¨¡å¼"><a href="#Topic-é€šé…ç¬¦æ¨¡å¼" class="headerlink" title="Topic é€šé…ç¬¦æ¨¡å¼"></a>Topic é€šé…ç¬¦æ¨¡å¼</h2><p>Topicç±»å‹ä¸Directç›¸æ¯”ï¼Œéƒ½æ˜¯å¯ä»¥æ ¹æ®RoutingKeyæŠŠæ¶ˆæ¯è·¯ç”±åˆ°ä¸åŒçš„é˜Ÿåˆ—ã€‚åªä¸è¿‡Topicç±»å‹Exchangeå¯ä»¥è®©é˜Ÿåˆ—åœ¨ç»‘å®šRouting keyçš„æ—¶å€™ä½¿ç”¨é€šé…ç¬¦ã€‚</p>
<p><img src="/p/40f0af9d/RabbitMQ-Topics%E9%80%9A%E9%85%8D%E7%AC%A6%E6%A8%A1%E5%BC%8F.png" alt="image-20210619214503441"></p>
<p>Routingkey ä¸€èˆ¬éƒ½æ˜¯æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯ç»„æˆï¼Œå¤šä¸ªå•è¯ä¹‹é—´ä»¥â€œ . â€åˆ†å‰²ï¼Œä¾‹å¦‚ï¼š item.insertã€item.insert.abcã€‚</p>
<p>é€šé…ç¬¦è§„åˆ™ï¼š</p>
<ul>
<li><p>#ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¯</p>
</li>
<li><p>*ï¼šåªåŒ¹é…1ä¸ªè¯</p>
</li>
</ul>
<p>ä¸¾ä¾‹ï¼š</p>
<p>item.#ï¼šèƒ½å¤ŸåŒ¹é… item.insert.abc æˆ–è€… item.insert</p>
<p>item.*ï¼šåªèƒ½åŒ¹é… item.insert</p>
<img src="/p/40f0af9d/_posts/MQ-RabbitMQ-Six-Mode/RabbitMQ-TopicExchangeè·¯ç”±é”®åŒ¹é…è§„åˆ™.png" alt="image-20210619215508877" style="zoom:150%;">

<p>çº¢è‰²Queueï¼šç»‘å®šçš„æ˜¯usa.# ï¼Œå› æ­¤å‡¡æ˜¯ä»¥ usa.å¼€å¤´çš„routing key éƒ½ä¼šè¢«åŒ¹é…åˆ°ã€‚</p>
<p>é»„è‰²Queueï¼šç»‘å®šçš„æ˜¯#.news ï¼Œå› æ­¤å‡¡æ˜¯ä»¥ .newsç»“å°¾çš„ routing key éƒ½ä¼šè¢«åŒ¹é…ã€‚</p>
<p>è¿˜æœ‰ä¸€ç§RPCçš„æ¨¡å¼ï¼Œä¸å¸¸ç”¨ï¼Œæ­¤å¤„çœç•¥ã€‚</p>
<h2 id="RabbitMQå·¥ä½œæ¨¡å¼æ€»ç»“"><a href="#RabbitMQå·¥ä½œæ¨¡å¼æ€»ç»“" class="headerlink" title="RabbitMQå·¥ä½œæ¨¡å¼æ€»ç»“"></a>RabbitMQå·¥ä½œæ¨¡å¼æ€»ç»“</h2><h3 id="ç®€å•æ¨¡å¼-HelloWorld"><a href="#ç®€å•æ¨¡å¼-HelloWorld" class="headerlink" title="ç®€å•æ¨¡å¼ HelloWorld"></a>ç®€å•æ¨¡å¼ HelloWorld</h3><p>ä¸€ä¸ªç”Ÿäº§è€…ã€ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œä¸éœ€è¦è®¾ç½®äº¤æ¢æœºï¼ˆä½¿ç”¨é»˜è®¤çš„äº¤æ¢æœºï¼‰</p>
<h3 id="å·¥ä½œé˜Ÿåˆ—æ¨¡å¼-Work-Queue"><a href="#å·¥ä½œé˜Ÿåˆ—æ¨¡å¼-Work-Queue" class="headerlink" title="å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ Work Queue"></a>å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ Work Queue</h3><p>ä¸€ä¸ªç”Ÿäº§è€…ã€å¤šä¸ªæ¶ˆè´¹è€…ï¼ˆç«äº‰å…³ç³»ï¼‰ï¼Œä¸éœ€è¦è®¾ç½®äº¤æ¢æœºï¼ˆä½¿ç”¨é»˜è®¤çš„äº¤æ¢æœºï¼‰</p>
<h3 id="å‘å¸ƒè®¢é˜…æ¨¡å¼-Publish-subscribe"><a href="#å‘å¸ƒè®¢é˜…æ¨¡å¼-Publish-subscribe" class="headerlink" title="å‘å¸ƒè®¢é˜…æ¨¡å¼ Publish/subscribe"></a>å‘å¸ƒè®¢é˜…æ¨¡å¼ Publish/subscribe</h3><p>éœ€è¦è®¾ç½®ç±»å‹ä¸ºfanoutçš„äº¤æ¢æœºï¼Œå¹¶ä¸”äº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šå°†æ¶ˆæ¯å‘é€åˆ°ç»‘å®šçš„é˜Ÿåˆ—</p>
<h3 id="è·¯ç”±æ¨¡å¼-Routing"><a href="#è·¯ç”±æ¨¡å¼-Routing" class="headerlink" title="è·¯ç”±æ¨¡å¼ Routing"></a>è·¯ç”±æ¨¡å¼ Routing</h3><p>éœ€è¦è®¾ç½®ç±»å‹ä¸ºdirectçš„äº¤æ¢æœºï¼Œäº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå¹¶ä¸”æŒ‡å®šrouting keyï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šæ ¹æ®routing keyå°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—</p>
<h3 id="é€šé…ç¬¦æ¨¡å¼-Topic"><a href="#é€šé…ç¬¦æ¨¡å¼-Topic" class="headerlink" title="é€šé…ç¬¦æ¨¡å¼ Topic"></a>é€šé…ç¬¦æ¨¡å¼ Topic</h3><p>éœ€è¦è®¾ç½®ç±»å‹ä¸ºtopicçš„äº¤æ¢æœºï¼Œäº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå¹¶ä¸”æŒ‡å®šé€šé…ç¬¦æ–¹å¼çš„routing keyï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šæ ¹æ®routing keyå°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—</p>
</body></html>]]></content>
      <tags>
        <tag>æ¶ˆæ¯ä¸­é—´ä»¶</tag>
        <tag>RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MYSQLäº‹åŠ¡</title>
    <url>/p/40cc508f.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="äº‹åŠ¡çš„4å¤§ç‰¹æ€§ï¼ˆACIDï¼‰"><a href="#äº‹åŠ¡çš„4å¤§ç‰¹æ€§ï¼ˆACIDï¼‰" class="headerlink" title="äº‹åŠ¡çš„4å¤§ç‰¹æ€§ï¼ˆACIDï¼‰"></a>äº‹åŠ¡çš„4å¤§ç‰¹æ€§ï¼ˆACIDï¼‰</h2><p><strong>A - atomicity åŸå­æ€§</strong></p>
<p>äº‹åŠ¡ä¸å¯å†åˆ†å‰²ï¼Œäº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆéƒ½å‘ç”Ÿï¼Œè¦ä¹ˆéƒ½ä¸å‘ç”Ÿã€‚</p>
<p><strong>C - constancy ä¸€è‡´æ€§</strong></p>
<p>äº‹åŠ¡æ‰§è¡Œä¼šä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜æ¢åˆ°å¦ä¸€ä¸ªä¸€è‡´çŠ¶æ€ã€‚</p>
<p><strong>I - isolation éš”ç¦»æ€§</strong></p>
<p> äº‹åŠ¡çš„æ‰§è¡Œä¸ä¼šå—åˆ°å…¶ä»–äº‹åŠ¡çš„å¹²æ‰°ã€‚</p>
<p><strong>D - durbility æŒä¹…æ€§</strong> </p>
<p>äº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œåˆ™ä¼šæ°¸ä¹…æ”¹å˜æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚</p>
<h2 id="äº‹åŠ¡çš„3å¤§é—®é¢˜"><a href="#äº‹åŠ¡çš„3å¤§é—®é¢˜" class="headerlink" title="äº‹åŠ¡çš„3å¤§é—®é¢˜"></a>äº‹åŠ¡çš„3å¤§é—®é¢˜</h2><p>å¯¹äºä¸¤ä¸ªäº‹åŠ¡T1å’ŒT2ã€‚</p>
<p><strong>é—®é¢˜ä¸€</strong></p>
<p>è„è¯»ã€‚T1è¯»å–äº†å·²ç»è¢«T2æ›´æ–°ä½†è¿˜æ²¡æœ‰è¢«æäº¤çš„å­—æ®µä¹‹åï¼Œè‹¥T2å›æ»šï¼ŒT1è¯»å–çš„å†…å®¹å°±æ˜¯ä¸´æ—¶ä¸”æ— æ•ˆçš„ã€‚</p>
<p><strong>é—®é¢˜äºŒ</strong></p>
<p>ä¸å¯é‡å¤è¯»ã€‚T1è¯»å–äº†ä¸€ä¸ªå­—æ®µåï¼ŒT2æ›´æ–°äº†è¯¥å­—æ®µä¹‹åï¼ŒT1å†æ¬¡è¯»å–åŒä¸€ä¸ªå­—æ®µçš„å€¼è‡ªç„¶å°±ä¸åŒäº†ã€‚</p>
<p><strong>é—®é¢˜ä¸‰</strong></p>
<p>å¹»è¯»ã€‚T1ä»ä¸€ä¸ªè¡¨ä¸­è¯»å–äº†ä¸€ä¸ªå­—æ®µåï¼ŒT2åœ¨è¯¥è¡¨ä¸­æ’å…¥/åˆ é™¤äº†ä¸€äº›æ–°çš„è¡Œä¹‹åï¼Œå¦‚æœT1å†æ¬¡è¯»å–åŒä¸€ä¸ªè¡¨ï¼Œé‚£ä¹ˆå°±å¯èƒ½å¤šè¯»/å°‘è¯»å‡ è¡Œæ•°æ®ã€‚</p>
<h2 id="4ä¸ªæ ‡å‡†çš„éš”ç¦»çº§åˆ«"><a href="#4ä¸ªæ ‡å‡†çš„éš”ç¦»çº§åˆ«" class="headerlink" title="4ä¸ªæ ‡å‡†çš„éš”ç¦»çº§åˆ«"></a>4ä¸ªæ ‡å‡†çš„éš”ç¦»çº§åˆ«</h2><p>ä¸€ä¸ªäº‹åŠ¡ä¸å…¶ä»–äº‹åŠ¡éš”ç¦»çš„ç¨‹åº¦ç§°ä¸ºéš”ç¦»çº§åˆ«ï¼Œæ•°æ®åº“è§„å®šäº†å¤šç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œä¸åŒéš”ç¦»çº§åˆ«å¯¹åº”ä¸åŒçš„å¹²æ‰°ç¨‹åº¦ï¼Œéš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œæ•°æ®ä¸€è‡´æ€§å°±è¶Šå¥½ï¼Œä½†å¹¶å‘æ€§è¶Šå¼±ã€‚</p>
<ul>
<li><strong>READ UNCOMMITEDï¼ˆæœªæäº¤è¯»ï¼‰</strong></li>
</ul>
<p>ä¼šå‘ç”Ÿè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ã€‚</p>
<p>åœ¨è¯¥éš”ç¦»çº§åˆ«ï¼Œæ‰€æœ‰äº‹åŠ¡éƒ½å¯ä»¥çœ‹åˆ°å…¶ä»–æœªæäº¤äº‹åŠ¡çš„æ‰§è¡Œç»“æœã€‚æœ¬éš”ç¦»çº§åˆ«å¾ˆå°‘ç”¨äºå®é™…åº”ç”¨ï¼Œå› ä¸ºå®ƒçš„æ€§èƒ½ä¹Ÿä¸æ¯”å…¶ä»–çº§åˆ«å¥½å¤šå°‘ã€‚è¯»å–æœªæäº¤çš„æ•°æ®ï¼Œä¹Ÿè¢«ç§°ä¹‹ä¸ºè„è¯»ï¼ˆDirty Readï¼‰ã€‚</p>
<ul>
<li><strong>READ COMMITTEDï¼ˆå·²æäº¤è¯»ï¼‰</strong></li>
</ul>
<p>ä¼šå‘ç”Ÿä¸å¯é‡å¤è¯»ã€å¹»è¯»ã€‚</p>
<p>è¿™æ˜¯å¤§å¤šæ•°æ•°æ®åº“ç³»ç»Ÿçš„é»˜è®¤éš”ç¦»çº§åˆ«ï¼ˆä½†ä¸æ˜¯MySQLé»˜è®¤çš„ï¼‰ã€‚å®ƒæ»¡è¶³äº†éš”ç¦»çš„ç®€å•å®šä¹‰ï¼šä¸€ä¸ªäº‹åŠ¡åªèƒ½çœ‹è§å·²ç»æäº¤äº‹åŠ¡æ‰€åšçš„æ”¹å˜ã€‚è¿™ç§éš”ç¦»çº§åˆ«ä¹Ÿæ”¯æŒæ‰€è°“çš„ä¸å¯é‡å¤è¯»ï¼ˆNonrepeatable Readï¼‰ï¼Œå› ä¸ºåŒä¸€äº‹åŠ¡çš„å…¶ä»–å®ä¾‹åœ¨è¯¥å®ä¾‹å¤„ç†å…¶é—´å¯èƒ½ä¼šæœ‰æ–°çš„commitï¼Œæ‰€ä»¥åŒä¸€selectå¯èƒ½è¿”å›ä¸åŒç»“æœã€‚</p>
<ul>
<li><strong>é»˜è®¤REPEATABLE READï¼ˆå¯é‡å¤è¯»ï¼‰</strong></li>
</ul>
<p>ä¼šå‘ç”Ÿå¹»è¯»ã€‚</p>
<p>è¿™æ˜¯MySQLçš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå®ƒç¡®ä¿åŒä¸€äº‹åŠ¡çš„å¤šä¸ªå®ä¾‹åœ¨å¹¶å‘è¯»å–æ•°æ®æ—¶ï¼Œä¼šçœ‹åˆ°åŒæ ·çš„æ•°æ®è¡Œã€‚ä¸è¿‡ç†è®ºä¸Šï¼Œè¿™ä¼šå¯¼è‡´å¦ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼šå¹»è¯» ï¼ˆPhantom Readï¼‰ã€‚ç®€å•çš„è¯´ï¼Œå¹»è¯»æŒ‡å½“ç”¨æˆ·è¯»å–æŸä¸€èŒƒå›´çš„æ•°æ®è¡Œæ—¶ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡åˆåœ¨è¯¥èŒƒå›´å†…æ’å…¥äº†æ–°è¡Œï¼Œå½“ç”¨æˆ·å†è¯»å–è¯¥èŒƒå›´çš„æ•°æ®è¡Œæ—¶ï¼Œä¼šå‘ç°æœ‰æ–°çš„â€œå¹»å½±â€ è¡Œã€‚InnoDBå’ŒFalconå­˜å‚¨å¼•æ“é€šè¿‡å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼ŒMultiversion Concurrency Controlï¼‰æœºåˆ¶è§£å†³äº†è¯¥é—®é¢˜ã€‚</p>
<p>ç®€å•è®²ä¸‹MVCCå§ï¼ŒMVCCæ²¡æœ‰å®ç°æ ‡å‡†ï¼Œæ‰€ä»¥åœ¨ MySQLã€Oracleã€PostgreSQLç­‰éƒ½é‡‡ç”¨ä¸åŒæœºåˆ¶ï¼ˆå…¸å‹çš„æœ‰ä¹è§‚å¹¶å‘æ§åˆ¶å’Œæ‚²è§‚å¹¶å‘æ§åˆ¶ï¼‰å®ç°äº†MVCCã€‚å¯ä»¥è®¤ä¸ºæ˜¯è¡Œçº§é”çš„ä¸€ä¸ªå˜ç§ï¼Œä½†æ˜¯åœ¨å¾ˆå¤šæƒ…å†µä¸‹é¿å…äº†åŠ é”æ“ä½œï¼Œå°½ç®¡å®ç°æœºåˆ¶ä¸åŒï¼Œä½†å¤§å¤šéƒ½å®ç°äº†éé˜»å¡çš„è¯»æ“ä½œï¼Œå†™æ“ä½œä¹Ÿåªæ˜¯é”å®šäº†å¿…è¦çš„è¡Œã€‚</p>
<ul>
<li><strong>SERIALIZABLEï¼ˆä¸²è¡ŒåŒ–ï¼‰</strong></li>
</ul>
<p>äº‹åŠ¡é¡ºåºæ‰§è¡Œï¼Œæ²¡æœ‰å¹¶è¡Œï¼Œå®Œå…¨æœç»å¹»è¯»ã€‚</p>
<p>è¿™æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®ƒé€šè¿‡å¼ºåˆ¶äº‹åŠ¡æ’åºï¼Œä½¿ä¹‹ä¸å¯èƒ½ç›¸äº’å†²çªï¼Œä»è€Œè§£å†³å¹»è¯»é—®é¢˜ã€‚ç®€è¨€ä¹‹ï¼Œå®ƒæ˜¯åœ¨æ¯ä¸ªè¯»çš„æ•°æ®è¡Œä¸ŠåŠ ä¸Šå…±äº«é”ã€‚åœ¨è¿™ä¸ªçº§åˆ«ï¼Œå¯èƒ½å¯¼è‡´å¤§é‡çš„è¶…æ—¶ç°è±¡å’Œé”ç«äº‰ã€‚</p>
<p><strong>éš”ç¦»çº§åˆ«çš„æ“ä½œç¤ºä¾‹</strong></p>
<p>æŸ¥çœ‹å½“å‰éš”ç¦»çº§åˆ«</p>
<p>SELECT @@tx_isolation;</p>
<p>è®¾ç½®å½“å‰MYSQLè¿æ¥çš„éš”ç¦»çº§åˆ«</p>
<p>set session transaction isolation level ã€read committedã€‘;</p>
<p>è®¾ç½®æ•°æ®åº“ç³»ç»Ÿçš„å…¨å±€éš”ç¦»çº§åˆ«</p>
<p>set global transaction isolation level ã€read committedã€‘;</p>
<h2 id="äº‹åŠ¡çš„åˆ›å»º"><a href="#äº‹åŠ¡çš„åˆ›å»º" class="headerlink" title="äº‹åŠ¡çš„åˆ›å»º"></a>äº‹åŠ¡çš„åˆ›å»º</h2><ul>
<li><strong>æŸ¥çœ‹äº‹åŠ¡çŠ¶æ€</strong></li>
</ul>
<p>SHOW VARIABLES LIKE â€˜autocommitâ€™</p>
<ul>
<li><strong>éšå¼äº‹åŠ¡</strong></li>
</ul>
<p>äº‹åŠ¡æ²¡æœ‰æ˜æ˜¾çš„å¼€å¯å’Œç»“æŸæ ‡è®°ï¼Œæ¯”å¦‚ï¼Œå•æ¡insertã€updateã€deleteè¯­å¥ã€‚</p>
<ul>
<li><strong>æ˜¾å¼äº‹åŠ¡</strong></li>
</ul>
<p>äº‹åŠ¡å…·æœ‰æ˜æ˜¾çš„å¼€å¯å’Œç»“æŸæ ‡è®°ï¼Œä½¿ç”¨çš„å‰æå¿…é¡»æ˜¯å…ˆè®¾ç½®è‡ªåŠ¨æäº¤åŠŸèƒ½ä¸ºç¦ç”¨çŠ¶æ€ SET AUTOCOMMIT=0ï¼Œåªé’ˆå¯¹å½“å‰ä¼šè¯æœ‰æ•ˆã€‚</p>
<p>äº‹åŠ¡çš„å¼€å§‹æ ‡è®° START TRANSACTION; ç»“æŸäº‹åŠ¡ COMMIT; æˆ– ROLLBACK;</p>
<h2 id="é¢è¯•é¢˜ï¼šSpringä¸­çš„-Transactional-æ³¨è§£"><a href="#é¢è¯•é¢˜ï¼šSpringä¸­çš„-Transactional-æ³¨è§£" class="headerlink" title="é¢è¯•é¢˜ï¼šSpringä¸­çš„@Transactional æ³¨è§£"></a>é¢è¯•é¢˜ï¼šSpringä¸­çš„@Transactional æ³¨è§£</h2><p>æ›¾ç»åˆšå‡ºæ¥å·¥ä½œçš„æ—¶å€™ï¼Œåšè¿‡è¿™æ ·ä¸€ä¸ªé¢˜ï¼Œbå‘ç”Ÿå¼‚å¸¸ï¼Œä¼šå›æ»šå—ï¼Ÿ</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">test</span>{</span><br><span class="line">    <span class="meta">@Transactional</span> </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">a</span><span class="params">()</span>{}</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">b</span><span class="params">()</span> {</span><br><span class="line">        a(); </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸ä¼šå›æ»šã€‚ç±»å†…éƒ¨æ–¹æ³•è°ƒç”¨æœ¬ç±»å†…éƒ¨çš„å…¶ä»–æ–¹æ³•ä¸ä¼šå¼•èµ·äº‹åŠ¡è¡Œä¸ºï¼Œå³ä½¿è¢«è°ƒç”¨çš„æ–¹æ³•ä½¿ç”¨äº† @Transactional æ³¨è§£è¿›è¡Œä¿®é¥°ã€‚</p>
<p>@Transactional  å¯ä½œç”¨äºæ¥å£ã€æ¥å£æ–¹æ³•ã€ç±»ã€ç±»æ–¹æ³•ã€è¯¥ç±»æ‰€æœ‰ pulic æ–¹æ³•å°†å…·æœ‰è¯¥ç±»å‹çš„äº‹åŠ¡å±æ€§ï¼ŒåŒæ—¶</p>
</body></html>]]></content>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MYSQLå…«è‚¡æ–‡</title>
    <url>/p/ca035920.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="ä»€ä¹ˆæ˜¯MySQLï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯MySQLï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯MySQLï¼Ÿ"></a>ä»€ä¹ˆæ˜¯MySQLï¼Ÿ</h2><p>ç™¾åº¦ç™¾ç§‘ä¸Šçš„è§£é‡Šï¼šMySQLæ˜¯ä¸€ç§å¼€æ”¾æºä»£ç çš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆRDBMSï¼‰ï¼Œä½¿ç”¨æœ€å¸¸ç”¨çš„æ•°æ®åº“ç®¡ç†è¯­è¨€â€“ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼ˆSQLï¼‰è¿›è¡Œæ•°æ®åº“ç®¡ç†ã€‚MySQLæ˜¯å¼€æ”¾æºä»£ç çš„ï¼Œå› æ­¤ä»»ä½•äººéƒ½å¯ä»¥åœ¨General Public Licenseçš„è®¸å¯ä¸‹ä¸‹è½½å¹¶æ ¹æ®ä¸ªæ€§åŒ–çš„éœ€è¦å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚</p>
<h2 id="MySQLå¸¸ç”¨çš„å­˜å‚¨å¼•æ“æœ‰ä»€ä¹ˆï¼Ÿå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#MySQLå¸¸ç”¨çš„å­˜å‚¨å¼•æ“æœ‰ä»€ä¹ˆï¼Ÿå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="MySQLå¸¸ç”¨çš„å­˜å‚¨å¼•æ“æœ‰ä»€ä¹ˆï¼Ÿå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>MySQLå¸¸ç”¨çš„å­˜å‚¨å¼•æ“æœ‰ä»€ä¹ˆï¼Ÿå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2><ul>
<li><p>InnoDB</p>
<p>InnoDBæ˜¯MySQLçš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼Œæ”¯æŒäº‹åŠ¡ã€è¡Œé”å’Œå¤–é”®ç­‰æ“ä½œã€‚</p>
</li>
<li><p>MyISAM</p>
<p>MyISAMæ˜¯MySQL5.1ç‰ˆæœ¬å‰çš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼ŒMyISAMçš„å¹¶å‘æ€§æ¯”è¾ƒå·®ï¼Œä¸æ”¯æŒäº‹åŠ¡å’Œå¤–é”®ç­‰æ“ä½œï¼Œé»˜è®¤çš„é”çš„ç²’åº¦ä¸ºè¡¨çº§é”ã€‚</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">InnoDB</th>
<th align="center">MyISAM</th>
</tr>
</thead>
<tbody><tr>
<td align="center">å¤–é”®</td>
<td align="center">æ”¯æŒ</td>
<td align="center">ä¸æ”¯æŒ</td>
</tr>
<tr>
<td align="center">äº‹åŠ¡</td>
<td align="center">æ”¯æŒ</td>
<td align="center">ä¸æ”¯æŒ</td>
</tr>
<tr>
<td align="center">é”</td>
<td align="center">æ”¯æŒè¡¨é”å’Œè¡Œé”</td>
<td align="center">æ”¯æŒè¡¨é”</td>
</tr>
<tr>
<td align="center">å¯æ¢å¤æ€§</td>
<td align="center">æ ¹æ®äº‹åŠ¡æ—¥å¿—è¿›è¡Œæ¢å¤</td>
<td align="center">æ— äº‹åŠ¡æ—¥å¿—</td>
</tr>
<tr>
<td align="center">è¡¨ç»“æ„</td>
<td align="center">æ•°æ®å’Œç´¢å¼•æ˜¯é›†ä¸­å­˜å‚¨çš„ï¼Œ.ibdå’Œ.frm</td>
<td align="center">æ•°æ®å’Œç´¢å¼•æ˜¯åˆ†å¼€å­˜å‚¨çš„ï¼Œæ•°æ®<code>.MYD</code>ï¼Œç´¢å¼•<code>.MYI</code></td>
</tr>
<tr>
<td align="center">æŸ¥è¯¢æ€§èƒ½</td>
<td align="center">ä¸€èˆ¬æƒ…å†µç›¸æ¯”äºMyISAMè¾ƒå·®</td>
<td align="center">ä¸€èˆ¬æƒ…å†µç›¸æ¯”äºInnoDBè¾ƒå·®</td>
</tr>
<tr>
<td align="center">ç´¢å¼•</td>
<td align="center">èšç°‡ç´¢å¼•</td>
<td align="center">éèšç°‡ç´¢å¼•</td>
</tr>
</tbody></table>
<h2 id="æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼"><a href="#æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼" class="headerlink" title="æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼"></a>æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼</h2><ul>
<li>ç¬¬ä¸€èŒƒå¼ï¼šç¡®ä¿æ¯åˆ—ä¿æŒåŸå­æ€§ï¼Œæ•°æ®è¡¨ä¸­çš„æ‰€æœ‰å­—æ®µå€¼éƒ½æ˜¯ä¸å¯åˆ†è§£çš„åŸå­å€¼ã€‚</li>
<li>ç¬¬äºŒèŒƒå¼ï¼šç¡®ä¿è¡¨ä¸­çš„æ¯åˆ—éƒ½å’Œä¸»é”®ç›¸å…³</li>
<li>ç¬¬ä¸‰èŒƒå¼ï¼šç¡®ä¿æ¯åˆ—éƒ½å’Œä¸»é”®åˆ—ç›´æ¥ç›¸å…³è€Œä¸æ˜¯é—´æ¥ç›¸å…³</li>
</ul>
<h2 id="MySQLçš„æ•°æ®ç±»å‹æœ‰å“ªäº›"><a href="#MySQLçš„æ•°æ®ç±»å‹æœ‰å“ªäº›" class="headerlink" title="MySQLçš„æ•°æ®ç±»å‹æœ‰å“ªäº›"></a>MySQLçš„æ•°æ®ç±»å‹æœ‰å“ªäº›</h2><ul>
<li><p>æ•´æ•°</p>
<p>TINYINTã€SMALLINTã€MEDIUMINTã€INTã€BIGINTåˆ†åˆ«å ç”¨8ã€16ã€24ã€32ã€64ä½å­˜å‚¨ç©ºé—´ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒINT(10)ä¸­çš„10åªæ˜¯è¡¨ç¤ºæ˜¾ç¤ºå­—ç¬¦çš„ä¸ªæ•°ï¼Œå¹¶æ— å®é™…æ„ä¹‰ã€‚ä¸€èˆ¬å’ŒUNSIGNED ZEROFILLé…åˆä½¿ç”¨æ‰æœ‰å®é™…æ„ä¹‰ï¼Œä¾‹å¦‚ï¼Œæ•°æ®ç±»å‹INT(3)ï¼Œå±æ€§ä¸ºUNSIGNED ZEROFILLï¼Œå¦‚æœæ’å…¥çš„æ•°æ®ä¸º3çš„è¯ï¼Œå®é™…å­˜å‚¨çš„æ•°æ®ä¸º003ã€‚</p>
</li>
<li><p>æµ®ç‚¹æ•°</p>
<p>FLOATã€DOUBLEåŠDECIMALä¸ºæµ®ç‚¹æ•°ç±»å‹ï¼ŒDECIMALæ˜¯åˆ©ç”¨å­—ç¬¦ä¸²è¿›è¡Œå¤„ç†çš„ï¼Œèƒ½å­˜å‚¨ç²¾ç¡®çš„å°æ•°ã€‚ç›¸æ¯”äºFLOATå’ŒDOUBLEï¼ŒDECIMALçš„æ•ˆç‡æ›´ä½äº›ã€‚FLOATã€DOUBLEåŠDECIMALéƒ½å¯ä»¥æŒ‡å®šåˆ—å®½ï¼Œä¾‹å¦‚FLOAT(5,2)è¡¨ç¤ºä¸€å…±5ä½ï¼Œä¸¤ä½å­˜å‚¨å°æ•°éƒ¨åˆ†ï¼Œä¸‰ä½å­˜å‚¨æ•´æ•°éƒ¨åˆ†ã€‚</p>
</li>
<li><p>å­—ç¬¦ä¸²</p>
<p>å­—ç¬¦ä¸²å¸¸ç”¨çš„ä¸»è¦æœ‰CHARå’ŒVARCHARï¼ŒVARCHARä¸»è¦ç”¨äºå­˜å‚¨å¯å˜é•¿å­—ç¬¦ä¸²ï¼Œç›¸æ¯”äºå®šé•¿çš„CHARæ›´èŠ‚çœç©ºé—´ã€‚CHARæ˜¯å®šé•¿çš„ï¼Œæ ¹æ®å®šä¹‰çš„å­—ç¬¦ä¸²é•¿åº¦åˆ†é…ç©ºé—´ã€‚</p>
<p>åº”ç”¨åœºæ™¯ï¼šå¯¹äºç»å¸¸å˜æ›´çš„æ•°æ®ä½¿ç”¨CHARæ›´å¥½ï¼ŒCHARä¸å®¹æ˜“äº§ç”Ÿç¢ç‰‡ã€‚å¯¹äºéå¸¸çŸ­çš„åˆ—ä¹Ÿæ˜¯ä½¿ç”¨CHARæ›´å¥½äº›ï¼ŒCHARç›¸æ¯”äºVARCHARåœ¨æ•ˆç‡ä¸Šæ›´é«˜äº›ã€‚ä¸€èˆ¬é¿å…ä½¿ç”¨TEXT/BLOBç­‰ç±»å‹ï¼Œå› ä¸ºæŸ¥è¯¢æ—¶ä¼šä½¿ç”¨ä¸´æ—¶è¡¨ï¼Œé€ æˆä¸¥é‡çš„æ€§èƒ½å¼€é”€ã€‚</p>
</li>
<li><p>æ—¥æœŸ</p>
<p>æ¯”è¾ƒå¸¸ç”¨çš„æœ‰yearã€timeã€dateã€datetimeã€timestampç­‰ï¼Œdatetimeä¿å­˜ä»1000å¹´åˆ°9999å¹´çš„æ—¶é—´ï¼Œç²¾åº¦åˆ°ç§’ï¼Œä½¿ç”¨8å­—èŠ‚çš„å­˜å‚¨ç©ºé—´ï¼Œä¸æ—¶åŒºæ— å…³ã€‚timestampå’ŒUNIXçš„æ—¶é—´æˆ³ç›¸åŒï¼Œä¿å­˜ä»1970å¹´1æœˆ1æ—¥åˆå¤œåˆ°2038å¹´çš„æ—¶é—´ï¼Œç²¾åº¦åˆ°ç§’ï¼Œä½¿ç”¨å››ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ï¼Œå¹¶ä¸”ä¸æ—¶åŒºç›¸å…³ã€‚</p>
<p>åº”ç”¨åœºæ™¯ï¼šå°½é‡ä½¿ç”¨timestampï¼Œç›¸æ¯”äºdatetimeå®ƒæœ‰ç€æ›´é«˜çš„ç©ºé—´æ•ˆç‡ã€‚</p>
</li>
</ul>
<h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><h3 id="ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ</h3><p>ç™¾åº¦ç™¾ç§‘çš„è§£é‡Šï¼šç´¢å¼•æ˜¯å¯¹æ•°æ®åº“è¡¨çš„ä¸€åˆ—æˆ–è€…å¤šåˆ—çš„å€¼è¿›è¡Œæ’åºä¸€ç§ç»“æ„ï¼Œä½¿ç”¨ç´¢å¼•å¯ä»¥å¿«é€Ÿè®¿é—®æ•°æ®è¡¨ä¸­çš„ç‰¹å®šä¿¡æ¯ã€‚</p>
<h3 id="ç´¢å¼•çš„ä¼˜ç¼ºç‚¹ï¼Ÿ"><a href="#ç´¢å¼•çš„ä¼˜ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="ç´¢å¼•çš„ä¼˜ç¼ºç‚¹ï¼Ÿ"></a>ç´¢å¼•çš„ä¼˜ç¼ºç‚¹ï¼Ÿ</h3><p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>å¤§å¤§åŠ å¿«æ•°æ®æ£€ç´¢çš„é€Ÿåº¦ã€‚</li>
<li>å°†éšæœºI/Oå˜æˆé¡ºåºI/O(å› ä¸ºB+æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯è¿æ¥åœ¨ä¸€èµ·çš„)</li>
<li>åŠ é€Ÿè¡¨ä¸è¡¨ä¹‹é—´çš„è¿æ¥</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>ä»ç©ºé—´è§’åº¦è€ƒè™‘ï¼Œå»ºç«‹ç´¢å¼•éœ€è¦å ç”¨ç‰©ç†ç©ºé—´</li>
<li>ä»æ—¶é—´è§’åº¦ è€ƒè™‘ï¼Œåˆ›å»ºå’Œç»´æŠ¤ç´¢å¼•éƒ½éœ€è¦èŠ±è´¹æ—¶é—´ï¼Œä¾‹å¦‚å¯¹æ•°æ®è¿›è¡Œå¢åˆ æ”¹çš„æ—¶å€™éƒ½éœ€è¦ç»´æŠ¤ç´¢å¼•ã€‚</li>
</ul>
<h3 id="ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Ÿ"><a href="#ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Ÿ" class="headerlink" title="ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Ÿ"></a>ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Ÿ</h3><p>ç´¢å¼•çš„æ•°æ®ç»“æ„ä¸»è¦æœ‰B+æ ‘å’Œå“ˆå¸Œè¡¨ï¼Œå¯¹åº”çš„ç´¢å¼•åˆ†åˆ«ä¸ºB+æ ‘ç´¢å¼•å’Œå“ˆå¸Œç´¢å¼•ã€‚InnoDBå¼•æ“çš„ç´¢å¼•ç±»å‹æœ‰B+æ ‘ç´¢å¼•å’Œå“ˆå¸Œç´¢å¼•ï¼Œé»˜è®¤çš„ç´¢å¼•ç±»å‹ä¸ºB+æ ‘ç´¢å¼•ã€‚</p>
<ul>
<li><p>B+æ ‘ç´¢å¼•</p>
<p>ç†Ÿæ‚‰æ•°æ®ç»“æ„çš„åŒå­¦éƒ½çŸ¥é“ï¼ŒB+æ ‘ã€å¹³è¡¡äºŒå‰æ ‘ã€çº¢é»‘æ ‘éƒ½æ˜¯ç»å…¸çš„æ•°æ®ç»“æ„ã€‚åœ¨B+æ ‘ä¸­ï¼Œæ‰€æœ‰çš„è®°å½•èŠ‚ç‚¹éƒ½æ˜¯æŒ‰ç…§é”®å€¼å¤§å°çš„é¡ºåºæ”¾åœ¨å¶å­èŠ‚ç‚¹ä¸Šï¼Œå¦‚ä¸‹å›¾ã€‚</p>
</li>
</ul>
<p><img src="/p/ca035920/MySQL-BTree.png" alt="å›¾ç‰‡"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡º ï¼Œå› ä¸ºB+æ ‘å…·æœ‰æœ‰åºæ€§ï¼Œå¹¶ä¸”æ‰€æœ‰çš„æ•°æ®éƒ½å­˜æ”¾åœ¨å¶å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥æŸ¥æ‰¾çš„æ•ˆç‡éå¸¸é«˜ï¼Œå¹¶ä¸”æ”¯æŒæ’åºå’ŒèŒƒå›´æŸ¥æ‰¾ã€‚</p>
<p>B+æ ‘çš„ç´¢å¼•åˆå¯ä»¥åˆ†ä¸ºä¸»ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•ã€‚å…¶ä¸­ä¸»ç´¢å¼•ä¸ºèšç°‡ç´¢å¼•ï¼Œè¾…åŠ©ç´¢å¼•ä¸ºéèšç°‡ç´¢å¼•ã€‚èšç°‡ç´¢å¼•æ˜¯ä»¥ä¸»é”®ä½œä¸ºB+ æ ‘ç´¢å¼•çš„é”®å€¼æ‰€æ„æˆçš„B+æ ‘ç´¢å¼•ï¼Œèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨ç€å®Œæ•´çš„æ•°æ®è®°å½•ï¼›éèšç°‡ç´¢å¼•æ˜¯ä»¥éä¸»é”®çš„åˆ—ä½œä¸ºB+æ ‘ç´¢å¼•çš„é”®å€¼æ‰€æ„æˆçš„B+æ ‘ç´¢å¼•ï¼Œéèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨ç€ä¸»é”®å€¼ã€‚æ‰€ä»¥ä½¿ç”¨éèšç°‡ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œä¼šå…ˆæ‰¾åˆ°ä¸»é”®å€¼ï¼Œç„¶ååˆ°æ ¹æ®èšç°‡ç´¢å¼•æ‰¾åˆ°ä¸»é”®å¯¹åº”çš„æ•°æ®åŸŸã€‚ä¸Šå›¾ä¸­å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯æ•°æ®è®°å½•ï¼Œä¸ºèšç°‡ç´¢å¼•çš„ç»“æ„å›¾ï¼Œéèšç°‡ç´¢å¼•çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="/p/ca035920/MySQL-BTree%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95%E5%92%8C%E9%9D%9E%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95.png" alt="å›¾ç‰‡"></p>
<p>ä¸Šå›¾ä¸­çš„å­—æ¯ä¸ºæ•°æ®çš„éä¸»é”®çš„åˆ—å€¼ï¼Œå‡è®¾è¦æŸ¥è¯¢è¯¥åˆ—å€¼ä¸ºBçš„ä¿¡æ¯ï¼Œåˆ™éœ€å…ˆæ‰¾åˆ°ä¸»é”®7ï¼Œåœ¨åˆ°èšç°‡ç´¢å¼•ä¸­æŸ¥è¯¢ä¸»é”®7æ‰€å¯¹åº”çš„æ•°æ®åŸŸã€‚</p>
<ul>
<li><p>å“ˆå¸Œç´¢å¼•</p>
<p>å“ˆå¸Œç´¢å¼•æ˜¯åŸºäºå“ˆå¸Œè¡¨å®ç°çš„ï¼Œå¯¹äºæ¯ä¸€è¡Œæ•°æ®ï¼Œå­˜å‚¨å¼•æ“ä¼šå¯¹ç´¢å¼•åˆ—é€šè¿‡å“ˆå¸Œç®—æ³•è¿›è¡Œå“ˆå¸Œè®¡ç®—å¾—åˆ°å“ˆå¸Œç ï¼Œå¹¶ä¸”å“ˆå¸Œç®—æ³•è¦å°½é‡ä¿è¯ä¸åŒçš„åˆ—å€¼è®¡ç®—å‡ºçš„å“ˆå¸Œç å€¼æ˜¯ä¸åŒçš„ï¼Œå°†å“ˆå¸Œç çš„å€¼ä½œä¸ºå“ˆå¸Œè¡¨çš„keyå€¼ï¼Œå°†æŒ‡å‘æ•°æ®è¡Œçš„æŒ‡é’ˆä½œä¸ºå“ˆå¸Œè¡¨çš„valueå€¼ã€‚è¿™æ ·æŸ¥æ‰¾ä¸€ä¸ªæ•°æ®çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯o(1)ï¼Œä¸€èˆ¬å¤šç”¨äºç²¾ç¡®æŸ¥æ‰¾ã€‚</p>
</li>
</ul>
<h3 id="Hashç´¢å¼•å’ŒB-æ ‘çš„åŒºåˆ«ï¼Ÿ"><a href="#Hashç´¢å¼•å’ŒB-æ ‘çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="Hashç´¢å¼•å’ŒB+æ ‘çš„åŒºåˆ«ï¼Ÿ"></a>Hashç´¢å¼•å’ŒB+æ ‘çš„åŒºåˆ«ï¼Ÿ</h3><p>å› ä¸ºä¸¤è€…æ•°æ®ç»“æ„ä¸Šçš„å·®å¼‚å¯¼è‡´å®ƒä»¬çš„ä½¿ç”¨åœºæ™¯ä¹Ÿä¸åŒï¼Œå“ˆå¸Œç´¢å¼•ä¸€èˆ¬å¤šç”¨äºç²¾ç¡®çš„ç­‰å€¼æŸ¥æ‰¾ï¼ŒB+ç´¢å¼•åˆ™å¤šç”¨äºé™¤äº†ç²¾ç¡®çš„ç­‰å€¼æŸ¥æ‰¾å¤–çš„å…¶ä»–æŸ¥æ‰¾ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¼šé€‰æ‹©ä½¿ç”¨B+æ ‘ç´¢å¼•ã€‚</p>
<ul>
<li>å“ˆå¸Œç´¢å¼•ä¸æ”¯æŒæ’åºï¼Œå› ä¸ºå“ˆå¸Œè¡¨æ˜¯æ— åºçš„ã€‚</li>
<li>å“ˆå¸Œç´¢å¼•ä¸æ”¯æŒèŒƒå›´æŸ¥æ‰¾ã€‚</li>
<li>å“ˆå¸Œç´¢å¼•ä¸æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢åŠå¤šåˆ—ç´¢å¼•çš„æœ€å·¦å‰ç¼€åŒ¹é…ã€‚</li>
<li>å› ä¸ºå“ˆå¸Œè¡¨ä¸­ä¼šå­˜åœ¨å“ˆå¸Œå†²çªï¼Œæ‰€ä»¥å“ˆå¸Œç´¢å¼•çš„æ€§èƒ½æ˜¯ä¸ç¨³å®šçš„ï¼Œè€ŒB+æ ‘ç´¢å¼•çš„æ€§èƒ½æ˜¯ç›¸å¯¹ç¨³å®šçš„ï¼Œæ¯æ¬¡æŸ¥è¯¢éƒ½æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹</li>
</ul>
<h3 id="ç´¢å¼•çš„ç±»å‹æœ‰å“ªäº›"><a href="#ç´¢å¼•çš„ç±»å‹æœ‰å“ªäº›" class="headerlink" title="ç´¢å¼•çš„ç±»å‹æœ‰å“ªäº›?"></a>ç´¢å¼•çš„ç±»å‹æœ‰å“ªäº›?</h3><p>MySQLä¸»è¦çš„ç´¢å¼•ç±»å‹ä¸»è¦æœ‰FULLTEXTï¼ŒHASHï¼ŒBTREEï¼ŒRTREEã€‚</p>
<ul>
<li><p>FULLTEXT</p>
<p>FULLTEXTå³å…¨æ–‡ç´¢å¼•ï¼ŒMyISAMå­˜å‚¨å¼•æ“å’ŒInnoDBå­˜å‚¨å¼•æ“åœ¨MySQL5.6.4ä»¥ä¸Šç‰ˆæœ¬æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œä¸€èˆ¬ç”¨äºæŸ¥æ‰¾æ–‡æœ¬ä¸­çš„å…³é”®å­—ï¼Œè€Œä¸æ˜¯ç›´æ¥æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰ï¼Œå¤šåœ¨CHARï¼ŒVARCHARï¼ŒTAXTç­‰æ•°æ®ç±»å‹ä¸Šåˆ›å»ºå…¨æ–‡ç´¢å¼•ã€‚å…¨æ–‡ç´¢å¼•ä¸»è¦æ˜¯ç”¨æ¥è§£å†³WHERE name LIKE â€œ%zhang%â€ç­‰é’ˆå¯¹æ–‡æœ¬çš„æ¨¡ç³ŠæŸ¥è¯¢æ•ˆç‡ä½çš„é—®é¢˜ã€‚</p>
</li>
<li><p>HASH</p>
<p>HASHå³å“ˆå¸Œç´¢å¼•ï¼Œå“ˆå¸Œç´¢å¼•å¤šç”¨äºç­‰å€¼æŸ¥è¯¢ï¼Œæ—¶é—´å¤æ‚åº¦o(1)ï¼Œæ•ˆç‡éå¸¸é«˜ï¼Œä½†ä¸æ”¯æŒæ’åºã€èŒƒå›´æŸ¥è¯¢åŠæ¨¡ç³ŠæŸ¥è¯¢ç­‰ã€‚</p>
</li>
<li><p>BTREE</p>
<p>BTREEå³B+æ ‘ç´¢å¼•ï¼ŒInnoDBå­˜å‚¨å¼•æ“é»˜è®¤çš„ç´¢å¼•ï¼Œæ”¯æŒæ’åºã€åˆ†ç»„ã€èŒƒå›´æŸ¥è¯¢ã€æ¨¡ç³ŠæŸ¥è¯¢ç­‰ï¼Œå¹¶ä¸”æ€§èƒ½ç¨³å®šã€‚</p>
</li>
<li><p>RTREE</p>
<p>RTREEå³ç©ºé—´æ•°æ®ç´¢å¼•ï¼Œå¤šç”¨äºåœ°ç†æ•°æ®çš„å­˜å‚¨ï¼Œç›¸æ¯”äºå…¶ä»–ç´¢å¼•ï¼Œç©ºé—´æ•°æ®ç´¢å¼•çš„ä¼˜åŠ¿åœ¨äºèŒƒå›´æŸ¥æ‰¾</p>
</li>
</ul>
<h3 id="ç´¢å¼•çš„ç§ç±»æœ‰å“ªäº›ï¼Ÿ"><a href="#ç´¢å¼•çš„ç§ç±»æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="ç´¢å¼•çš„ç§ç±»æœ‰å“ªäº›ï¼Ÿ"></a>ç´¢å¼•çš„ç§ç±»æœ‰å“ªäº›ï¼Ÿ</h3><ul>
<li>ä¸»é”®ç´¢å¼•ï¼šæ•°æ®åˆ—ä¸å…è®¸é‡å¤ï¼Œä¸èƒ½ä¸ºNULLï¼Œä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼•</li>
<li>ç»„åˆç´¢å¼•ï¼šç”±å¤šä¸ªåˆ—å€¼ç»„æˆçš„ç´¢å¼•ã€‚</li>
<li>å”¯ä¸€ç´¢å¼•ï¼šæ•°æ®åˆ—ä¸å…è®¸é‡å¤ï¼Œå¯ä»¥ä¸ºNULLï¼Œç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€çš„ï¼Œå¦‚æœæ˜¯ç»„åˆç´¢å¼•ï¼Œåˆ™åˆ—å€¼çš„ç»„åˆå¿…é¡»å”¯ä¸€ã€‚</li>
<li>å…¨æ–‡ç´¢å¼•ï¼šå¯¹æ–‡æœ¬çš„å†…å®¹è¿›è¡Œæœç´¢ã€‚</li>
<li>æ™®é€šç´¢å¼•ï¼šåŸºæœ¬çš„ç´¢å¼•ç±»å‹ï¼Œå¯ä»¥ä¸ºNULL</li>
</ul>
<h3 id="Bæ ‘å’ŒB-æ ‘çš„åŒºåˆ«ï¼Ÿ"><a href="#Bæ ‘å’ŒB-æ ‘çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="Bæ ‘å’ŒB+æ ‘çš„åŒºåˆ«ï¼Ÿ"></a>Bæ ‘å’ŒB+æ ‘çš„åŒºåˆ«ï¼Ÿ</h3><p>Bæ ‘å’ŒB+æ ‘æœ€ä¸»è¦çš„åŒºåˆ«ä¸»è¦æœ‰ä¸¤ç‚¹ï¼š</p>
<ul>
<li><p>Bæ ‘ä¸­çš„å†…éƒ¨èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹å‡å­˜æ”¾é”®å’Œå€¼ï¼Œè€ŒB+æ ‘çš„å†…éƒ¨èŠ‚ç‚¹åªæœ‰é”®æ²¡æœ‰å€¼ï¼Œå¶å­èŠ‚ç‚¹å­˜æ”¾æ‰€æœ‰çš„é”®å’Œå€¼ã€‚</p>
</li>
<li><p>Bï¼‹æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯é€šè¿‡ç›¸è¿åœ¨ä¸€èµ·çš„ï¼Œæ–¹ä¾¿é¡ºåºæ£€ç´¢ã€‚</p>
<p>ä¸¤è€…çš„ç»“æ„å›¾å¦‚ä¸‹ã€‚</p>
</li>
</ul>
<p><img src="/p/ca035920/MySQL-B%E6%A0%91.png" alt="å›¾ç‰‡"></p>
<p><img src="/p/ca035920/MySQL-B+%E6%A0%91.png" alt="å›¾ç‰‡"></p>
<h3 id="æ•°æ®åº“ä¸ºä»€ä¹ˆä½¿ç”¨B-æ ‘è€Œä¸æ˜¯Bæ ‘ï¼Ÿ"><a href="#æ•°æ®åº“ä¸ºä»€ä¹ˆä½¿ç”¨B-æ ‘è€Œä¸æ˜¯Bæ ‘ï¼Ÿ" class="headerlink" title="æ•°æ®åº“ä¸ºä»€ä¹ˆä½¿ç”¨B+æ ‘è€Œä¸æ˜¯Bæ ‘ï¼Ÿ"></a>æ•°æ®åº“ä¸ºä»€ä¹ˆä½¿ç”¨B+æ ‘è€Œä¸æ˜¯Bæ ‘ï¼Ÿ</h3><ul>
<li>Bæ ‘é€‚ç”¨äºéšæœºæ£€ç´¢ï¼Œè€ŒB+æ ‘é€‚ç”¨äºéšæœºæ£€ç´¢å’Œé¡ºåºæ£€ç´¢</li>
<li>B+æ ‘çš„ç©ºé—´åˆ©ç”¨ç‡æ›´é«˜ï¼Œå› ä¸ºBæ ‘æ¯ä¸ªèŠ‚ç‚¹è¦å­˜å‚¨é”®å’Œå€¼ï¼Œè€ŒB+æ ‘çš„å†…éƒ¨èŠ‚ç‚¹åªå­˜å‚¨é”®ï¼Œè¿™æ ·B+æ ‘çš„ä¸€ä¸ªèŠ‚ç‚¹å°±å¯ä»¥å­˜å‚¨æ›´å¤šçš„ç´¢å¼•ï¼Œä»è€Œä½¿æ ‘çš„é«˜åº¦å˜ä½ï¼Œå‡å°‘äº†I/Oæ¬¡æ•°ï¼Œä½¿å¾—æ•°æ®æ£€ç´¢é€Ÿåº¦æ›´å¿«ã€‚</li>
<li>B+æ ‘çš„å¶å­èŠ‚ç‚¹éƒ½æ˜¯è¿æ¥åœ¨ä¸€èµ·çš„ï¼Œæ‰€ä»¥èŒƒå›´æŸ¥æ‰¾ï¼Œé¡ºåºæŸ¥æ‰¾æ›´åŠ æ–¹ä¾¿</li>
<li>B+æ ‘çš„æ€§èƒ½æ›´åŠ ç¨³å®šï¼Œå› ä¸ºåœ¨B+æ ‘ä¸­ï¼Œæ¯æ¬¡æŸ¥è¯¢éƒ½æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹ï¼Œè€Œåœ¨Bæ ‘ä¸­ï¼Œè¦æŸ¥è¯¢çš„å€¼å¯èƒ½ä¸åœ¨å¶å­èŠ‚ç‚¹ï¼Œåœ¨å†…éƒ¨èŠ‚ç‚¹å°±å·²ç»æ‰¾åˆ°ã€‚</li>
</ul>
<p>é‚£åœ¨ä»€ä¹ˆæƒ…å†µé€‚åˆä½¿ç”¨Bæ ‘å‘¢ï¼Œå› ä¸ºBæ ‘çš„å†…éƒ¨èŠ‚ç‚¹ä¹Ÿå¯ä»¥å­˜å‚¨å€¼ï¼Œæ‰€ä»¥å¯ä»¥æŠŠä¸€äº›é¢‘ç¹è®¿é—®çš„å€¼æ”¾åœ¨è·ç¦»æ ¹èŠ‚ç‚¹æ¯”è¾ƒè¿‘çš„åœ°æ–¹ï¼Œè¿™æ ·å°±å¯ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ç»¼ä¸Šæ‰€è¿°ï¼ŒB+æ ‘çš„æ€§èƒ½æ›´åŠ é€‚åˆä½œä¸ºæ•°æ®åº“çš„ç´¢å¼•ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•ï¼Œä»€ä¹ˆæ˜¯éèšç°‡ç´¢å¼•ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•ï¼Œä»€ä¹ˆæ˜¯éèšç°‡ç´¢å¼•ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•ï¼Œä»€ä¹ˆæ˜¯éèšç°‡ç´¢å¼•ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•ï¼Œä»€ä¹ˆæ˜¯éèšç°‡ç´¢å¼•ï¼Ÿ</h3><p>èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•æœ€ä¸»è¦çš„åŒºåˆ«æ˜¯<strong>æ•°æ®å’Œç´¢å¼•æ˜¯å¦åˆ†å¼€å­˜å‚¨</strong>ã€‚</p>
<ul>
<li>èšç°‡ç´¢å¼•ï¼šå°†æ•°æ®å’Œç´¢å¼•æ”¾åˆ°ä¸€èµ·å­˜å‚¨ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹ä¿ç•™äº†æ•°æ®è¡Œã€‚</li>
<li>éèšç°‡ç´¢å¼•ï¼šå°†æ•°æ®è¿›å’Œç´¢å¼•åˆ†å¼€å­˜å‚¨ï¼Œç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯æŒ‡å‘æ•°æ®è¡Œçš„åœ°å€ã€‚</li>
</ul>
<p>åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œé»˜è®¤çš„ç´¢å¼•ä¸ºB+æ ‘ç´¢å¼•ï¼Œåˆ©ç”¨ä¸»é”®åˆ›å»ºçš„ç´¢å¼•ä¸ºä¸»ç´¢å¼•ï¼Œä¹Ÿæ˜¯èšç°‡ç´¢å¼•ï¼Œåœ¨ä¸»ç´¢å¼•ä¹‹ä¸Šåˆ›å»ºçš„ç´¢å¼•ä¸ºè¾…åŠ©ç´¢å¼•ï¼Œä¹Ÿæ˜¯éèšç°‡ç´¢å¼•ã€‚ä¸ºä»€ä¹ˆè¯´è¾…åŠ©ç´¢å¼•æ˜¯åœ¨ä¸»ç´¢å¼•ä¹‹ä¸Šåˆ›å»ºçš„å‘¢ï¼Œå› ä¸ºè¾…åŠ©ç´¢å¼•ä¸­çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®ã€‚</p>
<p>åœ¨MyISAMå­˜å‚¨å¼•æ“ä¸­ï¼Œé»˜è®¤çš„ç´¢å¼•ä¹Ÿæ˜¯B+æ ‘ç´¢å¼•ï¼Œä½†ä¸»ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•éƒ½æ˜¯éèšç°‡ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯è¯´ç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„éƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘æ•°æ®è¡Œçš„åœ°å€ã€‚å¹¶ä¸”ä½¿ç”¨è¾…åŠ©ç´¢å¼•æ£€ç´¢æ— éœ€è®¿é—®ä¸»é”®çš„ç´¢å¼•ã€‚</p>
<p>å¯ä»¥ä»éå¸¸ç»å…¸çš„ä¸¤å¼ å›¾çœ‹çœ‹å®ƒä»¬çš„åŒºåˆ«(å›¾ç‰‡æ¥æºäºç½‘ç»œ)ï¼š</p>
<p><img src="/p/ca035920/MySQL-MyISAM%E7%B4%A2%E5%BC%95.png" alt="å›¾ç‰‡"></p>
<p><img src="/p/ca035920/MySQL-MyISAM%E9%9D%9E%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95.png" alt="å›¾ç‰‡"></p>
<h3 id="éèšç°‡ç´¢å¼•ä¸€å®šä¼šè¿›è¡Œå›è¡¨æŸ¥è¯¢å—ï¼Ÿ"><a href="#éèšç°‡ç´¢å¼•ä¸€å®šä¼šè¿›è¡Œå›è¡¨æŸ¥è¯¢å—ï¼Ÿ" class="headerlink" title="éèšç°‡ç´¢å¼•ä¸€å®šä¼šè¿›è¡Œå›è¡¨æŸ¥è¯¢å—ï¼Ÿ"></a>éèšç°‡ç´¢å¼•ä¸€å®šä¼šè¿›è¡Œå›è¡¨æŸ¥è¯¢å—ï¼Ÿ</h3><p>ä¸Šé¢æ˜¯è¯´äº†éèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®ï¼Œä¹Ÿå°±æ˜¯è¯´è¦å…ˆé€šè¿‡éèšç°‡ç´¢å¼•æ‰¾åˆ°ä¸»é”®ï¼Œå†é€šè¿‡èšç°‡ç´¢å¼•æ‰¾åˆ°ä¸»é”®æ‰€å¯¹åº”çš„æ•°æ®ï¼Œåé¢è¿™ä¸ªå†é€šè¿‡èšç°‡ç´¢å¼•æ‰¾åˆ°ä¸»é”®å¯¹åº”çš„æ•°æ®çš„è¿‡ç¨‹å°±æ˜¯å›è¡¨æŸ¥è¯¢ï¼Œé‚£ä¹ˆéèšç°‡ç´¢å¼•å°±ä¸€å®šä¼šè¿›è¡Œå›è¡¨æŸ¥è¯¢å—ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ä¸ä¸€å®šçš„ï¼Œè¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªç´¢å¼•è¦†ç›–çš„é—®é¢˜ï¼Œå¦‚æœæŸ¥è¯¢çš„æ•°æ®åœ¨è¾…åŠ©ç´¢å¼•ä¸Šå®Œå…¨èƒ½è·å–åˆ°ä¾¿ä¸éœ€è¦å›è¡¨æŸ¥è¯¢ã€‚ä¾‹å¦‚æœ‰ä¸€å¼ è¡¨å­˜å‚¨ç€ä¸ªäººä¿¡æ¯åŒ…æ‹¬idã€nameã€ageç­‰å­—æ®µã€‚å‡è®¾èšç°‡ç´¢å¼•æ˜¯ä»¥IDä¸ºé”®å€¼æ„å»ºçš„ç´¢å¼•ï¼Œéèšç°‡ç´¢å¼•æ˜¯ä»¥nameä¸ºé”®å€¼æ„å»ºçš„ç´¢å¼•ï¼Œ<code>select id,name from user where name = 'zhangsan';</code>è¿™ä¸ªæŸ¥è¯¢ä¾¿ä¸éœ€è¦è¿›è¡Œå›è¡¨æŸ¥è¯¢å› ä¸ºï¼Œé€šè¿‡éèšç°‡ç´¢å¼•å·²ç»èƒ½å…¨éƒ¨æ£€ç´¢å‡ºæ•°æ®ï¼Œè¿™å°±æ˜¯ç´¢å¼•è¦†ç›–çš„æƒ…å†µã€‚å¦‚æœæŸ¥è¯¢è¯­å¥æ˜¯è¿™æ ·ï¼Œ<code>select id,name,age from user where name = 'zhangsan';</code>åˆ™éœ€è¦è¿›è¡Œå›è¡¨æŸ¥è¯¢ï¼Œå› ä¸ºé€šè¿‡éèšç°‡ç´¢å¼•ä¸èƒ½æ£€ç´¢å‡ºageçš„å€¼ã€‚é‚£åº”è¯¥å¦‚ä½•è§£å†³é‚£å‘¢ï¼Ÿåªéœ€è¦å°†ç´¢å¼•è¦†ç›–å³å¯ï¼Œå»ºç«‹ageå’Œnameçš„è”åˆç´¢å¼•å†ä½¿ç”¨<code>select id,name,age from user where name = 'zhangsan';</code>è¿›è¡ŒæŸ¥è¯¢å³å¯ã€‚</p>
<p>æ‰€ä»¥é€šè¿‡ç´¢å¼•è¦†ç›–èƒ½è§£å†³éèšç°‡ç´¢å¼•å›è¡¨æŸ¥è¯¢çš„é—®é¢˜ã€‚</p>
<h3 id="ç´¢å¼•çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"><a href="#ç´¢å¼•çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="ç´¢å¼•çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"></a>ç´¢å¼•çš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</h3><ul>
<li>å¯¹äºä¸­å¤§å‹è¡¨å»ºç«‹ç´¢å¼•éå¸¸æœ‰æ•ˆï¼Œå¯¹äºéå¸¸å°çš„è¡¨ï¼Œä¸€èˆ¬å…¨éƒ¨è¡¨æ‰«æé€Ÿåº¦æ›´å¿«äº›ã€‚</li>
<li>å¯¹äºè¶…å¤§å‹çš„è¡¨ï¼Œå»ºç«‹å’Œç»´æŠ¤ç´¢å¼•çš„ä»£ä»·ä¹Ÿä¼šå˜é«˜ï¼Œè¿™æ—¶å¯ä»¥è€ƒè™‘åˆ†åŒºæŠ€æœ¯ã€‚</li>
<li>å¦‚ä½•è¡¨çš„å¢åˆ æ”¹éå¸¸å¤šï¼Œè€ŒæŸ¥è¯¢éœ€æ±‚éå¸¸å°‘çš„è¯ï¼Œé‚£å°±æ²¡æœ‰å¿…è¦å»ºç«‹ç´¢å¼•äº†ï¼Œå› ä¸ºç»´æŠ¤ç´¢å¼•ä¹Ÿæ˜¯éœ€è¦ä»£ä»·çš„ã€‚</li>
<li>ä¸€èˆ¬ä¸ä¼šå‡ºç°åœ¨whereæ¡ä»¶ä¸­çš„å­—æ®µå°±æ²¡æœ‰å¿…è¦å»ºç«‹ç´¢å¼•äº†ã€‚</li>
<li>å¤šä¸ªå­—æ®µç»å¸¸è¢«æŸ¥è¯¢çš„è¯å¯ä»¥è€ƒè™‘è”åˆç´¢å¼•ã€‚</li>
<li>å­—æ®µå¤šä¸”å­—æ®µå€¼æ²¡æœ‰é‡å¤çš„æ—¶å€™è€ƒè™‘å”¯ä¸€ç´¢å¼•ã€‚</li>
<li>å­—æ®µå¤šä¸”æœ‰é‡å¤çš„æ—¶å€™è€ƒè™‘æ™®é€šç´¢å¼•ã€‚</li>
</ul>
<h3 id="ç´¢å¼•çš„è®¾è®¡åŸåˆ™ï¼Ÿ"><a href="#ç´¢å¼•çš„è®¾è®¡åŸåˆ™ï¼Ÿ" class="headerlink" title="ç´¢å¼•çš„è®¾è®¡åŸåˆ™ï¼Ÿ"></a>ç´¢å¼•çš„è®¾è®¡åŸåˆ™ï¼Ÿ</h3><ul>
<li>æœ€é€‚åˆç´¢å¼•çš„åˆ—æ˜¯åœ¨whereåé¢å‡ºç°çš„åˆ—æˆ–è€…è¿æ¥å¥å­ä¸­æŒ‡å®šçš„åˆ—ï¼Œè€Œä¸æ˜¯å‡ºç°åœ¨SELECTå…³é”®å­—åé¢çš„é€‰æ‹©åˆ—è¡¨ä¸­çš„åˆ—ã€‚</li>
<li>ç´¢å¼•åˆ—çš„åŸºæ•°è¶Šå¤§ï¼Œç´¢å¼•çš„æ•ˆæœè¶Šå¥½ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ç´¢å¼•åˆ—çš„åŒºåˆ†åº¦è¶Šé«˜ï¼Œç´¢å¼•çš„æ•ˆæœè¶Šå¥½ã€‚æ¯”å¦‚ä½¿ç”¨æ€§åˆ«è¿™ç§åŒºåˆ†åº¦å¾ˆä½çš„åˆ—ä½œä¸ºç´¢å¼•ï¼Œæ•ˆæœå°±ä¼šå¾ˆå·®ï¼Œå› ä¸ºåˆ—çš„åŸºæ•°æœ€å¤šä¹Ÿå°±æ˜¯ä¸‰ç§ï¼Œå¤§å¤šä¸æ˜¯ç”·æ€§å°±æ˜¯å¥³æ€§ã€‚</li>
<li>å°½é‡ä½¿ç”¨çŸ­ç´¢å¼•ï¼Œå¯¹äºè¾ƒé•¿çš„å­—ç¬¦ä¸²è¿›è¡Œç´¢å¼•æ—¶åº”è¯¥æŒ‡å®šä¸€ä¸ªè¾ƒçŸ­çš„å‰ç¼€é•¿åº¦ï¼Œå› ä¸ºè¾ƒå°çš„ç´¢å¼•æ¶‰åŠåˆ°çš„ç£ç›˜I/Oè¾ƒå°‘ï¼Œå¹¶ä¸”ç´¢å¼•é«˜é€Ÿç¼“å­˜ä¸­çš„å—å¯ä»¥å®¹çº³æ›´å¤šçš„é”®å€¼ï¼Œä¼šä½¿å¾—æŸ¥è¯¢é€Ÿåº¦æ›´å¿«ã€‚</li>
<li>å°½é‡åˆ©ç”¨æœ€å·¦å‰ç¼€ã€‚</li>
<li>ä¸è¦è¿‡åº¦ç´¢å¼•ï¼Œæ¯ä¸ªç´¢å¼•éƒ½éœ€è¦é¢å¤–çš„ç‰©ç†ç©ºé—´ï¼Œç»´æŠ¤ä¹Ÿéœ€è¦èŠ±è´¹æ—¶é—´ï¼Œæ‰€ä»¥ç´¢å¼•ä¸æ˜¯è¶Šå¤šè¶Šå¥½ã€‚</li>
</ul>
<h3 id="å¦‚ä½•å¯¹ç´¢å¼•è¿›è¡Œä¼˜åŒ–ï¼Ÿ"><a href="#å¦‚ä½•å¯¹ç´¢å¼•è¿›è¡Œä¼˜åŒ–ï¼Ÿ" class="headerlink" title="å¦‚ä½•å¯¹ç´¢å¼•è¿›è¡Œä¼˜åŒ–ï¼Ÿ"></a>å¦‚ä½•å¯¹ç´¢å¼•è¿›è¡Œä¼˜åŒ–ï¼Ÿ</h3><p>å¯¹ç´¢å¼•çš„ä¼˜åŒ–å…¶å®æœ€å…³é”®çš„å°±æ˜¯è¦ç¬¦åˆç´¢å¼•çš„è®¾è®¡åŸåˆ™å’Œåº”ç”¨åœºæ™¯ï¼Œå°†ä¸ç¬¦åˆè¦æ±‚çš„ç´¢å¼•ä¼˜åŒ–æˆç¬¦åˆç´¢å¼•è®¾è®¡åŸåˆ™å’Œåº”ç”¨åœºæ™¯çš„ç´¢å¼•ã€‚</p>
<p>é™¤äº†ç´¢å¼•çš„è®¾è®¡åŸåˆ™å’Œåº”ç”¨åœºæ™¯é‚£å‡ ç‚¹å¤–ï¼Œè¿˜å¯ä»¥ä»ä»¥ä¸‹ä¸¤æ–¹é¢è€ƒè™‘ã€‚</p>
<ul>
<li>åœ¨è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œç´¢å¼•åˆ—ä¸èƒ½æ˜¯è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸èƒ½æ˜¯å‡½æ•°çš„å‚æ•°ï¼Œå› ä¸ºè¿™æ ·æ— æ³•ä½¿ç”¨ç´¢å¼•ã€‚ä¾‹å¦‚<code>select * from table_name where a + 1 = 2</code></li>
<li>å°†åŒºåˆ†åº¦æœ€é«˜çš„ç´¢å¼•æ”¾åœ¨å‰é¢</li>
<li>å°½é‡å°‘ä½¿ç”¨select*</li>
</ul>
<p>ç´¢å¼•çš„ä½¿ç”¨åœºæ™¯ã€ç´¢å¼•çš„è®¾è®¡åŸåˆ™å’Œå¦‚ä½•å¯¹ç´¢å¼•è¿›è¡Œä¼˜åŒ–å¯ä»¥çœ‹æˆä¸€ä¸ªé—®é¢˜ã€‚</p>
<h3 id="å¦‚ä½•åˆ›å»º-åˆ é™¤ç´¢å¼•ï¼Ÿ"><a href="#å¦‚ä½•åˆ›å»º-åˆ é™¤ç´¢å¼•ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ›å»º/åˆ é™¤ç´¢å¼•ï¼Ÿ"></a>å¦‚ä½•åˆ›å»º/åˆ é™¤ç´¢å¼•ï¼Ÿ</h3><p>åˆ›å»ºç´¢å¼•ï¼š</p>
<ul>
<li><p>ä½¿ç”¨CREATE INDEX è¯­å¥</p>
<p><code>CREATE INDEX index_name ON table_name (column_list);</code></p>
</li>
<li><p>åœ¨CREATE TABLEæ—¶åˆ›å»º</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span>(</span><br><span class="line">	id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">	information text,</span><br><span class="line">	FULLTEXT KEY (information)</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>ä½¿ç”¨ALTER TABLEåˆ›å»ºç´¢å¼•</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> INDEX index_name (column_list);</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<p>åˆ é™¤ç´¢å¼•ï¼š</p>
<ul>
<li><p>åˆ é™¤ä¸»é”®ç´¢å¼•</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å <span class="keyword">drop</span> <span class="keyword">primary</span> key</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>åˆ é™¤å…¶ä»–ç´¢å¼•</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å <span class="keyword">drop</span> key ç´¢å¼•å</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h3 id="ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢æ—¶æ€§èƒ½ä¸€å®šä¼šæå‡å—ï¼Ÿ"><a href="#ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢æ—¶æ€§èƒ½ä¸€å®šä¼šæå‡å—ï¼Ÿ" class="headerlink" title="ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢æ—¶æ€§èƒ½ä¸€å®šä¼šæå‡å—ï¼Ÿ"></a>ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢æ—¶æ€§èƒ½ä¸€å®šä¼šæå‡å—ï¼Ÿ</h3><p>ä¸ä¸€å®šï¼Œå‰é¢åœ¨ç´¢å¼•çš„ä½¿ç”¨åœºæ™¯å’Œç´¢å¼•çš„è®¾è®¡åŸåˆ™ä¸­å·²ç»æåˆ°äº†å¦‚ä½•åˆç†åœ°ä½¿ç”¨ç´¢å¼•ï¼Œå› ä¸ºåˆ›å»ºå’Œç»´æŠ¤ç´¢å¼•éœ€è¦èŠ±è´¹ç©ºé—´å’Œæ—¶é—´ä¸Šçš„ä»£ä»·ï¼Œå¦‚æœä¸åˆç†åœ°ä½¿ç”¨ç´¢å¼•åè€Œä¼šä½¿æŸ¥è¯¢æ€§èƒ½ä¸‹é™ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯å‰ç¼€ç´¢å¼•ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å‰ç¼€ç´¢å¼•ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å‰ç¼€ç´¢å¼•ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å‰ç¼€ç´¢å¼•ï¼Ÿ</h3><p>å‰ç¼€ç´¢å¼•æ˜¯æŒ‡å¯¹æ–‡æœ¬æˆ–è€…å­—ç¬¦ä¸²çš„å‰å‡ ä¸ªå­—ç¬¦å»ºç«‹ç´¢å¼•ï¼Œè¿™æ ·ç´¢å¼•çš„é•¿åº¦æ›´çŸ­ï¼ŒæŸ¥è¯¢é€Ÿåº¦æ›´å¿«ã€‚</p>
<p>ä½¿ç”¨åœºæ™¯ï¼šå‰ç¼€çš„åŒºåˆ†åº¦æ¯”è¾ƒé«˜çš„æƒ…å†µä¸‹ã€‚</p>
<p>å»ºç«‹å‰ç¼€ç´¢å¼•çš„æ–¹å¼</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">ALTER TABLE table_name ADD KEY(column_name(prefix_length));</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™é‡Œé¢æœ‰ä¸ªprefix_lengthå‚æ•°å¾ˆéš¾ç¡®å®šï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯å‰ç¼€é•¿åº¦çš„æ„æ€ã€‚é€šå¸¸å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è¿›è¡Œç¡®å®šï¼Œå…ˆè®¡ç®—å…¨åˆ—çš„åŒºåˆ†åº¦</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">SELECT COUNT(DISTINCT column_name) / COUNT(*) FROM table_name;</span><br></pre></td></tr></tbody></table></figure>

<p>ç„¶ååœ¨è®¡ç®—å‰ç¼€é•¿åº¦ä¸ºå¤šå°‘æ—¶å’Œå…¨åˆ—çš„åŒºåˆ†åº¦æœ€ç›¸ä¼¼ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">SELECT COUNT(DISTINCT LEFT(column_name, prefix_length)) / COUNT(*) FROM table_name;</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸æ–­åœ°è°ƒæ•´prefix_lengthçš„å€¼ï¼Œç›´åˆ°å’Œå…¨åˆ—è®¡ç®—å‡ºåŒºåˆ†åº¦ç›¸è¿‘ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯æœ€å·¦åŒ¹é…åŸåˆ™ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æœ€å·¦åŒ¹é…åŸåˆ™ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æœ€å·¦åŒ¹é…åŸåˆ™ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æœ€å·¦åŒ¹é…åŸåˆ™ï¼Ÿ</h3><p>æœ€å·¦åŒ¹é…åŸåˆ™ï¼šä»æœ€å·¦è¾¹ä¸ºèµ·ç‚¹å¼€å§‹è¿ç»­åŒ¹é…ï¼Œé‡åˆ°èŒƒå›´æŸ¥è¯¢ï¼ˆ&lt;ã€&gt;ã€betweenã€likeï¼‰ä¼šåœæ­¢åŒ¹é…ã€‚</p>
<p>ä¾‹å¦‚å»ºç«‹ç´¢å¼•(a,b,c)ï¼Œå¤§å®¶å¯ä»¥çŒœæµ‹ä»¥ä¸‹å‡ ç§æƒ…å†µæ˜¯å¦ç”¨åˆ°äº†ç´¢å¼•ã€‚</p>
<ul>
<li><p>ç¬¬ä¸€ç§</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table_name <span class="keyword">where</span> a <span class="operator">=</span> <span class="number">1</span> <span class="keyword">and</span> b <span class="operator">=</span> <span class="number">2</span> <span class="keyword">and</span> c <span class="operator">=</span> <span class="number">3</span> </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table_name <span class="keyword">where</span> b <span class="operator">=</span> <span class="number">2</span> <span class="keyword">and</span> a <span class="operator">=</span> <span class="number">1</span> <span class="keyword">and</span> c <span class="operator">=</span> <span class="number">3</span></span><br></pre></td></tr></tbody></table></figure>

<p>ä¸Šé¢ä¸¤æ¬¡æŸ¥è¯¢è¿‡ç¨‹ä¸­æ‰€æœ‰å€¼éƒ½ç”¨åˆ°äº†ç´¢å¼•ï¼Œwhereåé¢å­—æ®µè°ƒæ¢ä¸ä¼šå½±å“æŸ¥è¯¢ç»“æœï¼Œå› ä¸ºMySQLä¸­çš„ä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨ä¼˜åŒ–æŸ¥è¯¢é¡ºåºã€‚</p>
</li>
<li><p>ç¬¬äºŒç§</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table_name <span class="keyword">where</span> a <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table_name <span class="keyword">where</span> a <span class="operator">=</span> <span class="number">1</span> <span class="keyword">and</span> b <span class="operator">=</span> <span class="number">2</span>  </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table_name <span class="keyword">where</span> a <span class="operator">=</span> <span class="number">1</span> <span class="keyword">and</span> b <span class="operator">=</span> <span class="number">2</span> <span class="keyword">and</span> c <span class="operator">=</span> <span class="number">3</span></span><br></pre></td></tr></tbody></table></figure>

<p>ç­”æ¡ˆæ˜¯ä¸‰ä¸ªæŸ¥è¯¢è¯­å¥éƒ½ç”¨åˆ°äº†ç´¢å¼•ï¼Œå› ä¸ºä¸‰ä¸ªè¯­å¥éƒ½æ˜¯ä»æœ€å·¦å¼€å§‹åŒ¹é…çš„ã€‚</p>
</li>
<li><p>ç¬¬ä¸‰ç§</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table_name <span class="keyword">where</span>  b <span class="operator">=</span> <span class="number">1</span> </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table_name <span class="keyword">where</span>  b <span class="operator">=</span> <span class="number">1</span> <span class="keyword">and</span> c <span class="operator">=</span> <span class="number">2</span> </span><br></pre></td></tr></tbody></table></figure>

<p>ç­”æ¡ˆæ˜¯è¿™ä¸¤ä¸ªæŸ¥è¯¢è¯­å¥éƒ½æ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼Œå› ä¸ºä¸æ˜¯ä»æœ€å·¦è¾¹å¼€å§‹åŒ¹é…çš„</p>
</li>
<li><p>ç¬¬å››ç§</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table_name <span class="keyword">where</span> a <span class="operator">=</span> <span class="number">1</span> <span class="keyword">and</span> c <span class="operator">=</span> <span class="number">2</span> </span><br></pre></td></tr></tbody></table></figure>

<p>è¿™ä¸ªæŸ¥è¯¢è¯­å¥åªæœ‰aåˆ—ç”¨åˆ°äº†ç´¢å¼•ï¼Œcåˆ—æ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼Œå› ä¸ºä¸­é—´è·³è¿‡äº†båˆ—ï¼Œä¸æ˜¯ä»æœ€å·¦å¼€å§‹è¿ç»­åŒ¹é…çš„ã€‚</p>
</li>
<li><p>ç¬¬äº”ç§</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table_name <span class="keyword">where</span>  a <span class="operator">=</span> <span class="number">1</span> <span class="keyword">and</span> b <span class="operator">&lt;</span> <span class="number">3</span> <span class="keyword">and</span> c <span class="operator">&lt;</span> <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p>è¿™ä¸ªæŸ¥è¯¢ä¸­åªæœ‰aåˆ—å’Œbåˆ—ä½¿ç”¨åˆ°äº†ç´¢å¼•ï¼Œè€Œcåˆ—æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œå› ä¸ºæ ¹æ®æœ€å·¦åŒ¹é…æŸ¥è¯¢åŸåˆ™ï¼Œé‡åˆ°èŒƒå›´æŸ¥è¯¢ä¼šåœæ­¢ã€‚</p>
</li>
<li><p>ç¬¬å…­ç§</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table_name <span class="keyword">where</span> a <span class="keyword">like</span> <span class="string">'ab%'</span>; </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table_name <span class="keyword">where</span>  a <span class="keyword">like</span> <span class="string">'%ab'</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table_name <span class="keyword">where</span>  a <span class="keyword">like</span> <span class="string">'%ab%'</span></span><br></pre></td></tr></tbody></table></figure>

<p>å¯¹äºåˆ—ä¸ºå­—ç¬¦ä¸²çš„æƒ…å†µï¼Œåªæœ‰å‰ç¼€åŒ¹é…å¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Œä¸­ç¼€åŒ¹é…å’Œåç¼€åŒ¹é…åªèƒ½è¿›è¡Œå…¨è¡¨æ‰«æã€‚</p>
</li>
</ul>
<h3 id="ç´¢å¼•åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¤±æ•ˆï¼Ÿ"><a href="#ç´¢å¼•åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¤±æ•ˆï¼Ÿ" class="headerlink" title="ç´¢å¼•åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¤±æ•ˆï¼Ÿ"></a>ç´¢å¼•åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¤±æ•ˆï¼Ÿ</h3><p>åœ¨ä¸Šé¢ä»‹ç»äº†å‡ ç§ä¸ç¬¦åˆæœ€å·¦åŒ¹é…åŸåˆ™çš„æƒ…å†µä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä»¥ä¸‹è¿™å‡ ç§æƒ…å†µä¹Ÿä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</p>
<ul>
<li>æ¡ä»¶ä¸­æœ‰orï¼Œä¾‹å¦‚<code>select * from table_name where a = 1 or b = 3</code></li>
<li>åœ¨ç´¢å¼•ä¸Šè¿›è¡Œè®¡ç®—ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œä¾‹å¦‚<code>select * from table_name where a + 1 = 2</code></li>
<li>åœ¨ç´¢å¼•çš„ç±»å‹ä¸Šè¿›è¡Œæ•°æ®ç±»å‹çš„éšå½¢è½¬æ¢ï¼Œä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œä¾‹å¦‚å­—ç¬¦ä¸²ä¸€å®šè¦åŠ å¼•å·ï¼Œå‡è®¾ <code>select * from table_name where a = '1'</code>ä¼šä½¿ç”¨åˆ°ç´¢å¼•ï¼Œå¦‚æœå†™æˆ<code>select * from table_name where a = 1</code>åˆ™ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</li>
<li>åœ¨ç´¢å¼•ä¸­ä½¿ç”¨å‡½æ•°ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œä¾‹å¦‚<code>select * from table_name where abs(a) = 1</code></li>
<li>åœ¨ä½¿ç”¨likeæŸ¥è¯¢æ—¶ä»¥%å¼€å¤´ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</li>
<li>ç´¢å¼•ä¸Šä½¿ç”¨ï¼ã€=ã€&lt;&gt;è¿›è¡Œåˆ¤æ–­æ—¶ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œä¾‹å¦‚<code>select * from table_name where a != 1</code></li>
<li>ç´¢å¼•å­—æ®µä¸Šä½¿ç”¨ is null/is not nullåˆ¤æ–­æ—¶ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œä¾‹å¦‚<code>select * from table_name where a is null</code></li>
</ul>
<h2 id="æ•°æ®åº“çš„äº‹åŠ¡"><a href="#æ•°æ®åº“çš„äº‹åŠ¡" class="headerlink" title="æ•°æ®åº“çš„äº‹åŠ¡"></a>æ•°æ®åº“çš„äº‹åŠ¡</h2><h3 id="ä»€ä¹ˆæ˜¯æ•°æ®åº“çš„äº‹åŠ¡ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ•°æ®åº“çš„äº‹åŠ¡ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ•°æ®åº“çš„äº‹åŠ¡ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ•°æ®åº“çš„äº‹åŠ¡ï¼Ÿ</h3><p>ç™¾åº¦ç™¾ç§‘çš„è§£é‡Šï¼šæ•°æ®åº“äº‹åŠ¡( transaction)æ˜¯è®¿é—®å¹¶å¯èƒ½æ“ä½œå„ç§æ•°æ®é¡¹çš„ä¸€ä¸ªæ•°æ®åº“æ“ä½œåºåˆ—ï¼Œè¿™äº›æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œ,è¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œï¼Œæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ã€‚äº‹åŠ¡ç”±äº‹åŠ¡å¼€å§‹ä¸äº‹åŠ¡ç»“æŸä¹‹é—´æ‰§è¡Œçš„å…¨éƒ¨æ•°æ®åº“æ“ä½œç»„æˆã€‚</p>
<h3 id="äº‹åŠ¡çš„å››å¤§ç‰¹æ€§æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#äº‹åŠ¡çš„å››å¤§ç‰¹æ€§æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="äº‹åŠ¡çš„å››å¤§ç‰¹æ€§æ˜¯ä»€ä¹ˆï¼Ÿ"></a>äº‹åŠ¡çš„å››å¤§ç‰¹æ€§æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul>
<li>åŸå­æ€§ï¼šåŸå­æ€§æ˜¯æŒ‡åŒ…å«äº‹åŠ¡çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šã€‚</li>
<li>ä¸€è‡´æ€§ï¼šä¸€è‡´æ€§æŒ‡äº‹åŠ¡åœ¨æ‰§è¡Œå‰åçŠ¶æ€æ˜¯ä¸€è‡´çš„ã€‚</li>
<li>éš”ç¦»æ€§ï¼šä¸€ä¸ªäº‹åŠ¡æ‰€è¿›è¡Œçš„ä¿®æ”¹åœ¨æœ€ç»ˆæäº¤ä¹‹å‰ï¼Œå¯¹å…¶ä»–äº‹åŠ¡æ˜¯ä¸å¯è§çš„ã€‚</li>
<li>æŒä¹…æ€§ï¼šæ•°æ®ä¸€æ—¦æäº¤ï¼Œå…¶æ‰€ä½œçš„ä¿®æ”¹å°†æ°¸ä¹…åœ°ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</li>
</ul>
<h3 id="æ•°æ®åº“çš„å¹¶å‘ä¸€è‡´æ€§é—®é¢˜"><a href="#æ•°æ®åº“çš„å¹¶å‘ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="æ•°æ®åº“çš„å¹¶å‘ä¸€è‡´æ€§é—®é¢˜"></a>æ•°æ®åº“çš„å¹¶å‘ä¸€è‡´æ€§é—®é¢˜</h3><p>å½“å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>è„è¯»ï¼šäº‹åŠ¡Aæ›´æ–°äº†æ•°æ®ï¼Œä½†è¿˜æ²¡æœ‰æäº¤ï¼Œè¿™æ—¶äº‹åŠ¡Bè¯»å–åˆ°äº‹åŠ¡Aæ›´æ–°åçš„æ•°æ®ï¼Œç„¶åäº‹åŠ¡Aå›æ»šäº†ï¼Œäº‹åŠ¡Bè¯»å–åˆ°çš„æ•°æ®å°±æˆä¸ºè„æ•°æ®äº†ã€‚</li>
<li>ä¸å¯é‡å¤è¯»ï¼šäº‹åŠ¡Aå¯¹æ•°æ®è¿›è¡Œå¤šæ¬¡è¯»å–ï¼Œäº‹åŠ¡Båœ¨äº‹åŠ¡Aå¤šæ¬¡è¯»å–çš„è¿‡ç¨‹ä¸­æ‰§è¡Œäº†æ›´æ–°æ“ä½œå¹¶æäº¤äº†ï¼Œå¯¼è‡´äº‹åŠ¡Aå¤šæ¬¡è¯»å–åˆ°çš„æ•°æ®å¹¶ä¸ä¸€è‡´ã€‚</li>
<li>å¹»è¯»ï¼šäº‹åŠ¡Aåœ¨è¯»å–æ•°æ®åï¼Œäº‹åŠ¡Bå‘äº‹åŠ¡Aè¯»å–çš„æ•°æ®ä¸­æ’å…¥äº†å‡ æ¡æ•°æ®ï¼Œäº‹åŠ¡Aå†æ¬¡è¯»å–æ•°æ®æ—¶å‘ç°å¤šäº†å‡ æ¡æ•°æ®ï¼Œå’Œä¹‹å‰è¯»å–çš„æ•°æ®ä¸ä¸€è‡´ã€‚</li>
<li>ä¸¢å¤±ä¿®æ”¹ï¼šäº‹åŠ¡Aå’Œäº‹åŠ¡Béƒ½å¯¹åŒä¸€ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œäº‹åŠ¡Aå…ˆä¿®æ”¹ï¼Œäº‹åŠ¡Béšåä¿®æ”¹ï¼Œäº‹åŠ¡Bçš„ä¿®æ”¹è¦†ç›–äº†äº‹åŠ¡Açš„ä¿®æ”¹ã€‚</li>
</ul>
<p>ä¸å¯é‡å¤åº¦å’Œå¹»è¯»çœ‹èµ·æ¥æ¯”è¾ƒåƒï¼Œå®ƒä»¬ä¸»è¦çš„åŒºåˆ«æ˜¯ï¼šåœ¨ä¸å¯é‡å¤è¯»ä¸­ï¼Œå‘ç°æ•°æ®ä¸ä¸€è‡´ä¸»è¦æ˜¯æ•°æ®è¢«æ›´æ–°äº†ã€‚åœ¨å¹»è¯»ä¸­ï¼Œå‘ç°æ•°æ®ä¸ä¸€è‡´ä¸»è¦æ˜¯æ•°æ®å¢å¤šæˆ–è€…å‡å°‘äº†ã€‚</p>
<h3 id="æ•°æ®åº“çš„éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Ÿ"><a href="#æ•°æ®åº“çš„éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="æ•°æ®åº“çš„éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Ÿ"></a>æ•°æ®åº“çš„éš”ç¦»çº§åˆ«æœ‰å“ªäº›ï¼Ÿ</h3><ul>
<li>æœªæäº¤è¯»ï¼šä¸€ä¸ªäº‹åŠ¡åœ¨æäº¤å‰ï¼Œå®ƒçš„ä¿®æ”¹å¯¹å…¶ä»–äº‹åŠ¡ä¹Ÿæ˜¯å¯è§çš„ã€‚</li>
<li>æäº¤è¯»ï¼šä¸€ä¸ªäº‹åŠ¡æäº¤ä¹‹åï¼Œå®ƒçš„ä¿®æ”¹æ‰èƒ½è¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°ã€‚</li>
<li>å¯é‡å¤è¯»ï¼šåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚</li>
<li>ä¸²è¡ŒåŒ–ï¼šéœ€è¦åŠ é”å®ç°ï¼Œä¼šå¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œã€‚</li>
</ul>
<p>æ•°æ®åº“çš„éš”ç¦»çº§åˆ«åˆ†åˆ«å¯ä»¥è§£å†³æ•°æ®åº“çš„è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ç­‰é—®é¢˜ã€‚</p>
<table>
<thead>
<tr>
<th align="center">éš”ç¦»çº§åˆ«</th>
<th align="center">è„è¯»</th>
<th align="center">ä¸å¯é‡å¤è¯»</th>
<th align="center">å¹»è¯»</th>
</tr>
</thead>
<tbody><tr>
<td align="center">æœªæäº¤è¯»</td>
<td align="center">å…è®¸</td>
<td align="center">å…è®¸</td>
<td align="center">å…è®¸</td>
</tr>
<tr>
<td align="center">æäº¤è¯»</td>
<td align="center">ä¸å…è®¸</td>
<td align="center">å…è®¸</td>
<td align="center">å…è®¸</td>
</tr>
<tr>
<td align="center">å¯é‡å¤è¯»</td>
<td align="center">ä¸å…è®¸</td>
<td align="center">ä¸å…è®¸</td>
<td align="center">å…è®¸</td>
</tr>
<tr>
<td align="center">ä¸²è¡ŒåŒ–</td>
<td align="center">ä¸å…è®¸</td>
<td align="center">ä¸å…è®¸</td>
<td align="center">ä¸å…è®¸</td>
</tr>
</tbody></table>
<p><strong>MySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ã€‚</strong></p>
<h3 id="éš”ç¦»çº§åˆ«æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"><a href="#éš”ç¦»çº§åˆ«æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ" class="headerlink" title="éš”ç¦»çº§åˆ«æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"></a>éš”ç¦»çº§åˆ«æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</h3><p>äº‹åŠ¡çš„éš”ç¦»æœºåˆ¶ä¸»è¦æ˜¯ä¾é é”æœºåˆ¶å’ŒMVCC(å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)å®ç°çš„ï¼Œæäº¤è¯»å’Œå¯é‡å¤è¯»å¯ä»¥é€šè¿‡MVCCå®ç°ï¼Œä¸²è¡ŒåŒ–å¯ä»¥é€šè¿‡é”æœºåˆ¶å®ç°ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯MVCCï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯MVCCï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯MVCCï¼Ÿ"></a>ä»€ä¹ˆæ˜¯MVCCï¼Ÿ</h3><p>MVCC(multiple version concurrent control)æ˜¯ä¸€ç§æ§åˆ¶å¹¶å‘çš„æ–¹æ³•ï¼Œä¸»è¦ç”¨æ¥æé«˜æ•°æ®åº“çš„å¹¶å‘æ€§èƒ½ã€‚</p>
<p>åœ¨äº†è§£MVCCæ—¶åº”è¯¥å…ˆäº†è§£å½“å‰è¯»å’Œå¿«ç…§è¯»ã€‚</p>
<ul>
<li>å½“å‰è¯»ï¼šè¯»å–çš„æ˜¯æ•°æ®åº“çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶ä¸”åœ¨è¯»å–æ—¶è¦ä¿è¯å…¶ä»–äº‹åŠ¡ä¸ä¼šä¿®æ”¹å½“å‰è®°å½•ï¼Œæ‰€ä»¥ä¼šå¯¹è¯»å–çš„è®°å½•åŠ é”ã€‚</li>
<li>å¿«ç…§è¯»ï¼šä¸åŠ é”è¯»å–æ“ä½œå³ä¸ºå¿«ç…§è¯»ï¼Œä½¿ç”¨MVCCæ¥è¯»å–å¿«ç…§ä¸­çš„æ•°æ®ï¼Œé¿å…åŠ é”å¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°MVCCçš„ä½œç”¨å°±æ˜¯åœ¨ä¸åŠ é”çš„æƒ…å†µä¸‹ï¼Œè§£å†³æ•°æ®åº“è¯»å†™å†²çªé—®é¢˜ï¼Œå¹¶ä¸”è§£å†³è„è¯»ã€å¹»è¯»ã€ä¸å¯é‡å¤è¯»ç­‰é—®é¢˜ï¼Œä½†æ˜¯ä¸èƒ½è§£å†³ä¸¢å¤±ä¿®æ”¹é—®é¢˜ã€‚</p>
<p>MVCCçš„å®ç°åŸç†ï¼š</p>
<ul>
<li><p>ç‰ˆæœ¬å·</p>
<p>ç³»ç»Ÿç‰ˆæœ¬å·ï¼šæ˜¯ä¸€ä¸ªè‡ªå¢çš„IDï¼Œæ¯å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œç³»ç»Ÿç‰ˆæœ¬å·éƒ½ä¼šé€’å¢ã€‚</p>
<p>äº‹åŠ¡ç‰ˆæœ¬å·ï¼šäº‹åŠ¡ç‰ˆæœ¬å·å°±æ˜¯äº‹åŠ¡å¼€å§‹æ—¶çš„ç³»ç»Ÿç‰ˆæœ¬å·ï¼Œå¯ä»¥é€šè¿‡äº‹åŠ¡ç‰ˆæœ¬å·çš„å¤§å°åˆ¤æ–­äº‹åŠ¡çš„æ—¶é—´é¡ºåºã€‚</p>
</li>
<li><p>è¡Œè®°å½•éšè—çš„åˆ—</p>
<p>DB_ROW_IDï¼šæ‰€éœ€ç©ºé—´6byteï¼Œéšå«çš„è‡ªå¢IDï¼Œç”¨æ¥ç”Ÿæˆèšç°‡ç´¢å¼•ï¼Œå¦‚æœæ•°æ®è¡¨æ²¡æœ‰æŒ‡å®šèšç°‡ç´¢å¼•ï¼ŒInnoDBä¼šåˆ©ç”¨è¿™ä¸ªéšè—IDåˆ›å»ºèšç°‡ç´¢å¼•ã€‚</p>
<p>DB_TRX_IDï¼šæ‰€éœ€ç©ºé—´6byteï¼Œæœ€è¿‘ä¿®æ”¹çš„äº‹åŠ¡IDï¼Œè®°å½•åˆ›å»ºè¿™æ¡è®°å½•æˆ–æœ€åä¸€æ¬¡ä¿®æ”¹è¿™æ¡è®°å½•çš„äº‹åŠ¡IDã€‚</p>
<p>DB_ROLL_PTRï¼šæ‰€éœ€ç©ºé—´7byteï¼Œå›æ»šæŒ‡é’ˆï¼ŒæŒ‡å‘è¿™æ¡è®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬ã€‚</p>
<p>å®ƒä»¬å¤§è‡´é•¿è¿™æ ·ï¼Œçœç•¥äº†å…·ä½“å­—æ®µçš„å€¼ã€‚</p>
</li>
</ul>
<p><img src="/p/ca035920/MySQL-MVCC(1).png" alt="å›¾ç‰‡"></p>
<ul>
<li>undoæ—¥å¿—</li>
</ul>
<p>MVCCåšä½¿ç”¨åˆ°çš„å¿«ç…§ä¼šå­˜å‚¨åœ¨Undoæ—¥å¿—ä¸­ï¼Œè¯¥æ—¥å¿—é€šè¿‡å›æ»šæŒ‡é’ˆå°†ä¸€ä¸ªä¸€ä¸ªæ•°æ®è¡Œçš„æ‰€æœ‰å¿«ç…§è¿æ¥èµ·æ¥ã€‚å®ƒä»¬å¤§è‡´é•¿è¿™æ ·ã€‚</p>
<p><img src="/p/ca035920/MySQL-MVCC(2).png" alt="å›¾ç‰‡"></p>
<p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­è¯´æ˜ä¸‹ï¼Œæ¯”å¦‚æœ€å¼€å§‹çš„æŸæ¡è®°å½•é•¿è¿™æ ·</p>
<p><img src="/p/ca035920/MySQL-MVCC(3).png" alt="å›¾ç‰‡"></p>
<p>ç°åœ¨æ¥äº†ä¸€ä¸ªäº‹åŠ¡å¯¹ä»–çš„å¹´é¾„å­—æ®µè¿›è¡Œäº†ä¿®æ”¹ï¼Œå˜æˆäº†è¿™æ ·</p>
<p><img src="/p/ca035920/MySQL-MVCC(4).png" alt="å›¾ç‰‡"></p>
<p>ç°åœ¨åˆæ¥äº†ä¸€ä¸ªäº‹åŠ¡2å¯¹å®ƒçš„æ€§åˆ«è¿›è¡Œäº†ä¿®æ”¹ï¼Œå®ƒåˆå˜æˆäº†è¿™æ ·</p>
<p><img src="/p/ca035920/MySQL-MVCC(5).png" alt="å›¾ç‰‡"></p>
<p>ä»ä¸Šé¢çš„åˆ†æå¯ä»¥çœ‹å‡ºï¼Œäº‹åŠ¡å¯¹åŒä¸€è®°å½•çš„ä¿®æ”¹ï¼Œè®°å½•çš„å„ä¸ªä¼šåœ¨Undoæ—¥å¿—ä¸­è¿æ¥æˆä¸€ä¸ªçº¿æ€§è¡¨ï¼Œåœ¨è¡¨å¤´çš„å°±æ˜¯æœ€æ–°çš„æ—§çºªå½•ã€‚</p>
<p>åœ¨é‡å¤è¯»çš„éš”ç¦»çº§åˆ«ä¸‹ï¼ŒInnoDBçš„å·¥ä½œæµç¨‹ï¼š</p>
<ul>
<li><p>SELECT</p>
<p>ä½œä¸ºæŸ¥è¯¢çš„ç»“æœè¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p>
</li>
<li><ol>
<li>å½“å‰äº‹åŠ¡æ‰€è¦æŸ¥è¯¢çš„æ•°æ®è¡Œå¿«ç…§çš„åˆ›å»ºç‰ˆæœ¬å·å¿…é¡»å°äºå½“å‰äº‹åŠ¡çš„ç‰ˆæœ¬å·ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¿è¯å½“å‰äº‹åŠ¡è¯»å–çš„æ•°æ®è¡Œçš„å¿«ç…§è¦ä¹ˆæ˜¯åœ¨å½“å‰äº‹åŠ¡å¼€å§‹å‰å°±å·²ç»å­˜åœ¨çš„ï¼Œè¦ä¹ˆå°±æ˜¯å½“å‰äº‹åŠ¡è‡ªèº«æ’å…¥æˆ–è€…ä¿®æ”¹è¿‡çš„ã€‚</li>
<li>å½“å‰äº‹åŠ¡æ‰€è¦è¯»å–çš„æ•°æ®è¡Œå¿«ç…§çš„åˆ é™¤ç‰ˆæœ¬å·å¿…é¡»æ˜¯å¤§äºå½“å‰äº‹åŠ¡çš„ç‰ˆæœ¬å·ï¼Œå¦‚æœæ˜¯å°äºç­‰äºçš„è¯ï¼Œè¡¨ç¤ºè¯¥æ•°æ®è¡Œå¿«ç…§å·²ç»è¢«åˆ é™¤ï¼Œä¸èƒ½è¯»å–ã€‚</li>
</ol>
</li>
<li><p>INSERT</p>
<p>å°†å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸ºæ•°æ®è¡Œå¿«ç…§çš„åˆ›å»ºç‰ˆæœ¬å·ã€‚</p>
</li>
<li><p>DELETE</p>
<p>å°†å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸ºæ•°æ®è¡Œå¿«ç…§çš„åˆ é™¤ç‰ˆæœ¬å·ã€‚</p>
</li>
<li><p>UPDATE</p>
<p>ä¿å­˜å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä¸ºæ›´æ–°å‰çš„æ•°æ®è¡Œå¿«ç…§åˆ›å»ºè¡Œç‰ˆæœ¬å·ï¼Œå¹¶ä¿å­˜å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä¸ºæ›´æ–°åçš„æ•°æ®è¡Œå¿«ç…§çš„åˆ é™¤ç‰ˆæœ¬å·ï¼Œå…¶å®å°±æ˜¯ï¼Œå…ˆåˆ é™¤åœ¨æ’å…¥å³ä¸ºæ›´æ–°ã€‚</p>
</li>
</ul>
<p>æ€»ç»“ä¸€ä¸‹ï¼ŒMVCCçš„ä½œç”¨å°±æ˜¯åœ¨é¿å…åŠ é”çš„æƒ…å†µä¸‹æœ€å¤§é™åº¦è§£å†³è¯»å†™å¹¶å‘å†²çªçš„é—®é¢˜ï¼Œå®ƒå¯ä»¥å®ç°æäº¤è¯»å’Œå¯é‡å¤åº¦ä¸¤ä¸ªéš”ç¦»çº§ã€‚</p>
<h2 id="æ•°æ®åº“çš„é”"><a href="#æ•°æ®åº“çš„é”" class="headerlink" title="æ•°æ®åº“çš„é”"></a>æ•°æ®åº“çš„é”</h2><h3 id="ä»€ä¹ˆæ˜¯æ•°æ®åº“çš„é”ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ•°æ®åº“çš„é”ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ•°æ®åº“çš„é”ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ•°æ®åº“çš„é”ï¼Ÿ</h3><p>å½“æ•°æ®åº“æœ‰å¹¶å‘äº‹åŠ¡çš„æ—¶å€™ï¼Œä¿è¯æ•°æ®è®¿é—®é¡ºåºçš„æœºåˆ¶ç§°ä¸ºé”æœºåˆ¶ã€‚</p>
<h3 id="æ•°æ®åº“çš„é”ä¸éš”ç¦»çº§åˆ«çš„å…³ç³»ï¼Ÿ"><a href="#æ•°æ®åº“çš„é”ä¸éš”ç¦»çº§åˆ«çš„å…³ç³»ï¼Ÿ" class="headerlink" title="æ•°æ®åº“çš„é”ä¸éš”ç¦»çº§åˆ«çš„å…³ç³»ï¼Ÿ"></a>æ•°æ®åº“çš„é”ä¸éš”ç¦»çº§åˆ«çš„å…³ç³»ï¼Ÿ</h3><table>
<thead>
<tr>
<th align="center">éš”ç¦»çº§åˆ«</th>
<th align="center">å®ç°æ–¹å¼</th>
</tr>
</thead>
<tbody><tr>
<td align="center">æœªæäº¤è¯»</td>
<td align="center">æ€»æ˜¯è¯»å–æœ€æ–°çš„æ•°æ®ï¼Œæ— éœ€åŠ é”</td>
</tr>
<tr>
<td align="center">æäº¤è¯»</td>
<td align="center">è¯»å–æ•°æ®æ—¶åŠ å…±äº«é”ï¼Œè¯»å–æ•°æ®åé‡Šæ”¾å…±äº«é”</td>
</tr>
<tr>
<td align="center">å¯é‡å¤è¯»</td>
<td align="center">è¯»å–æ•°æ®æ—¶åŠ å…±äº«é”ï¼Œäº‹åŠ¡ç»“æŸåé‡Šæ”¾å…±äº«é”</td>
</tr>
<tr>
<td align="center">ä¸²è¡ŒåŒ–</td>
<td align="center">é”å®šæ•´ä¸ªèŒƒå›´çš„é”®ï¼Œä¸€ç›´æŒæœ‰é”ç›´åˆ°äº‹åŠ¡ç»“æŸ</td>
</tr>
</tbody></table>
<h3 id="æ•°æ®åº“é”çš„ç±»å‹æœ‰å“ªäº›ï¼Ÿ"><a href="#æ•°æ®åº“é”çš„ç±»å‹æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="æ•°æ®åº“é”çš„ç±»å‹æœ‰å“ªäº›ï¼Ÿ"></a>æ•°æ®åº“é”çš„ç±»å‹æœ‰å“ªäº›ï¼Ÿ</h3><p>æŒ‰ç…§é”çš„ç²’åº¦å¯ä»¥å°†MySQLé”åˆ†ä¸ºä¸‰ç§ï¼š</p>
<table>
<thead>
<tr>
<th align="center">MySQLé”ç±»åˆ«</th>
<th align="center">èµ„æºå¼€é”€</th>
<th align="center">åŠ é”é€Ÿåº¦</th>
<th align="center">æ˜¯å¦ä¼šå‡ºç°æ­»é”</th>
<th align="center">é”çš„ç²’åº¦</th>
<th align="center">å¹¶å‘åº¦</th>
</tr>
</thead>
<tbody><tr>
<td align="center">è¡¨çº§é”</td>
<td align="center">å°</td>
<td align="center">å¿«</td>
<td align="center">ä¸ä¼š</td>
<td align="center">å¤§</td>
<td align="center">ä½</td>
</tr>
<tr>
<td align="center">è¡Œçº§é”</td>
<td align="center">å¤§</td>
<td align="center">æ…¢</td>
<td align="center">ä¼š</td>
<td align="center">å°</td>
<td align="center">é«˜</td>
</tr>
<tr>
<td align="center">é¡µé¢é”</td>
<td align="center">ä¸€èˆ¬</td>
<td align="center">ä¸€èˆ¬</td>
<td align="center">ä¸ä¼š</td>
<td align="center">ä¸€èˆ¬</td>
<td align="center">ä¸€èˆ¬</td>
</tr>
</tbody></table>
<p>MyISAMé»˜è®¤é‡‡ç”¨è¡¨çº§é”ï¼ŒInnoDBé»˜è®¤é‡‡ç”¨è¡Œçº§é”ã€‚</p>
<p>ä»é”çš„ç±»åˆ«ä¸ŠåŒºåˆ«å¯ä»¥åˆ†ä¸ºå…±äº«é”å’Œæ’ä»–é”</p>
<ul>
<li>å…±äº«é”ï¼šå…±äº«é”åˆç§°è¯»é”ï¼Œç®€å†™ä¸ºSé”ï¼Œä¸€ä¸ªäº‹åŠ¡å¯¹ä¸€ä¸ªæ•°æ®å¯¹è±¡åŠ äº†Sé”ï¼Œå¯ä»¥å¯¹è¿™ä¸ªæ•°æ®å¯¹è±¡è¿›è¡Œè¯»å–æ“ä½œï¼Œä½†ä¸èƒ½è¿›è¡Œæ›´æ–°æ“ä½œã€‚å¹¶ä¸”åœ¨åŠ é”æœŸé—´å…¶ä»–äº‹åŠ¡åªèƒ½å¯¹è¿™ä¸ªæ•°æ®å¯¹è±¡åŠ Sé”ï¼Œä¸èƒ½åŠ Xé”ã€‚</li>
<li>æ’ä»–é”ï¼šæ’ä»–é”åˆç§°ä¸ºå†™é”ï¼Œç®€å†™ä¸ºXé”ï¼Œä¸€ä¸ªäº‹åŠ¡å¯¹ä¸€ä¸ªæ•°æ®å¯¹è±¡åŠ äº†Xé”ï¼Œå¯ä»¥å¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œè¯»å–å’Œæ›´æ–°æ“ä½œï¼ŒåŠ é”æœŸé—´ï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½å¯¹è¯¥æ•°æ®å¯¹è±¡è¿›è¡ŒåŠ Xé”æˆ–Sé”ã€‚</li>
</ul>
<p>å®ƒä»¬çš„å…¼å®¹æƒ…å†µå¦‚ä¸‹ï¼š</p>
<p><img src="/p/ca035920/MySQL-MVCC(6).png" alt="å›¾ç‰‡"></p>
<h3 id="MySQLä¸­InnoDBå¼•æ“çš„è¡Œé”æ¨¡å¼åŠå…¶æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"><a href="#MySQLä¸­InnoDBå¼•æ“çš„è¡Œé”æ¨¡å¼åŠå…¶æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ" class="headerlink" title="MySQLä¸­InnoDBå¼•æ“çš„è¡Œé”æ¨¡å¼åŠå…¶æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"></a>MySQLä¸­InnoDBå¼•æ“çš„è¡Œé”æ¨¡å¼åŠå…¶æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</h3><p><strong>è¡Œé”æ¨¡å¼</strong></p>
<p>åœ¨å­˜åœ¨è¡Œé”å’Œè¡¨é”çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡æƒ³å¯¹æŸä¸ªè¡¨åŠ Xé”æ—¶ï¼Œéœ€è¦å…ˆæ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–äº‹åŠ¡å¯¹è¿™ä¸ªè¡¨åŠ äº†é”æˆ–å¯¹è¿™ä¸ªè¡¨çš„æŸä¸€è¡ŒåŠ äº†é”ï¼Œå¯¹è¡¨çš„æ¯ä¸€è¡Œéƒ½è¿›è¡Œæ£€æµ‹ä¸€æ¬¡è¿™æ˜¯éå¸¸ä½æ•ˆç‡çš„ï¼Œä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œå®ç°å¤šç²’åº¦é”æœºåˆ¶ï¼ŒInnoDBè¿˜æœ‰ä¸¤ç§å†…éƒ¨ä½¿ç”¨çš„æ„å‘é”ï¼Œä¸¤ç§æ„å‘é”éƒ½æ˜¯è¡¨é”ã€‚</p>
<ul>
<li>æ„å‘å…±äº«é”ï¼šç®€ç§°ISé”ï¼Œä¸€ä¸ªäº‹åŠ¡æ‰“ç®—ç»™æ•°æ®è¡ŒåŠ å…±äº«é”å‰å¿…é¡»å…ˆè·å¾—è¯¥è¡¨çš„ISé”ã€‚</li>
<li>æ„å‘æ’ä»–é”ï¼šç®€ç§°IXé”ï¼Œä¸€ä¸ªäº‹åŠ¡æ‰“ç®—ç»™æ•°æ®è¡ŒåŠ æ’ä»–é”å‰å¿…é¡»å…ˆè·å¾—è¯¥è¡¨çš„IXé”ã€‚</li>
</ul>
<p>æœ‰äº†æ„å‘é”ï¼Œä¸€ä¸ªäº‹åŠ¡æƒ³å¯¹æŸä¸ªè¡¨åŠ Xé”ï¼Œåªéœ€è¦æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–äº‹åŠ¡å¯¹è¿™ä¸ªè¡¨åŠ äº†X/IX/S/ISé”å³å¯ã€‚</p>
<p>é”çš„å…¼å®¹æ€§å¦‚ä¸‹ï¼š</p>
<p><img src="/p/ca035920/MySQL-%E9%94%81.png" alt="å›¾ç‰‡"></p>
<p>è¡Œé”å®ç°æ–¹å¼ï¼šINnoDBçš„è¡Œé”æ˜¯é€šè¿‡ç»™ç´¢å¼•ä¸Šçš„ç´¢å¼•é¡¹åŠ é”å®ç°çš„ï¼Œå¦‚æœæ²¡æœ‰ç´¢å¼•ï¼ŒInnoDBå°†é€šè¿‡éšè—çš„èšç°‡ç´¢å¼•æ¥å¯¹è®°å½•è¿›è¡ŒåŠ é”ã€‚</p>
<p>InnoDBè¡Œé”ä¸»è¦åˆ†ä¸‰ç§æƒ…å†µï¼š</p>
<ul>
<li>Record lockï¼šå¯¹ç´¢å¼•é¡¹åŠ é”</li>
<li>Grap lockï¼šå¯¹ç´¢å¼•ä¹‹é—´çš„â€œé—´éš™â€ã€ç¬¬ä¸€æ¡è®°å½•å‰çš„â€œé—´éš™â€æˆ–æœ€åä¸€æ¡åçš„é—´éš™åŠ é”ã€‚</li>
<li>Next-key lockï¼šå‰ä¸¤ç§æ”¾å…¥ç»„åˆï¼Œå¯¹è®°å½•åŠå‰é¢çš„é—´éš™åŠ é”ã€‚</li>
</ul>
<p>InnoDBè¡Œé”çš„ç‰¹æ€§ï¼šå¦‚æœä¸é€šè¿‡ç´¢å¼•æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œé‚£ä¹ˆInnoDBå°†å¯¹è¡¨ä¸­æ‰€æœ‰è®°å½•åŠ é”ï¼Œå®é™…äº§ç”Ÿçš„æ•ˆæœå’Œè¡¨é”æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>MVCCä¸èƒ½è§£å†³å¹»è¯»é—®é¢˜ï¼Œåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œä½¿ç”¨MVCC+Next-Key Lockså¯ä»¥è§£å†³å¹»è¯»é—®é¢˜ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯æ•°æ®åº“çš„ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Œå¦‚ä½•å®ç°ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ•°æ®åº“çš„ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Œå¦‚ä½•å®ç°ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ•°æ®åº“çš„ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Œå¦‚ä½•å®ç°ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ•°æ®åº“çš„ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Œå¦‚ä½•å®ç°ï¼Ÿ</h3><p>ä¹è§‚é”ï¼šç³»ç»Ÿå‡è®¾æ•°æ®çš„æ›´æ–°åœ¨å¤§å¤šæ•°æ—¶å€™æ˜¯ä¸ä¼šäº§ç”Ÿå†²çªçš„ï¼Œæ‰€ä»¥æ•°æ®åº“åªåœ¨æ›´æ–°æ“ä½œæäº¤çš„æ—¶å€™å¯¹æ•°æ®æ£€æµ‹å†²çªï¼Œå¦‚æœå­˜åœ¨å†²çªï¼Œåˆ™æ•°æ®æ›´æ–°å¤±è´¥ã€‚</p>
<p>ä¹è§‚é”å®ç°æ–¹å¼ï¼šä¸€èˆ¬é€šè¿‡ç‰ˆæœ¬å·å’ŒCASç®—æ³•å®ç°ã€‚</p>
<p>æ‚²è§‚é”ï¼šå‡å®šä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œå±è”½ä¸€åˆ‡å¯èƒ½è¿åæ•°æ®å®Œæ•´æ€§çš„æ“ä½œã€‚é€šä¿—è®²å°±æ˜¯æ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ã€‚</p>
<p>æ‚²è§‚é”çš„å®ç°æ–¹å¼ï¼šé€šè¿‡æ•°æ®åº“çš„é”æœºåˆ¶å®ç°ï¼Œå¯¹æŸ¥è¯¢è¯­å¥æ·»åŠ for updataã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ­»é”ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ</h3><p>æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–è€…ä¸¤ä¸ªä»¥ä¸Šè¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”±äºç«äº‰èµ„æºæˆ–è€…ç”±äºå½¼æ­¤é€šä¿¡è€Œé€ æˆçš„ä¸€ç§é˜»å¡çš„ç°è±¡ã€‚åœ¨MySQLä¸­ï¼ŒMyISAMæ˜¯ä¸€æ¬¡è·å¾—æ‰€éœ€çš„å…¨éƒ¨é”ï¼Œè¦ä¹ˆå…¨éƒ¨æ»¡è¶³ï¼Œè¦ä¹ˆç­‰å¾…ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°æ­»é”ã€‚åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œé™¤äº†å•ä¸ªSQLç»„æˆçš„äº‹åŠ¡å¤–ï¼Œé”éƒ½æ˜¯é€æ­¥è·å¾—çš„ï¼Œæ‰€ä»¥å­˜åœ¨æ­»é”é—®é¢˜ã€‚</p>
<p>å¦‚ä½•é¿å…MySQLå‘ç”Ÿæ­»é”æˆ–é”å†²çªï¼š</p>
<ul>
<li>å¦‚æœä¸åŒçš„ç¨‹åºå¹¶å‘å­˜å–å¤šä¸ªè¡¨ï¼Œå°½é‡ä»¥ç›¸åŒçš„é¡ºåºè®¿é—®è¡¨ã€‚</li>
<li>åœ¨ç¨‹åºä»¥æ‰¹é‡æ–¹å¼å¤„ç†æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœå·²ç»å¯¹æ•°æ®æ’åºï¼Œå°½é‡ä¿è¯æ¯ä¸ªçº¿ç¨‹æŒ‰ç…§å›ºå®šçš„é¡ºåºæ¥å¤„ç†è®°å½•ã€‚</li>
<li>åœ¨äº‹åŠ¡ä¸­ï¼Œå¦‚æœéœ€è¦æ›´æ–°è®°å½•ï¼Œåº”ç›´æ¥ç”³è¯·è¶³å¤Ÿçº§åˆ«çš„æ’ä»–é”ï¼Œè€Œä¸åº”è¯¥å…ˆç”³è¯·å…±äº«é”ï¼Œæ›´æ–°æ—¶åœ¨ç”³è¯·æ’ä»–é”ï¼Œå› ä¸ºåœ¨å½“å‰ç”¨æˆ·ç”³è¯·æ’ä»–é”æ—¶ï¼Œå…¶ä»–äº‹åŠ¡å¯èƒ½å·²ç»è·å¾—äº†ç›¸åŒè®°å½•çš„å…±äº«é”ï¼Œä»è€Œé€ æˆé”å†²çªæˆ–è€…æ­»é”ã€‚</li>
<li>å°½é‡ä½¿ç”¨è¾ƒä½çš„éš”ç¦»çº§åˆ«</li>
<li>å°½é‡ä½¿ç”¨ç´¢å¼•è®¿é—®æ•°æ®ï¼Œä½¿åŠ é”æ›´åŠ å‡†ç¡®ï¼Œä»è€Œå‡å°‘é”å†²çªçš„æœºä¼š</li>
<li>åˆç†é€‰æ‹©äº‹åŠ¡çš„å¤§å°ï¼Œå°äº‹åŠ¡å‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æ›´ä½</li>
<li>å°½é‡ç”¨ç›¸ç­‰çš„æ¡ä»¶è®¿é—®æ•°æ®ï¼Œå¯ä»¥é¿å…Next-Keyé”å¯¹å¹¶å‘æ’å…¥çš„å½±å“ã€‚</li>
<li>ä¸è¦ç”³è¯·è¶…è¿‡å®é™…éœ€è¦çš„é”çº§åˆ«ï¼ŒæŸ¥è¯¢æ—¶å°½é‡ä¸è¦æ˜¾ç¤ºåŠ é”</li>
<li>å¯¹äºä¸€äº›ç‰¹å®šçš„äº‹åŠ¡ï¼Œå¯ä»¥è¡¨é”æ¥æé«˜å¤„ç†é€Ÿåº¦æˆ–å‡å°‘æ­»é”çš„æ¦‚ç‡ã€‚</li>
</ul>
<h2 id="SQLè¯­å¥åŸºç¡€çŸ¥è¯†"><a href="#SQLè¯­å¥åŸºç¡€çŸ¥è¯†" class="headerlink" title="SQLè¯­å¥åŸºç¡€çŸ¥è¯†"></a>SQLè¯­å¥åŸºç¡€çŸ¥è¯†</h2><h3 id="SQLè¯­å¥ä¸»è¦åˆ†ä¸ºå“ªå‡ ç±»"><a href="#SQLè¯­å¥ä¸»è¦åˆ†ä¸ºå“ªå‡ ç±»" class="headerlink" title="SQLè¯­å¥ä¸»è¦åˆ†ä¸ºå“ªå‡ ç±»"></a>SQLè¯­å¥ä¸»è¦åˆ†ä¸ºå“ªå‡ ç±»</h3><ul>
<li>æ•°æ®æ®å®šä¹‰è¯­è¨€DDLï¼ˆData Definition Languageï¼‰ï¼šä¸»è¦æœ‰CREATEï¼ŒDROPï¼ŒALTERç­‰å¯¹é€»è¾‘ç»“æ„æœ‰æ“ä½œçš„ï¼ŒåŒ…æ‹¬è¡¨ç»“æ„ã€è§†å›¾å’Œç´¢å¼•ã€‚</li>
<li>æ•°æ®åº“æŸ¥è¯¢è¯­è¨€DQLï¼ˆData Query Languageï¼‰ï¼šä¸»è¦ä»¥SELECTä¸ºä¸»</li>
<li>æ•°æ®æ“çºµè¯­è¨€DMLï¼ˆData Manipulation Languageï¼‰ï¼šä¸»è¦åŒ…æ‹¬INSERTï¼ŒUPDATEï¼ŒDELETE</li>
<li>æ•°æ®æ§åˆ¶åŠŸèƒ½DCLï¼ˆData Control Languageï¼‰ï¼šä¸»è¦æ˜¯æƒé™æ§åˆ¶èƒ½æ“ä½œï¼ŒåŒ…æ‹¬GRANTï¼ŒREVOKEï¼ŒCOMMITï¼ŒROLLBACKç­‰ã€‚</li>
</ul>
<h3 id="SQLçº¦æŸæœ‰å“ªäº›ï¼Ÿ"><a href="#SQLçº¦æŸæœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="SQLçº¦æŸæœ‰å“ªäº›ï¼Ÿ"></a>SQLçº¦æŸæœ‰å“ªäº›ï¼Ÿ</h3><ul>
<li>ä¸»é”®çº¦æŸï¼šä¸»é”®ä¸ºåœ¨è¡¨ä¸­å­˜åœ¨ä¸€åˆ—æˆ–è€…å¤šåˆ—çš„ç»„åˆï¼Œèƒ½å”¯ä¸€æ ‡è¯†è¡¨ä¸­çš„æ¯ä¸€è¡Œã€‚ä¸€ä¸ªè¡¨åªæœ‰ä¸€ä¸ªä¸»é”®ï¼Œå¹¶ä¸”ä¸»é”®çº¦æŸçš„åˆ—ä¸èƒ½ä¸ºç©ºã€‚</li>
<li>å¤–é”®çº¦æŸï¼šå¤–é”®çº¦æŸæ˜¯æŒ‡ç”¨äºåœ¨ä¸¤ä¸ªè¡¨ä¹‹é—´å»ºç«‹å…³ç³»ï¼Œéœ€è¦æŒ‡å®šå¼•ç”¨ä¸»è¡¨çš„å“ªä¸€åˆ—ã€‚åªæœ‰ä¸»è¡¨çš„ä¸»é”®å¯ä»¥è¢«ä»è¡¨ç”¨ä½œå¤–é”®ï¼Œè¢«çº¦æŸçš„ä»è¡¨çš„åˆ—å¯ä»¥ä¸æ˜¯ä¸»é”®ï¼Œæ‰€ä»¥åˆ›å»ºå¤–é”®çº¦æŸéœ€è¦å…ˆå®šä¹‰ä¸»è¡¨çš„ä¸»é”®ï¼Œç„¶åå®šä¹‰ä»è¡¨çš„å¤–é”®ã€‚</li>
<li>å”¯ä¸€çº¦æŸï¼šç¡®ä¿è¡¨ä¸­çš„ä¸€åˆ—æ•°æ®æ²¡æœ‰ç›¸åŒçš„å€¼ï¼Œä¸€ä¸ªè¡¨å¯ä»¥å®šä¹‰å¤šä¸ªå”¯ä¸€çº¦æŸã€‚</li>
<li>é»˜è®¤çº¦æŸï¼šåœ¨æ’å…¥æ–°æ•°æ®æ—¶ï¼Œå¦‚æœè¯¥è¡Œæ²¡æœ‰æŒ‡å®šæ•°æ®ï¼Œç³»ç»Ÿå°†é»˜è®¤å€¼èµ‹ç»™è¯¥è¡Œï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®æ²¡é»˜è®¤å€¼ï¼Œåˆ™ä¸ºNULLã€‚</li>
<li>Checkçº¦æŸï¼šCheckä¼šé€šè¿‡é€»è¾‘è¡¨è¾¾å¼æ¥åˆ¤æ–­æ•°æ®çš„æœ‰æ•ˆæ€§ï¼Œç”¨æ¥é™åˆ¶è¾“å…¥ä¸€åˆ—æˆ–è€…å¤šåˆ—çš„å€¼çš„èŒƒå›´ã€‚åœ¨åˆ—æ›´æ–°æ•°æ®æ—¶ï¼Œè¾“å…¥çš„å†…å®¹å¿…é¡»æ»¡è¶³Checkçº¦æŸçš„æ¡ä»¶ã€‚</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯å­æŸ¥è¯¢ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å­æŸ¥è¯¢ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å­æŸ¥è¯¢ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å­æŸ¥è¯¢ï¼Ÿ</h3><p>å­æŸ¥è¯¢ï¼šæŠŠä¸€ä¸ªæŸ¥è¯¢çš„ç»“æœåœ¨å¦ä¸€ä¸ªæŸ¥è¯¢ä¸­ä½¿ç”¨</p>
<p>å­æŸ¥è¯¢å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š</p>
<ul>
<li><p>æ ‡é‡å­æŸ¥è¯¢ï¼šæŒ‡å­æŸ¥è¯¢è¿”å›çš„æ˜¯ä¸€ä¸ªå€¼ï¼Œå¯ä»¥ä½¿ç”¨ =,&gt;,&lt;,&gt;=,&lt;=,&lt;&gt;ç­‰æ“ä½œç¬¦å¯¹å­æŸ¥è¯¢æ ‡é‡ç»“æœè¿›è¡Œæ¯”è¾ƒï¼Œä¸€èˆ¬å­æŸ¥è¯¢ä¼šæ”¾åœ¨æ¯”è¾ƒå¼çš„å³ä¾§ã€‚</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> age <span class="operator">=</span> (<span class="keyword">SELECT</span> <span class="built_in">max</span>(age) <span class="keyword">from</span> <span class="keyword">user</span>)  <span class="operator">/</span><span class="operator">/</span>æŸ¥è¯¢å¹´çºªæœ€å¤§çš„äºº</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>åˆ—å­æŸ¥è¯¢ï¼šæŒ‡å­æŸ¥è¯¢çš„ç»“æœæ˜¯nè¡Œä¸€åˆ—ï¼Œä¸€èˆ¬åº”ç”¨äºå¯¹è¡¨çš„æŸä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢è¿”å›ã€‚å¯ä»¥ä½¿ç”¨INã€ANYã€SOMEå’ŒALLç­‰æ“ä½œç¬¦ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> num1 <span class="keyword">FROM</span> table1 <span class="keyword">WHERE</span> num1 <span class="operator">&gt;</span> <span class="keyword">ANY</span> (<span class="keyword">SELECT</span> num2 <span class="keyword">FROM</span> table2)</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>è¡Œå­æŸ¥è¯¢ï¼šæŒ‡å­æŸ¥è¯¢è¿”å›çš„ç»“æœä¸€è¡Œnåˆ—</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> (age,sex) <span class="operator">=</span> (<span class="keyword">SELECT</span> age,sex <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> name<span class="operator">=</span>"zhangsan")</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>è¡¨å­æŸ¥è¯¢ï¼šæŒ‡å­æŸ¥è¯¢æ˜¯nè¡Œnåˆ—çš„ä¸€ä¸ªæ•°æ®è¡¨</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> (name,age,sex) <span class="keyword">IN</span> (<span class="keyword">SELECT</span> name,age,sex <span class="keyword">FROM</span> class1) <span class="operator">/</span><span class="operator">/</span>åœ¨å­¦ç”Ÿè¡¨ä¸­æ‰¾åˆ°ç­çº§åœ¨<span class="number">1</span>ç­çš„å­¦ç”Ÿ</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h3 id="äº†è§£MySQLçš„å‡ ç§è¿æ¥æŸ¥è¯¢å—ï¼Ÿ"><a href="#äº†è§£MySQLçš„å‡ ç§è¿æ¥æŸ¥è¯¢å—ï¼Ÿ" class="headerlink" title="äº†è§£MySQLçš„å‡ ç§è¿æ¥æŸ¥è¯¢å—ï¼Ÿ"></a>äº†è§£MySQLçš„å‡ ç§è¿æ¥æŸ¥è¯¢å—ï¼Ÿ</h3><p>MySQlçš„è¿æ¥æŸ¥è¯¢ä¸»è¦å¯ä»¥åˆ†ä¸ºå¤–è¿æ¥ï¼Œå†…è¿æ¥ï¼Œäº¤å‰è¿æ¥</p>
<ul>
<li><p>å¤–è¿æ¥</p>
<p>å¤–è¿æ¥ä¸»è¦åˆ†ä¸ºå·¦å¤–è¿æ¥(LEFT JOIN)ã€å³å¤–è¿æ¥(RIGHT JOIN)ã€å…¨å¤–è¿æ¥ã€‚</p>
<p>å·¦å¤–è¿æ¥ï¼šæ˜¾ç¤ºå·¦è¡¨ä¸­æ‰€æœ‰çš„æ•°æ®åŠå³è¡¨ä¸­ç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼Œå³è¡¨ä¸­ä¸ç¬¦åˆæ¡ä»¶çš„æ•°æ®ä¸ºnullã€‚</p>
</li>
</ul>
<p><img src="/p/ca035920/MySQL-%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2(1).png" alt="å›¾ç‰‡"></p>
<ul>
<li>å³å¤–è¿æ¥ï¼šæ˜¾ç¤ºå·¦è¡¨ä¸­æ‰€æœ‰çš„æ•°æ®åŠå³è¡¨ä¸­ç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼Œå³è¡¨ä¸­ä¸ç¬¦åˆæ¡ä»¶çš„æ•°æ®ä¸ºnullã€‚</li>
</ul>
<p><img src="/p/ca035920/MySQL-%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2(2).png" alt="å›¾ç‰‡"></p>
<p>MySQLä¸­ä¸æ”¯æŒå…¨å¤–è¿æ¥ã€‚</p>
<ul>
<li>å†…è¿æ¥ï¼šåªæ˜¾ç¤ºç¬¦åˆæ¡ä»¶çš„æ•°æ®</li>
</ul>
<p><img src="/p/ca035920/MySQL-%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2(3).png" alt="å›¾ç‰‡"></p>
<ul>
<li>äº¤å‰è¿æ¥ï¼šä½¿ç”¨ç¬›å¡å°”ç§¯çš„ä¸€ç§è¿æ¥ã€‚</li>
</ul>
<p>ç¬›å¡å°”ç§¯ï¼Œç™¾åº¦ç™¾ç§‘çš„è§£é‡Šï¼šä¸¤ä¸ªé›†åˆ<em>X</em>å’Œ<em>Y</em>çš„ç¬›å¡å°”ç§¯è¡¨ç¤ºä¸º<em>X</em> Ã— <em>Y</em>ï¼Œç¬¬ä¸€ä¸ªå¯¹è±¡æ˜¯<em>X</em>çš„æˆå‘˜è€Œç¬¬äºŒä¸ªå¯¹è±¡æ˜¯<em>Y</em>çš„æ‰€æœ‰å¯èƒ½æœ‰åºå¯¹çš„å…¶ä¸­ä¸€ä¸ªæˆå‘˜ ã€‚ä¾‹å¦‚ï¼šA={a,b}ï¼ŒB={0,1,2}ï¼ŒA Ã— B = {(a,0)ï¼Œ(a,1)ï¼Œ(a,2)ï¼Œ(b,0)ï¼Œ(b,1)ï¼Œ(b,2)}</p>
<p>ä¸¾ä¾‹å¦‚ä¸‹ï¼šæœ‰ä¸¤å¼ è¡¨åˆ†ä¸ºLè¡¨å’ŒRè¡¨ã€‚</p>
<p>Lè¡¨</p>
<table>
<thead>
<tr>
<th align="center">A</th>
<th align="center">B</th>
</tr>
</thead>
<tbody><tr>
<td align="center">a1</td>
<td align="center">b1</td>
</tr>
<tr>
<td align="center">a2</td>
<td align="center">b2</td>
</tr>
<tr>
<td align="center">a3</td>
<td align="center">b3</td>
</tr>
</tbody></table>
<p>Rè¡¨</p>
<table>
<thead>
<tr>
<th align="center">B</th>
<th align="center">C</th>
</tr>
</thead>
<tbody><tr>
<td align="center">b1</td>
<td align="center">c1</td>
</tr>
<tr>
<td align="center">b2</td>
<td align="center">c2</td>
</tr>
<tr>
<td align="center">b4</td>
<td align="center">c3</td>
</tr>
</tbody></table>
<ul>
<li><p>å·¦å¤–è¿æ¥ ï¼š<code>select L.</code><em><code>,R.</code></em><code> from L left join R on L.b=R.b</code></p>
<table>
<thead>
<tr>
<th align="center">A</th>
<th align="center">B</th>
<th align="center">B</th>
<th align="center">C</th>
</tr>
</thead>
<tbody><tr>
<td align="center">a1</td>
<td align="center">b1</td>
<td align="center">b1</td>
<td align="center">c1</td>
</tr>
<tr>
<td align="center">a2</td>
<td align="center">b2</td>
<td align="center">b2</td>
<td align="center">c2</td>
</tr>
<tr>
<td align="center">a3</td>
<td align="center">b3</td>
<td align="center">null</td>
<td align="center">null</td>
</tr>
</tbody></table>
</li>
<li><p>å³å¤–è¿æ¥ï¼š<code>select L.</code><em><code>,R.</code></em><code> from L right join R on L.b=R.b</code></p>
<table>
<thead>
<tr>
<th align="center">B</th>
<th align="center">C</th>
<th align="center">A</th>
<th align="center">B</th>
</tr>
</thead>
<tbody><tr>
<td align="center">b1</td>
<td align="center">c1</td>
<td align="center">a1</td>
<td align="center">b1</td>
</tr>
<tr>
<td align="center">b2</td>
<td align="center">c2</td>
<td align="center">a2</td>
<td align="center">b2</td>
</tr>
<tr>
<td align="center">b4</td>
<td align="center">c3</td>
<td align="center">null</td>
<td align="center">null</td>
</tr>
</tbody></table>
</li>
<li><p>å†…è¿æ¥ï¼š<code>select L.</code><em><code>,R.</code></em><code> from L inner join R on L.b=R.b</code></p>
<table>
<thead>
<tr>
<th align="center">A</th>
<th align="center">B</th>
<th align="center">B</th>
<th align="center">C</th>
</tr>
</thead>
<tbody><tr>
<td align="center">a1</td>
<td align="center">b1</td>
<td align="center">b1</td>
<td align="center">c1</td>
</tr>
<tr>
<td align="center">a2</td>
<td align="center">b2</td>
<td align="center">b2</td>
<td align="center">c2</td>
</tr>
</tbody></table>
</li>
<li><p>äº¤å‰è¿æ¥ï¼š<code>select L.</code><em><code>,R.</code></em><code> from L,R</code></p>
<table>
<thead>
<tr>
<th align="center">A</th>
<th align="center">B</th>
<th align="center">B</th>
<th align="center">C</th>
</tr>
</thead>
<tbody><tr>
<td align="center">a1</td>
<td align="center">b1</td>
<td align="center">b1</td>
<td align="center">c1</td>
</tr>
<tr>
<td align="center">a1</td>
<td align="center">b1</td>
<td align="center">b2</td>
<td align="center">c2</td>
</tr>
<tr>
<td align="center">a1</td>
<td align="center">b1</td>
<td align="center">b4</td>
<td align="center">c3</td>
</tr>
<tr>
<td align="center">a2</td>
<td align="center">b2</td>
<td align="center">b1</td>
<td align="center">c1</td>
</tr>
<tr>
<td align="center">a2</td>
<td align="center">b2</td>
<td align="center">b2</td>
<td align="center">c2</td>
</tr>
<tr>
<td align="center">a2</td>
<td align="center">b2</td>
<td align="center">b4</td>
<td align="center">c3</td>
</tr>
<tr>
<td align="center">a3</td>
<td align="center">b3</td>
<td align="center">b1</td>
<td align="center">c1</td>
</tr>
<tr>
<td align="center">a3</td>
<td align="center">b3</td>
<td align="center">b2</td>
<td align="center">c2</td>
</tr>
<tr>
<td align="center">a3</td>
<td align="center">b3</td>
<td align="center">b4</td>
<td align="center">c3</td>
</tr>
</tbody></table>
</li>
</ul>
<h3 id="mysqlä¸­inå’Œexistsçš„åŒºåˆ«ï¼Ÿ"><a href="#mysqlä¸­inå’Œexistsçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="mysqlä¸­inå’Œexistsçš„åŒºåˆ«ï¼Ÿ"></a>mysqlä¸­inå’Œexistsçš„åŒºåˆ«ï¼Ÿ</h3><p>inå’Œexistsä¸€èˆ¬ç”¨äºå­æŸ¥è¯¢ã€‚</p>
<ul>
<li>ä½¿ç”¨existsæ—¶ä¼šå…ˆè¿›è¡Œå¤–è¡¨æŸ¥è¯¢ï¼Œå°†æŸ¥è¯¢åˆ°çš„æ¯è¡Œæ•°æ®å¸¦å…¥åˆ°å†…è¡¨æŸ¥è¯¢ä¸­çœ‹æ˜¯å¦æ»¡è¶³æ¡ä»¶ï¼›ä½¿ç”¨inä¸€èˆ¬ä¼šå…ˆè¿›è¡Œå†…è¡¨æŸ¥è¯¢è·å–ç»“æœé›†ï¼Œç„¶åå¯¹å¤–è¡¨æŸ¥è¯¢åŒ¹é…ç»“æœé›†ï¼Œè¿”å›æ•°æ®ã€‚</li>
<li>inåœ¨å†…è¡¨æŸ¥è¯¢æˆ–è€…å¤–è¡¨æŸ¥è¯¢è¿‡ç¨‹ä¸­éƒ½ä¼šç”¨åˆ°ç´¢å¼•ã€‚</li>
<li>existsä»…åœ¨å†…è¡¨æŸ¥è¯¢æ—¶ä¼šç”¨åˆ°ç´¢å¼•</li>
<li>ä¸€èˆ¬æ¥è¯´ï¼Œå½“å­æŸ¥è¯¢çš„ç»“æœé›†æ¯”è¾ƒå¤§ï¼Œå¤–è¡¨è¾ƒå°ä½¿ç”¨existæ•ˆç‡æ›´é«˜ï¼›å½“å­æŸ¥è¯¢å¯»å¾—ç»“æœé›†è¾ƒå°ï¼Œå¤–è¡¨è¾ƒå¤§æ—¶ï¼Œä½¿ç”¨inæ•ˆç‡æ›´é«˜ã€‚</li>
<li>å¯¹äºnot inå’Œnot existsï¼Œnot existsæ•ˆç‡æ¯”not inçš„æ•ˆç‡é«˜ï¼Œä¸å­æŸ¥è¯¢çš„ç»“æœé›†æ— å…³ï¼Œå› ä¸ºnot inå¯¹äºå†…å¤–è¡¨éƒ½è¿›è¡Œäº†å…¨è¡¨æ‰«æï¼Œæ²¡æœ‰ä½¿ç”¨åˆ°ç´¢å¼•ã€‚not existsçš„å­æŸ¥è¯¢ä¸­å¯ä»¥ç”¨åˆ°è¡¨ä¸Šçš„ç´¢å¼•ã€‚</li>
</ul>
<h3 id="varcharå’Œcharçš„åŒºåˆ«ï¼Ÿ"><a href="#varcharå’Œcharçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="varcharå’Œcharçš„åŒºåˆ«ï¼Ÿ"></a>varcharå’Œcharçš„åŒºåˆ«ï¼Ÿ</h3><ul>
<li>varcharè¡¨ç¤ºå˜é•¿ï¼Œcharè¡¨ç¤ºé•¿åº¦å›ºå®šã€‚å½“æ‰€æ’å…¥çš„å­—ç¬¦è¶…è¿‡ä»–ä»¬çš„é•¿åº¦æ—¶ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä¼šæ‹’ç»æ’å…¥å¹¶æç¤ºé”™è¯¯ä¿¡æ¯ï¼Œåœ¨ä¸€èˆ¬æ¨¡å¼ä¸‹ï¼Œä¼šæˆªå–åæ’å…¥ã€‚å¦‚char(5)ï¼Œæ— è®ºæ’å…¥çš„å­—ç¬¦é•¿åº¦æ˜¯å¤šå°‘ï¼Œé•¿åº¦éƒ½æ˜¯5ï¼Œæ’å…¥å­—ç¬¦é•¿åº¦å°äº5ï¼Œåˆ™ç”¨ç©ºæ ¼è¡¥å……ã€‚å¯¹äºvarchar(5)ï¼Œå¦‚æœæ’å…¥çš„å­—ç¬¦é•¿åº¦å°äº5ï¼Œåˆ™å­˜å‚¨çš„å­—ç¬¦é•¿åº¦å°±æ˜¯æ’å…¥å­—ç¬¦çš„é•¿åº¦ï¼Œä¸ä¼šå¡«å……ã€‚</li>
<li>å­˜å‚¨å®¹é‡ä¸åŒï¼Œå¯¹äºcharæ¥è¯´ï¼Œæœ€å¤šèƒ½å­˜æ”¾çš„å­—ç¬¦ä¸ªæ•°ä¸º255ã€‚å¯¹äºvarcharï¼Œæœ€å¤šèƒ½å­˜æ”¾çš„å­—ç¬¦ä¸ªæ•°æ˜¯65532ã€‚</li>
<li>å­˜å‚¨é€Ÿåº¦ä¸åŒï¼Œcharé•¿åº¦å›ºå®šï¼Œå­˜å‚¨é€Ÿåº¦ä¼šæ¯”varcharå¿«ä¸€äº›ï¼Œä½†åœ¨ç©ºé—´ä¸Šä¼šå ç”¨é¢å¤–çš„ç©ºé—´ï¼Œå±äºä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„ç­–ç•¥ã€‚è€Œvarcharç©ºé—´åˆ©ç”¨ç‡ä¼šé«˜äº›ï¼Œä½†å­˜å‚¨é€Ÿåº¦æ…¢ï¼Œå±äºä¸€ç§æ—¶é—´æ¢ç©ºé—´çš„ç­–ç•¥ã€‚</li>
</ul>
<h3 id="MySQLä¸­int-10-å’Œchar-10-å’Œvarchar-10-çš„åŒºåˆ«ï¼Ÿ"><a href="#MySQLä¸­int-10-å’Œchar-10-å’Œvarchar-10-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="MySQLä¸­int(10)å’Œchar(10)å’Œvarchar(10)çš„åŒºåˆ«ï¼Ÿ"></a>MySQLä¸­int(10)å’Œchar(10)å’Œvarchar(10)çš„åŒºåˆ«ï¼Ÿ</h3><p>int(10)ä¸­çš„10è¡¨ç¤ºçš„æ˜¯æ˜¾ç¤ºæ•°æ®çš„é•¿åº¦ï¼Œè€Œchar(10)å’Œvarchar(10)è¡¨ç¤ºçš„æ˜¯å­˜å‚¨æ•°æ®çš„å¤§å°ã€‚</p>
<h3 id="dropã€deleteå’Œtruncateçš„åŒºåˆ«ï¼Ÿ"><a href="#dropã€deleteå’Œtruncateçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="dropã€deleteå’Œtruncateçš„åŒºåˆ«ï¼Ÿ"></a>dropã€deleteå’Œtruncateçš„åŒºåˆ«ï¼Ÿ</h3><table>
<thead>
<tr>
<th align="center"></th>
<th align="center">drop</th>
<th align="center">delete</th>
<th align="center">truncate</th>
</tr>
</thead>
<tbody><tr>
<td align="center">é€Ÿåº¦</td>
<td align="center">å¿«</td>
<td align="center">é€è¡Œåˆ é™¤ï¼Œæ…¢</td>
<td align="center">è¾ƒå¿«</td>
</tr>
<tr>
<td align="center">ç±»å‹</td>
<td align="center">DDL</td>
<td align="center">DML</td>
<td align="center">DDL</td>
</tr>
<tr>
<td align="center">å›æ»š</td>
<td align="center">ä¸å¯å›æ»š</td>
<td align="center">å¯å›æ»š</td>
<td align="center">ä¸å¯å›æ»š</td>
</tr>
<tr>
<td align="center">åˆ é™¤å†…å®¹</td>
<td align="center">åˆ é™¤æ•´ä¸ªè¡¨ï¼Œæ•°æ®è¡Œã€ç´¢å¼•éƒ½ä¼šè¢«åˆ é™¤</td>
<td align="center">è¡¨ç»“æ„è¿˜åœ¨ï¼Œåˆ é™¤è¡¨çš„ä¸€éƒ¨åˆ†æˆ–å…¨éƒ¨æ•°æ®</td>
<td align="center">è¡¨ç»“æ„è¿˜åœ¨ï¼Œåˆ é™¤è¡¨çš„å…¨éƒ¨æ•°æ®</td>
</tr>
</tbody></table>
<p>ä¸€èˆ¬æ¥è®²ï¼Œåˆ é™¤æ•´ä¸ªè¡¨ï¼Œä½¿ç”¨dropï¼Œåˆ é™¤è¡¨çš„éƒ¨åˆ†æ•°æ®ä½¿ç”¨deleteï¼Œä¿ç•™è¡¨ç»“æ„åˆ é™¤è¡¨çš„å…¨éƒ¨æ•°æ®ä½¿ç”¨truncateã€‚</p>
<h3 id="UNIONå’ŒUNION-ALLçš„åŒºåˆ«ï¼Ÿ"><a href="#UNIONå’ŒUNION-ALLçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="UNIONå’ŒUNION ALLçš„åŒºåˆ«ï¼Ÿ"></a>UNIONå’ŒUNION ALLçš„åŒºåˆ«ï¼Ÿ</h3><p>unionå’Œunion allçš„ä½œç”¨éƒ½æ˜¯å°†ä¸¤ä¸ªç»“æœé›†åˆå¹¶åˆ°ä¸€èµ·ã€‚</p>
<ul>
<li>unionä¼šå¯¹ç»“æœå»é‡å¹¶æ’åºï¼Œunion allç›´æ¥ç›´æ¥è¿”å›åˆå¹¶åçš„ç»“æœï¼Œä¸å»é‡ä¹Ÿä¸è¿›è¡Œæ’åºã€‚</li>
<li>union allçš„æ€§èƒ½æ¯”unionæ€§èƒ½å¥½ã€‚</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯ä¸´æ—¶è¡¨ï¼Œä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨åˆ°ä¸´æ—¶è¡¨ï¼Œä»€ä¹ˆæ—¶å€™åˆ é™¤ä¸´æ—¶è¡¨ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ä¸´æ—¶è¡¨ï¼Œä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨åˆ°ä¸´æ—¶è¡¨ï¼Œä»€ä¹ˆæ—¶å€™åˆ é™¤ä¸´æ—¶è¡¨ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¸´æ—¶è¡¨ï¼Œä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨åˆ°ä¸´æ—¶è¡¨ï¼Œä»€ä¹ˆæ—¶å€™åˆ é™¤ä¸´æ—¶è¡¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ä¸´æ—¶è¡¨ï¼Œä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨åˆ°ä¸´æ—¶è¡¨ï¼Œä»€ä¹ˆæ—¶å€™åˆ é™¤ä¸´æ—¶è¡¨ï¼Ÿ</h3><p>MySQLåœ¨æ‰§è¡ŒSQLè¯­å¥çš„æ—¶å€™ä¼šä¸´æ—¶åˆ›å»ºä¸€äº›å­˜å‚¨ä¸­é—´ç»“æœé›†çš„è¡¨ï¼Œè¿™ç§è¡¨è¢«ç§°ä¸ºä¸´æ—¶è¡¨ï¼Œä¸´æ—¶è¡¨åªå¯¹å½“å‰è¿æ¥å¯è§ï¼Œåœ¨è¿æ¥å…³é—­åï¼Œä¸´æ—¶è¡¨ä¼šè¢«åˆ é™¤å¹¶é‡Šæ”¾ç©ºé—´ã€‚</p>
<p>ä¸´æ—¶è¡¨ä¸»è¦åˆ†ä¸ºå†…å­˜ä¸´æ—¶è¡¨å’Œç£ç›˜ä¸´æ—¶è¡¨ä¸¤ç§ã€‚å†…å­˜ä¸´æ—¶è¡¨ä½¿ç”¨çš„æ˜¯MEMORYå­˜å‚¨å¼•æ“ï¼Œç£ç›˜ä¸´æ—¶è¡¨ä½¿ç”¨çš„æ˜¯MyISAMå­˜å‚¨å¼•æ“ã€‚</p>
<p>ä¸€èˆ¬åœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä¸­ä¼šä½¿ç”¨åˆ°ä¸´æ—¶è¡¨ï¼š</p>
<ul>
<li>FROMä¸­çš„å­æŸ¥è¯¢</li>
<li>DISTINCTæŸ¥è¯¢å¹¶åŠ ä¸ŠORDER BY</li>
<li>ORDER BYå’ŒGROUP BYçš„å­å¥ä¸ä¸€æ ·æ—¶ä¼šäº§ç”Ÿä¸´æ—¶è¡¨</li>
<li>ä½¿ç”¨UNIONæŸ¥è¯¢ä¼šäº§ç”Ÿä¸´æ—¶è¡¨</li>
</ul>
<h3 id="å¤§è¡¨æ•°æ®æŸ¥è¯¢å¦‚ä½•è¿›è¡Œä¼˜åŒ–ï¼Ÿ"><a href="#å¤§è¡¨æ•°æ®æŸ¥è¯¢å¦‚ä½•è¿›è¡Œä¼˜åŒ–ï¼Ÿ" class="headerlink" title="å¤§è¡¨æ•°æ®æŸ¥è¯¢å¦‚ä½•è¿›è¡Œä¼˜åŒ–ï¼Ÿ"></a>å¤§è¡¨æ•°æ®æŸ¥è¯¢å¦‚ä½•è¿›è¡Œä¼˜åŒ–ï¼Ÿ</h3><ul>
<li>ç´¢å¼•ä¼˜åŒ–</li>
<li>SQLè¯­å¥ä¼˜åŒ–</li>
<li>æ°´å¹³æ‹†åˆ†</li>
<li>å‚ç›´æ‹†åˆ†</li>
<li>å»ºç«‹ä¸­é—´è¡¨</li>
<li>ä½¿ç”¨ç¼“å­˜æŠ€æœ¯</li>
<li>å›ºå®šé•¿åº¦çš„è¡¨è®¿é—®èµ·æ¥æ›´å¿«</li>
<li>è¶Šå°çš„åˆ—è®¿é—®è¶Šå¿«</li>
</ul>
<h3 id="äº†è§£æ…¢æ—¥å¿—æŸ¥è¯¢å—ï¼Ÿç»Ÿè®¡è¿‡æ…¢æŸ¥è¯¢å—ï¼Ÿå¯¹æ…¢æŸ¥è¯¢å¦‚ä½•ä¼˜åŒ–ï¼Ÿ"><a href="#äº†è§£æ…¢æ—¥å¿—æŸ¥è¯¢å—ï¼Ÿç»Ÿè®¡è¿‡æ…¢æŸ¥è¯¢å—ï¼Ÿå¯¹æ…¢æŸ¥è¯¢å¦‚ä½•ä¼˜åŒ–ï¼Ÿ" class="headerlink" title="äº†è§£æ…¢æ—¥å¿—æŸ¥è¯¢å—ï¼Ÿç»Ÿè®¡è¿‡æ…¢æŸ¥è¯¢å—ï¼Ÿå¯¹æ…¢æŸ¥è¯¢å¦‚ä½•ä¼˜åŒ–ï¼Ÿ"></a>äº†è§£æ…¢æ—¥å¿—æŸ¥è¯¢å—ï¼Ÿç»Ÿè®¡è¿‡æ…¢æŸ¥è¯¢å—ï¼Ÿå¯¹æ…¢æŸ¥è¯¢å¦‚ä½•ä¼˜åŒ–ï¼Ÿ</h3><p>æ…¢æŸ¥è¯¢ä¸€èˆ¬ç”¨äºè®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡æŸä¸ªä¸´ç•Œå€¼çš„SQLè¯­å¥çš„æ—¥å¿—ã€‚</p>
<p>ç›¸å…³å‚æ•°ï¼š</p>
<ul>
<li><p>slow_query_logï¼šæ˜¯å¦å¼€å¯æ…¢æ—¥å¿—æŸ¥è¯¢ï¼Œ1è¡¨ç¤ºå¼€å¯ï¼Œ0è¡¨ç¤ºå…³é—­ã€‚</p>
</li>
<li><p>slow_query_log_fileï¼šMySQLæ•°æ®åº“æ…¢æŸ¥è¯¢æ—¥å¿—å­˜å‚¨è·¯å¾„ã€‚</p>
</li>
<li><p>long_query_timeï¼šæ…¢æŸ¥è¯¢é˜ˆå€¼ï¼Œå½“SQLè¯­å¥æŸ¥è¯¢æ—¶é—´å¤§äºé˜ˆå€¼ï¼Œä¼šè¢«è®°å½•åœ¨æ—¥å¿—ä¸Šã€‚</p>
</li>
<li><p>log_queries_not_using_indexesï¼šæœªä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢ä¼šè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚</p>
</li>
<li><p>log_outputï¼šæ—¥å¿—å­˜å‚¨æ–¹å¼ã€‚â€œFILEâ€è¡¨ç¤ºå°†æ—¥å¿—å­˜å…¥æ–‡ä»¶ã€‚â€œTABLEâ€è¡¨ç¤ºå°†æ—¥å¿—å­˜å…¥æ•°æ®åº“ã€‚</p>
</li>
<li><p>slow_query_logï¼šæ˜¯å¦å¼€å¯æ…¢æ—¥å¿—æŸ¥è¯¢ï¼Œ1è¡¨ç¤ºå¼€å¯ï¼Œ0è¡¨ç¤ºå…³é—­ã€‚</p>
</li>
<li><p>slow_query_log_fileï¼šMySQLæ•°æ®åº“æ…¢æŸ¥è¯¢æ—¥å¿—å­˜å‚¨è·¯å¾„ã€‚</p>
</li>
<li><p>long_query_timeï¼šæ…¢æŸ¥è¯¢é˜ˆå€¼ï¼Œå½“SQLè¯­å¥æŸ¥è¯¢æ—¶é—´å¤§äºé˜ˆå€¼ï¼Œä¼šè¢«è®°å½•åœ¨æ—¥å¿—ä¸Šã€‚</p>
</li>
<li><p>log_queries_not_using_indexesï¼šæœªä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢ä¼šè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚</p>
</li>
<li><p>log_outputï¼šæ—¥å¿—å­˜å‚¨æ–¹å¼ã€‚â€œFILEâ€è¡¨ç¤ºå°†æ—¥å¿—å­˜å…¥æ–‡ä»¶ã€‚â€œTABLEâ€è¡¨ç¤ºå°†æ—¥å¿—å­˜å…¥æ•°æ®åº“ã€‚</p>
</li>
</ul>
<p>å¦‚ä½•å¯¹æ…¢æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Ÿ</p>
<ul>
<li>åˆ†æè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼ŒæŸ¥çœ‹SQLè¯­å¥çš„ç´¢å¼•æ˜¯å¦å‘½ä¸­</li>
<li>ä¼˜åŒ–æ•°æ®åº“çš„ç»“æ„ï¼Œå°†å­—æ®µå¾ˆå¤šçš„è¡¨åˆ†è§£æˆå¤šä¸ªè¡¨ï¼Œæˆ–è€…è€ƒè™‘å»ºç«‹ä¸­é—´è¡¨ã€‚</li>
<li>ä¼˜åŒ–LIMITåˆ†é¡µã€‚</li>
</ul>
<h3 id="ä¸ºä»€ä¹ˆè¦è®¾ç½®ä¸»é”®ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦è®¾ç½®ä¸»é”®ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è®¾ç½®ä¸»é”®ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦è®¾ç½®ä¸»é”®ï¼Ÿ</h3><p>ä¸»é”®æ˜¯å”¯ä¸€åŒºåˆ†è¡¨ä¸­æ¯ä¸€è¡Œçš„å”¯ä¸€æ ‡è¯†ï¼Œå¦‚æœæ²¡æœ‰ä¸»é”®ï¼Œæ›´æ–°æˆ–è€…åˆ é™¤è¡¨ä¸­ç‰¹å®šçš„è¡Œä¼šå¾ˆå›°éš¾ï¼Œå› ä¸ºä¸èƒ½å”¯ä¸€å‡†ç¡®åœ°æ ‡è¯†æŸä¸€è¡Œã€‚</p>
<h3 id="ä¸»é”®ä¸€èˆ¬ç”¨è‡ªå¢IDè¿˜æ˜¯UUIDï¼Ÿ"><a href="#ä¸»é”®ä¸€èˆ¬ç”¨è‡ªå¢IDè¿˜æ˜¯UUIDï¼Ÿ" class="headerlink" title="ä¸»é”®ä¸€èˆ¬ç”¨è‡ªå¢IDè¿˜æ˜¯UUIDï¼Ÿ"></a>ä¸»é”®ä¸€èˆ¬ç”¨è‡ªå¢IDè¿˜æ˜¯UUIDï¼Ÿ</h3><p>ä½¿ç”¨è‡ªå¢IDçš„å¥½å¤„ï¼š</p>
<ul>
<li>å­—æ®µé•¿åº¦è¾ƒuuidä¼šå°å¾ˆå¤šã€‚</li>
<li>æ•°æ®åº“è‡ªåŠ¨ç¼–å·ï¼ŒæŒ‰é¡ºåºå­˜æ”¾ï¼Œåˆ©äºæ£€ç´¢</li>
<li>æ— éœ€æ‹…å¿ƒä¸»é”®é‡å¤é—®é¢˜</li>
</ul>
<p>ä½¿ç”¨è‡ªå¢IDçš„ç¼ºç‚¹ï¼š</p>
<ul>
<li>å› ä¸ºæ˜¯è‡ªå¢ï¼Œåœ¨æŸäº›ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œå®¹æ˜“è¢«å…¶ä»–äººæŸ¥åˆ°ä¸šåŠ¡é‡ã€‚</li>
<li>å‘ç”Ÿæ•°æ®è¿ç§»æ—¶ï¼Œæˆ–è€…è¡¨åˆå¹¶æ—¶ä¼šéå¸¸éº»çƒ¦</li>
<li>åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œç«äº‰è‡ªå¢é”ä¼šé™ä½æ•°æ®åº“çš„ååèƒ½åŠ›</li>
</ul>
<p>UUIDï¼šé€šç”¨å”¯ä¸€æ ‡è¯†ç ï¼ŒUUIDæ˜¯åŸºäºå½“å‰æ—¶é—´ã€è®¡æ•°å™¨å’Œç¡¬ä»¶æ ‡è¯†ç­‰æ•°æ®è®¡ç®—ç”Ÿæˆçš„ã€‚</p>
<p>ä½¿ç”¨UUIDçš„ä¼˜ç‚¹ï¼š</p>
<ul>
<li>å”¯ä¸€æ ‡è¯†ï¼Œä¸ä¼šè€ƒè™‘é‡å¤é—®é¢˜ï¼Œåœ¨æ•°æ®æ‹†åˆ†ã€åˆå¹¶æ—¶ä¹Ÿèƒ½è¾¾åˆ°å…¨å±€çš„å”¯ä¸€æ€§ã€‚</li>
<li>å¯ä»¥åœ¨åº”ç”¨å±‚ç”Ÿæˆï¼Œæé«˜æ•°æ®åº“çš„ååèƒ½åŠ›ã€‚</li>
<li>æ— éœ€æ‹…å¿ƒä¸šåŠ¡é‡æ³„éœ²çš„é—®é¢˜ã€‚</li>
</ul>
<p>ä½¿ç”¨UUIDçš„ç¼ºç‚¹ï¼š</p>
<ul>
<li>å› ä¸ºUUIDæ˜¯éšæœºç”Ÿæˆçš„ï¼Œæ‰€ä»¥ä¼šå‘ç”ŸéšæœºIOï¼Œå½±å“æ’å…¥é€Ÿåº¦ï¼Œå¹¶ä¸”ä¼šé€ æˆç¡¬ç›˜çš„ä½¿ç”¨ç‡è¾ƒä½ã€‚</li>
<li>UUIDå ç”¨ç©ºé—´è¾ƒå¤§ï¼Œå»ºç«‹çš„ç´¢å¼•è¶Šå¤šï¼Œé€ æˆçš„å½±å“è¶Šå¤§ã€‚</li>
<li>UUIDä¹‹é—´æ¯”è¾ƒå¤§å°è¾ƒè‡ªå¢IDæ…¢ä¸å°‘ï¼Œå½±å“æŸ¥è¯¢é€Ÿåº¦ã€‚</li>
</ul>
<p>æœ€åè¯´ä¸‹ç»“è®ºï¼Œä¸€èˆ¬æƒ…å†µMySQLæ¨èä½¿ç”¨è‡ªå¢IDã€‚å› ä¸ºåœ¨MySQLçš„InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œä¸»é”®ç´¢å¼•æ˜¯ä¸€ç§èšç°‡ç´¢å¼•ï¼Œä¸»é”®ç´¢å¼•çš„B+æ ‘çš„å¶å­èŠ‚ç‚¹æŒ‰ç…§é¡ºåºå­˜å‚¨äº†ä¸»é”®å€¼åŠæ•°æ®ï¼Œå¦‚æœä¸»é”®ç´¢å¼•æ˜¯è‡ªå¢IDï¼Œåªéœ€è¦æŒ‰é¡ºåºå¾€åæ’åˆ—å³å¯ï¼Œå¦‚æœæ˜¯UUIDï¼ŒIDæ˜¯éšæœºç”Ÿæˆçš„ï¼Œåœ¨æ•°æ®æ’å…¥æ—¶ä¼šé€ æˆå¤§é‡çš„æ•°æ®ç§»åŠ¨ï¼Œäº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œé€ æˆæ’å…¥æ€§èƒ½çš„ä¸‹é™ã€‚</p>
<h3 id="å­—æ®µä¸ºä»€ä¹ˆè¦è®¾ç½®æˆnot-null"><a href="#å­—æ®µä¸ºä»€ä¹ˆè¦è®¾ç½®æˆnot-null" class="headerlink" title="å­—æ®µä¸ºä»€ä¹ˆè¦è®¾ç½®æˆnot null?"></a>å­—æ®µä¸ºä»€ä¹ˆè¦è®¾ç½®æˆnot null?</h3><p>é¦–å…ˆè¯´ä¸€ç‚¹ï¼ŒNULLå’Œç©ºå€¼æ˜¯ä¸ä¸€æ ·çš„ï¼Œç©ºå€¼æ˜¯ä¸å ç”¨ç©ºé—´çš„ï¼Œè€ŒNULLæ˜¯å ç”¨ç©ºé—´çš„ï¼Œæ‰€ä»¥å­—æ®µè®¾ä¸ºNOT NULLåä»ç„¶å¯ä»¥æ’å…¥ç©ºå€¼ã€‚</p>
<p>å­—æ®µè®¾ç½®æˆnot nullä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹åŸå› ï¼š</p>
<ul>
<li><p>NULLå€¼ä¼šå½±å“ä¸€äº›å‡½æ•°çš„ç»Ÿè®¡ï¼Œå¦‚countï¼Œé‡åˆ°NULLå€¼ï¼Œè¿™æ¡è®°å½•ä¸ä¼šç»Ÿè®¡åœ¨å†…ã€‚</p>
</li>
<li><p>Bæ ‘ä¸å­˜å‚¨NULLï¼Œæ‰€ä»¥ç´¢å¼•ç”¨ä¸åˆ°NULLï¼Œä¼šé€ æˆç¬¬ä¸€ç‚¹ä¸­è¯´çš„ç»Ÿè®¡ä¸åˆ°çš„é—®é¢˜ã€‚</p>
</li>
<li><p>NOT INå­æŸ¥è¯¢åœ¨æœ‰NULLå€¼çš„æƒ…å†µä¸‹è¿”å›çš„ç»“æœéƒ½æ˜¯ç©ºå€¼ã€‚</p>
<p>ä¾‹å¦‚userè¡¨å¦‚ä¸‹</p>
<table>
<thead>
<tr>
<th align="center">id</th>
<th align="center">username</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">zhangsan</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">lisi</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">null</td>
</tr>
</tbody></table>
<p><code>select * from </code>user<code>where username NOT IN (select username from</code>user<code> where id != 0)</code>ï¼Œè¿™æ¡æŸ¥è¯¢è¯­å¥åº”è¯¥æŸ¥åˆ°zhangsanè¿™æ¡æ•°æ®ï¼Œä½†æ˜¯ç»“æœæ˜¾ç¤ºä¸ºnullã€‚</p>
</li>
<li><p>MySQLåœ¨è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™ï¼ŒNULLä¼šå‚ä¸å­—æ®µçš„æ¯”è¾ƒï¼Œå› ä¸ºNULLæ˜¯ä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„æ•°æ®ç±»å‹ï¼Œæ•°æ®åº“åœ¨å¤„ç†æ—¶éœ€è¦è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œå¢åŠ äº†æ•°æ®åº“å¤„ç†è®°å½•çš„å¤æ‚æ€§ã€‚</p>
</li>
</ul>
<h3 id="å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢è¿‡ç¨‹ä¸­çš„æ•°æ®è®¿é—®ï¼Ÿ"><a href="#å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢è¿‡ç¨‹ä¸­çš„æ•°æ®è®¿é—®ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢è¿‡ç¨‹ä¸­çš„æ•°æ®è®¿é—®ï¼Ÿ"></a>å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢è¿‡ç¨‹ä¸­çš„æ•°æ®è®¿é—®ï¼Ÿ</h3><p>ä»å‡å°‘æ•°æ®è®¿é—®æ–¹é¢è€ƒè™‘ï¼š</p>
<ul>
<li>æ­£ç¡®ä½¿ç”¨ç´¢å¼•ï¼Œå°½é‡åšåˆ°ç´¢å¼•è¦†ç›–</li>
<li>ä¼˜åŒ–SQLæ‰§è¡Œè®¡åˆ’</li>
</ul>
<p>ä»è¿”å›æ›´å°‘çš„æ•°æ®æ–¹é¢è€ƒè™‘ï¼š</p>
<ul>
<li>æ•°æ®åˆ†é¡µå¤„ç†</li>
<li>åªè¿”å›éœ€è¦çš„å­—æ®µ</li>
</ul>
<p>ä»å‡å°‘æœåŠ¡å™¨CPUå¼€é”€æ–¹é¢è€ƒè™‘ï¼š</p>
<ul>
<li>åˆç†ä½¿ç”¨æ’åº</li>
<li>å‡å°‘æ¯”è¾ƒçš„æ“ä½œ</li>
<li>å¤æ‚è¿ç®—åœ¨å®¢æˆ·ç«¯å¤„ç†</li>
</ul>
<p>ä»å¢åŠ èµ„æºæ–¹é¢è€ƒè™‘ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯å¤šè¿›ç¨‹å¹¶è¡Œè®¿é—®</li>
<li>æ•°æ®åº“å¹¶è¡Œå¤„ç†</li>
</ul>
<h3 id="å¦‚ä½•ä¼˜åŒ–é•¿éš¾çš„æŸ¥è¯¢è¯­å¥ï¼Ÿ"><a href="#å¦‚ä½•ä¼˜åŒ–é•¿éš¾çš„æŸ¥è¯¢è¯­å¥ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¼˜åŒ–é•¿éš¾çš„æŸ¥è¯¢è¯­å¥ï¼Ÿ"></a>å¦‚ä½•ä¼˜åŒ–é•¿éš¾çš„æŸ¥è¯¢è¯­å¥ï¼Ÿ</h3><ul>
<li>å°†ä¸€ä¸ªå¤§çš„æŸ¥è¯¢åˆ†è§£ä¸ºå¤šä¸ªå°çš„æŸ¥è¯¢</li>
<li>åˆ†è§£å…³è”æŸ¥è¯¢ï¼Œä½¿ç¼“å­˜çš„æ•ˆç‡æ›´é«˜</li>
</ul>
<h3 id="å¦‚ä½•ä¼˜åŒ–LIMITåˆ†é¡µï¼Ÿ"><a href="#å¦‚ä½•ä¼˜åŒ–LIMITåˆ†é¡µï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¼˜åŒ–LIMITåˆ†é¡µï¼Ÿ"></a>å¦‚ä½•ä¼˜åŒ–LIMITåˆ†é¡µï¼Ÿ</h3><ul>
<li>åœ¨LIMITåç§»é‡è¾ƒå¤§çš„æ—¶å€™ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¼šå˜ä½ï¼Œå¯ä»¥è®°å½•æ¯æ¬¡å–å‡ºçš„æœ€å¤§IDï¼Œä¸‹æ¬¡æŸ¥è¯¢æ—¶å¯ä»¥åˆ©ç”¨IDè¿›è¡ŒæŸ¥è¯¢</li>
<li>å»ºç«‹å¤åˆç´¢å¼•</li>
</ul>
<h3 id="å¦‚ä½•ä¼˜åŒ–UNIONæŸ¥è¯¢"><a href="#å¦‚ä½•ä¼˜åŒ–UNIONæŸ¥è¯¢" class="headerlink" title="å¦‚ä½•ä¼˜åŒ–UNIONæŸ¥è¯¢"></a>å¦‚ä½•ä¼˜åŒ–UNIONæŸ¥è¯¢</h3><p>å¦‚æœä¸éœ€è¦å¯¹ç»“æœé›†è¿›è¡Œå»é‡æˆ–è€…æ’åºå»ºè®®ä½¿ç”¨UNION ALLï¼Œä¼šå¥½ä¸€äº›ã€‚</p>
<h3 id="å¦‚ä½•ä¼˜åŒ–WHEREå­å¥"><a href="#å¦‚ä½•ä¼˜åŒ–WHEREå­å¥" class="headerlink" title="å¦‚ä½•ä¼˜åŒ–WHEREå­å¥"></a>å¦‚ä½•ä¼˜åŒ–WHEREå­å¥</h3><ul>
<li>ä¸è¦åœ¨whereå­å¥ä¸­ä½¿ç”¨!=å’Œ&lt;&gt;è¿›è¡Œä¸ç­‰äºåˆ¤æ–­ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ”¾å¼ƒç´¢å¼•è¿›è¡Œå…¨è¡¨æ‰«æã€‚</li>
<li>ä¸è¦åœ¨whereå­å¥ä¸­ä½¿ç”¨nullæˆ–ç©ºå€¼åˆ¤æ–­ï¼Œå°½é‡è®¾ç½®å­—æ®µä¸ºnot nullã€‚</li>
<li>å°½é‡ä½¿ç”¨union allä»£æ›¿or</li>
<li>åœ¨whereå’Œorder byæ¶‰åŠçš„åˆ—å»ºç«‹ç´¢å¼•</li>
<li>å°½é‡å‡å°‘ä½¿ç”¨inæˆ–è€…not inï¼Œä¼šè¿›è¡Œå…¨è¡¨æ‰«æ</li>
<li>åœ¨whereå­å¥ä¸­ä½¿ç”¨å‚æ•°ä¼šå¯¼è‡´å…¨è¡¨æ‰«æ</li>
<li>é¿å…åœ¨whereå­å¥ä¸­å¯¹å­—æ®µåŠè¿›è¡Œè¡¨è¾¾å¼æˆ–è€…å‡½æ•°æ“ä½œä¼šå¯¼è‡´å­˜å‚¨å¼•æ“æ”¾å¼ƒç´¢å¼•è¿›è€Œå…¨è¡¨æ‰«æ</li>
</ul>
<h3 id="SQLè¯­å¥æ‰§è¡Œçš„å¾ˆæ…¢åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#SQLè¯­å¥æ‰§è¡Œçš„å¾ˆæ…¢åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="SQLè¯­å¥æ‰§è¡Œçš„å¾ˆæ…¢åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ"></a>SQLè¯­å¥æ‰§è¡Œçš„å¾ˆæ…¢åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul>
<li>å¦‚æœSQLè¯­å¥åªæ˜¯å¶å°”æ‰§è¡Œå¾ˆæ…¢ï¼Œå¯èƒ½æ˜¯æ‰§è¡Œçš„æ—¶å€™é‡åˆ°äº†é”ï¼Œä¹Ÿå¯èƒ½æ˜¯redo logæ—¥å¿—å†™æ»¡äº†ï¼Œè¦å°†redo logä¸­çš„æ•°æ®åŒæ­¥åˆ°ç£ç›˜ä¸­å»ã€‚</li>
<li>å¦‚æœSQLè¯­å¥ä¸€ç›´éƒ½å¾ˆæ…¢ï¼Œå¯èƒ½æ˜¯å­—æ®µä¸Šæ²¡æœ‰ç´¢å¼•æˆ–è€…å­—æ®µæœ‰ç´¢å¼•ä½†æ˜¯æ²¡ç”¨ä¸Šç´¢å¼•ã€‚</li>
</ul>
<h3 id="SQLè¯­å¥çš„æ‰§è¡Œé¡ºåº"><a href="#SQLè¯­å¥çš„æ‰§è¡Œé¡ºåº" class="headerlink" title="SQLè¯­å¥çš„æ‰§è¡Œé¡ºåº?"></a>SQLè¯­å¥çš„æ‰§è¡Œé¡ºåº?</h3><figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> </span><br><span class="line">	select_list </span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">	left_table </span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> </span><br><span class="line">	right_table <span class="keyword">ON</span> join_condition </span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">	where_condition </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> </span><br><span class="line">	group_by_list </span><br><span class="line"><span class="keyword">HAVING</span> </span><br><span class="line">	having_condition </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> </span><br><span class="line">	order_by_condition</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š</p>
<p><img src="/p/ca035920/MySQL-SQL%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F.png" alt="å›¾ç‰‡"></p>
<ul>
<li>FROMï¼šå¯¹SQLè¯­å¥æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œé¦–å…ˆå¯¹å…³é”®å­—ä¸¤è¾¹çš„è¡¨ä»¥ç¬›å¡å°”ç§¯çš„å½¢å¼æ‰§è¡Œè¿æ¥ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªè™šè¡¨V1ã€‚è™šè¡¨å°±æ˜¯è§†å›¾ï¼Œæ•°æ®ä¼šæ¥è‡ªå¤šå¼ è¡¨çš„æ‰§è¡Œç»“æœã€‚</li>
<li>ONï¼šå¯¹FROMè¿æ¥çš„ç»“æœè¿›è¡ŒONè¿‡æ»¤,å¹¶åˆ›å»ºè™šè¡¨V2</li>
<li>JOINï¼šå°†ONè¿‡æ»¤åçš„å·¦è¡¨æ·»åŠ è¿›æ¥ï¼Œå¹¶åˆ›å»ºæ–°çš„è™šæ‹Ÿè¡¨V3</li>
<li>WHEREï¼šå¯¹è™šæ‹Ÿè¡¨V3è¿›è¡ŒWHEREç­›é€‰ï¼Œåˆ›å»ºè™šæ‹Ÿè¡¨V4</li>
<li>GROUP BYï¼šå¯¹V4ä¸­çš„è®°å½•è¿›è¡Œåˆ†ç»„æ“ä½œï¼Œåˆ›å»ºè™šæ‹Ÿè¡¨V5</li>
<li>HAVINGï¼šå¯¹V5è¿›è¡Œè¿‡æ»¤ï¼Œåˆ›å»ºè™šæ‹Ÿè¡¨V6</li>
<li>SELECTï¼šå°†V6ä¸­çš„ç»“æœæŒ‰ç…§SELECTè¿›è¡Œç­›é€‰ï¼Œåˆ›å»ºè™šæ‹Ÿè¡¨V7</li>
<li>DISTINCTï¼šå¯¹V7è¡¨ä¸­çš„ç»“æœè¿›è¡Œå»é‡æ“ä½œï¼Œåˆ›å»ºè™šæ‹Ÿè¡¨V8ï¼Œå¦‚æœä½¿ç”¨äº†GROUP BYå­å¥åˆ™æ— éœ€ä½¿ç”¨DISTINCTï¼Œå› ä¸ºåˆ†ç»„çš„æ—¶å€™æ˜¯å°†åˆ—ä¸­å”¯ä¸€çš„å€¼åˆ†æˆä¸€ç»„ï¼Œå¹¶ä¸”æ¯ç»„åªè¿”å›ä¸€è¡Œè®°å½•ï¼Œæ‰€ä»¥æ‰€æœ‰çš„è®°å½•éƒ½hæ˜¯ä¸åŒçš„ã€‚</li>
<li>ORDER BYï¼šå¯¹V8è¡¨ä¸­çš„ç»“æœè¿›è¡Œæ’åºã€‚</li>
</ul>
<h2 id="æ•°æ®åº“ä¼˜åŒ–"><a href="#æ•°æ®åº“ä¼˜åŒ–" class="headerlink" title="æ•°æ®åº“ä¼˜åŒ–"></a>æ•°æ®åº“ä¼˜åŒ–</h2><h3 id="å¤§è¡¨å¦‚ä½•ä¼˜åŒ–ï¼Ÿ"><a href="#å¤§è¡¨å¦‚ä½•ä¼˜åŒ–ï¼Ÿ" class="headerlink" title="å¤§è¡¨å¦‚ä½•ä¼˜åŒ–ï¼Ÿ"></a>å¤§è¡¨å¦‚ä½•ä¼˜åŒ–ï¼Ÿ</h3><ul>
<li>é™å®šæ•°æ®çš„èŒƒå›´ï¼šé¿å…ä¸å¸¦ä»»ä½•é™åˆ¶æ•°æ®èŒƒå›´æ¡ä»¶çš„æŸ¥è¯¢è¯­å¥ã€‚</li>
<li>è¯»å†™åˆ†ç¦»ï¼šä¸»åº“è´Ÿè´£å†™ï¼Œä»åº“è´Ÿè´£è¯»ã€‚</li>
<li>å‚ç›´åˆ†è¡¨ï¼šå°†ä¸€ä¸ªè¡¨æŒ‰ç…§å­—æ®µåˆ†æˆå¤šä¸ªè¡¨ï¼Œæ¯ä¸ªè¡¨å­˜å‚¨å…¶ä¸­ä¸€éƒ¨åˆ†å­—æ®µã€‚</li>
<li>æ°´å¹³åˆ†è¡¨ï¼šåœ¨åŒä¸€ä¸ªæ•°æ®åº“å†…ï¼ŒæŠŠä¸€ä¸ªè¡¨çš„æ•°æ®æŒ‰ç…§ä¸€å®šè§„åˆ™æ‹†åˆ†åˆ°å¤šä¸ªè¡¨ä¸­ã€‚</li>
<li>å¯¹å•è¡¨è¿›è¡Œä¼˜åŒ–ï¼šå¯¹è¡¨ä¸­çš„å­—æ®µã€ç´¢å¼•ã€æŸ¥è¯¢SQLè¿›è¡Œä¼˜åŒ–ã€‚</li>
<li>æ·»åŠ ç¼“å­˜</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯å‚ç›´åˆ†è¡¨ã€å‚ç›´åˆ†åº“ã€æ°´å¹³åˆ†è¡¨ã€æ°´å¹³åˆ†åº“ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å‚ç›´åˆ†è¡¨ã€å‚ç›´åˆ†åº“ã€æ°´å¹³åˆ†è¡¨ã€æ°´å¹³åˆ†åº“ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å‚ç›´åˆ†è¡¨ã€å‚ç›´åˆ†åº“ã€æ°´å¹³åˆ†è¡¨ã€æ°´å¹³åˆ†åº“ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å‚ç›´åˆ†è¡¨ã€å‚ç›´åˆ†åº“ã€æ°´å¹³åˆ†è¡¨ã€æ°´å¹³åˆ†åº“ï¼Ÿ</h3><p>å‚ç›´åˆ†è¡¨ï¼šå°†ä¸€ä¸ªè¡¨æŒ‰ç…§å­—æ®µåˆ†æˆå¤šä¸ªè¡¨ï¼Œæ¯ä¸ªè¡¨å­˜å‚¨å…¶ä¸­ä¸€éƒ¨åˆ†å­—æ®µã€‚ä¸€èˆ¬ä¼šå°†å¸¸ç”¨çš„å­—æ®µæ”¾åˆ°ä¸€ä¸ªè¡¨ä¸­ï¼Œå°†ä¸å¸¸ç”¨çš„å­—æ®µæ”¾åˆ°å¦ä¸€ä¸ªè¡¨ä¸­ã€‚</p>
<p>å‚ç›´åˆ†è¡¨çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>é¿å…IOç«äº‰å‡å°‘é”è¡¨çš„æ¦‚ç‡ã€‚å› ä¸ºå¤§çš„å­—æ®µæ•ˆç‡æ›´ä½ï¼Œç¬¬ä¸€æ•°æ®é‡å¤§ï¼Œéœ€è¦çš„è¯»å–æ—¶é—´é•¿ã€‚ç¬¬äºŒï¼Œå¤§å­—æ®µå ç”¨çš„ç©ºé—´æ›´å¤§ï¼Œå•é¡µå†…å­˜å‚¨çš„è¡Œæ•°å˜å°‘ï¼Œä¼šä½¿å¾—IOæ“ä½œå¢å¤šã€‚</li>
<li>å¯ä»¥æ›´å¥½åœ°æå‡çƒ­é—¨æ•°æ®çš„æŸ¥è¯¢æ•ˆç‡ã€‚</li>
</ul>
<p>å‚ç›´åˆ†åº“ï¼šæŒ‰ç…§ä¸šåŠ¡å¯¹è¡¨è¿›è¡Œåˆ†ç±»ï¼Œéƒ¨ç½²åˆ°ä¸åŒçš„æ•°æ®åº“ä¸Šé¢ï¼Œä¸åŒçš„æ•°æ®åº“å¯ä»¥æ”¾åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šé¢ã€‚</p>
<p>å‚ç›´åˆ†åº“çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>é™ä½ä¸šåŠ¡ä¸­çš„è€¦åˆï¼Œæ–¹ä¾¿å¯¹ä¸åŒçš„ä¸šåŠ¡è¿›è¡Œåˆ†çº§ç®¡ç†ã€‚</li>
<li>å¯ä»¥æå‡IOã€æ•°æ®åº“è¿æ¥æ•°ã€è§£å†³å•æœºç¡¬ä»¶èµ„æºçš„ç“¶é¢ˆé—®é¢˜ã€‚</li>
</ul>
<p>å‚ç›´æ‹†åˆ†ï¼ˆåˆ†åº“ã€åˆ†è¡¨ï¼‰çš„ç¼ºç‚¹ï¼š</p>
<ul>
<li>ä¸»é”®å‡ºç°å†—ä½™ï¼Œéœ€è¦ç®¡ç†å†—ä½™åˆ—</li>
<li>äº‹åŠ¡çš„å¤„ç†å˜å¾—å¤æ‚</li>
<li>ä»ç„¶å­˜åœ¨å•è¡¨æ•°æ®é‡è¿‡å¤§çš„é—®é¢˜</li>
</ul>
<p>æ°´å¹³åˆ†è¡¨ï¼šåœ¨åŒä¸€ä¸ªæ•°æ®åº“å†…ï¼ŒæŠŠåŒä¸€ä¸ªè¡¨çš„æ•°æ®æŒ‰ç…§ä¸€å®šè§„åˆ™æ‹†åˆ†åˆ°å¤šä¸ªè¡¨ä¸­ã€‚</p>
<p>æ°´å¹³åˆ†è¡¨çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>è§£å†³äº†å•è¡¨æ•°æ®é‡è¿‡å¤§çš„é—®é¢˜</li>
<li>é¿å…IOç«äº‰å¹¶å‡å°‘é”è¡¨çš„æ¦‚ç‡</li>
</ul>
<p>æ°´å¹³åˆ†åº“ï¼šæŠŠåŒä¸€ä¸ªè¡¨çš„æ•°æ®æŒ‰ç…§ä¸€å®šè§„åˆ™æ‹†åˆ†åˆ°ä¸åŒçš„æ•°æ®åº“ä¸­ï¼Œä¸åŒçš„æ•°æ®åº“å¯ä»¥æ”¾åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šã€‚</p>
<p>æ°´å¹³åˆ†åº“çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>è§£å†³äº†å•åº“å¤§æ•°æ®é‡çš„ç“¶é¢ˆé—®é¢˜</li>
<li>IOå†²çªå‡å°‘ï¼Œé”çš„ç«äº‰å‡å°‘ï¼ŒæŸä¸ªæ•°æ®åº“å‡ºç°é—®é¢˜ä¸å½±å“å…¶ä»–æ•°æ®åº“ï¼ˆå¯ç”¨æ€§ï¼‰ï¼Œæé«˜äº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§</li>
</ul>
<p>æ°´å¹³æ‹†åˆ†ï¼ˆåˆ†è¡¨ã€åˆ†åº“ï¼‰çš„ç¼ºç‚¹ï¼š</p>
<ul>
<li>åˆ†ç‰‡äº‹åŠ¡ä¸€è‡´æ€§éš¾ä»¥è§£å†³</li>
<li>è·¨èŠ‚ç‚¹JOINæ€§èƒ½å·®ï¼Œé€»è¾‘ä¼šå˜å¾—å¤æ‚</li>
<li>æ•°æ®æ‰©å±•éš¾åº¦å¤§ï¼Œä¸æ˜“ç»´æŠ¤</li>
</ul>
<p>åœ¨ç³»ç»Ÿè®¾è®¡æ—¶åº”æ ¹æ®ä¸šåŠ¡è€¦åˆæ¥ç¡®å®šå‚ç›´åˆ†åº“å’Œå‚ç›´åˆ†è¡¨çš„æ–¹æ¡ˆï¼Œåœ¨æ•°æ®è®¿é—®å‹åŠ›ä¸æ˜¯ç‰¹åˆ«å¤§æ—¶åº”è€ƒè™‘ç¼“å­˜ã€è¯»å†™åˆ†ç¦»ç­‰æ–¹æ³•ï¼Œè‹¥æ•°æ®é‡å¾ˆå¤§ï¼Œæˆ–æŒç»­å¢é•¿å¯è€ƒè™‘æ°´å¹³åˆ†åº“åˆ†è¡¨ï¼Œæ°´å¹³æ‹†åˆ†æ‰€æ¶‰åŠçš„é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œå¸¸è§çš„æ–¹æ¡ˆæœ‰å®¢æˆ·ç«¯æ¶æ„å’Œä»£ç†æ¶æ„ã€‚</p>
<h3 id="åˆ†åº“åˆ†è¡¨åï¼ŒIDé”®å¦‚ä½•å¤„ç†ï¼Ÿ"><a href="#åˆ†åº“åˆ†è¡¨åï¼ŒIDé”®å¦‚ä½•å¤„ç†ï¼Ÿ" class="headerlink" title="åˆ†åº“åˆ†è¡¨åï¼ŒIDé”®å¦‚ä½•å¤„ç†ï¼Ÿ"></a>åˆ†åº“åˆ†è¡¨åï¼ŒIDé”®å¦‚ä½•å¤„ç†ï¼Ÿ</h3><p>åˆ†åº“åˆ†è¡¨åä¸èƒ½æ¯ä¸ªè¡¨çš„IDéƒ½æ˜¯ä»1å¼€å§‹ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå…¨å±€IDï¼Œè®¾ç½®å…¨å±€IDä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p>
<ul>
<li>UUIDï¼šä¼˜ç‚¹ï¼šæœ¬åœ°ç”ŸæˆIDï¼Œä¸éœ€è¦è¿œç¨‹è°ƒç”¨ï¼›å…¨å±€å”¯ä¸€ä¸é‡å¤ã€‚ç¼ºç‚¹ï¼šå ç”¨ç©ºé—´å¤§ï¼Œä¸é€‚åˆä½œä¸ºç´¢å¼•ã€‚</li>
<li>æ•°æ®åº“è‡ªå¢IDï¼šåœ¨åˆ†åº“åˆ†è¡¨è¡¨åä½¿ç”¨æ•°æ®åº“è‡ªå¢IDï¼Œéœ€è¦ä¸€ä¸ªä¸“é—¨ç”¨äºç”Ÿæˆä¸»é”®çš„åº“ï¼Œæ¯æ¬¡æœåŠ¡æ¥æ”¶åˆ°è¯·æ±‚ï¼Œå…ˆå‘è¿™ä¸ªåº“ä¸­æ’å…¥ä¸€æ¡æ²¡æœ‰æ„ä¹‰çš„æ•°æ®ï¼Œè·å–ä¸€ä¸ªæ•°æ®åº“è‡ªå¢çš„IDï¼Œåˆ©ç”¨è¿™ä¸ªIDå»åˆ†åº“åˆ†è¡¨ä¸­å†™æ•°æ®ã€‚ä¼˜ç‚¹ï¼šç®€å•æ˜“å®ç°ã€‚ç¼ºç‚¹ï¼šåœ¨é«˜å¹¶å‘ä¸‹å­˜åœ¨ç“¶é¢ˆã€‚ç³»ç»Ÿç»“æ„å¦‚ä¸‹å›¾ï¼š</li>
</ul>
<p><img src="/p/ca035920/MySQL-%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8id%E6%96%B9%E6%A1%88.png" alt="å›¾ç‰‡"></p>
<ul>
<li><p>Redisç”ŸæˆIDï¼šä¼˜ç‚¹ï¼šä¸ä¾èµ–æ•°æ®åº“ï¼Œæ€§èƒ½æ¯”è¾ƒå¥½ã€‚ç¼ºç‚¹ï¼šå¼•å…¥æ–°çš„ç»„ä»¶ä¼šä½¿å¾—ç³»ç»Ÿå¤æ‚åº¦å¢åŠ </p>
</li>
<li><p>Twitterçš„snowflakeç®—æ³•ï¼šæ˜¯ä¸€ä¸ª64ä½çš„longå‹çš„IDï¼Œå…¶ä¸­æœ‰1bitæ˜¯ä¸ç”¨çš„ï¼Œ41bitä½œä¸ºæ¯«ç§’æ•°ï¼Œ10bitä½œä¸ºå·¥ä½œæœºå™¨IDï¼Œ12bitä½œä¸ºåºåˆ—å·ã€‚</p>
<p>1bitï¼šç¬¬ä¸€ä¸ªbité»˜è®¤ä¸º0ï¼Œå› ä¸ºäºŒè¿›åˆ¶ä¸­ç¬¬ä¸€ä¸ªbitä¸º1çš„è¯ä¸ºè´Ÿæ•°ï¼Œä½†æ˜¯IDä¸èƒ½ä¸ºè´Ÿæ•°.</p>
<p>41bitï¼šè¡¨ç¤ºçš„æ˜¯æ—¶é—´æˆ³ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</p>
<p>10bitï¼šè®°å½•å·¥ä½œæœºå™¨IDï¼Œå…¶ä¸­5ä¸ªbitè¡¨ç¤ºæœºæˆ¿IDï¼Œ5ä¸ªbitè¡¨ç¤ºæœºå™¨IDã€‚</p>
<p>12bitï¼šç”¨æ¥è®°å½•åŒä¸€æ¯«ç§’å†…äº§ç”Ÿçš„ä¸åŒIDã€‚</p>
</li>
<li><p>ç¾å›¢çš„Leafåˆ†å¸ƒå¼IDç”Ÿæˆç³»ç»Ÿï¼Œç¾å›¢ç‚¹è¯„åˆ†å¸ƒå¼IDç”Ÿæˆç³»ç»Ÿ</p>
</li>
</ul>
<h3 id="MySQLçš„å¤åˆ¶åŸç†åŠæµç¨‹ï¼Ÿå¦‚ä½•å®ç°ä¸»ä»å¤åˆ¶ï¼Ÿ"><a href="#MySQLçš„å¤åˆ¶åŸç†åŠæµç¨‹ï¼Ÿå¦‚ä½•å®ç°ä¸»ä»å¤åˆ¶ï¼Ÿ" class="headerlink" title="MySQLçš„å¤åˆ¶åŸç†åŠæµç¨‹ï¼Ÿå¦‚ä½•å®ç°ä¸»ä»å¤åˆ¶ï¼Ÿ"></a>MySQLçš„å¤åˆ¶åŸç†åŠæµç¨‹ï¼Ÿå¦‚ä½•å®ç°ä¸»ä»å¤åˆ¶ï¼Ÿ</h3><p>MySQLå¤åˆ¶ï¼šä¸ºä¿è¯ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨çš„æ•°æ®ä¸€è‡´æ€§ï¼Œåœ¨å‘ä¸»æœåŠ¡å™¨æ’å…¥æ•°æ®åï¼Œä»æœåŠ¡å™¨ä¼šè‡ªåŠ¨å°†ä¸»æœåŠ¡å™¨ä¸­ä¿®æ”¹çš„æ•°æ®åŒæ­¥è¿‡æ¥ã€‚</p>
<p>ä¸»ä»å¤åˆ¶çš„åŸç†ï¼š</p>
<p>ä¸»ä»å¤åˆ¶ä¸»è¦æœ‰ä¸‰ä¸ªçº¿ç¨‹ï¼šbinlogçº¿ç¨‹ï¼ŒI/Oçº¿ç¨‹ï¼ŒSQLçº¿ç¨‹ã€‚</p>
<ul>
<li>binlogçº¿ç¨‹ï¼šè´Ÿè´£å°†ä¸»æœåŠ¡å™¨ä¸Šçš„æ•°æ®æ›´æ”¹å†™å…¥åˆ°äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBinary logï¼‰ä¸­ã€‚</li>
<li>I/Oçº¿ç¨‹ï¼šè´Ÿè´£ä»ä¸»æœåŠ¡å™¨ä¸Šè¯»å–äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBinary logï¼‰ï¼Œå¹¶å†™å…¥ä»æœåŠ¡å™¨çš„ä¸­ç»§æ—¥å¿—ï¼ˆRelay logï¼‰ä¸­ã€‚</li>
<li>SQLçº¿ç¨‹ï¼šè´Ÿè´£è¯»å–ä¸­ç»§æ—¥å¿—ï¼Œè§£æå‡ºä¸»æœåŠ¡å™¨ä¸­å·²ç»æ‰§è¡Œçš„æ•°æ®æ›´æ”¹å¹¶åœ¨ä»æœåŠ¡å™¨ä¸­é‡æ”¾</li>
</ul>
<p>å¤åˆ¶è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="/p/ca035920/MySQL-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%96%B9%E6%A1%88.png" alt="å›¾ç‰‡"></p>
<ol>
<li>Masteråœ¨æ¯ä¸ªäº‹åŠ¡æ›´æ–°æ•°æ®å®Œæˆä¹‹å‰ï¼Œå°†æ“ä½œè®°å½•å†™å…¥åˆ°binlogä¸­ã€‚</li>
<li>Slaveä»åº“è¿æ¥Masterä¸»åº“ï¼Œå¹¶ä¸”Masteræœ‰å¤šå°‘ä¸ªSlaveå°±ä¼šåˆ›å»ºå¤šå°‘ä¸ªbinlog dumpçº¿ç¨‹ã€‚å½“MasterèŠ‚ç‚¹çš„binlogå‘ç”Ÿå˜åŒ–æ—¶ï¼Œbinlog dumpä¼šé€šçŸ¥æ‰€æœ‰çš„Slaveï¼Œå¹¶å°†ç›¸åº”çš„binlogå‘é€ç»™Slaveã€‚</li>
<li>I/Oçº¿ç¨‹æ¥æ”¶åˆ°binlogå†…å®¹åï¼Œå°†å…¶å†™å…¥åˆ°ä¸­ç»§æ—¥å¿—ï¼ˆRelay logï¼‰ä¸­ã€‚</li>
<li>SQLçº¿ç¨‹è¯»å–ä¸­ç»§æ—¥å¿—ï¼Œå¹¶åœ¨ä»æœåŠ¡å™¨ä¸­é‡æ”¾ã€‚</li>
</ol>
<p>è¿™é‡Œè¡¥å……ä¸€ä¸ªé€šä¿—æ˜“æ‡‚çš„å›¾ã€‚</p>
<p><img src="/p/ca035920/MySQL-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%8E%9F%E7%90%86.png" alt="å›¾ç‰‡"></p>
<p>ä¸»ä»å¤åˆ¶çš„ä½œç”¨ï¼š</p>
<ul>
<li>é«˜å¯ç”¨å’Œæ•…éšœè½¬ç§»</li>
<li>è´Ÿè½½å‡è¡¡</li>
<li>æ•°æ®å¤‡ä»½</li>
<li>å‡çº§æµ‹è¯•</li>
</ul>
<h3 id="äº†è§£è¯»å†™åˆ†ç¦»å—ï¼Ÿ"><a href="#äº†è§£è¯»å†™åˆ†ç¦»å—ï¼Ÿ" class="headerlink" title="äº†è§£è¯»å†™åˆ†ç¦»å—ï¼Ÿ"></a>äº†è§£è¯»å†™åˆ†ç¦»å—ï¼Ÿ</h3><p>è¯»å†™åˆ†ç¦»ä¸»è¦ä¾èµ–äºä¸»ä»å¤åˆ¶ï¼Œä¸»ä»å¤åˆ¶ä¸ºè¯»å†™åˆ†ç¦»æœåŠ¡ã€‚</p>
<p>è¯»å†™åˆ†ç¦»çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>ä¸»æœåŠ¡å™¨è´Ÿè´£å†™ï¼Œä»æœåŠ¡å™¨è´Ÿè´£è¯»ï¼Œç¼“è§£äº†é”çš„ç«äº‰</li>
<li>ä»æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨MyISAMï¼Œæå‡æŸ¥è¯¢æ€§èƒ½åŠèŠ‚çº¦ç³»ç»Ÿå¼€é”€</li>
<li>å¢åŠ å†—ä½™ï¼Œæé«˜å¯ç”¨æ€§</li>
</ul>
</body></html>]]></content>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Python Asyncio</title>
    <url>/p/28e3b42f.html</url>
    <content><![CDATA[<html><head></head><body><blockquote>
<p>Pythonç‰ˆæœ¬ï¼š3.9</p>
<p>åç¨‹ï¼ˆCoroutineï¼‰æ˜¯ä¸€ç§è½»é‡çº§çš„çº¿ç¨‹ï¼Œç”±ç”¨æˆ·æ§åˆ¶è°ƒåº¦ï¼Œå¯ä»¥åœ¨å•çº¿ç¨‹å†…å®ç°å¹¶å‘ã€‚ä¸çº¿ç¨‹ç›¸æ¯”ï¼Œåç¨‹çš„åˆ‡æ¢å¼€é”€æ›´å°ï¼Œæ›´é€‚åˆå¤„ç† I/O å¯†é›†å‹ä»»åŠ¡ã€‚<code>asyncio</code> æä¾›äº†äº‹ä»¶å¾ªç¯ã€ä»»åŠ¡ã€Future ç­‰æœºåˆ¶ï¼Œæ–¹ä¾¿å¼€å‘è€…ç¼–å†™å¼‚æ­¥ä»£ç ã€‚</p>
</blockquote>
<p>ä»å®é™…æ¡ˆä¾‹å­¦ä¹ å…¥æ‰‹ï¼Œå¼•ç”¨ä¸€ä¸ª<a href="https://docs.python.org/3/library/asyncio.html">å®˜æ–¹çš„ç¤ºä¾‹</a>ï¼Œæ›´å¤š<a href="https://github.com/python/asyncio/tree/master/examples">asyncioç¤ºä¾‹ç›´é€šè½¦</a>ã€‚</p>
<h2 id="äº‹ä»¶å¾ªç¯"><a href="#äº‹ä»¶å¾ªç¯" class="headerlink" title="äº‹ä»¶å¾ªç¯"></a>äº‹ä»¶å¾ªç¯</h2><p>äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰æ˜¯ <code>asyncio</code> çš„æ ¸å¿ƒï¼Œè´Ÿè´£è°ƒåº¦å’Œæ‰§è¡Œåç¨‹ã€‚Python 3.9 æ¨èä½¿ç”¨ <code>asyncio.run()</code> æ¥è¿è¡Œåç¨‹ï¼Œå®ƒä¼šè‡ªåŠ¨ç®¡ç†äº‹ä»¶å¾ªç¯ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'Hello ...'</span>)</span><br><span class="line">    <span class="comment"># æ¨¡æ‹ŸIOæ“ä½œ</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'... World!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ asyncio.run() è¿è¡Œåç¨‹</span></span><br><span class="line">asyncio.run(main()) </span><br></pre></td></tr></tbody></table></figure>

<h2 id="åç¨‹å‡½æ•°"><a href="#åç¨‹å‡½æ•°" class="headerlink" title="åç¨‹å‡½æ•°"></a>åç¨‹å‡½æ•°</h2><p>ä½¿ç”¨ <code>async def</code> å®šä¹‰çš„å‡½æ•°æ˜¯åç¨‹å‡½æ•°ã€‚åç¨‹å‡½æ•°å†…éƒ¨å¯ä»¥ä½¿ç”¨ <code>await</code> å…³é”®å­—æ¥ç­‰å¾…å…¶ä»–åç¨‹æˆ–å¼‚æ­¥æ“ä½œå®Œæˆã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fetch_data</span>():</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Data fetched"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    data = <span class="keyword">await</span> fetch_data()</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></tbody></table></figure>

<h2 id="åç¨‹ä»»åŠ¡-Task"><a href="#åç¨‹ä»»åŠ¡-Task" class="headerlink" title="åç¨‹ä»»åŠ¡(Task)"></a>åç¨‹ä»»åŠ¡(Task)</h2><p>ä»»åŠ¡(Task)æ˜¯å¯¹åç¨‹çš„è¿›ä¸€æ­¥å°è£…ï¼Œé€šè¿‡ <code>asyncio.create_task</code>åˆ›å»ºä»»åŠ¡ï¼Œå¯ä»¥ç”¨äºå¹¶å‘æ‰§è¡Œå¤šä¸ªåç¨‹ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fetch_data</span>():</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Data fetched"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">task1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'Task 1 started'</span>)</span><br><span class="line">    res = <span class="keyword">await</span> fetch_data()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'Task 1 finished <span class="subst">{res}</span>'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">task2</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'Task 2 started'</span>)</span><br><span class="line">    res = <span class="keyword">await</span> fetch_data()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'Task 2 finished <span class="subst">{res}</span>'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    t1 = asyncio.create_task(task1(), name=<span class="string">'1'</span>)</span><br><span class="line">    t2 = asyncio.create_task(task2(), name=<span class="string">'2'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> t1</span><br><span class="line">    <span class="keyword">await</span> t2</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></tbody></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">ç«‹å³æ‰“å°å‡ºï¼š</span><br><span class="line">    Task 1 started</span><br><span class="line">    Task 2 started</span><br><span class="line">ä¸¤ç§’åæ‰“å°å‡ºï¼š</span><br><span class="line">	Task 1 finished Data fetched</span><br><span class="line">	Task 2 finished Data fetched</span><br></pre></td></tr></tbody></table></figure>

<h2 id="ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆ"><a href="#ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆ" class="headerlink" title="ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆ"></a>ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆ</h2><p><code>asyncio.wait()</code> å¯ä»¥ç­‰å¾…å¤šä¸ªä»»åŠ¡å…¨éƒ¨å®Œæˆï¼Œè¿™äº›ä»»åŠ¡å¯èƒ½è¿˜åœ¨è¿è¡Œä¸­ï¼Œæˆ–è€…å› ä¸ºæŸäº›åŸå› ï¼ˆå¦‚è¢«å–æ¶ˆï¼‰è€Œæœªå®Œæˆã€‚waitæ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå…ƒç»„ï¼š(done,pending)ï¼Œdoneå’Œpendingæ˜¯ä¸¤ä¸ªSeté›†åˆï¼š</p>
<ul>
<li><code>done</code>ï¼šæ‰€æœ‰å·²ç»å®Œæˆçš„ä»»åŠ¡ã€‚</li>
<li><code>pending</code>ï¼šæ‰€æœ‰å°šæœªå®Œæˆçš„ä»»åŠ¡ã€‚</li>
</ul>
<p>ä¸‹æ–¹ç¤ºä¾‹åŒ…å«äº†å¯èƒ½é‡è§çš„ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>å¤„ç†å·²å®Œæˆçš„ä»»åŠ¡ï¼Œè·å–ç»“æœå¤„ç†å¼‚å¸¸ï¼›</li>
<li>å¤„ç†æœªå®Œæˆçš„ä»»åŠ¡ï¼Œå–æ¶ˆä»»åŠ¡ï¼›</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">name, delay</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"Task <span class="subst">{name}</span> started"</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(delay)</span><br><span class="line">    <span class="keyword">if</span> name == <span class="string">'C'</span>:</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">f'Task <span class="subst">{name}</span> failed'</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"Task <span class="subst">{name}</span> completed"</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Data fetched'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    task1 = asyncio.create_task(task(<span class="string">"A"</span>, <span class="number">2</span>), name=<span class="string">'A'</span>) <span class="comment"># æ­£å¸¸ç»“æŸï¼Œè·å–ç»“æœ</span></span><br><span class="line">    task2 = asyncio.create_task(task(<span class="string">"B"</span>, <span class="number">5</span>), name=<span class="string">'B'</span>) <span class="comment"># è¶…æ—¶ï¼Œå–æ¶ˆ</span></span><br><span class="line">    task3 = asyncio.create_task(task(<span class="string">"C"</span>, <span class="number">1</span>), name=<span class="string">'C'</span>) <span class="comment"># æŠ¥é”™</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä½¿ç”¨ asyncio.wait ç­‰å¾…ä¸¤ä¸ªä»»åŠ¡å®Œæˆï¼Œè¶…æ—¶æ—¶é—´ä¸º 3 ç§’ï¼Œè®©Bè¶…æ—¶</span></span><br><span class="line">    done, pending = <span class="keyword">await</span> asyncio.wait([task1, task2, task3], timeout=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰“å°å®Œæˆçš„ä»»åŠ¡</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> done:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"Task <span class="subst">{t.get_name()}</span> done,result is <span class="subst">{t.result()}</span>"</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"Task <span class="subst">{t.get_name()}</span> raised an exception: <span class="subst">{e}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¤„ç†æœªå®Œæˆçš„ä»»åŠ¡</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> pending:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"Task <span class="subst">{t.get_name()}</span> is still pending"</span>)</span><br><span class="line">        <span class="comment"># é€‰æ‹©å–æ¶ˆæœªå®Œæˆçš„ä»»åŠ¡</span></span><br><span class="line">        t.cancel()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"Task <span class="subst">{t.get_name()}</span> has been cancelled"</span>)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></tbody></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">Task A started</span><br><span class="line">Task B started</span><br><span class="line">Task C started</span><br><span class="line">Task A completed</span><br><span class="line">Task C raised an exception: Task C failed</span><br><span class="line">Task A done,result is Data fetched</span><br><span class="line">Task B is still pending</span><br><span class="line">Task B has been cancelled</span><br></pre></td></tr></tbody></table></figure>

<h2 id="å¤šåç¨‹å¹¶å‘æ‰§è¡Œ"><a href="#å¤šåç¨‹å¹¶å‘æ‰§è¡Œ" class="headerlink" title="å¤šåç¨‹å¹¶å‘æ‰§è¡Œ"></a>å¤šåç¨‹å¹¶å‘æ‰§è¡Œ</h2><p><code>asyncio.gather()</code> å¯ä»¥å¹¶å‘æ‰§è¡Œå¤šä¸ªåç¨‹ï¼Œå¹¶ç­‰å¾…å®ƒä»¬å…¨éƒ¨å®Œæˆã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fetch_data</span>(<span class="params">name</span>): <span class="comment"># æ ¹æ®å…¥å‚åŒºåˆ†ä»»åŠ¡</span></span><br><span class="line">    sec = random.randint(<span class="number">1</span>, <span class="number">10</span>) <span class="comment"># ç”Ÿæˆ1-10séšæœºç­‰å¾…æ—¶é—´</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'<span class="subst">{name}</span> wait sec <span class="subst">{sec}</span>'</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(sec)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f"fetched <span class="subst">{name}</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    results = <span class="keyword">await</span> asyncio.gather(</span><br><span class="line">        fetch_data(<span class="number">1</span>),</span><br><span class="line">        fetch_data(<span class="number">2</span>),</span><br><span class="line">        fetch_data(<span class="number">3</span>)</span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(results)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></tbody></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">ç«‹å³æ‰“å°å‡ºï¼š</span><br><span class="line">    1 wait sec 3</span><br><span class="line">    2 wait sec 5</span><br><span class="line">    3 wait sec 1</span><br><span class="line">ç­‰å¾…ç¨è®¸æ‰“å°å‡ºï¼š</span><br><span class="line">    ['fetched 1', 'fetched 2', 'fetched 3']</span><br></pre></td></tr></tbody></table></figure>

<p>ä»ç»“æœä¸Šçœ‹ï¼Œå¤šä¸ªä»»åŠ¡çš„æ‰§è¡Œç»“æœæ˜¯æŒ‰ä»»åŠ¡é¡ºåºå­˜æ”¾çš„ã€‚</p>
<h2 id="æ‰§è¡Œä»»åŠ¡è¶…æ—¶æ§åˆ¶"><a href="#æ‰§è¡Œä»»åŠ¡è¶…æ—¶æ§åˆ¶" class="headerlink" title="æ‰§è¡Œä»»åŠ¡è¶…æ—¶æ§åˆ¶"></a>æ‰§è¡Œä»»åŠ¡è¶…æ—¶æ§åˆ¶</h2><p><code>asyncio.wait_for()</code> å¯ä»¥ä¸ºåç¨‹è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fetch_data</span>():</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Data fetched"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># æ­£å¸¸æƒ…å†µ timeout&gt;2</span></span><br><span class="line">        <span class="comment"># è¶…æ—¶æƒ…å†µ timeout&lt;=2</span></span><br><span class="line">        result = <span class="keyword">await</span> asyncio.wait_for(fetch_data(), <span class="number">1</span>)  </span><br><span class="line">        <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="keyword">except</span> asyncio.TimeoutError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Timeout!"</span>)</span><br><span class="line">    <span class="keyword">except</span> asyncio.CancelledError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Cancelled!"</span>)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></tbody></table></figure>

<h2 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h2><p><code>asyncio.Queue</code> å¯ä»¥ç”¨äºåç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">producer</span>(<span class="params">queue</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="keyword">await</span> queue.put(i)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f'produced: <span class="subst">{i}</span>'</span>)</span><br><span class="line">        <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">consumer</span>(<span class="params">queue</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        item = <span class="keyword">await</span> queue.get()   <span class="comment"># æŒç»­æ¶ˆè´¹</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f'consumed: <span class="subst">{item}</span>'</span>)</span><br><span class="line">        <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)  <span class="comment"># æ¨¡æ‹Ÿæ¶ˆè´¹å»¶è¿Ÿ</span></span><br><span class="line">        queue.task_done() <span class="comment"># é€šçŸ¥é˜Ÿåˆ—å·²å®Œæˆï¼Œé¿å…join()ä¸€ç›´é˜»å¡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    queue = asyncio.Queue()</span><br><span class="line">    produce_task = asyncio.create_task(producer(queue))</span><br><span class="line">    consume_task = asyncio.create_task(consumer(queue))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> produce_task    <span class="comment"># ç­‰å¾…ç”Ÿäº§ä»»åŠ¡å®Œæˆ</span></span><br><span class="line">    <span class="keyword">await</span> queue.join()    <span class="comment"># ç­‰å¾…é˜Ÿåˆ—æ¸…ç©º</span></span><br><span class="line">    consume_task.cancel() <span class="comment"># å–æ¶ˆæ­»å¾ªç¯çš„æ¶ˆè´¹ä»»åŠ¡ï¼Œé€€å‡ºç¨‹åº</span></span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>ä¸ºä»€ä¹ˆéœ€è¦ <code>queue.task_done()</code>ï¼Ÿ</p>
<ol>
<li>ä»»åŠ¡å®Œæˆçš„é€šçŸ¥æœºåˆ¶ï¼š<ul>
<li>å½“ä½ ä»é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªä»»åŠ¡ï¼ˆä½¿ç”¨ <code>queue.get()</code>ï¼‰å¹¶å¤„ç†å®Œè¯¥ä»»åŠ¡åï¼Œéœ€è¦è°ƒç”¨ <code>queue.task_done()</code> æ¥å‘Šè¯‰é˜Ÿåˆ—ï¼šâ€œè¿™ä¸ªä»»åŠ¡å·²ç»å¤„ç†å®Œæ¯•â€ã€‚</li>
<li>å¦‚æœæ²¡æœ‰è°ƒç”¨ <code>queue.task_done()</code>ï¼Œé˜Ÿåˆ—ä¼šè®¤ä¸ºä»»åŠ¡ä»åœ¨å¤„ç†ä¸­ï¼Œ<code>queue.join()</code> ä¼šä¸€ç›´é˜»å¡ï¼Œç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆã€‚</li>
</ul>
</li>
<li>ä¸ <code>queue.join()</code> é…åˆä½¿ç”¨ï¼š<ul>
<li><code>queue.join()</code> ä¼šé˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ä»»åŠ¡éƒ½è¢«å¤„ç†å®Œæ¯•ï¼ˆå³æ¯ä¸ª <code>queue.get()</code> éƒ½å¯¹åº”äº†ä¸€ä¸ª <code>queue.task_done()</code>ï¼‰ã€‚</li>
<li>è¿™ç§æœºåˆ¶éå¸¸é€‚åˆç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼Œç¡®ä¿æ‰€æœ‰ä»»åŠ¡éƒ½è¢«æ¶ˆè´¹è€…å¤„ç†å®Œæ¯•åå†ç»“æŸç¨‹åºã€‚</li>
</ul>
</li>
</ol>
</blockquote>
<h2 id="ä¿¡å·é‡"><a href="#ä¿¡å·é‡" class="headerlink" title="ä¿¡å·é‡"></a>ä¿¡å·é‡</h2><p><code>asyncio.Semaphore</code> å¯ä»¥ç”¨äºé™åˆ¶å¹¶å‘æ•°é‡ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">worker</span>(<span class="params">semaphore, <span class="built_in">id</span></span>):</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> semaphore:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"Worker <span class="subst">{<span class="built_in">id</span>}</span> started"</span>)</span><br><span class="line">        <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"Worker <span class="subst">{<span class="built_in">id</span>}</span> finished"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    semaphore = asyncio.Semaphore(<span class="number">2</span>)  <span class="comment"># é™åˆ¶å¹¶å‘æ•°ä¸º 2</span></span><br><span class="line">    tasks = [worker(semaphore, i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line">    <span class="keyword">await</span> asyncio.gather(*tasks)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></tbody></table></figure>

<h2 id="to-thread"><a href="#to-thread" class="headerlink" title="to_thread"></a>to_thread</h2><p><code>asyncio.to_thread</code> æ˜¯ Python 3.9 å¼•å…¥çš„ä¸€ä¸ªæ–°å‡½æ•°ï¼Œç”¨äºå°†åŒæ­¥é˜»å¡å‡½æ•°æ”¾åˆ°å•ç‹¬çš„çº¿ç¨‹ä¸­è¿è¡Œï¼Œé¿å…é˜»å¡äº‹ä»¶å¾ªç¯ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">blocking_io</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Blocking IO started"</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)  <span class="comment"># æ¨¡æ‹Ÿé˜»å¡æ“ä½œ</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Blocking IO finished"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Main started"</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.to_thread(blocking_io)  <span class="comment"># åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­è¿è¡Œ</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Main finished"</span>)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></tbody></table></figure>

</body></html>]]></content>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonè¿›ç¨‹ çº¿ç¨‹ åç¨‹</title>
    <url>/p/f8dac049.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="GIL-Global-Interpreter-Lock"><a href="#GIL-Global-Interpreter-Lock" class="headerlink" title="GIL(Global Interpreter Lock)"></a>GIL(Global Interpreter Lock)</h2><p>GILæ˜¯Pythonè§£é‡Šå™¨ä¸­ä¸€ä¸ªå…¨å±€æ€§çš„äº’æ–¥é”ã€‚åœ¨ä»»æ„æ—¶åˆ»ï¼ŒGILåªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒPythonå­—èŠ‚ç ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿ä½ çš„ç¨‹åºæœ‰å¤šä¸ªçº¿ç¨‹ï¼ŒåŒæ—¶è¿è¡Œåœ¨å¤šæ ¸CPUä¸Šï¼ŒGILä¹Ÿä¼šç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡ŒPythonä»£ç ã€‚</p>
</blockquote>
<p>åœ¨Pythonçš„æ—©æœŸè®¾è®¡ä¸­ï¼Œå¼•å…¥GILä¸»è¦æ˜¯ä¸ºäº†<strong>ç®€åŒ–è§£é‡Šå™¨çš„å®ç°</strong>å’Œ<strong>å†…å­˜ç®¡ç†</strong>ã€‚é€šè¿‡GILï¼ŒPythonè§£é‡Šå™¨æ— éœ€ä¸ºæ•°æ®ç»“æ„è®¿é—®åŠ é”ï¼Œå¤§å¤§ç®€åŒ–äº†å†…å­˜ç®¡ç†çš„å¤æ‚åº¦ã€‚</p>
<p>è®¸å¤š Python åº“æ˜¯ç”¨ C è¯­è¨€ç¼–å†™çš„æ‰©å±•æ¨¡å—ã€‚è¿™äº›æ‰©å±•æ¨¡å—åœ¨è®¾è®¡æ—¶å‡è®¾äº† GIL çš„å­˜åœ¨ï¼Œä»è€Œç®€åŒ–äº†çº¿ç¨‹å®‰å…¨çš„å®ç°ã€‚å¦‚æœæ²¡æœ‰ GILï¼ŒC æ‰©å±•æ¨¡å—éœ€è¦è‡ªå·±å¤„ç†çº¿ç¨‹åŒæ­¥ï¼Œè¿™ä¼šå¢åŠ å¼€å‘çš„å¤æ‚æ€§å’Œå‡ºé”™çš„é£é™©ã€‚</p>
<h2 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h2><p>ç”±äºGILçš„å­˜åœ¨ï¼Œæ— æ³•å®ç°çœŸæ­£æ„ä¹‰ä¸Šçš„å¤šçº¿ç¨‹ï¼ˆå¤šæ ¸CPUï¼‰ã€‚æ‰¾äº†ä¸€ä¸ªç¤ºä¾‹æ¥è¯´æ˜ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gcd</span>(<span class="params">pair</span>):</span><br><span class="line">    a, b = pair</span><br><span class="line">    low = <span class="built_in">min</span>(a, b)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(low, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> a % i == <span class="number">0</span> <span class="keyword">and</span> b % i == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> <span class="literal">False</span>, <span class="string">"Not reachable"</span></span><br><span class="line"></span><br><span class="line">NUMBERS = [</span><br><span class="line">    (<span class="number">1963309</span>, <span class="number">2265973</span>), (<span class="number">5948475</span>, <span class="number">2734765</span>),</span><br><span class="line">    (<span class="number">1876435</span>, <span class="number">4765849</span>), (<span class="number">7654637</span>, <span class="number">3458496</span>),</span><br><span class="line">    (<span class="number">1823712</span>, <span class="number">1924928</span>), (<span class="number">2387454</span>, <span class="number">5873948</span>),</span><br><span class="line">    (<span class="number">1239876</span>, <span class="number">2987473</span>), (<span class="number">3487248</span>, <span class="number">2098437</span>),</span><br><span class="line">    (<span class="number">1963309</span>, <span class="number">2265973</span>), (<span class="number">5948475</span>, <span class="number">2734765</span>),</span><br><span class="line">    (<span class="number">1876435</span>, <span class="number">4765849</span>), (<span class="number">7654637</span>, <span class="number">3458496</span>),</span><br><span class="line">    (<span class="number">1823712</span>, <span class="number">1924928</span>), (<span class="number">2387454</span>, <span class="number">5873948</span>),</span><br><span class="line">    (<span class="number">1239876</span>, <span class="number">2987473</span>), (<span class="number">3487248</span>, <span class="number">2098437</span>),</span><br><span class="line">    (<span class="number">3498747</span>, <span class="number">4563758</span>), (<span class="number">1298737</span>, <span class="number">2129874</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    start = time.time()</span><br><span class="line">    <span class="built_in">list</span>(<span class="built_in">map</span>(gcd, NUMBERS))</span><br><span class="line">    end = time.time()</span><br><span class="line">    delta = end - start</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'å•çº¿ç¨‹é¡ºåºæ‰§è¡Œæ—¶é—´: <span class="subst">{delta:<span class="number">.3</span>f}</span> ç§’'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>å•çº¿ç¨‹é¡ºåºæ‰§è¡Œæ—¶é—´ï¼š<code>2.313</code> ç§’ã€‚</p>
<p>å°è¯•ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œä¼˜åŒ–ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">pool = ThreadPoolExecutor(max_workers=<span class="number">4</span>)</span><br><span class="line">results = <span class="built_in">list</span>(pool.<span class="built_in">map</span>(gcd, NUMBERS))</span><br><span class="line">end = time.time()</span><br><span class="line">delta = end - start</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'å¤šçº¿ç¨‹æ‰§è¡Œæ—¶é—´: <span class="subst">{delta:<span class="number">.3</span>f}</span> ç§’'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>å¤šçº¿ç¨‹æ‰§è¡Œæ—¶é—´ï¼š<code>2.285 </code>ç§’ã€‚ä½¿ç”¨å¤šçº¿ç¨‹å¹¶æœªæœ‰æ•ˆå‡å°‘æ‰§è¡Œè€—æ—¶ã€‚</p>
<p>åœ¨<strong>CPUå¯†é›†å‹ä»»åŠ¡</strong>ä¸­ï¼Œå¤šçº¿ç¨‹å¹¶è¡Œæ•ˆæœä¸ä½³ã€‚å°½ç®¡GILé™åˆ¶äº†å¤šçº¿ç¨‹åœ¨CPUå¯†é›†åœºæ™¯ä¸‹çš„è¡¨ç°ï¼Œä½†Pythonåœ¨å•çº¿ç¨‹æ¨¡å¼ä¸‹ä»ç„¶è¡¨ç°å‡ºè‰²ï¼Œå¯¹äºè®¸å¤šåº”ç”¨æ¥è¯´ï¼Œå•çº¿ç¨‹å·²è¶³å¤Ÿæ»¡è¶³éœ€æ±‚ã€‚</p>
<p>åœ¨Pythonä¸­ï¼Œå¤šçº¿ç¨‹æ›´é€‚ç”¨äº<strong>I/Oå¯†é›†å‹ä»»åŠ¡</strong>ï¼Œå¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œè¯·æ±‚ç­‰ï¼Œåœ¨çº¿ç¨‹ç­‰å¾…I/Oæ—¶ï¼Œä¼šé‡Šæ”¾GILï¼Œå…¶å®ƒçº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œä»»åŠ¡ã€‚</p>
<p>å¦‚æœå°è¯•ä½¿ç”¨å¤šè¿›ç¨‹æ¥è¿›è¡Œä¼˜åŒ–ï¼Œä¼šæœ‰æ•ˆæœå—ï¼Ÿ</p>
<h2 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h2><p>å°è¯•ä½¿ç”¨å¤šè¿›ç¨‹è¿›è¡Œä¼˜åŒ–ï¼Œå°†å¤šçº¿æ±  <code>ThreadPoolExecutor </code> æ¢æˆ <code>ProcessPoolExecutor</code>ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ProcessPoolExecutor</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">pool = ProcessPoolExecutor(max_workers=<span class="number">4</span>)</span><br><span class="line">results = <span class="built_in">list</span>(pool.<span class="built_in">map</span>(gcd, NUMBERS))</span><br><span class="line">end = time.time()</span><br><span class="line">delta = end - start</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'å¤šè¿›ç¨‹æ‰§è¡Œæ—¶é—´: <span class="subst">{delta:<span class="number">.3</span>f}</span> ç§’'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>å¤šè¿›ç¨‹æ‰§è¡Œæ—¶é—´ï¼š<code>0.978 </code>ç§’ã€‚æ•ˆæœå¾ˆæ˜æ˜¾ï¼Œæ‰§è¡Œæ—¶é—´æå‡äº†è¿‘2.5å€ã€‚</p>
<p>åœ¨<strong>CPUå¯†é›†å‹ä»»åŠ¡</strong>ä¸­ï¼Œå¯ä»¥åˆ›å»ºå¤šä¸ªè¿›ç¨‹æ‰§è¡Œï¼Œæ¯ä¸ªè¿›ç¨‹æœ‰<strong>ç‹¬ç«‹çš„</strong>è§£é‡Šå™¨å’ŒGILå®ä¾‹ï¼Œå¹¶ä¸”å¯ä»¥ç‹¬ç«‹è¿è¡Œåœ¨ä¸åŒçš„CPUæ ¸å¿ƒä¸Šï¼Œä»è€Œå®ç°å¹¶è¡Œè®¡ç®—ã€‚</p>
<p>åœ¨Pythonä¸­ï¼Œå¤šè¿›ç¨‹æ›´é€‚ç”¨äº<strong>CPUå¯†é›†å‹ä»»åŠ¡</strong>å¹¶ä¸”<strong>æ•°æ®å…³è”æ€§ä½</strong>çš„åœºæ™¯ã€‚æ•°æ®å…³è”æ€§é«˜ä¼šå¯¼è‡´è¿›ç¨‹é—´é¢‘ç¹é€šä¿¡ï¼Œå¯¼è‡´æ€§èƒ½é™ä½ã€‚</p>
<p>é‚£ä¹ˆä½¿ç”¨åç¨‹ä¼šæœ‰æ•ˆæœå—ï¼Ÿ</p>
<h2 id="åç¨‹"><a href="#åç¨‹" class="headerlink" title="åç¨‹"></a>åç¨‹</h2><p>å°è¯•ä½¿ç”¨å¤šåç¨‹è¿›è¡Œä¼˜åŒ–ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">gcd</span>(<span class="params">pair</span>):</span><br><span class="line">    a, b = pair</span><br><span class="line">    low = <span class="built_in">min</span>(a, b)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(low, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> a % i == <span class="number">0</span> <span class="keyword">and</span> b % i == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> <span class="literal">False</span>, <span class="string">"Not reachable"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    tasks = [gcd(pair) <span class="keyword">for</span> pair <span class="keyword">in</span> NUMBERS]</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> asyncio.gather(*tasks)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    start = time.time()</span><br><span class="line">    results = asyncio.run(main())</span><br><span class="line">    end = time.time()</span><br><span class="line">    delta = end - start</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'åç¨‹å¹¶å‘æ‰§è¡Œæ—¶é—´ï¼š<span class="subst">{delta:<span class="number">.3</span>f}</span> ç§’'</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>åç¨‹å¹¶å‘æ‰§è¡Œæ—¶é—´ï¼š<code>2.389 </code>ç§’ã€‚æ•ˆç‡å¹¶æœªæå‡ã€‚</p>
<p>åç¨‹ä¸»è¦é€‚ç”¨äº <strong>I/O å¯†é›†å‹ä»»åŠ¡</strong>ï¼ŒI/Oç­‰å¾…æ—¶æ— éœ€æŒæœ‰GILï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>ç½‘ç»œè¯·æ±‚ï¼ˆå¦‚ä½¿ç”¨ <code>aiohttp</code> æ›¿ä»£ <code>requests</code>ï¼‰ã€‚</li>
<li>æ–‡ä»¶è¯»å†™æ“ä½œã€‚</li>
<li>æ•°æ®åº“æŸ¥è¯¢ç­‰ã€‚</li>
</ul>
<p>åœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œåç¨‹å¯ä»¥é€šè¿‡å¼‚æ­¥æ“ä½œå……åˆ†åˆ©ç”¨ I/O ç­‰å¾…æ—¶é—´ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚</p>
<h2 id="å¤šçº¿ç¨‹å’Œåç¨‹ä¹‹é—´çš„åŒºåˆ«"><a href="#å¤šçº¿ç¨‹å’Œåç¨‹ä¹‹é—´çš„åŒºåˆ«" class="headerlink" title="å¤šçº¿ç¨‹å’Œåç¨‹ä¹‹é—´çš„åŒºåˆ«"></a>å¤šçº¿ç¨‹å’Œåç¨‹ä¹‹é—´çš„åŒºåˆ«</h2><ul>
<li><p>çº¿ç¨‹çš„åˆ‡æ¢æ˜¯ç”±æ“ä½œç³»ç»Ÿå†³å®šçš„ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ I/O æ“ä½œæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†è¯¥çº¿ç¨‹æŒ‚èµ·ï¼Œåˆ‡æ¢åˆ°å…¶ä»–çº¿ç¨‹æ‰§è¡Œã€‚</p>
</li>
<li><p>åç¨‹çš„åˆ‡æ¢æ˜¯ç”±ç¨‹åºå‘˜é€šè¿‡ä»£ç æ§åˆ¶çš„ï¼Œå½“ä¸€ä¸ªåç¨‹æ‰§è¡Œ I/O æ“ä½œæ—¶ï¼Œä¼šä¸»åŠ¨è®©å‡ºæ§åˆ¶æƒï¼Œè®©å…¶ä»–åç¨‹è¿è¡Œã€‚</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">ç‰¹æ€§</th>
<th align="left">å¤šçº¿ç¨‹</th>
<th align="left">åç¨‹</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>å®ç°åŸç†</strong></td>
<td align="left">ç”±æ“ä½œç³»ç»Ÿè°ƒåº¦ï¼Œçº¿ç¨‹åˆ‡æ¢ç”±æ“ä½œç³»ç»Ÿæ§åˆ¶</td>
<td align="left">ç”±ç”¨æˆ·æ€è°ƒåº¦ï¼Œé€šè¿‡äº‹ä»¶å¾ªç¯å’Œ <code>async/await</code> å®ç°</td>
</tr>
<tr>
<td align="left"><strong>èµ„æºæ¶ˆè€—</strong></td>
<td align="left">æ¯ä¸ªçº¿ç¨‹éœ€è¦ç‹¬ç«‹çš„æ ˆç©ºé—´ï¼Œèµ„æºæ¶ˆè€—è¾ƒå¤§</td>
<td align="left">åç¨‹å…±äº«ä¸€ä¸ªçº¿ç¨‹çš„æ ˆç©ºé—´ï¼Œèµ„æºæ¶ˆè€—æå°</td>
</tr>
<tr>
<td align="left"><strong>æ‰§è¡Œæ•ˆç‡</strong></td>
<td align="left">å— GIL é™åˆ¶ï¼Œå•çº¿ç¨‹æ‰§è¡Œ</td>
<td align="left">å•çº¿ç¨‹æ‰§è¡Œï¼Œä½†åˆ‡æ¢å¼€é”€å°ï¼Œé€‚åˆé«˜å¹¶å‘</td>
</tr>
<tr>
<td align="left"><strong>æ•°æ®å…±äº«</strong></td>
<td align="left">çº¿ç¨‹é—´å…±äº«æ•°æ®ï¼Œéœ€è¦é”æœºåˆ¶é˜²æ­¢ç«äº‰æ¡ä»¶</td>
<td align="left">æ•°æ®å…±äº«å®¹æ˜“ï¼Œä½†éœ€æ³¨æ„ç«äº‰æ¡ä»¶</td>
</tr>
<tr>
<td align="left"><strong>é€‚ç”¨åœºæ™¯</strong></td>
<td align="left">I/O å¯†é›†å‹ä»»åŠ¡ï¼Œå¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œè¯·æ±‚</td>
<td align="left">é«˜å¹¶å‘ I/O å¯†é›†å‹ä»»åŠ¡ï¼Œå¦‚ç½‘ç»œçˆ¬è™«ã€Web æœåŠ¡å™¨</td>
</tr>
<tr>
<td align="left"><strong>ç¼–ç¨‹å¤æ‚åº¦</strong></td>
<td align="left">éœ€è¦è€ƒè™‘çº¿ç¨‹åŒæ­¥ã€é”ç«äº‰ç­‰é—®é¢˜</td>
<td align="left">ç¼–ç¨‹æ¨¡å‹ç®€æ´ï¼Œé€šè¿‡ <code>async/await</code> å®ç°</td>
</tr>
</tbody></table>
</body></html>]]></content>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Python Elasticsearch</title>
    <url>/p/2288491f.html</url>
    <content><![CDATA[<html><head></head><body><p>å¾…æ›´æ–°â€¦</p>
</body></html>]]></content>
      <tags>
        <tag>Elasticsearch</tag>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Py3 å­—ç¬¦ä¸²</title>
    <url>/p/5b400b08.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="å­—ç¬¦ä¸²æŸ¥æ‰¾å’Œå®šä½"><a href="#å­—ç¬¦ä¸²æŸ¥æ‰¾å’Œå®šä½" class="headerlink" title="å­—ç¬¦ä¸²æŸ¥æ‰¾å’Œå®šä½"></a>å­—ç¬¦ä¸²æŸ¥æ‰¾å’Œå®šä½</h2><h3 id="str-find-sub-start-end"><a href="#str-find-sub-start-end" class="headerlink" title="str.find(sub[, start[, end]])"></a><code>str.find(sub[, start[, end]])</code></h3><p>è¯­æ³•ï¼š</p>
<ul>
<li><code>sub</code>ï¼šè¦æŸ¥æ‰¾çš„å­å­—ç¬¦ä¸²ã€‚</li>
<li><code>start</code>ï¼ˆå¯é€‰ï¼‰ï¼šå¼€å§‹æŸ¥æ‰¾çš„èµ·å§‹ç´¢å¼•ï¼Œé»˜è®¤ä¸º 0ã€‚</li>
<li><code>end</code>ï¼ˆå¯é€‰ï¼‰ï¼šç»“æŸæŸ¥æ‰¾çš„ç»“æŸç´¢å¼•ï¼Œé»˜è®¤ä¸ºå­—ç¬¦ä¸²çš„é•¿åº¦ã€‚</li>
</ul>
<p>è¿”å›å€¼ï¼š</p>
<ul>
<li>å¦‚æœæ‰¾åˆ°å­å­—ç¬¦ä¸²ï¼Œè¿”å›å­å­—ç¬¦ä¸²åœ¨å­—ç¬¦ä¸²ä¸­é¦–æ¬¡å‡ºç°çš„ç´¢å¼•å€¼ã€‚</li>
<li>å¦‚æœæ²¡æœ‰æ‰¾åˆ°å­å­—ç¬¦ä¸²ï¼Œè¿”å› <code>-1</code>ã€‚</li>
</ul>
<h4 id="ç¤ºä¾‹-1ï¼šåŸºæœ¬ç”¨æ³•"><a href="#ç¤ºä¾‹-1ï¼šåŸºæœ¬ç”¨æ³•" class="headerlink" title="ç¤ºä¾‹ 1ï¼šåŸºæœ¬ç”¨æ³•"></a>ç¤ºä¾‹ 1ï¼šåŸºæœ¬ç”¨æ³•</h4><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>world</code> æ˜¯å­å­—ç¬¦ä¸²ï¼Œå®ƒåœ¨ <code>text</code> ä¸­é¦–æ¬¡å‡ºç°çš„ä½ç½®æ˜¯ç´¢å¼• <code>7</code>ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">text = <span class="string">"Hello, world!"</span></span><br><span class="line">position = text.find(<span class="string">"world"</span>)</span><br><span class="line"><span class="built_in">print</span>(position)  <span class="comment"># è¾“å‡º7</span></span><br><span class="line">position = text.find(<span class="string">"Python"</span>)</span><br><span class="line"><span class="built_in">print</span>(position)  <span class="comment"># è¾“å‡º-1</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="ç¤ºä¾‹-2ï¼šæŒ‡å®šèµ·å§‹ç´¢å¼•"><a href="#ç¤ºä¾‹-2ï¼šæŒ‡å®šèµ·å§‹ç´¢å¼•" class="headerlink" title="ç¤ºä¾‹ 2ï¼šæŒ‡å®šèµ·å§‹ç´¢å¼•"></a>ç¤ºä¾‹ 2ï¼šæŒ‡å®šèµ·å§‹ç´¢å¼•</h4><p>ä»ç´¢å¼• 5 å¼€å§‹æŸ¥æ‰¾ <code>Hello</code>ï¼Œå®ƒåœ¨ç´¢å¼•<code>12</code>å¤„è¢«æ‰¾åˆ°ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">text = <span class="string">"Hello,world!Hello again!"</span></span><br><span class="line">position = text.find(<span class="string">"Hello"</span>, <span class="number">5</span>)  <span class="comment"># ä»ç´¢å¼• 5 å¼€å§‹æŸ¥æ‰¾'Hello'</span></span><br><span class="line"><span class="built_in">print</span>(position)  <span class="comment"># è¾“å‡ºï¼š12</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="ç¤ºä¾‹-3ï¼šæŒ‡å®šæŸ¥è¯¢èŒƒå›´"><a href="#ç¤ºä¾‹-3ï¼šæŒ‡å®šæŸ¥è¯¢èŒƒå›´" class="headerlink" title="ç¤ºä¾‹ 3ï¼šæŒ‡å®šæŸ¥è¯¢èŒƒå›´"></a>ç¤ºä¾‹ 3ï¼šæŒ‡å®šæŸ¥è¯¢èŒƒå›´</h4><p>åœ¨å­—ç¬¦ä¸²ä¸­æŒ‡å®šèµ·å§‹ç´¢å¼•<code>10</code>ï¼Œç»“æŸç´¢å¼•<code>20</code>çš„èŒƒå›´ä¸­ï¼ŒæŸ¥è¯¢<code>Hello</code>ã€‚</p>
<figure class="highlight py"><table><tbody><tr><td class="code"><pre><span class="line">text = <span class="string">"Hello,world!Hello,again!"</span></span><br><span class="line">position = text.find(<span class="string">"Hello"</span>, <span class="number">10</span>, <span class="number">20</span>)  <span class="comment"># ä»ç´¢å¼• 10 å¼€å§‹ï¼Œåˆ°ç´¢å¼• 20 ç»“æŸ</span></span><br><span class="line"><span class="built_in">print</span>(position)  <span class="comment"># è¾“å‡ºï¼š12</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="ç¤ºä¾‹-4ï¼šæŸ¥æ‰¾å¤šä¸ªå­å­—ç¬¦ä¸²"><a href="#ç¤ºä¾‹-4ï¼šæŸ¥æ‰¾å¤šä¸ªå­å­—ç¬¦ä¸²" class="headerlink" title="ç¤ºä¾‹ 4ï¼šæŸ¥æ‰¾å¤šä¸ªå­å­—ç¬¦ä¸²"></a>ç¤ºä¾‹ 4ï¼šæŸ¥æ‰¾å¤šä¸ªå­å­—ç¬¦ä¸²</h4><p>å…ˆæ‰¾åˆ°ç¬¬ä¸€ä¸ª <code>Hello</code>ï¼Œç„¶åä»ç¬¬ä¸€ä¸ª <code>Hello</code> çš„ä¸‹ä¸€ä¸ªä½ç½®å¼€å§‹æŸ¥æ‰¾ç¬¬äºŒä¸ª <code>Hello</code>ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">text = <span class="string">"Hello,world!Hello,again!"</span></span><br><span class="line">position1 = text.find(<span class="string">"Hello"</span>)</span><br><span class="line">position2 = text.find(<span class="string">"Hello"</span>, position1 + <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(position1)  <span class="comment"># è¾“å‡ºï¼š0</span></span><br><span class="line"><span class="built_in">print</span>(position2)  <span class="comment"># è¾“å‡ºï¼š12</span></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<ol>
<li><code>str.find()</code> æ˜¯å¤§å°å†™æ•æ„Ÿçš„ï¼Œå³ <code>"Hello"</code> å’Œ <code>"hello"</code> æ˜¯ä¸åŒçš„ã€‚</li>
<li>å¦‚æœå­å­—ç¬¦ä¸²ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆ<code>""</code>ï¼‰ï¼Œ<code>str.find()</code> ä¼šè¿”å›èµ·å§‹ç´¢å¼•ä½ç½®ã€‚</li>
<li><code>str.find()</code> å’Œ <code>str.index()</code> æ–¹æ³•ç±»ä¼¼ï¼Œä½† <code>str.index()</code> åœ¨æ‰¾ä¸åˆ°å­å­—ç¬¦ä¸²æ—¶ä¼šæŠ›å‡º <code>ValueError</code> å¼‚å¸¸ï¼Œè€Œ <code>str.find()</code> è¿”å› <code>-1</code>ã€‚</li>
</ol>
</blockquote>
<h3 id="str-index-sub-start-end"><a href="#str-index-sub-start-end" class="headerlink" title="str.index(sub[, start[, end]])"></a><code>str.index(sub[, start[, end]])</code></h3><p>ä¸ <code>find</code> ç±»ä¼¼ï¼Œä½†å¦‚æœæ²¡æœ‰æ‰¾åˆ°å­å­—ç¬¦ä¸²ï¼Œä¼šæŠ›å‡º <code>ValueError</code> å¼‚å¸¸ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">text = <span class="string">"Hello, world!"</span></span><br><span class="line">position = text.index(<span class="string">"world"</span>)</span><br><span class="line"><span class="built_in">print</span>(position)  <span class="comment"># è¾“å‡ºï¼š7</span></span><br><span class="line"><span class="comment"># å¦‚æœå­å­—ç¬¦ä¸²ä¸å­˜åœ¨ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    position = text.index(<span class="string">"Python"</span>) <span class="comment"># ValueError: substring not found</span></span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'index error:<span class="subst">{<span class="built_in">str</span>(e)}</span>'</span>) <span class="comment"># index error:substring not found</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="str-count-sub-start-end"><a href="#str-count-sub-start-end" class="headerlink" title="str.count(sub[, start[, end]])"></a><code>str.count(sub[, start[, end]])</code></h3><p>è¿”å›å­å­—ç¬¦ä¸² <code>sub</code> åœ¨å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚ä»å­—ç¬¦ä¸²ç´¢å¼•<code>start</code>å¼€å§‹ç»Ÿè®¡åˆ°<code>end</code>ç´¢å¼•ç»“æŸã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">text = <span class="string">"Hello, world! Hello again!"</span></span><br><span class="line">count = text.count(<span class="string">"Hello"</span>)</span><br><span class="line"><span class="built_in">print</span>(count)  <span class="comment"># è¾“å‡ºï¼š2</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="str-startswith-prefix-start-end"><a href="#str-startswith-prefix-start-end" class="headerlink" title="str.startswith(prefix[, start[, end]])"></a><code>str.startswith(prefix[, start[, end]])</code></h3><p>æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä»¥æŒ‡å®šçš„å‰ç¼€å¼€å¤´ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">text = <span class="string">"Hello, world!"</span></span><br><span class="line"><span class="built_in">print</span>(text.startswith(<span class="string">"Hello"</span>))  <span class="comment"># è¾“å‡ºï¼šTrue</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="str-endswith-suffix-start-end"><a href="#str-endswith-suffix-start-end" class="headerlink" title="str.endswith(suffix[, start[, end]])"></a><code>str.endswith(suffix[, start[, end]])</code></h3><p>æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä»¥æŒ‡å®šçš„åç¼€ç»“å°¾ã€‚</p>
<h2 id="å­—ç¬¦ä¸²å¤§å°å†™è½¬æ¢"><a href="#å­—ç¬¦ä¸²å¤§å°å†™è½¬æ¢" class="headerlink" title="å­—ç¬¦ä¸²å¤§å°å†™è½¬æ¢"></a>å­—ç¬¦ä¸²å¤§å°å†™è½¬æ¢</h2><h3 id="str-upper"><a href="#str-upper" class="headerlink" title="str.upper()"></a><code>str.upper()</code></h3><p>å°†å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å­—ç¬¦è½¬æ¢ä¸ºå¤§å†™ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">text = <span class="string">"Hello, world!"</span></span><br><span class="line">upper_text = text.upper()</span><br><span class="line"><span class="built_in">print</span>(upper_text)  <span class="comment"># è¾“å‡ºï¼šHELLO, WORLD!</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="str-lower"><a href="#str-lower" class="headerlink" title="str.lower()"></a><code>str.lower()</code></h3><p>å°†å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å­—ç¬¦è½¬æ¢ä¸ºå°å†™ã€‚</p>
<h3 id="str-capitalize"><a href="#str-capitalize" class="headerlink" title="str.capitalize()"></a><code>str.capitalize()</code></h3><p>å°†å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦è½¬æ¢ä¸ºå¤§å†™ï¼Œå…¶ä½™å­—ç¬¦è½¬æ¢ä¸ºå°å†™ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">text = <span class="string">"hello, world!"</span></span><br><span class="line">capitalized_text = text.capitalize()</span><br><span class="line"><span class="built_in">print</span>(capitalized_text)  <span class="comment"># è¾“å‡ºï¼šHello, world!</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="str-title"><a href="#str-title" class="headerlink" title="str.title()"></a><code>str.title()</code></h3><p>å°†å­—ç¬¦ä¸²ä¸­æ¯ä¸ªå•è¯çš„é¦–å­—æ¯è½¬æ¢ä¸ºå¤§å†™ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">text = <span class="string">"hello, world!"</span></span><br><span class="line">title_text = text.title()</span><br><span class="line"><span class="built_in">print</span>(title_text)  <span class="comment"># è¾“å‡ºï¼šHello, World!</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="å­—ç¬¦ä¸²åˆ†å‰²å’Œè¿æ¥"><a href="#å­—ç¬¦ä¸²åˆ†å‰²å’Œè¿æ¥" class="headerlink" title="å­—ç¬¦ä¸²åˆ†å‰²å’Œè¿æ¥"></a>å­—ç¬¦ä¸²åˆ†å‰²å’Œè¿æ¥</h2><h3 id="str-split-sep-None-maxsplit-1"><a href="#str-split-sep-None-maxsplit-1" class="headerlink" title="str.split(sep=None, maxsplit=-1)"></a><code>str.split(sep=None, maxsplit=-1)</code></h3><p>æ ¹æ®åˆ†éš”ç¬¦ <code>sep</code> å°†å­—ç¬¦ä¸²åˆ†å‰²æˆå¤šä¸ªå­å­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›ä¸€ä¸ªåˆ—è¡¨ã€‚å¦‚æœ <code>sep</code> æœªæŒ‡å®šï¼Œåˆ™é»˜è®¤æŒ‰ç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼ã€æ¢è¡Œ <code>\n</code>ã€åˆ¶è¡¨ç¬¦ <code>\t</code> ç­‰ï¼‰åˆ†å‰²ã€‚</p>
<h4 id="ç¤ºä¾‹1ï¼šé»˜è®¤åˆ†å‰²"><a href="#ç¤ºä¾‹1ï¼šé»˜è®¤åˆ†å‰²" class="headerlink" title="ç¤ºä¾‹1ï¼šé»˜è®¤åˆ†å‰²"></a>ç¤ºä¾‹1ï¼šé»˜è®¤åˆ†å‰²</h4><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">text = <span class="string">"Hello, world! Hello, again!"</span></span><br><span class="line">words = text.split()</span><br><span class="line"><span class="built_in">print</span>(words)  <span class="comment"># è¾“å‡ºï¼š['Hello,', 'world!', 'Hello,', 'again!']</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="ç¤ºä¾‹2ï¼šæŒ‡å®šåˆ†å‰²ç¬¦"><a href="#ç¤ºä¾‹2ï¼šæŒ‡å®šåˆ†å‰²ç¬¦" class="headerlink" title="ç¤ºä¾‹2ï¼šæŒ‡å®šåˆ†å‰²ç¬¦"></a>ç¤ºä¾‹2ï¼šæŒ‡å®šåˆ†å‰²ç¬¦</h4><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">words = text.split(<span class="string">','</span>)</span><br><span class="line"><span class="built_in">print</span>(words) <span class="comment"># ['Hello', ' world! Hello', ' again!']</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="ç¤ºä¾‹3ï¼šæŒ‡å®šæœ€å¤§åˆ†å‰²æ¬¡æ•°"><a href="#ç¤ºä¾‹3ï¼šæŒ‡å®šæœ€å¤§åˆ†å‰²æ¬¡æ•°" class="headerlink" title="ç¤ºä¾‹3ï¼šæŒ‡å®šæœ€å¤§åˆ†å‰²æ¬¡æ•°"></a>ç¤ºä¾‹3ï¼šæŒ‡å®šæœ€å¤§åˆ†å‰²æ¬¡æ•°</h4><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">words = text.split(<span class="string">','</span>, maxsplit=<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(words) <span class="comment"># ['Hello', ' world! Hello, again!']</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="str-join-iterable"><a href="#str-join-iterable" class="headerlink" title="str.join(iterable)"></a><code>str.join(iterable)</code></h3><p>å°†å¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚åˆ—è¡¨ã€å…ƒç»„ï¼‰ä¸­çš„å…ƒç´ è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå…ƒç´ ä¹‹é—´ç”¨è°ƒç”¨è¯¥æ–¹æ³•çš„å­—ç¬¦ä¸²ä½œä¸ºåˆ†éš”ç¬¦ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">words = [<span class="string">"Hello"</span>, <span class="string">"world"</span>, <span class="string">"Welcome"</span>, <span class="string">"to"</span>, <span class="string">"Python"</span>]</span><br><span class="line">text = <span class="string">" "</span>.join(words)</span><br><span class="line"><span class="built_in">print</span>(text)  <span class="comment"># è¾“å‡ºï¼šHello world Welcome to Python</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="str-splitlines-keepends"><a href="#str-splitlines-keepends" class="headerlink" title="str.splitlines([keepends])"></a><code>str.splitlines([keepends])</code></h3><p> splitlines() æŒ‰ç…§è¡Œ(â€˜\râ€™, â€˜\r\nâ€™, \nâ€™)åˆ†éš”ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«å„è¡Œä½œä¸ºå…ƒç´ çš„åˆ—è¡¨ï¼Œå¦‚æœå‚æ•° keepends ä¸º Falseï¼Œä¸åŒ…å«æ¢è¡Œç¬¦ï¼Œå¦‚æœä¸º Trueï¼Œåˆ™ä¿ç•™æ¢è¡Œç¬¦ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">'ab c\n\nde fg\rkl\r\n'</span>.splitlines() <span class="comment"># ['ab c', '', 'de fg', 'kl']</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="å­—ç¬¦ä¸²æˆªå–"><a href="#å­—ç¬¦ä¸²æˆªå–" class="headerlink" title="å­—ç¬¦ä¸²æˆªå–"></a>å­—ç¬¦ä¸²æˆªå–</h2><h3 id="str-start-end"><a href="#str-start-end" class="headerlink" title="str[start:end]"></a>str[start:end]</h3><p>æˆªå–ç´¢å¼•<code>start</code>è‡³ç´¢å¼•<code>end</code></p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">text = <span class="string">"Hello,world"</span></span><br><span class="line"><span class="built_in">print</span>(text[<span class="number">0</span>:<span class="number">5</span>])  <span class="comment"># Hello</span></span><br><span class="line"><span class="built_in">print</span>(text[:<span class="number">5</span>])   <span class="comment"># Hello</span></span><br><span class="line"><span class="built_in">print</span>(text[<span class="number">6</span>:])   <span class="comment"># world</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="å­—ç¬¦ä¸²æ›¿æ¢"><a href="#å­—ç¬¦ä¸²æ›¿æ¢" class="headerlink" title="å­—ç¬¦ä¸²æ›¿æ¢"></a>å­—ç¬¦ä¸²æ›¿æ¢</h2><h3 id="str-replace-old-new-count"><a href="#str-replace-old-new-count" class="headerlink" title="str.replace(old, new[, count])"></a><code>str.replace(old, new[, count])</code></h3><p>å°†å­—ç¬¦ä¸²ä¸­çš„å­å­—ç¬¦ä¸² <code>old</code> æ›¿æ¢ä¸º <code>new</code>ã€‚<code>count</code> å‚æ•°å¯é€‰ï¼ŒæŒ‡å®šæ›¿æ¢çš„æ¬¡æ•°ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">text = <span class="string">"Hello, world! Hello again!"</span></span><br><span class="line">new_text = text.replace(<span class="string">"Hello"</span>, <span class="string">"Hi"</span>)</span><br><span class="line"><span class="built_in">print</span>(new_text)  <span class="comment"># è¾“å‡ºï¼šHi, world! Hi again!</span></span><br><span class="line">new_text = text.replace(<span class="string">"Hello"</span>, <span class="string">"Hi"</span>, <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(new_text)  <span class="comment"># è¾“å‡ºï¼šHi, world! Hello again!</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="å­—ç¬¦ä¸²æ ¼å¼åŒ–"><a href="#å­—ç¬¦ä¸²æ ¼å¼åŒ–" class="headerlink" title="å­—ç¬¦ä¸²æ ¼å¼åŒ–"></a>å­—ç¬¦ä¸²æ ¼å¼åŒ–</h2><h3 id="str-format-args-kwargs"><a href="#str-format-args-kwargs" class="headerlink" title="str.format(*args, **kwargs)"></a><code>str.format(*args, **kwargs)</code></h3><p>ä½¿ç”¨å ä½ç¬¦ <code>{}</code> å°†å˜é‡æ’å…¥åˆ°å­—ç¬¦ä¸²ä¸­ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">name = <span class="string">"djun"</span></span><br><span class="line">age = <span class="number">28</span></span><br><span class="line">greeting = <span class="string">"Hello, my name is {} and I am {} years old."</span>.<span class="built_in">format</span>(name, age)</span><br><span class="line"><span class="built_in">print</span>(greeting)  <span class="comment"># è¾“å‡ºï¼šHello, my name is djun and I am 28 years old.</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="f-stringï¼ˆPython-3-6-ï¼‰"><a href="#f-stringï¼ˆPython-3-6-ï¼‰" class="headerlink" title="f-stringï¼ˆPython 3.6+ï¼‰"></a><code>f-string</code>ï¼ˆPython 3.6+ï¼‰</h3><p>ä½¿ç”¨ <code>f</code> å‰ç¼€å’ŒèŠ±æ‹¬å· <code>{}</code> æ¥åµŒå…¥è¡¨è¾¾å¼ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">name = <span class="string">"djun"</span></span><br><span class="line">age = <span class="number">28</span></span><br><span class="line">greeting = <span class="string">f"Hello, my name is <span class="subst">{name}</span> and I am <span class="subst">{age}</span> years old."</span></span><br><span class="line"><span class="built_in">print</span>(greeting)  <span class="comment"># è¾“å‡ºï¼šHello, my name is djun and I am 28 years old.</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="å­—ç¬¦ä¸²çš„å…¶ä»–æ“ä½œ"><a href="#å­—ç¬¦ä¸²çš„å…¶ä»–æ“ä½œ" class="headerlink" title="å­—ç¬¦ä¸²çš„å…¶ä»–æ“ä½œ"></a>å­—ç¬¦ä¸²çš„å…¶ä»–æ“ä½œ</h2><h3 id="str-strip-chars"><a href="#str-strip-chars" class="headerlink" title="str.strip([chars])"></a><code>str.strip([chars])</code></h3><p>ç§»é™¤å­—ç¬¦ä¸²ä¸¤ç«¯çš„ç©ºç™½å­—ç¬¦ï¼ˆåŒ…æ‹¬ç©ºæ ¼ã€æ¢è¡Œç¬¦ç­‰ï¼‰ã€‚<code>chars</code> å‚æ•°å¯é€‰ï¼ŒæŒ‡å®šè¦ç§»é™¤çš„å­—ç¬¦é›†åˆã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">text = <span class="string">"   Hello, world!   "</span></span><br><span class="line">stripped_text = text.strip()</span><br><span class="line"><span class="built_in">print</span>(stripped_text)  <span class="comment"># è¾“å‡ºï¼šHello, world!</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="str-isalpha"><a href="#str-isalpha" class="headerlink" title="str.isalpha()"></a><code>str.isalpha()</code></h3><p>æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦åªåŒ…å«å­—æ¯ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">text = <span class="string">"Hello"</span></span><br><span class="line"><span class="built_in">print</span>(text.isalpha())  <span class="comment"># è¾“å‡ºï¼šTrue</span></span><br><span class="line">text = <span class="string">"Hello1234"</span></span><br><span class="line"><span class="built_in">print</span>(text.isalpha())  <span class="comment"># è¾“å‡ºï¼šFalse</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="str-isdigit"><a href="#str-isdigit" class="headerlink" title="str.isdigit()"></a><code>str.isdigit()</code></h3><p>æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦åªåŒ…å«æ•°å­—ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">text = <span class="string">"12345"</span></span><br><span class="line"><span class="built_in">print</span>(text.isdigit())  <span class="comment"># è¾“å‡ºï¼šTrue</span></span><br><span class="line">text = <span class="string">"Hello1234"</span></span><br><span class="line"><span class="built_in">print</span>(text.isdigit())  <span class="comment"># è¾“å‡ºï¼šFalse</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="str-isalnum"><a href="#str-isalnum" class="headerlink" title="str.isalnum()"></a><code>str.isalnum()</code></h3><p>æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦åªåŒ…å«å­—æ¯æˆ–æ•°å­—ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">text = <span class="string">"Hello123"</span></span><br><span class="line"><span class="built_in">print</span>(text.isalnum())  <span class="comment"># è¾“å‡ºï¼šTrue</span></span><br><span class="line">text = <span class="string">",,,h1"</span></span><br><span class="line"><span class="built_in">print</span>(text.isalnum())  <span class="comment"># è¾“å‡ºï¼šFalse</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="str-rstrip-chars"><a href="#str-rstrip-chars" class="headerlink" title="str.rstrip([chars])"></a><code>str.rstrip([chars])</code></h3><p>åˆ é™¤å­—ç¬¦ä¸²æœ«å°¾çš„æŒ‡å®šå­—ç¬¦ï¼Œé»˜è®¤ä¸ºç©ºç™½ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€æ¢è¡Œç¬¦ã€å›è½¦ç¬¦ã€åˆ¶è¡¨ç¬¦ã€‚</p>
<h3 id="str-swapcase"><a href="#str-swapcase" class="headerlink" title="str.swapcase()"></a><code>str.swapcase()</code></h3><p>å¤§å†™å­—æ¯è½¬æ¢ä¸ºå°å†™å­—æ¯ï¼Œå°å†™å­—æ¯ä¼šè½¬æ¢ä¸ºå¤§å†™å­—æ¯ã€‚</p>
<h3 id="str-zfill-width"><a href="#str-zfill-width" class="headerlink" title="str.zfill(width)"></a><code>str.zfill(width)</code></h3><p>è¿”å›æŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼ŒåŸå­—ç¬¦ä¸²å³å¯¹é½ï¼Œå‰é¢å¡«å……0ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">str</span> = <span class="string">"this is string example from runoob....wow!!!"</span></span><br><span class="line"><span class="built_in">print</span> (<span class="string">"str.zfill : "</span>,<span class="built_in">str</span>.zfill(<span class="number">40</span>)) <span class="comment"># this is string example from runoob....wow!!!</span></span><br><span class="line"><span class="built_in">print</span> (<span class="string">"str.zfill : "</span>,<span class="built_in">str</span>.zfill(<span class="number">50</span>)) <span class="comment"># 000000this is string example from runoob....wow!!!</span></span><br></pre></td></tr></tbody></table></figure>

</body></html>]]></content>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Python è§£åŒ…</title>
    <url>/p/d2a40328.html</url>
    <content><![CDATA[<html><head></head><body><p>åœ¨ Python ä¸­ï¼Œ<code>*</code> å’Œ <code>**</code> æ˜¯ç”¨äºè§£åŒ…ï¼ˆunpackingï¼‰æ“ä½œç¬¦ï¼Œå®ƒä»¬åˆ†åˆ«ç”¨äºè§£åŒ…å¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚åˆ—è¡¨ã€å…ƒç»„ï¼‰å’Œå­—å…¸ã€‚è¿™ä¸¤ä¸ªæ“ä½œç¬¦åœ¨å‡½æ•°è°ƒç”¨æ—¶éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥å°†ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡æˆ–å­—å…¸çš„å†…å®¹â€œå±•å¼€â€å¹¶ä¼ é€’ç»™å‡½æ•°ã€‚</p>
<h2 id="1-çš„ä½œç”¨ï¼šè§£åŒ…å¯è¿­ä»£å¯¹è±¡"><a href="#1-çš„ä½œç”¨ï¼šè§£åŒ…å¯è¿­ä»£å¯¹è±¡" class="headerlink" title="1. * çš„ä½œç”¨ï¼šè§£åŒ…å¯è¿­ä»£å¯¹è±¡"></a>1. <code>*</code> çš„ä½œç”¨ï¼šè§£åŒ…å¯è¿­ä»£å¯¹è±¡</h2><p><code>*</code> ç”¨äºè§£åŒ…å¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚åˆ—è¡¨ã€å…ƒç»„ç­‰ï¼‰ï¼Œå°†å…¶å…ƒç´ ä½œä¸ºå•ç‹¬çš„å‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚</p>
<h3 id="ç¤ºä¾‹-1ï¼šè§£åŒ…åˆ—è¡¨"><a href="#ç¤ºä¾‹-1ï¼šè§£åŒ…åˆ—è¡¨" class="headerlink" title="ç¤ºä¾‹ 1ï¼šè§£åŒ…åˆ—è¡¨"></a>ç¤ºä¾‹ 1ï¼šè§£åŒ…åˆ—è¡¨</h3><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a, b, c</span>):</span><br><span class="line">    <span class="keyword">return</span> a + b + c</span><br><span class="line"></span><br><span class="line">numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">result = add(*numbers)  <span class="comment"># ç­‰ä»·äº add(1, 2, 3)</span></span><br><span class="line"><span class="built_in">print</span>(result)  <span class="comment"># è¾“å‡ºï¼š6</span></span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼š</p>
<ul>
<li><code>numbers</code> æ˜¯ä¸€ä¸ªåˆ—è¡¨ <code>[1, 2, 3]</code>ã€‚</li>
<li>ä½¿ç”¨ <code>*numbers</code> å°†åˆ—è¡¨è§£åŒ…ä¸ºä¸‰ä¸ªå•ç‹¬çš„å‚æ•° <code>1</code>, <code>2</code>, <code>3</code>ï¼Œç„¶åä¼ é€’ç»™ <code>add</code> å‡½æ•°ã€‚</li>
</ul>
<h3 id="ç¤ºä¾‹-2ï¼šè§£åŒ…å…ƒç»„"><a href="#ç¤ºä¾‹-2ï¼šè§£åŒ…å…ƒç»„" class="headerlink" title="ç¤ºä¾‹ 2ï¼šè§£åŒ…å…ƒç»„"></a>ç¤ºä¾‹ 2ï¼šè§£åŒ…å…ƒç»„</h3><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">greet</span>(<span class="params">name, age</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"Hello <span class="subst">{name}</span>, you are <span class="subst">{age}</span> years old."</span>)</span><br><span class="line"></span><br><span class="line">person = (<span class="string">"Alice"</span>, <span class="number">25</span>)</span><br><span class="line">greet(*person)  <span class="comment"># ç­‰ä»·äº greet("Alice", 25)</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="2-çš„ä½œç”¨ï¼šè§£åŒ…å­—å…¸"><a href="#2-çš„ä½œç”¨ï¼šè§£åŒ…å­—å…¸" class="headerlink" title="2. ** çš„ä½œç”¨ï¼šè§£åŒ…å­—å…¸"></a>2. <code>**</code> çš„ä½œç”¨ï¼šè§£åŒ…å­—å…¸</h2><p><code>**</code> ç”¨äºè§£åŒ…å­—å…¸ï¼Œå°†å…¶é”®å€¼å¯¹ä½œä¸ºå…³é”®å­—å‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚</p>
<h3 id="ç¤ºä¾‹-1ï¼šè§£åŒ…å­—å…¸"><a href="#ç¤ºä¾‹-1ï¼šè§£åŒ…å­—å…¸" class="headerlink" title="ç¤ºä¾‹ 1ï¼šè§£åŒ…å­—å…¸"></a>ç¤ºä¾‹ 1ï¼šè§£åŒ…å­—å…¸</h3><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">greet</span>(<span class="params">name, age</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"Hello <span class="subst">{name}</span>, you are <span class="subst">{age}</span> years old."</span>)</span><br><span class="line"></span><br><span class="line">person = {<span class="string">"name"</span>: <span class="string">"Alice"</span>, <span class="string">"age"</span>: <span class="number">25</span>}</span><br><span class="line">greet(**person)  <span class="comment"># ç­‰ä»·äº greet(name="Alice", age=25)</span></span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼š</p>
<ul>
<li><code>person</code> æ˜¯ä¸€ä¸ªå­—å…¸ <code>{"name": "Alice", "age": 25}</code>ã€‚</li>
<li>ä½¿ç”¨ <code>**person</code> å°†å­—å…¸è§£åŒ…ä¸ºå…³é”®å­—å‚æ•° <code>name="Alice"</code> å’Œ <code>age=25</code>ï¼Œç„¶åä¼ é€’ç»™ <code>greet</code> å‡½æ•°ã€‚</li>
</ul>
<h3 id="ç¤ºä¾‹-2ï¼šè§£åŒ…å­—å…¸"><a href="#ç¤ºä¾‹-2ï¼šè§£åŒ…å­—å…¸" class="headerlink" title="ç¤ºä¾‹ 2ï¼šè§£åŒ…å­—å…¸"></a>ç¤ºä¾‹ 2ï¼šè§£åŒ…å­—å…¸</h3><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">print_info</span>(<span class="params">name, age, city</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"<span class="subst">{name}</span> is <span class="subst">{age}</span> years old and lives in <span class="subst">{city}</span>."</span>)</span><br><span class="line"></span><br><span class="line">info = {<span class="string">"name"</span>: <span class="string">"Bob"</span>, <span class="string">"age"</span>: <span class="number">30</span>, <span class="string">"city"</span>: <span class="string">"New York"</span>}</span><br><span class="line">print_info(**info)  <span class="comment"># ç­‰ä»·äº print_info(name="Bob", age=30, city="New York")</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="3-åœ¨-asyncio-gather-ä¸­ä½¿ç”¨-tasks"><a href="#3-åœ¨-asyncio-gather-ä¸­ä½¿ç”¨-tasks" class="headerlink" title="3. åœ¨ asyncio.gather() ä¸­ä½¿ç”¨ *tasks"></a>3. åœ¨ <code>asyncio.gather()</code> ä¸­ä½¿ç”¨ <code>*tasks</code></h2><p>å›åˆ°ä½ çš„é—®é¢˜ï¼Œåœ¨ <code>asyncio.gather()</code> ä¸­ä½¿ç”¨ <code>*tasks</code> æ˜¯ä¸ºäº†å°† <code>tasks</code> åˆ—è¡¨ä¸­çš„æ¯ä¸ªä»»åŠ¡è§£åŒ…ä¸ºå•ç‹¬çš„å‚æ•°ä¼ é€’ç»™ <code>asyncio.gather()</code>ã€‚</p>
<h3 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h3><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">task1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Task 1 started"</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Task 1 finished"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">task2</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Task 2 started"</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Task 2 finished"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    tasks = [task1(), task2()]  <span class="comment"># ä»»åŠ¡åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.gather(*tasks)  <span class="comment"># è§£åŒ… tasks åˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></tbody></table></figure>

<p>è§£é‡Šï¼š</p>
<ul>
<li><code>tasks</code> æ˜¯ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªåç¨‹ä»»åŠ¡çš„åˆ—è¡¨ï¼š<code>[task1(), task2()]</code>ã€‚</li>
<li><code>asyncio.gather(*tasks)</code> ç­‰ä»·äº <code>asyncio.gather(task1(), task2())</code>ã€‚</li>
<li><code>*tasks</code> å°†åˆ—è¡¨ä¸­çš„æ¯ä¸ªä»»åŠ¡è§£åŒ…ä¸ºå•ç‹¬çš„å‚æ•°ï¼Œä¼ é€’ç»™ <code>asyncio.gather()</code>ã€‚</li>
</ul>
<h2 id="4-å’Œ-çš„å…¶ä»–ç”¨é€”"><a href="#4-å’Œ-çš„å…¶ä»–ç”¨é€”" class="headerlink" title="4. * å’Œ ** çš„å…¶ä»–ç”¨é€”"></a>4. <code>*</code> å’Œ <code>**</code> çš„å…¶ä»–ç”¨é€”</h2><p>åœ¨å‡½æ•°å®šä¹‰ä¸­ï¼š</p>
<ul>
<li><code>*args</code>ï¼šç”¨äºæ¥æ”¶ä»»æ„æ•°é‡çš„ä½ç½®å‚æ•°ï¼Œæ‰“åŒ…ä¸ºä¸€ä¸ªå…ƒç»„ã€‚</li>
<li><code>**kwargs</code>ï¼šç”¨äºæ¥æ”¶ä»»æ„æ•°é‡çš„å…³é”®å­—å‚æ•°ï¼Œæ‰“åŒ…ä¸ºä¸€ä¸ªå­—å…¸ã€‚</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">example_function</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Positional arguments:"</span>, args)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Keyword arguments:"</span>, kwargs)</span><br><span class="line"></span><br><span class="line">example_function(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, name=<span class="string">"Alice"</span>, age=<span class="number">25</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">Positional arguments: (1, 2, 3)</span><br><span class="line">Keyword arguments: {'name': 'Alice', 'age': 25}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="5-æ€»ç»“"><a href="#5-æ€»ç»“" class="headerlink" title="5. æ€»ç»“"></a>5. æ€»ç»“</h2><ul>
<li><code>*</code> ç”¨äºè§£åŒ…å¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚åˆ—è¡¨ã€å…ƒç»„ï¼‰ï¼Œå°†å…¶å…ƒç´ ä½œä¸ºå•ç‹¬çš„å‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚</li>
<li><code>**</code> ç”¨äºè§£åŒ…å­—å…¸ï¼Œå°†å…¶é”®å€¼å¯¹ä½œä¸ºå…³é”®å­—å‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚</li>
<li>åœ¨ <code>asyncio.gather(*tasks)</code> ä¸­ï¼Œ<code>*tasks</code> å°†ä»»åŠ¡åˆ—è¡¨è§£åŒ…ä¸ºå•ç‹¬çš„å‚æ•°ï¼Œæ–¹ä¾¿å¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚</li>
</ul>
</body></html>]]></content>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>MrDJun&#39;s resume cert</title>
    <url>/p/1f48a54.html</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="å¯†ç é”™è¯¯ ğŸ˜­" data-whm="å½“å‰ç®€å†è¯ä¹¦æ— æ³•æŸ¥è¯¢ğŸ˜­">
  <script id="hbeData" type="hbeData" data-hmacdigest="5a6a8cc3f0da1ab40a50c0c0409979f4d946c4ad92e9875d3d6bafddb917620f">c047d6917b20743dcea87d13c08ebbafa2d3cc877faadfe257134c79c53a5099d3be159fb3ab699e53bbe6f2442b1ff84f8fc06dcd2f22a184c75ffbac1cb998fdedc05af9aa03472db137df03f2178d3494007aa1c3db3ae625b622a53b2e8064c146620532a06e46c6af63b0e1bd89386a3456dbed54119c841e0d61302db4334c3a6a575c624bea3652356a964d90c37199ad01086ce408faf73e578b68c8820f6614dced559cf739c3b48db7e3e3da1f1495cf37e2c900866492fd255c859502e8bf6cc00989351ff67258f62b2e39f07627e460c2f1ba593a93e93a1ca1fd16697c6e82c3786b24cab1a769e5b723815410a502814dacea63c10630663d10d45baeb497fd7804ccc35089d0344cee7973a92a228dcd78189b3fc0f1b2d0fda847ddda2fff20e3e30d1a6eeb38316b23e920c8ef102d472d0759803e97d2724399f7ba65b36357c16d631c94f314819d8554599dfbb7d96c492b1771f6948c53a7ad101cba4f11f69fd448d4ffa8b6472e61bdb903990b1b78941b259ea762d575233b54ca918ea1f805c8114be8d700919081e4e498e54d2f32a110c487c0df38710aeedfacf6cdfa56b1c17d52280d3e04d051f44aa64f7cba5968f4855c77050cfa872c1d95ea5286fdb84a439ebe1212c26115343edd854f87126450d60268f997379b7728b19413659a1a21c92612ad93bdeb143e9ce7a66ebfdf2e58e78f9e82823c28b32953daf22e17542cfe3fcb3e3373f1f2ee216bdf4070ee80e057508d05f4f11130f3fcbf246e890f56c515c555379eb66ddd3e1c3ec6a795d8ef7a38a33c3299f9bc0fa7a29e478972ab31147fe52e10744f0a0fe5c27d63c0d9f6442a858487bd9eeb02baea41498583f0d401abb3104473e2ea7bb6ca74a679a9661ad919ceee9e68aa0ea782283ad1239f0d66af0df8e53ce95bfc53bf9bab00db3e9fda861246515ce2d0a422dce4df0517470133acf74595b1e12f7d4ea3304f3c3aa37908b3384d1ef8566c4cedb2c66ef290008df732fe47ddcbaadf8787569449a461e3000b88c385f93200cbbfb53848433e9b273cc6af7cb76016e2e0ab0219933da906f76b09dd665a8c3b785a5e717ebd3e956b8c05338a3645651d5f3175f02659287285f5427dd27decf054efaaff0ebaece3087237fc4ff63e08de96da7e7581e1913a9f340c030ee5b0e3096736d467955f70df0bec244927fc202b282ab0e2b5e036c8dc4dddff1ee63acbe35293dc330d814df7c44aeb629c6bae65b2d49130fafe68d1aaf91b6974047fdfcd0ef1ed6c485ccedacb298d64cba29f9d1c7d57af3002730d56b05a7f088274198d91825fa8a2ba585f1bec228f3a416d0f41c8f50e8076972d2864227cedecbd4165a8228d93819dc72d56f6d91cb91484520c838067fcffcc93016235a057abc0c5610977e29c90c627cee728a134828e89a2d11c522d892fbb8ec7048b1dc2a816173bebb88209a6f1a4b6995d6366a90d6d59895f6657f6114b33af6766b4cfbc3e2bc248e64ba6c210dd49c862465f045a1e076c1cd8f80f1476fc79afd023342f43c312b16ab1e41d38efb939c5998f5cf291f54e34292cd16311ad25d6ba087bb946cf2ae13dc24ef6b74296687dc5d333052726c3d3d4876ccf66b0ce4969841c5a143189f466809fc86e3c8f4cb0a3048292f503f36f0be341084f36ac91e8a090f875338c667a4c00c7b416ed4da66283ffa8245669cd79f0934b69689c9324a918f235069f960d213e95ffe2f8f8909cc062df0efb50b8ba0c00d9bd0753278b5f125cab059f5c6fa59740ae966d88ab17446ec9c41ab26d10f7826634ed2151ae9aac87027b0a3b30114b61135720f0cc78022cb25a489a742a9d08f4ac2c3fb7469fffe9e6e6db470e22bbeeba79d1fa8fcc93184e00310d27285e4109bd7e442cf2ef7e882364e5b989ef3cfe2d831a4e4d82eb790302145f31d684d2573bddaadda8b9cb4a5911382d19caa02b013da6fcbdfa264de46ae0a53d87b2d8d0fa17db2319f861e11dfb8c81a09ab0fec77497f4e8f2a230dad79c6fcc253ec4fbe95d031dd51d578a3a703793d0dcc70f50c6b774224b7d6fb3bee424afcb36c77253ec446610eea88a3b89528b68ef03c4ef8d7e6d1cc22420ac666ae36f86eb0585635517d1c6dc09add8cbdfc693a0fb6cdd8e8e71dd57cd424d7deb3db34627380a5402d1923132f4052558b1dd727bb6379f7ced565b06f5e5cec7948fe2dcd82a7e9a59e809771c2b2903c213c4889de3e40d98dad7642a3b4a7bef34eaf791c1df3f3605c9fc903f86ae994b4fb0b59ec3acb710adc1a580b862a1bd02b43d06bce8e3b454059ca0735ab32d7e107879125dc5bd4e6215db2b2dd11b9d8c237109bf968e8a3320ec9575a18061a4d27051028ba70d78f9fdb8425a61f513db00cc745ce39fc23be9f627bc292f6dbb200d6a87b49f9a7017730fcc0eb08b31241cf210c8b471b065dfe210724b5b401782942ce2af80f70711af9ec2c7a539</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-up">
      <input class="hbe hbe-input-field hbe-input-field-up" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-up" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-up">å½“å‰æ–‡ç« å·²åŠ å¯†ï¼Œè¯·è¾“å…¥å¯†ç æŸ¥çœ‹ ğŸ˜›ï¼š</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>MrDJun&#39;s resume</title>
    <url>/p/90391726.html</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="å¯†ç é”™è¯¯ ğŸ˜­" data-whm="å½“å‰ç®€å†æ— æ³•æŸ¥è¯¢ğŸ˜­">
  <script id="hbeData" type="hbeData" data-hmacdigest="ea96fa17970436281ff59e09f826a62a231bddf9e0d0daa07ca737bcd6660df6">601062fcdaf3cca9d544423806934044380848aba583af6c1ea7ebc532dbcc8f340269dd12e0c82ecb6ab6129d2c267f3a2f2539b8ba6cb7556da32c4a21c9b2fc1e5ca19ded95eab342713dc8d07e6108c7b3f20c1489011f2706c12d97f13a9b219c18ff6ef6f746cfe59ca5c51de8ad5e5e92c76e4cfb1a4d4c64be105bf20d22fc593c42d994ba628ae661eb409e71b16401e8ea095d02738ddf246f5e2668811f9323421ed17fce1d44807ee49ce0cbdc5e7d947f69760f01dc189aa7bd38f63befbdb48c7ab7038124d7f919f0255bbe9324bc2b6e11260685d160505628abb26e189f065a3085e337e05f249a9f007e06cc7c28daaaf39f820657ab92f465b2001c1bc802b37117fd80f208dccb24bbf6bc07210e00fa8157eb21c36b6ce0137a8fc68845ec24cd3857b0e0b7617558be55267d1020682d11da7290476628760229236245fa7fbb5fe35254c4245311d0410e9f349da6a71592d4ffdf09a6e355d3018385ca81fecc607af6273fd8c1b6483296547af9685175a4196b05ed741cc5a357f9cb2a28c154585f72069bba4ca4c6aee751029be5ca13649f694cea2df19ff68cfbfeec2c7edeb41ff7b10718487d0a4fcc424b639e3d7d73f3b8fcb65f351d90576c87520573d9d41520f263994083bde2e0c3443b2cfed1b9b05ea30dc69f193720905f1680fa5093f00c2370503a0301190c7e86965f2033bd0e36669125078d6956aa60231ac56cb2dae970b285036f0e4d57a4e99d20532522f4afb38d50674baee10bca7ead6a69aa96c5f4a54e9a19fd1f2761e01e907976d07fd051e552bf8ab6b4a6b6e6a03d9f9a27db55a179ae76c0f55275fa03933055c93f9aa9ec740f7ee7052f3e70ea8c34b2e0951808fbfd1c9d5e00ba7015b51f685d5e982eb5c85edff624a08d9b6e85c2dd75eaa910d8b12c3ee5daeb70d09f55d8fe4bc354d458233532697f664bd3b114fa290c0f9b51e3bd7b9d59177c2a22fae9cc61a67a1718182d2bd3096841229b08d5d98b6e1acbac62917eb0a4ac444c3c36e3be89b9b3c839e9c4cfb38a5489ae9cf54ad8663c4eed18eb435fdd274d03697a4edb8d8c636d97248b0f3251e343f96bc1af95b681f1f52c29c2bb9534f3172fc99d909805e14ac8ed9f6153e41034c26a146ae5e4ac45f7bba5365202514d185507ba1a513d6ecd25d9eced2e8607dded359b3978b490761e6eb774bd5e5a898100f8ffb90e994f20368f899161f2b574956533ca2c4df92efd95c01d849b7ed2fb01c6c190ced80264698b393203a6bc51f7a2870435a4baf15626b9f0ac51cc6b366043caed79853ed61d595aab3042b64400bf8b37fb417afaae3ab55b7c50acf78b7939beae2c6936a9d831e168ebd8ed0b0741dec30e7df83019b1b1213fdb1c46b0138b5d9f83aee883fda8465fc5e41be30305da580b71a26aebd0dcd3111cf42c40dab3253a24cc4941a48f00db0c0732793e2beffdf8bd6244a500210371d7a0f38399134742597ebe75e6fa0d2c5cff184a67df2bb30b665d4f5358363ca7eb9b75c1fa7e2e4e71cd50c7a27368cd2d4c65e0c61513502fbec10c93a22dcf83249735bd097e10fae6b48b9f500f94cbdd3dd583445bd2d65ba937cbbb452b07855d6f49dbdb11791923fb7c806ddba0888430fb540a7496a0399e6213e0a9f3ab7b65048ea727d6db2701739c7ef5317d87c807b2f16c0924191dbdf7b4ca92c09b9a0cc9acd7ba3a4e2fcd3f0412cdaf4f47413512b9735287f50b0525dae8a1ced70e3985e37beca36eee20b668ba0ea40e6f56d2ce79fcf5169c98e8cc8149414ee62cd36a41b80b28a473cfa71b82ecd3a8cd464bf33a3f4a6596605a1d9cf9934f81efc523f9178cff2eeb85c48b7e6b0409e2f96aea9cf3311880d80b6bd33015bd2a06129c98202a9d96f897607e7418d850170878c0fedb4ecc2603029c4bb9b3273c1586798a4c3e3d88d58767541b058f05dbc1516db0a0efa8aac35dece85f5767d7fbdca91f69b126073603785a5e00fe367c7d43859d742bed5fd4182c7f9587aefce32ddc6d5a9ada43e5aac4db78097e7213733619737764e17dd3999dfff9060a992bb528024e6fa6df79aa25872fddb4cd209840f833c18a635d7b33b95cea224af13fdb9105f2e63baf62b78f6798fe3b8b6bf4a1003cc659c33d4cd0c180e5eb8cfdd522a06b06b6632bf67c946d260ddf55f9955cfb6f68dc0de2efc8f2080a4a1b870a3810b5c7da711680693018bfb69f2b9d766890d5898b159e467c5d6f7216fbc1c561fb33937a33974329848a9b721d551164bcbc506178205d62ab09824d24f4e02bc9c88ffe87d3481c3e014f9e6fd9cc9385e78c7d0f236f4b288b646ee6c7fda1b07780d09d80fc246599e83ed952d50c1a3e32dd71f4320f2f13217ff4694bbacfe74ca4ecde9ee165253342e502d5b789115cfd24221d2821e057f4a6bc7363c1837b62f22e3e1c6a52732dbd32816d18e648bc303ba52024f57a6eecea68fb87e3457d8939afc87debffd368e0f8e3dcf93136e44d2587f85c1ab7b14b1907764aac74a200ff07d72f02c7189c7588fccaa82a9df723a7922724ae10c265f52092f8962363ab99b2409e9587e18abb736e8462019a6027c10d592ea3338a057fe9c5ca047f3339a985e03befab3c42b5a0e66619a97c39d5f71bcfaf985eb1bd7fc0fd408ccc79da1f5063cf7f6c3fcaef00c4af579d9c3f470fa05b1c9b21a28f5a28b01b8fb9db1363c2355092be28789f3caa06c3979243510ce14534a3c8b0b8ed916366453e6ec21c05d7bfe52c01ebfbfc49069e0036af30d7eaf7631a1105a786091a52e17de879c9dcb2a67100579f5f1a6df408ccd0256860637155dc227f6028c4bf5467d652991a5bfb0465a56e739eb0ef132b3d220cbc3569c28c1ea4ca3812a48a698c35ba241eb64fac41eb91c62f2c3480dc9d296a9648cb2f13b62bb4e3fab11baf28e3cfda4a45fb071c089a12f99f1bbd110e932a04920fa91405a0a796f2aff0b2c36c42a5338d615c7bcb1e298b3111425ae66d538400b1a137603bf74e1da63c649b63833363e12c80a530d64ef6f4e3708b098aa348ea045a78c0844010a7e68197897018a3d31a0027e20939f00a70c343478cc1b60b8f39771f75b8fee7340f3747e9ced22060be146f3712cb165a4bb8bf005056ba69b95557f5facdcfeba95b89f47c823090f0b650d0e5908ff8f5c66a546471ab197fb56f94d4006da607740e6b18823fcc86e2ffd107ec9e86325f8d7a40b5dcdd1fcb2d2d7f7a1cc83a5f2b68e009187e9b78f3afb074d9328247e76dbf448e5117449e86f6012d7b1e53394eb4926a4d7a63dc50db05d844321d5273f86cf54492b42e0fb4e238c482dd16f83cbf038cfde580b42bf3c29332c8ad90e0303728eac95777162934c3c9973e3675e786a59299b71301208388f577ba41e4dfb939f9bed5b8ea851b2ee894f15d11e689124ad715f51af784875cb76d8c5047608c5009549ffe05737d78e852808b02803f0771374cb9141fbe53d3fd326c467a35d360a93da90d8b49bdb70073324b196c7e385b5a023e95b2e1a550c2d8c7f17eec6bedce5c7a840338510774147a111e3e61f30cd71f0eb97a181b2265c6226273dc2c20cc9d31c639b960c57930789ef9a9830608c555582504ed973729603573fd77460b11a5e0c672d22c55e5acb4bf5b44f56d41325bd403d4b6fd7baf3723745d607d765cfd8e77dabcace5cc2acc9a04316fac538756e7ac86112586817eebf044de93e2370d3c23a73b58902bfc65a2632bfcb06fb6c86f01f8cacc2b70b0e950070e889f3549519ea3cbbd3591a53e8bccf179df6c138ef6aa37cfcf91af4808ccc6456fdc1a250e66c9c2db6cd01ac31f64a73340211801ea70caf34ff494160f5fb0a6bd388d486e17afab0e44452ef2388e56e85dd0aa31a7982f15bac8a0e5269fa5d0c64ec6d588f1727f981f42a0fab7c090ff8236cb56ad65f791a7f959977defb649d21a3774ff91e4ffb1cfea2c9462f3803576aa4b8c287829785ac4818715408f0c7087200570c37cfdac8bb4b95427b56785bdf16586b7b46c880c079573dec90ed1c087c9b2a84e55b367e87543c5f2f85a6c0b25243d1fa8edd1d9918ac6129077df5dcbda8bc367baa4981ab98c4abab910503d0bb5a99bff3d63b5881e1ba1aa2a4af43e99187891a289d3f767f63e5c5218fcbe27e2e6254213b5955cd4fef65c0ad6e5fe2c74e08863a089b19ebe4d0409898eb166c40281d7dabd74b147779be30c0b056bfdda09553e5575fa271a29244ac8f430e029033708379bfd8447796ad6ba5ae1ad0bbf4de5d8f3ebc49f1dd3bd7a94d6e066e39d3586d0dc9cd44d179e6099e9e8eebb6552852cc06224ff877ced704f8afecbeda6ae5f2ca3b6130f8873d0f9dd50351313ef5575863c9d6da87edfc76191d81e21e33e2f376ca43d5c73bb38add9303dc6b76c80750508275d9dbf96afe350800a85f1cc3b96be834ec91a01c59c81bef6ccfbe51e5f2cff3af4ad5156bd54f38e5668c29400b0ba41a66201bb6f6761f50096417920a0d76828f5d5b6bc58d1ac4a075b2266b1ae1cbfed0215d253ceeeb601b7298b2042ce0282ee6fa4c8505dd7650c7dbce85648923a30131f849008671576890ebc394aebc50c99af100c38e849ef65ae83d0802b865b775ffb9bc8405ed6f4bfa43e5b5f4e8f959a29f668a454d50529513f99349ea0937d00dc795649ee80591cb565101834607c9c261bb255360771ceabca54bdc435ca43ebce486fc002e0451965d29a12fc3a621a399ca13ef3c6842bc1582912cabcd5eadb99946f7708d18f2dcb8824c6f73690da69ffba4bb4440b947c100d57d54f6ba74e64a1becb153256d4193756394a06b76548a6e817a8b5e7e8f3cfcca1075a6b83f345f577aff0a5863c57690a9c048349ecd3070e87d8b3b8d83dbd4f7e0abdd16436625c071df243d62765547515a1aa6f2543f190e1f9238ddd8fbfff7174b3909f173e15d1fae62964e3ff79ed442c615916ee53b3c77e96c8200c45fcb1859e1a476609142c499e8cc418750af6147976f7421d66aaf8d5279a9f01e2b784c0b822b20604f2f3502a520c23669687d5fc1d9b44f5d773c398434431b7a8a5093ad5c8b08eea2cdcea27cbe8b40a806c74c177924164fffc641587d671d8e0e84bb22a2cf256ecbec1f8671496559c28689f660ade870c253179f5e8b682482b4713cfacc653e7a717f9157c1eba73ae3e89b0ee0260446dbc15990d1d35c08c3f37dc8c1a599c2b413e184bff8a08f4f3cd84ae8d4c18e932ccabd9295edbbf87046aee1c1af45774f240f8bedac36894df5c595394055689c61243da11ccd99e493ed0cec33d99151a4b6cf3d2aec43889613f1f7063ed42ebfd8e4259e13021653baa51b8e1f7bac15cfda1a24e572e98980032a620bf618ae17354a554a3bfb99fe9240bad8810e2f3d7ebfa92d5a90a6c1554b224fc6a3af94c3d2a585129c1f5f8c94ae2ff2eac9beb9025701e638494df5f41d1556e3e80c4a10bab83ccf7ca6555040869566e5f865019aea0738a83bc59bab77e7d6afb96c77f5d29c4b76998b2fecf7dd68aa908a95d6f619531c3b0acd69dbe62f9c8c1fd597fee4fe9a9716ef77dd3c31294707a849006b4ee80696ec44216f032aa698f563d451e59dad18098784955bfa87361695f5a4407258a282e03bb1ba4e1593ce26aad0826c95df6e81c0dae82cef13a1adae8c7ceabd3bda11296122f72dd877cb958d17346f3037fb8eb09952780d7fc28e6ad7b1d258a9e2a5f6376f5ea1e24ad940e18974747be736f4d51e8496bb414c97dbf7ef6de4ac3e9aa8b6c6e82dff33d1892f9642299bffa2f6392909a1516ed1b4393d63bd690ac32bb67a5b1ae0ea70a8e837068de42a051431988e862bbacde8c1e09a627a99611260d036717277b3dd2a2b44ad877ba0859810bdf7ee5d6999ac0f120afa8c444af13106fffd9ef7e1c13cb0b3e93c39021f2fb9109863f5cd4eff4a77bda0a7abc801205aa208e40fe35ebdb1ecf60975aa307f413990da03fc1c9ba29a69b3dc3bd4f4b7eedae6c84805d423095506de81726808f35feb3ef20fa3e2b5099e4deaab9b22db023f1b27b1c2ff81fda1321e6c4342ce399f4ac2b10f7c2752367392489fc194752f9381366dad2fd8b1f2868b65de433aed4334cefd3b441871c05e08608f619971d45e79bf9a0d5ff232df570da9652b30839baa26c6e15a4882c8309de5ab9f74da1f5898ff4afd3b6b503ac99aea72c46b7fdd592be080bc8245917c44e4770d7b6bb5ebe993799a8e29d4a9b5f12849ba98b37ea2de76f9a56506864b0a43c5e2b6be6ef80dc2b5ef5e5f548245455c9dd9fac1ee1948e44185db9aed5ebd1fe199cb0fbd0c221178400d7f9301c1afb1a4741680fdec93700f5a8739eeec7711c8b315af54288bc5bc8977e42e3f6c2b7f5e21a0dbe037fcba3378519e9d18473fce838934d4f80127031e02b97137ac2a0c5dfeb3a952d49e9f579e352fe06207fa676c83e977567f528fa9137f6063fb9f78cb10ad4954b80dd29e1d519d07fff9e885a6ee28221815c33a2ecf23dc561c6caefeb42f183e822d39bd5bc336e6a6b8008c09461b7f879ff24cd93fd2da53aefb807cba272fb5a5137229a31b64896cfd3ce59628e5a51dcfc2cb1d3f3d9ab2a8c9e7491d88c4d047cd324e732512f07c68f06fa0b6bd23f55519a4aab28272bf7c04568a6eb71fb0c9d6e5bbde4a8227bfd30391654b227573cd3ba372c26337598a59ef9dac6cdbb8e0bc01441ca29e74e09c5ee3d42c14d08d7d4fb9cd7739e095ced1de8d1309a80048c1b0e0c616903017ca050a5dc447670a80ca4625320840636600c129ea3a62916d881ef9c55e82ad28a16550e9d3b07bb5f146ed7c5ea37eb10171067caed1779455cc3b79eb683ee1818963d8d25a1ddb2f948c385e76f0cfa796339cf3adea18dfe9d35d8b9f408bbd0ef86c3d8eef5d9c2fcb7ce4026f6ee8f8eef12e4846fb8b7ce45829e1341340dee3c32c48ee4b68f13286db63e21e7a346bac91b2d07161606220dbfbb1b6fb0d29be426add39a7399250c1c8ee5fdd39c9f7953cca75fb3a18735d165020fc523c6d1e86c4a6eb9d44e7964b4677b93dec4054c0b99b084e42c8b0df319f996bfb6057c8bf5cee2274c953a183b70fa93a9b1a640ba76331df342214c6042a52467c2df54b63e77b2e89c03473b46a3f07afe4e1e25b56a3c3274c7af040fcbe5cdc6dfc56b8ae4f514e6a25f9cc89cb28ace1eaa17a6cc7889cb72c03ea60d85132ec7bc4ae2ef6a52fff5a29e05a6d5946d7273a5f6aed7454af31974d9474ea51b0b711581d5d3b0506ffeb4c1f80c805bcdc59f47fcf2ae34abdfb1283de5754da0584d92333376271cbf16a532cfb1d7c5dd8c4df4a9dcd8df21973e85804afa0bbd85b02ec2b662f3efc5576eaecceba4bbc1e44d7f5808c4e4f5badc9d30d5f2793dae40f70e760c7ce3f7858c1e7d7104a6856f8a2735824af4b3d1b9fd5a8e5945c0c5ed6519c59fd02dda6b0163989ddcc92db44371ef8fb91948869093f349d8c47ad608fc4fb95218536e74f97128aba797adc2341971b911cbfa8ea11538ae1ac9b9fead9dc9c104f452ac162de238a468d588342df54df2111966b677b1c6c8529cefa251517f65fe34abd509f184fd4c433cd22a42d70fb3b4222c24b7d627261f27d2fc4a0450cdeb54a69f70a169141dd63ea1ad4a0488fce2d9855ce745780b6c21f0c13b601fe859e052704ba4fb8b424e95773ecd5830a6e8579a251db1642c5d4927a30ecffc3def8af244052d0baea32269868cb40ba558188820ca9d85607e7332622040676b9b8c3c5797c1b1add75e27e7cf045bfeb3ccec1e6e56219d43b5ab39a04f6c2ca5985f35bf517509184eba1c9fe7c527646d227d21ab956965265101a2a3ae5c87d85bfa874e209c0e3e9ff6c0c18bf88b5bb957a26013d8a68fca96414178ca76351a8dd111a4fc540b736fc5813af67068f9e77d1e35baa55a07adf55c96f79741abc692979f1861bd5053bea54a86c79d960370e10957f8ce712b568af5efc91ad11ed4de9b07fdbd81b1e29104ce31c1d7870a2ddd94abd54622ab4ad11852c94179ee0e2a8b5f00b1d216b989fa482c7a1b9e93894c5f61b12b89d7a8944ed85bcfa1de371d9bbb136c565e87bce291c8b4d9161e9140e2acc00acb2cdf27cce22bfca227bc6f1c6d1fae2e608b54f8ace6f2b3b692e6eeca80d8b3124789492dce73dac48e07ef069a7499a1eea6bf5d202459b3992a0ce58fa8b5ea5b145443ba25eb05dfcc36ade3632d8680fddcbc215180bb292e672787a0c821f10dce0c6177f1a263d94a75533413425033c98173520bf01360552a1a33139ce3374f3ae024767dea752ba471d499268c2ae2746634cda70a8b4e10cb0ce04af655df5dbb582f69751fde3b52611c5140798b0ca8ee10b4a251bddace1651575ce425e4ed0330e8999cf750cec01f70b531f4d20675af7b4cb6674fb95a5b342ca6b6a92144c32d3a91a54e4652bfa544447f5b161f4bf3b59059893f8d6cf2be79ccfe9da7eba312e8bf286b387782b255de0650e7d621321733eb753aac6c79931c1209e5492838f80ecb37745ec9f03eb1d7da1d32d932cba98a7d94d2a7af24db4d7205536b392b9aa5abeea469cec9efbff42dd9366b929026def755d55702ee0b9c71103337720677e54b78df1905d4a40d4490de74805e34fb8bbdc2a01e43adc71c41fa6bdb8adeaf0f208c99d9c4ab5d8ad11cc90f85874d16831edc013944117227194e94c8caafec3ff9e7172bf4bf8eeece9b5b6b3afa6e7a38b51e5721cae9c163fa75598b789be240b00f8f49eab5371e72273b95f57e37579ef8614506310da48808a657d67207900924656232e0d51df42ba6d429f51a3b2ce42e6e8768d328f41290429b174cde855f6471f4ec84f537d046a90fe7db7a10cd97b00b9b1d2d17ffa1cbaa67fe8dd157a32899d9bb7f1b2e8a9674f01ea15ed52f871008dd0419052cb3e5d5f248e618713fbf7364080c679d667e0dc8219bd91128376f76d7d5e4f63ca10b5bcd6eacc2b56340cf2df730e1134a7015a19e0c9b7a91e89ec09c6efb23cac8baaf6ec283a7e0bb2a85b4985f02b30cd07b3c7b1d6eff7c8823c31d4159645e3973e3ba36ffbb2ea7f0130ee82675a7f01e2e5c90c61bf0a34192d322db686237d41f6ecaac28b41836f34167b9cfac314aa9e9e94b92328764382ff1eaee077ae51e0f46f25fe86ba4b43810070bc78dc8dfa5ffdef27c8ac923e8d902c3ee0ae2e3137dfc7fe3d50a45337f8d569cf1ce622af7ca349002cdbeeb580eafb4de04957e69d2f8233c0dccdf56fe5cb7df58abc9984b9dc7bc6cb556196a89faa3cb89e05c35ead596e05117987ca18f9a777991bfc5f11daba76fed5bef002df08316067666bee0b592ec6a0dfd909052d130e477e80920048b857ef50730b8c2f3d5db09392767db4ee0909ddb86063f660bc101d29ebf1856e4283c6d5d20aaea61718bf102e7d4b52bcd39787bfce49c8fcc853675990f828b47e5e4b921dc5a073e5aa2aba1b001b997c7fa2cd1c81736876f2c30b2bda8417d5d9453b40183df9e46380b668e157bdafc832b20b8b4cd3ab3f87c3a56e6d916ac48deb13daa45f1c262740d2deccf880bedc1863601f870ce405387961c96082f268c50fa6478a7d6098f2cba7ed0b214e1743463586ac097ffac323a49d8875ab6abafbac9cc9e0603ca2bfcac8078e6afc9dcc25e4db84ae6d43130db7ce01dc5a12116c9333186ea160ba6d601f05e8043c11cbd15a98dcdd4cba5f253b57ead4709fc229ec214cff41bdc46f9d505ac4298cc63533d2fd4bff5498b8d5247e145bc2361bb3553b8011b5d87e40183d18e4dd5c70f76e97a1befd3e0ea75163d6fa187511af765ea85046894ab29549cc63bfd6c7258c1026e9f9005156f00c9da5b96b3df95466ee6dc100fefa236da9d73ef202f931acad9ed4afc463e398a31e5ec3a4b87d03774057b88d8cae00ce9fe194135e1a2a550239fc16f07cd8b32881bb86adc3652b91e256036ed8b66df2732255eb16af63ab81893aff9db87821af810740c842b7eb69b86f85a76a4f154b15e8de308d31dd06a2fe0f5d462cfdd9d5290dc2fc6ad8f1db941909db0639a847dc41dde1cfd2932456a071dd84ae2059c40f0a08eb6e556c80b7fab34ddafebc1f42ba88b70093a0160f9d00c16a55370d9f6cdf15dc2e4d4e7e60cd432b6324184f4c36c0a38de2bbda313699acb04b893e9fcca33b07e6eecbd69468245f663623b60954d3cdb5d53d285bc6f300cb9ac3340793cbac63f8414377dc6b434200d62e03201a2f17d1dd3ef069167d7f616dd556050b0c8194120d48cb7bdfe6d36e7bba93800c287e183b634c36ec360941e11071412fd7a4c80638b0e92fc6fa0936084ef8f43bd8bdbd09b4084fef56c00132d6dfb499e15cede8591ab5722469694b780e5ce9a4956ab68e82c0066aea035a114fd11acd1812a78d74f6b8c80fe7bc0da27fdb2c555a399ee8e46291f6497522730c81988da70438ca01f7db8c2900343e6623c71d101e02ad666f4256cdb40d5f0cbf4735ce4d041163249d60e62ab9c2fd9b048a22bca0317a1526427b1e77176d3779f64c6bbbc8a9d9b0b5032bb1f1915dafa786d58d222bdd29455bea7ef3b71faba7b8e1c7f8781c92c372c9a40fa97ac9e7aeb765ef27fe33063dffb271353802cf36ccfb05f21d586ec2ce9fdd1c591d8881445852a3162177dd480a48655db6c087733f7c5f2666803b7c4e158c0357650d4e9b0b15c26d30ab00ead8523bad6797c3b08653a6919ce5f8e8db473ff0789ff248332f254a0e365a5933eeac6a0616b368f87282f3595e760ed05cbe6f944c284cdcd96140e3d0d7793d073c80c6e04f3e45c355f36d9294d418bef854f55598a1e5248087881f7b61af889dd4c95e03fb6ab340d73b2d1d6b199b46ef67963d77f915614540b02d2311ad19cc0514bf78ab55ac7cc8909a494f71f7c7e3cda6506efaeffc6617bd5434e612142eb4b3b368ea3fed1b6a6520faf7c7f869b98d3829072fa246e352d27d36004ee296003eac6400d4321fbf237d8769eea72baa8e190cad72c6e9c02e132760a331b0d0b4ea335aff840ff078292a17175d8e3ffb699d22102f7738ce66441b92a718bf3b9984994c56b08a0642e7da780877e1fb4fed00cad12ff4fcc2e7dbd66c38b45612ba55cac6fc47e9bf128f26f8a28d09a0e91fef0211e6d9af898234362df68990437530d3ac287d9304d98e4d31d8291899ff28ec4f1ab9acbdffada8cbaa262a66cd8c34da4c96facec19ab1ffc821b9fef8f4a9eddb16c2d1724c8012446b1c2e14b216b544a81d00211e837b011fa7b84beca0e77be3b4f33c54c6c31775bd53a1de3caf34a16c5eb4e81b4dce4bc4c7aae19c5d0fb2bf4f6789ffc324f4683be8540add3d31d50d94d110aa869bf0f91cbcffd9d22d338142bd9d1ab662f344668c785b0165e92185508e7ffc40e4856e4faebe6da60f54f1692aba39f4800a3dcc67f2a4616d7ac15a2a964c187581b4d5b537a29a969642c3c74c4170bfde2574e1971a5ea70d4427992a2b4c9b2172cf543f6578e5375a21475035f1e5374bd986de56ab68d1273c67b51be931fbf9b462e2c322e8a1ec350fa945ff071c26e998aed07f28c608349ea66c88b55bb3db696f0bc4542fd950a797f6e4f09aef7b0cf3fb34e7950b4009abe9c7d01966dd1674aa72042b64f0515b69a09f428fbbe8140fe8f9c150460588d220c03dc3ce39eb1b909459d4e895ef4f3ef882b1cc5c2730e4fa5cc17d912b59e4798c94ef25eaf46d78ca715da3a1e898f1bc8ba86d42dab9d5c001dba69fa824c6444d49665a3c34a632326d552bec5ae16dbf6ed290ce45efda17c9d6a28f8a3ab01165978511fd541cce2d6d93b68291b44bc13cb67b85b283d36543f8d0e17e2bd8617a89c72d1a36ac5cc19683357e8cd52c7de208be6c20cf22a48bde4c5a8fafb109dcee3e40c7c8f57f2ccc9e0955394c06e79f7af7c06f38103824c777c947fe49fdf3428788cb744256410bd84f24028c928d70d4454a038c98d381d695bc307fb251f86dfe11d074e12b41e58e3c38ce16749cec2e5cee4a2d745af7ffffe416344b8588e44db7a9be1187bb3a8af7e28b1c28b8bfd070bd2691e61ead3b36486289a305351f4c3f228f8c41bf455c6f714ddcd39820258747586e8b021b9b9c5dd979923b80000343b1947347cf5b8acbaba9058cb610b277bab35f165de0d3f3e612f70fcc4d64927ba783774012ec9f5ff064f01379566652c1e162e9b7bf24810c07e84649053268075e7fcb1c93394aba032ee04b8209c9278fff05e98a3cd9de64ab9d4329738b39b0738e66ca6a8ba372f80ae4b100ad602f28033bf6097a4e0404deb848b23243fe7482ff4a249125418b5a3d947e9d0cac0a1e5037541d400a750525afa1f6c6d959045b0a0844ec61d66aa2082d35d2ddfa2763eab644fd5fc655db9d0795a85fd8240328a57e56f6c5181a3cf063fcceb00c2ee27433c093daae74a87fd26999917f660035d51be019a63b5af5a3b48abd12dc7292b1018c00ecff61b0a66b5c36cb98e2b6741b3f3bc4bf9c904017700b18d92b300473861b41b9b244f0baa0b600ae5b861b2fad9666e4a42ac240e40eb32e90a455a5f8f62f1010e9efd2c49438d680c240953f6ab2e70b6651c95b99533ff4433ff749155b6269af4b040aeffc2546ba2624c0fb9306cc3d8b89e9d7b30bba287c44e19b8c79d94898ce2a942f87b40de0d68057129d06265202f7bb87de662d1fa141770cf72c3990b20b3e7aabb918e9318f476c20cb71226c75f3eb0668d27b6920d0eba26111dd61575808b64025e2826696777a6455653a9c2649186d8c15ba88c7d9e16b6d0c5a91e2f555de5794c740c135fd4bc82e79fe64bf9c3cffaac519ac28134ab51b09b4d3179524f0faffc14287917572d2c9307504a4012feaf743f28966c13f7831f076997b2c21730fc4b98bea06b094fffc0371acec12a163c70117340cc90256788caf35255c48967cca28cefd8b99ef35eff88da45165e88597576386fecf03fa2d011882d1bb3c25e233e763e526c8a7d0445bbc43fda80dfa58a0bcbd7238d94c8fa833770dc7fdf3f604f2b4798c3003ca89189d384ca3f6eef55fe9406bc02ecaad3e7bf509bed6fa4bddd28302535db3b55316454f43366430b642eb1531f4667a67bd898ef64141af979174c0760c91d64837dc68754222aa428305a5dc22d2a9da4572972abbfc9a8b4af97149a0bd97f1b340aa74054923e792435b9c9f8436e5f414f28a9bd22a49f08495c1b7de2a45912e995b02d39be85104f7e2913344d865080925ae489e204beafd53ff838a65e07b4338f3377e4f95699f37afe4ab68f37db20b22d5be1632b9d5bcbfdcaf35c2a61d74ebc920e7c0425bfc7e46f402bf7cfec4617fc874d51ff1ed70a80d14ed4790b0a0355d83644a38dc29d2a2c701e95a2b9f999ae3551709672c5171a1555d4f44768d343a4da26febbc4d0c3ad545811972ea698d91c2d3fa94951a07041e6f5e798a7f984ff9ae769cf797c3d01c62563041ce5f99364c507c6f8e1390812ddafd8c8c3815d9b459b3ca9dec2897c85ef0947c9e652fa67b3526f30c67a3010069c0577e7ca6fb3ff1b8df2395af88464ac118fd056deb272241f336e18b28907bececdc390822fac99fdaf4506c56a299352cc83b439c6fc96fb8af81f1c83efa7b2b0c8968ffc65c8659b769131ecb3a72b893a430eac419741b3530fb43b57ee6dab9766cb47cc9287ff895ae589a170345aa27605770a7b34e411167866aba9353ff238242c229cfb68766180786496c5d4c566da6ff2e92ece159a880a6d881a0f3e074ca8f9c2ab3ef5b6f69520fbdb8d7ae65b894969a06335c19ad69d60ec071f7fe14f27a79865fab40c6c872c1c0bd7f4f60af03872041a0d33224778e34996fbb80bf539cea032b9a69c1bdcbec73dcfbd30bd206a08718cfdc24e55ab399c849b43e095aa39804d7117fb04c836a0f28c20acaf13a66ca5c85d0db0d5fd98c5fdfb0a04e3a5b8123bafb07ccb835c68ca86b2b262a3c4cb292212048cc6275fe7cf9bd99866cecf93198342a6e92d6b655f32185d0f1826c75a9fc71e4b0a336a97160c19cef049470fb9718d39bd73b28bcb32876e950b81c6b847ac7d4f55ec18107f2ab5111e23f92066cdad82219743eafbd0eb7a639fb406698045ba449a00aa7ab0bc3ac13775cc4b04e49fd33952ef8bc955070652de66292e6bce498c21ee1ab95abdb4206fb002a4dac965daa2135b51917dc5f44da5a560d8d4e1b9c1e96cd118db0f14d7e73322eb46b1d8b927d66136d82a237c97a7321a177e0f8891a7d88b857e8e35ad39d8674e5b9de4dad3ee3ebdf47540db19b5cbf6c86af85eb483dc9d0a3f3823acf13c1f333c0eacdda3d409b2615567526969</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-up">
      <input class="hbe hbe-input-field hbe-input-field-up" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-up" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-up">å½“å‰æ–‡ç« å·²åŠ å¯†ï¼Œè¯·è¾“å…¥å¯†ç æŸ¥çœ‹ ğŸ˜›ï¼š</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥å­¦ä¹ Springç»„ä»¶æ³¨å†Œ</title>
    <url>/p/4bb4364.html</url>
    <content><![CDATA[<html><head></head><body><p>æ¥è§¦è¿‡Springçš„åŒå­¦è‚¯å®šéƒ½å¬è¿‡IOCã€‚åœ¨ä¼ ç»Ÿçš„Javaç¼–ç¨‹ä¸­ï¼Œå½“éœ€è¦ç”¨åˆ°æŸä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä¸»åŠ¨æ˜¾å¼åˆ›å»ºä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼ˆnewï¼‰ã€‚ä½¿ç”¨Springåå°±ä¸éœ€è¦è¿™æ ·åšäº†ï¼Œå› ä¸ºSpringä¼šå¸®æˆ‘ä»¬åœ¨éœ€è¦ç”¨åˆ°æŸäº›å¯¹è±¡çš„åœ°æ–¹è‡ªåŠ¨æ³¨å…¥è¯¥å¯¹è±¡ï¼Œè€Œæ— é¡»æˆ‘ä»¬è‡ªå·±å»åˆ›å»ºã€‚è¿™ç§æ¨¡å¼ä¿—ç§°æ§åˆ¶åè½¬ï¼Œå³IOCï¼ˆInversion of Controlï¼‰ã€‚é‚£ä¹ˆSpringæ˜¯ä»ä»€ä¹ˆåœ°æ–¹è·å–åˆ°æˆ‘ä»¬æ‰€éœ€è¦çš„å¯¹è±¡å‘¢ï¼Ÿå…¶å®Springç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªIOCå®¹å™¨ï¼Œé‡Œé¢ç®¡ç†ç€æ‰€æœ‰æˆ‘ä»¬éœ€è¦çš„å¯¹è±¡ï¼Œç»„ä»¶æ³¨å†Œå°±æ˜¯æˆ‘ä»¬å»å‘Šè¯‰Springå“ªäº›ç±»éœ€è¦äº¤ç»™IOCå®¹å™¨ç®¡ç†ã€‚</p>
<p>è¿™é‡Œä¸»è¦è®°å½•ç»„ä»¶æ³¨å†Œçš„ä¸€äº›ç»†èŠ‚ã€‚</p>
<h2 id="é€šè¿‡-Beanæ³¨å†Œç»„ä»¶"><a href="#é€šè¿‡-Beanæ³¨å†Œç»„ä»¶" class="headerlink" title="é€šè¿‡@Beanæ³¨å†Œç»„ä»¶"></a>é€šè¿‡@Beanæ³¨å†Œç»„ä»¶</h2><p>åœ¨è¾ƒæ—©ç‰ˆæœ¬çš„Springä¸­ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡XMLçš„æ–¹å¼æ¥å¾€IOCå®¹å™¨ä¸­æ³¨å†Œç»„ä»¶çš„ï¼Œä¸‹é¢è¿™æ®µä»£ç å¤§å®¶è‚¯å®šä¸ä¼šé™Œç”Ÿï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// è¿”å› IOC å®¹å™¨ï¼ŒåŸºäº XMLé…ç½®ï¼Œä¼ å…¥é…ç½®æ–‡ä»¶çš„ä½ç½®</span></span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">"xxx.xml"</span>);</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) applicationContext.getBean(<span class="string">"user"</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>Spring 4åæ¨èæˆ‘ä»¬ä½¿ç”¨Java Configçš„æ–¹å¼æ¥æ³¨å†Œç»„ä»¶ã€‚</p>
<p>ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬é€šè¿‡<a href="http://start.spring.io/%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95Spring">http://start.spring.io/æ­å»ºä¸€ä¸ªç®€å•Spring</a> Bootåº”ç”¨ï¼Œç„¶åå¼•å…¥Lombokä¾èµ–ï¼ˆç¼–è¾‘å™¨ä¹Ÿéœ€è¦å®‰è£…Lombokæ’ä»¶ï¼‰ï¼š</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>ç„¶ååˆ›å»ºä¸€ä¸ªUserç±»ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ¥ç€åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œåœ¨é‡Œé¢é€šè¿‡<code>@Bean</code>æ³¨è§£æ³¨å†ŒUserç±»ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"mrdjun"</span>, <span class="number">18</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>é€šè¿‡<code>@Bean</code>æ³¨è§£ï¼Œæˆ‘ä»¬å‘IOCå®¹å™¨æ³¨å†Œäº†ä¸€ä¸ªåç§°ä¸º<code>user</code>ï¼ˆBeanåç§°é»˜è®¤ä¸ºæ–¹æ³•åï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡<code>@Bean("myUser")</code>æ–¹å¼æ¥å°†ç»„ä»¶åç§°æŒ‡å®šä¸º<code>myUser</code>ï¼‰ã€‚</p>
<p>ç»„ä»¶æ³¨å†Œå®Œæ¯•åï¼Œæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ä»IOCå®¹å™¨ä¸­è·å–è¿™ä¸ªç»„ä»¶ã€‚åœ¨Spring Bootå…¥å£ç±»ä¸­ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">    	SpringApplication.run(DemoApplication.class, args);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿”å› IOC å®¹å™¨ï¼Œä½¿ç”¨æ³¨è§£é…ç½®ï¼Œä¼ å…¥é…ç½®ç±»</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(WebConfig.class);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> context.getBean(User.class);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å› ä¸ºæˆ‘ä»¬æ˜¯é€šè¿‡æ³¨è§£æ–¹å¼æ¥æ³¨å†Œç»„ä»¶çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨<code>AnnotationConfigApplicationContext</code>æ¥è·å–ç›¸åº”çš„IOCå®¹å™¨ï¼Œå…¥å‚ä¸ºé…ç½®ç±»ã€‚</p>
<p>å¯åŠ¨é¡¹ç›®ï¼Œçœ‹ä¸‹æ§åˆ¶å°è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">User(name=mrdjun, age=18)</span><br></pre></td></tr></tbody></table></figure>

<p>è¯´æ˜ç»„ä»¶æ³¨å†ŒæˆåŠŸã€‚</p>
<p>æˆ‘ä»¬å°†ç»„ä»¶çš„åç§°æ”¹ä¸º<code>myUser</code>ï¼Œç„¶åçœ‹çœ‹IOCå®¹å™¨ä¸­ï¼ŒUserç±»å‹ç»„ä»¶æ˜¯å¦å«<code>myUser</code>ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line"></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(WebConfig.class);</span><br><span class="line">        <span class="comment">// æŸ¥çœ‹ User è¿™ä¸ªç±»åœ¨ Spring å®¹å™¨ä¸­å«å•¥ç©æ„</span></span><br><span class="line">        String[] beanNames = context.getBeanNamesForType(User.class);</span><br><span class="line">        Arrays.stream(beanNames).forEach(System.out::println);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿæ§åˆ¶å°è¾“å‡º:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">myUser</span><br></pre></td></tr></tbody></table></figure>

<h2 id="ä½¿ç”¨-ComponentScanæ‰«æ"><a href="#ä½¿ç”¨-ComponentScanæ‰«æ" class="headerlink" title="ä½¿ç”¨@ComponentScanæ‰«æ"></a>ä½¿ç”¨@ComponentScanæ‰«æ</h2><p>åœ¨ä½¿ç”¨XMLé…ç½®ç»„ä»¶æ‰«æçš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½æ˜¯è¿™æ ·é…ç½®çš„ï¼š</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>å…¶ä¸­<code>base-package</code>æŒ‡å®šäº†æ‰«æçš„è·¯å¾„ã€‚è·¯å¾„ä¸‹æ‰€æœ‰è¢«<code>@Controller</code>ã€<code>@Service</code>ã€<code>@Repository</code>å’Œ<code>@Component</code>æ³¨è§£æ ‡æ³¨çš„ç±»éƒ½ä¼šè¢«çº³å…¥IOCå®¹å™¨ä¸­ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬è„±ç¦»XMLé…ç½®åï¼Œå¯ä»¥ä½¿ç”¨<code>@ComponentScan</code>æ³¨è§£æ¥æ‰«æç»„ä»¶å¹¶æ³¨å†Œã€‚</p>
<p>åœ¨ä½¿ç”¨<code>@ComponentScan</code>æ‰«æä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªControllerï¼Œä¸€ä¸ªServiceï¼Œä¸€ä¸ªDaoï¼Œå¹¶æ ‡æ³¨ä¸Šç›¸åº”çš„æ³¨è§£ã€‚</p>
<p>ç„¶åä¿®æ”¹é…ç½®ç±»ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan("com.mrdjun.demo")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">// @Bean("myUser")</span></span><br><span class="line">    <span class="comment">// public User user() {</span></span><br><span class="line">    <span class="comment">//     return new User("mrdjun", 18);</span></span><br><span class="line">    <span class="comment">// }</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨é…ç½®ç±»ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡<code>@ComponentScan("com.mrdjun.demo")</code>é…ç½®äº†æ‰«æè·¯å¾„ï¼Œå¹¶ä¸”å°†Userç»„ä»¶æ³¨å†Œæ³¨é‡Šæ‰äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯åœ¨Userç±»ä¸ŠåŠ ä¸Š<code>@Component</code>æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½å°†Spring Bootçš„å…¥å£ç±»çº³å…¥æ‰«æèŒƒå›´ä¸­ï¼Œå¦åˆ™é¡¹ç›®å¯åŠ¨å°†å‡ºé”™ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹åœ¨åŸºäºæ³¨è§£çš„IOCå®¹å™¨ä¸­æ˜¯å¦åŒ…å«äº†è¿™äº›ç»„ä»¶ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line"></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(WebConfig.class);</span><br><span class="line">        <span class="comment">// æŸ¥çœ‹åŸºäºæ³¨è§£çš„ IOCå®¹å™¨ä¸­æ‰€æœ‰ç»„ä»¶åç§°</span></span><br><span class="line">        String[] beanNames = context.getBeanDefinitionNames();</span><br><span class="line">        Arrays.stream(beanNames).forEach(System.out::println);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿæ§åˆ¶å°ï¼š</p>
<p><img src="/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20181207164418.png" alt="QQæˆªå›¾20181207164418.png"></p>
<p>å¯è§ï¼Œç»„ä»¶å·²ç»æˆåŠŸè¢«æ‰«æè¿›å»äº†ï¼Œå¹¶ä¸”åç§°é»˜è®¤ä¸ºç±»åé¦–å­—æ¯å°å†™ã€‚</p>
<p>è¿™é‡Œï¼Œé…ç½®ç±»WebConfigä¹Ÿè¢«æ‰«æå¹¶æ³¨å†Œäº†ï¼ŒæŸ¥çœ‹<code>@Configuration</code>æºç å°±ä¼šå‘ç°åŸå› ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Configuration {</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">""</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="æŒ‡å®šæ‰«æç­–ç•¥"><a href="#æŒ‡å®šæ‰«æç­–ç•¥" class="headerlink" title="æŒ‡å®šæ‰«æç­–ç•¥"></a>æŒ‡å®šæ‰«æç­–ç•¥</h3><p><code>@ComponentScan</code>æ³¨è§£å…è®¸æˆ‘ä»¬æŒ‡å®šæ‰«æç­–ç•¥ï¼Œå³æŒ‡å®šå“ªäº›è¢«æ‰«æï¼Œå“ªäº›ä¸è¢«æ‰«æï¼ŒæŸ¥çœ‹å…¶æºç å¯å‘ç°è¿™ä¸¤ä¸ªå±æ€§ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Specifies which types are eligible for component scanning.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Further narrows the set of candidate components from everything in {<span class="doctag">@link</span> #basePackages}</span></span><br><span class="line"><span class="comment"> * to everything in the base packages that matches the given filter or filters.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Note that these filters will be applied in addition to the default filters, if specified.</span></span><br><span class="line"><span class="comment"> * Any type under the specified base packages which matches a given filter will be included,</span></span><br><span class="line"><span class="comment"> * even if it does not match the default filters (i.e. is not annotated with {<span class="doctag">@code</span> <span class="doctag">@Component</span>}).</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #resourcePattern()</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #useDefaultFilters()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Filter[] includeFilters() <span class="keyword">default</span> {};</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Specifies which types are not eligible for component scanning.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #resourcePattern</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Filter[] excludeFilters() <span class="keyword">default</span> {};</span><br></pre></td></tr></tbody></table></figure>

<p>å…¶ä¸­<code>Filter</code>ä¹Ÿæ˜¯ä¸€ä¸ªæ³¨è§£:</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Declares the type filter to be used as an {<span class="doctag">@linkplain</span> ComponentScan#includeFilters</span></span><br><span class="line"><span class="comment"> * include filter} or {<span class="doctag">@linkplain</span> ComponentScan#excludeFilters exclude filter}.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target({})</span></span><br><span class="line"><span class="meta">@interface</span> Filter {</span><br><span class="line"></span><br><span class="line">    FilterType <span class="title function_">type</span><span class="params">()</span> <span class="keyword">default</span> FilterType.ANNOTATION;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AliasFor("classes")</span></span><br><span class="line">    Class&lt;?&gt;[] value() <span class="keyword">default</span> {};</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AliasFor("value")</span></span><br><span class="line">    Class&lt;?&gt;[] classes() <span class="keyword">default</span> {};</span><br><span class="line">    String[] pattern() <span class="keyword">default</span> {};</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨<code>excludeFilters</code>æ¥æ’é™¤ä¸€äº›ç»„ä»¶çš„æ‰«æï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(value = "com.mrdjun.demo",</span></span><br><span class="line"><span class="meta">        excludeFilters = {</span></span><br><span class="line"><span class="meta">                @Filter(type = FilterType.ANNOTATION,</span></span><br><span class="line"><span class="meta">                        classes = {Controller.class, Repository.class}),</span></span><br><span class="line"><span class="meta">                @Filter(type = FilterType.ASSIGNABLE_TYPE, classes = User.class)</span></span><br><span class="line"><span class="meta">        })</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸Šé¢æˆ‘ä»¬æŒ‡å®šäº†ä¸¤ç§æ’é™¤æ‰«æçš„è§„åˆ™ï¼š</p>
<ol>
<li>æ ¹æ®æ³¨è§£æ¥æ’é™¤ï¼ˆ<code>type = FilterType.ANNOTATION</code>ï¼‰,è¿™äº›æ³¨è§£çš„ç±»å‹ä¸º<code>classes = {Controller.class, Repository.class}</code>ã€‚å³<code>Controller</code>å’Œ<code>Repository</code>æ³¨è§£æ ‡æ³¨çš„ç±»ä¸å†è¢«çº³å…¥åˆ°IOCå®¹å™¨ä¸­ã€‚</li>
<li>æ ¹æ®æŒ‡å®šç±»å‹ç±»æ’é™¤ï¼ˆ<code>type = FilterType.ASSIGNABLE_TYPE</code>ï¼‰ï¼Œæ’é™¤ç±»å‹ä¸º<code>User.class</code>ï¼Œå…¶å­ç±»ï¼Œå®ç°ç±»éƒ½ä¼šè¢«æ’é™¤ã€‚</li>
</ol>
<p>å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿæ§åˆ¶å°ï¼š</p>
<p><img src="/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190129103606.png" alt="QQæˆªå›¾20190129095439.png"></p>
<p>å¯è§æ’é™¤æˆåŠŸã€‚</p>
<p>é™¤äº†ä¸Šé¢ä¸¤ç§å¸¸ç”¨çš„è§„åˆ™å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨åˆ«çš„è§„åˆ™ï¼ŒæŸ¥çœ‹<code>FilterType</code>æºç ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">FilterType</span> {</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Filter candidates marked with a given annotation.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> org.springframework.core.type.filter.AnnotationTypeFilter</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ANNOTATION,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Filter candidates assignable to a given type.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> org.springframework.core.type.filter.AssignableTypeFilter</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ASSIGNABLE_TYPE,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Filter candidates matching a given AspectJ type pattern expression.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> org.springframework.core.type.filter.AspectJTypeFilter</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ASPECTJ,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Filter candidates matching a given regex pattern.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> org.springframework.core.type.filter.RegexPatternTypeFilter</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    REGEX,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Filter candidates using a given custom</span></span><br><span class="line"><span class="comment">     * {<span class="doctag">@link</span> org.springframework.core.type.filter.TypeFilter} implementation.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    CUSTOM</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å¯çœ‹åˆ°ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡<code>ASPECTJ</code>è¡¨è¾¾å¼ï¼Œ<code>REGEX</code>æ­£åˆ™è¡¨è¾¾å¼å’Œ<code>CUSTOM</code>è‡ªå®šä¹‰è§„åˆ™ï¼ˆä¸‹é¢è¯¦ç»†ä»‹ç»ï¼‰æ¥æŒ‡å®šæ‰«æç­–ç•¥ã€‚</p>
<p><code>includeFilters</code>çš„ä½œç”¨å’Œ<code>excludeFilters</code>ç›¸åï¼Œå…¶æŒ‡å®šçš„æ˜¯å“ªäº›ç»„ä»¶éœ€è¦è¢«æ‰«æï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(value = "com.mrdjun.demo",</span></span><br><span class="line"><span class="meta">        includeFilters = {</span></span><br><span class="line"><span class="meta">                @Filter(type = FilterType.ANNOTATION, classes = Service.class)</span></span><br><span class="line"><span class="meta">        }, useDefaultFilters = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸Šé¢é…ç½®äº†åªå°†<code>Service</code>çº³å…¥IOCå®¹å™¨ï¼Œå¹¶ä¸”éœ€è¦ç”¨<code>useDefaultFilters = false</code>æ¥å…³é—­Springé»˜è®¤çš„æ‰«æç­–ç•¥æ‰èƒ½è®©æˆ‘ä»¬çš„é…ç½®ç”Ÿæ•ˆï¼ˆSpring Bootå…¥å£ç±»çš„<code>@SpringBootApplication</code>æ³¨è§£åŒ…å«äº†ä¸€äº›é»˜è®¤çš„æ‰«æç­–ç•¥ï¼‰ã€‚</p>
<p>å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿæ§åˆ¶å°ï¼š</p>
<p><img src="/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190129100306.png" alt="QQæˆªå›¾20190129100306.png"></p>
<p>å¯çœ‹åˆ°ï¼ŒIOCå®¹å™¨ä¸­å°†ä¸å†åŒ…å«daoï¼Œcontrollerã€‚</p>
<h3 id="å¤šæ‰«æç­–ç•¥é…ç½®"><a href="#å¤šæ‰«æç­–ç•¥é…ç½®" class="headerlink" title="å¤šæ‰«æç­–ç•¥é…ç½®"></a>å¤šæ‰«æç­–ç•¥é…ç½®</h3><p>åœ¨Java 8ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>@ComponentScans</code>æ¥é…ç½®å¤šä¸ª<code>@ComponentScan</code>ä»¥å®ç°å¤šæ‰«æè§„åˆ™é…ç½®ï¼š</p>
<p><img src="/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190129100809.png" alt="QQæˆªå›¾20190129100809.png"></p>
<p>è€Œåœ¨Java 8ä¸­ï¼Œæ–°å¢äº†<code>@Repeatable</code>æ³¨è§£ï¼Œä½¿ç”¨è¯¥æ³¨è§£ä¿®é¥°çš„æ³¨è§£å¯ä»¥é‡å¤ä½¿ç”¨ï¼ŒæŸ¥çœ‹<code>@ComponentScan</code>æºç ä¼šå‘ç°å…¶å·²ç»è¢«è¯¥æ³¨è§£æ ‡æ³¨ï¼š</p>
<p><img src="/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190129101050.png" alt="QQæˆªå›¾20190129101050.png"></p>
<p>æ‰€ä»¥é™¤äº†ä½¿ç”¨<code>@ComponentScans</code>æ¥é…ç½®å¤šæ‰«æè§„åˆ™å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å¤šæ¬¡ä½¿ç”¨<code>@ComponentScan</code>æ¥æŒ‡å®šå¤šä¸ªä¸åŒçš„æ‰«æè§„åˆ™ã€‚</p>
<h3 id="è‡ªå®šä¹‰æ‰«æç­–ç•¥"><a href="#è‡ªå®šä¹‰æ‰«æç­–ç•¥" class="headerlink" title="è‡ªå®šä¹‰æ‰«æç­–ç•¥"></a>è‡ªå®šä¹‰æ‰«æç­–ç•¥</h3><p>è‡ªå®šä¹‰æ‰«æç­–ç•¥éœ€è¦æˆ‘ä»¬å®ç°<code>org.springframework.core.type.filter.TypeFilter</code>æ¥å£ï¼Œåˆ›å»º<code>MyTypeFilter</code>å®ç°è¯¥æ¥å£ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTypeFilter</span> <span class="keyword">implements</span> <span class="title class_">TypeFilter</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">match</span><span class="params">(MetadataReader metadataReader, MetadataReaderFactory metadataReaderFactory)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¯¥æ¥å£åŒ…å«<code>match</code>æ–¹æ³•ï¼Œå…¶ä¸¤ä¸ªå…¥å‚<code>MetadataReader</code>å’Œ<code>MetadataReaderFactory</code>å«ä¹‰å¦‚ä¸‹ï¼š</p>
<ol>
<li><code>MetadataReader</code>ï¼šå½“å‰æ­£åœ¨æ‰«æçš„ç±»çš„ä¿¡æ¯ï¼›</li>
<li><code>MetadataReaderFactory</code>ï¼šå¯ä»¥é€šè¿‡å®ƒæ¥è·å–å…¶ä»–ç±»çš„ä¿¡æ¯ã€‚</li>
</ol>
<p>å½“<code>match</code>æ–¹æ³•è¿”å›trueæ—¶è¯´æ˜åŒ¹é…æˆåŠŸï¼Œfalseåˆ™è¯´æ˜åŒ¹é…å¤±è´¥ã€‚ç»§ç»­å®Œå–„è¿™ä¸ªè¿‡æ»¤è§„åˆ™ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTypeFilter</span> <span class="keyword">implements</span> <span class="title class_">TypeFilter</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">match</span><span class="params">(MetadataReader metadataReader, MetadataReaderFactory metadataReaderFactory)</span> {</span><br><span class="line">        <span class="comment">// è·å–å½“å‰æ­£åœ¨æ‰«æçš„ç±»çš„æ³¨è§£ä¿¡æ¯</span></span><br><span class="line">        <span class="type">AnnotationMetadata</span> <span class="variable">annotationMetadata</span> <span class="operator">=</span> metadataReader.getAnnotationMetadata();</span><br><span class="line">        <span class="comment">// è·å–å½“å‰æ­£åœ¨æ‰«æçš„ç±»çš„ç±»ä¿¡æ¯</span></span><br><span class="line">        <span class="type">ClassMetadata</span> <span class="variable">classMetadata</span> <span class="operator">=</span> metadataReader.getClassMetadata();</span><br><span class="line">        <span class="comment">// è·å–å½“å‰æ­£åœ¨æ‰«æçš„ç±»çš„è·¯å¾„ç­‰ä¿¡æ¯</span></span><br><span class="line">        <span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> metadataReader.getResource();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> classMetadata.getClassName();</span><br><span class="line">        <span class="keyword">return</span> StringUtils.hasText(<span class="string">"er"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸Šé¢æŒ‡å®šäº†å½“è¢«æ‰«æçš„ç±»ååŒ…å«<code>er</code>æ—¶å€™ï¼ŒåŒ¹é…æˆåŠŸï¼Œé…åˆ<code>excludeFilters</code>ä½¿ç”¨æ„æŒ‡å½“è¢«æ‰«æçš„ç±»ååŒ…å«<code>er</code>æ—¶ï¼Œè¯¥ç±»ä¸è¢«çº³å…¥IOCå®¹å™¨ä¸­ã€‚</p>
<p>æˆ‘ä»¬åœ¨<code>@ComponentScan</code>ä¸­ä½¿ç”¨è¿™ä¸ªè‡ªå®šä¹‰çš„è¿‡æ»¤ç­–ç•¥ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(value = "com.mrdjun.demo",</span></span><br><span class="line"><span class="meta">        excludeFilters = {</span></span><br><span class="line"><span class="meta">            @Filter(type = FilterType.CUSTOM, classes = MyTypeFilter.class)</span></span><br><span class="line"><span class="meta">        })</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿè¾“å‡ºï¼š</p>
<p><img src="/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190129112811.png" alt="QQæˆªå›¾20190129112811.png"></p>
<p>å› ä¸º<code>User</code>ï¼Œ<code>UserMapper</code>ï¼Œ<code>UserService</code>å’Œ<code>UserController</code>ç­‰ç±»çš„ç±»åéƒ½åŒ…å«<code>er</code>ï¼Œæ‰€ä»¥å®ƒä»¬éƒ½æ²¡æœ‰è¢«çº³å…¥åˆ°IOCå®¹å™¨ä¸­ã€‚</p>
<h2 id="ç»„ä»¶ä½œç”¨åŸŸ-Scope"><a href="#ç»„ä»¶ä½œç”¨åŸŸ-Scope" class="headerlink" title="ç»„ä»¶ä½œç”¨åŸŸ@Scope"></a>ç»„ä»¶ä½œç”¨åŸŸ@Scope</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨Springçš„IOCå®¹å™¨ä¸­æ¯ä¸ªç»„ä»¶éƒ½æ˜¯å•ä¾‹çš„ï¼Œå³æ— è®ºåœ¨ä»»ä½•åœ°æ–¹æ³¨å…¥å¤šå°‘æ¬¡ï¼Œè¿™äº›å¯¹è±¡éƒ½æ˜¯åŒä¸€ä¸ªï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä¾‹å­ã€‚</p>
<p>é¦–å…ˆå°†Userå¯¹è±¡ä¸­çš„<code>@Component</code>æ³¨è§£å»é™¤ï¼Œç„¶ååœ¨é…ç½®ç±»ä¸­é…ç½®User Beanï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"mrdjun"</span>, <span class="number">18</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ¥ç€å¤šæ¬¡ä»IOCå®¹å™¨ä¸­è·å–è¿™ä¸ªç»„ä»¶ï¼Œçœ‹çœ‹æ˜¯å¦ä¸ºåŒä¸€ä¸ªï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// è¿”å› IOC å®¹å™¨ï¼Œä½¿ç”¨æ³¨è§£é…ç½®ï¼Œä¼ å…¥é…ç½®ç±»</span></span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(WebConfig.class);</span><br><span class="line"><span class="type">Object</span> <span class="variable">user1</span> <span class="operator">=</span> context.getBean(<span class="string">"user"</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">user2</span> <span class="operator">=</span> context.getBean(<span class="string">"user"</span>);</span><br><span class="line"><span class="comment">// è¾“å‡ºtrue</span></span><br><span class="line">System.out.println(user1 == user2);</span><br></pre></td></tr></tbody></table></figure>

<p>ç»“æœè¯å®äº†ä¸Šé¢çš„è§‚ç‚¹ã€‚</p>
<p>åœ¨Springä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>@Scope</code>æ³¨è§£æ¥æ”¹å˜ç»„ä»¶çš„ä½œç”¨åŸŸï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * When used as a type-level annotation in conjunction with</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@link</span> org.springframework.stereotype.Component <span class="doctag">@Component</span>},</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@code</span> <span class="doctag">@Scope</span>} indicates the name of a scope to use for instances of</span></span><br><span class="line"><span class="comment"> * the annotated type.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;When used as a method-level annotation in conjunction with</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@link</span> Bean <span class="doctag">@Bean</span>}, {<span class="doctag">@code</span> <span class="doctag">@Scope</span>} indicates the name of a scope to use</span></span><br><span class="line"><span class="comment"> * for the instance returned from the method.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;&lt;b&gt;<span class="doctag">NOTE:</span>&lt;/b&gt; {<span class="doctag">@code</span> <span class="doctag">@Scope</span>} annotations are only introspected on the</span></span><br><span class="line"><span class="comment"> * concrete bean class (for annotated components) or the factory method</span></span><br><span class="line"><span class="comment"> * (for {<span class="doctag">@code</span> <span class="doctag">@Bean</span>} methods). In contrast to XML bean definitions,</span></span><br><span class="line"><span class="comment"> * there is no notion of bean definition inheritance, and inheritance</span></span><br><span class="line"><span class="comment"> * hierarchies at the class level are irrelevant for metadata purposes.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;In this context, &lt;em&gt;scope&lt;/em&gt; means the lifecycle of an instance,</span></span><br><span class="line"><span class="comment"> * such as {<span class="doctag">@code</span> singleton}, {<span class="doctag">@code</span> prototype}, and so forth. Scopes</span></span><br><span class="line"><span class="comment"> * provided out of the box in Spring may be referred to using the</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@code</span> SCOPE_*} constants available in the {<span class="doctag">@link</span> ConfigurableBeanFactory}</span></span><br><span class="line"><span class="comment"> * and {<span class="doctag">@code</span> WebApplicationContext} interfaces.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;To register additional custom scopes, see</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@link</span> org.springframework.beans.factory.config.CustomScopeConfigurer</span></span><br><span class="line"><span class="comment"> * CustomScopeConfigurer}.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mark Fisher</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Chris Beams</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Sam Brannen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2.5</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.stereotype.Component</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.context.annotation.Bean</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target({ElementType.TYPE, ElementType.METHOD})</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Scope {</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Alias for {<span class="doctag">@link</span> #scopeName}.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> #scopeName</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@AliasFor("scopeName")</span></span><br><span class="line">	String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Specifies the name of the scope to use for the annotated component/bean.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Defaults to an empty string ({<span class="doctag">@code</span> ""}) which implies</span></span><br><span class="line"><span class="comment">	 * {<span class="doctag">@link</span> ConfigurableBeanFactory#SCOPE_SINGLETON SCOPE_SINGLETON}.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@since</span> 4.2</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> ConfigurableBeanFactory#SCOPE_PROTOTYPE</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> ConfigurableBeanFactory#SCOPE_SINGLETON</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> org.springframework.web.context.WebApplicationContext#SCOPE_REQUEST</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> org.springframework.web.context.WebApplicationContext#SCOPE_SESSION</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> #value</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@AliasFor("value")</span></span><br><span class="line">	String <span class="title function_">scopeName</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Specifies whether a component should be configured as a scoped proxy</span></span><br><span class="line"><span class="comment">	 * and if so, whether the proxy should be interface-based or subclass-based.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Defaults to {<span class="doctag">@link</span> ScopedProxyMode#DEFAULT}, which typically indicates</span></span><br><span class="line"><span class="comment">	 * that no scoped proxy should be created unless a different default</span></span><br><span class="line"><span class="comment">	 * has been configured at the component-scan instruction level.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Analogous to {<span class="doctag">@code</span> &lt;aop:scoped-proxy/&gt;} support in Spring XML.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> ScopedProxyMode</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	ScopedProxyMode <span class="title function_">proxyMode</span><span class="params">()</span> <span class="keyword">default</span> ScopedProxyMode.DEFAULT;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li><code>singleton</code>ï¼šå•å®ä¾‹ï¼ˆé»˜è®¤ï¼‰,åœ¨Spring IOCå®¹å™¨å¯åŠ¨çš„æ—¶å€™ä¼šè°ƒç”¨æ–¹æ³•åˆ›å»ºå¯¹è±¡ç„¶åçº³å…¥åˆ°IOCå®¹å™¨ä¸­ï¼Œä»¥åæ¯æ¬¡è·å–éƒ½æ˜¯ç›´æ¥ä»IOCå®¹å™¨ä¸­è·å–ï¼ˆ<code>map.get()</code>ï¼‰ï¼›</li>
<li><code>prototype</code>ï¼šå¤šå®ä¾‹ï¼ŒIOCå®¹å™¨å¯åŠ¨çš„æ—¶å€™å¹¶ä¸ä¼šå»åˆ›å»ºå¯¹è±¡ï¼Œè€Œæ˜¯åœ¨æ¯æ¬¡è·å–çš„æ—¶å€™æ‰ä¼šå»è°ƒç”¨æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼›</li>
<li><code>request</code>ï¼šä¸€ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ªå®ä¾‹ï¼›</li>
<li><code>session</code>ï¼šåŒä¸€ä¸ªsessionå¯¹åº”ä¸€ä¸ªå®ä¾‹ã€‚</li>
</ol>
<h2 id="æ‡’åŠ è½½-Lazy"><a href="#æ‡’åŠ è½½-Lazy" class="headerlink" title="æ‡’åŠ è½½@Lazy"></a>æ‡’åŠ è½½@Lazy</h2><p>æ‡’åŠ è½½æ˜¯é’ˆå¯¹å•ä¾‹æ¨¡å¼è€Œè¨€çš„ï¼Œæ­£å¦‚å‰é¢æ‰€è¯´ï¼ŒIOCå®¹å™¨ä¸­çš„ç»„ä»¶é»˜è®¤æ˜¯å•ä¾‹çš„ï¼Œå®¹å™¨å¯åŠ¨çš„æ—¶å€™ä¼šè°ƒç”¨æ–¹æ³•åˆ›å»ºå¯¹è±¡ç„¶åçº³å…¥åˆ°IOCå®¹å™¨ä¸­ã€‚</p>
<p>åœ¨User Beanæ³¨å†Œçš„åœ°æ–¹åŠ å…¥ä¸€å¥è¯ä»¥è§‚å¯Ÿï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"å¾€IOCå®¹å™¨ä¸­æ³¨å†Œuser bean"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"mrdjun"</span>, <span class="number">18</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(WebConfig.class);</span><br><span class="line">System.out.println(<span class="string">"å®¹å™¨åˆ›å»ºå®Œæ¯•"</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®è§‚å¯Ÿæ§åˆ¶å°è¾“å‡º:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">å¾€IOCå®¹å™¨ä¸­æ³¨å†Œuser bean</span><br><span class="line">å®¹å™¨åˆ›å»ºå®Œæ¯•</span><br></pre></td></tr></tbody></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨IOCå®¹å™¨åˆ›å»ºå®Œæ¯•ä¹‹å‰ï¼Œç»„ä»¶å·²ç»æ·»åŠ åˆ°å®¹å™¨ä¸­äº†ã€‚</p>
<p>å°†User Beanæ”¹ä¸ºæ‡’åŠ è½½çš„æ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Lazy</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"å¾€IOCå®¹å™¨ä¸­æ³¨å†Œuser bean"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"mrdjun"</span>, <span class="number">18</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å†æ¬¡å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿè¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">å®¹å™¨åˆ›å»ºå®Œæ¯•</span><br></pre></td></tr></tbody></table></figure>

<p>å¯çœ‹åˆ°ï¼Œå®¹å™¨åˆ›å»ºå®Œçš„æ—¶å€™ï¼ŒUser Beanè¿™ä¸ªç»„ä»¶å¹¶æœªæ·»åŠ åˆ°å®¹å™¨ä¸­ã€‚</p>
<p>æ‰€ä»¥æ‡’åŠ è½½çš„åŠŸèƒ½æ˜¯ï¼Œåœ¨å•ä¾‹æ¨¡å¼ä¸­ï¼ŒIOCå®¹å™¨åˆ›å»ºçš„æ—¶å€™ä¸ä¼šé©¬ä¸Šå»è°ƒç”¨æ–¹æ³•åˆ›å»ºå¯¹è±¡å¹¶æ³¨å†Œï¼Œåªæœ‰å½“ç»„ä»¶<strong>ç¬¬ä¸€æ¬¡</strong>è¢«ä½¿ç”¨çš„æ—¶å€™æ‰ä¼šè°ƒç”¨æ–¹æ³•åˆ›å»ºå¯¹è±¡å¹¶åŠ å…¥åˆ°å®¹å™¨ä¸­ã€‚</p>
<p>æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(WebConfig.class);</span><br><span class="line">System.out.println(<span class="string">"å®¹å™¨åˆ›å»ºå®Œæ¯•"</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">user1</span> <span class="operator">=</span> context.getBean(<span class="string">"user"</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">user2</span> <span class="operator">=</span> context.getBean(<span class="string">"user"</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿè¾“å‡º:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">å®¹å™¨åˆ›å»ºå®Œæ¯•</span><br><span class="line">å¾€IOCå®¹å™¨ä¸­æ³¨å†Œuser bean</span><br></pre></td></tr></tbody></table></figure>

<p>ç»“æœè¯å®äº†æˆ‘ä»¬çš„è§‚ç‚¹ã€‚</p>
<h2 id="æ¡ä»¶æ³¨å†Œç»„ä»¶"><a href="#æ¡ä»¶æ³¨å†Œç»„ä»¶" class="headerlink" title="æ¡ä»¶æ³¨å†Œç»„ä»¶"></a>æ¡ä»¶æ³¨å†Œç»„ä»¶</h2><h3 id="Conditional"><a href="#Conditional" class="headerlink" title="@Conditional"></a>@Conditional</h3><p>ä½¿ç”¨<code>@Conditional</code>æ³¨è§£æˆ‘ä»¬å¯ä»¥æŒ‡å®šç»„ä»¶æ³¨å†Œçš„æ¡ä»¶ï¼Œå³æ»¡è¶³ç‰¹å®šæ¡ä»¶æ‰å°†ç»„ä»¶çº³å…¥åˆ°IOCå®¹å™¨ä¸­ã€‚</p>
<p>åœ¨ä½¿ç”¨è¯¥æ³¨è§£ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç°<code>Condition</code>æ¥å£ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCondition</span> <span class="keyword">implements</span> <span class="title class_">Condition</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¯¥æ¥å£åŒ…å«ä¸€ä¸ª<code>matches</code>æ–¹æ³•ï¼ŒåŒ…å«ä¸¤ä¸ªå…¥å‚:</p>
<ol>
<li><code>ConditionContext</code>ï¼šä¸Šä¸‹æ–‡ä¿¡æ¯ï¼›</li>
<li><code>AnnotatedTypeMetadata</code>ï¼šæ³¨è§£ä¿¡æ¯ã€‚</li>
</ol>
<p>ç®€å•å®Œå–„ä¸€ä¸‹è¿™ä¸ªå®ç°ç±»:</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCondition</span> <span class="keyword">implements</span> <span class="title class_">Condition</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">osName</span> <span class="operator">=</span> context.getEnvironment().getProperty(<span class="string">"os.name"</span>);</span><br><span class="line">        <span class="keyword">return</span> osName != <span class="literal">null</span> &amp;&amp; osName.contains(<span class="string">"Windows"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ¥ç€å°†è¿™ä¸ªæ¡ä»¶æ·»åŠ åˆ°User Beanæ³¨å†Œçš„åœ°æ–¹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Conditional(MyCondition.class)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"mrdjun"</span>, <span class="number">18</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨Windowsç¯å¢ƒä¸‹ï¼ŒUserè¿™ä¸ªç»„ä»¶å°†è¢«æˆåŠŸæ³¨å†Œï¼Œå¦‚æœæ˜¯åˆ«çš„æ“ä½œç³»ç»Ÿï¼Œè¿™ä¸ªç»„ä»¶å°†ä¸ä¼šè¢«æ³¨å†Œåˆ°IOCå®¹å™¨ä¸­ã€‚</p>
<h3 id="Profile"><a href="#Profile" class="headerlink" title="@Profile"></a>@Profile</h3><p><code>@Profile</code>å¯ä»¥æ ¹æ®ä¸åŒçš„ç¯å¢ƒå˜é‡æ¥æ³¨å†Œä¸åŒçš„ç»„ä»¶ï¼Œä¸‹é¢æˆ‘ä»¬æ¥å­¦ä¸€ä¸‹å®ƒçš„ç”¨æ³•ã€‚</p>
<p>æ–°å»ºä¸€ä¸ªæ¥å£<code>CalculateService</code>ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CalculateService</span> {</span><br><span class="line">    Integer <span class="title function_">sum</span><span class="params">(Integer... value)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ¥ç€æ·»åŠ ä¸¤ä¸ªå®ç°<code>Java7CalculateServiceImpl</code>å’Œ<code>Java8CalculateServiceImpl</code>:</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Profile("java7")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Java7CalculateServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CalculateService</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">sum</span><span class="params">(Integer... value)</span> {</span><br><span class="line">        System.out.println(<span class="string">"Java 7ç¯å¢ƒä¸‹æ‰§è¡Œ"</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= value.length; i++) {</span><br><span class="line">            result += i;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Profile("java8")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Java8CalculateServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CalculateService</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">sum</span><span class="params">(Integer... value)</span> {</span><br><span class="line">        System.out.println(<span class="string">"Java 8ç¯å¢ƒä¸‹æ‰§è¡Œ"</span>);</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(value).reduce(<span class="number">0</span>, Integer::sum);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>é€šè¿‡<code>@Profile</code>æ³¨è§£æˆ‘ä»¬å®ç°äº†ï¼šå½“ç¯å¢ƒå˜é‡åŒ…å«<code>java7</code>çš„æ—¶å€™ï¼Œ<code>Java7CalculateServiceImpl</code>å°†ä¼šè¢«æ³¨å†Œåˆ°IOCå®¹å™¨ä¸­ï¼›å½“ç¯å¢ƒå˜é‡åŒ…å«<code>java8</code>çš„æ—¶å€™ï¼Œ<code>Java8CalculateServiceImpl</code>å°†ä¼šè¢«æ³¨å†Œåˆ°IOCå®¹å™¨ä¸­ã€‚</p>
<p>æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">ConfigurableApplicationContext</span> <span class="variable">context1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringApplicationBuilder</span>(DemoApplication.class)</span><br><span class="line">                .web(WebApplicationType.NONE)</span><br><span class="line">                .profiles(<span class="string">"java8"</span>)</span><br><span class="line">                .run(args);</span><br><span class="line"></span><br><span class="line"><span class="type">CalculateService</span> <span class="variable">service</span> <span class="operator">=</span> context1.getBean(CalculateService.class);</span><br><span class="line">System.out.println(<span class="string">"æ±‚åˆç»“æœï¼š "</span> + service.sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>));</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">The following profiles are active: java8</span><br><span class="line">Java 8ç¯å¢ƒä¸‹æ‰§è¡Œ</span><br><span class="line">æ±‚å’Œç»“æœï¼š   55</span><br></pre></td></tr></tbody></table></figure>

<p>å¦‚æœå°†<code>.profiles("java8")</code>æ”¹ä¸º<code>.profiles("java7")</code>çš„è¯ï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">The following profiles are active: java7</span><br><span class="line">Java 7ç¯å¢ƒä¸‹æ‰§è¡Œ</span><br><span class="line">æ±‚å’Œç»“æœï¼š   55</span><br></pre></td></tr></tbody></table></figure>

<h2 id="å¯¼å…¥ç»„ä»¶"><a href="#å¯¼å…¥ç»„ä»¶" class="headerlink" title="å¯¼å…¥ç»„ä»¶"></a>å¯¼å…¥ç»„ä»¶</h2><h3 id="Import"><a href="#Import" class="headerlink" title="@Import"></a>@Import</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒ…æ‰«æå’Œ<code>@Bean</code>æ¥å®ç°ç»„ä»¶æ³¨å†Œã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<code>@Import</code>æ¥å¿«é€Ÿåœ°å¾€IOCå®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»<code>Hello</code>ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hello</span> {}</span><br></pre></td></tr></tbody></table></figure>

<p>ç„¶ååœ¨é…ç½®ç±»ä¸­å¯¼å…¥è¿™ä¸ªç»„ä»¶ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import({Hello.class})</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line">	...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æŸ¥çœ‹IOCå®¹å™¨ä¸­æ‰€æœ‰ç»„ä»¶çš„åç§°ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(WebConfig.class);</span><br><span class="line">String[] beanNames = context.getBeanDefinitionNames();</span><br><span class="line">Arrays.stream(beanNames).forEach(System.out::println);</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œæ§åˆ¶å°è¾“å‡º:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">...</span><br><span class="line">webConfig</span><br><span class="line">com.mrdjun.demo.domain.Hello</span><br><span class="line">user</span><br></pre></td></tr></tbody></table></figure>

<p>å¯çœ‹åˆ°ï¼Œé€šè¿‡<code>@Import</code>æˆ‘ä»¬å¯ä»¥å¿«é€Ÿåœ°å¾€IOCå®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ï¼ŒIdé»˜è®¤ä¸ºå…¨ç±»åã€‚</p>
<h3 id="ImportSelector"><a href="#ImportSelector" class="headerlink" title="ImportSelector"></a>ImportSelector</h3><p>é€šè¿‡<code>@Import</code>æˆ‘ä»¬å·²ç»å®ç°äº†ç»„ä»¶çš„å¯¼å…¥ï¼Œå¦‚æœéœ€è¦ä¸€æ¬¡æ€§å¯¼å…¥è¾ƒå¤šç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>ImportSelector</code>æ¥å®ç°ã€‚</p>
<p>æ–°å¢ä¸‰ä¸ªç±»<code>Apple</code>ï¼Œ<code>Banana</code>å’Œ<code>Watermelon</code>ï¼Œä»£ç ç•¥ã€‚</p>
<p>æŸ¥çœ‹<code>ImportSelector</code>æºç ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ImportSelector</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Select and return the names of which class(es) should be imported based on</span></span><br><span class="line"><span class="comment">     * the {<span class="doctag">@link</span> AnnotationMetadata} of the importing @{<span class="doctag">@link</span> Configuration} class.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">     String[] selectImports(AnnotationMetadata importingClassMetadata);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>ImportSelector</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼ŒåŒ…å«ä¸€ä¸ª<code>selectImports</code>æ–¹æ³•ï¼Œæ–¹æ³•è¿”å›ç±»çš„å…¨ç±»åæ•°ç»„ï¼ˆå³éœ€è¦å¯¼å…¥åˆ°IOCå®¹å™¨ä¸­ç»„ä»¶çš„å…¨ç±»åæ•°ç»„ï¼‰ï¼ŒåŒ…å«ä¸€ä¸ª<code>AnnotationMetadata</code>ç±»å‹å…¥å‚ï¼Œé€šè¿‡è¿™ä¸ªå‚æ•°æˆ‘ä»¬å¯ä»¥è·å–åˆ°ä½¿ç”¨<code>ImportSelector</code>çš„ç±»çš„å…¨éƒ¨æ³¨è§£ä¿¡æ¯ã€‚</p>
<p>æˆ‘ä»¬æ–°å»ºä¸€ä¸ª<code>ImportSelector</code>å®ç°ç±»<code>MyImportSelector</code>ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportSelector</span> <span class="keyword">implements</span> <span class="title class_">ImportSelector</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]{</span><br><span class="line">                <span class="string">"com.mrdjun.demo.domain.Apple"</span>,</span><br><span class="line">                <span class="string">"com.mrdjun.demo.domain.Banana"</span>,</span><br><span class="line">                <span class="string">"com.mrdjun.demo.domain.Watermelon"</span></span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸Šé¢æ–¹æ³•è¿”å›äº†æ–°å¢çš„ä¸‰ä¸ªç±»çš„å…¨ç±»åæ•°ç»„ï¼Œæ¥ç€æˆ‘ä»¬åœ¨é…ç½®ç±»çš„<code>@Import</code>æ³¨è§£ä¸Šä½¿ç”¨<code>MyImportSelector</code>æ¥æŠŠè¿™ä¸‰ä¸ªç»„ä»¶å¿«é€Ÿåœ°å¯¼å…¥åˆ°IOCå®¹å™¨ä¸­ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Import({MyImportSelector.class})</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æŸ¥çœ‹å®¹å™¨ä¸­æ˜¯å¦å·²ç»æœ‰è¿™ä¸‰ä¸ªç»„ä»¶:</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(WebConfig.class);</span><br><span class="line">String[] beanNames = context.getBeanDefinitionNames();</span><br><span class="line">Arrays.stream(beanNames).forEach(System.out::println);</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿæ§åˆ¶å°ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">com.mrdjun.demo.domain.Apple</span><br><span class="line">com.mrdjun.demo.domain.Banana</span><br><span class="line">com.mrdjun.demo.domain.Watermelon</span><br></pre></td></tr></tbody></table></figure>

<p>ç»„ä»¶å·²ç»æˆåŠŸå¯¼å…¥ã€‚</p>
<h3 id="ImportBeanDefinitionRegistrar"><a href="#ImportBeanDefinitionRegistrar" class="headerlink" title="ImportBeanDefinitionRegistrar"></a>ImportBeanDefinitionRegistrar</h3><p>é™¤äº†ä¸Šé¢ä¸¤ç§å¾€IOCå®¹å™¨å¯¼å…¥ç»„ä»¶çš„æ–¹æ³•å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<code>ImportBeanDefinitionRegistrar</code>æ¥æ‰‹åŠ¨å¾€IOCå®¹å™¨å¯¼å…¥ç»„ä»¶ã€‚</p>
<p>æŸ¥çœ‹å…¶æºç ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ImportBeanDefinitionRegistrar</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>ImportBeanDefinitionRegistrar</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼ŒåŒ…å«ä¸€ä¸ª<code>registerBeanDefinitions</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åŒ…å«ä¸¤ä¸ªå…¥å‚ï¼š</p>
<ol>
<li><code>AnnotationMetadata</code>ï¼šå¯ä»¥é€šè¿‡å®ƒè·å–åˆ°ç±»çš„æ³¨è§£ä¿¡æ¯ï¼›</li>
<li><code>BeanDefinitionRegistry</code>ï¼šBeanå®šä¹‰æ³¨å†Œå™¨ï¼ŒåŒ…å«äº†ä¸€äº›å’ŒBeanæœ‰å…³çš„æ–¹æ³•ï¼š</li>
</ol>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanDefinitionRegistry</span> <span class="keyword">extends</span> <span class="title class_">AliasRegistry</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">registerBeanDefinition</span><span class="params">(String var1, BeanDefinition var2)</span> <span class="keyword">throws</span> BeanDefinitionStoreException;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">removeBeanDefinition</span><span class="params">(String var1)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException;</span><br><span class="line"></span><br><span class="line">    BeanDefinition <span class="title function_">getBeanDefinition</span><span class="params">(String var1)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">containsBeanDefinition</span><span class="params">(String var1)</span>;</span><br><span class="line"></span><br><span class="line">    String[] getBeanDefinitionNames();</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getBeanDefinitionCount</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isBeanNameInUse</span><span class="params">(String var1)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©<code>BeanDefinitionRegistry</code>çš„<code>registerBeanDefinition</code>æ–¹æ³•æ¥å¾€IOCå®¹å™¨ä¸­æ³¨å†ŒBeanã€‚è¯¥æ–¹æ³•åŒ…å«ä¸¤ä¸ªå…¥å‚ï¼Œç¬¬ä¸€ä¸ªä¸ºéœ€è¦æ³¨å†Œçš„Beanåç§°ï¼ˆIdï¼‰,ç¬¬äºŒä¸ªå‚æ•°ä¸ºBeançš„å®šä¹‰ä¿¡æ¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶å®ç°ç±»<code>RootBeanDefinition</code>æ¥å®Œæˆï¼š</p>
<p><img src="/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190130094046.png" alt="QQæˆªå›¾20190130094046.png"></p>
<p>ä¸ºäº†æ¼”ç¤º<code>ImportBeanDefinitionRegistrar</code>çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬å…ˆæ–°å¢ä¸€ä¸ªç±»ï¼Œåç§°ä¸º<code>Strawberry</code>ï¼Œä»£ç ç•¥ã€‚</p>
<p>ç„¶åæ–°å¢ä¸€ä¸ª<code>ImportBeanDefinitionRegistrar</code>å®ç°ç±»<code>MyImportBeanDefinitionRegistrar</code>ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportBeanDefinitionRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> {</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> <span class="string">"strawberry"</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">contain</span> <span class="operator">=</span> registry.containsBeanDefinition(beanName);</span><br><span class="line">        <span class="keyword">if</span> (!contain) {</span><br><span class="line">            <span class="type">RootBeanDefinition</span> <span class="variable">rootBeanDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>(Strawberry.class);</span><br><span class="line">            registry.registerBeanDefinition(beanName, rootBeanDefinition);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨ä¸Šé¢çš„å®ç°ç±»ä¸­ï¼Œæˆ‘ä»¬å…ˆé€šè¿‡<code>BeanDefinitionRegistry</code>çš„<code>containsBeanDefinition</code>æ–¹æ³•åˆ¤æ–­IOCå®¹å™¨ä¸­æ˜¯å¦åŒ…å«äº†åç§°ä¸º<code>strawberry</code>çš„ç»„ä»¶ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ‰‹åŠ¨é€šè¿‡<code>BeanDefinitionRegistry</code>çš„<code>registerBeanDefinition</code>æ–¹æ³•æ³¨å†Œä¸€ä¸ªã€‚</p>
<p>å®šä¹‰å¥½<code>MyImportBeanDefinitionRegistrar</code>åï¼Œæˆ‘ä»¬åŒæ ·åœ°åœ¨é…ç½®ç±»çš„<code>@Import</code>ä¸­ä½¿ç”¨å®ƒï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import({MyImportBeanDefinitionRegistrar.class})</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æŸ¥çœ‹å®¹å™¨ä¸­æ˜¯å¦å·²ç»æœ‰è¿™ä¸ªç»„ä»¶:</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(WebConfig.class);</span><br><span class="line">String[] beanNames = context.getBeanDefinitionNames();</span><br><span class="line">Arrays.stream(beanNames).forEach(System.out::println);</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿæ§åˆ¶å°ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">strawberry</span><br></pre></td></tr></tbody></table></figure>

<p>ç»„ä»¶å·²ç»æ³¨å†ŒæˆåŠŸã€‚</p>
<h2 id="ä½¿ç”¨FactoryBeanæ³¨å†Œç»„ä»¶"><a href="#ä½¿ç”¨FactoryBeanæ³¨å†Œç»„ä»¶" class="headerlink" title="ä½¿ç”¨FactoryBeanæ³¨å†Œç»„ä»¶"></a>ä½¿ç”¨FactoryBeanæ³¨å†Œç»„ä»¶</h2><p>Springè¿˜æä¾›äº†ä¸€ä¸ª<code>FactoryBean</code>æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°è¯¥æ¥å£æ¥æ³¨å†Œç»„ä»¶ï¼Œè¯¥æ¥å£åŒ…å«äº†ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•å’Œä¸€ä¸ªé»˜è®¤æ–¹æ³•ï¼š</p>
<p><img src="/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190130103346.png" alt="QQæˆªå›¾20190130103346.png"></p>
<p>ä¸ºäº†æ¼”ç¤º<code>FactoryBean</code>çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬æ–°å¢ä¸€ä¸ª<code>Cherry</code>ç±»ï¼Œä»£ç ç•¥ã€‚</p>
<p>ç„¶ååˆ›å»º<code>FactoryBean</code>çš„å®ç°ç±»<code>CherryFactoryBean</code>:</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CherryFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;Cherry&gt; {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Cherry <span class="title function_">getObject</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Cherry</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() {</span><br><span class="line">        <span class="keyword">return</span> Cherry.class;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>getObject</code>è¿”å›éœ€è¦æ³¨å†Œçš„ç»„ä»¶å¯¹è±¡ï¼Œ<code>getObjectType</code>è¿”å›éœ€è¦æ³¨å†Œçš„ç»„ä»¶ç±»å‹ï¼Œ<code>isSingleton</code>æŒ‡æ˜è¯¥ç»„ä»¶æ˜¯å¦ä¸ºå•ä¾‹ã€‚å¦‚æœä¸ºå¤šä¾‹çš„è¯ï¼Œæ¯æ¬¡ä»å®¹å™¨ä¸­è·å–è¯¥ç»„ä»¶éƒ½ä¼šè°ƒç”¨å…¶<code>getObject</code>æ–¹æ³•ã€‚</p>
<p>å®šä¹‰å¥½<code>CherryFactoryBean</code>åï¼Œæˆ‘ä»¬åœ¨é…ç½®ç±»ä¸­æ³¨å†Œè¿™ä¸ªç±»ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> CherryFactoryBean <span class="title function_">cherryFactoryBean</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CherryFactoryBean</span>();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æµ‹è¯•ä»å®¹å™¨ä¸­è·å–ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(WebConfig.class);</span><br><span class="line"><span class="type">Object</span> <span class="variable">cherry</span> <span class="operator">=</span> context.getBean(<span class="string">"cherryFactoryBean"</span>);</span><br><span class="line">System.out.println(cherry.getClass());</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">class com.mrdjun.demo.domain.Cherry</span><br></pre></td></tr></tbody></table></figure>

<p>å¯çœ‹åˆ°ï¼Œè™½ç„¶æˆ‘ä»¬è·å–çš„æ˜¯Idä¸º<code>cherryFactoryBean</code>çš„ç»„ä»¶ï¼Œä½†å…¶è·å–åˆ°çš„å®é™…æ˜¯<code>getObject</code>æ–¹æ³•é‡Œè¿”å›çš„å¯¹è±¡ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬è¦è·å–<code>cherryFactoryBean</code>æœ¬èº«ï¼Œåˆ™å¯ä»¥è¿™æ ·åšï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">cherryFactoryBean</span> <span class="operator">=</span> context.getBean(<span class="string">"&amp;cherryFactoryBean"</span>);</span><br><span class="line">System.out.println(cherryFactoryBean.getClass());</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿæ§åˆ¶å°ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">class com.mrdjun.demo.factory.CherryFactoryBean</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸ºä»€ä¹ˆåŠ ä¸Š<code>&amp;</code>å‰ç¼€å°±å¯ä»¥è·å–åˆ°ç›¸åº”çš„å·¥å‚ç±»äº†å‘¢ï¼ŒæŸ¥çœ‹<code>BeanFactory</code>çš„æºç ä¼šå‘ç°åŸå› :</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanFactory</span> {</span><br><span class="line">    <span class="type">String</span> <span class="variable">FACTORY_BEAN_PREFIX</span> <span class="operator">=</span> <span class="string">"&amp;"</span>;</span><br><span class="line">	...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
</body></html>]]></content>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>JSPä¸Servlet</title>
    <url>/p/931edf21.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="JSPè¿è¡ŒåŸç†"><a href="#JSPè¿è¡ŒåŸç†" class="headerlink" title="JSPè¿è¡ŒåŸç†"></a>JSPè¿è¡ŒåŸç†</h2><ol>
<li>å®¢æˆ·ç«¯é€šè¿‡æµè§ˆå™¨å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œåœ¨è¯¥è¯·æ±‚ä¸­åŒ…å«äº†è¯·æ±‚çš„èµ„æºçš„è·¯å¾„ï¼Œè¿™æ ·å½“æœåŠ¡å™¨æ¥æ”¶åˆ°è¯¥è¯·æ±‚åå°±å¯ä»¥çŸ¥é“è¢«è¯·æ±‚çš„å†…å®¹ã€‚</li>
<li>æœåŠ¡å™¨æ ¹æ®æ¥æ”¶åˆ°çš„å®¢æˆ·ç«¯çš„è¯·æ±‚æ¥åŠ è½½ç›¸åº”çš„JSPæ–‡ä»¶ã€‚</li>
<li>WebæœåŠ¡å™¨ä¸­çš„JSPå¼•æ“ä¼šå°†è¢«åŠ è½½çš„JSPæ–‡ä»¶è½¬åŒ–ä¸ºServletæ–‡ä»¶(.java)ã€‚</li>
<li>JSPå¼•æ“å°†ç”Ÿæˆçš„Servletä»£ç ç¼–è¯‘æˆClassæ–‡ä»¶ã€‚</li>
<li>æœåŠ¡å™¨æ‰§è¡Œè¿™ä¸ªClassæ–‡ä»¶ã€‚</li>
<li>æœ€åæœåŠ¡å™¨å°†æ‰§è¡Œç»“æœå‘é€ç»™æµè§ˆå™¨è¿›è¡Œæ˜¾ç¤ºã€‚</li>
</ol>
<p><img src="/p/931edf21/JSP%E7%9A%84%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86.png" alt="image-20210413234913992"></p>
<p><img src="/p/931edf21/JSP%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86-HTML%E7%94%9F%E6%88%90%E5%8E%9F%E7%90%86.png" alt="image-20210413235547555"></p>
<h2 id="Servlet-çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#Servlet-çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Servlet çš„ç”Ÿå‘½å‘¨æœŸ"></a>Servlet çš„ç”Ÿå‘½å‘¨æœŸ</h2><p><img src="/p/931edf21/Servlet%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png" alt="image-20210414113222266"></p>
<p>åœ¨Servletä¸­ï¼Œinit æ–¹æ³•åªä¼šåœ¨å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œä¸€æ¬¡ã€‚</p>
<p>åœ¨ä½¿ç”¨Servletç¼–å†™ä¸šåŠ¡ä»£ç æ—¶ï¼Œæ— è®ºæ˜¯æŒ‰ç…§é¡µé¢åˆ†ï¼Œè¿˜æ˜¯ä¸šåŠ¡åŒºåˆ†ï¼Œéƒ½æ— æ³•é¿å…Servletå’Œweb.xmlè¿‡å¤šçš„é—®é¢˜ã€‚è€Œä¸”è¿™ç§ç»“æ„è¿˜ä¸åˆ©äºå›¢é˜Ÿå¼€å‘ã€‚</p>
<p>Spring MVC ä»…é€šè¿‡DispatherServlet è¿›è¡Œè¯·æ±‚æ´¾å‘ï¼Œé€šè¿‡ä»¥ä¸‹ä¸‰ç‚¹å‡å°‘Servletçš„æ•°é‡ï¼š</p>
<ul>
<li>æ‹¦æˆªæ‰€æœ‰è¯·æ±‚</li>
<li>è§£æè¯·æ±‚</li>
<li>æ´¾å‘ç»™å¯¹åº”çš„Controlleré‡Œé¢çš„æ–¹æ³•è¿›è¡Œå¤„ç†</li>
</ul>
<h2 id="Springçš„ä½œç”¨åŸŸ"><a href="#Springçš„ä½œç”¨åŸŸ" class="headerlink" title="Springçš„ä½œç”¨åŸŸ"></a>Springçš„ä½œç”¨åŸŸ</h2><ul>
<li><p>singletonï¼šåœ¨spring IOCå®¹å™¨ä¸­ä»…å­˜åœ¨ä¸€ä¸ªBeanå®ä¾‹,Beanä»¥å•å®ä¾‹çš„æ–¹å¼å­˜åœ¨ã€‚</p>
</li>
<li><p>prototypeï¼šæ¯æ¬¡ä»å®¹å™¨ä¸­è°ƒç”¨Beanæ—¶,éƒ½è¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹,å³æ¯æ¬¡è°ƒç”¨getBean()æ—¶,ç›¸å½“äºæ‰§è¡Œnew XxxBean()çš„æ“ä½œã€‚</p>
</li>
<li><p>requestï¼šæ¯æ¬¡HTTPè¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Bean,è¯¥ä½œç”¨åŸŸä»…é€‚ç”¨äºwebApplicationContextç¯å¢ƒã€‚</p>
</li>
<li><p>sessionï¼šåŒä¸€ä¸ªHTTP sessionå…±äº«ä¸€ä¸ªBean,ä¸åŒHTTP sessionä½¿ç”¨ä¸åŒçš„Bean,è¯¥ä½œç”¨åŸŸä»…é€‚ç”¨äºwebApplicationContextç¯å¢ƒã€‚</p>
</li>
<li><p>globalsessionï¼šåŒä¸€ä¸ªå…¨å±€sessionå…±äº«ä¸€ä¸ªBean,ä¸€èˆ¬ç”¨äºportletåº”ç”¨ç¯å¢ƒ,è¯¥ä½œç”¨åŸŸä»…é€‚ç”¨äºwebApplicationContextç¯å¢ƒã€‚</p>
</li>
</ul>
</body></html>]]></content>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootè‡ªåŠ¨è£…é…çš„åŸç†</title>
    <url>/p/b2efd41c.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="Spring-Bootä¸­çš„è‡ªåŠ¨è£…é…"><a href="#Spring-Bootä¸­çš„è‡ªåŠ¨è£…é…" class="headerlink" title="Spring Bootä¸­çš„è‡ªåŠ¨è£…é…"></a>Spring Bootä¸­çš„è‡ªåŠ¨è£…é…</h2><p>æ·»åŠ Starterä¾èµ–</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>é…ç½®Redisæ•°æ®æº</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">spring.redis.host</span>=<span class="string">localhost</span></span><br><span class="line"><span class="attr">spring.redis.port</span>=<span class="string">6379</span></span><br></pre></td></tr></tbody></table></figure>

<p>åˆ›å»ºä¸€ä¸ªController</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RedisTemplate&lt;String,String&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/test")</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">()</span>{</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">"hello"</span>,<span class="string">"Spring Boot"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™å°±æ˜¯ä¸€ä¸ªSpring Bootçš„è£…é…æœºåˆ¶ï¼Œæˆ‘ä»¬æ²¡æœ‰é€šè¿‡XMLå½¢å¼æˆ–è€…æ³¨è§£çš„å½¢å¼æŠŠRedisTemplateæ³¨å…¥åˆ°IOCå®¹å™¨ï¼Œä½†æ˜¯åœ¨Controllerä¸­å¯ä»¥ç›´æ¥é€šè¿‡@Autowiredæ¥ç›´æ¥æ³¨å…¥ä½¿ç”¨ã€‚</p>
<h2 id="è‡ªåŠ¨è£…é…æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"><a href="#è‡ªåŠ¨è£…é…æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ" class="headerlink" title="è‡ªåŠ¨è£…é…æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"></a>è‡ªåŠ¨è£…é…æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestDemoApplication</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        SpringApplication.run(TestDemoApplication.class, args);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç‚¹è¿› @SpringBootApplication è¿™ä¸ªæ³¨è§£å»çœ‹ä¸‹ï¼Œ@SpringBootApplication æ³¨è§£ä¸»è¦ç”±ä¸‰ä¸ªæ³¨è§£ç»„æˆï¼š@ComponentScanã€@SpringBootConfigurationã€**@EnableAutoConfiguration**ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Target({ElementType.TYPE})</span> <span class="comment">//æ¥å£ã€ç±»ã€æšä¸¾ã€æ³¨è§£</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span> <span class="comment">//è¿™ç§ç±»å‹çš„Annotationså°†è¢«JVMä¿ç•™,æ‰€ä»¥ä»–ä»¬èƒ½åœ¨è¿è¡Œæ—¶è¢«JVMæˆ–å…¶ä»–ä½¿ç”¨åå°„æœºåˆ¶çš„ä»£ç æ‰€è¯»å–å’Œä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="meta">@Documented</span> <span class="comment">// è¯´æ˜è¯¥æ³¨è§£å°†è¢«åŒ…å«åœ¨javadocä¸­</span></span><br><span class="line"><span class="meta">@Inherited</span> <span class="comment">// è¯´æ˜å­ç±»å¯ä»¥ç»§æ‰¿çˆ¶ç±»ä¸­çš„è¯¥æ³¨è§£</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(</span></span><br><span class="line"><span class="meta">    excludeFilters = {@Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = {TypeExcludeFilter.class}</span></span><br><span class="line"><span class="meta">), @Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = {AutoConfigurationExcludeFilter.class}</span></span><br><span class="line"><span class="meta">)}</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication {</span><br><span class="line"> 		...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å†ç»§ç»­ç‚¹è¿›å» @EnableAutoConfiguration æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Target({ElementType.TYPE})</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@AutoConfigurationPackage</span> <span class="comment">// æŠŠä½¿ç”¨äº†è¯¥æ³¨è§£çš„ç±»æ‰€åœ¨çš„åŒ…åŠå­åŒ…ä¸‹æ‰€æœ‰ç»„ä»¶æ‰«æåˆ°Spring IOCå®¹å™¨ä¸­</span></span><br><span class="line"><span class="meta">@Import({AutoConfigurationImportSelector.class})</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration {</span><br><span class="line">    <span class="type">String</span> <span class="variable">ENABLED_OVERRIDE_PROPERTY</span> <span class="operator">=</span> <span class="string">"spring.boot.enableautoconfiguration"</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] exclude() <span class="keyword">default</span> {};</span><br><span class="line"></span><br><span class="line">    String[] excludeName() <span class="keyword">default</span> {};</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨@EnableAutoConfigurationä¸­æœ€é‡è¦çš„æ˜¯ **@Import({AutoConfigurationImportSelector.class}) **æ³¨è§£ã€‚@Import å°† AutoConfigurationImportSelector è¿™ä¸ªç±»å¯¼å…¥ï¼Œç‚¹è¿›è¿™ä¸ªç±»ä¸€çœ‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoConfigurationImportSelector</span> <span class="keyword">implements</span> <span class="title class_">DeferredImportSelector</span>,***{}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeferredImportSelector</span> <span class="keyword">extends</span> <span class="title class_">ImportSelector</span> {}</span><br></pre></td></tr></tbody></table></figure>

<p>å®ç°äº† DeferredImportSelector æ¥å£ï¼Œè€Œ DeferredImportSelector æ˜¯ç»§æ‰¿ ImportSelector ç±»çš„ã€‚åœ¨ ImportSelector  ä¸­æœ‰ä¸ªéå¸¸é‡è¦çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// æ‰¹é‡å°†ç±»æ³¨å…¥åˆ°IOCå®¹å™¨</span></span><br><span class="line">String[] selectImports(AnnotationMetadata var1);</span><br></pre></td></tr></tbody></table></figure>


<p><strong>å¦‚ä½•åˆ©ç”¨ ImportSelector è£…é…ç±»åˆ°IOCå®¹å™¨ä¸­å»</strong><br>é¦–å…ˆåˆ›å»ºä¸€ä¸ªç±»TestClass</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestClass</span> {</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åˆ›å»ºä¸€ä¸ªImportSelectorçš„å®ç°ç±»ï¼Œåœ¨å®ç°ç±»ä¸­æŠŠå®šä¹‰çš„BeanåŠ å…¥Stringæ•°æ®ä¸­ï¼ˆå› ä¸ºImportSelectorå¯ä»¥å®ç°æ‰¹é‡è£…é…ï¼Œè¿™é‡Œç”¨ä¸€ä¸ªæ¥ä¸¾ä¾‹ï¼Œå¤šä¸ªé€—å·åˆ†éš”å°±å¥½ï¼‰ï¼Œè¯¥Beanå°†ä¼šè£…é…åˆ°IOCå®¹å™¨ä¸­</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestImportSelector</span> <span class="keyword">implements</span> <span class="title class_">ImportSelector</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]{TestClass.class.getName()};</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸ºäº†æ¨¡æ‹Ÿ EnableAutoConfigurationï¼Œæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼Œé€šè¿‡@Importå¯¼å…¥</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span> </span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span> </span><br><span class="line"><span class="meta">@Documented</span> </span><br><span class="line"><span class="meta">@Inherited</span> </span><br><span class="line"><span class="meta">@AutoConfigurationPackage</span> <span class="comment">//æ·»åŠ è¯¥æ³¨è§£çš„ç±»æ‰€åœ¨çš„package ä½œä¸º è‡ªåŠ¨é…ç½®package è¿›è¡Œç®¡ç†</span></span><br><span class="line"><span class="meta">@Import(TestImportSelector.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoImport {</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç„¶ååˆ›å»ºä¸€ä¸ªå¯åŠ¨ç±»ï¼Œåœ¨å¯åŠ¨ç±»ä¸Šä½¿ç”¨@EnableAutoImportæ³¨è§£ï¼Œå³å¯é€šè¿‡getBeanä»IOCå®¹å™¨ä¸­å¾—åˆ°TestClasså®ä¾‹</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableAutoImport</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ImportSelectorMain</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">configurableApplicationContext</span> <span class="operator">=</span> SpringApplication.run(ImportSelectorMain.class,args);</span><br><span class="line">        <span class="type">TestClass</span> <span class="variable">testClass</span> <span class="operator">=</span> configurableApplicationContext.getBean(TestClass.class);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è‡ªåŠ¨è£…é…çš„åŸç†æ˜¯é€šè¿‡ä¸»è¦ç»„æˆ@SpringBootApplicationæ³¨è§£çš„@SpringBootConfigurationã€@EnableAutoConfigurationã€@ComponentScanä¸‰ä¸ªæ³¨è§£ä¸­çš„@EnableAutoConfiguration ä¸­é€šè¿‡ @Import({AutoConfigurationImportSelector.class}) å¯¼å…¥çš„AutoConfigurationImportSelectorå®ç°çš„ selectImports æ–¹æ³•æ¥å®ç°æ‰¹é‡è£…é…çš„ã€‚</p>
<p>ä¸Šé¢è¿™ä¸ªé—®é¢˜å›ç­”ä¸Šäº†ä¹‹åï¼Œæœ‰äº›é¢è¯•å®˜ä¼šæ·±å…¥é—®ä¸‹é¢è¿™ä¸ªé—®é¢˜ï¼š</p>
<h2 id="è£…é…-application-properties-yml"><a href="#è£…é…-application-properties-yml" class="headerlink" title="è£…é… application.properties/yml"></a>è£…é… application.properties/yml</h2><p>åœ¨autoconfigureåŒ…ä¸‹æœ‰ä¸ªç±» ServletWebServerFactoryAutoConfigurationï¼Œè¿™ä¸ªæ˜¯SpringBoot è‡ªåŠ¨è£…é… Servlet é…ç½®çš„ç±»ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.boot.autoconfigure.web.servlet; <span class="comment">// åŒ…è·¯å¾„</span></span><br><span class="line"><span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">    proxyBeanMethods = false</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(-2147483648)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass({ServletRequest.class})</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(</span></span><br><span class="line"><span class="meta">    type = Type.SERVLET</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties({ServerProperties.class})</span></span><br><span class="line"><span class="meta">@Import({ServletWebServerFactoryAutoConfiguration.BeanPostProcessorsRegistrar.class, EmbeddedTomcat.class, EmbeddedJetty.class, EmbeddedUndertow.class})</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletWebServerFactoryAutoConfiguration</span> {}</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨SpringMVCä¸­ @EnableConfigurationProperties æ˜¯ä¸€ä¸ªéå¸¸ç†Ÿæ‚‰çš„ç±»ï¼Œä¸Šé¢ä¼šå°†ServerProperties ç±»ä¸­çš„ä¸€äº›é…ç½®åŠ è½½åˆ°å½“å‰ç±»ä¸­ï¼Œç‚¹è¿› ServletPropertiesï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(</span></span><br><span class="line"><span class="meta">    prefix = "server",</span></span><br><span class="line"><span class="meta">    ignoreUnknownFields = true</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerProperties</span> {}</span><br></pre></td></tr></tbody></table></figure>

<p>@ConfigurationProperties å°†é…ç½®æ–‡ä»¶çš„å±æ€§å¯¹åº”çš„å€¼è¯»å…¥åˆ° ServerProperties è¿™ä¸ªç±»ä¸­ï¼Œprefix=â€œserverâ€ ä¼šè¯»å– application.properties ä¸­å‰ç¼€ä¸º server çš„å±æ€§å’Œå€¼ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootæ³¨è§£@Conditional</title>
    <url>/p/dc1803fb.html</url>
    <content><![CDATA[<html><head></head><body><h2 id="Conditional"><a href="#Conditional" class="headerlink" title="@Conditional"></a>@Conditional</h2><p>ä½œç”¨ï¼šæŒ‰ç…§ä¸€å®šçš„æ¡ä»¶è¿›è¡Œåˆ¤æ–­ï¼Œæ»¡è¶³æ¡ä»¶æ‰åœ¨å®¹å™¨æ³¨å†Œbeanã€‚</p>
<p>è¿™æ˜¯Spring4æ–°æä¾›çš„æ³¨è§£ï¼Œå®šä¹‰ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//æ­¤æ³¨è§£å¯ä»¥æ ‡æ³¨åœ¨ç±»å’Œæ–¹æ³•ä¸Š</span></span><br><span class="line"><span class="meta">@Target({ElementType.TYPE, ElementType.METHOD})</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span> </span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Conditional {</span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Condition</span>&gt;[] value();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>éœ€è¦å†™ä¸€ä¸ªç±»å»ç»§æ‰¿ Condition æ¥å£ï¼Œå¹¶å®ç°é‡Œé¢çš„ matches æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Condition</span> {</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> var1:åˆ¤æ–­æ¡ä»¶èƒ½ä½¿ç”¨çš„ä¸Šä¸‹æ–‡ç¯å¢ƒ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> var2:æ³¨è§£æ‰€åœ¨ä½ç½®çš„æ³¨é‡Šä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext var1, AnnotatedTypeMetadata var2)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è·å–å®¹å™¨çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼ŒconditionContextæä¾›äº†å¤šç§æ–¹æ³•ï¼Œæ–¹ä¾¿è·å–å„ç§ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCondition</span> <span class="keyword">implements</span> <span class="title class_">Condition</span> {</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext conditionContext, AnnotatedTypeMetadata annotatedTypeMetadata)</span> {</span><br><span class="line">        <span class="comment">// è·å–iocä½¿ç”¨çš„ beanFactory</span></span><br><span class="line">        <span class="type">ConfigurableListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> conditionContext.getBeanFactory();</span><br><span class="line">        <span class="comment">//è·å–ç±»åŠ è½½å™¨</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> conditionContext.getClassLoader();</span><br><span class="line">        <span class="comment">//è·å–å½“å‰ç¯å¢ƒä¿¡æ¯</span></span><br><span class="line">        <span class="type">Environment</span> <span class="variable">environment</span> <span class="operator">=</span> conditionContext.getEnvironment();</span><br><span class="line">        <span class="comment">//è·å–beanå®šä¹‰çš„æ³¨å†Œç±»</span></span><br><span class="line">        <span class="type">BeanDefinitionRegistry</span> <span class="variable">registry</span> <span class="operator">=</span> conditionContext.getRegistry();</span><br><span class="line">        <span class="comment">//è·å¾—å½“å‰ç³»ç»Ÿå</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">property</span> <span class="operator">=</span> environment.getProperty(<span class="string">"os.name"</span>);</span><br><span class="line">        <span class="comment">// ä¾‹å¦‚ï¼šå½“å‰ç¯å¢ƒæ˜¯å¦windowsç³»ç»Ÿï¼Œè¿”å›true</span></span><br><span class="line">        <span class="keyword">if</span> (property.contains(<span class="string">"Windows"</span>)){</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="å•ä¸ªåˆ¤æ–­æ¡ä»¶"><a href="#å•ä¸ªåˆ¤æ–­æ¡ä»¶" class="headerlink" title="å•ä¸ªåˆ¤æ–­æ¡ä»¶"></a>å•ä¸ªåˆ¤æ–­æ¡ä»¶</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// æ”¾åœ¨ç±»ä¸Šï¼Œè‹¥å½“å‰æ¡ä»¶åœ¨MyConditionä¸­mathesçš„æ–¹æ³•ä¸ºtrueï¼Œå°†ä¼šå‘å®¹å™¨æ³¨å…¥ä¸€ä¸ªæˆ–å¤šä¸ªbean</span></span><br><span class="line"><span class="meta">@Conditional({MyCondition.class})</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hello</span>{</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">bean1</span><span class="params">()</span>{}</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">bean2</span><span class="params">()</span>{}</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="å¤šä¸ªåˆ¤æ–­æ¡ä»¶çš„åº”ç”¨"><a href="#å¤šä¸ªåˆ¤æ–­æ¡ä»¶çš„åº”ç”¨" class="headerlink" title="å¤šä¸ªåˆ¤æ–­æ¡ä»¶çš„åº”ç”¨"></a>å¤šä¸ªåˆ¤æ–­æ¡ä»¶çš„åº”ç”¨</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// Aå’ŒBéƒ½è¿”å›true,æ‰ä¼šæ³¨å…¥å®¹å™¨</span></span><br><span class="line"><span class="meta">@Conditional({ACondition.class,BCondition.class})</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hello</span>{</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">bean1</span><span class="params">()</span>{}</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">bean2</span><span class="params">()</span>{}</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç»§@Conditionalæ³¨è§£åï¼Œæ´¾ç”Ÿå‡º @ConditionalOnBeanã€@ConditionalOnMissingBeanã€@ConditionalOnExpressionã€@ConditionalOnClass ç­‰</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@ConditionalOnBean</span>         <span class="comment">//	å½“ç»™å®šçš„åœ¨beanå­˜åœ¨æ—¶,åˆ™å®ä¾‹åŒ–å½“å‰Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>  <span class="comment">//	å½“ç»™å®šçš„åœ¨beanä¸å­˜åœ¨æ—¶,åˆ™å®ä¾‹åŒ–å½“å‰Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnClass</span>        <span class="comment">//	å½“ç»™å®šçš„ç±»ååœ¨ç±»è·¯å¾„ä¸Šå­˜åœ¨ï¼Œåˆ™å®ä¾‹åŒ–å½“å‰Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingClass</span> <span class="comment">//	å½“ç»™å®šçš„ç±»ååœ¨ç±»è·¯å¾„ä¸Šä¸å­˜åœ¨ï¼Œåˆ™å®ä¾‹åŒ–å½“å‰Bean</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="ConditionalOnBean"><a href="#ConditionalOnBean" class="headerlink" title="@ConditionalOnBean"></a>@ConditionalOnBean</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hello</span>{</span><br><span class="line">    <span class="meta">@Bean(name="bean1")</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">bean1</span><span class="params">()</span>{}</span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Bean(name="bean2")</span></span><br><span class="line">    <span class="comment">// å¦‚æœbean1å·²ç»æ³¨å…¥å®¹å™¨ï¼Œåˆ™bean2ä¹Ÿå°†æ³¨å…¥</span></span><br><span class="line">    <span class="meta">@ConditionalOnBean(name="bean1")</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">bean2</span><span class="params">()</span>{}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="ConditionalOnMissingBean"><a href="#ConditionalOnMissingBean" class="headerlink" title="@ConditionalOnMissingBean"></a>@ConditionalOnMissingBean</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hello</span>{</span><br><span class="line">    <span class="meta">@Bean(name="bean1")</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">bean1</span><span class="params">()</span>{}</span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Bean(name="bean2")</span></span><br><span class="line">    <span class="comment">// å¦‚æœbean1å·²ç»æ³¨å…¥å®¹å™¨ï¼Œåˆ™ä¸ä¼šå°†bean2æ³¨å…¥</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(name="bean1")</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">bean2</span><span class="params">()</span>{}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨ @ConditionalOnMissingBean çš„å£°æ˜ä¸­ï¼Œä½¿ç”¨çš„ä¹Ÿæ˜¯@Conditionalæ³¨è§£ï¼Œå®ç°äº†ä¸€äº›å¸¸ç”¨çš„åŠŸèƒ½ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Target({ElementType.TYPE, ElementType.METHOD})</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ¡ä»¶ä¸º OnBeanConditionï¼Œèƒ½å¤ŸæŒ‰beanåã€beanç±»åç­‰å¤šç§ç±»å‹åˆ¤æ–­beanæ˜¯å¦åœ¨å®¹å™¨</span></span><br><span class="line"><span class="meta">@Conditional({OnBeanCondition.class})</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ConditionalOnBean {</span><br><span class="line">    Class&lt;?&gt;[] value() <span class="keyword">default</span> {};</span><br><span class="line"></span><br><span class="line">    String[] type() <span class="keyword">default</span> {};</span><br><span class="line"></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt;[] annotation() <span class="keyword">default</span> {};</span><br><span class="line"></span><br><span class="line">    String[] name() <span class="keyword">default</span> {};</span><br><span class="line"></span><br><span class="line">    SearchStrategy <span class="title function_">search</span><span class="params">()</span> <span class="keyword">default</span> SearchStrategy.ALL;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] parameterizedContainer() <span class="keyword">default</span> {};</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å…¶å®ƒä¸¤ä¸ªæ³¨è§£åŒç†ã€‚</p>
</body></html>]]></content>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
</search>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Josefin+Sans:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script class="next-config" data-name="main" type="application/json">{"hostname":"mrdjun.gitee.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.10.0","exturl":false,"sidebar":{"position":"left","toggle":false,"width":300,"display":"always","padding":18,"offset":12,"display_links":true,"links":{"love":"https://www.funpeak.cn/ || fa fa-diamond","gitee":"https://www.gitee.com/mrdjun/ || fa fa-skyatlas","github":"https://www.github.com/mrdjun/ || fa fa-github-alt","csdn":"https://mrdjun.blog.csdn.net/ || fa fa-codepen"}},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":true,"nav":null},"stickytabs":true,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

  <meta name="description" content="æ¥è§¦è¿‡Springçš„åŒå­¦è‚¯å®šéƒ½å¬è¿‡IOCã€‚åœ¨ä¼ ç»Ÿçš„Javaç¼–ç¨‹ä¸­ï¼Œå½“éœ€è¦ç”¨åˆ°æŸä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä¸»åŠ¨æ˜¾å¼åˆ›å»ºä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼ˆnewï¼‰ã€‚ä½¿ç”¨Springåå°±ä¸éœ€è¦è¿™æ ·åšäº†ï¼Œå› ä¸ºSpringä¼šå¸®æˆ‘ä»¬åœ¨éœ€è¦ç”¨åˆ°æŸäº›å¯¹è±¡çš„åœ°æ–¹è‡ªåŠ¨æ³¨å…¥è¯¥å¯¹è±¡ï¼Œè€Œæ— é¡»æˆ‘ä»¬è‡ªå·±å»åˆ›å»ºã€‚">
<meta property="og:type" content="website">
<meta property="og:title" content="æ·±å…¥å­¦ä¹ Springç»„ä»¶æ³¨å†Œ">
<meta property="og:url" content="https://mrdjun.gitee.io/p/4bb4364.html">
<meta property="og:site_name" content="MrDJun">
<meta property="og:description" content="æ¥è§¦è¿‡Springçš„åŒå­¦è‚¯å®šéƒ½å¬è¿‡IOCã€‚åœ¨ä¼ ç»Ÿçš„Javaç¼–ç¨‹ä¸­ï¼Œå½“éœ€è¦ç”¨åˆ°æŸä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä¸»åŠ¨æ˜¾å¼åˆ›å»ºä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼ˆnewï¼‰ã€‚ä½¿ç”¨Springåå°±ä¸éœ€è¦è¿™æ ·åšäº†ï¼Œå› ä¸ºSpringä¼šå¸®æˆ‘ä»¬åœ¨éœ€è¦ç”¨åˆ°æŸäº›å¯¹è±¡çš„åœ°æ–¹è‡ªåŠ¨æ³¨å…¥è¯¥å¯¹è±¡ï¼Œè€Œæ— é¡»æˆ‘ä»¬è‡ªå·±å»åˆ›å»ºã€‚">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://mrdjun.gitee.io/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20181207164418.png">
<meta property="og:image" content="https://mrdjun.gitee.io/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190129103606.png">
<meta property="og:image" content="https://mrdjun.gitee.io/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190129100306.png">
<meta property="og:image" content="https://mrdjun.gitee.io/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190129100809.png">
<meta property="og:image" content="https://mrdjun.gitee.io/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190129101050.png">
<meta property="og:image" content="https://mrdjun.gitee.io/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190129112811.png">
<meta property="og:image" content="https://mrdjun.gitee.io/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190130094046.png">
<meta property="og:image" content="https://mrdjun.gitee.io/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190130103346.png">
<meta property="article:published_time" content="2022-12-03T08:29:51.000Z">
<meta property="article:modified_time" content="2025-03-27T17:23:53.960Z">
<meta property="article:author" content="MrDJun">
<meta property="article:tag" content="Spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mrdjun.gitee.io/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20181207164418.png">


<link rel="canonical" href="https://mrdjun.gitee.io/p/4bb4364.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://mrdjun.gitee.io/p/4bb4364.html","path":"p/4bb4364.html","title":"æ·±å…¥å­¦ä¹ Springç»„ä»¶æ³¨å†Œ"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>
      æ·±å…¥å­¦ä¹ Springç»„ä»¶æ³¨å†Œ | MrDJun
    </title>
    





    <noscript>
      <link rel="stylesheet" href="/css/noscript.css">
    </noscript>
    <script src="/js/jquery.js"></script>
    <link href="/lib/font-awesome/css/font-awesome.min.css" rel="stylesheet"/>
    <style is="theme"></style>
  </head>

  <body itemscope itemtype="http://schema.org/WebPage">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">MrDJun</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">mrdjun</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        ğŸ”
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-ğŸ -home"><a href="/" rel="section">ğŸ  Home</a></li>
        <li class="menu-item menu-item-ğŸ“¦-archives"><a href="/archives/" rel="section">ğŸ“¦ Archives</a></li>
        <li class="menu-item menu-item-ğŸ”–-labels"><a href="/tags/" rel="section">ğŸ”– Labels</a></li>
        <li class="menu-item menu-item-ğŸ‘¬-friends"><a href="/friends/" rel="section">ğŸ‘¬ Friends</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger">ğŸ” Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    ğŸ”
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
          
  

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Contents
        </li>
        <li class="sidebar-nav-overview">
          Site Preview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9A%E8%BF%87-Bean%E6%B3%A8%E5%86%8C%E7%BB%84%E4%BB%B6"><span class="nav-number">1.</span> <span class="nav-text">é€šè¿‡@Beanæ³¨å†Œç»„ä»¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-ComponentScan%E6%89%AB%E6%8F%8F"><span class="nav-number">2.</span> <span class="nav-text">ä½¿ç”¨@ComponentScanæ‰«æ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A%E6%89%AB%E6%8F%8F%E7%AD%96%E7%95%A5"><span class="nav-number">2.1.</span> <span class="nav-text">æŒ‡å®šæ‰«æç­–ç•¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E6%89%AB%E6%8F%8F%E7%AD%96%E7%95%A5%E9%85%8D%E7%BD%AE"><span class="nav-number">2.2.</span> <span class="nav-text">å¤šæ‰«æç­–ç•¥é…ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%89%AB%E6%8F%8F%E7%AD%96%E7%95%A5"><span class="nav-number">2.3.</span> <span class="nav-text">è‡ªå®šä¹‰æ‰«æç­–ç•¥</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%84%E4%BB%B6%E4%BD%9C%E7%94%A8%E5%9F%9F-Scope"><span class="nav-number">3.</span> <span class="nav-text">ç»„ä»¶ä½œç”¨åŸŸ@Scope</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%87%92%E5%8A%A0%E8%BD%BD-Lazy"><span class="nav-number">4.</span> <span class="nav-text">æ‡’åŠ è½½@Lazy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E6%B3%A8%E5%86%8C%E7%BB%84%E4%BB%B6"><span class="nav-number">5.</span> <span class="nav-text">æ¡ä»¶æ³¨å†Œç»„ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Conditional"><span class="nav-number">5.1.</span> <span class="nav-text">@Conditional</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Profile"><span class="nav-number">5.2.</span> <span class="nav-text">@Profile</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E7%BB%84%E4%BB%B6"><span class="nav-number">6.</span> <span class="nav-text">å¯¼å…¥ç»„ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Import"><span class="nav-number">6.1.</span> <span class="nav-text">@Import</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ImportSelector"><span class="nav-number">6.2.</span> <span class="nav-text">ImportSelector</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ImportBeanDefinitionRegistrar"><span class="nav-number">6.3.</span> <span class="nav-text">ImportBeanDefinitionRegistrar</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8FactoryBean%E6%B3%A8%E5%86%8C%E7%BB%84%E4%BB%B6"><span class="nav-number">7.</span> <span class="nav-text">ä½¿ç”¨FactoryBeanæ³¨å†Œç»„ä»¶</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          
<div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <i id="btn_darkmode"></i>
    <img class="site-author-image" itemprop="image" alt="MrDJun"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">MrDJun</p>
  <div class="site-description" itemprop="description">Live with your heart,please be bold.</div>
</div>
  <div class="site-menu-wrap site-overview-item animated">
    <ur class="menu_urls">
        <li>
          <a href="/">ğŸ  Home</a>
        </li>
        <li>
          <a href="/archives/">ğŸ“¦ Archives</a>
        </li>
        <li>
          <a href="/tags/">ğŸ”– Labels</a>
        </li>
        <li>
          <a href="/friends/">ğŸ‘¬ Friends</a>
        </li>
        <li>
          <a class="popup-trigger" href="javascript:;">ğŸ”
            Search
          </a>
        </li>
    </ur>
  </div>



<div class="asider-footer">
  <div id="links">
    <li>
      <a href="https://www.funpeak.cn/" target="_blank" itemprop="url" class="ignore-href">
        <i class="fa fa-diamond fa-fw"></i>
      </a>
    </li>
    <li>
      <a href="https://www.gitee.com/mrdjun/" target="_blank" itemprop="url" class="ignore-href">
        <i class="fa fa-skyatlas fa-fw"></i>
      </a>
    </li>
    <li>
      <a href="https://www.github.com/mrdjun/" target="_blank" itemprop="url" class="ignore-href">
        <i class="fa fa-github-alt fa-fw"></i>
      </a>
    </li>
    <li>
      <a href="https://mrdjun.blog.csdn.net/" target="_blank" itemprop="url" class="ignore-href">
        <i class="fa fa-codepen fa-fw"></i>
      </a>
    </li>
    
  </div>
  <div class="copyright">
  &copy; 2019 â€“ 
    <span itemprop="copyrightYear">2025</span>
    <span class="author" itemprop="copyrightHolder">MrDJun</span>
  </div>
  <div>
    UV&nbsp;<span class="busuanzi-value" id="busuanzi_value_site_uv" style="cursor:pointer" title="ç»Ÿè®¡å¼€å§‹æ—¶é—´ï¼š2019å¹´7æœˆ5æ—¥"></span> &nbsp;&nbsp;PV&nbsp;<span class="busuanzi-value" id="busuanzi_value_site_pv" style="cursor:pointer" title="ç»Ÿè®¡å¼€å§‹æ—¶é—´ï¼š2019å¹´7æœˆ5æ—¥"></span>
  </div>
</div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


      </header>

      
  <div class="back-to-top" role="button" aria-label="Back to top">
    <span id='scrollpercent'>0</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://mrdjun.gitee.io/p/4bb4364.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="MrDJun">
      <meta itemprop="description" content="Live with your heart,please be bold.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MrDJun">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          æ·±å…¥å­¦ä¹ Springç»„ä»¶æ³¨å†Œ
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-time">
        <span class="post-meta-item-icon">
          <i class="fa fa-calendar-o"></i>
        </span>
        <span class="post-meta-item-text hidden">Posted on</span>
        <time title="Created: 2022-12-03 16:29:51" itemprop="dateCreated datePublished" datetime="2022-12-03T16:29:51+08:00">2022-12-03</time>
      </span>
    </span>

  
    <span class="post-meta-item" title="Visit count" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-laptop"></i>
      </span>
      <span class="post-meta-item-text">Visit count: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <html><head></head><body><p>æ¥è§¦è¿‡Springçš„åŒå­¦è‚¯å®šéƒ½å¬è¿‡IOCã€‚åœ¨ä¼ ç»Ÿçš„Javaç¼–ç¨‹ä¸­ï¼Œå½“éœ€è¦ç”¨åˆ°æŸä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä¸»åŠ¨æ˜¾å¼åˆ›å»ºä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼ˆnewï¼‰ã€‚ä½¿ç”¨Springåå°±ä¸éœ€è¦è¿™æ ·åšäº†ï¼Œå› ä¸ºSpringä¼šå¸®æˆ‘ä»¬åœ¨éœ€è¦ç”¨åˆ°æŸäº›å¯¹è±¡çš„åœ°æ–¹è‡ªåŠ¨æ³¨å…¥è¯¥å¯¹è±¡ï¼Œè€Œæ— é¡»æˆ‘ä»¬è‡ªå·±å»åˆ›å»ºã€‚è¿™ç§æ¨¡å¼ä¿—ç§°æ§åˆ¶åè½¬ï¼Œå³IOCï¼ˆInversion of Controlï¼‰ã€‚é‚£ä¹ˆSpringæ˜¯ä»ä»€ä¹ˆåœ°æ–¹è·å–åˆ°æˆ‘ä»¬æ‰€éœ€è¦çš„å¯¹è±¡å‘¢ï¼Ÿå…¶å®Springç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªIOCå®¹å™¨ï¼Œé‡Œé¢ç®¡ç†ç€æ‰€æœ‰æˆ‘ä»¬éœ€è¦çš„å¯¹è±¡ï¼Œç»„ä»¶æ³¨å†Œå°±æ˜¯æˆ‘ä»¬å»å‘Šè¯‰Springå“ªäº›ç±»éœ€è¦äº¤ç»™IOCå®¹å™¨ç®¡ç†ã€‚</p>
<p>è¿™é‡Œä¸»è¦è®°å½•ç»„ä»¶æ³¨å†Œçš„ä¸€äº›ç»†èŠ‚ã€‚</p>
<h2 id="é€šè¿‡-Beanæ³¨å†Œç»„ä»¶"><a href="#é€šè¿‡-Beanæ³¨å†Œç»„ä»¶" class="headerlink" title="é€šè¿‡@Beanæ³¨å†Œç»„ä»¶"></a>é€šè¿‡@Beanæ³¨å†Œç»„ä»¶</h2><p>åœ¨è¾ƒæ—©ç‰ˆæœ¬çš„Springä¸­ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡XMLçš„æ–¹å¼æ¥å¾€IOCå®¹å™¨ä¸­æ³¨å†Œç»„ä»¶çš„ï¼Œä¸‹é¢è¿™æ®µä»£ç å¤§å®¶è‚¯å®šä¸ä¼šé™Œç”Ÿï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿”å› IOC å®¹å™¨ï¼ŒåŸºäº XMLé…ç½®ï¼Œä¼ å…¥é…ç½®æ–‡ä»¶çš„ä½ç½®</span></span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">"xxx.xml"</span>);</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) applicationContext.getBean(<span class="string">"user"</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>Spring 4åæ¨èæˆ‘ä»¬ä½¿ç”¨Java Configçš„æ–¹å¼æ¥æ³¨å†Œç»„ä»¶ã€‚</p>
<p>ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬é€šè¿‡<a target="_blank" rel="noopener" href="http://start.spring.io/%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95Spring">http://start.spring.io/æ­å»ºä¸€ä¸ªç®€å•Spring</a> Bootåº”ç”¨ï¼Œç„¶åå¼•å…¥Lombokä¾èµ–ï¼ˆç¼–è¾‘å™¨ä¹Ÿéœ€è¦å®‰è£…Lombokæ’ä»¶ï¼‰ï¼š</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>ç„¶ååˆ›å»ºä¸€ä¸ªUserç±»ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ¥ç€åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œåœ¨é‡Œé¢é€šè¿‡<code>@Bean</code>æ³¨è§£æ³¨å†ŒUserç±»ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"mrdjun"</span>, <span class="number">18</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>é€šè¿‡<code>@Bean</code>æ³¨è§£ï¼Œæˆ‘ä»¬å‘IOCå®¹å™¨æ³¨å†Œäº†ä¸€ä¸ªåç§°ä¸º<code>user</code>ï¼ˆBeanåç§°é»˜è®¤ä¸ºæ–¹æ³•åï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡<code>@Bean("myUser")</code>æ–¹å¼æ¥å°†ç»„ä»¶åç§°æŒ‡å®šä¸º<code>myUser</code>ï¼‰ã€‚</p>
<p>ç»„ä»¶æ³¨å†Œå®Œæ¯•åï¼Œæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ä»IOCå®¹å™¨ä¸­è·å–è¿™ä¸ªç»„ä»¶ã€‚åœ¨Spring Bootå…¥å£ç±»ä¸­ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">    	SpringApplication.run(DemoApplication.class, args);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿”å› IOC å®¹å™¨ï¼Œä½¿ç”¨æ³¨è§£é…ç½®ï¼Œä¼ å…¥é…ç½®ç±»</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(WebConfig.class);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> context.getBean(User.class);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å› ä¸ºæˆ‘ä»¬æ˜¯é€šè¿‡æ³¨è§£æ–¹å¼æ¥æ³¨å†Œç»„ä»¶çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨<code>AnnotationConfigApplicationContext</code>æ¥è·å–ç›¸åº”çš„IOCå®¹å™¨ï¼Œå…¥å‚ä¸ºé…ç½®ç±»ã€‚</p>
<p>å¯åŠ¨é¡¹ç›®ï¼Œçœ‹ä¸‹æ§åˆ¶å°è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User(name=mrdjun, age=18)</span><br></pre></td></tr></tbody></table></figure>

<p>è¯´æ˜ç»„ä»¶æ³¨å†ŒæˆåŠŸã€‚</p>
<p>æˆ‘ä»¬å°†ç»„ä»¶çš„åç§°æ”¹ä¸º<code>myUser</code>ï¼Œç„¶åçœ‹çœ‹IOCå®¹å™¨ä¸­ï¼ŒUserç±»å‹ç»„ä»¶æ˜¯å¦å«<code>myUser</code>ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line"></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(WebConfig.class);</span><br><span class="line">        <span class="comment">// æŸ¥çœ‹ User è¿™ä¸ªç±»åœ¨ Spring å®¹å™¨ä¸­å«å•¥ç©æ„</span></span><br><span class="line">        String[] beanNames = context.getBeanNamesForType(User.class);</span><br><span class="line">        Arrays.stream(beanNames).forEach(System.out::println);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿæ§åˆ¶å°è¾“å‡º:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myUser</span><br></pre></td></tr></tbody></table></figure>

<h2 id="ä½¿ç”¨-ComponentScanæ‰«æ"><a href="#ä½¿ç”¨-ComponentScanæ‰«æ" class="headerlink" title="ä½¿ç”¨@ComponentScanæ‰«æ"></a>ä½¿ç”¨@ComponentScanæ‰«æ</h2><p>åœ¨ä½¿ç”¨XMLé…ç½®ç»„ä»¶æ‰«æçš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½æ˜¯è¿™æ ·é…ç½®çš„ï¼š</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>å…¶ä¸­<code>base-package</code>æŒ‡å®šäº†æ‰«æçš„è·¯å¾„ã€‚è·¯å¾„ä¸‹æ‰€æœ‰è¢«<code>@Controller</code>ã€<code>@Service</code>ã€<code>@Repository</code>å’Œ<code>@Component</code>æ³¨è§£æ ‡æ³¨çš„ç±»éƒ½ä¼šè¢«çº³å…¥IOCå®¹å™¨ä¸­ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬è„±ç¦»XMLé…ç½®åï¼Œå¯ä»¥ä½¿ç”¨<code>@ComponentScan</code>æ³¨è§£æ¥æ‰«æç»„ä»¶å¹¶æ³¨å†Œã€‚</p>
<p>åœ¨ä½¿ç”¨<code>@ComponentScan</code>æ‰«æä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªControllerï¼Œä¸€ä¸ªServiceï¼Œä¸€ä¸ªDaoï¼Œå¹¶æ ‡æ³¨ä¸Šç›¸åº”çš„æ³¨è§£ã€‚</p>
<p>ç„¶åä¿®æ”¹é…ç½®ç±»ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan("com.mrdjun.demo")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">// @Bean("myUser")</span></span><br><span class="line">    <span class="comment">// public User user() {</span></span><br><span class="line">    <span class="comment">//     return new User("mrdjun", 18);</span></span><br><span class="line">    <span class="comment">// }</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨é…ç½®ç±»ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡<code>@ComponentScan("com.mrdjun.demo")</code>é…ç½®äº†æ‰«æè·¯å¾„ï¼Œå¹¶ä¸”å°†Userç»„ä»¶æ³¨å†Œæ³¨é‡Šæ‰äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯åœ¨Userç±»ä¸ŠåŠ ä¸Š<code>@Component</code>æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½å°†Spring Bootçš„å…¥å£ç±»çº³å…¥æ‰«æèŒƒå›´ä¸­ï¼Œå¦åˆ™é¡¹ç›®å¯åŠ¨å°†å‡ºé”™ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹åœ¨åŸºäºæ³¨è§£çš„IOCå®¹å™¨ä¸­æ˜¯å¦åŒ…å«äº†è¿™äº›ç»„ä»¶ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line"></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(WebConfig.class);</span><br><span class="line">        <span class="comment">// æŸ¥çœ‹åŸºäºæ³¨è§£çš„ IOCå®¹å™¨ä¸­æ‰€æœ‰ç»„ä»¶åç§°</span></span><br><span class="line">        String[] beanNames = context.getBeanDefinitionNames();</span><br><span class="line">        Arrays.stream(beanNames).forEach(System.out::println);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿæ§åˆ¶å°ï¼š</p>
<p><img src="/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20181207164418.png" alt="QQæˆªå›¾20181207164418.png"></p>
<p>å¯è§ï¼Œç»„ä»¶å·²ç»æˆåŠŸè¢«æ‰«æè¿›å»äº†ï¼Œå¹¶ä¸”åç§°é»˜è®¤ä¸ºç±»åé¦–å­—æ¯å°å†™ã€‚</p>
<p>è¿™é‡Œï¼Œé…ç½®ç±»WebConfigä¹Ÿè¢«æ‰«æå¹¶æ³¨å†Œäº†ï¼ŒæŸ¥çœ‹<code>@Configuration</code>æºç å°±ä¼šå‘ç°åŸå› ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Configuration {</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">""</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="æŒ‡å®šæ‰«æç­–ç•¥"><a href="#æŒ‡å®šæ‰«æç­–ç•¥" class="headerlink" title="æŒ‡å®šæ‰«æç­–ç•¥"></a>æŒ‡å®šæ‰«æç­–ç•¥</h3><p><code>@ComponentScan</code>æ³¨è§£å…è®¸æˆ‘ä»¬æŒ‡å®šæ‰«æç­–ç•¥ï¼Œå³æŒ‡å®šå“ªäº›è¢«æ‰«æï¼Œå“ªäº›ä¸è¢«æ‰«æï¼ŒæŸ¥çœ‹å…¶æºç å¯å‘ç°è¿™ä¸¤ä¸ªå±æ€§ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Specifies which types are eligible for component scanning.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Further narrows the set of candidate components from everything in {<span class="doctag">@link</span> #basePackages}</span></span><br><span class="line"><span class="comment"> * to everything in the base packages that matches the given filter or filters.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Note that these filters will be applied in addition to the default filters, if specified.</span></span><br><span class="line"><span class="comment"> * Any type under the specified base packages which matches a given filter will be included,</span></span><br><span class="line"><span class="comment"> * even if it does not match the default filters (i.e. is not annotated with {<span class="doctag">@code</span> <span class="doctag">@Component</span>}).</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #resourcePattern()</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #useDefaultFilters()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Filter[] includeFilters() <span class="keyword">default</span> {};</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Specifies which types are not eligible for component scanning.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #resourcePattern</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Filter[] excludeFilters() <span class="keyword">default</span> {};</span><br></pre></td></tr></tbody></table></figure>

<p>å…¶ä¸­<code>Filter</code>ä¹Ÿæ˜¯ä¸€ä¸ªæ³¨è§£:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Declares the type filter to be used as an {<span class="doctag">@linkplain</span> ComponentScan#includeFilters</span></span><br><span class="line"><span class="comment"> * include filter} or {<span class="doctag">@linkplain</span> ComponentScan#excludeFilters exclude filter}.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target({})</span></span><br><span class="line"><span class="meta">@interface</span> Filter {</span><br><span class="line"></span><br><span class="line">    FilterType <span class="title function_">type</span><span class="params">()</span> <span class="keyword">default</span> FilterType.ANNOTATION;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AliasFor("classes")</span></span><br><span class="line">    Class&lt;?&gt;[] value() <span class="keyword">default</span> {};</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AliasFor("value")</span></span><br><span class="line">    Class&lt;?&gt;[] classes() <span class="keyword">default</span> {};</span><br><span class="line">    String[] pattern() <span class="keyword">default</span> {};</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨<code>excludeFilters</code>æ¥æ’é™¤ä¸€äº›ç»„ä»¶çš„æ‰«æï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(value = "com.mrdjun.demo",</span></span><br><span class="line"><span class="meta">        excludeFilters = {</span></span><br><span class="line"><span class="meta">                @Filter(type = FilterType.ANNOTATION,</span></span><br><span class="line"><span class="meta">                        classes = {Controller.class, Repository.class}),</span></span><br><span class="line"><span class="meta">                @Filter(type = FilterType.ASSIGNABLE_TYPE, classes = User.class)</span></span><br><span class="line"><span class="meta">        })</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸Šé¢æˆ‘ä»¬æŒ‡å®šäº†ä¸¤ç§æ’é™¤æ‰«æçš„è§„åˆ™ï¼š</p>
<ol>
<li>æ ¹æ®æ³¨è§£æ¥æ’é™¤ï¼ˆ<code>type = FilterType.ANNOTATION</code>ï¼‰,è¿™äº›æ³¨è§£çš„ç±»å‹ä¸º<code>classes = {Controller.class, Repository.class}</code>ã€‚å³<code>Controller</code>å’Œ<code>Repository</code>æ³¨è§£æ ‡æ³¨çš„ç±»ä¸å†è¢«çº³å…¥åˆ°IOCå®¹å™¨ä¸­ã€‚</li>
<li>æ ¹æ®æŒ‡å®šç±»å‹ç±»æ’é™¤ï¼ˆ<code>type = FilterType.ASSIGNABLE_TYPE</code>ï¼‰ï¼Œæ’é™¤ç±»å‹ä¸º<code>User.class</code>ï¼Œå…¶å­ç±»ï¼Œå®ç°ç±»éƒ½ä¼šè¢«æ’é™¤ã€‚</li>
</ol>
<p>å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿæ§åˆ¶å°ï¼š</p>
<p><img src="/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190129103606.png" alt="QQæˆªå›¾20190129095439.png"></p>
<p>å¯è§æ’é™¤æˆåŠŸã€‚</p>
<p>é™¤äº†ä¸Šé¢ä¸¤ç§å¸¸ç”¨çš„è§„åˆ™å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨åˆ«çš„è§„åˆ™ï¼ŒæŸ¥çœ‹<code>FilterType</code>æºç ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">FilterType</span> {</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Filter candidates marked with a given annotation.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> org.springframework.core.type.filter.AnnotationTypeFilter</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ANNOTATION,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Filter candidates assignable to a given type.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> org.springframework.core.type.filter.AssignableTypeFilter</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ASSIGNABLE_TYPE,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Filter candidates matching a given AspectJ type pattern expression.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> org.springframework.core.type.filter.AspectJTypeFilter</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ASPECTJ,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Filter candidates matching a given regex pattern.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> org.springframework.core.type.filter.RegexPatternTypeFilter</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    REGEX,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Filter candidates using a given custom</span></span><br><span class="line"><span class="comment">     * {<span class="doctag">@link</span> org.springframework.core.type.filter.TypeFilter} implementation.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    CUSTOM</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å¯çœ‹åˆ°ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡<code>ASPECTJ</code>è¡¨è¾¾å¼ï¼Œ<code>REGEX</code>æ­£åˆ™è¡¨è¾¾å¼å’Œ<code>CUSTOM</code>è‡ªå®šä¹‰è§„åˆ™ï¼ˆä¸‹é¢è¯¦ç»†ä»‹ç»ï¼‰æ¥æŒ‡å®šæ‰«æç­–ç•¥ã€‚</p>
<p><code>includeFilters</code>çš„ä½œç”¨å’Œ<code>excludeFilters</code>ç›¸åï¼Œå…¶æŒ‡å®šçš„æ˜¯å“ªäº›ç»„ä»¶éœ€è¦è¢«æ‰«æï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(value = "com.mrdjun.demo",</span></span><br><span class="line"><span class="meta">        includeFilters = {</span></span><br><span class="line"><span class="meta">                @Filter(type = FilterType.ANNOTATION, classes = Service.class)</span></span><br><span class="line"><span class="meta">        }, useDefaultFilters = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸Šé¢é…ç½®äº†åªå°†<code>Service</code>çº³å…¥IOCå®¹å™¨ï¼Œå¹¶ä¸”éœ€è¦ç”¨<code>useDefaultFilters = false</code>æ¥å…³é—­Springé»˜è®¤çš„æ‰«æç­–ç•¥æ‰èƒ½è®©æˆ‘ä»¬çš„é…ç½®ç”Ÿæ•ˆï¼ˆSpring Bootå…¥å£ç±»çš„<code>@SpringBootApplication</code>æ³¨è§£åŒ…å«äº†ä¸€äº›é»˜è®¤çš„æ‰«æç­–ç•¥ï¼‰ã€‚</p>
<p>å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿæ§åˆ¶å°ï¼š</p>
<p><img src="/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190129100306.png" alt="QQæˆªå›¾20190129100306.png"></p>
<p>å¯çœ‹åˆ°ï¼ŒIOCå®¹å™¨ä¸­å°†ä¸å†åŒ…å«daoï¼Œcontrollerã€‚</p>
<h3 id="å¤šæ‰«æç­–ç•¥é…ç½®"><a href="#å¤šæ‰«æç­–ç•¥é…ç½®" class="headerlink" title="å¤šæ‰«æç­–ç•¥é…ç½®"></a>å¤šæ‰«æç­–ç•¥é…ç½®</h3><p>åœ¨Java 8ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>@ComponentScans</code>æ¥é…ç½®å¤šä¸ª<code>@ComponentScan</code>ä»¥å®ç°å¤šæ‰«æè§„åˆ™é…ç½®ï¼š</p>
<p><img src="/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190129100809.png" alt="QQæˆªå›¾20190129100809.png"></p>
<p>è€Œåœ¨Java 8ä¸­ï¼Œæ–°å¢äº†<code>@Repeatable</code>æ³¨è§£ï¼Œä½¿ç”¨è¯¥æ³¨è§£ä¿®é¥°çš„æ³¨è§£å¯ä»¥é‡å¤ä½¿ç”¨ï¼ŒæŸ¥çœ‹<code>@ComponentScan</code>æºç ä¼šå‘ç°å…¶å·²ç»è¢«è¯¥æ³¨è§£æ ‡æ³¨ï¼š</p>
<p><img src="/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190129101050.png" alt="QQæˆªå›¾20190129101050.png"></p>
<p>æ‰€ä»¥é™¤äº†ä½¿ç”¨<code>@ComponentScans</code>æ¥é…ç½®å¤šæ‰«æè§„åˆ™å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å¤šæ¬¡ä½¿ç”¨<code>@ComponentScan</code>æ¥æŒ‡å®šå¤šä¸ªä¸åŒçš„æ‰«æè§„åˆ™ã€‚</p>
<h3 id="è‡ªå®šä¹‰æ‰«æç­–ç•¥"><a href="#è‡ªå®šä¹‰æ‰«æç­–ç•¥" class="headerlink" title="è‡ªå®šä¹‰æ‰«æç­–ç•¥"></a>è‡ªå®šä¹‰æ‰«æç­–ç•¥</h3><p>è‡ªå®šä¹‰æ‰«æç­–ç•¥éœ€è¦æˆ‘ä»¬å®ç°<code>org.springframework.core.type.filter.TypeFilter</code>æ¥å£ï¼Œåˆ›å»º<code>MyTypeFilter</code>å®ç°è¯¥æ¥å£ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTypeFilter</span> <span class="keyword">implements</span> <span class="title class_">TypeFilter</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">match</span><span class="params">(MetadataReader metadataReader, MetadataReaderFactory metadataReaderFactory)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¯¥æ¥å£åŒ…å«<code>match</code>æ–¹æ³•ï¼Œå…¶ä¸¤ä¸ªå…¥å‚<code>MetadataReader</code>å’Œ<code>MetadataReaderFactory</code>å«ä¹‰å¦‚ä¸‹ï¼š</p>
<ol>
<li><code>MetadataReader</code>ï¼šå½“å‰æ­£åœ¨æ‰«æçš„ç±»çš„ä¿¡æ¯ï¼›</li>
<li><code>MetadataReaderFactory</code>ï¼šå¯ä»¥é€šè¿‡å®ƒæ¥è·å–å…¶ä»–ç±»çš„ä¿¡æ¯ã€‚</li>
</ol>
<p>å½“<code>match</code>æ–¹æ³•è¿”å›trueæ—¶è¯´æ˜åŒ¹é…æˆåŠŸï¼Œfalseåˆ™è¯´æ˜åŒ¹é…å¤±è´¥ã€‚ç»§ç»­å®Œå–„è¿™ä¸ªè¿‡æ»¤è§„åˆ™ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTypeFilter</span> <span class="keyword">implements</span> <span class="title class_">TypeFilter</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">match</span><span class="params">(MetadataReader metadataReader, MetadataReaderFactory metadataReaderFactory)</span> {</span><br><span class="line">        <span class="comment">// è·å–å½“å‰æ­£åœ¨æ‰«æçš„ç±»çš„æ³¨è§£ä¿¡æ¯</span></span><br><span class="line">        <span class="type">AnnotationMetadata</span> <span class="variable">annotationMetadata</span> <span class="operator">=</span> metadataReader.getAnnotationMetadata();</span><br><span class="line">        <span class="comment">// è·å–å½“å‰æ­£åœ¨æ‰«æçš„ç±»çš„ç±»ä¿¡æ¯</span></span><br><span class="line">        <span class="type">ClassMetadata</span> <span class="variable">classMetadata</span> <span class="operator">=</span> metadataReader.getClassMetadata();</span><br><span class="line">        <span class="comment">// è·å–å½“å‰æ­£åœ¨æ‰«æçš„ç±»çš„è·¯å¾„ç­‰ä¿¡æ¯</span></span><br><span class="line">        <span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> metadataReader.getResource();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> classMetadata.getClassName();</span><br><span class="line">        <span class="keyword">return</span> StringUtils.hasText(<span class="string">"er"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸Šé¢æŒ‡å®šäº†å½“è¢«æ‰«æçš„ç±»ååŒ…å«<code>er</code>æ—¶å€™ï¼ŒåŒ¹é…æˆåŠŸï¼Œé…åˆ<code>excludeFilters</code>ä½¿ç”¨æ„æŒ‡å½“è¢«æ‰«æçš„ç±»ååŒ…å«<code>er</code>æ—¶ï¼Œè¯¥ç±»ä¸è¢«çº³å…¥IOCå®¹å™¨ä¸­ã€‚</p>
<p>æˆ‘ä»¬åœ¨<code>@ComponentScan</code>ä¸­ä½¿ç”¨è¿™ä¸ªè‡ªå®šä¹‰çš„è¿‡æ»¤ç­–ç•¥ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(value = "com.mrdjun.demo",</span></span><br><span class="line"><span class="meta">        excludeFilters = {</span></span><br><span class="line"><span class="meta">            @Filter(type = FilterType.CUSTOM, classes = MyTypeFilter.class)</span></span><br><span class="line"><span class="meta">        })</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿè¾“å‡ºï¼š</p>
<p><img src="/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190129112811.png" alt="QQæˆªå›¾20190129112811.png"></p>
<p>å› ä¸º<code>User</code>ï¼Œ<code>UserMapper</code>ï¼Œ<code>UserService</code>å’Œ<code>UserController</code>ç­‰ç±»çš„ç±»åéƒ½åŒ…å«<code>er</code>ï¼Œæ‰€ä»¥å®ƒä»¬éƒ½æ²¡æœ‰è¢«çº³å…¥åˆ°IOCå®¹å™¨ä¸­ã€‚</p>
<h2 id="ç»„ä»¶ä½œç”¨åŸŸ-Scope"><a href="#ç»„ä»¶ä½œç”¨åŸŸ-Scope" class="headerlink" title="ç»„ä»¶ä½œç”¨åŸŸ@Scope"></a>ç»„ä»¶ä½œç”¨åŸŸ@Scope</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨Springçš„IOCå®¹å™¨ä¸­æ¯ä¸ªç»„ä»¶éƒ½æ˜¯å•ä¾‹çš„ï¼Œå³æ— è®ºåœ¨ä»»ä½•åœ°æ–¹æ³¨å…¥å¤šå°‘æ¬¡ï¼Œè¿™äº›å¯¹è±¡éƒ½æ˜¯åŒä¸€ä¸ªï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä¾‹å­ã€‚</p>
<p>é¦–å…ˆå°†Userå¯¹è±¡ä¸­çš„<code>@Component</code>æ³¨è§£å»é™¤ï¼Œç„¶ååœ¨é…ç½®ç±»ä¸­é…ç½®User Beanï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"mrdjun"</span>, <span class="number">18</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ¥ç€å¤šæ¬¡ä»IOCå®¹å™¨ä¸­è·å–è¿™ä¸ªç»„ä»¶ï¼Œçœ‹çœ‹æ˜¯å¦ä¸ºåŒä¸€ä¸ªï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿”å› IOC å®¹å™¨ï¼Œä½¿ç”¨æ³¨è§£é…ç½®ï¼Œä¼ å…¥é…ç½®ç±»</span></span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(WebConfig.class);</span><br><span class="line"><span class="type">Object</span> <span class="variable">user1</span> <span class="operator">=</span> context.getBean(<span class="string">"user"</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">user2</span> <span class="operator">=</span> context.getBean(<span class="string">"user"</span>);</span><br><span class="line"><span class="comment">// è¾“å‡ºtrue</span></span><br><span class="line">System.out.println(user1 == user2);</span><br></pre></td></tr></tbody></table></figure>

<p>ç»“æœè¯å®äº†ä¸Šé¢çš„è§‚ç‚¹ã€‚</p>
<p>åœ¨Springä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>@Scope</code>æ³¨è§£æ¥æ”¹å˜ç»„ä»¶çš„ä½œç”¨åŸŸï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * When used as a type-level annotation in conjunction with</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@link</span> org.springframework.stereotype.Component <span class="doctag">@Component</span>},</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@code</span> <span class="doctag">@Scope</span>} indicates the name of a scope to use for instances of</span></span><br><span class="line"><span class="comment"> * the annotated type.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;When used as a method-level annotation in conjunction with</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@link</span> Bean <span class="doctag">@Bean</span>}, {<span class="doctag">@code</span> <span class="doctag">@Scope</span>} indicates the name of a scope to use</span></span><br><span class="line"><span class="comment"> * for the instance returned from the method.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;&lt;b&gt;<span class="doctag">NOTE:</span>&lt;/b&gt; {<span class="doctag">@code</span> <span class="doctag">@Scope</span>} annotations are only introspected on the</span></span><br><span class="line"><span class="comment"> * concrete bean class (for annotated components) or the factory method</span></span><br><span class="line"><span class="comment"> * (for {<span class="doctag">@code</span> <span class="doctag">@Bean</span>} methods). In contrast to XML bean definitions,</span></span><br><span class="line"><span class="comment"> * there is no notion of bean definition inheritance, and inheritance</span></span><br><span class="line"><span class="comment"> * hierarchies at the class level are irrelevant for metadata purposes.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;In this context, &lt;em&gt;scope&lt;/em&gt; means the lifecycle of an instance,</span></span><br><span class="line"><span class="comment"> * such as {<span class="doctag">@code</span> singleton}, {<span class="doctag">@code</span> prototype}, and so forth. Scopes</span></span><br><span class="line"><span class="comment"> * provided out of the box in Spring may be referred to using the</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@code</span> SCOPE_*} constants available in the {<span class="doctag">@link</span> ConfigurableBeanFactory}</span></span><br><span class="line"><span class="comment"> * and {<span class="doctag">@code</span> WebApplicationContext} interfaces.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;To register additional custom scopes, see</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@link</span> org.springframework.beans.factory.config.CustomScopeConfigurer</span></span><br><span class="line"><span class="comment"> * CustomScopeConfigurer}.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mark Fisher</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Chris Beams</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Sam Brannen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2.5</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.stereotype.Component</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.context.annotation.Bean</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target({ElementType.TYPE, ElementType.METHOD})</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Scope {</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Alias for {<span class="doctag">@link</span> #scopeName}.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> #scopeName</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@AliasFor("scopeName")</span></span><br><span class="line">	String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Specifies the name of the scope to use for the annotated component/bean.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Defaults to an empty string ({<span class="doctag">@code</span> ""}) which implies</span></span><br><span class="line"><span class="comment">	 * {<span class="doctag">@link</span> ConfigurableBeanFactory#SCOPE_SINGLETON SCOPE_SINGLETON}.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@since</span> 4.2</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> ConfigurableBeanFactory#SCOPE_PROTOTYPE</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> ConfigurableBeanFactory#SCOPE_SINGLETON</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> org.springframework.web.context.WebApplicationContext#SCOPE_REQUEST</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> org.springframework.web.context.WebApplicationContext#SCOPE_SESSION</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> #value</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@AliasFor("value")</span></span><br><span class="line">	String <span class="title function_">scopeName</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Specifies whether a component should be configured as a scoped proxy</span></span><br><span class="line"><span class="comment">	 * and if so, whether the proxy should be interface-based or subclass-based.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Defaults to {<span class="doctag">@link</span> ScopedProxyMode#DEFAULT}, which typically indicates</span></span><br><span class="line"><span class="comment">	 * that no scoped proxy should be created unless a different default</span></span><br><span class="line"><span class="comment">	 * has been configured at the component-scan instruction level.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Analogous to {<span class="doctag">@code</span> &lt;aop:scoped-proxy/&gt;} support in Spring XML.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> ScopedProxyMode</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	ScopedProxyMode <span class="title function_">proxyMode</span><span class="params">()</span> <span class="keyword">default</span> ScopedProxyMode.DEFAULT;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li><code>singleton</code>ï¼šå•å®ä¾‹ï¼ˆé»˜è®¤ï¼‰,åœ¨Spring IOCå®¹å™¨å¯åŠ¨çš„æ—¶å€™ä¼šè°ƒç”¨æ–¹æ³•åˆ›å»ºå¯¹è±¡ç„¶åçº³å…¥åˆ°IOCå®¹å™¨ä¸­ï¼Œä»¥åæ¯æ¬¡è·å–éƒ½æ˜¯ç›´æ¥ä»IOCå®¹å™¨ä¸­è·å–ï¼ˆ<code>map.get()</code>ï¼‰ï¼›</li>
<li><code>prototype</code>ï¼šå¤šå®ä¾‹ï¼ŒIOCå®¹å™¨å¯åŠ¨çš„æ—¶å€™å¹¶ä¸ä¼šå»åˆ›å»ºå¯¹è±¡ï¼Œè€Œæ˜¯åœ¨æ¯æ¬¡è·å–çš„æ—¶å€™æ‰ä¼šå»è°ƒç”¨æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼›</li>
<li><code>request</code>ï¼šä¸€ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ªå®ä¾‹ï¼›</li>
<li><code>session</code>ï¼šåŒä¸€ä¸ªsessionå¯¹åº”ä¸€ä¸ªå®ä¾‹ã€‚</li>
</ol>
<h2 id="æ‡’åŠ è½½-Lazy"><a href="#æ‡’åŠ è½½-Lazy" class="headerlink" title="æ‡’åŠ è½½@Lazy"></a>æ‡’åŠ è½½@Lazy</h2><p>æ‡’åŠ è½½æ˜¯é’ˆå¯¹å•ä¾‹æ¨¡å¼è€Œè¨€çš„ï¼Œæ­£å¦‚å‰é¢æ‰€è¯´ï¼ŒIOCå®¹å™¨ä¸­çš„ç»„ä»¶é»˜è®¤æ˜¯å•ä¾‹çš„ï¼Œå®¹å™¨å¯åŠ¨çš„æ—¶å€™ä¼šè°ƒç”¨æ–¹æ³•åˆ›å»ºå¯¹è±¡ç„¶åçº³å…¥åˆ°IOCå®¹å™¨ä¸­ã€‚</p>
<p>åœ¨User Beanæ³¨å†Œçš„åœ°æ–¹åŠ å…¥ä¸€å¥è¯ä»¥è§‚å¯Ÿï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"å¾€IOCå®¹å™¨ä¸­æ³¨å†Œuser bean"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"mrdjun"</span>, <span class="number">18</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(WebConfig.class);</span><br><span class="line">System.out.println(<span class="string">"å®¹å™¨åˆ›å»ºå®Œæ¯•"</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®è§‚å¯Ÿæ§åˆ¶å°è¾“å‡º:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å¾€IOCå®¹å™¨ä¸­æ³¨å†Œuser bean</span><br><span class="line">å®¹å™¨åˆ›å»ºå®Œæ¯•</span><br></pre></td></tr></tbody></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨IOCå®¹å™¨åˆ›å»ºå®Œæ¯•ä¹‹å‰ï¼Œç»„ä»¶å·²ç»æ·»åŠ åˆ°å®¹å™¨ä¸­äº†ã€‚</p>
<p>å°†User Beanæ”¹ä¸ºæ‡’åŠ è½½çš„æ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Lazy</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"å¾€IOCå®¹å™¨ä¸­æ³¨å†Œuser bean"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"mrdjun"</span>, <span class="number">18</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å†æ¬¡å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿè¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å®¹å™¨åˆ›å»ºå®Œæ¯•</span><br></pre></td></tr></tbody></table></figure>

<p>å¯çœ‹åˆ°ï¼Œå®¹å™¨åˆ›å»ºå®Œçš„æ—¶å€™ï¼ŒUser Beanè¿™ä¸ªç»„ä»¶å¹¶æœªæ·»åŠ åˆ°å®¹å™¨ä¸­ã€‚</p>
<p>æ‰€ä»¥æ‡’åŠ è½½çš„åŠŸèƒ½æ˜¯ï¼Œåœ¨å•ä¾‹æ¨¡å¼ä¸­ï¼ŒIOCå®¹å™¨åˆ›å»ºçš„æ—¶å€™ä¸ä¼šé©¬ä¸Šå»è°ƒç”¨æ–¹æ³•åˆ›å»ºå¯¹è±¡å¹¶æ³¨å†Œï¼Œåªæœ‰å½“ç»„ä»¶<strong>ç¬¬ä¸€æ¬¡</strong>è¢«ä½¿ç”¨çš„æ—¶å€™æ‰ä¼šè°ƒç”¨æ–¹æ³•åˆ›å»ºå¯¹è±¡å¹¶åŠ å…¥åˆ°å®¹å™¨ä¸­ã€‚</p>
<p>æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(WebConfig.class);</span><br><span class="line">System.out.println(<span class="string">"å®¹å™¨åˆ›å»ºå®Œæ¯•"</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">user1</span> <span class="operator">=</span> context.getBean(<span class="string">"user"</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">user2</span> <span class="operator">=</span> context.getBean(<span class="string">"user"</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿè¾“å‡º:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å®¹å™¨åˆ›å»ºå®Œæ¯•</span><br><span class="line">å¾€IOCå®¹å™¨ä¸­æ³¨å†Œuser bean</span><br></pre></td></tr></tbody></table></figure>

<p>ç»“æœè¯å®äº†æˆ‘ä»¬çš„è§‚ç‚¹ã€‚</p>
<h2 id="æ¡ä»¶æ³¨å†Œç»„ä»¶"><a href="#æ¡ä»¶æ³¨å†Œç»„ä»¶" class="headerlink" title="æ¡ä»¶æ³¨å†Œç»„ä»¶"></a>æ¡ä»¶æ³¨å†Œç»„ä»¶</h2><h3 id="Conditional"><a href="#Conditional" class="headerlink" title="@Conditional"></a>@Conditional</h3><p>ä½¿ç”¨<code>@Conditional</code>æ³¨è§£æˆ‘ä»¬å¯ä»¥æŒ‡å®šç»„ä»¶æ³¨å†Œçš„æ¡ä»¶ï¼Œå³æ»¡è¶³ç‰¹å®šæ¡ä»¶æ‰å°†ç»„ä»¶çº³å…¥åˆ°IOCå®¹å™¨ä¸­ã€‚</p>
<p>åœ¨ä½¿ç”¨è¯¥æ³¨è§£ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç°<code>Condition</code>æ¥å£ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCondition</span> <span class="keyword">implements</span> <span class="title class_">Condition</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¯¥æ¥å£åŒ…å«ä¸€ä¸ª<code>matches</code>æ–¹æ³•ï¼ŒåŒ…å«ä¸¤ä¸ªå…¥å‚:</p>
<ol>
<li><code>ConditionContext</code>ï¼šä¸Šä¸‹æ–‡ä¿¡æ¯ï¼›</li>
<li><code>AnnotatedTypeMetadata</code>ï¼šæ³¨è§£ä¿¡æ¯ã€‚</li>
</ol>
<p>ç®€å•å®Œå–„ä¸€ä¸‹è¿™ä¸ªå®ç°ç±»:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCondition</span> <span class="keyword">implements</span> <span class="title class_">Condition</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">osName</span> <span class="operator">=</span> context.getEnvironment().getProperty(<span class="string">"os.name"</span>);</span><br><span class="line">        <span class="keyword">return</span> osName != <span class="literal">null</span> &amp;&amp; osName.contains(<span class="string">"Windows"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ¥ç€å°†è¿™ä¸ªæ¡ä»¶æ·»åŠ åˆ°User Beanæ³¨å†Œçš„åœ°æ–¹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Conditional(MyCondition.class)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"mrdjun"</span>, <span class="number">18</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨Windowsç¯å¢ƒä¸‹ï¼ŒUserè¿™ä¸ªç»„ä»¶å°†è¢«æˆåŠŸæ³¨å†Œï¼Œå¦‚æœæ˜¯åˆ«çš„æ“ä½œç³»ç»Ÿï¼Œè¿™ä¸ªç»„ä»¶å°†ä¸ä¼šè¢«æ³¨å†Œåˆ°IOCå®¹å™¨ä¸­ã€‚</p>
<h3 id="Profile"><a href="#Profile" class="headerlink" title="@Profile"></a>@Profile</h3><p><code>@Profile</code>å¯ä»¥æ ¹æ®ä¸åŒçš„ç¯å¢ƒå˜é‡æ¥æ³¨å†Œä¸åŒçš„ç»„ä»¶ï¼Œä¸‹é¢æˆ‘ä»¬æ¥å­¦ä¸€ä¸‹å®ƒçš„ç”¨æ³•ã€‚</p>
<p>æ–°å»ºä¸€ä¸ªæ¥å£<code>CalculateService</code>ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CalculateService</span> {</span><br><span class="line">    Integer <span class="title function_">sum</span><span class="params">(Integer... value)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ¥ç€æ·»åŠ ä¸¤ä¸ªå®ç°<code>Java7CalculateServiceImpl</code>å’Œ<code>Java8CalculateServiceImpl</code>:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Profile("java7")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Java7CalculateServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CalculateService</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">sum</span><span class="params">(Integer... value)</span> {</span><br><span class="line">        System.out.println(<span class="string">"Java 7ç¯å¢ƒä¸‹æ‰§è¡Œ"</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= value.length; i++) {</span><br><span class="line">            result += i;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Profile("java8")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Java8CalculateServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CalculateService</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">sum</span><span class="params">(Integer... value)</span> {</span><br><span class="line">        System.out.println(<span class="string">"Java 8ç¯å¢ƒä¸‹æ‰§è¡Œ"</span>);</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(value).reduce(<span class="number">0</span>, Integer::sum);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>é€šè¿‡<code>@Profile</code>æ³¨è§£æˆ‘ä»¬å®ç°äº†ï¼šå½“ç¯å¢ƒå˜é‡åŒ…å«<code>java7</code>çš„æ—¶å€™ï¼Œ<code>Java7CalculateServiceImpl</code>å°†ä¼šè¢«æ³¨å†Œåˆ°IOCå®¹å™¨ä¸­ï¼›å½“ç¯å¢ƒå˜é‡åŒ…å«<code>java8</code>çš„æ—¶å€™ï¼Œ<code>Java8CalculateServiceImpl</code>å°†ä¼šè¢«æ³¨å†Œåˆ°IOCå®¹å™¨ä¸­ã€‚</p>
<p>æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ConfigurableApplicationContext</span> <span class="variable">context1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringApplicationBuilder</span>(DemoApplication.class)</span><br><span class="line">                .web(WebApplicationType.NONE)</span><br><span class="line">                .profiles(<span class="string">"java8"</span>)</span><br><span class="line">                .run(args);</span><br><span class="line"></span><br><span class="line"><span class="type">CalculateService</span> <span class="variable">service</span> <span class="operator">=</span> context1.getBean(CalculateService.class);</span><br><span class="line">System.out.println(<span class="string">"æ±‚åˆç»“æœï¼š "</span> + service.sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>));</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The following profiles are active: java8</span><br><span class="line">Java 8ç¯å¢ƒä¸‹æ‰§è¡Œ</span><br><span class="line">æ±‚å’Œç»“æœï¼š   55</span><br></pre></td></tr></tbody></table></figure>

<p>å¦‚æœå°†<code>.profiles("java8")</code>æ”¹ä¸º<code>.profiles("java7")</code>çš„è¯ï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The following profiles are active: java7</span><br><span class="line">Java 7ç¯å¢ƒä¸‹æ‰§è¡Œ</span><br><span class="line">æ±‚å’Œç»“æœï¼š   55</span><br></pre></td></tr></tbody></table></figure>

<h2 id="å¯¼å…¥ç»„ä»¶"><a href="#å¯¼å…¥ç»„ä»¶" class="headerlink" title="å¯¼å…¥ç»„ä»¶"></a>å¯¼å…¥ç»„ä»¶</h2><h3 id="Import"><a href="#Import" class="headerlink" title="@Import"></a>@Import</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒ…æ‰«æå’Œ<code>@Bean</code>æ¥å®ç°ç»„ä»¶æ³¨å†Œã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<code>@Import</code>æ¥å¿«é€Ÿåœ°å¾€IOCå®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»<code>Hello</code>ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hello</span> {}</span><br></pre></td></tr></tbody></table></figure>

<p>ç„¶ååœ¨é…ç½®ç±»ä¸­å¯¼å…¥è¿™ä¸ªç»„ä»¶ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import({Hello.class})</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line">	...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æŸ¥çœ‹IOCå®¹å™¨ä¸­æ‰€æœ‰ç»„ä»¶çš„åç§°ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(WebConfig.class);</span><br><span class="line">String[] beanNames = context.getBeanDefinitionNames();</span><br><span class="line">Arrays.stream(beanNames).forEach(System.out::println);</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œæ§åˆ¶å°è¾“å‡º:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">webConfig</span><br><span class="line">com.mrdjun.demo.domain.Hello</span><br><span class="line">user</span><br></pre></td></tr></tbody></table></figure>

<p>å¯çœ‹åˆ°ï¼Œé€šè¿‡<code>@Import</code>æˆ‘ä»¬å¯ä»¥å¿«é€Ÿåœ°å¾€IOCå®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ï¼ŒIdé»˜è®¤ä¸ºå…¨ç±»åã€‚</p>
<h3 id="ImportSelector"><a href="#ImportSelector" class="headerlink" title="ImportSelector"></a>ImportSelector</h3><p>é€šè¿‡<code>@Import</code>æˆ‘ä»¬å·²ç»å®ç°äº†ç»„ä»¶çš„å¯¼å…¥ï¼Œå¦‚æœéœ€è¦ä¸€æ¬¡æ€§å¯¼å…¥è¾ƒå¤šç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>ImportSelector</code>æ¥å®ç°ã€‚</p>
<p>æ–°å¢ä¸‰ä¸ªç±»<code>Apple</code>ï¼Œ<code>Banana</code>å’Œ<code>Watermelon</code>ï¼Œä»£ç ç•¥ã€‚</p>
<p>æŸ¥çœ‹<code>ImportSelector</code>æºç ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ImportSelector</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Select and return the names of which class(es) should be imported based on</span></span><br><span class="line"><span class="comment">     * the {<span class="doctag">@link</span> AnnotationMetadata} of the importing @{<span class="doctag">@link</span> Configuration} class.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">     String[] selectImports(AnnotationMetadata importingClassMetadata);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>ImportSelector</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼ŒåŒ…å«ä¸€ä¸ª<code>selectImports</code>æ–¹æ³•ï¼Œæ–¹æ³•è¿”å›ç±»çš„å…¨ç±»åæ•°ç»„ï¼ˆå³éœ€è¦å¯¼å…¥åˆ°IOCå®¹å™¨ä¸­ç»„ä»¶çš„å…¨ç±»åæ•°ç»„ï¼‰ï¼ŒåŒ…å«ä¸€ä¸ª<code>AnnotationMetadata</code>ç±»å‹å…¥å‚ï¼Œé€šè¿‡è¿™ä¸ªå‚æ•°æˆ‘ä»¬å¯ä»¥è·å–åˆ°ä½¿ç”¨<code>ImportSelector</code>çš„ç±»çš„å…¨éƒ¨æ³¨è§£ä¿¡æ¯ã€‚</p>
<p>æˆ‘ä»¬æ–°å»ºä¸€ä¸ª<code>ImportSelector</code>å®ç°ç±»<code>MyImportSelector</code>ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportSelector</span> <span class="keyword">implements</span> <span class="title class_">ImportSelector</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]{</span><br><span class="line">                <span class="string">"com.mrdjun.demo.domain.Apple"</span>,</span><br><span class="line">                <span class="string">"com.mrdjun.demo.domain.Banana"</span>,</span><br><span class="line">                <span class="string">"com.mrdjun.demo.domain.Watermelon"</span></span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸Šé¢æ–¹æ³•è¿”å›äº†æ–°å¢çš„ä¸‰ä¸ªç±»çš„å…¨ç±»åæ•°ç»„ï¼Œæ¥ç€æˆ‘ä»¬åœ¨é…ç½®ç±»çš„<code>@Import</code>æ³¨è§£ä¸Šä½¿ç”¨<code>MyImportSelector</code>æ¥æŠŠè¿™ä¸‰ä¸ªç»„ä»¶å¿«é€Ÿåœ°å¯¼å…¥åˆ°IOCå®¹å™¨ä¸­ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import({MyImportSelector.class})</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æŸ¥çœ‹å®¹å™¨ä¸­æ˜¯å¦å·²ç»æœ‰è¿™ä¸‰ä¸ªç»„ä»¶:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(WebConfig.class);</span><br><span class="line">String[] beanNames = context.getBeanDefinitionNames();</span><br><span class="line">Arrays.stream(beanNames).forEach(System.out::println);</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿæ§åˆ¶å°ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">com.mrdjun.demo.domain.Apple</span><br><span class="line">com.mrdjun.demo.domain.Banana</span><br><span class="line">com.mrdjun.demo.domain.Watermelon</span><br></pre></td></tr></tbody></table></figure>

<p>ç»„ä»¶å·²ç»æˆåŠŸå¯¼å…¥ã€‚</p>
<h3 id="ImportBeanDefinitionRegistrar"><a href="#ImportBeanDefinitionRegistrar" class="headerlink" title="ImportBeanDefinitionRegistrar"></a>ImportBeanDefinitionRegistrar</h3><p>é™¤äº†ä¸Šé¢ä¸¤ç§å¾€IOCå®¹å™¨å¯¼å…¥ç»„ä»¶çš„æ–¹æ³•å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<code>ImportBeanDefinitionRegistrar</code>æ¥æ‰‹åŠ¨å¾€IOCå®¹å™¨å¯¼å…¥ç»„ä»¶ã€‚</p>
<p>æŸ¥çœ‹å…¶æºç ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ImportBeanDefinitionRegistrar</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>ImportBeanDefinitionRegistrar</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼ŒåŒ…å«ä¸€ä¸ª<code>registerBeanDefinitions</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åŒ…å«ä¸¤ä¸ªå…¥å‚ï¼š</p>
<ol>
<li><code>AnnotationMetadata</code>ï¼šå¯ä»¥é€šè¿‡å®ƒè·å–åˆ°ç±»çš„æ³¨è§£ä¿¡æ¯ï¼›</li>
<li><code>BeanDefinitionRegistry</code>ï¼šBeanå®šä¹‰æ³¨å†Œå™¨ï¼ŒåŒ…å«äº†ä¸€äº›å’ŒBeanæœ‰å…³çš„æ–¹æ³•ï¼š</li>
</ol>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanDefinitionRegistry</span> <span class="keyword">extends</span> <span class="title class_">AliasRegistry</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">registerBeanDefinition</span><span class="params">(String var1, BeanDefinition var2)</span> <span class="keyword">throws</span> BeanDefinitionStoreException;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">removeBeanDefinition</span><span class="params">(String var1)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException;</span><br><span class="line"></span><br><span class="line">    BeanDefinition <span class="title function_">getBeanDefinition</span><span class="params">(String var1)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">containsBeanDefinition</span><span class="params">(String var1)</span>;</span><br><span class="line"></span><br><span class="line">    String[] getBeanDefinitionNames();</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getBeanDefinitionCount</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isBeanNameInUse</span><span class="params">(String var1)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©<code>BeanDefinitionRegistry</code>çš„<code>registerBeanDefinition</code>æ–¹æ³•æ¥å¾€IOCå®¹å™¨ä¸­æ³¨å†ŒBeanã€‚è¯¥æ–¹æ³•åŒ…å«ä¸¤ä¸ªå…¥å‚ï¼Œç¬¬ä¸€ä¸ªä¸ºéœ€è¦æ³¨å†Œçš„Beanåç§°ï¼ˆIdï¼‰,ç¬¬äºŒä¸ªå‚æ•°ä¸ºBeançš„å®šä¹‰ä¿¡æ¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶å®ç°ç±»<code>RootBeanDefinition</code>æ¥å®Œæˆï¼š</p>
<p><img src="/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190130094046.png" alt="QQæˆªå›¾20190130094046.png"></p>
<p>ä¸ºäº†æ¼”ç¤º<code>ImportBeanDefinitionRegistrar</code>çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬å…ˆæ–°å¢ä¸€ä¸ªç±»ï¼Œåç§°ä¸º<code>Strawberry</code>ï¼Œä»£ç ç•¥ã€‚</p>
<p>ç„¶åæ–°å¢ä¸€ä¸ª<code>ImportBeanDefinitionRegistrar</code>å®ç°ç±»<code>MyImportBeanDefinitionRegistrar</code>ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportBeanDefinitionRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> {</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> <span class="string">"strawberry"</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">contain</span> <span class="operator">=</span> registry.containsBeanDefinition(beanName);</span><br><span class="line">        <span class="keyword">if</span> (!contain) {</span><br><span class="line">            <span class="type">RootBeanDefinition</span> <span class="variable">rootBeanDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>(Strawberry.class);</span><br><span class="line">            registry.registerBeanDefinition(beanName, rootBeanDefinition);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨ä¸Šé¢çš„å®ç°ç±»ä¸­ï¼Œæˆ‘ä»¬å…ˆé€šè¿‡<code>BeanDefinitionRegistry</code>çš„<code>containsBeanDefinition</code>æ–¹æ³•åˆ¤æ–­IOCå®¹å™¨ä¸­æ˜¯å¦åŒ…å«äº†åç§°ä¸º<code>strawberry</code>çš„ç»„ä»¶ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ‰‹åŠ¨é€šè¿‡<code>BeanDefinitionRegistry</code>çš„<code>registerBeanDefinition</code>æ–¹æ³•æ³¨å†Œä¸€ä¸ªã€‚</p>
<p>å®šä¹‰å¥½<code>MyImportBeanDefinitionRegistrar</code>åï¼Œæˆ‘ä»¬åŒæ ·åœ°åœ¨é…ç½®ç±»çš„<code>@Import</code>ä¸­ä½¿ç”¨å®ƒï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import({MyImportBeanDefinitionRegistrar.class})</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æŸ¥çœ‹å®¹å™¨ä¸­æ˜¯å¦å·²ç»æœ‰è¿™ä¸ªç»„ä»¶:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(WebConfig.class);</span><br><span class="line">String[] beanNames = context.getBeanDefinitionNames();</span><br><span class="line">Arrays.stream(beanNames).forEach(System.out::println);</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿæ§åˆ¶å°ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strawberry</span><br></pre></td></tr></tbody></table></figure>

<p>ç»„ä»¶å·²ç»æ³¨å†ŒæˆåŠŸã€‚</p>
<h2 id="ä½¿ç”¨FactoryBeanæ³¨å†Œç»„ä»¶"><a href="#ä½¿ç”¨FactoryBeanæ³¨å†Œç»„ä»¶" class="headerlink" title="ä½¿ç”¨FactoryBeanæ³¨å†Œç»„ä»¶"></a>ä½¿ç”¨FactoryBeanæ³¨å†Œç»„ä»¶</h2><p>Springè¿˜æä¾›äº†ä¸€ä¸ª<code>FactoryBean</code>æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°è¯¥æ¥å£æ¥æ³¨å†Œç»„ä»¶ï¼Œè¯¥æ¥å£åŒ…å«äº†ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•å’Œä¸€ä¸ªé»˜è®¤æ–¹æ³•ï¼š</p>
<p><img src="/p/4bb4364/QQ%E6%88%AA%E5%9B%BE20190130103346.png" alt="QQæˆªå›¾20190130103346.png"></p>
<p>ä¸ºäº†æ¼”ç¤º<code>FactoryBean</code>çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬æ–°å¢ä¸€ä¸ª<code>Cherry</code>ç±»ï¼Œä»£ç ç•¥ã€‚</p>
<p>ç„¶ååˆ›å»º<code>FactoryBean</code>çš„å®ç°ç±»<code>CherryFactoryBean</code>:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CherryFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;Cherry&gt; {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Cherry <span class="title function_">getObject</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Cherry</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() {</span><br><span class="line">        <span class="keyword">return</span> Cherry.class;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>getObject</code>è¿”å›éœ€è¦æ³¨å†Œçš„ç»„ä»¶å¯¹è±¡ï¼Œ<code>getObjectType</code>è¿”å›éœ€è¦æ³¨å†Œçš„ç»„ä»¶ç±»å‹ï¼Œ<code>isSingleton</code>æŒ‡æ˜è¯¥ç»„ä»¶æ˜¯å¦ä¸ºå•ä¾‹ã€‚å¦‚æœä¸ºå¤šä¾‹çš„è¯ï¼Œæ¯æ¬¡ä»å®¹å™¨ä¸­è·å–è¯¥ç»„ä»¶éƒ½ä¼šè°ƒç”¨å…¶<code>getObject</code>æ–¹æ³•ã€‚</p>
<p>å®šä¹‰å¥½<code>CherryFactoryBean</code>åï¼Œæˆ‘ä»¬åœ¨é…ç½®ç±»ä¸­æ³¨å†Œè¿™ä¸ªç±»ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> CherryFactoryBean <span class="title function_">cherryFactoryBean</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CherryFactoryBean</span>();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æµ‹è¯•ä»å®¹å™¨ä¸­è·å–ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(WebConfig.class);</span><br><span class="line"><span class="type">Object</span> <span class="variable">cherry</span> <span class="operator">=</span> context.getBean(<span class="string">"cherryFactoryBean"</span>);</span><br><span class="line">System.out.println(cherry.getClass());</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class com.mrdjun.demo.domain.Cherry</span><br></pre></td></tr></tbody></table></figure>

<p>å¯çœ‹åˆ°ï¼Œè™½ç„¶æˆ‘ä»¬è·å–çš„æ˜¯Idä¸º<code>cherryFactoryBean</code>çš„ç»„ä»¶ï¼Œä½†å…¶è·å–åˆ°çš„å®é™…æ˜¯<code>getObject</code>æ–¹æ³•é‡Œè¿”å›çš„å¯¹è±¡ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬è¦è·å–<code>cherryFactoryBean</code>æœ¬èº«ï¼Œåˆ™å¯ä»¥è¿™æ ·åšï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">cherryFactoryBean</span> <span class="operator">=</span> context.getBean(<span class="string">"&amp;cherryFactoryBean"</span>);</span><br><span class="line">System.out.println(cherryFactoryBean.getClass());</span><br></pre></td></tr></tbody></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œè§‚å¯Ÿæ§åˆ¶å°ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class com.mrdjun.demo.factory.CherryFactoryBean</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸ºä»€ä¹ˆåŠ ä¸Š<code>&amp;</code>å‰ç¼€å°±å¯ä»¥è·å–åˆ°ç›¸åº”çš„å·¥å‚ç±»äº†å‘¢ï¼ŒæŸ¥çœ‹<code>BeanFactory</code>çš„æºç ä¼šå‘ç°åŸå› :</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanFactory</span> {</span><br><span class="line">    <span class="type">String</span> <span class="variable">FACTORY_BEAN_PREFIX</span> <span class="operator">=</span> <span class="string">"&amp;"</span>;</span><br><span class="line">	...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
</body></html>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <span class="reward-comment">è¯·ä½œè€…å–ç“¶è‚¥å®…æ°´ğŸ¥¤</span>
  <button class="reward-btn">
    ï¿¥
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="MrDJun WeChat Pay">
      </div>
      <div>
        <img src="/images/alipay.png" alt="MrDJun Alipay">
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>MrDJun
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://mrdjun.gitee.io/p/4bb4364.html" title="æ·±å…¥å­¦ä¹ Springç»„ä»¶æ³¨å†Œ">https://mrdjun.gitee.io/p/4bb4364.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/BY-NC-SA%204.0/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA 4.0</a> unless stating additionally.
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Spring/" rel="tag"># Spring</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/p/b07f48bf.html" rel="prev" title="å¸¸ç”¨çš„æ’åºæ–¹æ³•">
                  <i class="fa fa-chevron-left"></i> å¸¸ç”¨çš„æ’åºæ–¹æ³•
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/p/d6094941.html" rel="next" title="JVM åƒåœ¾å›æ”¶">
                  JVM åƒåœ¾å›æ”¶ <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
    </main>

    <footer class="footer hidden">
      <div class="footer-inner">

  <div class="busuanzi-count">
  </div>
      </div>
    </footer>

    
  <script src="/js/third-party/anime.min.js"></script>
  <script src="/js/third-party/pjax.min.js"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

    
<script src="/js/third-party/search/search.js"></script>
<script src="/js/third-party/search/local-search.js"></script>





    
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





      <div id="mouse_explode"></div>
      <script src="/js/mo.min.js"></script>
      <script type="text/javascript" src="/js/mouse-explode.js"></script>
    <script type="text/javascript" src="/js/dark-theme.js"></script>
    <script type="text/javascript" src="/js/third-party/zoomify.min.js"></script>
    <script type="text/javascript" src="/js/zoom-img.js"></script>
    <script type="text/javascript" src="/js/encrypt-button.js"></script>
  </body>
</html>
